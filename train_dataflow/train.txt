parser parse_args args_gomo
read_nc args_gomo file_path variable
args_gomo im im
args_gomo jm jm
args_gomo kb kb
args_gomo stencil_width stencil_width
read_init fsm
GOMO_init im|jm|kb|stencil_width net_init
range 1|args_gomo step step
Model q2lb
etf|ua|uab|va|vab|el|elb|d|u|v|w|kq|km|kh|q2|q2l|tb|t|sb|s|rho|wubot|wvbot| vars_list
vars_list var
var asnumpy
np save args_gomo outputs_path|u asnumpy
np save args_gomo outputs_path|v asnumpy
np save args_gomo outputs_path|t asnumpy
np save args_gomo outputs_path|et asnumpy
parser parse_args args_gomo im im
parser parse_args args_gomo jm jm
parser parse_args args_gomo kb kb
parser parse_args args_gomo stencil_width stencil_width
parser parse_args args_gomo step step
etf|ua|uab|va|vab|el|elb|d|u|v|w|kq|km|kh|q2|q2l|tb|t|sb|s|rho|wubot|wvbot| vars_list var
vars_list var asnumpy
(input)|2 output
super AXB|self __init__
stencil_width self stencil_width
P Slice self slice
P Shape self shape
axb_kernel self axb_kernel
self pad x x1
self shape x x_shape
self axb_kernel x1 x1
self slice x1|(self stencil_width|self stencil_width|self stencil_width) x1
super AXF|self __init__
axf_kernel self axf_kernel
self axf_kernel x1 x1
super AYB|self __init__
ayb_kernel self ayb_kernel
self ayb_kernel x1 x1
super AYF|self __init__
ayf_kernel self ayf_kernel
self ayf_kernel x1 x1
super AZB|self __init__
azb_kernel self azb_kernel
self azb_kernel x1 x1
super AZF|self __init__
azf_kernel self azf_kernel
self azf_kernel x1 x1
input i|j|k]-input[i-1|j|k output
super DXB|self __init__
dxb_kernel self dxb_kernel
self dxb_kernel x1 x1
input output
super DXF|self __init__
dxf_kernel self dxf_kernel
self dxf_kernel x1 x1
input i|j|k]-input[i|j-1|k output
super DYB|self __init__
dyb_kernel self dyb_kernel
self dyb_kernel x1 x1
super DYF|self __init__
dyf_kernel self dyf_kernel
self dyf_kernel x1 x1
input i|j|k]-input[i|j|k-1 output
super DZB|self __init__
dzb_kernel self dzb_kernel
self dzb_kernel x1 x1
super DZF|self __init__
dzf_kernel self dzf_kernel
self dzf_kernel x1 x1
super Grid|self __init__
im self im
jm self jm
km self km
[1|0|3|2|5|4|7|6] self x_map
[2|3|0|1|6|7|4|5] self y_map
[4|5|6|7|0|1|2|3] self z_map
AXB stencil_width self AXB
AYB stencil_width self AYB
AZB stencil_width self AZB
self AYB self AXB dx dx0
self AYB self AXB dy dy0
dz dz0
self AYB dx dx1
self AYB dy dy1
self AZB dz dz1
self AXB dx dx2
self AXB dy dy2
dx dx3
dy dy3
(dx0|dx1|dx2|dx3) x_d
(dy0|dy1|dy2|dy3) y_d
(dz0|dz1) z_d
self AYB self AXB dx dx0 x_d
self AYB self AXB dy dy0 y_d
dz dz0 z_d
self AYB dx dx1 x_d
self AYB dy dy1 y_d
self AZB dz dz1 z_d
self AXB dx dx2 x_d
self AXB dy dy2 y_d
dx dx3 x_d
dy dy3 y_d
file_obj variables name data
np float32 np transpose data|(2|1|0) data
nc Dataset file_path file_obj
params_name name
load_var file_obj|name variable name
super axb_kernel|self __init__
P Pad ((1|0)) self pad
P Slice self slice
P Shape self shape
self pad x x1
self shape x x_shape
self slice x1|(0|0|0) x1
super ayb_kernel|self __init__
P Pad ((0|0)) self pad
super azb_kernel|self __init__
super axf_kernel|self __init__
P Pad ((0|1)) self pad
self slice x1|(1|0|0) x1
super ayf_kernel|self __init__
self slice x1|(0|1|0) x1
super azf_kernel|self __init__
self slice x1|(0|0|1) x1
super dxb_kernel|self __init__
x-x1 x
super dxf_kernel|self __init__
x1-x x
super dyb_kernel|self __init__
super dyf_kernel|self __init__
super dzb_kernel|self __init__
super dzf_kernel|self __init__
variable dict
Tensor variable dx
Tensor variable dy
Tensor variable dz
Tensor variable tb
Tensor variable sb
Tensor variable ub
Tensor variable vb
Tensor variable uab
Tensor variable vab
Tensor variable elb
Tensor variable etb
Tensor variable dt
Tensor variable h
Tensor variable vfluxf
Tensor variable z
Tensor variable zz
Tensor variable dzz
Tensor variable cor
Tensor variable fsm
Tensor np zeros [im|jm|kb]|np float32 w
Tensor np zeros [im|jm|1]|np float32 wubot
Tensor np zeros [im|jm|1]|np float32 wvbot
Tensor np zeros [im|jm|1]|np float32 vfluxb
Tensor np zeros [im|jm|1]|np float32 utb
Tensor np zeros [im|jm|1]|np float32 vtb
Tensor np zeros [im|jm|1]|np float32 dhb
Tensor np zeros [im|jm|1]|np float32 egb
super Shift|self __init__
enumerate i|_
((dims[i]|0)) pad_list
(0|) self slice_list
((0|-dims[i])) pad_list
(-dims[i]|) self slice_list
P Pad (pad_list) self pad
P Slice self slice
P Shape self shape
self pad x x1
self shape x x_shape
self slice x1|self slice_list|x_shape x1
super GOMO_init|self __init__
Grid im|jm|kb self Grid
im self im
jm self jm
kb self kb
self kb-1 self kbm1
self kb-2 self kbm2
self im-1 self imm1
self jm-1 self jmm1
Tensor np float32 np ones [self im|self jm|self kb] self mat_ones
AXB stencil_width self AXB
AXF stencil_width self AXF
AYB stencil_width self AYB
AYF stencil_width self AYF
AZB stencil_width self AZB
AZF stencil_width self AZF
DXB stencil_width self DXB
DXF stencil_width self DXF
DYB stencil_width self DYB
DYF stencil_width self DYF
DZB stencil_width self DZB
DZF stencil_width self DZF
P Abs self abs
P Sqrt self sqrt
P Log self log
P CumSum self csum
P Assign self assign
P Pow self pow
(self im|self jm|self kb) shape3
np zeros shape3|dtype z_h
Tensor z_h self z_h
np zeros shape3|dtype z_e
Tensor z_e self z_e
np zeros shape3|dtype z_he1
Tensor z_he1 self z_he1
ti|self tbias tr
si|self sbias sr
tr|tr tr2
tr2|tr tr3
tr3|tr tr4
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p
-0 157406e0|6 793952e-2|tr-9 095290e-3|tr2|1 001685e-4|tr3-1 120083e-6|tr4| rhor2
rhor2|(0 824493e0-4 0899e-3|tr|7 6438e-5|tr2-8 2467e-7|tr3|5 3875e-9|tr4)|sr| rhor1
self abs sr
p|(cr1|cr1) cr
rhor1|1 e5|cr|(1 e0-2 e0|cr) rhor
rhor|self rhoref|fsm rhoo
P Slice zz1|(self kb-2|) zz_kbm1
P Cast cbc cbc_compare
cbc|(1-cbc_compare)|cbc_compare|self cbcmax cbc
cbc|(1-cbc_compare)|cbc_compare|self cbcmin cbc
self Grid dx|dy|dz z_d
self dens sb|tb|zz|h|fsm rho
self rmean|(1-self z_he1)|rho|self z_he1 rmean
zz zz1
uab ua
vab va
elb el
etb et
et etf
h|el d
h|et dt
dt|0 1e0 l
self mat_ones|self small q2b
l|q2b q2lb
l|self sqrt q2b kh
kh km
kh kq
self mat_ones|self aam_init aam
w|(1-self z_h)|self z_h|vfluxf w
q2b q2
q2lb q2l
tb t
sb s
ub u
vb v
self bottom_friction zz1|h cbc
super GOMO|self __init__
x_d self x_d
y_d self y_d
z_d self z_d
q2b self q2b_init
q2lb self q2lb_init
aam self aam_init
cbc self cbc_init
rmean self rmean_init
self _parameter_init variable
self _boundary_process
self _constant_init
(self im|self jm|1) shape2
np zeros shape2|dtype x_he
Tensor x_he self x_he
np zeros shape2|dtype x_h
Tensor x_h self x_h
np zeros shape2|dtype x_e
Tensor x_e self x_e
np zeros shape2|dtype x_h1
Tensor x_h1 self x_h1
np zeros shape2|dtype x_e1
Tensor x_e1 self x_e1
np zeros shape2|dtype y_he
Tensor y_he self y_he
np zeros shape2|dtype y_h
Tensor y_h self y_h
np zeros shape2|dtype y_e
Tensor y_e self y_e
np zeros shape2|dtype y_h1
Tensor y_h1 self y_h1
np zeros shape2|dtype y_e1
Tensor y_e1 self y_e1
np zeros shape3|dtype x_h3d
Tensor x_h3d self x_h3d
np zeros shape3|dtype x_e3d
Tensor x_e3d self x_e3d
np zeros shape3|dtype x_he3d
Tensor x_he3d self x_he3d
np zeros shape3|dtype x_e13d
Tensor x_e13d self x_e13d
np zeros shape3|dtype x_h13d
Tensor x_h13d self x_h13d
np zeros shape3|dtype y_h3d
Tensor y_h3d self y_h3d
np zeros shape3|dtype y_e3d
Tensor y_e3d self y_e3d
np zeros shape3|dtype y_e13d
Tensor y_e13d self y_e13d
np zeros shape3|dtype y_he3d
Tensor y_he3d self y_he3d
np zeros shape3|dtype y_h13d
Tensor y_h13d self y_h13d
np zeros shape3|dtype z_h1
Tensor z_h1 self z_h1
np zeros shape3|dtype z_e1
Tensor z_e1 self z_e1
np zeros shape3|dtype z_he
Tensor z_he self z_he
np zeros shape3|dtype z_he2
Tensor z_he2 self z_he2
np zeros shape3|dtype z_he3
Tensor z_he3 self z_he3
range i
np zeros shape3|dtype z_k
(Tensor(z_k)) self zslice
self dte|self isplit self dti
self dte|2e0 self dte2
self dti|2e0 self dti2
self ispi|2 0 self isp2i
Tensor self small|np ones([self im|self jm|self kb]) self matrix_small
Tensor self grav|np ones([self im|self jm|self kb]) self matrix_grav
Tensor self grav|np ones([self im|self jm|1]) self matrix2d_grav
Tensor self dti2|np ones([self im|self jm|self kb]) self matrix1_dti2
Tensor 2 0|self dti2|np ones([self im|self jm|self kb]) self matrix2_dti2
Tensor self ispi|np ones([self im|self jm|1]) self matrix_ispi
Tensor self isp2i|np ones([self im|self jm|1]) self matrix_isp2i
Tensor 2 0|self dte|np ones([self im|self jm|1]) self matrix2_dte
Tensor self ramp|np ones([self im|self jm|1]) self matrix_ramp
Tensor 0 5|self smoth|np ones([self im|self jm|1]) self matrix_smoth
Tensor self alpha|np ones([self im|self jm|1]) self matrix_alpha
Tensor np float32 np ones [self im|self jm|1] self mat_ones_2d
Tensor 2|np float32(np ones([self im|self jm|1])) self mat_twos_2d
Tensor np float32 np zeros [self im|self jm|self kb] self mat_zeros
Tensor np float32 np zeros [self im|self jm|1] self mat_zeros_im_jm_1
(self AYF v|self DXB(self AXF dy)-self AXF u|self DYB(self AYF dx))|(dx|dy) curv
self AXF self AXB dt|u|self AXF u-(dt|aam|2e0|self DXF ub|x_d) tmp23
tmp23|(1 0-self x_he) tmp23
self AXB curv|dt|self AYF v
advx|(1-self x_h)|(1-self y_he) advx
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp
tmp|(1-self y_he) tmp
self AYB curv|dt|self AXF u
advy|(1-self y_h)|(1-self x_he) advy
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp
self DXB dt|x_d|self DZB self AXB rho-rmean|z_d|self AZB zz|self AZB dz
-1|zz|self AXB dt|self DXB rho-rmean|x_d tmp1
tmp|(1-self z_h)|tmp1|self z_h tmp
tmp|(1-self z_e) tmp
self ramp|self grav|self AXB dt|self csum tmp|2|dum drhox
drhox|(1-self z_e) drhox
-1|self DZB zz|self DYB(self AZB rho-rmean)|y_d|self AYB dt| tmp
self DYB dt|y_d|self DZB self AYB rho-rmean|z_d|self AZB zz|self AZB dz
-1|zz|self AYB dt|self DYB rho-rmean|y_d tmp1
self ramp|self grav|self AYB dt|self csum tmp|2|dvm drhoy
drhoy|(1-self z_e) drhoy
self advct dx|dy|u|v|dt|aam|ub|x_d|y_d|vb advy
self baropg x_d|y_d|z_d|self zz|rho|rmean|dt|self dz|self dum|self dvm drhoy
self horcon|dx|dy|self sqrt aam
self DXF u|x_d|self DXF u|x_d|self DYF v|y_d|self DYF v
 self DYB self AYF self AXF u|y_d|self DXB self AXF self AYF v|x_d
aam|(1-self x_he3d)|self aam_init|self x_he3d aam
aam|(1-self y_he3d)|self aam_init|self y_he3d aam
aam|(1-self z_e)|self aam_init|self z_e aam
aam m2s-1
self AYB self AXB d|self AXB(self AYB aam2d)|(self DYB uab|y_d|self DXB vab|x_d) tps
self AXF self AXB d|ua|self AXF ua-2 |d|aam2d| tmp
self DXF uab
tmp|(1-self x_he) tmp
self DXB tmp|x_d|self DYF(self AXB(self AYB d|va)|self AYB ua-tps)|y_d advua
advua|(1-self x_h) advua
advua|(1-self y_he) advua
self AYF self AYB d|va|self AYF va-2 |d|aam2d|self DYF vab|y_d tmp
self DXF self AYB self AXB d|ua|self AXB va-tps|x_d|self DYB tmp|y_d advva
advva|(1-self y_h) advva
advva|(1-self x_he) advva
self reduce_sum advx|self dz|2 adx2d
self reduce_sum advy|self dz|2 ady2d
self reduce_sum drhox|self dz|2 drx2d
self reduce_sum drhoy|self dz|2 dry2d
self reduce_sum aam|self dz|2 aam2d
self advave x_d|y_d|d|aam2d|uab|vab|ua|va advva
adx2d-advua adx2d
ady2d-advva ady2d
el|self ispi egf
ua|2 0|self AXB d|self isp2i utf
va|2 0|self AYB d|self isp2i vtf
P Pad ((0|1)) tmp
P Slice tmp|(1|0|0) tmp
elf|(1-self x_h)|tmp|self x_h elf
P Pad ((1|0)) tmp
P Slice tmp|(0|0|0) tmp
elf|(1-self x_e)|tmp|self x_e elf
P Pad ((0|0)) tmp
P Slice tmp|(0|1|0) tmp
elf|(1-self y_h)|tmp|self y_h elf
elf|(1-self y_e)|tmp|self y_e elf
elf|self fsm elf
wu>momentumfluxesatthebottom m2s-2
self AXF self AXB d|ua|self AXF ua-self mat_twos_2d|d|aam2d|self DXF uab|x_d tmp
self AXB d
 self DXB elb|x_d|self DXB elf|x_d
self mat_zeros_im_jm_1 tmpua
self mat_zeros_im_jm_1 tmpel
tmpua|(1-self x_e1)|self uabe|self x_e1 tmpua
tmpua|(1-self x_h1)|self uabw|self x_h1 tmpua
tmpel|(1-self x_e1)|self ele|self x_e1 tmpel
tmpel|(1-self x_h1)|self elw|self x_h1 tmpel
self matrix_ramp|(tmpua|self rfe|P Sqrt(self grav|self h)|(el-tmpel)) tmp
P Pad ((1|0)) tmp0
P Slice tmp0|(0|0|0) tmp0
uaf|(1-self x_e)|tmp0|self x_e uaf
self matrix_ramp|(tmpua-self rfw|P Sqrt(self grav|self h)|(el-tmpel)) tmp
uaf|(1-self x_h1)|tmp|self x_h1 uaf
P Pad ((0|1)) tmp0
P Slice tmp0|(1|0|0) tmp0
uaf|(1-self x_h)|tmp0|self x_h uaf
uaf|(1-self y_he) uaf
uaf|self dum uaf
wv>momentumfluxesatthebottom m2s-2
self AYF self AYB d|va|self AYF va-self mat_twos_2d|d|aam2d|self DYF vab|y_d tmp
self AYB d
self DYB el
 self DYB elb|y_d|self DYB elf|y_d
self mat_zeros_im_jm_1 tmpva
tmpva|(1-self y_e1)|self vabn|self y_e1 tmpva
tmpva|(1-self y_h1)|self vabs|self y_h1 tmpva
tmpel|(1-self y_e1)|self eln|self y_e1 tmpel
tmpel|(1-self y_h1)|self els|self y_h1 tmpel
self matrix_ramp|(tmpva|self rfn|P Sqrt(self grav|self h)|(el-tmpel)) tmp
P Pad ((0|0)) tmp0
vaf|(1-self y_e)|tmp0|self y_e vaf
self matrix_ramp|(tmpva-self rfs|P Sqrt(self grav|self h)|(el-tmpel)) tmp
vaf|(1-self y_h1)|tmp|self y_h1 vaf
P Slice tmp0|(0|1|0) tmp0
vaf|(1-self y_h)|tmp0|self y_h vaf
vaf|(1-self x_he) vaf
vaf|self dvm vaf
dti ms-1 DT
P ReduceMax P Abs vaf vamax
etf|0 5|(1 0-0 5|self smoth)|elf etf
(etf|0 5|elf)|self fsm etf
ua|self matrix_smoth|(uab-self mat_twos_2d|ua|uaf) uab
F depend uaf|uab ua
va|self matrix_smoth|(vab-self mat_twos_2d|va|vaf) vab
F depend vaf|vab va
el|self matrix_smoth|(elb-self mat_twos_2d|el|elf) elb
F depend elf|elb el
self h|el d
egf|el|self matrix_ispi egf
utf|self mat_twos_2d|ua|self AXB d|self matrix_isp2i utf
vtf|self mat_twos_2d|va|self AYB d|self matrix_isp2i vtf
(0 5|(vfluxb|self vfluxf)|del_w) w
P Shape w w_shape
P BroadcastTo w_shape self fsm tmp_fsm
w|tmp_fsm w
w|(1 -self x_he3d) w
w|(1 -self z_e) w
u-self reduce_sum(u|self dz|2)|(utb|utf)|(2 0|self AXB dt) u
u|(1-self x_h3d) u
u|(1 -self z_e) u
v-self reduce_sum(v|self dz|2)|(vtb|vtf)|(2 0|self AYB dt) v
v|(1-self y_h3d) v
v|(1-self z_e) v
self h|etf dhf
self AZB u
self AZB self AXB aam
self AXB self h
self DXB q2b
self DXB q2lb
Shift (0|0|1)(self dzz1) dzz1
self dz1|dzz1|self mat_ones a
-self dti2|(self AZF kq|self umol)|(a|dhf|dhf|self small_debug) a
a|(1-self z_he) a
Shift (0|0|1)(self dz1) dz1
dz1|dzz1|self mat_ones c
-self dti2|(self AZB kq|self umol)|(c|dhf|dhf|self small_debug) c
c|(1-self z_he) c
P Sqrt self AXF self wusurf|self AXF(self wusurf)|self AYF(self wvsurf)|self AYF(self wvsurf) utau2
self mat_zeros ee
(15 8|cbcnst)(2 0|3 0)|utau2|self z_h|self mat_ones gg
surfl|utau2|self grav|self mat_ones l0
P Sqrt self AXF wubot|self AXF wubot|self AYF wvbot|self AYF wvbot|(16 6(2 0|3 0)) tmp
q2f|(1-self z_e)|tmp|self z_e q2f
self grav|self rhoref|(-self zz|self mat_ones|self h)|1 e-4 p
cc|P Sqrt((1 0-0 01642|p|cc)|(1 0-0 4|p|(cc|cc))) cc
cc|(1-self z_e) cc
P Abs q2b q2b
P Abs q2lb q2lb
self matrix_grav|(self matrix_grav|self h-self DZB rho|self AZB cc|cc|z_d)| boygr
boygr|(1-self z_h) boygr
q2lb|q2b l_tmp
self kappa|l0 kappa_l0
P Cast kappa_l0 tmp
kappa_l0|tmp|l_tmp|(1-tmp) l_tmp
l_tmp|l_tmp|boygr|q2b gh
gh tmp
P Cast tmp|mstype float32 tmp
gh|tmp|0 028|(1-tmp) gh
l_tmp|(1-self z_h)|self kappa|l0|self z_h l_tmp
l_tmp|(1-self z_e) l_tmp
gh|(1-self z_he) gh
km|sef|(self DZB(self AXF u)|z_d|self DZB(self AXF u)|z_d|self DZB(self AYF v)|z_d) kn
kn|(1-self x_e3d) kn
P Sqrt q2b|(b1|l_tmp|self small) dtef
dtef|(1-self z_he) dtef
gg ggtmp
ee eetmp
range k
a|gg ee
(-self matrix2_dti2|kn|c|Shift((0|0|1))(ggtmp)-q2f)|gg gg
eetmp|(1-self zslice) ee
ggtmp|(1-self zslice) gg
q2f|(1-self x_he3d) q2f
q2f q2ftmp
range self kbm1 k
ee|Shift((0|0|-1))(q2f)|gg q2f
q2ftmp|(1-self zslice) q2f
q2f|(1-self y_e3d) q2f
ee|(1-self z_h1) ee
gg|(1-self z_h1) gg
q2lf|(1-self z_he) q2lf
dtef|(1 0|e2|((1 0|P Abs))) dtef
(-self matrix1_dti2|kn|l_tmp|e1|c|Shift((0|0|1))(ggtmp)-q2lf)|gg gg
gg|(1-self x_e3d) gg
q2lf q2lftmp
ee|Shift((0|0|-1))(q2lf)|gg q2lf
q2lftmp|(1-self zslice) q2lf
P LogicalOr (q2f) res_compare
P Cast res_compare|mstype float32 filters
filters|(1-self z_he) filters
q2f|(1-filters)|self matrix_small|filters q2f
q2lf|(1-filters)|0 1|dt|self small|filters q2lf
-gh|(3 0|a2|b2|18 0|a1|a2)|1 tmp
a2|(1 0-6 0|a1|b1)|tmp sh
-gh|(9 0|a1|a2)|1 tmp
(a1|(1 0-3 0|c1-6 0|a1|b1)|sh|(18 0|a1|a1|9 0|a1|a2)|gh)|tmp sm
l_tmp|P Sqrt(P Abs q2) kn
(kn|sh|0 41|kq)|0 5 kq
(kn|sm|km)|0 5 km
(kn|sh|kh)|0 5 kh
km|(1-self y_e)|tmp0|self fsm|self y_e km
kh|(1-self y_e)|tmp0|self fsm|self y_e kh
km|(1-self y_h)|tmp0|self fsm|self y_h km
kh|(1-self y_h)|tmp0|self fsm|self y_h kh
km|(1-self x_e)|tmp0|self fsm|self x_e km
kh|(1-self x_e)|tmp0|self fsm|self x_e kh
km|(1-self x_h)|tmp0|self fsm|self x_h km
kh|(1-self x_h)|tmp0|self fsm|self x_h kh
u tmpu
v tmpv
tmpu|(1-self x_h)|tmp0|self x_h tmpu
tmpu|(1-self y_h)|tmp0|self y_h tmpu
q2f|(1-self x_e)|tmp1|self x_e q2f
q2lf|(1-self x_e)|tmp1|self x_e q2lf
q2f|(1-self x_h)|tmp1|self x_h q2f
q2lf|(1-self x_h)|tmp1|self x_h q2lf
q2f|(1-self y_e)|tmp1|self y_e q2f
q2lf|(1-self y_e)|tmp1|self y_e q2lf
q2f|(1-self y_h)|tmp1|self y_h q2f
q2lf|(1-self y_h)|tmp1|self y_h q2lf
q2f|self fsm|1 e-10 q2f
q2lf|self fsm|1 e-10 q2lf
q2|0 5|self smoth|(q2f|q2b-2 0|q2) q2b
q2f q2
q2l|0 5|self smoth|(q2lf|q2lb-2 0|q2l) q2lb
q2lf q2l
self AXB dhf dh
self AXB w|self AZB u tmp
z_d|(1-self z_e)|self small_debug|self z_e dztmp
self dzz|(1-self z_e)|self small_debug|self z_e dzztmp
uf|(1-self z_e) uf
dh|(1-self x_h)|self x_h dh
dh|(1-self y_h)|self y_h dh
self AXB km c
c|(1-self x_h3d) c
-self dti2|(Shift((0|0|-1))(c)|self umol) a
a|(self dz|self dzz|dh|dh|self small_debug) a
a|(1-self z_e)|(1-self z_e1) a
-self dti2|(c|self umol)|(dztmp|Shift((0|0|1))(dzztmp)|dh|dh|self small_debug) c
ee|(1-self z_h)|a|(a-1 0)|self z_h ee
gg|(1-self z_h)|(self dti2|self wusurf|(dztmp|dh)-uf)|(a-1 0)|self z_h gg
(c|Shift((0|0|1))(ggtmp)-uf)|gg gg
P Sqrt ub|ub|self AXB(self AYF vb)|self AXB(self AYF vb) tmp
self AXB cbc|P Slice(tmp|(0|0|self kbm1-1)) tps
uf uftmp
range self kbm2 k
ee|Shift((0|0|-1))(uf)|gg uf
uftmp|(1-self zslice) uf
uf|self dum uf
P Slice -tps|uf|(0|0|self kbm2) wubot
self h tmph
tmph|(1-self x_h13d)|tmp0|self x_h13d tmph
tmpu|(1-self x_e3d)|tmp0|self x_e3d tmpu
tmpu|(1-self x_h13d)|tmp0|self x_h13d tmpu
P Sqrt tmph|self hmax|self AYF(self AYB tmpu)|(1 0-P Sqrt(tmph|self hmax))|self AYF tmp
uf|(1-self x_e3d)|tmp|self x_e3d uf
uf|(1-self x_h3d)|tmp0|self x_h3d uf
uf|(1-self x_h13d)|tmp|self x_h13d uf
uf|(1-self y_he3d) uf
uf|(1-self z_e)|uftmp|self dum|self z_e uf
self AYB dhf dh
self AYB w|self AZB v tmp
vf|(1-self z_e)|(1-self x_e3d) vf
self AYB km c
c|(1-self y_h3d) c
a|(dztmp|dzztmp|dh|dh) a
gg|(1-self z_h)|(self dti2|self wvsurf|(dztmp|dh)-vf)|(a-1 0)|self z_h gg
(c|Shift((0|0|1))(ggtmp)-vf)|gg gg
P Sqrt self AYB self AXF ub|self AYB(self AXF ub)|vb|vb tmp
self AYB cbc|P Slice(tmp|(0|0|self kbm1-1)) tps
tps|(1-self x_e) tps
vf vftmp
ee|Shift((0|0|-1))(vf)|gg vf
vftmp|(1-self zslice) vf
vf|self dvm vf
P Slice -tps|vf|(0|0|self kbm2) wvbot
tmph|(1-self y_h13d)|tmp0|self y_h13d tmph
tmpv|(1-self y_e3d)|tmp0|self y_e3d tmpv
tmpv|(1-self y_h13d)|tmp0|self y_h13d tmpv
P Sqrt tmph|self hmax|self AXF(self AXB tmpv)|(1 0-P Sqrt(tmph|self hmax))|self AXF tmp
vf|(1-self y_e3d)|tmp|self y_e3d vf
vf|(1-self y_h3d)|tmp0|self y_h3d vf
vf|(1-self y_h13d)|tmp|self y_h13d vf
vf|(1-self x_he3d) vf
vf|(1-self z_e)|vftmp|self dvm|self z_e vf
u|0 5|self smoth|(uf|ub-2 0|u-self reduce_sum((uf|ub-2 0|u)|self dz|2)) u
u|(1-self z_e) u
v|0 5|self smoth|(vf|vb-2 0|v-self reduce_sum((vf|vb-2 0|v)|self dz|2)) v
u ub
uf u
v vb
vf v
dti ms-1  DT
egf egb
et etb
etf et
self h|et dt
etb|self h dhb
utf utb
vtf vtb
self vfluxf vfluxb
z_d|(1-self z_e)|self small_debug|self z_e tmpdz
dzz|(1-self z_e)|self small_debug|self z_e tmpdzz
self AZB f|w tmp
f|w tmp1
P Shape ff ff_shape
P BroadcastTo ff_shape self z_e tmp_ze
ff|(1-tmp_ze)|(1-self x_he)|(1-self y_he) ff
self mat_zeros rad
h|etf dh
P Shape kh shape_kh
-1|self dti2|(P Slice kh|(0|0|2)) tmp_kh
P Pad ((0|0)) tmp_kh
a|(1-self z_he2)|tmp_kh|self z_he2 a
a|(tmpdz|tmpdzz|dhf|dhf) a
a|self z_he2 a
P Shape c shape_c
P BroadcastTo shape_c dzz1 tmp_c_dzz1
P Slice tmp_c_dzz1|(0|0|0) tmp_c_dzz1
P Pad ((0|0)) tmp_c_dzz1
c|self z_he|tmp_c_dzz1|(1-self z_he) c
-1|self dti2|(kh|self umol)|(tmpdz|c|dhf|dhf) c
P Slice c|(0|0|1) c
P Pad ((0|0)) c
(a|(a-1))|self z_h|ee|(1-self z_h) ee
(((self dti2|wfsurf)|(tmpdz|dh)-ff)|(a-1))|self z_h|gg|(1-self z_h) gg
(1e0|(a|c|(1-Shift((0|0|1))(ee))-1e0))|self zslice gg
ee|(1-self zslice) ee
P BroadcastTo P Shape fftmp self zslice self kbm1-1 zslicetmp
ff|(1-zslicetmp)|fftmp|zslicetmp ff
ff|(1-self zslice) ff
self mat_zeros tmptb
fbe|self x_e|tmptb|(1-self x_e) tmptb
fbw|self x_h|tmptb|(1-self x_h) tmptb
fbn|self y_e|tmptb|(1-self y_e) tmptb
fbs|self y_h|tmptb|(1-self y_h) tmptb
Shift (1|0|0)(tmpu)|self x_e1|tmpu|(1-self x_e1) tmpu
Shift (1|0|0)(tmpu)|self x_h1|tmpu|(1-self x_h1) tmpu
Shift (0|1|0)(tmpv)|self y_e1|tmpv|(1-self y_e1) tmpv
Shift (0|1|0)(tmpv)|self y_h1|tmpv|(1-self y_h1) tmpv
tmp1|(1-self x_h3d) tmp1
ff|(1-self x_e3d|(1-self z_e))|tmp1|self x_e3d|(1-self z_e) ff
P Pad ((0|1)) tmp_test
P Slice tmp_test|(1|0|0) tmp_test
(1-self x_e13d)|tmp1|tmp_test|self x_e13d tmp1
tmp1|0 5|self dti|(tmpu|P Abs tmpu)|(tmpu|self small_debug)|self AZF w|dt| tmp2
self DZF self AZB f|z_d|dz|self AZB dzz
P Slice tmp2|(self imm1-1|0|1) tmp2_del_nan
P Pad ((self im-1|0)) tmp2
ff|(1-self x_e3d|self z_he3)|tmp2|self x_e3d|self z_he3 ff
ff|(1-self x_h3d|(1-self z_e))|tmp1|self x_h3d|(1-self z_e) ff
P Pad ((1|0)) tmp_test
P Slice tmp_test|(0|0|0) tmp_test
(1-self x_h13d)|tmp1|tmp_test|self x_h13d tmp1
tmp1|0 5|self dti|(u|P Abs u)|u|self AZF w|dt|self DZF(self AZB f)|self AZB dzz tmp2
P Pad ((0|self im-1)) tmp2
ff|(1-self x_h3d|self z_he3)|tmp2|self x_h3d|self z_he3 ff
ff|(1-self y_e3d|(1-self z_e))|tmp1|self y_e3d|(1-self z_e) ff
Shift (0|-1|0)(tmp1)|self y_e13d|tmp1|(1-self y_e13d) tmp1
tmp1|0 5|self dti|(tmpv|P Abs tmpv)|tmpv|self AZF w|dt|self DZF(self AZB f)|z_d tmp2
P Pad ((0|0)) tmp2
ff|(1-self y_e3d|self z_he3)|tmp2|self y_e3d|self z_he3 ff
ff|(1-self y_h3d|(1-self z_e))|tmp1|self y_h3d|(1-self z_e) ff
Shift (0|1|0)(tmp1)|self y_h13d|tmp1|(1-self y_h13d) tmp1
tmp1|0 5|self dti|(v|P Abs v)|v|self AZF w|dt|self DZF(self AZB f)|z_d| tmp2
self AZB dzz
ff|(1-self y_h3d|self z_he3)|tmp2|self y_h3d|self z_he3 ff
ff tmpff1
ff tmpff2
P Fill mstype float32|(self im|1|self kb-3) tmpzero
P Concat (tmpff1|tmpzero|tmpff2) tmpff
P Concat (tmpff|ff) ff
P Concat (ff|tmpff) ff
ff|fsm ff
f|0 5e0|self smoth|(ff|fb-2e0|f) fb
ff f
self x_d|self y_d|self z_d z_d
self q2b|self q2lb q2lb
self dx|self dy dy
w|(1-self z_h)|self z_h|self vfluxf w
range iext
self external_el x_d|y_d|d|ua|va|elb elf
self adjust_uv u|v|utb|vtb|utf|vtf|dt v
self internal_w x_d|y_d|dt|u|v|etf|etb|vfluxb w
P Assign self q2b|q2b_ q2b
P Assign self q2lb|q2lb_ q2lb
self dens s|t|self zz|self h|self fsm rho
self adjust_ufvf u|v|uf|vf|ub|vb vb
self internal_update egf|etb|utf|vtf|etf|et et
P AssignAdd self global_step|1 steps
Tensor variable dz mat_ones c
Tensor variable dz a
Tensor variable dz a
Tensor variable tb t
Tensor variable tb h dhb
Tensor variable sb s
Tensor variable ub u
Tensor variable vb v
Tensor variable uab ua
Tensor variable vab va
Tensor variable elb el
Tensor variable etb et
Tensor variable etb h dhb
Tensor variable dt 1e0 l
Tensor variable h d
Tensor variable h dt
Tensor variable h 028|(1-tmp) gh
Tensor variable h z_he) gh
Tensor variable h 0|a2|b2|18 0|a1|a2)|1 tmp
Tensor variable h 0|a1|a2)|1 tmp
Tensor variable h 41|kq)|0 5 kq
Tensor variable h 5 kh
Tensor variable h y_e)|tmp0|self fsm|self y_e kh
Tensor variable h y_h)|tmp0|self fsm|self y_h kh
Tensor variable h x_e)|tmp0|self fsm|self x_e kh
Tensor variable h x_h)|tmp0|self fsm|self x_h kh
Tensor variable h x_h)|self x_h dh
Tensor variable h y_h)|self y_h dh
Tensor variable h x_h13d)|tmp0|self x_h13d tmph
Tensor variable h a
Tensor variable h y_h13d)|tmp0|self y_h13d tmph
Tensor variable h dh
Tensor variable z AXB dt|self DXB rho-rmean|x_d tmp1
Tensor variable z AYB dt|self DYB rho-rmean|y_d tmp1
Tensor variable z z_e)|self small_debug|self z_e tmpdzz
Tensor variable z a
Tensor variable z ff
Tensor variable zz zz1
Tensor variable zz AXB dt|self DXB rho-rmean|x_d tmp1
Tensor variable zz AYB dt|self DYB rho-rmean|y_d tmp1
Tensor variable zz z_e)|self small_debug|self z_e tmpdzz
Tensor variable zz a
Tensor variable dzz mat_ones c
Tensor variable dzz a
Tensor variable dzz z_e)|self small_debug|self z_e tmpdzz
Tensor variable dzz a
Tensor variable fsm ff
Tensor np zeros [im|jm|kb]|np float32 w z_h)|self z_h|vfluxf w
Tensor np zeros [im|jm|kb]|np float32 w w
Tensor np zeros [im|jm|kb]|np float32 w -self x_he3d) w
Tensor np zeros [im|jm|kb]|np float32 w -self z_e) w
Tensor np zeros [im|jm|kb]|np float32 w tmp1
Tensor np zeros [im|jm|kb]|np float32 w x_h|tmptb|(1-self x_h) tmptb
Tensor np zeros [im|jm|kb]|np float32 w z_h)|self z_h|self vfluxf w
enumerate  self DYB self AYF self AXF u|y_d|self DXB self AXF self AYF v|x_d
enumerate  self DXB elb|x_d|self DXB elf|x_d
enumerate  self DYB elb|y_d|self DYB elf|y_d
ti|self tbias tr tr2
ti|self tbias tr tr3
ti|self tbias tr tr4
tr|tr tr2 tr3
tr2|tr tr3 tr4
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p cr
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p y_he) tmp
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p z_h)|tmp1|self z_h tmp
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p z_e) tmp
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p x_he) tmp
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p l_tmp
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p gh
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p 028|(1-tmp) gh
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p z_h)|self kappa|l0|self z_h l_tmp
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p z_e) l_tmp
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p zslice) ee
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p zslice) gg
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p zslice) q2f
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p zslice) q2lf
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p Sqrt(P Abs q2) kn
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p zslice) uf
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p a
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p zslice) vf
self grav|self rhoref|(-1|zz|self mat_ones|h)|1e-5 p ff
-0 157406e0|6 793952e-2|tr-9 095290e-3|tr2|1 001685e-4|tr3-1 120083e-6|tr4| rhor2 824493e0-4 0899e-3|tr|7 6438e-5|tr2-8 2467e-7|tr3|5 3875e-9|tr4)|sr| rhor1
rhor2|(0 824493e0-4 0899e-3|tr|7 6438e-5|tr2-8 2467e-7|tr3|5 3875e-9|tr4)|sr| rhor1 e5|cr|(1 e0-2 e0|cr) rhor
p|(cr1|cr1) cr cr
rhor1|1 e5|cr|(1 e0-2 e0|cr) rhor rhoref|fsm rhoo
P Cast cbc cbc_compare cbcmax cbc
P Cast cbc cbc_compare cbcmin cbc
cbc|(1-cbc_compare)|cbc_compare|self cbcmax cbc cbcmax cbc
cbc|(1-cbc_compare)|cbc_compare|self cbcmax cbc cbcmin cbc
cbc|(1-cbc_compare)|cbc_compare|self cbcmax cbc self cbc_init
cbc|(1-cbc_compare)|cbc_compare|self cbcmin cbc cbcmin cbc
cbc|(1-cbc_compare)|cbc_compare|self cbcmin cbc self cbc_init
self Grid dx|dy|dz z_d self z_d
self Grid dx|dy|dz z_d z_e)|self small_debug|self z_e dztmp
self Grid dx|dy|dz z_d z_e)|self small_debug|self z_e tmpdz
self rmean|(1-self z_he1)|rho|self z_he1 rmean self rmean_init
zz zz1 mat_ones c
uab ua x_h) advua
uab ua y_he) advua
uab ua 0|self AXB d|self isp2i utf
uab ua x_e1)|self uabe|self x_e1 tmpua
uab ua x_h1)|self uabw|self x_h1 tmpua
uab ua matrix_smoth|(uab-self mat_twos_2d|ua|uaf) uab
vab va y_h) advva
vab va x_he) advva
vab va 0|self AYB d|self isp2i vtf
vab va y_e1)|self vabn|self y_e1 tmpva
vab va y_h1)|self vabs|self y_h1 tmpva
vab va matrix_smoth|(vab-self mat_twos_2d|va|vaf) vab
elb el d
elb el ispi egf
elb el x_e1)|self ele|self x_e1 tmpel
elb el x_h1)|self elw|self x_h1 tmpel
elb el y_e1)|self eln|self y_e1 tmpel
elb el y_h1)|self els|self y_h1 tmpel
elb el matrix_smoth|(elb-self mat_twos_2d|el|elf) elb
elb el matrix_ispi egf
etb et etf
etb et dt
etb et etb
etb et dh
et etf 5|(1 0-0 5|self smoth)|elf etf
et etf 5|elf)|self fsm etf
et etf et
et etf dh
h|el d mat_ones c
h|el d z_e)|self small_debug|self z_e dztmp
h|el d a
h|el d z_e)|self small_debug|self z_e tmpdz
h|el d a
h|et dt 1e0 l
dt|0 1e0 l q2lb
dt|0 1e0 l sqrt q2b kh
dt|0 1e0 l ispi egf
dt|0 1e0 l x_e1)|self ele|self x_e1 tmpel
dt|0 1e0 l x_h1)|self elw|self x_h1 tmpel
dt|0 1e0 l y_e1)|self eln|self y_e1 tmpel
dt|0 1e0 l y_h1)|self els|self y_h1 tmpel
dt|0 1e0 l matrix_smoth|(elb-self mat_twos_2d|el|elf) elb
dt|0 1e0 l matrix_ispi egf
dt|0 1e0 l grav|self mat_ones l0
dt|0 1e0 l l_tmp
dt|0 1e0 l gh
dt|0 1e0 l 5|self smoth|(q2lf|q2lb-2 0|q2l) q2lb
self mat_ones|self small q2b q2lb
self mat_ones|self small q2b q2
self mat_ones|self small q2b self q2b_init
self mat_ones|self small q2b l_tmp
self mat_ones|self small q2b gh
l|q2b q2lb q2l
l|q2b q2lb self q2lb_init
l|q2b q2lb l_tmp
l|self sqrt q2b kh km
l|self sqrt q2b kh kq
l|self sqrt q2b kh 5 kh
l|self sqrt q2b kh y_e)|tmp0|self fsm|self y_e kh
l|self sqrt q2b kh y_h)|tmp0|self fsm|self y_h kh
l|self sqrt q2b kh x_e)|tmp0|self fsm|self x_e kh
l|self sqrt q2b kh x_h)|tmp0|self fsm|self x_h kh
kh km DZB(self AXF u)|z_d|self DZB(self AXF u)|z_d|self DZB(self AYF v)|z_d) kn
kh km 5 km
kh km y_e)|tmp0|self fsm|self y_e km
kh km y_h)|tmp0|self fsm|self y_h km
kh km x_e)|tmp0|self fsm|self x_e km
kh km x_h)|tmp0|self fsm|self x_h km
self mat_ones|self aam_init aam self aam_init
self mat_ones|self aam_init aam x_he3d)|self aam_init|self x_he3d aam
self mat_ones|self aam_init aam y_he3d)|self aam_init|self y_he3d aam
self mat_ones|self aam_init aam z_e)|self aam_init|self z_e aam
self mat_ones|self aam_init aam m2s-1
w|(1-self z_h)|self z_h|vfluxf w z_h)|self z_h|vfluxf w
w|(1-self z_h)|self z_h|vfluxf w w
w|(1-self z_h)|self z_h|vfluxf w -self x_he3d) w
w|(1-self z_h)|self z_h|vfluxf w -self z_e) w
w|(1-self z_h)|self z_h|vfluxf w tmp1
w|(1-self z_h)|self z_h|vfluxf w x_h|tmptb|(1-self x_h) tmptb
w|(1-self z_h)|self z_h|vfluxf w z_h)|self z_h|self vfluxf w
q2b q2 l_tmp
q2b q2 gh
q2b q2 5|self smoth|(q2f|q2b-2 0|q2) q2b
q2lb q2l 5|self smoth|(q2lf|q2lb-2 0|q2l) q2lb
tb t w
tb t l_tmp
tb t 028|(1-tmp) gh
tb t a
sb s DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp
sb s AXB dt|self DXB rho-rmean|x_d tmp1
sb s DZB zz|self DYB(self AZB rho-rmean)|y_d|self AYB dt| tmp
sb s AYB dt|self DYB rho-rmean|y_d tmp1
sb s ispi egf
sb s fsm elf
sb s dum uaf
sb s dvm vaf
sb s matrix_smoth|(uab-self mat_twos_2d|ua|uaf) uab
sb s matrix_smoth|(vab-self mat_twos_2d|va|vaf) vab
sb s matrix_smoth|(elb-self mat_twos_2d|el|elf) elb
sb s matrix_ispi egf
sb s mat_twos_2d|ua|self AXB d|self matrix_isp2i utf
sb s mat_twos_2d|va|self AYB d|self matrix_isp2i vtf
sb s mat_ones c
sb s grav|self mat_ones l0
sb s DZB(self AXF u)|z_d|self DZB(self AXF u)|z_d|self DZB(self AYF v)|z_d) kn
sb s z_he) filters
sb s matrix_small|filters q2f
sb s 41|kq)|0 5 kq
sb s 5 km
sb s 5 kh
sb s fsm|1 e-10 q2f
sb s fsm|1 e-10 q2lf
sb s dum uf
sb s x_e) tps
sb s dvm vf
sb s h dhb
sb s dti2|(P Slice kh|(0|0|2)) tmp_kh
sb s z_he2 a
sb s z_he|tmp_c_dzz1|(1-self z_he) c
sb s dti2|(kh|self umol)|(tmpdz|c|dhf|dhf) c
sb s z_h|ee|(1-self z_h) ee
sb s zslice gg
sb s x_e|tmptb|(1-self x_e) tmptb
sb s x_h|tmptb|(1-self x_h) tmptb
sb s y_e|tmptb|(1-self y_e) tmptb
sb s y_h|tmptb|(1-self y_h) tmptb
ub u x_h3d) u
ub u -self z_e) u
ub u grav|self mat_ones l0
ub u tmpu
ub u x_h)|tmp0|self x_h tmpu
ub u y_h)|tmp0|self y_h tmpu
ub u x_e3d)|tmp0|self x_e3d tmpu
ub u x_h13d)|tmp0|self x_h13d tmpu
ub u 5|self smoth|(uf|ub-2 0|u-self reduce_sum((uf|ub-2 0|u)|self dz|2)) u
ub u z_e) u
ub u ub
vb v y_h3d) v
vb v z_e) v
vb v tmpv
vb v y_e3d)|tmp0|self y_e3d tmpv
vb v y_h13d)|tmp0|self y_h13d tmpv
vb v 5|self smoth|(vf|vb-2 0|v-self reduce_sum((vf|vb-2 0|v)|self dz|2)) v
vb v vb
self bottom_friction zz1|h cbc self cbc_init
(Tensor(z_k)) self zslice ff
self dte|self isplit self dti ms-1 DT
self dte|self isplit self dti ms-1  DT
self AXF self AXB dt|u|self AXF u-(dt|aam|2e0|self DXF ub|x_d) tmp23 0-self x_he) tmp23
tmp23|(1 0-self x_he) tmp23 0-self x_he) tmp23
self AXB curv|dt|self AYF v y_h3d) v
self AXB curv|dt|self AYF v z_e) v
self AXB curv|dt|self AYF v tmpv
self AXB curv|dt|self AYF v y_e3d)|tmp0|self y_e3d tmpv
self AXB curv|dt|self AYF v y_h13d)|tmp0|self y_h13d tmpv
self AXB curv|dt|self AYF v 5|self smoth|(vf|vb-2 0|v-self reduce_sum((vf|vb-2 0|v)|self dz|2)) v
self AXB curv|dt|self AYF v vb
advx|(1-self x_h)|(1-self y_he) advx x_h)|(1-self y_he) advx
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp y_he) tmp
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp z_h)|tmp1|self z_h tmp
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp z_e) tmp
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp x_he) tmp
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp w
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp l_tmp
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp gh
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp 028|(1-tmp) gh
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp z_h)|self kappa|l0|self z_h l_tmp
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp z_e) l_tmp
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp zslice) ee
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp zslice) gg
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp zslice) q2f
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp zslice) q2lf
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp Sqrt(P Abs q2) kn
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp zslice) uf
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp a
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp zslice) vf
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp a
self AYF self AYB dt|v|self AYF v-dt|aam|2e0|self DYF vb|y_d tmp ff
tmp|(1-self y_he) tmp y_he) tmp
tmp|(1-self y_he) tmp z_h)|tmp1|self z_h tmp
tmp|(1-self y_he) tmp z_e) tmp
tmp|(1-self y_he) tmp x_he) tmp
tmp|(1-self y_he) tmp w
tmp|(1-self y_he) tmp l_tmp
tmp|(1-self y_he) tmp gh
tmp|(1-self y_he) tmp 028|(1-tmp) gh
tmp|(1-self y_he) tmp z_h)|self kappa|l0|self z_h l_tmp
tmp|(1-self y_he) tmp z_e) l_tmp
tmp|(1-self y_he) tmp zslice) ee
tmp|(1-self y_he) tmp zslice) gg
tmp|(1-self y_he) tmp zslice) q2f
tmp|(1-self y_he) tmp zslice) q2lf
tmp|(1-self y_he) tmp Sqrt(P Abs q2) kn
tmp|(1-self y_he) tmp zslice) uf
tmp|(1-self y_he) tmp a
tmp|(1-self y_he) tmp zslice) vf
tmp|(1-self y_he) tmp a
tmp|(1-self y_he) tmp ff
self AYB curv|dt|self AXF u x_h3d) u
self AYB curv|dt|self AXF u -self z_e) u
self AYB curv|dt|self AXF u grav|self mat_ones l0
self AYB curv|dt|self AXF u tmpu
self AYB curv|dt|self AXF u x_h)|tmp0|self x_h tmpu
self AYB curv|dt|self AXF u y_h)|tmp0|self y_h tmpu
self AYB curv|dt|self AXF u x_e3d)|tmp0|self x_e3d tmpu
self AYB curv|dt|self AXF u x_h13d)|tmp0|self x_h13d tmpu
self AYB curv|dt|self AXF u 5|self smoth|(uf|ub-2 0|u-self reduce_sum((uf|ub-2 0|u)|self dz|2)) u
self AYB curv|dt|self AXF u z_e) u
self AYB curv|dt|self AXF u ub
advy|(1-self y_h)|(1-self x_he) advy y_h)|(1-self x_he) advy
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp z_h)|tmp1|self z_h tmp
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp z_e) tmp
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp x_he) tmp
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp w
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp l_tmp
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp gh
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp 028|(1-tmp) gh
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp z_h)|self kappa|l0|self z_h l_tmp
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp z_e) l_tmp
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp zslice) ee
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp zslice) gg
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp zslice) q2f
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp zslice) q2lf
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp Sqrt(P Abs q2) kn
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp zslice) uf
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp a
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp zslice) vf
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp a
-1|self DZB zz|self DXB(self AZB rho-rmean)|x_d|self AXB dt tmp ff
self DXB dt|x_d|self DZB self AXB rho-rmean|z_d|self AZB zz|self AZB dz mat_ones c
self DXB dt|x_d|self DZB self AXB rho-rmean|z_d|self AZB zz|self AZB dz a
self DXB dt|x_d|self DZB self AXB rho-rmean|z_d|self AZB zz|self AZB dz a
-1|zz|self AXB dt|self DXB rho-rmean|x_d tmp1 x_h3d) tmp1
-1|zz|self AXB dt|self DXB rho-rmean|x_d tmp1 5|self dti|(tmpu|P Abs tmpu)|(tmpu|self small_debug)|self AZF w|dt| tmp2
-1|zz|self AXB dt|self DXB rho-rmean|x_d tmp1 5|self dti|(u|P Abs u)|u|self AZF w|dt|self DZF(self AZB f)|self AZB dzz tmp2
-1|zz|self AXB dt|self DXB rho-rmean|x_d tmp1 5|self dti|(tmpv|P Abs tmpv)|tmpv|self AZF w|dt|self DZF(self AZB f)|z_d tmp2
-1|zz|self AXB dt|self DXB rho-rmean|x_d tmp1 5|self dti|(v|P Abs v)|v|self AZF w|dt|self DZF(self AZB f)|z_d| tmp2
tmp|(1-self z_h)|tmp1|self z_h tmp z_h)|tmp1|self z_h tmp
tmp|(1-self z_h)|tmp1|self z_h tmp z_e) tmp
tmp|(1-self z_h)|tmp1|self z_h tmp x_he) tmp
tmp|(1-self z_h)|tmp1|self z_h tmp w
tmp|(1-self z_h)|tmp1|self z_h tmp l_tmp
tmp|(1-self z_h)|tmp1|self z_h tmp gh
tmp|(1-self z_h)|tmp1|self z_h tmp 028|(1-tmp) gh
tmp|(1-self z_h)|tmp1|self z_h tmp z_h)|self kappa|l0|self z_h l_tmp
tmp|(1-self z_h)|tmp1|self z_h tmp z_e) l_tmp
tmp|(1-self z_h)|tmp1|self z_h tmp zslice) ee
tmp|(1-self z_h)|tmp1|self z_h tmp zslice) gg
tmp|(1-self z_h)|tmp1|self z_h tmp zslice) q2f
tmp|(1-self z_h)|tmp1|self z_h tmp zslice) q2lf
tmp|(1-self z_h)|tmp1|self z_h tmp Sqrt(P Abs q2) kn
tmp|(1-self z_h)|tmp1|self z_h tmp zslice) uf
tmp|(1-self z_h)|tmp1|self z_h tmp a
tmp|(1-self z_h)|tmp1|self z_h tmp zslice) vf
tmp|(1-self z_h)|tmp1|self z_h tmp a
tmp|(1-self z_h)|tmp1|self z_h tmp ff
tmp|(1-self z_e) tmp z_e) tmp
tmp|(1-self z_e) tmp x_he) tmp
tmp|(1-self z_e) tmp w
tmp|(1-self z_e) tmp l_tmp
tmp|(1-self z_e) tmp gh
tmp|(1-self z_e) tmp 028|(1-tmp) gh
tmp|(1-self z_e) tmp z_h)|self kappa|l0|self z_h l_tmp
tmp|(1-self z_e) tmp z_e) l_tmp
tmp|(1-self z_e) tmp zslice) ee
tmp|(1-self z_e) tmp zslice) gg
tmp|(1-self z_e) tmp zslice) q2f
tmp|(1-self z_e) tmp zslice) q2lf
tmp|(1-self z_e) tmp Sqrt(P Abs q2) kn
tmp|(1-self z_e) tmp zslice) uf
tmp|(1-self z_e) tmp a
tmp|(1-self z_e) tmp zslice) vf
tmp|(1-self z_e) tmp a
tmp|(1-self z_e) tmp ff
self ramp|self grav|self AXB dt|self csum tmp|2|dum drhox z_e) drhox
drhox|(1-self z_e) drhox z_e) drhox
-1|self DZB zz|self DYB(self AZB rho-rmean)|y_d|self AYB dt| tmp x_he) tmp
-1|self DZB zz|self DYB(self AZB rho-rmean)|y_d|self AYB dt| tmp w
-1|self DZB zz|self DYB(self AZB rho-rmean)|y_d|self AYB dt| tmp l_tmp
-1|self DZB zz|self DYB(self AZB rho-rmean)|y_d|self AYB dt| tmp gh
-1|self DZB zz|self DYB(self AZB rho-rmean)|y_d|self AYB dt| tmp 028|(1-tmp) gh
-1|self DZB zz|self DYB(self AZB rho-rmean)|y_d|self AYB dt| tmp z_h)|self kappa|l0|self z_h l_tmp
-1|self DZB zz|self DYB(self AZB rho-rmean)|y_d|self AYB dt| tmp z_e) l_tmp
-1|self DZB zz|self DYB(self AZB rho-rmean)|y_d|self AYB dt| tmp zslice) ee
-1|self DZB zz|self DYB(self AZB rho-rmean)|y_d|self AYB dt| tmp zslice) gg
-1|self DZB zz|self DYB(self AZB rho-rmean)|y_d|self AYB dt| tmp zslice) q2f
-1|self DZB zz|self DYB(self AZB rho-rmean)|y_d|self AYB dt| tmp zslice) q2lf
-1|self DZB zz|self DYB(self AZB rho-rmean)|y_d|self AYB dt| tmp Sqrt(P Abs q2) kn
-1|self DZB zz|self DYB(self AZB rho-rmean)|y_d|self AYB dt| tmp zslice) uf
-1|self DZB zz|self DYB(self AZB rho-rmean)|y_d|self AYB dt| tmp a
-1|self DZB zz|self DYB(self AZB rho-rmean)|y_d|self AYB dt| tmp zslice) vf
-1|self DZB zz|self DYB(self AZB rho-rmean)|y_d|self AYB dt| tmp a
-1|self DZB zz|self DYB(self AZB rho-rmean)|y_d|self AYB dt| tmp ff
self DYB dt|y_d|self DZB self AYB rho-rmean|z_d|self AZB zz|self AZB dz mat_ones c
self DYB dt|y_d|self DZB self AYB rho-rmean|z_d|self AZB zz|self AZB dz a
self DYB dt|y_d|self DZB self AYB rho-rmean|z_d|self AZB zz|self AZB dz a
-1|zz|self AYB dt|self DYB rho-rmean|y_d tmp1 x_h3d) tmp1
-1|zz|self AYB dt|self DYB rho-rmean|y_d tmp1 5|self dti|(tmpu|P Abs tmpu)|(tmpu|self small_debug)|self AZF w|dt| tmp2
-1|zz|self AYB dt|self DYB rho-rmean|y_d tmp1 5|self dti|(u|P Abs u)|u|self AZF w|dt|self DZF(self AZB f)|self AZB dzz tmp2
-1|zz|self AYB dt|self DYB rho-rmean|y_d tmp1 5|self dti|(tmpv|P Abs tmpv)|tmpv|self AZF w|dt|self DZF(self AZB f)|z_d tmp2
-1|zz|self AYB dt|self DYB rho-rmean|y_d tmp1 5|self dti|(v|P Abs v)|v|self AZF w|dt|self DZF(self AZB f)|z_d| tmp2
self ramp|self grav|self AYB dt|self csum tmp|2|dvm drhoy z_e) drhoy
drhoy|(1-self z_e) drhoy z_e) drhoy
self horcon|dx|dy|self sqrt aam x_he3d)|self aam_init|self x_he3d aam
self horcon|dx|dy|self sqrt aam y_he3d)|self aam_init|self y_he3d aam
self horcon|dx|dy|self sqrt aam z_e)|self aam_init|self z_e aam
self horcon|dx|dy|self sqrt aam m2s-1
self DXF u|x_d|self DXF u|x_d|self DYF v|y_d|self DYF v y_h3d) v
self DXF u|x_d|self DXF u|x_d|self DYF v|y_d|self DYF v z_e) v
self DXF u|x_d|self DXF u|x_d|self DYF v|y_d|self DYF v tmpv
self DXF u|x_d|self DXF u|x_d|self DYF v|y_d|self DYF v y_e3d)|tmp0|self y_e3d tmpv
self DXF u|x_d|self DXF u|x_d|self DYF v|y_d|self DYF v y_h13d)|tmp0|self y_h13d tmpv
self DXF u|x_d|self DXF u|x_d|self DYF v|y_d|self DYF v 5|self smoth|(vf|vb-2 0|v-self reduce_sum((vf|vb-2 0|v)|self dz|2)) v
self DXF u|x_d|self DXF u|x_d|self DYF v|y_d|self DYF v vb
 self DYB self AYF self AXF u|y_d|self DXB self AXF self AYF  self DYB self AYF self AXF u|y_d|self DXB self AXF self AYF v|x_d
 self DYB self AYF self AXF u|y_d|self DXB self AXF self AYF  self DXB elb|x_d|self DXB elf|x_d
 self DYB self AYF self AXF u|y_d|self DXB self AXF self AYF  self DYB elb|y_d|self DYB elf|y_d
 self DYB self AYF self AXF u|y_d|self DXB self AXF self AYF v tmpv
 self DYB self AYF self AXF u|y_d|self DXB self AXF self AYF v vb
aam|(1-self x_he3d)|self aam_init|self x_he3d aam x_he3d)|self aam_init|self x_he3d aam
aam|(1-self x_he3d)|self aam_init|self x_he3d aam y_he3d)|self aam_init|self y_he3d aam
aam|(1-self x_he3d)|self aam_init|self x_he3d aam z_e)|self aam_init|self z_e aam
aam|(1-self x_he3d)|self aam_init|self x_he3d aam m2s-1
aam|(1-self y_he3d)|self aam_init|self y_he3d aam y_he3d)|self aam_init|self y_he3d aam
aam|(1-self y_he3d)|self aam_init|self y_he3d aam z_e)|self aam_init|self z_e aam
aam|(1-self y_he3d)|self aam_init|self y_he3d aam m2s-1
aam|(1-self z_e)|self aam_init|self z_e aam z_e)|self aam_init|self z_e aam
aam|(1-self z_e)|self aam_init|self z_e aam m2s-1
self AYB self AXB d|self AXB(self AYB aam2d)|(self DYB uab|y_d|self DXB vab|x_d) tps x_e) tps
self AXF self AXB d|ua|self AXF ua-2 |d|aam2d| tmp x_he) tmp
self AXF self AXB d|ua|self AXF ua-2 |d|aam2d| tmp w
self AXF self AXB d|ua|self AXF ua-2 |d|aam2d| tmp l_tmp
self AXF self AXB d|ua|self AXF ua-2 |d|aam2d| tmp gh
self AXF self AXB d|ua|self AXF ua-2 |d|aam2d| tmp 028|(1-tmp) gh
self AXF self AXB d|ua|self AXF ua-2 |d|aam2d| tmp z_h)|self kappa|l0|self z_h l_tmp
self AXF self AXB d|ua|self AXF ua-2 |d|aam2d| tmp z_e) l_tmp
self AXF self AXB d|ua|self AXF ua-2 |d|aam2d| tmp zslice) ee
self AXF self AXB d|ua|self AXF ua-2 |d|aam2d| tmp zslice) gg
self AXF self AXB d|ua|self AXF ua-2 |d|aam2d| tmp zslice) q2f
self AXF self AXB d|ua|self AXF ua-2 |d|aam2d| tmp zslice) q2lf
self AXF self AXB d|ua|self AXF ua-2 |d|aam2d| tmp Sqrt(P Abs q2) kn
self AXF self AXB d|ua|self AXF ua-2 |d|aam2d| tmp zslice) uf
self AXF self AXB d|ua|self AXF ua-2 |d|aam2d| tmp a
self AXF self AXB d|ua|self AXF ua-2 |d|aam2d| tmp zslice) vf
self AXF self AXB d|ua|self AXF ua-2 |d|aam2d| tmp a
self AXF self AXB d|ua|self AXF ua-2 |d|aam2d| tmp ff
tmp|(1-self x_he) tmp x_he) tmp
tmp|(1-self x_he) tmp w
tmp|(1-self x_he) tmp l_tmp
tmp|(1-self x_he) tmp gh
tmp|(1-self x_he) tmp 028|(1-tmp) gh
tmp|(1-self x_he) tmp z_h)|self kappa|l0|self z_h l_tmp
tmp|(1-self x_he) tmp z_e) l_tmp
tmp|(1-self x_he) tmp zslice) ee
tmp|(1-self x_he) tmp zslice) gg
tmp|(1-self x_he) tmp zslice) q2f
tmp|(1-self x_he) tmp zslice) q2lf
tmp|(1-self x_he) tmp Sqrt(P Abs q2) kn
tmp|(1-self x_he) tmp zslice) uf
tmp|(1-self x_he) tmp a
tmp|(1-self x_he) tmp zslice) vf
tmp|(1-self x_he) tmp a
tmp|(1-self x_he) tmp ff
self DXB tmp|x_d|self DYF(self AXB(self AYB d|va)|self AYB ua-tps)|y_d advua x_h) advua
self DXB tmp|x_d|self DYF(self AXB(self AYB d|va)|self AYB ua-tps)|y_d advua y_he) advua
advua|(1-self x_h) advua x_h) advua
advua|(1-self x_h) advua y_he) advua
advua|(1-self y_he) advua y_he) advua
self AYF self AYB d|va|self AYF va-2 |d|aam2d|self DYF vab|y_d tmp w
self AYF self AYB d|va|self AYF va-2 |d|aam2d|self DYF vab|y_d tmp l_tmp
self AYF self AYB d|va|self AYF va-2 |d|aam2d|self DYF vab|y_d tmp gh
self AYF self AYB d|va|self AYF va-2 |d|aam2d|self DYF vab|y_d tmp 028|(1-tmp) gh
self AYF self AYB d|va|self AYF va-2 |d|aam2d|self DYF vab|y_d tmp z_h)|self kappa|l0|self z_h l_tmp
self AYF self AYB d|va|self AYF va-2 |d|aam2d|self DYF vab|y_d tmp z_e) l_tmp
self AYF self AYB d|va|self AYF va-2 |d|aam2d|self DYF vab|y_d tmp zslice) ee
self AYF self AYB d|va|self AYF va-2 |d|aam2d|self DYF vab|y_d tmp zslice) gg
self AYF self AYB d|va|self AYF va-2 |d|aam2d|self DYF vab|y_d tmp zslice) q2f
self AYF self AYB d|va|self AYF va-2 |d|aam2d|self DYF vab|y_d tmp zslice) q2lf
self AYF self AYB d|va|self AYF va-2 |d|aam2d|self DYF vab|y_d tmp Sqrt(P Abs q2) kn
self AYF self AYB d|va|self AYF va-2 |d|aam2d|self DYF vab|y_d tmp zslice) uf
self AYF self AYB d|va|self AYF va-2 |d|aam2d|self DYF vab|y_d tmp a
self AYF self AYB d|va|self AYF va-2 |d|aam2d|self DYF vab|y_d tmp zslice) vf
self AYF self AYB d|va|self AYF va-2 |d|aam2d|self DYF vab|y_d tmp a
self AYF self AYB d|va|self AYF va-2 |d|aam2d|self DYF vab|y_d tmp ff
self DXF self AYB self AXB d|ua|self AXB va-tps|x_d|self DYB tmp|y_d advva y_h) advva
self DXF self AYB self AXB d|ua|self AXB va-tps|x_d|self DYB tmp|y_d advva x_he) advva
advva|(1-self y_h) advva y_h) advva
advva|(1-self y_h) advva x_he) advva
advva|(1-self x_he) advva x_he) advva
el|self ispi egf matrix_ispi egf
el|self ispi egf egb
ua|2 0|self AXB d|self isp2i utf mat_twos_2d|ua|self AXB d|self matrix_isp2i utf
ua|2 0|self AXB d|self isp2i utf utb
va|2 0|self AYB d|self isp2i vtf mat_twos_2d|va|self AYB d|self matrix_isp2i vtf
va|2 0|self AYB d|self isp2i vtf vtb
P Pad ((0|1)) tmp w
P Pad ((0|1)) tmp l_tmp
P Pad ((0|1)) tmp gh
P Pad ((0|1)) tmp 028|(1-tmp) gh
P Pad ((0|1)) tmp z_h)|self kappa|l0|self z_h l_tmp
P Pad ((0|1)) tmp z_e) l_tmp
P Pad ((0|1)) tmp zslice) ee
P Pad ((0|1)) tmp zslice) gg
P Pad ((0|1)) tmp zslice) q2f
P Pad ((0|1)) tmp zslice) q2lf
P Pad ((0|1)) tmp Sqrt(P Abs q2) kn
P Pad ((0|1)) tmp zslice) uf
P Pad ((0|1)) tmp a
P Pad ((0|1)) tmp zslice) vf
P Pad ((0|1)) tmp a
P Pad ((0|1)) tmp ff
P Slice tmp|(1|0|0) tmp w
P Slice tmp|(1|0|0) tmp l_tmp
P Slice tmp|(1|0|0) tmp gh
P Slice tmp|(1|0|0) tmp 028|(1-tmp) gh
P Slice tmp|(1|0|0) tmp z_h)|self kappa|l0|self z_h l_tmp
P Slice tmp|(1|0|0) tmp z_e) l_tmp
P Slice tmp|(1|0|0) tmp zslice) ee
P Slice tmp|(1|0|0) tmp zslice) gg
P Slice tmp|(1|0|0) tmp zslice) q2f
P Slice tmp|(1|0|0) tmp zslice) q2lf
P Slice tmp|(1|0|0) tmp Sqrt(P Abs q2) kn
P Slice tmp|(1|0|0) tmp zslice) uf
P Slice tmp|(1|0|0) tmp a
P Slice tmp|(1|0|0) tmp zslice) vf
P Slice tmp|(1|0|0) tmp a
P Slice tmp|(1|0|0) tmp ff
elf|(1-self x_h)|tmp|self x_h elf x_h)|tmp|self x_h elf
elf|(1-self x_h)|tmp|self x_h elf x_e)|tmp|self x_e elf
elf|(1-self x_h)|tmp|self x_h elf y_h)|tmp|self y_h elf
elf|(1-self x_h)|tmp|self x_h elf y_e)|tmp|self y_e elf
elf|(1-self x_h)|tmp|self x_h elf fsm elf
P Pad ((1|0)) tmp w
P Pad ((1|0)) tmp l_tmp
P Pad ((1|0)) tmp gh
P Pad ((1|0)) tmp 028|(1-tmp) gh
P Pad ((1|0)) tmp z_h)|self kappa|l0|self z_h l_tmp
P Pad ((1|0)) tmp z_e) l_tmp
P Pad ((1|0)) tmp zslice) ee
P Pad ((1|0)) tmp zslice) gg
P Pad ((1|0)) tmp zslice) q2f
P Pad ((1|0)) tmp zslice) q2lf
P Pad ((1|0)) tmp Sqrt(P Abs q2) kn
P Pad ((1|0)) tmp zslice) uf
P Pad ((1|0)) tmp a
P Pad ((1|0)) tmp zslice) vf
P Pad ((1|0)) tmp a
P Pad ((1|0)) tmp ff
P Slice tmp|(0|0|0) tmp w
P Slice tmp|(0|0|0) tmp l_tmp
P Slice tmp|(0|0|0) tmp gh
P Slice tmp|(0|0|0) tmp 028|(1-tmp) gh
P Slice tmp|(0|0|0) tmp z_h)|self kappa|l0|self z_h l_tmp
P Slice tmp|(0|0|0) tmp z_e) l_tmp
P Slice tmp|(0|0|0) tmp zslice) ee
P Slice tmp|(0|0|0) tmp zslice) gg
P Slice tmp|(0|0|0) tmp zslice) q2f
P Slice tmp|(0|0|0) tmp zslice) q2lf
P Slice tmp|(0|0|0) tmp Sqrt(P Abs q2) kn
P Slice tmp|(0|0|0) tmp zslice) uf
P Slice tmp|(0|0|0) tmp a
P Slice tmp|(0|0|0) tmp zslice) vf
P Slice tmp|(0|0|0) tmp a
P Slice tmp|(0|0|0) tmp ff
elf|(1-self x_e)|tmp|self x_e elf x_e)|tmp|self x_e elf
elf|(1-self x_e)|tmp|self x_e elf y_h)|tmp|self y_h elf
elf|(1-self x_e)|tmp|self x_e elf y_e)|tmp|self y_e elf
elf|(1-self x_e)|tmp|self x_e elf fsm elf
P Pad ((0|0)) tmp w
P Pad ((0|0)) tmp l_tmp
P Pad ((0|0)) tmp gh
P Pad ((0|0)) tmp 028|(1-tmp) gh
P Pad ((0|0)) tmp z_h)|self kappa|l0|self z_h l_tmp
P Pad ((0|0)) tmp z_e) l_tmp
P Pad ((0|0)) tmp zslice) ee
P Pad ((0|0)) tmp zslice) gg
P Pad ((0|0)) tmp zslice) q2f
P Pad ((0|0)) tmp zslice) q2lf
P Pad ((0|0)) tmp Sqrt(P Abs q2) kn
P Pad ((0|0)) tmp zslice) uf
P Pad ((0|0)) tmp a
P Pad ((0|0)) tmp zslice) vf
P Pad ((0|0)) tmp a
P Pad ((0|0)) tmp ff
P Slice tmp|(0|1|0) tmp w
P Slice tmp|(0|1|0) tmp l_tmp
P Slice tmp|(0|1|0) tmp gh
P Slice tmp|(0|1|0) tmp 028|(1-tmp) gh
P Slice tmp|(0|1|0) tmp z_h)|self kappa|l0|self z_h l_tmp
P Slice tmp|(0|1|0) tmp z_e) l_tmp
P Slice tmp|(0|1|0) tmp zslice) ee
P Slice tmp|(0|1|0) tmp zslice) gg
P Slice tmp|(0|1|0) tmp zslice) q2f
P Slice tmp|(0|1|0) tmp zslice) q2lf
P Slice tmp|(0|1|0) tmp Sqrt(P Abs q2) kn
P Slice tmp|(0|1|0) tmp zslice) uf
P Slice tmp|(0|1|0) tmp a
P Slice tmp|(0|1|0) tmp zslice) vf
P Slice tmp|(0|1|0) tmp a
P Slice tmp|(0|1|0) tmp ff
elf|(1-self y_h)|tmp|self y_h elf y_h)|tmp|self y_h elf
elf|(1-self y_h)|tmp|self y_h elf y_e)|tmp|self y_e elf
elf|(1-self y_h)|tmp|self y_h elf fsm elf
elf|(1-self y_e)|tmp|self y_e elf y_e)|tmp|self y_e elf
elf|(1-self y_e)|tmp|self y_e elf fsm elf
elf|self fsm elf fsm elf
self AXF self AXB d|ua|self AXF ua-self mat_twos_2d|d|aam2d|self DXF uab|x_d tmp w
self AXF self AXB d|ua|self AXF ua-self mat_twos_2d|d|aam2d|self DXF uab|x_d tmp l_tmp
self AXF self AXB d|ua|self AXF ua-self mat_twos_2d|d|aam2d|self DXF uab|x_d tmp gh
self AXF self AXB d|ua|self AXF ua-self mat_twos_2d|d|aam2d|self DXF uab|x_d tmp 028|(1-tmp) gh
self AXF self AXB d|ua|self AXF ua-self mat_twos_2d|d|aam2d|self DXF uab|x_d tmp z_h)|self kappa|l0|self z_h l_tmp
self AXF self AXB d|ua|self AXF ua-self mat_twos_2d|d|aam2d|self DXF uab|x_d tmp z_e) l_tmp
self AXF self AXB d|ua|self AXF ua-self mat_twos_2d|d|aam2d|self DXF uab|x_d tmp zslice) ee
self AXF self AXB d|ua|self AXF ua-self mat_twos_2d|d|aam2d|self DXF uab|x_d tmp zslice) gg
self AXF self AXB d|ua|self AXF ua-self mat_twos_2d|d|aam2d|self DXF uab|x_d tmp zslice) q2f
self AXF self AXB d|ua|self AXF ua-self mat_twos_2d|d|aam2d|self DXF uab|x_d tmp zslice) q2lf
self AXF self AXB d|ua|self AXF ua-self mat_twos_2d|d|aam2d|self DXF uab|x_d tmp Sqrt(P Abs q2) kn
self AXF self AXB d|ua|self AXF ua-self mat_twos_2d|d|aam2d|self DXF uab|x_d tmp zslice) uf
self AXF self AXB d|ua|self AXF ua-self mat_twos_2d|d|aam2d|self DXF uab|x_d tmp a
self AXF self AXB d|ua|self AXF ua-self mat_twos_2d|d|aam2d|self DXF uab|x_d tmp zslice) vf
self AXF self AXB d|ua|self AXF ua-self mat_twos_2d|d|aam2d|self DXF uab|x_d tmp a
self AXF self AXB d|ua|self AXF ua-self mat_twos_2d|d|aam2d|self DXF uab|x_d tmp ff
self AXB d mat_ones c
self AXB d z_e)|self small_debug|self z_e dztmp
self AXB d a
self AXB d z_e)|self small_debug|self z_e tmpdz
self AXB d a
 self DXB elb|x_d|self DXB  self DXB elb|x_d|self DXB elf|x_d
 self DXB elb|x_d|self DXB  self DYB elb|y_d|self DYB elf|y_d
self mat_zeros_im_jm_1 tmpua x_e1)|self uabe|self x_e1 tmpua
self mat_zeros_im_jm_1 tmpua x_h1)|self uabw|self x_h1 tmpua
self mat_zeros_im_jm_1 tmpel x_e1)|self ele|self x_e1 tmpel
self mat_zeros_im_jm_1 tmpel x_h1)|self elw|self x_h1 tmpel
self mat_zeros_im_jm_1 tmpel y_e1)|self eln|self y_e1 tmpel
self mat_zeros_im_jm_1 tmpel y_h1)|self els|self y_h1 tmpel
tmpua|(1-self x_e1)|self uabe|self x_e1 tmpua x_e1)|self uabe|self x_e1 tmpua
tmpua|(1-self x_e1)|self uabe|self x_e1 tmpua x_h1)|self uabw|self x_h1 tmpua
tmpua|(1-self x_h1)|self uabw|self x_h1 tmpua x_h1)|self uabw|self x_h1 tmpua
tmpel|(1-self x_e1)|self ele|self x_e1 tmpel x_e1)|self ele|self x_e1 tmpel
tmpel|(1-self x_e1)|self ele|self x_e1 tmpel x_h1)|self elw|self x_h1 tmpel
tmpel|(1-self x_e1)|self ele|self x_e1 tmpel y_e1)|self eln|self y_e1 tmpel
tmpel|(1-self x_e1)|self ele|self x_e1 tmpel y_h1)|self els|self y_h1 tmpel
tmpel|(1-self x_h1)|self elw|self x_h1 tmpel x_h1)|self elw|self x_h1 tmpel
tmpel|(1-self x_h1)|self elw|self x_h1 tmpel y_e1)|self eln|self y_e1 tmpel
tmpel|(1-self x_h1)|self elw|self x_h1 tmpel y_h1)|self els|self y_h1 tmpel
self matrix_ramp|(tmpua|self rfe|P Sqrt(self grav|self h)|(el-tmpel)) tmp w
self matrix_ramp|(tmpua|self rfe|P Sqrt(self grav|self h)|(el-tmpel)) tmp l_tmp
self matrix_ramp|(tmpua|self rfe|P Sqrt(self grav|self h)|(el-tmpel)) tmp gh
self matrix_ramp|(tmpua|self rfe|P Sqrt(self grav|self h)|(el-tmpel)) tmp 028|(1-tmp) gh
self matrix_ramp|(tmpua|self rfe|P Sqrt(self grav|self h)|(el-tmpel)) tmp z_h)|self kappa|l0|self z_h l_tmp
self matrix_ramp|(tmpua|self rfe|P Sqrt(self grav|self h)|(el-tmpel)) tmp z_e) l_tmp
self matrix_ramp|(tmpua|self rfe|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) ee
self matrix_ramp|(tmpua|self rfe|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) gg
self matrix_ramp|(tmpua|self rfe|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) q2f
self matrix_ramp|(tmpua|self rfe|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) q2lf
self matrix_ramp|(tmpua|self rfe|P Sqrt(self grav|self h)|(el-tmpel)) tmp Sqrt(P Abs q2) kn
self matrix_ramp|(tmpua|self rfe|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) uf
self matrix_ramp|(tmpua|self rfe|P Sqrt(self grav|self h)|(el-tmpel)) tmp a
self matrix_ramp|(tmpua|self rfe|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) vf
self matrix_ramp|(tmpua|self rfe|P Sqrt(self grav|self h)|(el-tmpel)) tmp a
self matrix_ramp|(tmpua|self rfe|P Sqrt(self grav|self h)|(el-tmpel)) tmp ff
uaf|(1-self x_e)|tmp0|self x_e uaf x_e)|tmp0|self x_e uaf
uaf|(1-self x_e)|tmp0|self x_e uaf x_h1)|tmp|self x_h1 uaf
uaf|(1-self x_e)|tmp0|self x_e uaf x_h)|tmp0|self x_h uaf
uaf|(1-self x_e)|tmp0|self x_e uaf y_he) uaf
uaf|(1-self x_e)|tmp0|self x_e uaf dum uaf
self matrix_ramp|(tmpua-self rfw|P Sqrt(self grav|self h)|(el-tmpel)) tmp w
self matrix_ramp|(tmpua-self rfw|P Sqrt(self grav|self h)|(el-tmpel)) tmp l_tmp
self matrix_ramp|(tmpua-self rfw|P Sqrt(self grav|self h)|(el-tmpel)) tmp gh
self matrix_ramp|(tmpua-self rfw|P Sqrt(self grav|self h)|(el-tmpel)) tmp 028|(1-tmp) gh
self matrix_ramp|(tmpua-self rfw|P Sqrt(self grav|self h)|(el-tmpel)) tmp z_h)|self kappa|l0|self z_h l_tmp
self matrix_ramp|(tmpua-self rfw|P Sqrt(self grav|self h)|(el-tmpel)) tmp z_e) l_tmp
self matrix_ramp|(tmpua-self rfw|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) ee
self matrix_ramp|(tmpua-self rfw|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) gg
self matrix_ramp|(tmpua-self rfw|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) q2f
self matrix_ramp|(tmpua-self rfw|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) q2lf
self matrix_ramp|(tmpua-self rfw|P Sqrt(self grav|self h)|(el-tmpel)) tmp Sqrt(P Abs q2) kn
self matrix_ramp|(tmpua-self rfw|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) uf
self matrix_ramp|(tmpua-self rfw|P Sqrt(self grav|self h)|(el-tmpel)) tmp a
self matrix_ramp|(tmpua-self rfw|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) vf
self matrix_ramp|(tmpua-self rfw|P Sqrt(self grav|self h)|(el-tmpel)) tmp a
self matrix_ramp|(tmpua-self rfw|P Sqrt(self grav|self h)|(el-tmpel)) tmp ff
uaf|(1-self x_h1)|tmp|self x_h1 uaf x_h1)|tmp|self x_h1 uaf
uaf|(1-self x_h1)|tmp|self x_h1 uaf x_h)|tmp0|self x_h uaf
uaf|(1-self x_h1)|tmp|self x_h1 uaf y_he) uaf
uaf|(1-self x_h1)|tmp|self x_h1 uaf dum uaf
uaf|(1-self x_h)|tmp0|self x_h uaf x_h)|tmp0|self x_h uaf
uaf|(1-self x_h)|tmp0|self x_h uaf y_he) uaf
uaf|(1-self x_h)|tmp0|self x_h uaf dum uaf
uaf|(1-self y_he) uaf y_he) uaf
uaf|(1-self y_he) uaf dum uaf
uaf|self dum uaf dum uaf
self AYF self AYB d|va|self AYF va-self mat_twos_2d|d|aam2d|self DYF vab|y_d tmp w
self AYF self AYB d|va|self AYF va-self mat_twos_2d|d|aam2d|self DYF vab|y_d tmp l_tmp
self AYF self AYB d|va|self AYF va-self mat_twos_2d|d|aam2d|self DYF vab|y_d tmp gh
self AYF self AYB d|va|self AYF va-self mat_twos_2d|d|aam2d|self DYF vab|y_d tmp 028|(1-tmp) gh
self AYF self AYB d|va|self AYF va-self mat_twos_2d|d|aam2d|self DYF vab|y_d tmp z_h)|self kappa|l0|self z_h l_tmp
self AYF self AYB d|va|self AYF va-self mat_twos_2d|d|aam2d|self DYF vab|y_d tmp z_e) l_tmp
self AYF self AYB d|va|self AYF va-self mat_twos_2d|d|aam2d|self DYF vab|y_d tmp zslice) ee
self AYF self AYB d|va|self AYF va-self mat_twos_2d|d|aam2d|self DYF vab|y_d tmp zslice) gg
self AYF self AYB d|va|self AYF va-self mat_twos_2d|d|aam2d|self DYF vab|y_d tmp zslice) q2f
self AYF self AYB d|va|self AYF va-self mat_twos_2d|d|aam2d|self DYF vab|y_d tmp zslice) q2lf
self AYF self AYB d|va|self AYF va-self mat_twos_2d|d|aam2d|self DYF vab|y_d tmp Sqrt(P Abs q2) kn
self AYF self AYB d|va|self AYF va-self mat_twos_2d|d|aam2d|self DYF vab|y_d tmp zslice) uf
self AYF self AYB d|va|self AYF va-self mat_twos_2d|d|aam2d|self DYF vab|y_d tmp a
self AYF self AYB d|va|self AYF va-self mat_twos_2d|d|aam2d|self DYF vab|y_d tmp zslice) vf
self AYF self AYB d|va|self AYF va-self mat_twos_2d|d|aam2d|self DYF vab|y_d tmp a
self AYF self AYB d|va|self AYF va-self mat_twos_2d|d|aam2d|self DYF vab|y_d tmp ff
self AYB d mat_ones c
self AYB d z_e)|self small_debug|self z_e dztmp
self AYB d a
self AYB d z_e)|self small_debug|self z_e tmpdz
self AYB d a
self DYB el y_e1)|self eln|self y_e1 tmpel
self DYB el y_h1)|self els|self y_h1 tmpel
self DYB el matrix_smoth|(elb-self mat_twos_2d|el|elf) elb
self DYB el matrix_ispi egf
 self DYB elb|y_d|self DYB  self DYB elb|y_d|self DYB elf|y_d
self mat_zeros_im_jm_1 tmpva y_e1)|self vabn|self y_e1 tmpva
self mat_zeros_im_jm_1 tmpva y_h1)|self vabs|self y_h1 tmpva
tmpva|(1-self y_e1)|self vabn|self y_e1 tmpva y_e1)|self vabn|self y_e1 tmpva
tmpva|(1-self y_e1)|self vabn|self y_e1 tmpva y_h1)|self vabs|self y_h1 tmpva
tmpva|(1-self y_h1)|self vabs|self y_h1 tmpva y_h1)|self vabs|self y_h1 tmpva
tmpel|(1-self y_e1)|self eln|self y_e1 tmpel y_e1)|self eln|self y_e1 tmpel
tmpel|(1-self y_e1)|self eln|self y_e1 tmpel y_h1)|self els|self y_h1 tmpel
tmpel|(1-self y_h1)|self els|self y_h1 tmpel y_h1)|self els|self y_h1 tmpel
self matrix_ramp|(tmpva|self rfn|P Sqrt(self grav|self h)|(el-tmpel)) tmp w
self matrix_ramp|(tmpva|self rfn|P Sqrt(self grav|self h)|(el-tmpel)) tmp l_tmp
self matrix_ramp|(tmpva|self rfn|P Sqrt(self grav|self h)|(el-tmpel)) tmp gh
self matrix_ramp|(tmpva|self rfn|P Sqrt(self grav|self h)|(el-tmpel)) tmp 028|(1-tmp) gh
self matrix_ramp|(tmpva|self rfn|P Sqrt(self grav|self h)|(el-tmpel)) tmp z_h)|self kappa|l0|self z_h l_tmp
self matrix_ramp|(tmpva|self rfn|P Sqrt(self grav|self h)|(el-tmpel)) tmp z_e) l_tmp
self matrix_ramp|(tmpva|self rfn|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) ee
self matrix_ramp|(tmpva|self rfn|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) gg
self matrix_ramp|(tmpva|self rfn|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) q2f
self matrix_ramp|(tmpva|self rfn|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) q2lf
self matrix_ramp|(tmpva|self rfn|P Sqrt(self grav|self h)|(el-tmpel)) tmp Sqrt(P Abs q2) kn
self matrix_ramp|(tmpva|self rfn|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) uf
self matrix_ramp|(tmpva|self rfn|P Sqrt(self grav|self h)|(el-tmpel)) tmp a
self matrix_ramp|(tmpva|self rfn|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) vf
self matrix_ramp|(tmpva|self rfn|P Sqrt(self grav|self h)|(el-tmpel)) tmp a
self matrix_ramp|(tmpva|self rfn|P Sqrt(self grav|self h)|(el-tmpel)) tmp ff
vaf|(1-self y_e)|tmp0|self y_e vaf y_e)|tmp0|self y_e vaf
vaf|(1-self y_e)|tmp0|self y_e vaf y_h1)|tmp|self y_h1 vaf
vaf|(1-self y_e)|tmp0|self y_e vaf y_h)|tmp0|self y_h vaf
vaf|(1-self y_e)|tmp0|self y_e vaf x_he) vaf
vaf|(1-self y_e)|tmp0|self y_e vaf dvm vaf
self matrix_ramp|(tmpva-self rfs|P Sqrt(self grav|self h)|(el-tmpel)) tmp w
self matrix_ramp|(tmpva-self rfs|P Sqrt(self grav|self h)|(el-tmpel)) tmp l_tmp
self matrix_ramp|(tmpva-self rfs|P Sqrt(self grav|self h)|(el-tmpel)) tmp gh
self matrix_ramp|(tmpva-self rfs|P Sqrt(self grav|self h)|(el-tmpel)) tmp 028|(1-tmp) gh
self matrix_ramp|(tmpva-self rfs|P Sqrt(self grav|self h)|(el-tmpel)) tmp z_h)|self kappa|l0|self z_h l_tmp
self matrix_ramp|(tmpva-self rfs|P Sqrt(self grav|self h)|(el-tmpel)) tmp z_e) l_tmp
self matrix_ramp|(tmpva-self rfs|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) ee
self matrix_ramp|(tmpva-self rfs|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) gg
self matrix_ramp|(tmpva-self rfs|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) q2f
self matrix_ramp|(tmpva-self rfs|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) q2lf
self matrix_ramp|(tmpva-self rfs|P Sqrt(self grav|self h)|(el-tmpel)) tmp Sqrt(P Abs q2) kn
self matrix_ramp|(tmpva-self rfs|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) uf
self matrix_ramp|(tmpva-self rfs|P Sqrt(self grav|self h)|(el-tmpel)) tmp a
self matrix_ramp|(tmpva-self rfs|P Sqrt(self grav|self h)|(el-tmpel)) tmp zslice) vf
self matrix_ramp|(tmpva-self rfs|P Sqrt(self grav|self h)|(el-tmpel)) tmp a
self matrix_ramp|(tmpva-self rfs|P Sqrt(self grav|self h)|(el-tmpel)) tmp ff
vaf|(1-self y_h1)|tmp|self y_h1 vaf y_h1)|tmp|self y_h1 vaf
vaf|(1-self y_h1)|tmp|self y_h1 vaf y_h)|tmp0|self y_h vaf
vaf|(1-self y_h1)|tmp|self y_h1 vaf x_he) vaf
vaf|(1-self y_h1)|tmp|self y_h1 vaf dvm vaf
vaf|(1-self y_h)|tmp0|self y_h vaf y_h)|tmp0|self y_h vaf
vaf|(1-self y_h)|tmp0|self y_h vaf x_he) vaf
vaf|(1-self y_h)|tmp0|self y_h vaf dvm vaf
vaf|(1-self x_he) vaf x_he) vaf
vaf|(1-self x_he) vaf dvm vaf
vaf|self dvm vaf dvm vaf
etf|0 5|(1 0-0 5|self smoth)|elf etf 5|(1 0-0 5|self smoth)|elf etf
etf|0 5|(1 0-0 5|self smoth)|elf etf 5|elf)|self fsm etf
etf|0 5|(1 0-0 5|self smoth)|elf etf et
etf|0 5|(1 0-0 5|self smoth)|elf etf dh
(etf|0 5|elf)|self fsm etf 5|elf)|self fsm etf
(etf|0 5|elf)|self fsm etf et
(etf|0 5|elf)|self fsm etf dh
F depend elf|elb el matrix_ispi egf
self h|el d mat_ones c
self h|el d z_e)|self small_debug|self z_e dztmp
self h|el d a
self h|el d z_e)|self small_debug|self z_e tmpdz
self h|el d a
egf|el|self matrix_ispi egf matrix_ispi egf
egf|el|self matrix_ispi egf egb
utf|self mat_twos_2d|ua|self AXB d|self matrix_isp2i utf mat_twos_2d|ua|self AXB d|self matrix_isp2i utf
utf|self mat_twos_2d|ua|self AXB d|self matrix_isp2i utf utb
vtf|self mat_twos_2d|va|self AYB d|self matrix_isp2i vtf mat_twos_2d|va|self AYB d|self matrix_isp2i vtf
vtf|self mat_twos_2d|va|self AYB d|self matrix_isp2i vtf vtb
(0 5|(vfluxb|self vfluxf)|del_w) w w
(0 5|(vfluxb|self vfluxf)|del_w) w -self x_he3d) w
(0 5|(vfluxb|self vfluxf)|del_w) w -self z_e) w
(0 5|(vfluxb|self vfluxf)|del_w) w tmp1
(0 5|(vfluxb|self vfluxf)|del_w) w x_h|tmptb|(1-self x_h) tmptb
(0 5|(vfluxb|self vfluxf)|del_w) w z_h)|self z_h|self vfluxf w
P BroadcastTo w_shape self fsm tmp_fsm w
w|tmp_fsm w w
w|tmp_fsm w -self x_he3d) w
w|tmp_fsm w -self z_e) w
w|tmp_fsm w tmp1
w|tmp_fsm w x_h|tmptb|(1-self x_h) tmptb
w|tmp_fsm w z_h)|self z_h|self vfluxf w
w|(1 -self x_he3d) w -self x_he3d) w
w|(1 -self x_he3d) w -self z_e) w
w|(1 -self x_he3d) w tmp1
w|(1 -self x_he3d) w x_h|tmptb|(1-self x_h) tmptb
w|(1 -self x_he3d) w z_h)|self z_h|self vfluxf w
w|(1 -self z_e) w -self z_e) w
w|(1 -self z_e) w tmp1
w|(1 -self z_e) w x_h|tmptb|(1-self x_h) tmptb
w|(1 -self z_e) w z_h)|self z_h|self vfluxf w
u-self reduce_sum(u|self dz|2)|(utb|utf)|(2 0|self AXB dt) u x_h3d) u
u-self reduce_sum(u|self dz|2)|(utb|utf)|(2 0|self AXB dt) u -self z_e) u
u-self reduce_sum(u|self dz|2)|(utb|utf)|(2 0|self AXB dt) u grav|self mat_ones l0
u-self reduce_sum(u|self dz|2)|(utb|utf)|(2 0|self AXB dt) u tmpu
u-self reduce_sum(u|self dz|2)|(utb|utf)|(2 0|self AXB dt) u x_h)|tmp0|self x_h tmpu
u-self reduce_sum(u|self dz|2)|(utb|utf)|(2 0|self AXB dt) u y_h)|tmp0|self y_h tmpu
u-self reduce_sum(u|self dz|2)|(utb|utf)|(2 0|self AXB dt) u x_e3d)|tmp0|self x_e3d tmpu
u-self reduce_sum(u|self dz|2)|(utb|utf)|(2 0|self AXB dt) u x_h13d)|tmp0|self x_h13d tmpu
u-self reduce_sum(u|self dz|2)|(utb|utf)|(2 0|self AXB dt) u 5|self smoth|(uf|ub-2 0|u-self reduce_sum((uf|ub-2 0|u)|self dz|2)) u
u-self reduce_sum(u|self dz|2)|(utb|utf)|(2 0|self AXB dt) u z_e) u
u-self reduce_sum(u|self dz|2)|(utb|utf)|(2 0|self AXB dt) u ub
u|(1-self x_h3d) u x_h3d) u
u|(1-self x_h3d) u -self z_e) u
u|(1-self x_h3d) u grav|self mat_ones l0
u|(1-self x_h3d) u tmpu
u|(1-self x_h3d) u x_h)|tmp0|self x_h tmpu
u|(1-self x_h3d) u y_h)|tmp0|self y_h tmpu
u|(1-self x_h3d) u x_e3d)|tmp0|self x_e3d tmpu
u|(1-self x_h3d) u x_h13d)|tmp0|self x_h13d tmpu
u|(1-self x_h3d) u 5|self smoth|(uf|ub-2 0|u-self reduce_sum((uf|ub-2 0|u)|self dz|2)) u
u|(1-self x_h3d) u z_e) u
u|(1-self x_h3d) u ub
u|(1 -self z_e) u -self z_e) u
u|(1 -self z_e) u grav|self mat_ones l0
u|(1 -self z_e) u tmpu
u|(1 -self z_e) u x_h)|tmp0|self x_h tmpu
u|(1 -self z_e) u y_h)|tmp0|self y_h tmpu
u|(1 -self z_e) u x_e3d)|tmp0|self x_e3d tmpu
u|(1 -self z_e) u x_h13d)|tmp0|self x_h13d tmpu
u|(1 -self z_e) u 5|self smoth|(uf|ub-2 0|u-self reduce_sum((uf|ub-2 0|u)|self dz|2)) u
u|(1 -self z_e) u z_e) u
u|(1 -self z_e) u ub
v-self reduce_sum(v|self dz|2)|(vtb|vtf)|(2 0|self AYB dt) v y_h3d) v
v-self reduce_sum(v|self dz|2)|(vtb|vtf)|(2 0|self AYB dt) v z_e) v
v-self reduce_sum(v|self dz|2)|(vtb|vtf)|(2 0|self AYB dt) v tmpv
v-self reduce_sum(v|self dz|2)|(vtb|vtf)|(2 0|self AYB dt) v y_e3d)|tmp0|self y_e3d tmpv
v-self reduce_sum(v|self dz|2)|(vtb|vtf)|(2 0|self AYB dt) v y_h13d)|tmp0|self y_h13d tmpv
v-self reduce_sum(v|self dz|2)|(vtb|vtf)|(2 0|self AYB dt) v 5|self smoth|(vf|vb-2 0|v-self reduce_sum((vf|vb-2 0|v)|self dz|2)) v
v-self reduce_sum(v|self dz|2)|(vtb|vtf)|(2 0|self AYB dt) v vb
v|(1-self y_h3d) v y_h3d) v
v|(1-self y_h3d) v z_e) v
v|(1-self y_h3d) v tmpv
v|(1-self y_h3d) v y_e3d)|tmp0|self y_e3d tmpv
v|(1-self y_h3d) v y_h13d)|tmp0|self y_h13d tmpv
v|(1-self y_h3d) v 5|self smoth|(vf|vb-2 0|v-self reduce_sum((vf|vb-2 0|v)|self dz|2)) v
v|(1-self y_h3d) v vb
v|(1-self z_e) v z_e) v
v|(1-self z_e) v tmpv
v|(1-self z_e) v y_e3d)|tmp0|self y_e3d tmpv
v|(1-self z_e) v y_h13d)|tmp0|self y_h13d tmpv
v|(1-self z_e) v 5|self smoth|(vf|vb-2 0|v-self reduce_sum((vf|vb-2 0|v)|self dz|2)) v
v|(1-self z_e) v vb
self h|etf dhf a
self AZB u grav|self mat_ones l0
self AZB u tmpu
self AZB u x_h)|tmp0|self x_h tmpu
self AZB u y_h)|tmp0|self y_h tmpu
self AZB u x_e3d)|tmp0|self x_e3d tmpu
self AZB u x_h13d)|tmp0|self x_h13d tmpu
self AZB u 5|self smoth|(uf|ub-2 0|u-self reduce_sum((uf|ub-2 0|u)|self dz|2)) u
self AZB u z_e) u
self AZB u ub
self AXB self h 028|(1-tmp) gh
self AXB self h z_he) gh
self AXB self h 0|a2|b2|18 0|a1|a2)|1 tmp
self AXB self h 0|a1|a2)|1 tmp
self AXB self h 41|kq)|0 5 kq
self AXB self h 5 kh
self AXB self h y_e)|tmp0|self fsm|self y_e kh
self AXB self h y_h)|tmp0|self fsm|self y_h kh
self AXB self h x_e)|tmp0|self fsm|self x_e kh
self AXB self h x_h)|tmp0|self fsm|self x_h kh
self AXB self h x_h)|self x_h dh
self AXB self h y_h)|self y_h dh
self AXB self h x_h13d)|tmp0|self x_h13d tmph
self AXB self h a
self AXB self h y_h13d)|tmp0|self y_h13d tmph
self AXB self h dh
self DXB q2b l_tmp
self DXB q2b gh
self DXB q2lb l_tmp
Shift (0|0|1)(self dzz1) dzz1 mat_ones c
self dz1|dzz1|self mat_ones a z_he) a
self dz1|dzz1|self mat_ones a ee
self dz1|dzz1|self mat_ones a dz|self dzz|dh|dh|self small_debug) a
self dz1|dzz1|self mat_ones a z_e)|(1-self z_e1) a
self dz1|dzz1|self mat_ones a a
self dz1|dzz1|self mat_ones a z_he2)|tmp_kh|self z_he2 a
self dz1|dzz1|self mat_ones a a
self dz1|dzz1|self mat_ones a z_he2 a
self dz1|dzz1|self mat_ones a z_h|ee|(1-self z_h) ee
self dz1|dzz1|self mat_ones a zslice gg
-self dti2|(self AZF kq|self umol)|(a|dhf|dhf|self small_debug) a z_he) a
-self dti2|(self AZF kq|self umol)|(a|dhf|dhf|self small_debug) a ee
-self dti2|(self AZF kq|self umol)|(a|dhf|dhf|self small_debug) a dz|self dzz|dh|dh|self small_debug) a
-self dti2|(self AZF kq|self umol)|(a|dhf|dhf|self small_debug) a z_e)|(1-self z_e1) a
-self dti2|(self AZF kq|self umol)|(a|dhf|dhf|self small_debug) a a
-self dti2|(self AZF kq|self umol)|(a|dhf|dhf|self small_debug) a z_he2)|tmp_kh|self z_he2 a
-self dti2|(self AZF kq|self umol)|(a|dhf|dhf|self small_debug) a a
-self dti2|(self AZF kq|self umol)|(a|dhf|dhf|self small_debug) a z_he2 a
-self dti2|(self AZF kq|self umol)|(a|dhf|dhf|self small_debug) a z_h|ee|(1-self z_h) ee
-self dti2|(self AZF kq|self umol)|(a|dhf|dhf|self small_debug) a zslice gg
a|(1-self z_he) a z_he) a
a|(1-self z_he) a ee
a|(1-self z_he) a dz|self dzz|dh|dh|self small_debug) a
a|(1-self z_he) a z_e)|(1-self z_e1) a
a|(1-self z_he) a a
a|(1-self z_he) a z_he2)|tmp_kh|self z_he2 a
a|(1-self z_he) a a
a|(1-self z_he) a z_he2 a
a|(1-self z_he) a z_h|ee|(1-self z_h) ee
a|(1-self z_he) a zslice gg
Shift (0|0|1)(self dz1) dz1 mat_ones c
dz1|dzz1|self mat_ones c z_he) c
dz1|dzz1|self mat_ones c Sqrt((1 0-0 01642|p|cc)|(1 0-0 4|p|(cc|cc))) cc
dz1|dzz1|self mat_ones c z_e) cc
dz1|dzz1|self mat_ones c x_h3d) c
dz1|dzz1|self mat_ones c gg
dz1|dzz1|self mat_ones c y_h3d) c
dz1|dzz1|self mat_ones c gg
dz1|dzz1|self mat_ones c z_he|tmp_c_dzz1|(1-self z_he) c
dz1|dzz1|self mat_ones c zslice gg
-self dti2|(self AZB kq|self umol)|(c|dhf|dhf|self small_debug) c z_he) c
-self dti2|(self AZB kq|self umol)|(c|dhf|dhf|self small_debug) c Sqrt((1 0-0 01642|p|cc)|(1 0-0 4|p|(cc|cc))) cc
-self dti2|(self AZB kq|self umol)|(c|dhf|dhf|self small_debug) c z_e) cc
-self dti2|(self AZB kq|self umol)|(c|dhf|dhf|self small_debug) c x_h3d) c
-self dti2|(self AZB kq|self umol)|(c|dhf|dhf|self small_debug) c gg
-self dti2|(self AZB kq|self umol)|(c|dhf|dhf|self small_debug) c y_h3d) c
-self dti2|(self AZB kq|self umol)|(c|dhf|dhf|self small_debug) c gg
-self dti2|(self AZB kq|self umol)|(c|dhf|dhf|self small_debug) c z_he|tmp_c_dzz1|(1-self z_he) c
-self dti2|(self AZB kq|self umol)|(c|dhf|dhf|self small_debug) c zslice gg
c|(1-self z_he) c z_he) c
c|(1-self z_he) c Sqrt((1 0-0 01642|p|cc)|(1 0-0 4|p|(cc|cc))) cc
c|(1-self z_he) c z_e) cc
c|(1-self z_he) c x_h3d) c
c|(1-self z_he) c gg
c|(1-self z_he) c y_h3d) c
c|(1-self z_he) c gg
c|(1-self z_he) c z_he|tmp_c_dzz1|(1-self z_he) c
c|(1-self z_he) c zslice gg
P Sqrt self AXF self wusurf|self AXF(self wusurf)|self AYF(self wvsurf)|self AYF(self wvsurf) utau2 grav|self mat_ones l0
self mat_zeros ee eetmp
self mat_zeros ee q2f
self mat_zeros ee z_h1) ee
self mat_zeros ee q2lf
self mat_zeros ee z_h)|a|(a-1 0)|self z_h ee
self mat_zeros ee uf
self mat_zeros ee vf
self mat_zeros ee zslice) ee
(15 8|cbcnst)(2 0|3 0)|utau2|self z_h|self mat_ones gg ggtmp
(15 8|cbcnst)(2 0|3 0)|utau2|self z_h|self mat_ones gg ee
(15 8|cbcnst)(2 0|3 0)|utau2|self z_h|self mat_ones gg q2f
(15 8|cbcnst)(2 0|3 0)|utau2|self z_h|self mat_ones gg z_h1) gg
(15 8|cbcnst)(2 0|3 0)|utau2|self z_h|self mat_ones gg x_e3d) gg
(15 8|cbcnst)(2 0|3 0)|utau2|self z_h|self mat_ones gg q2lf
(15 8|cbcnst)(2 0|3 0)|utau2|self z_h|self mat_ones gg z_h)|(self dti2|self wusurf|(dztmp|dh)-uf)|(a-1 0)|self z_h gg
(15 8|cbcnst)(2 0|3 0)|utau2|self z_h|self mat_ones gg gg
(15 8|cbcnst)(2 0|3 0)|utau2|self z_h|self mat_ones gg uf
(15 8|cbcnst)(2 0|3 0)|utau2|self z_h|self mat_ones gg z_h)|(self dti2|self wvsurf|(dztmp|dh)-vf)|(a-1 0)|self z_h gg
(15 8|cbcnst)(2 0|3 0)|utau2|self z_h|self mat_ones gg gg
(15 8|cbcnst)(2 0|3 0)|utau2|self z_h|self mat_ones gg vf
surfl|utau2|self grav|self mat_ones l0 l_tmp
P Sqrt self AXF wubot|self AXF wubot|self AYF wvbot|self AYF wvbot|(16 6(2 0|3 0)) tmp l_tmp
P Sqrt self AXF wubot|self AXF wubot|self AYF wvbot|self AYF wvbot|(16 6(2 0|3 0)) tmp gh
P Sqrt self AXF wubot|self AXF wubot|self AYF wvbot|self AYF wvbot|(16 6(2 0|3 0)) tmp 028|(1-tmp) gh
P Sqrt self AXF wubot|self AXF wubot|self AYF wvbot|self AYF wvbot|(16 6(2 0|3 0)) tmp z_h)|self kappa|l0|self z_h l_tmp
P Sqrt self AXF wubot|self AXF wubot|self AYF wvbot|self AYF wvbot|(16 6(2 0|3 0)) tmp z_e) l_tmp
P Sqrt self AXF wubot|self AXF wubot|self AYF wvbot|self AYF wvbot|(16 6(2 0|3 0)) tmp zslice) ee
P Sqrt self AXF wubot|self AXF wubot|self AYF wvbot|self AYF wvbot|(16 6(2 0|3 0)) tmp zslice) gg
P Sqrt self AXF wubot|self AXF wubot|self AYF wvbot|self AYF wvbot|(16 6(2 0|3 0)) tmp zslice) q2f
P Sqrt self AXF wubot|self AXF wubot|self AYF wvbot|self AYF wvbot|(16 6(2 0|3 0)) tmp zslice) q2lf
P Sqrt self AXF wubot|self AXF wubot|self AYF wvbot|self AYF wvbot|(16 6(2 0|3 0)) tmp Sqrt(P Abs q2) kn
P Sqrt self AXF wubot|self AXF wubot|self AYF wvbot|self AYF wvbot|(16 6(2 0|3 0)) tmp zslice) uf
P Sqrt self AXF wubot|self AXF wubot|self AYF wvbot|self AYF wvbot|(16 6(2 0|3 0)) tmp a
P Sqrt self AXF wubot|self AXF wubot|self AYF wvbot|self AYF wvbot|(16 6(2 0|3 0)) tmp zslice) vf
P Sqrt self AXF wubot|self AXF wubot|self AYF wvbot|self AYF wvbot|(16 6(2 0|3 0)) tmp a
P Sqrt self AXF wubot|self AXF wubot|self AYF wvbot|self AYF wvbot|(16 6(2 0|3 0)) tmp ff
q2f|(1-self z_e)|tmp|self z_e q2f z_e)|tmp|self z_e q2f
q2f|(1-self z_e)|tmp|self z_e q2f x_he3d) q2f
q2f|(1-self z_e)|tmp|self z_e q2f q2ftmp
q2f|(1-self z_e)|tmp|self z_e q2f y_e3d) q2f
q2f|(1-self z_e)|tmp|self z_e q2f matrix_small|filters q2f
q2f|(1-self z_e)|tmp|self z_e q2f x_e)|tmp1|self x_e q2f
q2f|(1-self z_e)|tmp|self z_e q2f x_h)|tmp1|self x_h q2f
q2f|(1-self z_e)|tmp|self z_e q2f y_e)|tmp1|self y_e q2f
q2f|(1-self z_e)|tmp|self z_e q2f y_h)|tmp1|self y_h q2f
q2f|(1-self z_e)|tmp|self z_e q2f fsm|1 e-10 q2f
q2f|(1-self z_e)|tmp|self z_e q2f q2
self grav|self rhoref|(-self zz|self mat_ones|self h)|1 e-4 p l_tmp
self grav|self rhoref|(-self zz|self mat_ones|self h)|1 e-4 p gh
self grav|self rhoref|(-self zz|self mat_ones|self h)|1 e-4 p 028|(1-tmp) gh
self grav|self rhoref|(-self zz|self mat_ones|self h)|1 e-4 p z_h)|self kappa|l0|self z_h l_tmp
self grav|self rhoref|(-self zz|self mat_ones|self h)|1 e-4 p z_e) l_tmp
self grav|self rhoref|(-self zz|self mat_ones|self h)|1 e-4 p zslice) ee
self grav|self rhoref|(-self zz|self mat_ones|self h)|1 e-4 p zslice) gg
self grav|self rhoref|(-self zz|self mat_ones|self h)|1 e-4 p zslice) q2f
self grav|self rhoref|(-self zz|self mat_ones|self h)|1 e-4 p zslice) q2lf
self grav|self rhoref|(-self zz|self mat_ones|self h)|1 e-4 p Sqrt(P Abs q2) kn
self grav|self rhoref|(-self zz|self mat_ones|self h)|1 e-4 p zslice) uf
self grav|self rhoref|(-self zz|self mat_ones|self h)|1 e-4 p a
self grav|self rhoref|(-self zz|self mat_ones|self h)|1 e-4 p zslice) vf
self grav|self rhoref|(-self zz|self mat_ones|self h)|1 e-4 p ff
cc|P Sqrt((1 0-0 01642|p|cc)|(1 0-0 4|p|(cc|cc))) cc Sqrt((1 0-0 01642|p|cc)|(1 0-0 4|p|(cc|cc))) cc
cc|P Sqrt((1 0-0 01642|p|cc)|(1 0-0 4|p|(cc|cc))) cc z_e) cc
cc|(1-self z_e) cc z_e) cc
P Abs q2b q2b l_tmp
P Abs q2b q2b gh
P Abs q2lb q2lb l_tmp
self matrix_grav|(self matrix_grav|self h-self DZB rho|self AZB cc|cc|z_d)| boygr z_h) boygr
self matrix_grav|(self matrix_grav|self h-self DZB rho|self AZB cc|cc|z_d)| boygr gh
boygr|(1-self z_h) boygr z_h) boygr
boygr|(1-self z_h) boygr gh
q2lb|q2b l_tmp l_tmp
q2lb|q2b l_tmp gh
q2lb|q2b l_tmp z_h)|self kappa|l0|self z_h l_tmp
q2lb|q2b l_tmp z_e) l_tmp
q2lb|q2b l_tmp Sqrt(P Abs q2) kn
self kappa|l0 kappa_l0 l_tmp
P Cast kappa_l0 tmp l_tmp
P Cast kappa_l0 tmp gh
P Cast kappa_l0 tmp 028|(1-tmp) gh
P Cast kappa_l0 tmp z_h)|self kappa|l0|self z_h l_tmp
P Cast kappa_l0 tmp z_e) l_tmp
P Cast kappa_l0 tmp zslice) ee
P Cast kappa_l0 tmp zslice) gg
P Cast kappa_l0 tmp zslice) q2f
P Cast kappa_l0 tmp zslice) q2lf
P Cast kappa_l0 tmp Sqrt(P Abs q2) kn
P Cast kappa_l0 tmp zslice) uf
P Cast kappa_l0 tmp a
P Cast kappa_l0 tmp zslice) vf
P Cast kappa_l0 tmp a
P Cast kappa_l0 tmp ff
kappa_l0|tmp|l_tmp|(1-tmp) l_tmp l_tmp
kappa_l0|tmp|l_tmp|(1-tmp) l_tmp gh
kappa_l0|tmp|l_tmp|(1-tmp) l_tmp z_h)|self kappa|l0|self z_h l_tmp
kappa_l0|tmp|l_tmp|(1-tmp) l_tmp z_e) l_tmp
kappa_l0|tmp|l_tmp|(1-tmp) l_tmp Sqrt(P Abs q2) kn
l_tmp|l_tmp|boygr|q2b gh tmp
l_tmp|l_tmp|boygr|q2b gh 028|(1-tmp) gh
l_tmp|l_tmp|boygr|q2b gh z_he) gh
l_tmp|l_tmp|boygr|q2b gh 0|a2|b2|18 0|a1|a2)|1 tmp
l_tmp|l_tmp|boygr|q2b gh 0|a1|a2)|1 tmp
gh tmp 028|(1-tmp) gh
gh tmp z_h)|self kappa|l0|self z_h l_tmp
gh tmp z_e) l_tmp
gh tmp zslice) ee
gh tmp zslice) gg
gh tmp zslice) q2f
gh tmp zslice) q2lf
gh tmp Sqrt(P Abs q2) kn
gh tmp zslice) uf
gh tmp a
gh tmp zslice) vf
gh tmp a
gh tmp ff
P Cast tmp|mstype float32 tmp 028|(1-tmp) gh
P Cast tmp|mstype float32 tmp z_h)|self kappa|l0|self z_h l_tmp
P Cast tmp|mstype float32 tmp z_e) l_tmp
P Cast tmp|mstype float32 tmp zslice) ee
P Cast tmp|mstype float32 tmp zslice) gg
P Cast tmp|mstype float32 tmp zslice) q2f
P Cast tmp|mstype float32 tmp zslice) q2lf
P Cast tmp|mstype float32 tmp Sqrt(P Abs q2) kn
P Cast tmp|mstype float32 tmp zslice) uf
P Cast tmp|mstype float32 tmp a
P Cast tmp|mstype float32 tmp zslice) vf
P Cast tmp|mstype float32 tmp a
P Cast tmp|mstype float32 tmp ff
gh|tmp|0 028|(1-tmp) gh 028|(1-tmp) gh
gh|tmp|0 028|(1-tmp) gh z_he) gh
gh|tmp|0 028|(1-tmp) gh 0|a2|b2|18 0|a1|a2)|1 tmp
gh|tmp|0 028|(1-tmp) gh 0|a1|a2)|1 tmp
l_tmp|(1-self z_h)|self kappa|l0|self z_h l_tmp z_h)|self kappa|l0|self z_h l_tmp
l_tmp|(1-self z_h)|self kappa|l0|self z_h l_tmp z_e) l_tmp
l_tmp|(1-self z_h)|self kappa|l0|self z_h l_tmp Sqrt(P Abs q2) kn
l_tmp|(1-self z_e) l_tmp z_e) l_tmp
l_tmp|(1-self z_e) l_tmp Sqrt(P Abs q2) kn
gh|(1-self z_he) gh z_he) gh
gh|(1-self z_he) gh 0|a2|b2|18 0|a1|a2)|1 tmp
gh|(1-self z_he) gh 0|a1|a2)|1 tmp
km|sef|(self DZB(self AXF u)|z_d|self DZB(self AXF u)|z_d|self DZB(self AYF v)|z_d) kn x_e3d) kn
km|sef|(self DZB(self AXF u)|z_d|self DZB(self AXF u)|z_d|self DZB(self AYF v)|z_d) kn 41|kq)|0 5 kq
km|sef|(self DZB(self AXF u)|z_d|self DZB(self AXF u)|z_d|self DZB(self AYF v)|z_d) kn 5 km
km|sef|(self DZB(self AXF u)|z_d|self DZB(self AXF u)|z_d|self DZB(self AYF v)|z_d) kn 5 kh
kn|(1-self x_e3d) kn x_e3d) kn
kn|(1-self x_e3d) kn 41|kq)|0 5 kq
kn|(1-self x_e3d) kn 5 km
kn|(1-self x_e3d) kn 5 kh
P Sqrt q2b|(b1|l_tmp|self small) dtef z_he) dtef
P Sqrt q2b|(b1|l_tmp|self small) dtef 0|e2|((1 0|P Abs))) dtef
dtef|(1-self z_he) dtef z_he) dtef
dtef|(1-self z_he) dtef 0|e2|((1 0|P Abs))) dtef
gg ggtmp zslice) gg
ee eetmp zslice) ee
range k 5 km
range k 5 kh
a|gg ee q2f
a|gg ee z_h1) ee
a|gg ee q2lf
a|gg ee z_h)|a|(a-1 0)|self z_h ee
a|gg ee uf
a|gg ee vf
a|gg ee zslice) ee
(-self matrix2_dti2|kn|c|Shift((0|0|1))(ggtmp)-q2f)|gg gg q2f
(-self matrix2_dti2|kn|c|Shift((0|0|1))(ggtmp)-q2f)|gg gg z_h1) gg
(-self matrix2_dti2|kn|c|Shift((0|0|1))(ggtmp)-q2f)|gg gg x_e3d) gg
(-self matrix2_dti2|kn|c|Shift((0|0|1))(ggtmp)-q2f)|gg gg q2lf
(-self matrix2_dti2|kn|c|Shift((0|0|1))(ggtmp)-q2f)|gg gg z_h)|(self dti2|self wusurf|(dztmp|dh)-uf)|(a-1 0)|self z_h gg
(-self matrix2_dti2|kn|c|Shift((0|0|1))(ggtmp)-q2f)|gg gg gg
(-self matrix2_dti2|kn|c|Shift((0|0|1))(ggtmp)-q2f)|gg gg uf
(-self matrix2_dti2|kn|c|Shift((0|0|1))(ggtmp)-q2f)|gg gg z_h)|(self dti2|self wvsurf|(dztmp|dh)-vf)|(a-1 0)|self z_h gg
(-self matrix2_dti2|kn|c|Shift((0|0|1))(ggtmp)-q2f)|gg gg gg
(-self matrix2_dti2|kn|c|Shift((0|0|1))(ggtmp)-q2f)|gg gg vf
eetmp|(1-self zslice) ee q2f
eetmp|(1-self zslice) ee z_h1) ee
eetmp|(1-self zslice) ee q2lf
eetmp|(1-self zslice) ee z_h)|a|(a-1 0)|self z_h ee
eetmp|(1-self zslice) ee uf
eetmp|(1-self zslice) ee vf
eetmp|(1-self zslice) ee zslice) ee
ggtmp|(1-self zslice) gg q2f
ggtmp|(1-self zslice) gg z_h1) gg
ggtmp|(1-self zslice) gg x_e3d) gg
ggtmp|(1-self zslice) gg q2lf
ggtmp|(1-self zslice) gg z_h)|(self dti2|self wusurf|(dztmp|dh)-uf)|(a-1 0)|self z_h gg
ggtmp|(1-self zslice) gg gg
ggtmp|(1-self zslice) gg uf
ggtmp|(1-self zslice) gg z_h)|(self dti2|self wvsurf|(dztmp|dh)-vf)|(a-1 0)|self z_h gg
ggtmp|(1-self zslice) gg gg
ggtmp|(1-self zslice) gg vf
q2f|(1-self x_he3d) q2f x_he3d) q2f
q2f|(1-self x_he3d) q2f q2ftmp
q2f|(1-self x_he3d) q2f y_e3d) q2f
q2f|(1-self x_he3d) q2f matrix_small|filters q2f
q2f|(1-self x_he3d) q2f x_e)|tmp1|self x_e q2f
q2f|(1-self x_he3d) q2f x_h)|tmp1|self x_h q2f
q2f|(1-self x_he3d) q2f y_e)|tmp1|self y_e q2f
q2f|(1-self x_he3d) q2f y_h)|tmp1|self y_h q2f
q2f|(1-self x_he3d) q2f fsm|1 e-10 q2f
q2f|(1-self x_he3d) q2f q2
q2f q2ftmp zslice) q2f
range self kbm1 k 5 km
range self kbm1 k 5 kh
ee|Shift((0|0|-1))(q2f)|gg q2f y_e3d) q2f
ee|Shift((0|0|-1))(q2f)|gg q2f matrix_small|filters q2f
ee|Shift((0|0|-1))(q2f)|gg q2f x_e)|tmp1|self x_e q2f
ee|Shift((0|0|-1))(q2f)|gg q2f x_h)|tmp1|self x_h q2f
ee|Shift((0|0|-1))(q2f)|gg q2f y_e)|tmp1|self y_e q2f
ee|Shift((0|0|-1))(q2f)|gg q2f y_h)|tmp1|self y_h q2f
ee|Shift((0|0|-1))(q2f)|gg q2f fsm|1 e-10 q2f
ee|Shift((0|0|-1))(q2f)|gg q2f q2
q2ftmp|(1-self zslice) q2f y_e3d) q2f
q2ftmp|(1-self zslice) q2f matrix_small|filters q2f
q2ftmp|(1-self zslice) q2f x_e)|tmp1|self x_e q2f
q2ftmp|(1-self zslice) q2f x_h)|tmp1|self x_h q2f
q2ftmp|(1-self zslice) q2f y_e)|tmp1|self y_e q2f
q2ftmp|(1-self zslice) q2f y_h)|tmp1|self y_h q2f
q2ftmp|(1-self zslice) q2f fsm|1 e-10 q2f
q2ftmp|(1-self zslice) q2f q2
q2f|(1-self y_e3d) q2f y_e3d) q2f
q2f|(1-self y_e3d) q2f matrix_small|filters q2f
q2f|(1-self y_e3d) q2f x_e)|tmp1|self x_e q2f
q2f|(1-self y_e3d) q2f x_h)|tmp1|self x_h q2f
q2f|(1-self y_e3d) q2f y_e)|tmp1|self y_e q2f
q2f|(1-self y_e3d) q2f y_h)|tmp1|self y_h q2f
q2f|(1-self y_e3d) q2f fsm|1 e-10 q2f
q2f|(1-self y_e3d) q2f q2
ee|(1-self z_h1) ee z_h1) ee
ee|(1-self z_h1) ee q2lf
ee|(1-self z_h1) ee z_h)|a|(a-1 0)|self z_h ee
ee|(1-self z_h1) ee uf
ee|(1-self z_h1) ee vf
ee|(1-self z_h1) ee zslice) ee
gg|(1-self z_h1) gg z_h1) gg
gg|(1-self z_h1) gg x_e3d) gg
gg|(1-self z_h1) gg q2lf
gg|(1-self z_h1) gg z_h)|(self dti2|self wusurf|(dztmp|dh)-uf)|(a-1 0)|self z_h gg
gg|(1-self z_h1) gg gg
gg|(1-self z_h1) gg uf
gg|(1-self z_h1) gg z_h)|(self dti2|self wvsurf|(dztmp|dh)-vf)|(a-1 0)|self z_h gg
gg|(1-self z_h1) gg gg
gg|(1-self z_h1) gg vf
q2lf|(1-self z_he) q2lf z_he) q2lf
q2lf|(1-self z_he) q2lf q2lftmp
q2lf|(1-self z_he) q2lf 1|dt|self small|filters q2lf
q2lf|(1-self z_he) q2lf x_e)|tmp1|self x_e q2lf
q2lf|(1-self z_he) q2lf x_h)|tmp1|self x_h q2lf
q2lf|(1-self z_he) q2lf y_e)|tmp1|self y_e q2lf
q2lf|(1-self z_he) q2lf y_h)|tmp1|self y_h q2lf
q2lf|(1-self z_he) q2lf fsm|1 e-10 q2lf
q2lf|(1-self z_he) q2lf q2l
dtef|(1 0|e2|((1 0|P Abs))) dtef 0|e2|((1 0|P Abs))) dtef
(-self matrix1_dti2|kn|l_tmp|e1|c|Shift((0|0|1))(ggtmp)-q2lf)|gg gg x_e3d) gg
(-self matrix1_dti2|kn|l_tmp|e1|c|Shift((0|0|1))(ggtmp)-q2lf)|gg gg q2lf
(-self matrix1_dti2|kn|l_tmp|e1|c|Shift((0|0|1))(ggtmp)-q2lf)|gg gg z_h)|(self dti2|self wusurf|(dztmp|dh)-uf)|(a-1 0)|self z_h gg
(-self matrix1_dti2|kn|l_tmp|e1|c|Shift((0|0|1))(ggtmp)-q2lf)|gg gg gg
(-self matrix1_dti2|kn|l_tmp|e1|c|Shift((0|0|1))(ggtmp)-q2lf)|gg gg uf
(-self matrix1_dti2|kn|l_tmp|e1|c|Shift((0|0|1))(ggtmp)-q2lf)|gg gg z_h)|(self dti2|self wvsurf|(dztmp|dh)-vf)|(a-1 0)|self z_h gg
(-self matrix1_dti2|kn|l_tmp|e1|c|Shift((0|0|1))(ggtmp)-q2lf)|gg gg gg
(-self matrix1_dti2|kn|l_tmp|e1|c|Shift((0|0|1))(ggtmp)-q2lf)|gg gg vf
gg|(1-self x_e3d) gg x_e3d) gg
gg|(1-self x_e3d) gg q2lf
gg|(1-self x_e3d) gg z_h)|(self dti2|self wusurf|(dztmp|dh)-uf)|(a-1 0)|self z_h gg
gg|(1-self x_e3d) gg gg
gg|(1-self x_e3d) gg uf
gg|(1-self x_e3d) gg z_h)|(self dti2|self wvsurf|(dztmp|dh)-vf)|(a-1 0)|self z_h gg
gg|(1-self x_e3d) gg gg
gg|(1-self x_e3d) gg vf
q2lf q2lftmp zslice) q2lf
ee|Shift((0|0|-1))(q2lf)|gg q2lf 1|dt|self small|filters q2lf
ee|Shift((0|0|-1))(q2lf)|gg q2lf x_e)|tmp1|self x_e q2lf
ee|Shift((0|0|-1))(q2lf)|gg q2lf x_h)|tmp1|self x_h q2lf
ee|Shift((0|0|-1))(q2lf)|gg q2lf y_e)|tmp1|self y_e q2lf
ee|Shift((0|0|-1))(q2lf)|gg q2lf y_h)|tmp1|self y_h q2lf
ee|Shift((0|0|-1))(q2lf)|gg q2lf fsm|1 e-10 q2lf
ee|Shift((0|0|-1))(q2lf)|gg q2lf q2l
q2lftmp|(1-self zslice) q2lf 1|dt|self small|filters q2lf
q2lftmp|(1-self zslice) q2lf x_e)|tmp1|self x_e q2lf
q2lftmp|(1-self zslice) q2lf x_h)|tmp1|self x_h q2lf
q2lftmp|(1-self zslice) q2lf y_e)|tmp1|self y_e q2lf
q2lftmp|(1-self zslice) q2lf y_h)|tmp1|self y_h q2lf
q2lftmp|(1-self zslice) q2lf fsm|1 e-10 q2lf
q2lftmp|(1-self zslice) q2lf q2l
P Cast res_compare|mstype float32 filters z_he) filters
filters|(1-self z_he) filters z_he) filters
q2f|(1-filters)|self matrix_small|filters q2f matrix_small|filters q2f
q2f|(1-filters)|self matrix_small|filters q2f x_e)|tmp1|self x_e q2f
q2f|(1-filters)|self matrix_small|filters q2f x_h)|tmp1|self x_h q2f
q2f|(1-filters)|self matrix_small|filters q2f y_e)|tmp1|self y_e q2f
q2f|(1-filters)|self matrix_small|filters q2f y_h)|tmp1|self y_h q2f
q2f|(1-filters)|self matrix_small|filters q2f fsm|1 e-10 q2f
q2f|(1-filters)|self matrix_small|filters q2f q2
q2lf|(1-filters)|0 1|dt|self small|filters q2lf 1|dt|self small|filters q2lf
q2lf|(1-filters)|0 1|dt|self small|filters q2lf x_e)|tmp1|self x_e q2lf
q2lf|(1-filters)|0 1|dt|self small|filters q2lf x_h)|tmp1|self x_h q2lf
q2lf|(1-filters)|0 1|dt|self small|filters q2lf y_e)|tmp1|self y_e q2lf
q2lf|(1-filters)|0 1|dt|self small|filters q2lf y_h)|tmp1|self y_h q2lf
q2lf|(1-filters)|0 1|dt|self small|filters q2lf fsm|1 e-10 q2lf
q2lf|(1-filters)|0 1|dt|self small|filters q2lf q2l
-gh|(3 0|a2|b2|18 0|a1|a2)|1 tmp Sqrt(P Abs q2) kn
-gh|(3 0|a2|b2|18 0|a1|a2)|1 tmp zslice) uf
-gh|(3 0|a2|b2|18 0|a1|a2)|1 tmp a
-gh|(3 0|a2|b2|18 0|a1|a2)|1 tmp zslice) vf
-gh|(3 0|a2|b2|18 0|a1|a2)|1 tmp a
-gh|(3 0|a2|b2|18 0|a1|a2)|1 tmp ff
a2|(1 0-6 0|a1|b1)|tmp sh 41|kq)|0 5 kq
a2|(1 0-6 0|a1|b1)|tmp sh 5 kh
-gh|(9 0|a1|a2)|1 tmp Sqrt(P Abs q2) kn
-gh|(9 0|a1|a2)|1 tmp zslice) uf
-gh|(9 0|a1|a2)|1 tmp a
-gh|(9 0|a1|a2)|1 tmp zslice) vf
-gh|(9 0|a1|a2)|1 tmp a
-gh|(9 0|a1|a2)|1 tmp ff
(a1|(1 0-3 0|c1-6 0|a1|b1)|sh|(18 0|a1|a1|9 0|a1|a2)|gh)|tmp sm 5 km
l_tmp|P Sqrt(P Abs q2) kn 41|kq)|0 5 kq
l_tmp|P Sqrt(P Abs q2) kn 5 km
l_tmp|P Sqrt(P Abs q2) kn 5 kh
(kn|sm|km)|0 5 km 5 km
(kn|sm|km)|0 5 km y_e)|tmp0|self fsm|self y_e km
(kn|sm|km)|0 5 km y_h)|tmp0|self fsm|self y_h km
(kn|sm|km)|0 5 km x_e)|tmp0|self fsm|self x_e km
(kn|sm|km)|0 5 km x_h)|tmp0|self fsm|self x_h km
(kn|sh|kh)|0 5 kh 5 kh
(kn|sh|kh)|0 5 kh y_e)|tmp0|self fsm|self y_e kh
(kn|sh|kh)|0 5 kh y_h)|tmp0|self fsm|self y_h kh
(kn|sh|kh)|0 5 kh x_e)|tmp0|self fsm|self x_e kh
(kn|sh|kh)|0 5 kh x_h)|tmp0|self fsm|self x_h kh
km|(1-self y_e)|tmp0|self fsm|self y_e km y_e)|tmp0|self fsm|self y_e km
km|(1-self y_e)|tmp0|self fsm|self y_e km y_h)|tmp0|self fsm|self y_h km
km|(1-self y_e)|tmp0|self fsm|self y_e km x_e)|tmp0|self fsm|self x_e km
km|(1-self y_e)|tmp0|self fsm|self y_e km x_h)|tmp0|self fsm|self x_h km
kh|(1-self y_e)|tmp0|self fsm|self y_e kh y_e)|tmp0|self fsm|self y_e kh
kh|(1-self y_e)|tmp0|self fsm|self y_e kh y_h)|tmp0|self fsm|self y_h kh
kh|(1-self y_e)|tmp0|self fsm|self y_e kh x_e)|tmp0|self fsm|self x_e kh
kh|(1-self y_e)|tmp0|self fsm|self y_e kh x_h)|tmp0|self fsm|self x_h kh
km|(1-self y_h)|tmp0|self fsm|self y_h km y_h)|tmp0|self fsm|self y_h km
km|(1-self y_h)|tmp0|self fsm|self y_h km x_e)|tmp0|self fsm|self x_e km
km|(1-self y_h)|tmp0|self fsm|self y_h km x_h)|tmp0|self fsm|self x_h km
kh|(1-self y_h)|tmp0|self fsm|self y_h kh y_h)|tmp0|self fsm|self y_h kh
kh|(1-self y_h)|tmp0|self fsm|self y_h kh x_e)|tmp0|self fsm|self x_e kh
kh|(1-self y_h)|tmp0|self fsm|self y_h kh x_h)|tmp0|self fsm|self x_h kh
km|(1-self x_e)|tmp0|self fsm|self x_e km x_e)|tmp0|self fsm|self x_e km
km|(1-self x_e)|tmp0|self fsm|self x_e km x_h)|tmp0|self fsm|self x_h km
kh|(1-self x_e)|tmp0|self fsm|self x_e kh x_e)|tmp0|self fsm|self x_e kh
kh|(1-self x_e)|tmp0|self fsm|self x_e kh x_h)|tmp0|self fsm|self x_h kh
km|(1-self x_h)|tmp0|self fsm|self x_h km x_h)|tmp0|self fsm|self x_h km
kh|(1-self x_h)|tmp0|self fsm|self x_h kh x_h)|tmp0|self fsm|self x_h kh
u tmpu x_h)|tmp0|self x_h tmpu
u tmpu y_h)|tmp0|self y_h tmpu
u tmpu x_e3d)|tmp0|self x_e3d tmpu
u tmpu x_h13d)|tmp0|self x_h13d tmpu
v tmpv y_e3d)|tmp0|self y_e3d tmpv
v tmpv y_h13d)|tmp0|self y_h13d tmpv
tmpu|(1-self x_h)|tmp0|self x_h tmpu x_h)|tmp0|self x_h tmpu
tmpu|(1-self x_h)|tmp0|self x_h tmpu y_h)|tmp0|self y_h tmpu
tmpu|(1-self x_h)|tmp0|self x_h tmpu x_e3d)|tmp0|self x_e3d tmpu
tmpu|(1-self x_h)|tmp0|self x_h tmpu x_h13d)|tmp0|self x_h13d tmpu
tmpu|(1-self y_h)|tmp0|self y_h tmpu y_h)|tmp0|self y_h tmpu
tmpu|(1-self y_h)|tmp0|self y_h tmpu x_e3d)|tmp0|self x_e3d tmpu
tmpu|(1-self y_h)|tmp0|self y_h tmpu x_h13d)|tmp0|self x_h13d tmpu
q2f|(1-self x_e)|tmp1|self x_e q2f x_e)|tmp1|self x_e q2f
q2f|(1-self x_e)|tmp1|self x_e q2f x_h)|tmp1|self x_h q2f
q2f|(1-self x_e)|tmp1|self x_e q2f y_e)|tmp1|self y_e q2f
q2f|(1-self x_e)|tmp1|self x_e q2f y_h)|tmp1|self y_h q2f
q2f|(1-self x_e)|tmp1|self x_e q2f fsm|1 e-10 q2f
q2f|(1-self x_e)|tmp1|self x_e q2f q2
q2lf|(1-self x_e)|tmp1|self x_e q2lf x_e)|tmp1|self x_e q2lf
q2lf|(1-self x_e)|tmp1|self x_e q2lf x_h)|tmp1|self x_h q2lf
q2lf|(1-self x_e)|tmp1|self x_e q2lf y_e)|tmp1|self y_e q2lf
q2lf|(1-self x_e)|tmp1|self x_e q2lf y_h)|tmp1|self y_h q2lf
q2lf|(1-self x_e)|tmp1|self x_e q2lf fsm|1 e-10 q2lf
q2lf|(1-self x_e)|tmp1|self x_e q2lf q2l
q2f|(1-self x_h)|tmp1|self x_h q2f x_h)|tmp1|self x_h q2f
q2f|(1-self x_h)|tmp1|self x_h q2f y_e)|tmp1|self y_e q2f
q2f|(1-self x_h)|tmp1|self x_h q2f y_h)|tmp1|self y_h q2f
q2f|(1-self x_h)|tmp1|self x_h q2f fsm|1 e-10 q2f
q2f|(1-self x_h)|tmp1|self x_h q2f q2
q2lf|(1-self x_h)|tmp1|self x_h q2lf x_h)|tmp1|self x_h q2lf
q2lf|(1-self x_h)|tmp1|self x_h q2lf y_e)|tmp1|self y_e q2lf
q2lf|(1-self x_h)|tmp1|self x_h q2lf y_h)|tmp1|self y_h q2lf
q2lf|(1-self x_h)|tmp1|self x_h q2lf fsm|1 e-10 q2lf
q2lf|(1-self x_h)|tmp1|self x_h q2lf q2l
q2f|(1-self y_e)|tmp1|self y_e q2f y_e)|tmp1|self y_e q2f
q2f|(1-self y_e)|tmp1|self y_e q2f y_h)|tmp1|self y_h q2f
q2f|(1-self y_e)|tmp1|self y_e q2f fsm|1 e-10 q2f
q2f|(1-self y_e)|tmp1|self y_e q2f q2
q2lf|(1-self y_e)|tmp1|self y_e q2lf y_e)|tmp1|self y_e q2lf
q2lf|(1-self y_e)|tmp1|self y_e q2lf y_h)|tmp1|self y_h q2lf
q2lf|(1-self y_e)|tmp1|self y_e q2lf fsm|1 e-10 q2lf
q2lf|(1-self y_e)|tmp1|self y_e q2lf q2l
q2f|(1-self y_h)|tmp1|self y_h q2f y_h)|tmp1|self y_h q2f
q2f|(1-self y_h)|tmp1|self y_h q2f fsm|1 e-10 q2f
q2f|(1-self y_h)|tmp1|self y_h q2f q2
q2lf|(1-self y_h)|tmp1|self y_h q2lf y_h)|tmp1|self y_h q2lf
q2lf|(1-self y_h)|tmp1|self y_h q2lf fsm|1 e-10 q2lf
q2lf|(1-self y_h)|tmp1|self y_h q2lf q2l
q2f|self fsm|1 e-10 q2f fsm|1 e-10 q2f
q2f|self fsm|1 e-10 q2f q2
q2lf|self fsm|1 e-10 q2lf fsm|1 e-10 q2lf
q2lf|self fsm|1 e-10 q2lf q2l
self AXB dhf dh x_h)|self x_h dh
self AXB dhf dh y_h)|self y_h dh
self AXB dhf dh a
self AXB dhf dh a
self AXB w|self AZB u tmp zslice) uf
self AXB w|self AZB u tmp a
self AXB w|self AZB u tmp zslice) vf
self AXB w|self AZB u tmp a
self AXB w|self AZB u tmp ff
z_d|(1-self z_e)|self small_debug|self z_e dztmp a
self dzz|(1-self z_e)|self small_debug|self z_e dzztmp a
uf|(1-self z_e) uf z_e) uf
uf|(1-self z_e) uf uftmp
uf|(1-self z_e) uf dum uf
uf|(1-self z_e) uf x_e3d)|tmp|self x_e3d uf
uf|(1-self z_e) uf x_h3d)|tmp0|self x_h3d uf
uf|(1-self z_e) uf x_h13d)|tmp|self x_h13d uf
uf|(1-self z_e) uf y_he3d) uf
uf|(1-self z_e) uf z_e)|uftmp|self dum|self z_e uf
uf|(1-self z_e) uf u
dh|(1-self x_h)|self x_h dh x_h)|self x_h dh
dh|(1-self x_h)|self x_h dh y_h)|self y_h dh
dh|(1-self x_h)|self x_h dh a
dh|(1-self x_h)|self x_h dh a
dh|(1-self y_h)|self y_h dh y_h)|self y_h dh
dh|(1-self y_h)|self y_h dh a
dh|(1-self y_h)|self y_h dh a
self AXB km c x_h3d) c
self AXB km c gg
self AXB km c y_h3d) c
self AXB km c gg
self AXB km c z_he|tmp_c_dzz1|(1-self z_he) c
self AXB km c zslice gg
c|(1-self x_h3d) c x_h3d) c
c|(1-self x_h3d) c gg
c|(1-self x_h3d) c y_h3d) c
c|(1-self x_h3d) c gg
c|(1-self x_h3d) c z_he|tmp_c_dzz1|(1-self z_he) c
c|(1-self x_h3d) c zslice gg
-self dti2|(Shift((0|0|-1))(c)|self umol) a dz|self dzz|dh|dh|self small_debug) a
-self dti2|(Shift((0|0|-1))(c)|self umol) a z_e)|(1-self z_e1) a
-self dti2|(Shift((0|0|-1))(c)|self umol) a a
-self dti2|(Shift((0|0|-1))(c)|self umol) a z_he2)|tmp_kh|self z_he2 a
-self dti2|(Shift((0|0|-1))(c)|self umol) a a
-self dti2|(Shift((0|0|-1))(c)|self umol) a z_he2 a
-self dti2|(Shift((0|0|-1))(c)|self umol) a z_h|ee|(1-self z_h) ee
-self dti2|(Shift((0|0|-1))(c)|self umol) a zslice gg
a|(self dz|self dzz|dh|dh|self small_debug) a dz|self dzz|dh|dh|self small_debug) a
a|(self dz|self dzz|dh|dh|self small_debug) a z_e)|(1-self z_e1) a
a|(self dz|self dzz|dh|dh|self small_debug) a a
a|(self dz|self dzz|dh|dh|self small_debug) a z_he2)|tmp_kh|self z_he2 a
a|(self dz|self dzz|dh|dh|self small_debug) a a
a|(self dz|self dzz|dh|dh|self small_debug) a z_he2 a
a|(self dz|self dzz|dh|dh|self small_debug) a z_h|ee|(1-self z_h) ee
a|(self dz|self dzz|dh|dh|self small_debug) a zslice gg
a|(1-self z_e)|(1-self z_e1) a z_e)|(1-self z_e1) a
a|(1-self z_e)|(1-self z_e1) a a
a|(1-self z_e)|(1-self z_e1) a z_he2)|tmp_kh|self z_he2 a
a|(1-self z_e)|(1-self z_e1) a a
a|(1-self z_e)|(1-self z_e1) a z_he2 a
a|(1-self z_e)|(1-self z_e1) a z_h|ee|(1-self z_h) ee
a|(1-self z_e)|(1-self z_e1) a zslice gg
-self dti2|(c|self umol)|(dztmp|Shift((0|0|1))(dzztmp)|dh|dh|self small_debug) c gg
-self dti2|(c|self umol)|(dztmp|Shift((0|0|1))(dzztmp)|dh|dh|self small_debug) c y_h3d) c
-self dti2|(c|self umol)|(dztmp|Shift((0|0|1))(dzztmp)|dh|dh|self small_debug) c gg
-self dti2|(c|self umol)|(dztmp|Shift((0|0|1))(dzztmp)|dh|dh|self small_debug) c z_he|tmp_c_dzz1|(1-self z_he) c
-self dti2|(c|self umol)|(dztmp|Shift((0|0|1))(dzztmp)|dh|dh|self small_debug) c zslice gg
ee|(1-self z_h)|a|(a-1 0)|self z_h ee z_h)|a|(a-1 0)|self z_h ee
ee|(1-self z_h)|a|(a-1 0)|self z_h ee uf
ee|(1-self z_h)|a|(a-1 0)|self z_h ee vf
ee|(1-self z_h)|a|(a-1 0)|self z_h ee zslice) ee
gg|(1-self z_h)|(self dti2|self wusurf|(dztmp|dh)-uf)|(a-1 0)|self z_h gg z_h)|(self dti2|self wusurf|(dztmp|dh)-uf)|(a-1 0)|self z_h gg
gg|(1-self z_h)|(self dti2|self wusurf|(dztmp|dh)-uf)|(a-1 0)|self z_h gg gg
gg|(1-self z_h)|(self dti2|self wusurf|(dztmp|dh)-uf)|(a-1 0)|self z_h gg uf
gg|(1-self z_h)|(self dti2|self wusurf|(dztmp|dh)-uf)|(a-1 0)|self z_h gg z_h)|(self dti2|self wvsurf|(dztmp|dh)-vf)|(a-1 0)|self z_h gg
gg|(1-self z_h)|(self dti2|self wusurf|(dztmp|dh)-uf)|(a-1 0)|self z_h gg gg
gg|(1-self z_h)|(self dti2|self wusurf|(dztmp|dh)-uf)|(a-1 0)|self z_h gg vf
(c|Shift((0|0|1))(ggtmp)-uf)|gg gg gg
(c|Shift((0|0|1))(ggtmp)-uf)|gg gg uf
(c|Shift((0|0|1))(ggtmp)-uf)|gg gg z_h)|(self dti2|self wvsurf|(dztmp|dh)-vf)|(a-1 0)|self z_h gg
(c|Shift((0|0|1))(ggtmp)-uf)|gg gg gg
(c|Shift((0|0|1))(ggtmp)-uf)|gg gg vf
P Sqrt ub|ub|self AXB(self AYF vb)|self AXB(self AYF vb) tmp zslice) uf
P Sqrt ub|ub|self AXB(self AYF vb)|self AXB(self AYF vb) tmp a
P Sqrt ub|ub|self AXB(self AYF vb)|self AXB(self AYF vb) tmp zslice) vf
P Sqrt ub|ub|self AXB(self AYF vb)|self AXB(self AYF vb) tmp a
P Sqrt ub|ub|self AXB(self AYF vb)|self AXB(self AYF vb) tmp ff
self AXB cbc|P Slice(tmp|(0|0|self kbm1-1)) tps x_e) tps
uf uftmp zslice) uf
ee|Shift((0|0|-1))(uf)|gg uf dum uf
ee|Shift((0|0|-1))(uf)|gg uf x_e3d)|tmp|self x_e3d uf
ee|Shift((0|0|-1))(uf)|gg uf x_h3d)|tmp0|self x_h3d uf
ee|Shift((0|0|-1))(uf)|gg uf x_h13d)|tmp|self x_h13d uf
ee|Shift((0|0|-1))(uf)|gg uf y_he3d) uf
ee|Shift((0|0|-1))(uf)|gg uf z_e)|uftmp|self dum|self z_e uf
ee|Shift((0|0|-1))(uf)|gg uf u
uftmp|(1-self zslice) uf dum uf
uftmp|(1-self zslice) uf x_e3d)|tmp|self x_e3d uf
uftmp|(1-self zslice) uf x_h3d)|tmp0|self x_h3d uf
uftmp|(1-self zslice) uf x_h13d)|tmp|self x_h13d uf
uftmp|(1-self zslice) uf y_he3d) uf
uftmp|(1-self zslice) uf z_e)|uftmp|self dum|self z_e uf
uftmp|(1-self zslice) uf u
uf|self dum uf dum uf
uf|self dum uf x_e3d)|tmp|self x_e3d uf
uf|self dum uf x_h3d)|tmp0|self x_h3d uf
uf|self dum uf x_h13d)|tmp|self x_h13d uf
uf|self dum uf y_he3d) uf
uf|self dum uf z_e)|uftmp|self dum|self z_e uf
uf|self dum uf u
self h tmph x_h13d)|tmp0|self x_h13d tmph
self h tmph y_h13d)|tmp0|self y_h13d tmph
tmph|(1-self x_h13d)|tmp0|self x_h13d tmph x_h13d)|tmp0|self x_h13d tmph
tmph|(1-self x_h13d)|tmp0|self x_h13d tmph y_h13d)|tmp0|self y_h13d tmph
tmpu|(1-self x_e3d)|tmp0|self x_e3d tmpu x_e3d)|tmp0|self x_e3d tmpu
tmpu|(1-self x_e3d)|tmp0|self x_e3d tmpu x_h13d)|tmp0|self x_h13d tmpu
tmpu|(1-self x_h13d)|tmp0|self x_h13d tmpu x_h13d)|tmp0|self x_h13d tmpu
P Sqrt tmph|self hmax|self AYF(self AYB tmpu)|(1 0-P Sqrt(tmph|self hmax))|self AYF tmp a
P Sqrt tmph|self hmax|self AYF(self AYB tmpu)|(1 0-P Sqrt(tmph|self hmax))|self AYF tmp zslice) vf
P Sqrt tmph|self hmax|self AYF(self AYB tmpu)|(1 0-P Sqrt(tmph|self hmax))|self AYF tmp a
P Sqrt tmph|self hmax|self AYF(self AYB tmpu)|(1 0-P Sqrt(tmph|self hmax))|self AYF tmp ff
uf|(1-self x_e3d)|tmp|self x_e3d uf x_e3d)|tmp|self x_e3d uf
uf|(1-self x_e3d)|tmp|self x_e3d uf x_h3d)|tmp0|self x_h3d uf
uf|(1-self x_e3d)|tmp|self x_e3d uf x_h13d)|tmp|self x_h13d uf
uf|(1-self x_e3d)|tmp|self x_e3d uf y_he3d) uf
uf|(1-self x_e3d)|tmp|self x_e3d uf z_e)|uftmp|self dum|self z_e uf
uf|(1-self x_e3d)|tmp|self x_e3d uf u
uf|(1-self x_h3d)|tmp0|self x_h3d uf x_h3d)|tmp0|self x_h3d uf
uf|(1-self x_h3d)|tmp0|self x_h3d uf x_h13d)|tmp|self x_h13d uf
uf|(1-self x_h3d)|tmp0|self x_h3d uf y_he3d) uf
uf|(1-self x_h3d)|tmp0|self x_h3d uf z_e)|uftmp|self dum|self z_e uf
uf|(1-self x_h3d)|tmp0|self x_h3d uf u
uf|(1-self x_h13d)|tmp|self x_h13d uf x_h13d)|tmp|self x_h13d uf
uf|(1-self x_h13d)|tmp|self x_h13d uf y_he3d) uf
uf|(1-self x_h13d)|tmp|self x_h13d uf z_e)|uftmp|self dum|self z_e uf
uf|(1-self x_h13d)|tmp|self x_h13d uf u
uf|(1-self y_he3d) uf y_he3d) uf
uf|(1-self y_he3d) uf z_e)|uftmp|self dum|self z_e uf
uf|(1-self y_he3d) uf u
uf|(1-self z_e)|uftmp|self dum|self z_e uf z_e)|uftmp|self dum|self z_e uf
uf|(1-self z_e)|uftmp|self dum|self z_e uf u
self AYB dhf dh a
self AYB dhf dh a
self AYB w|self AZB v tmp a
self AYB w|self AZB v tmp zslice) vf
self AYB w|self AZB v tmp a
self AYB w|self AZB v tmp ff
vf|(1-self z_e)|(1-self x_e3d) vf z_e)|(1-self x_e3d) vf
vf|(1-self z_e)|(1-self x_e3d) vf vftmp
vf|(1-self z_e)|(1-self x_e3d) vf dvm vf
vf|(1-self z_e)|(1-self x_e3d) vf y_e3d)|tmp|self y_e3d vf
vf|(1-self z_e)|(1-self x_e3d) vf y_h3d)|tmp0|self y_h3d vf
vf|(1-self z_e)|(1-self x_e3d) vf y_h13d)|tmp|self y_h13d vf
vf|(1-self z_e)|(1-self x_e3d) vf x_he3d) vf
vf|(1-self z_e)|(1-self x_e3d) vf z_e)|vftmp|self dvm|self z_e vf
vf|(1-self z_e)|(1-self x_e3d) vf v
self AYB km c y_h3d) c
self AYB km c gg
self AYB km c z_he|tmp_c_dzz1|(1-self z_he) c
self AYB km c zslice gg
c|(1-self y_h3d) c y_h3d) c
c|(1-self y_h3d) c gg
c|(1-self y_h3d) c z_he|tmp_c_dzz1|(1-self z_he) c
c|(1-self y_h3d) c zslice gg
a|(dztmp|dzztmp|dh|dh) a a
a|(dztmp|dzztmp|dh|dh) a z_he2)|tmp_kh|self z_he2 a
a|(dztmp|dzztmp|dh|dh) a a
a|(dztmp|dzztmp|dh|dh) a z_he2 a
a|(dztmp|dzztmp|dh|dh) a z_h|ee|(1-self z_h) ee
a|(dztmp|dzztmp|dh|dh) a zslice gg
gg|(1-self z_h)|(self dti2|self wvsurf|(dztmp|dh)-vf)|(a-1 0)|self z_h gg z_h)|(self dti2|self wvsurf|(dztmp|dh)-vf)|(a-1 0)|self z_h gg
gg|(1-self z_h)|(self dti2|self wvsurf|(dztmp|dh)-vf)|(a-1 0)|self z_h gg gg
gg|(1-self z_h)|(self dti2|self wvsurf|(dztmp|dh)-vf)|(a-1 0)|self z_h gg vf
(c|Shift((0|0|1))(ggtmp)-vf)|gg gg gg
(c|Shift((0|0|1))(ggtmp)-vf)|gg gg vf
P Sqrt self AYB self AXF ub|self AYB(self AXF ub)|vb|vb tmp zslice) vf
P Sqrt self AYB self AXF ub|self AYB(self AXF ub)|vb|vb tmp a
P Sqrt self AYB self AXF ub|self AYB(self AXF ub)|vb|vb tmp ff
self AYB cbc|P Slice(tmp|(0|0|self kbm1-1)) tps x_e) tps
tps|(1-self x_e) tps x_e) tps
vf vftmp zslice) vf
ee|Shift((0|0|-1))(vf)|gg vf dvm vf
ee|Shift((0|0|-1))(vf)|gg vf y_e3d)|tmp|self y_e3d vf
ee|Shift((0|0|-1))(vf)|gg vf y_h3d)|tmp0|self y_h3d vf
ee|Shift((0|0|-1))(vf)|gg vf y_h13d)|tmp|self y_h13d vf
ee|Shift((0|0|-1))(vf)|gg vf x_he3d) vf
ee|Shift((0|0|-1))(vf)|gg vf z_e)|vftmp|self dvm|self z_e vf
ee|Shift((0|0|-1))(vf)|gg vf v
vftmp|(1-self zslice) vf dvm vf
vftmp|(1-self zslice) vf y_e3d)|tmp|self y_e3d vf
vftmp|(1-self zslice) vf y_h3d)|tmp0|self y_h3d vf
vftmp|(1-self zslice) vf y_h13d)|tmp|self y_h13d vf
vftmp|(1-self zslice) vf x_he3d) vf
vftmp|(1-self zslice) vf z_e)|vftmp|self dvm|self z_e vf
vftmp|(1-self zslice) vf v
vf|self dvm vf dvm vf
vf|self dvm vf y_e3d)|tmp|self y_e3d vf
vf|self dvm vf y_h3d)|tmp0|self y_h3d vf
vf|self dvm vf y_h13d)|tmp|self y_h13d vf
vf|self dvm vf x_he3d) vf
vf|self dvm vf z_e)|vftmp|self dvm|self z_e vf
vf|self dvm vf v
tmph|(1-self y_h13d)|tmp0|self y_h13d tmph y_h13d)|tmp0|self y_h13d tmph
tmpv|(1-self y_e3d)|tmp0|self y_e3d tmpv y_e3d)|tmp0|self y_e3d tmpv
tmpv|(1-self y_e3d)|tmp0|self y_e3d tmpv y_h13d)|tmp0|self y_h13d tmpv
tmpv|(1-self y_h13d)|tmp0|self y_h13d tmpv y_h13d)|tmp0|self y_h13d tmpv
P Sqrt tmph|self hmax|self AXF(self AXB tmpv)|(1 0-P Sqrt(tmph|self hmax))|self AXF tmp a
P Sqrt tmph|self hmax|self AXF(self AXB tmpv)|(1 0-P Sqrt(tmph|self hmax))|self AXF tmp ff
vf|(1-self y_e3d)|tmp|self y_e3d vf y_e3d)|tmp|self y_e3d vf
vf|(1-self y_e3d)|tmp|self y_e3d vf y_h3d)|tmp0|self y_h3d vf
vf|(1-self y_e3d)|tmp|self y_e3d vf y_h13d)|tmp|self y_h13d vf
vf|(1-self y_e3d)|tmp|self y_e3d vf x_he3d) vf
vf|(1-self y_e3d)|tmp|self y_e3d vf z_e)|vftmp|self dvm|self z_e vf
vf|(1-self y_e3d)|tmp|self y_e3d vf v
vf|(1-self y_h3d)|tmp0|self y_h3d vf y_h3d)|tmp0|self y_h3d vf
vf|(1-self y_h3d)|tmp0|self y_h3d vf y_h13d)|tmp|self y_h13d vf
vf|(1-self y_h3d)|tmp0|self y_h3d vf x_he3d) vf
vf|(1-self y_h3d)|tmp0|self y_h3d vf z_e)|vftmp|self dvm|self z_e vf
vf|(1-self y_h3d)|tmp0|self y_h3d vf v
vf|(1-self y_h13d)|tmp|self y_h13d vf y_h13d)|tmp|self y_h13d vf
vf|(1-self y_h13d)|tmp|self y_h13d vf x_he3d) vf
vf|(1-self y_h13d)|tmp|self y_h13d vf z_e)|vftmp|self dvm|self z_e vf
vf|(1-self y_h13d)|tmp|self y_h13d vf v
vf|(1-self x_he3d) vf x_he3d) vf
vf|(1-self x_he3d) vf z_e)|vftmp|self dvm|self z_e vf
vf|(1-self x_he3d) vf v
vf|(1-self z_e)|vftmp|self dvm|self z_e vf z_e)|vftmp|self dvm|self z_e vf
vf|(1-self z_e)|vftmp|self dvm|self z_e vf v
u|0 5|self smoth|(uf|ub-2 0|u-self reduce_sum((uf|ub-2 0|u)|self dz|2)) u 5|self smoth|(uf|ub-2 0|u-self reduce_sum((uf|ub-2 0|u)|self dz|2)) u
u|0 5|self smoth|(uf|ub-2 0|u-self reduce_sum((uf|ub-2 0|u)|self dz|2)) u z_e) u
u|0 5|self smoth|(uf|ub-2 0|u-self reduce_sum((uf|ub-2 0|u)|self dz|2)) u ub
u|(1-self z_e) u z_e) u
u|(1-self z_e) u ub
v|0 5|self smoth|(vf|vb-2 0|v-self reduce_sum((vf|vb-2 0|v)|self dz|2)) v 5|self smoth|(vf|vb-2 0|v-self reduce_sum((vf|vb-2 0|v)|self dz|2)) v
v|0 5|self smoth|(vf|vb-2 0|v-self reduce_sum((vf|vb-2 0|v)|self dz|2)) v vb
et etb h dhb
etf et dh
z_d|(1-self z_e)|self small_debug|self z_e tmpdz a
dzz|(1-self z_e)|self small_debug|self z_e tmpdzz a
self AZB f|w tmp a
self AZB f|w tmp ff
f|w tmp1 x_h3d) tmp1
f|w tmp1 5|self dti|(tmpu|P Abs tmpu)|(tmpu|self small_debug)|self AZF w|dt| tmp2
f|w tmp1 5|self dti|(u|P Abs u)|u|self AZF w|dt|self DZF(self AZB f)|self AZB dzz tmp2
f|w tmp1 5|self dti|(tmpv|P Abs tmpv)|tmpv|self AZF w|dt|self DZF(self AZB f)|z_d tmp2
f|w tmp1 5|self dti|(v|P Abs v)|v|self AZF w|dt|self DZF(self AZB f)|z_d| tmp2
ff|(1-tmp_ze)|(1-self x_he)|(1-self y_he) ff x_he)|(1-self y_he) ff
ff|(1-tmp_ze)|(1-self x_he)|(1-self y_he) ff ff
ff|(1-tmp_ze)|(1-self x_he)|(1-self y_he) ff zslice) ff
ff|(1-tmp_ze)|(1-self x_he)|(1-self y_he) ff x_e3d|(1-self z_e))|tmp1|self x_e3d|(1-self z_e) ff
ff|(1-tmp_ze)|(1-self x_he)|(1-self y_he) ff x_e3d|self z_he3)|tmp2|self x_e3d|self z_he3 ff
ff|(1-tmp_ze)|(1-self x_he)|(1-self y_he) ff x_h3d|(1-self z_e))|tmp1|self x_h3d|(1-self z_e) ff
ff|(1-tmp_ze)|(1-self x_he)|(1-self y_he) ff x_h3d|self z_he3)|tmp2|self x_h3d|self z_he3 ff
ff|(1-tmp_ze)|(1-self x_he)|(1-self y_he) ff y_e3d|(1-self z_e))|tmp1|self y_e3d|(1-self z_e) ff
ff|(1-tmp_ze)|(1-self x_he)|(1-self y_he) ff y_e3d|self z_he3)|tmp2|self y_e3d|self z_he3 ff
ff|(1-tmp_ze)|(1-self x_he)|(1-self y_he) ff y_h3d|(1-self z_e))|tmp1|self y_h3d|(1-self z_e) ff
ff|(1-tmp_ze)|(1-self x_he)|(1-self y_he) ff y_h3d|self z_he3)|tmp2|self y_h3d|self z_he3 ff
ff|(1-tmp_ze)|(1-self x_he)|(1-self y_he) ff tmpff1
ff|(1-tmp_ze)|(1-self x_he)|(1-self y_he) ff tmpff2
ff|(1-tmp_ze)|(1-self x_he)|(1-self y_he) ff ff
ff|(1-tmp_ze)|(1-self x_he)|(1-self y_he) ff f
h|etf dh a
a|(1-self z_he2)|tmp_kh|self z_he2 a z_he2)|tmp_kh|self z_he2 a
a|(1-self z_he2)|tmp_kh|self z_he2 a a
a|(1-self z_he2)|tmp_kh|self z_he2 a z_he2 a
a|(1-self z_he2)|tmp_kh|self z_he2 a z_h|ee|(1-self z_h) ee
a|(1-self z_he2)|tmp_kh|self z_he2 a zslice gg
a|(tmpdz|tmpdzz|dhf|dhf) a a
a|(tmpdz|tmpdzz|dhf|dhf) a z_he2 a
a|(tmpdz|tmpdzz|dhf|dhf) a z_h|ee|(1-self z_h) ee
a|(tmpdz|tmpdzz|dhf|dhf) a zslice gg
a|self z_he2 a z_he2 a
a|self z_he2 a z_h|ee|(1-self z_h) ee
a|self z_he2 a zslice gg
c|self z_he|tmp_c_dzz1|(1-self z_he) c z_he|tmp_c_dzz1|(1-self z_he) c
c|self z_he|tmp_c_dzz1|(1-self z_he) c zslice gg
-1|self dti2|(kh|self umol)|(tmpdz|c|dhf|dhf) c zslice gg
P Slice c|(0|0|1) c zslice gg
P Pad ((0|0)) c zslice gg
(a|(a-1))|self z_h|ee|(1-self z_h) ee zslice) ee
ee|(1-self zslice) ee zslice) ee
P BroadcastTo P Shape fftmp self zslice self kbm1-1 zslicetmp ff
ff|(1-zslicetmp)|fftmp|zslicetmp ff ff
ff|(1-zslicetmp)|fftmp|zslicetmp ff zslice) ff
ff|(1-zslicetmp)|fftmp|zslicetmp ff x_e3d|(1-self z_e))|tmp1|self x_e3d|(1-self z_e) ff
ff|(1-zslicetmp)|fftmp|zslicetmp ff x_e3d|self z_he3)|tmp2|self x_e3d|self z_he3 ff
ff|(1-zslicetmp)|fftmp|zslicetmp ff x_h3d|(1-self z_e))|tmp1|self x_h3d|(1-self z_e) ff
ff|(1-zslicetmp)|fftmp|zslicetmp ff x_h3d|self z_he3)|tmp2|self x_h3d|self z_he3 ff
ff|(1-zslicetmp)|fftmp|zslicetmp ff y_e3d|(1-self z_e))|tmp1|self y_e3d|(1-self z_e) ff
ff|(1-zslicetmp)|fftmp|zslicetmp ff y_e3d|self z_he3)|tmp2|self y_e3d|self z_he3 ff
ff|(1-zslicetmp)|fftmp|zslicetmp ff y_h3d|(1-self z_e))|tmp1|self y_h3d|(1-self z_e) ff
ff|(1-zslicetmp)|fftmp|zslicetmp ff y_h3d|self z_he3)|tmp2|self y_h3d|self z_he3 ff
ff|(1-zslicetmp)|fftmp|zslicetmp ff tmpff1
ff|(1-zslicetmp)|fftmp|zslicetmp ff tmpff2
ff|(1-zslicetmp)|fftmp|zslicetmp ff ff
ff|(1-zslicetmp)|fftmp|zslicetmp ff f
ff|(1-self zslice) ff zslice) ff
ff|(1-self zslice) ff x_e3d|(1-self z_e))|tmp1|self x_e3d|(1-self z_e) ff
ff|(1-self zslice) ff x_e3d|self z_he3)|tmp2|self x_e3d|self z_he3 ff
ff|(1-self zslice) ff x_h3d|(1-self z_e))|tmp1|self x_h3d|(1-self z_e) ff
ff|(1-self zslice) ff x_h3d|self z_he3)|tmp2|self x_h3d|self z_he3 ff
ff|(1-self zslice) ff y_e3d|(1-self z_e))|tmp1|self y_e3d|(1-self z_e) ff
ff|(1-self zslice) ff y_e3d|self z_he3)|tmp2|self y_e3d|self z_he3 ff
ff|(1-self zslice) ff y_h3d|(1-self z_e))|tmp1|self y_h3d|(1-self z_e) ff
ff|(1-self zslice) ff y_h3d|self z_he3)|tmp2|self y_h3d|self z_he3 ff
ff|(1-self zslice) ff tmpff1
ff|(1-self zslice) ff tmpff2
ff|(1-self zslice) ff ff
ff|(1-self zslice) ff f
tmp1|(1-self x_h3d) tmp1 x_h3d) tmp1
tmp1|(1-self x_h3d) tmp1 5|self dti|(tmpu|P Abs tmpu)|(tmpu|self small_debug)|self AZF w|dt| tmp2
tmp1|(1-self x_h3d) tmp1 5|self dti|(u|P Abs u)|u|self AZF w|dt|self DZF(self AZB f)|self AZB dzz tmp2
tmp1|(1-self x_h3d) tmp1 5|self dti|(tmpv|P Abs tmpv)|tmpv|self AZF w|dt|self DZF(self AZB f)|z_d tmp2
tmp1|(1-self x_h3d) tmp1 5|self dti|(v|P Abs v)|v|self AZF w|dt|self DZF(self AZB f)|z_d| tmp2
ff|(1-self x_e3d|(1-self z_e))|tmp1|self x_e3d|(1-self z_e) ff x_e3d|(1-self z_e))|tmp1|self x_e3d|(1-self z_e) ff
ff|(1-self x_e3d|(1-self z_e))|tmp1|self x_e3d|(1-self z_e) ff x_e3d|self z_he3)|tmp2|self x_e3d|self z_he3 ff
ff|(1-self x_e3d|(1-self z_e))|tmp1|self x_e3d|(1-self z_e) ff x_h3d|(1-self z_e))|tmp1|self x_h3d|(1-self z_e) ff
ff|(1-self x_e3d|(1-self z_e))|tmp1|self x_e3d|(1-self z_e) ff x_h3d|self z_he3)|tmp2|self x_h3d|self z_he3 ff
ff|(1-self x_e3d|(1-self z_e))|tmp1|self x_e3d|(1-self z_e) ff y_e3d|(1-self z_e))|tmp1|self y_e3d|(1-self z_e) ff
ff|(1-self x_e3d|(1-self z_e))|tmp1|self x_e3d|(1-self z_e) ff y_e3d|self z_he3)|tmp2|self y_e3d|self z_he3 ff
ff|(1-self x_e3d|(1-self z_e))|tmp1|self x_e3d|(1-self z_e) ff y_h3d|(1-self z_e))|tmp1|self y_h3d|(1-self z_e) ff
ff|(1-self x_e3d|(1-self z_e))|tmp1|self x_e3d|(1-self z_e) ff y_h3d|self z_he3)|tmp2|self y_h3d|self z_he3 ff
ff|(1-self x_e3d|(1-self z_e))|tmp1|self x_e3d|(1-self z_e) ff tmpff1
ff|(1-self x_e3d|(1-self z_e))|tmp1|self x_e3d|(1-self z_e) ff tmpff2
ff|(1-self x_e3d|(1-self z_e))|tmp1|self x_e3d|(1-self z_e) ff ff
ff|(1-self x_e3d|(1-self z_e))|tmp1|self x_e3d|(1-self z_e) ff f
(1-self x_e13d)|tmp1|tmp_test|self x_e13d tmp1 5|self dti|(tmpu|P Abs tmpu)|(tmpu|self small_debug)|self AZF w|dt| tmp2
(1-self x_e13d)|tmp1|tmp_test|self x_e13d tmp1 5|self dti|(u|P Abs u)|u|self AZF w|dt|self DZF(self AZB f)|self AZB dzz tmp2
(1-self x_e13d)|tmp1|tmp_test|self x_e13d tmp1 5|self dti|(tmpv|P Abs tmpv)|tmpv|self AZF w|dt|self DZF(self AZB f)|z_d tmp2
(1-self x_e13d)|tmp1|tmp_test|self x_e13d tmp1 5|self dti|(v|P Abs v)|v|self AZF w|dt|self DZF(self AZB f)|z_d| tmp2
ff|(1-self x_e3d|self z_he3)|tmp2|self x_e3d|self z_he3 ff x_e3d|self z_he3)|tmp2|self x_e3d|self z_he3 ff
ff|(1-self x_e3d|self z_he3)|tmp2|self x_e3d|self z_he3 ff x_h3d|(1-self z_e))|tmp1|self x_h3d|(1-self z_e) ff
ff|(1-self x_e3d|self z_he3)|tmp2|self x_e3d|self z_he3 ff x_h3d|self z_he3)|tmp2|self x_h3d|self z_he3 ff
ff|(1-self x_e3d|self z_he3)|tmp2|self x_e3d|self z_he3 ff y_e3d|(1-self z_e))|tmp1|self y_e3d|(1-self z_e) ff
ff|(1-self x_e3d|self z_he3)|tmp2|self x_e3d|self z_he3 ff y_e3d|self z_he3)|tmp2|self y_e3d|self z_he3 ff
ff|(1-self x_e3d|self z_he3)|tmp2|self x_e3d|self z_he3 ff y_h3d|(1-self z_e))|tmp1|self y_h3d|(1-self z_e) ff
ff|(1-self x_e3d|self z_he3)|tmp2|self x_e3d|self z_he3 ff y_h3d|self z_he3)|tmp2|self y_h3d|self z_he3 ff
ff|(1-self x_e3d|self z_he3)|tmp2|self x_e3d|self z_he3 ff tmpff1
ff|(1-self x_e3d|self z_he3)|tmp2|self x_e3d|self z_he3 ff tmpff2
ff|(1-self x_e3d|self z_he3)|tmp2|self x_e3d|self z_he3 ff ff
ff|(1-self x_e3d|self z_he3)|tmp2|self x_e3d|self z_he3 ff f
ff|(1-self x_h3d|(1-self z_e))|tmp1|self x_h3d|(1-self z_e) ff x_h3d|(1-self z_e))|tmp1|self x_h3d|(1-self z_e) ff
ff|(1-self x_h3d|(1-self z_e))|tmp1|self x_h3d|(1-self z_e) ff x_h3d|self z_he3)|tmp2|self x_h3d|self z_he3 ff
ff|(1-self x_h3d|(1-self z_e))|tmp1|self x_h3d|(1-self z_e) ff y_e3d|(1-self z_e))|tmp1|self y_e3d|(1-self z_e) ff
ff|(1-self x_h3d|(1-self z_e))|tmp1|self x_h3d|(1-self z_e) ff y_e3d|self z_he3)|tmp2|self y_e3d|self z_he3 ff
ff|(1-self x_h3d|(1-self z_e))|tmp1|self x_h3d|(1-self z_e) ff y_h3d|(1-self z_e))|tmp1|self y_h3d|(1-self z_e) ff
ff|(1-self x_h3d|(1-self z_e))|tmp1|self x_h3d|(1-self z_e) ff y_h3d|self z_he3)|tmp2|self y_h3d|self z_he3 ff
ff|(1-self x_h3d|(1-self z_e))|tmp1|self x_h3d|(1-self z_e) ff tmpff1
ff|(1-self x_h3d|(1-self z_e))|tmp1|self x_h3d|(1-self z_e) ff tmpff2
ff|(1-self x_h3d|(1-self z_e))|tmp1|self x_h3d|(1-self z_e) ff ff
ff|(1-self x_h3d|(1-self z_e))|tmp1|self x_h3d|(1-self z_e) ff f
(1-self x_h13d)|tmp1|tmp_test|self x_h13d tmp1 5|self dti|(u|P Abs u)|u|self AZF w|dt|self DZF(self AZB f)|self AZB dzz tmp2
(1-self x_h13d)|tmp1|tmp_test|self x_h13d tmp1 5|self dti|(tmpv|P Abs tmpv)|tmpv|self AZF w|dt|self DZF(self AZB f)|z_d tmp2
(1-self x_h13d)|tmp1|tmp_test|self x_h13d tmp1 5|self dti|(v|P Abs v)|v|self AZF w|dt|self DZF(self AZB f)|z_d| tmp2
ff|(1-self x_h3d|self z_he3)|tmp2|self x_h3d|self z_he3 ff x_h3d|self z_he3)|tmp2|self x_h3d|self z_he3 ff
ff|(1-self x_h3d|self z_he3)|tmp2|self x_h3d|self z_he3 ff y_e3d|(1-self z_e))|tmp1|self y_e3d|(1-self z_e) ff
ff|(1-self x_h3d|self z_he3)|tmp2|self x_h3d|self z_he3 ff y_e3d|self z_he3)|tmp2|self y_e3d|self z_he3 ff
ff|(1-self x_h3d|self z_he3)|tmp2|self x_h3d|self z_he3 ff y_h3d|(1-self z_e))|tmp1|self y_h3d|(1-self z_e) ff
ff|(1-self x_h3d|self z_he3)|tmp2|self x_h3d|self z_he3 ff y_h3d|self z_he3)|tmp2|self y_h3d|self z_he3 ff
ff|(1-self x_h3d|self z_he3)|tmp2|self x_h3d|self z_he3 ff tmpff1
ff|(1-self x_h3d|self z_he3)|tmp2|self x_h3d|self z_he3 ff tmpff2
ff|(1-self x_h3d|self z_he3)|tmp2|self x_h3d|self z_he3 ff ff
ff|(1-self x_h3d|self z_he3)|tmp2|self x_h3d|self z_he3 ff f
ff|(1-self y_e3d|(1-self z_e))|tmp1|self y_e3d|(1-self z_e) ff y_e3d|(1-self z_e))|tmp1|self y_e3d|(1-self z_e) ff
ff|(1-self y_e3d|(1-self z_e))|tmp1|self y_e3d|(1-self z_e) ff y_e3d|self z_he3)|tmp2|self y_e3d|self z_he3 ff
ff|(1-self y_e3d|(1-self z_e))|tmp1|self y_e3d|(1-self z_e) ff y_h3d|(1-self z_e))|tmp1|self y_h3d|(1-self z_e) ff
ff|(1-self y_e3d|(1-self z_e))|tmp1|self y_e3d|(1-self z_e) ff y_h3d|self z_he3)|tmp2|self y_h3d|self z_he3 ff
ff|(1-self y_e3d|(1-self z_e))|tmp1|self y_e3d|(1-self z_e) ff tmpff1
ff|(1-self y_e3d|(1-self z_e))|tmp1|self y_e3d|(1-self z_e) ff tmpff2
ff|(1-self y_e3d|(1-self z_e))|tmp1|self y_e3d|(1-self z_e) ff ff
ff|(1-self y_e3d|(1-self z_e))|tmp1|self y_e3d|(1-self z_e) ff f
Shift (0|-1|0)(tmp1)|self y_e13d|tmp1|(1-self y_e13d) tmp1 5|self dti|(tmpv|P Abs tmpv)|tmpv|self AZF w|dt|self DZF(self AZB f)|z_d tmp2
Shift (0|-1|0)(tmp1)|self y_e13d|tmp1|(1-self y_e13d) tmp1 5|self dti|(v|P Abs v)|v|self AZF w|dt|self DZF(self AZB f)|z_d| tmp2
ff|(1-self y_e3d|self z_he3)|tmp2|self y_e3d|self z_he3 ff y_e3d|self z_he3)|tmp2|self y_e3d|self z_he3 ff
ff|(1-self y_e3d|self z_he3)|tmp2|self y_e3d|self z_he3 ff y_h3d|(1-self z_e))|tmp1|self y_h3d|(1-self z_e) ff
ff|(1-self y_e3d|self z_he3)|tmp2|self y_e3d|self z_he3 ff y_h3d|self z_he3)|tmp2|self y_h3d|self z_he3 ff
ff|(1-self y_e3d|self z_he3)|tmp2|self y_e3d|self z_he3 ff tmpff1
ff|(1-self y_e3d|self z_he3)|tmp2|self y_e3d|self z_he3 ff tmpff2
ff|(1-self y_e3d|self z_he3)|tmp2|self y_e3d|self z_he3 ff ff
ff|(1-self y_e3d|self z_he3)|tmp2|self y_e3d|self z_he3 ff f
ff|(1-self y_h3d|(1-self z_e))|tmp1|self y_h3d|(1-self z_e) ff y_h3d|(1-self z_e))|tmp1|self y_h3d|(1-self z_e) ff
ff|(1-self y_h3d|(1-self z_e))|tmp1|self y_h3d|(1-self z_e) ff y_h3d|self z_he3)|tmp2|self y_h3d|self z_he3 ff
ff|(1-self y_h3d|(1-self z_e))|tmp1|self y_h3d|(1-self z_e) ff tmpff1
ff|(1-self y_h3d|(1-self z_e))|tmp1|self y_h3d|(1-self z_e) ff tmpff2
ff|(1-self y_h3d|(1-self z_e))|tmp1|self y_h3d|(1-self z_e) ff ff
ff|(1-self y_h3d|(1-self z_e))|tmp1|self y_h3d|(1-self z_e) ff f
Shift (0|1|0)(tmp1)|self y_h13d|tmp1|(1-self y_h13d) tmp1 5|self dti|(v|P Abs v)|v|self AZF w|dt|self DZF(self AZB f)|z_d| tmp2
ff|(1-self y_h3d|self z_he3)|tmp2|self y_h3d|self z_he3 ff y_h3d|self z_he3)|tmp2|self y_h3d|self z_he3 ff
ff|(1-self y_h3d|self z_he3)|tmp2|self y_h3d|self z_he3 ff tmpff1
ff|(1-self y_h3d|self z_he3)|tmp2|self y_h3d|self z_he3 ff tmpff2
ff|(1-self y_h3d|self z_he3)|tmp2|self y_h3d|self z_he3 ff ff
ff|(1-self y_h3d|self z_he3)|tmp2|self y_h3d|self z_he3 ff f
P Concat (tmpff|ff) ff ff
P Concat (tmpff|ff) ff f
P Concat (ff|tmpff) ff ff
P Concat (ff|tmpff) ff f
ff|fsm ff ff
ff|fsm ff f
w|(1-self z_h)|self z_h|self vfluxf w z_h)|self z_h|self vfluxf w
parser parse_args args_opt
np load args_opt dataset_path r
r nlist
Tensor atype atype_tensor
Tensor avg avg_tensor
Tensor std std_tensor
Tensor nlist nlist_tensor
Tensor np reshape d_coord|(1|-1|3) d_coord_tensor
Tensor d_nlist d_nlist_tensor
range i
frames append i|1536
Tensor frames frames
Network net
load_checkpoint args_opt checkpoint_path param_dict
load_param_into_net net|param_dict
net to_float mstype float32
 virial
net d_coord_tensor|d_nlist_tensor|frames|avg_tensor|std_tensor|atype_tensor|nlist_tensor
print energy
print atom_ener
print force
print virial
np load args_opt dataset_path r nlist
frames append  virial
Network net to_float mstype float32
Network net d_coord_tensor|d_nlist_tensor|frames|avg_tensor|std_tensor|atype_tensor|nlist_tensor
load_param_into_net net to_float mstype float32
load_param_into_net  virial
load_param_into_net net d_coord_tensor|d_nlist_tensor|frames|avg_tensor|std_tensor|atype_tensor|nlist_tensor
super ComputeRij|self __init__
P Reshape self reshape
P Transpose self transpose
P Cast self cast
P ReduceSum self rsum
P BroadcastTo (1|192|138) self broadcastto
P BroadcastTo (1|192|138|3) self broadcastto1
P ExpandDims self expdims
P GatherV2 self gather
P Mul self mul
P Slice self slice
self cast d_coord_tensor|mstype float32 d_coord_tensor
self reshape d_coord_tensor|(1|-1|3) d_coord_tensor
self slice d_coord_tensor|(0|0|0) coord_tensor
self cast nlist_tensor|mstype int32 nlist_tensor
self reshape nlist_tensor|(1|192|138) nlist_tensor
nlist_tensor b_nlist
self cast b_nlist|mstype int32 b_nlist
b_nlist|nlist_tensor nlist_tensor_r
self reshape nlist_tensor_r|(-1|) nlist_tensor_r
self cast frames|mstype int32 frames
self expdims frames|1 frames
self broadcastto frames frames
self reshape frames|(-1|) frames
nlist_tensor_r|frames nlist_tensor_r
self reshape d_coord_tensor|(-1|3) d_coord_tensor
self gather d_coord_tensor|nlist_tensor_r|0 selected_coord
self reshape selected_coord|(1|192|138|3) selected_coord
self expdims coord_tensor|2 coord_tensor_expanded
self broadcastto1 coord_tensor_expanded coord_tensor_expanded
selected_coord-coord_tensor_expanded result_rij_m
self expdims b_nlist|3 b_nlist_expanded
self broadcastto1 b_nlist_expanded b_nlist_expanded
result_rij_m|b_nlist_expanded result_rij
super ComputeDescriptor|self __init__
P BroadcastTo (1|192|138|3|3) self broadcastto2
P BroadcastTo (1|192|138|4) self broadcastto3
P BroadcastTo (1|192|138|4|3) self broadcastto4
P Square self square
P Inv self inv
P Sqrt self sqrt
P OnesLike self ones
P Eye self eye
self broadcastto3 b_nlist_expanded b_nlist_4
self broadcastto1 b_nlist_expanded b_nlist_3
self expdims b_nlist_expanded|4 b_nlist_expanded
self broadcastto2 b_nlist_expanded b_nlist_33
rij_tensor|self cast(1-b_nlist_3|mstype float32) rij_tensor
self square rij_tensor r_2
self rsum r_2|3 d_2
self inv d_2 invd_2
self sqrt invd_2 invd
self square invd_2 invd_4
invd|d_2 d
invd_4|d invd_3
self cast d b_d_1
self cast d b_d_2
self cast d b_d_3
(d-r_min)|du uu
uu|uu|uu|(-6|uu|uu|15|uu-10)|1 vv
(3|uu|uu|(-6|uu|uu|15|uu-10)|uu|uu|uu|(-12|uu|15))|du dd
vv|b_d_3|b_d_1|b_d_2 sw
dd|b_d_3|b_d_1 dsw
self expdims invd_2|3 invd_2_e
self broadcastto1 invd_2_e invd_2_e
rij_tensor|invd_2_e descrpt_1
invd_3|sw-invd_2|dsw factor0
self expdims factor0|3 factor0
self broadcastto1 factor0 factor0
rij_tensor|factor0 descrpt_deriv_0
descrpt_deriv_0|b_nlist_3 descrpt_deriv_0
self expdims descrpt_deriv_0|3 descrpt_deriv_0
self eye 3|3|mstype float32 factor1_0
self expdims factor1_0|0 factor1_0
self expdims invd_2|sw|3 factor1_1
self expdims factor1_1|4 factor1_1
factor1_0|factor1_1 descrpt_deriv_1_0
self expdims rij_tensor|4 rij_tensor_e1
self expdims rij_tensor|3 rij_tensor_e2
self broadcastto2 rij_tensor_e1 rij_tensor_e1
self broadcastto2 rij_tensor_e2 rij_tensor_e2
self expdims 2 0|invd_4|sw|3 factor1_3
self expdims factor1_3|4 factor1_3
self broadcastto2 factor1_3 factor1_3
factor1_3|rij_tensor_e1|rij_tensor_e2 descrpt_deriv_1_1
self expdims invd|dsw|3 factor1_4
self expdims factor1_4|3 factor1_4
self broadcastto2 factor1_4 factor1_4
self expdims descrpt_1|4 descrpt_1_e
self broadcastto2 descrpt_1_e descrpt_1_e
descrpt_1_e|rij_tensor_e2|factor1_4 descrpt_deriv_1_2
(descrpt_deriv_1_1-descrpt_deriv_1_0-descrpt_deriv_1_2)|b_nlist_33 descrpt_deriv_1
self concat (descrpt_deriv_0|descrpt_deriv_1) descrpt_deriv
self expdims invd|3 invd_e
self concat (invd_e|descrpt_1) descrpt
self broadcastto3 self expdims sw|3 sw
descrpt|sw|b_nlist_4 descrpt
self cast avg_tensor|mstype float32 avg_tensor
self cast std_tensor|mstype float32 std_tensor
self reshape atype_tensor|(-1|) atype_tensor
self cast atype_tensor|mstype int32 atype_tensor
self gather avg_tensor|atype_tensor|0 avg_tensor
self gather std_tensor|atype_tensor|0 std_tensor
self reshape avg_tensor|(1|192|138|4) avg_tensor
self reshape std_tensor|(1|192|138|4) std_tensor
self expdims std_tensor|4 std_tensor_2
self broadcastto4 std_tensor_2 std_tensor_2
(descrpt-avg_tensor)|std_tensor descrpt
descrpt_deriv|std_tensor_2 descrpt_deriv
super DescriptorSeA|self __init__
ComputeRij self compute_rij
ComputeDescriptor self compute_descriptor
self compute_rij coord|nlist|frames rij
self compute_descriptor rij|avg|std|nlist|atype descrpt_deriv
self cast nlist_tensor|mstype int32 nlist_tensor b_nlist
self cast nlist_tensor|mstype int32 nlist_tensor nlist_tensor_r
self reshape nlist_tensor|(1|192|138) nlist_tensor b_nlist
self reshape nlist_tensor|(1|192|138) nlist_tensor nlist_tensor_r
nlist_tensor b_nlist nlist_tensor_r
nlist_tensor b_nlist result_rij
nlist_tensor b_nlist descrpt_deriv_0
nlist_tensor b_nlist descrpt_deriv_1
nlist_tensor b_nlist descrpt
self cast b_nlist|mstype int32 b_nlist nlist_tensor_r
self cast b_nlist|mstype int32 b_nlist result_rij
self cast b_nlist|mstype int32 b_nlist descrpt_deriv_0
self cast b_nlist|mstype int32 b_nlist descrpt_deriv_1
self cast b_nlist|mstype int32 b_nlist descrpt
b_nlist|nlist_tensor nlist_tensor_r nlist_tensor_r
self reshape nlist_tensor_r|(-1|) nlist_tensor_r nlist_tensor_r
self cast frames|mstype int32 frames nlist_tensor_r
self expdims frames|1 frames nlist_tensor_r
self broadcastto frames frames nlist_tensor_r
self reshape frames|(-1|) frames nlist_tensor_r
nlist_tensor_r|frames nlist_tensor_r nlist_tensor_r
selected_coord-coord_tensor_expanded result_rij_m result_rij
self expdims b_nlist|3 b_nlist_expanded result_rij
self broadcastto1 b_nlist_expanded b_nlist_expanded result_rij
P Inv self inv descrpt_1
self broadcastto3 b_nlist_expanded b_nlist_4 descrpt
self broadcastto1 b_nlist_expanded b_nlist_3 descrpt_deriv_0
self broadcastto1 b_nlist_expanded b_nlist_3 descrpt_deriv_1
self broadcastto2 b_nlist_expanded b_nlist_33 descrpt_deriv_1
rij_tensor|self cast(1-b_nlist_3|mstype float32) rij_tensor cast(1-b_nlist_3|mstype float32) rij_tensor
rij_tensor|self cast(1-b_nlist_3|mstype float32) rij_tensor descrpt_1
rij_tensor|self cast(1-b_nlist_3|mstype float32) rij_tensor descrpt_deriv_0
rij_tensor|self cast(1-b_nlist_3|mstype float32) rij_tensor descrpt_deriv_1_1
rij_tensor|self cast(1-b_nlist_3|mstype float32) rij_tensor descrpt_deriv_1_2
self rsum r_2|3 d_2 d
self rsum r_2|3 d_2 factor0
self inv d_2 invd_2 descrpt_1
self inv d_2 invd_2 factor0
self sqrt invd_2 invd d
self sqrt invd_2 invd descrpt_1
self square invd_2 invd_4 invd_3
invd|d_2 d d
invd|d_2 d invd_3
invd|d_2 d uu
invd|d_2 d dd
invd|d_2 d dsw
invd|d_2 d factor0
invd_4|d invd_3 factor0
self cast d b_d_1 sw
self cast d b_d_1 dsw
self cast d b_d_2 sw
self cast d b_d_3 sw
self cast d b_d_3 dsw
(d-r_min)|du uu vv
(d-r_min)|du uu dd
uu|uu|uu|(-6|uu|uu|15|uu-10)|1 vv sw
(3|uu|uu|(-6|uu|uu|15|uu-10)|uu|uu|uu|(-12|uu|15))|du dd dsw
vv|b_d_3|b_d_1|b_d_2 sw factor0
vv|b_d_3|b_d_1|b_d_2 sw descrpt
dd|b_d_3|b_d_1 dsw factor0
self expdims invd_2|3 invd_2_e descrpt_1
self broadcastto1 invd_2_e invd_2_e descrpt_1
invd_3|sw-invd_2|dsw factor0 descrpt_deriv_0
self expdims factor0|3 factor0 descrpt_deriv_0
self broadcastto1 factor0 factor0 descrpt_deriv_0
rij_tensor|factor0 descrpt_deriv_0 descrpt_deriv_0
descrpt_deriv_0|b_nlist_3 descrpt_deriv_0 descrpt_deriv_0
self eye 3|3|mstype float32 factor1_0 descrpt_deriv_1_0
self expdims factor1_0|0 factor1_0 descrpt_deriv_1_0
self expdims invd_2|sw|3 factor1_1 descrpt_deriv_1_0
self expdims factor1_1|4 factor1_1 descrpt_deriv_1_0
self expdims rij_tensor|4 rij_tensor_e1 descrpt_deriv_1_1
self expdims rij_tensor|3 rij_tensor_e2 descrpt_deriv_1_1
self expdims rij_tensor|3 rij_tensor_e2 descrpt_deriv_1_2
self broadcastto2 rij_tensor_e1 rij_tensor_e1 descrpt_deriv_1_1
self broadcastto2 rij_tensor_e2 rij_tensor_e2 descrpt_deriv_1_1
self broadcastto2 rij_tensor_e2 rij_tensor_e2 descrpt_deriv_1_2
self expdims 2 0|invd_4|sw|3 factor1_3 descrpt_deriv_1_1
self expdims factor1_3|4 factor1_3 descrpt_deriv_1_1
self broadcastto2 factor1_3 factor1_3 descrpt_deriv_1_1
self expdims invd|dsw|3 factor1_4 descrpt_deriv_1_2
self expdims factor1_4|3 factor1_4 descrpt_deriv_1_2
self broadcastto2 factor1_4 factor1_4 descrpt_deriv_1_2
self expdims descrpt_1|4 descrpt_1_e descrpt_deriv_1_2
self broadcastto2 descrpt_1_e descrpt_1_e descrpt_deriv_1_2
self concat (descrpt_deriv_0|descrpt_deriv_1) descrpt_deriv descrpt_deriv
self concat (invd_e|descrpt_1) descrpt descrpt
self broadcastto3 self expdims sw|3 sw descrpt
descrpt|sw|b_nlist_4 descrpt descrpt
self cast std_tensor|mstype float32 std_tensor descrpt
self cast std_tensor|mstype float32 std_tensor descrpt_deriv
self gather std_tensor|atype_tensor|0 std_tensor descrpt
self gather std_tensor|atype_tensor|0 std_tensor descrpt_deriv
self reshape std_tensor|(1|192|138|4) std_tensor descrpt
self reshape std_tensor|(1|192|138|4) std_tensor descrpt_deriv
self expdims std_tensor|4 std_tensor_2 descrpt_deriv
self broadcastto4 std_tensor_2 std_tensor_2 descrpt_deriv
descrpt_deriv|std_tensor_2 descrpt_deriv descrpt_deriv
super ProdVirialSeA|self __init__
P Reshape self reshape
P Transpose self transpose
P Cast self cast
P ReduceSum self rsum
P BroadcastTo (1|192|138|4|3|3) self broadcastto1
P BroadcastTo (1|192|138|4|3) self broadcastto2
P BroadcastTo (1|192|138|3) self broadcastto3
P ExpandDims self expdims
self cast descrpt_deriv|mstype float32 descrpt_deriv
self reshape descrpt_deriv|(1|192|138|4|3) descrpt_deriv
self cast net_deriv_reshape|mstype float32 net_deriv_reshape
self reshape net_deriv_reshape|(1|192|138|4) net_deriv_reshape
self expdims net_deriv_reshape|4 net_deriv_reshape
self broadcastto2 net_deriv_reshape net_deriv_reshape
self cast rij|mstype float32 rij
self reshape rij|(1|192|138|3) rij
self expdims rij|3 rij
self expdims rij|4 rij
self broadcastto1 rij rij
self cast nlist|mstype int32 nlist
self reshape nlist|(1|192|138) nlist
self expdims nlist|3 nlist
self broadcastto3 nlist nlist
descrpt_deriv|net_deriv_reshape tmp
self cast nlist b_blist
self expdims b_blist|3 b_blist
self broadcastto2 b_blist b_blist
tmp|b_blist tmp_1
self expdims tmp_1|5 tmp_1
self broadcastto1 tmp_1 tmp_1
tmp_1|rij out
self rsum out|(1|2|3) out
self cast descrpt_deriv|mstype float32 descrpt_deriv tmp
self reshape descrpt_deriv|(1|192|138|4|3) descrpt_deriv tmp
self cast net_deriv_reshape|mstype float32 net_deriv_reshape tmp
self reshape net_deriv_reshape|(1|192|138|4) net_deriv_reshape tmp
self expdims net_deriv_reshape|4 net_deriv_reshape tmp
self broadcastto2 net_deriv_reshape net_deriv_reshape tmp
self cast rij|mstype float32 rij out
self reshape rij|(1|192|138|3) rij out
self expdims rij|3 rij out
self expdims rij|4 rij out
self broadcastto1 rij rij out
descrpt_deriv|net_deriv_reshape tmp tmp_1
self cast nlist b_blist tmp_1
self expdims b_blist|3 b_blist tmp_1
self broadcastto2 b_blist b_blist tmp_1
tmp|b_blist tmp_1 out
self expdims tmp_1|5 tmp_1 out
self broadcastto1 tmp_1 tmp_1 out
[192|192|64|128] natoms
-1 rcut_a
[46|92] sel_a
[0|0] sel_r
len sel_a ntypes
nnei_a|nnei_r nnei
nnei_a|4 ndescrpt_a
nnei_r|1 ndescrpt_r
ndescrpt_a|ndescrpt_r ndescrpt
[25|50|100] filter_neuron
filter_neuron|16 dim_descrpt
[240|240|240] n_neuron
[-93 57|-187 15] type_bias_ae
super MDNet|self __init__
P Reshape self reshape
P Shape self shape
nn Tanh self tanh
P MatMul self mat
nn MatMul self batchmat
[self idt1|self idt2|self idt3|self idt4] self idt
[dim_descrpt]|n_neuron self neuron
|filter_neuron self par
Processing self process
range i
nn CellList fc self fc
deepcopy self fc self fc0
[self fc|self fc0] self fc2
Tensor weight_init
nn CellList fc self fc1
np vstack (np identity|np zeros [92|46]) xyz_A
Tensor np reshape xyz_A|(1|138|46) self xyz_A
np vstack (np zeros [46|92]) xyz_B
Tensor np reshape xyz_B|(1|138|92) self xyz_B
np vstack (np identity n_axis_neuron) xyz_2
Tensor xyz_2 self xyz_2
self shape inputs shape
(slice_0|slice_1) slice_inputs
range type_i
slice_inputs type_i xyz_scatter
self shape xyz_scatter shape_i
self reshape xyz_scatter|(-1|1) xyz_scatter
self tanh fc xyz_scatter xyz_scatter
self tanh fc xyz_scatter hidden
fc xyz_scatter|hidden xyz_scatter
self reshape xyz_scatter|(-1|shape_i|100) xyz_scatter
xyz_scatter_total append xyz_scatter
self batchmat self xyz_A|xyz_scatter_total|self batchmat(self xyz_B|xyz_scatter_total) xyz_scatter
self batchmat_tran inputs|xyz_scatter xyz_scatter_1
xyz_scatter_1|(4 0|(shape|shape)) xyz_scatter_1
self batchmat xyz_scatter_1|self xyz_2 xyz_scatter_2
self batchmat_tran xyz_scatter_1|xyz_scatter_2 result
(slice0|slice1|h|slice2|slice3|o) slice_data
self reshape layer|(-1|dim_descrpt) layer
self tanh self fc1 layer layer
layer|self tanh(self fc1) layer
self fc1 layer final_layer
l_layer append final_layer
self concat0 (l_layer|l_layer) outs
self reshape outs|(-1|)
self process inputs o
self _fitting slice0|slice1|h|slice2|slice3|o dout
super Processing|self __init__
P Slice self slice
P Split 1|3 self split
Tensor np hstack (np identity|np zeros [64|128]) slice_64
Tensor np hstack (np zeros [128|64]) slice_128
[slice_64|slice_128] self slice_0
Tensor np hstack (np identity|np zeros [46|92]) slice_46
Tensor np hstack (np zeros [92|46]) slice_92
[slice_46|slice_92] self slice_1
np vstack (np identity|np zeros [3|1]) slice_2
Tensor slice_2 self slice_2
self split inputs split_tensor
self reshape split_tensor|(-1|138|4) split_64
self reshape self concat (split_tensor|split_tensor) split_128
(split_64|split_128) split_t
range type_j
self batchmat self slice_1 type_j]|split_t[type_i inputs_reshape
self batchmat inputs_reshape|self slice_2 xyz_scatter
slice_data append xyz_scatter
slice_data append split_t type_i
slice_data|slice_data|slice_data| o
super Grad|self __init__
network self network
self grad self network x gout
super Network|self __init__
P ReduceSum self sum
MDNet self mdnet
Grad self mdnet self grad
DescriptorSeA self descrpt_se_a
ProdVirialSeA self prod_virial_se_a
P ProdForceSeA self prod_force_se_a
 descrpt_deriv
self descrpt_se_a d_coord|d_nlist|frames|avg|std|atype
self mdnet descrpt atom_ener
atom_ener energy_raw
self reshape energy_raw|(-1|natoms) energy_raw
self sum energy_raw|1 energy
self grad descrpt net_deriv
self reshape net_deriv|(-1|natoms|ndescrpt) net_deriv_reshape
self reshape descrpt_deriv|(-1|natoms|ndescrpt|3) descrpt_deriv_reshape
self prod_virial_se_a net_deriv_reshape|descrpt_deriv_reshape|rij|nlist virial
self prod_force_se_a net_deriv_reshape|descrpt_deriv_reshape|nlist force
nnei_a|nnei_r nnei nnei
nnei_a|4 ndescrpt_a ndescrpt
nnei_r|1 ndescrpt_r ndescrpt
ndescrpt_a|ndescrpt_r ndescrpt ndescrpt
[25|50|100] filter_neuron dim_descrpt
[25|50|100] filter_neuron self par
[240|240|240] n_neuron self neuron
nn CellList fc self fc xyz_scatter|hidden xyz_scatter
(slice_0|slice_1) slice_inputs type_i xyz_scatter
self batchmat_tran inputs|xyz_scatter xyz_scatter_1 0|(shape|shape)) xyz_scatter_1
xyz_scatter_1|(4 0|(shape|shape)) xyz_scatter_1 0|(shape|shape)) xyz_scatter_1
(slice0|slice1|h|slice2|slice3|o) slice_data append xyz_scatter
(slice0|slice1|h|slice2|slice3|o) slice_data append split_t type_i
(slice0|slice1|h|slice2|slice3|o) slice_data o
self reshape layer|(-1|dim_descrpt) layer tanh(self fc1) layer
self tanh self fc1 layer layer tanh(self fc1) layer
layer|self tanh(self fc1) layer tanh(self fc1) layer
self reshape  descrpt_deriv
P Slice self slice self slice_0
P Slice self slice self slice_1
P Slice self slice o
P Split 1|3 self split split_t
Tensor np hstack (np identity|np zeros [64|128]) slice_64 self slice_0
Tensor np hstack (np zeros [128|64]) slice_128 self slice_0
Tensor np hstack (np identity|np zeros [46|92]) slice_46 self slice_1
Tensor np hstack (np zeros [92|46]) slice_92 self slice_1
self reshape split_tensor|(-1|138|4) split_64 split_t
self reshape self concat (split_tensor|split_tensor) split_128 split_t
self mdnet descrpt atom_ener energy_raw
[3|3|3|3|3] kernel_size
|5 padding
[ 2|4] maxpool
load_checkpoint cfg checkpoint_path||cfg model_name param_dict
load_param_into_net network|param_dict
np random uniform 0 0|1 0|size input_data
Tensor input_data
Tensor input_data
int type
parser parse_args args
context GRAPH_MODE mode
context set_context cfg mixed_precision enable_auto_mixed_precision
[3|3|3|3|3] kernel_size
|5 padding
[ 2|4] maxpool
load_param_into_net network|param_dict
BCELoss net_loss
network set_train True
cfg lr learning_rate
Model network|net_loss|net_opt|loss_scale_manager net_model
cfg data_dir dataset_direct
cfg train_filename filename
cfg num_consumer num_consumer
cfg batch_size batch
cfg epoch_size epoch
cfg save_step save_checkpoint_steps
cfg keep_checkpoint_max keep_checkpoint_max
cfg prefix prefix
load_param_into_net network set_train True
BCELoss net_loss net_model
labels_list shape||2 n_bins
labels_list reshape -1|1 labels_list
preds_list reshape -1|1 preds_list
range i
labels_list labels
preds_list preds
labels sum postive_len
labels shape-postive_len negative_len
postive_len|negative_len total_case
np zeros (n_bins) positive_histogram
np zeros (n_bins) negative_histogram
enumerate j|_
int preds j nth_bin
positive_histogram nth_bin positive_histogram nth_bin
negative_histogram nth_bin negative_histogram nth_bin
range k
negative_histogram k accumulated_negative
auc append satisfied_pair|total_case
np mean auc
data_train create_tuple_iterator data_train
net Tensor data|dtype x
res_pred append x asnumpy
res_true append label asnumpy
calculate_auc res_true|res_pred auc
load_checkpoint model_path param_dict
load_param_into_net net|param_dict
val net|data_dir|filename|num_consumer|batch auc
int type
parser parse_args args
context GRAPH_MODE mode
[3|3|3|3|3] kernel_size
|5 padding
[ 2|4] maxpool
network set_train False
print  format auc_val
labels_list labels sum postive_len
labels_list labels shape-postive_len negative_len
labels sum postive_len total_case
labels shape-postive_len negative_len total_case
np zeros (n_bins) positive_histogram nth_bin positive_histogram nth_bin
np zeros (n_bins) negative_histogram nth_bin negative_histogram nth_bin
np zeros (n_bins) negative_histogram k accumulated_negative
 data_cfg
 music_cfg
super MusicTaggerCNN|self __init__
in_classes self in_classes
kernel_size self kernel_size
maxpool self maxpool
padding self padding
has_bias self has_bias
nn BatchNorm2d self in_classes self bn1
nn BatchNorm2d self in_classes self bn2
nn BatchNorm2d self in_classes self bn3
nn BatchNorm2d self in_classes self bn4
nn MaxPool2d maxpool|maxpool self pool1
nn MaxPool2d maxpool|maxpool self pool2
nn MaxPool2d maxpool|maxpool self pool3
nn MaxPool2d maxpool|maxpool self pool4
nn ReLU self Act
nn Flatten self flatten
nn Sigmoid self sigmoid
self conv1 input_data x
self bn1 x x
self Act x x
self pool1 x x
self conv2 x x
self bn2 x x
self pool2 x x
self conv3 x x
self bn3 x x
self pool3 x x
self conv4 x x
self bn4 x x
self poolreduce x|(2|3) x
self flatten x x
self dense x x
os path join base_path|filename path
ds MindDataset path|columns_list|num_consumer dtrain
dtrain shuffle buffer_size dtrain
ds MindDataset path|columns_list|num_consumer dtrain shuffle buffer_size dtrain
super BCELoss|self __init__ record
P ScalarSummary self sm_scalar
P Cast self cast
record self record
P BinaryCrossEntropy self bce
self cast target|mstype float32 target
self bce input_data|target|self weight loss
self sm_scalar loss
super BCELoss|self __init__ record self record
librosa load audio_path|sr _
src shape n_sample
int DURA|SR n_sample_fit
np hstack (src|np zeros (int(DURA|SR)-n_sample|)) src
librosa core amplitude_to_db logam
librosa feature melspectrogram melgram
logam ret
save_path|filename save_path
np save save_path|ret
{} data_json
data_list append data_json
s isdigit
int s
info readline data
convert i
data strip decode split i
pd DataFrame T|columns annotation
annotation columns i
count append [annotation[i] sum|len annotation|i]
sorted count count
count i
full_label append i
T i
L append i
label j
full_label index j ind
out append L
np array out out
out i
np random rand
Train append i
Val append i
np array Train
np array Val
range i
label append np array df
np int32 dtype
generator_md info_name|file_path|num_classes label
FileWriter writer
get_data data|label datax
writer add_schema schema_json|
writer add_index
writer write_raw_data datax
writer commit
int type
parser parse_args args
GetLabel cfg info_path|cfg info_name
os listdir cfg audio_path dirname
dirname d
os listdir  format cfg audio_path|d file_name
os path isdir  format cfg npy_path|d
os mkdir  format cfg npy_path|d
file_name f
context GRAPH_MODE mode
cfg mr_nam cmn
librosa core amplitude_to_db logam ret
save_path|filename save_path save_path
info readline data strip decode split i
pd DataFrame T|columns annotation columns i
sorted count count i
np array out out i
FileWriter writer add_schema schema_json|
FileWriter writer add_index
FileWriter writer write_raw_data datax
FileWriter writer commit
os listdir cfg audio_path dirname d
os listdir  format cfg audio_path|d file_name f
argparse ArgumentParser parser
eval_config parser model_settings
DSCNN model_settings|args model_size_info network
load_ckpt network|args model_dir|False
zip top5|gt
val_dataset create_tuple_iterator val_dataloader
val_dataloader data|gt_classes
model predict Tensor data|mstype float32 output
output asnumpy output
np argmax output top1_output
np argsort output top5_output
gt_classes asnumpy gt_classes
np equal top1_output|gt_classes sum t1_correct
t1_correct top1_correct
get_top5_acc top5_output|gt_classes top5_correct
output shape img_tot
 [top1_correct]|[top5_correct]|[img_tot] results
np array results results
results 0|0 top1_correct
results 1|0 top5_correct
results 2|0 img_tot
acc1 args best_acc
args epoch_cnt-1 args best_epoch
callback_func args|cb| format(args epoch_cnt) callbacks
callbacks|dataset_sink_mode callbacks
val args|model|val_dataset
argparse ArgumentParser parser
train_config parser model_settings
os path join args ckpt_path|datetime datetime now strftime args outputs_dir
get_logger args outputs_dir args logger
train_dataset get_dataset_size args steps_per_epoch
args logger save_args args
args logger important_info
DSCNN model_settings|args model_size_info network
os path isfile args pretrained
load_checkpoint args pretrained|network
args logger info  format args pretrained
CrossEntropy num_classes criterion
NotImplementedError args lr_scheduler
lr_scheduler get_lr lr_schedule
Tensor lr_schedule learning_rate
args momentum momentum
ProgressMonitor args progress_cb
trainval args|model|train_dataset|val_dataset|progress_cb
args max_epoch-args epoch_cnt rest_ep
args logger info  format args best_epoch|args best_acc
zip  [top1_correct]|[top5_correct]|[img_tot] results
val_dataset create_tuple_iterator val_dataloader data|gt_classes
val_dataloader gt_classes asnumpy gt_classes
val_dataloader  [top1_correct]|[top5_correct]|[img_tot] results
model predict Tensor data|mstype float32 output asnumpy output
model predict Tensor data|mstype float32 output shape img_tot
np equal top1_output|gt_classes sum t1_correct top1_correct
 [top1_correct]|[top5_correct]|[img_tot] results 0|0 top1_correct
 [top1_correct]|[top5_correct]|[img_tot] results 1|0 top5_correct
 [top1_correct]|[top5_correct]|[img_tot] results 2|0 img_tot
np array results results 0|0 top1_correct
np array results results 1|0 top5_correct
np array results results 2|0 img_tot
callback_func args|cb| format(args epoch_cnt) callbacks callbacks
callbacks|dataset_sink_mode callbacks callbacks
val val args|model|val_dataset
val args logger save_args args
val args logger important_info
val args logger info  format args pretrained
val args momentum momentum
val args max_epoch-args epoch_cnt rest_ep
val args logger info  format args best_epoch|args best_acc
NotImplementedError args lr_scheduler get_lr lr_schedule
trainval args max_epoch-args epoch_cnt rest_ep
trainval args logger info  format args best_epoch|args best_acc
zip top5|gt
test_de create_tuple_iterator eval_dataloader
eval_dataloader data|gt_classes
model predict Tensor data|mstype float32 output
output asnumpy output
np argmax output top1_output
np argsort output top5_output
gt_classes asnumpy gt_classes
np equal top1_output|gt_classes sum t1_correct
t1_correct top1_correct
get_top5_acc top5_output|gt_classes top5_correct
output shape img_tot
 [top1_correct]|[top5_correct]|[img_tot] results
np array results results
results 0|0 top1_correct
results 1|0 top5_correct
results 2|0 img_tot
acc1 args best_acc
args index args best_index
argparse ArgumentParser parser
eval_config parser model_settings
os path join args log_path|datetime datetime now strftime args outputs_dir
get_logger args outputs_dir args logger
args logger save_args args
os path isdir args model_dir
list glob glob os path join args model_dir| models
print models
sorted models|key args models
[args model_dir] args models
args models model_path
DSCNN model_settings|args model_size_info network
load_ckpt network|model_path|False
network set_train False
Model network model
args logger info  format model_path
val args|model|test_de
args logger info  format args models[args best_index]|args best_acc
zip  [top1_correct]|[top5_correct]|[img_tot] results
test_de create_tuple_iterator eval_dataloader data|gt_classes
eval_dataloader gt_classes asnumpy gt_classes
eval_dataloader  [top1_correct]|[top5_correct]|[img_tot] results
model predict Tensor data|mstype float32 output asnumpy output
model predict Tensor data|mstype float32 output shape img_tot
np equal top1_output|gt_classes sum t1_correct top1_correct
 [top1_correct]|[top5_correct]|[img_tot] results 0|0 top1_correct
 [top1_correct]|[top5_correct]|[img_tot] results 1|0 top5_correct
 [top1_correct]|[top5_correct]|[img_tot] results 2|0 img_tot
np array results results 0|0 top1_correct
np array results results 1|0 top5_correct
np array results results 2|0 img_tot
list glob glob os path join args model_dir| models args models
print models args models
sorted models|key args models args models
DSCNN model_settings|args model_size_info network set_train False
load_ckpt network set_train False
val args logger info  format args models[args best_index]|args best_acc
super ProgressMonitor|self __init__
args self args
self args logger info
time time self step_start_time
run_context original_args cb_params
time time-self step_start_time time_used
self args per_batch_size|self args log_interval|time_used fps_mean
time time self epoch_start_time
self args steps_per_epoch|(self args epoch_cnt|1)-1 self globe_step_cnt
time time-self epoch_start_time time_used
self args per_batch_size|self args steps_per_epoch|time_used fps_mean
[cb] callbacks
args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num
CheckpointConfig save_checkpoint_steps ckpt_config
ModelCheckpoint config ckpt_cb
callbacks append ckpt_cb
[cb] callbacks append ckpt_cb
warmup_init_lr self warmup_init_lr
lr self base_lr
int warmup_epochs|steps_per_epoch self warmup_steps
super _LinearWarmUp|self __init__ warmup_init_lr
(float(self base_lr)-float(self warmup_init_lr))|float(self warmup_steps) lr_inc
float self warmup_init_lr|lr_inc|current_step lr
steps_per_epoch self steps_per_epoch
int max_epoch|steps_per_epoch self total_steps
(1|steps_per_epoch|max_epoch) shape
scheduler get_lr lr
_LinearWarmUp lr|warmup_epochs|steps_per_epoch self warmup
super LambdaLR|self __init__ lr|max_epoch|steps_per_epoch
self warmup get_warmup_steps warmup_steps
range i
self warmup get_lr i|1 lr
i||self steps_per_epoch cur_ep
lr_each_step append lr
np array lr_each_step astype np float32
super MultiplicativeLR|self __init__ lr|max_epoch|steps_per_epoch
self base_lr current_lr
current_lr lr
epoch_size self epoch_size
gamma self gamma
super StepLR|self __init__ lr|max_epoch|steps_per_epoch
self base_lr|self gamma(cur_ep||self epoch_size) lr
end_lr self end_lr
power self power
max_epoch self max_epoch
lr self lr
super POLYLR|self __init__ lr|max_epoch|steps_per_epoch
self steps_per_epoch|self max_epoch total_steps
min i|total_steps step_
lr_each_step append (self lr-self end_lr)|((1 0-step_|total_steps)self power)|self end_lr
print lr_each_step
Counter milestones self milestones
super MultiStepLR|self __init__ lr|max_epoch|steps_per_epoch
current_lr|self gamma current_lr
super ExponentialLR|self __init__ lr|max_epoch|steps_per_epoch
left 1-\cos\left \frac{T_{max}}\pi\right\right
(2k|1)T_{max}  T_{cur}
T_max self t_max
eta_min self eta_min
super CosineAnnealingLR|self __init__ lr|max_epoch|steps_per_epoch
self eta_min|(self base_lr-self eta_min)| current_lr
max_lr self max_lr
float step_size_up step_size_up
step_size_up|step_size_down self total_size
step_size_up|self total_size self step_ratio
mode self mode
self _triangular_scale_fn self scale_fn
self _triangular2_scale_fn self scale_fn
self _exp_range_scale_fn self scale_fn
scale_fn self scale_fn
scale_mode self scale_mode
super CyclicLR|self __init__ lr|max_epoch|steps_per_epoch
math floor 1|i|self total_size cycle
x|self step_ratio scale_factor
(x-1)|(self step_ratio-1) scale_factor
(self max_lr-self base_lr)|scale_factor base_height
self base_lr|base_height|self scale_fn cycle lr
self base_lr|base_height|self scale_fn i lr
T_{i} T_{cur}
ValueError  format T_0
isinstance T_mult|int
T_0 self t_0
T_0 self t_i
T_mult self t_mult
super CosineAnnealingWarmRestarts|self __init__ lr|max_epoch|steps_per_epoch
self t_cur-self t_i self t_cur
self t_i|self t_mult self t_i
self eta_min|(self base_lr-self eta_min)| lr
lr|div_factor max_lr
lr|final_div_factor min_lr
super OneCycleLR|self __init__ lr|max_epoch|steps_per_epoch
float pct_start|self total_steps-1 self step_size_up
float self total_steps-self step_size_up-1 self step_size_down
isinstance pct_start|float
ValueError  format pct_start
ValueError  format anneal_strategy
self _annealing_cos self anneal_func
self _annealing_linear self anneal_func
lr|div_factor self max_lr
lr|final_div_factor self min_lr
math cos math pi|pct|1 cos_out
self anneal_func self base_lr|self max_lr|i|self step_size_up lr
i-self step_size_up down_step_num
self anneal_func self max_lr|self min_lr|down_step_num|self step_size_down lr
float self warmup_init_lr|lr_inc|current_step lr self lr
float self warmup_init_lr|lr_inc|current_step lr gamma current_lr
float self warmup_init_lr|lr_inc|current_step lr max_lr
float self warmup_init_lr|lr_inc|current_step lr min_lr
float self warmup_init_lr|lr_inc|current_step lr self max_lr
float self warmup_init_lr|lr_inc|current_step lr self min_lr
scheduler get_lr lr self lr
scheduler get_lr lr gamma current_lr
scheduler get_lr lr max_lr
scheduler get_lr lr min_lr
scheduler get_lr lr self max_lr
scheduler get_lr lr self min_lr
super LambdaLR|self __init__ max_epoch self max_epoch
super LambdaLR|self __init__ lr self lr
range i steps_per_epoch cur_ep
self warmup get_lr i|1 lr self lr
self warmup get_lr i|1 lr gamma current_lr
self warmup get_lr i|1 lr max_lr
self warmup get_lr i|1 lr min_lr
self warmup get_lr i|1 lr self max_lr
self warmup get_lr i|1 lr self min_lr
lr_each_step append lr self lr
lr_each_step append lr gamma current_lr
lr_each_step append lr max_lr
lr_each_step append lr min_lr
lr_each_step append lr self max_lr
lr_each_step append lr self min_lr
super MultiplicativeLR|self __init__ max_epoch self max_epoch
super MultiplicativeLR|self __init__ lr self lr
self base_lr current_lr lr
self base_lr current_lr gamma current_lr
current_lr lr self lr
current_lr lr gamma current_lr
current_lr lr max_lr
current_lr lr min_lr
current_lr lr self max_lr
current_lr lr self min_lr
super StepLR|self __init__ max_epoch self max_epoch
super StepLR|self __init__ lr self lr
self base_lr|self gamma(cur_ep||self epoch_size) lr self lr
self base_lr|self gamma(cur_ep||self epoch_size) lr gamma current_lr
self base_lr|self gamma(cur_ep||self epoch_size) lr max_lr
self base_lr|self gamma(cur_ep||self epoch_size) lr min_lr
self base_lr|self gamma(cur_ep||self epoch_size) lr self max_lr
self base_lr|self gamma(cur_ep||self epoch_size) lr self min_lr
min i|total_steps step_ self total_size
current_lr|self gamma current_lr gamma current_lr
float step_size_up step_size_up self total_size
float step_size_up step_size_up total_size self step_ratio
self _triangular_scale_fn self scale_fn self scale_fn
self _triangular2_scale_fn self scale_fn self scale_fn
self _exp_range_scale_fn self scale_fn self scale_fn
self base_lr|base_height|self scale_fn cycle lr max_lr
self base_lr|base_height|self scale_fn cycle lr min_lr
self base_lr|base_height|self scale_fn cycle lr self max_lr
self base_lr|base_height|self scale_fn cycle lr self min_lr
self base_lr|base_height|self scale_fn i lr max_lr
self base_lr|base_height|self scale_fn i lr min_lr
self base_lr|base_height|self scale_fn i lr self max_lr
self base_lr|base_height|self scale_fn i lr self min_lr
ValueError  format T_0 self t_0
ValueError  format T_0 self t_i
isinstance T_mult self t_mult
self eta_min|(self base_lr-self eta_min)| lr max_lr
self eta_min|(self base_lr-self eta_min)| lr min_lr
self eta_min|(self base_lr-self eta_min)| lr self max_lr
self eta_min|(self base_lr-self eta_min)| lr self min_lr
data_config parser
parser parse_known_args _
bool flags use_graph_mode flags dataset_sink_mode
list map int|flags lr_epochs split flags lr_epochs
prepare_model_settings model_settings
len prepare_words_list flags wanted_words split
flags drop model_settings
int sample_rate|clip_duration_ms|1000 desired_samples
int sample_rate|window_size_ms|1000 window_size_samples
int sample_rate|window_stride_ms|1000 window_stride_samples
(desired_samples-window_size_samples) length_minus_window
dct_coefficient_count|spectrogram_length fingerprint_size
data_config parser parse_known_args _
load_checkpoint pretrain_ckpt_path param_dict
load_param_into_net network|param_dict
network get_parameters param
load_param_into_net network get_parameters param
super DepthWiseConv|self __init__
has_bias self has_bias
P BiasAdd self bias_add
[channel_multiplier|in_planes|kernel_size|kernel_size] weight_shape
Parameter initializer weight_shape self weight
[channel_multiplier|in_planes] bias_shape
Parameter initializer bias_shape self bias
self depthwise_conv x|self weight output
self bias_add output|self bias output
super DSCNN|self __init__
model_settings label_count
model_settings input_frequency_size
model_settings input_time_size
input_time_size t_dim
input_frequency_size f_dim
model_size_info num_layers
[None]|num_layers conv_feat
[None]|num_layers conv_kt
[None]|num_layers conv_kf
[None]|num_layers conv_st
[None]|num_layers conv_sf
range layer_no
model_size_info i conv_feat layer_no
model_size_info i conv_kt layer_no
model_size_info i conv_kf layer_no
model_size_info i conv_st layer_no
model_size_info i conv_sf layer_no
(conv_kt[layer_no]|conv_kf[layer_no]) kernel_size
(conv_st[layer_no]|conv_sf[layer_no]) stride
conv_feat layer_no in_channel
seq_cell append nn ReLU
math ceil t_dim|float(conv_st[layer_no]) t_dim
math ceil f_dim|float(conv_sf[layer_no]) f_dim
(t_dim nn AvgPool2d kernel_size|f_dim) seq_cell append
seq_cell append nn Flatten
seq_cell append nn Dropout model_settings
seq_cell append nn Dense in_channel|label_count
nn SequentialCell seq_cell self model
self model x x
model_settings input_frequency_size f_dim
model_settings input_time_size t_dim
model_size_info num_layers conv_feat
model_size_info num_layers conv_kt
model_size_info num_layers conv_kf
model_size_info num_layers conv_st
model_size_info num_layers conv_sf
[None]|num_layers conv_feat layer_no in_channel
[None]|num_layers conv_kf kernel_size
[None]|num_layers conv_sf stride
super LOGGER|self __init__ logger_name
logging StreamHandler sys stdout console
console setLevel logging INFO
logging Formatter formatter
console setFormatter formatter
self addHandler console
rank self rank
os path exists log_dir
datetime now strftime| format rank log_name
os path join log_dir|log_name self log_fn
logging FileHandler self log_fn fh
fh setLevel logging INFO
fh setFormatter formatter
self addHandler fh
self isEnabledFor logging INFO
self _log logging INFO|msg|args|kwargs
self info
vars args args_dict
args_dict keys key
self info key|args_dict[key]
|line_width important_msg
|2 important_msg
self info important_msg|args|kwargs
LOGGER logger_name_1|rank logger
logger setup_logging_file path|rank
logging StreamHandler sys stdout console setLevel logging INFO
logging StreamHandler sys stdout console setFormatter formatter
logging FileHandler self log_fn fh setLevel logging INFO
logging FileHandler self log_fn fh setFormatter formatter
vars args args_dict keys key
LOGGER logger_name_1|rank logger setup_logging_file path|rank
super LOGGER|self __init__ logger_name
logging StreamHandler sys stdout console
console setLevel logging INFO
logging Formatter formatter
console setFormatter formatter
self addHandler console
os path exists log_dir
datetime now strftime log_name
os path join log_dir|log_name self log_fn
logging FileHandler self log_fn fh
fh setLevel logging INFO
fh setFormatter formatter
self addHandler fh
self isEnabledFor logging INFO
self _log logging INFO|msg|args|kwargs
self info
vars args args_dict
args_dict keys key
self info key|args_dict[key]
|line_width important_msg
|2 important_msg
self info important_msg|args|kwargs
LOGGER logger_name_1 logger
logger setup_logging_file path
logging StreamHandler sys stdout console setLevel logging INFO
logging StreamHandler sys stdout console setFormatter formatter
logging FileHandler self log_fn fh setLevel logging INFO
logging FileHandler self log_fn fh setFormatter formatter
vars args args_dict keys key
LOGGER logger_name_1 logger setup_logging_file path
os path basename filename base_name
re sub base_name hash_name
hashlib sha1 bytes hash_name| hexdigest hash_name_hashed
data_dir self data_dir
self maybe_download_and_extract_dataset data_url|data_dir
self prepare_background_data
self prepare_data model_settings
os path exists dest_directory
os makedirs dest_directory
data_url split filename
os path join dest_directory|filename filepath
os path exists filepath
sys stdout flush
urllib request urlretrieve data_url|filepath|_progress _
os stat filepath statinfo
tarfile open filepath| extractall dest_directory
random seed RANDOM_SEED
enumerate index|wanted_word
index|2 wanted_words_index wanted_word
{} self data_index
{} unknown_index
os path join self data_dir search_path
glob wav_path
os path split os path dirname wav_path word
word lower word
which_set wav_path|validation_percentage|testing_percentage set_index
self data_index set_index append({:wav_path})
unknown_index set_index append({:wav_path})
Exception |search_path
self data_index silence_wav_path
len self data_index set_index set_size
int math ceil set_size|silence_percentage|100 silence_size
range _
random shuffle unknown_index set_index
int math ceil set_size|unknown_percentage|100 unknown_size
random shuffle self data_index set_index
prepare_words_list wanted_words self words_list
all_words word
wanted_words_index word self word_to_index word
UNKNOWN_WORD_INDEX self word_to_index word
SILENCE_INDEX self word_to_index SILENCE_LABEL
os path join self data_dir|BACKGROUND_NOISE_DIR_NAME background_dir
os path exists background_dir
sf read wav_path _
self background_data append wav_data
sf read wav_filename _
len wav_data
np pad wav_data|[0|desired_samples-len(wav_data)] wav_data
wav_data|foreground_volume scaled_foreground
np pad scaled_foreground|time_shift_padding padded_foreground
padded_foreground sliced_foreground
background_data|background_volume|sliced_foreground background_add
np clip background_add|-1 0|1 0 background_clamp
FLAGS window_stride_ms|1000 winstep
int (FLAGS time_shift_ms|FLAGS sample_rate)|1000 time_shift
FLAGS background_frequency background_frequency
FLAGS background_volume background_volume_range
model_settings desired_samples
os path exists FLAGS feat_dir
self data_index mode candidates
len candidates sample_count
np zeros (sample_count|model_settings) data
np zeros sample_count labels
tqdm i
i sample_index
candidates sample_index sample
np random randint -time_shift|time_shift time_shift_amount
 [time_shift_amount|0] time_shift_padding
 [0|-time_shift_amount] time_shift_padding
-time_shift_amount time_shift_offset
np random randint len self background_data background_index
self background_data background_index background_samples
np random randint background_offset
background_samples background_offset background_clipped
background_clipped reshape [desired_samples|1] background_reshaped
np random uniform 0|1
np random uniform 0|background_volume_range background_volume
np zeros [desired_samples|1] background_reshaped
self word_to_index sample label_index
label_index labels i
np save os path join FLAGS feat_dir| format mode|data
np save os path join FLAGS feat_dir| format mode|labels
argparse ArgumentParser parser
train_config parser
parser parse_known_args unparsed
prepare_model_settings model_settings_1
len prepare_words_list FLAGS wanted_words split
AudioProcessor audio_processor
FLAGS wanted_words split
self maybe_download_and_extract_dataset data_url split filename
self maybe_download_and_extract_dataset  [time_shift_amount|0] time_shift_padding
self maybe_download_and_extract_dataset  [0|-time_shift_amount] time_shift_padding
self prepare_data model_settings desired_samples
enumerate  [time_shift_amount|0] time_shift_padding
enumerate  [0|-time_shift_amount] time_shift_padding
{} unknown_index set_index append({:wav_path})
os path split os path dirname wav_path word lower word
Exception  [time_shift_amount|0] time_shift_padding
Exception  [0|-time_shift_amount] time_shift_padding
self background_data append wav_data scaled_foreground
len wav_data scaled_foreground
np pad wav_data|[0|desired_samples-len(wav_data)] wav_data scaled_foreground
np pad scaled_foreground|time_shift_padding padded_foreground sliced_foreground
padded_foreground sliced_foreground background_add
self data_index mode candidates sample_index sample
tqdm i sample_index
self background_data background_index background_samples background_offset background_clipped
background_samples background_offset background_clipped reshape [desired_samples|1] background_reshaped
self word_to_index sample label_index labels i
argparse ArgumentParser parser parse_known_args unparsed
train_config parser parse_known_args unparsed
super NpyDataset|self __init__
np load os path join data_dir| format data_type self data
np reshape self data|(-1|1|h|w) self data
np load os path join data_dir| format data_type self label
self data item data
self label item label
data astype np float32|label astype np int32
NpyDataset data_dir|data_type|h|w dataset
de GeneratorDataset dataset||shuffle de_dataset
np load os path join data_dir| format data_type self data astype np float32|label astype np int32
np reshape self data|(-1|1|h|w) self data astype np float32|label astype np int32
self data item data astype np float32|label astype np int32
super CrossEntropy|self __init__
P OneHot self onehot
Tensor 1 0-smooth_factor|mstype float32 self on_value
Tensor 1 0|smooth_factor|(num_classes-1) self off_value
nn SoftmaxCrossEntropyWithLogits self ce
P ReduceMean False self mean
self ce logit|one_hot_label loss
self mean loss|0 loss
parser parse_args args
CenterNetMultiPoseEval net_config|eval_config flip_test|eval_config K net
net set_train False
load_checkpoint export_config ckpt_file param_dict
load_param_into_net net|param_dict
[1|3|export_config input_res|export_config input_res] input_shape
Tensor np random uniform -1 0|1 0|size input_data
export_config export_name|file_format file_name
CenterNetMultiPoseEval net_config|eval_config flip_test|eval_config K net set_train False
net set_train False
parser parse_args args
s cmd
print __file__
parse_args args
args run_script_dir run_script
args data_dir data_dir
args mindrecord_dir mindrecord_dir
configparser ConfigParser cf
cf read args hyper_parameter_config_dir
dict cf items cfg
print args hccl_config_dir
print args hccl_time_out
append_cmd_env cmd|args hccl_time_out cmd
append_cmd_env cmd|args hccl_config_dir cmd
multiprocessing cpu_count cores
print cores
fin readlines hccn_item
hccn_item strip startswith
hccn_item split device_ip
device_id split device_id
device_ip strip device_ips device_id
json loads fin read hccl_config
hccl_config server
len server rank_size
device_ips values
server this_server
append_cmd_env cmd|str(rank_size) cmd
print rank_size
print len this_server
int int cores|len(this_server) avg_core_per_rank
avg_core_per_rank-1 core_gap
print avg_core_per_rank
this_server instance
instance device_id
instance rank_id
print rank_id
print device_id
count|int(avg_core_per_rank) start
start|core_gap end
str start||str(end) cmdopt
append_cmd_env cmd|str(device_id) cmd
append_cmd_env cmd|str(rank_id) cmd
append_cmd_env cmd cmd
append_cmd cmd||str(device_id) cmd
append_cmd cmd cmd
os getcwd cur_dir
print cmdopt
print str cfg
print data_dir
print mindrecord_dir
opt run_cmd
str rank_size
append_cmd cmd|run_cmd cmd
open args cmd_file|
f write cmd
parser parse_args args run_script_dir run_script
parser parse_args args data_dir data_dir
parser parse_args args mindrecord_dir mindrecord_dir
parse_args args run_script_dir run_script
parse_args args data_dir data_dir
parse_args args mindrecord_dir mindrecord_dir
configparser ConfigParser cf read args hyper_parameter_config_dir
fin readlines hccn_item strip startswith
fin readlines hccn_item split device_ip
hccn_item split device_ip strip device_ips device_id
json loads fin read hccl_config server
hccl_config server this_server
server this_server instance
print len this_server instance
avg_core_per_rank-1 core_gap end
this_server instance device_id
this_server instance rank_id
count|int(avg_core_per_rank) start end
files  ckpt
os path dirname os path realpath __file__ _current_dir
parser parse_args args_opt
[16 all_reduce_fusion_config|56|96|136|175] context set_auto_parallel_context
[18 all_reduce_fusion_config|59|100|141|182] context set_auto_parallel_context
network trainable_params params
list filter optimizer decay_filter|params other_params
_get_params_groups network|train_config Adam group_params
train_config PolyDecay end_learning_rate end_learning_rate
train_config PolyDecay warmup_steps warmup_steps
args_opt train_steps decay_steps
train_config MultiDecay multi_epochs multi_epochs
isinstance multi_epochs|(list|tuple)
[args_opt epoch_size] multi_epochs
train_config MultiDecay warmup_steps warmup_steps
dataset_size steps_per_epoch
args_opt save_checkpoint_path ckpt_save_dir
D init
args_opt device_num device_num
args_opt device_id%device_num rank
context reset_auto_parallel_context
device_num|8 num_workers
logger info
device_num|rank device_num
dataset get_dataset_size dataset_size
CenterNetMultiPoseLossCell net_config net_with_loss
args_opt epoch_size|dataset_size||args_opt data_sink_steps new_repeat_count
min new_repeat_count|args_opt train_steps||args_opt data_sink_steps new_repeat_count
args_opt epoch_size|dataset_size args_opt train_steps
logger info  format args_opt train_steps
_get_optimizer net_with_loss|dataset_size optimizer
[TimeMonitor args_opt data_sink_steps] callback
callback append ckpoint_cb
load_checkpoint args_opt load_checkpoint_path param_dict
load_param_into_net net_with_loss|param_dict
Model net_with_grads model
Profiler output_path profiler
profiler analyse
parser parse_args args_opt train_steps decay_steps
parser parse_args args_opt save_checkpoint_path ckpt_save_dir
parser parse_args args_opt device_num device_num
parser parse_args args_opt device_id%device_num rank
parser parse_args args_opt epoch_size|dataset_size||args_opt data_sink_steps new_repeat_count
parser parse_args args_opt epoch_size|dataset_size args_opt train_steps
args_opt device_num device_num num_workers
args_opt device_num device_num device_num
args_opt device_id%device_num rank device_num
device_num|rank device_num device_num
[TimeMonitor args_opt data_sink_steps] callback append ckpoint_cb
Profiler output_path profiler analyse
os path dirname os path realpath __file__ _current_dir
parser parse_args args_opt
logger info  format args_opt run_mode
COCOHP args_opt data_dir|dataset_config|net_config|run_mode coco
coco create_eval_dataset dataset
CenterNetMultiPoseEval net_config|eval_config flip_test|eval_config K net_for_eval
net_for_eval set_train False
load_checkpoint args_opt load_checkpoint_path param_dict
load_param_into_net net_for_eval|param_dict
os path join args_opt save_result_dir|args_opt run_mode save_path
os path exists save_path
os makedirs save_path
os path join save_path save_pred_image_path
os path exists save_pred_image_path
os makedirs save_pred_image_path
os path join save_path save_gt_image_path
os path exists save_gt_image_path
os makedirs save_gt_image_path
dataset get_dataset_size total_nums
print total_nums
{} pred_annos
data image
data asnumpy reshape image_id
time time start
eval_config multi_scales scale
coco pre_process_for_test image asnumpy|image_id|scale meta
net_for_eval Tensor images detection
post_process detection asnumpy|meta|scale dets
detections append dets
time time end
print  format index|total_nums|image_id|(end-start)|1000 
merge_outputs detections|soft_nms detections
convert_eval_format detections|image_id pred_json
coco coco loadImgs [image_id] gt_image_info
pred_json image_info
pred_annos append image_info
pred_json image_anno
pred_annos append image_anno
os path join coco image_path|gt_image_info img_file
cv2 imread img_file gt_image
coco coco loadAnns coco anns image_id annos
visual_image copy deepcopy gt_image|annos|save_gt_image_path
copy deepcopy pred_json anno
eval_config score_thresh score_threshold
os path join save_path| format(args_opt run_mode) pred_anno_file
json dump pred_annos|open pred_anno_file|
os path join save_path| format(args_opt run_mode) pred_res_file
json dump pred_annos|open pred_res_file|
run_eval coco annot_path|pred_res_file
COCO gt_anno coco
coco loadRes pred_anno coco_dets
COCOeval coco|coco_dets coco_eval
coco_eval evaluate
coco_eval accumulate
coco_eval summarize
COCOHP args_opt data_dir|dataset_config|net_config|run_mode coco create_eval_dataset dataset
COCOHP args_opt data_dir|dataset_config|net_config|run_mode coco pre_process_for_test image asnumpy|image_id|scale meta
COCOHP args_opt data_dir|dataset_config|net_config|run_mode coco coco loadImgs [image_id] gt_image_info
COCOHP args_opt data_dir|dataset_config|net_config|run_mode coco coco loadAnns coco anns image_id annos
COCOHP args_opt data_dir|dataset_config|net_config|run_mode coco loadRes pred_anno coco_dets
coco create_eval_dataset dataset get_dataset_size total_nums
CenterNetMultiPoseEval net_config|eval_config flip_test|eval_config K net_for_eval set_train False
CenterNetMultiPoseEval net_config|eval_config flip_test|eval_config K net_for_eval Tensor images detection
load_param_into_net net_for_eval Tensor images detection
{} pred_annos append image_info
{} pred_annos append image_anno
convert_eval_format detections|image_id pred_json image_info
convert_eval_format detections|image_id pred_json image_anno
visual_image copy deepcopy os path join save_path| format(args_opt run_mode) pred_anno_file
visual_image copy deepcopy os path join save_path| format(args_opt run_mode) pred_res_file
COCO gt_anno coco loadRes pred_anno coco_dets
COCOeval coco|coco_dets coco_eval evaluate
COCOeval coco|coco_dets coco_eval accumulate
COCOeval coco|coco_dets coco_eval summarize
cin int
cout int
stride int
dilation int
super BasicBlock|self __init__
ops ReLU self relu
x residual
self conv_bn_act x out
self conv_bn out out
residual out
self relu out out
kernel_size int
residual bool
super Root|self __init__
nn BatchNorm2d out_channels|momentum self bn
residual self residual
x children
self conv self cat x x
self bn x x
children x
self relu x x
levels listint
block Cell
in_channels listint
out_channels listint
level_root bool
root_dim int
root_kernel_size int
root_residual bool
super Tree|self __init__
levels self levels
in_channels root_dim
block in_channels|out_channels|stride|dilation self tree1
block out_channels|out_channels|1|dilation self tree2
Root root_dim|out_channels|root_kernel_size|root_residual self root
level_root self level_root
root_dim self root_dim
nn MaxPool2d stride|stride self downsample
(bottom|) children
self tree1 x|residual x1
self tree2 x1 x2
(x2|x1)|children ida_node
self root ida_node x
(x1|) children
self tree2 x1|children x
channels listint
residual_root bool
super DLA34|self __init__
channels self channels
self _make_conv_level channels|channels|levels self level0
[self level0|self level1|self level2|self level3|self level4|self level5] self dla_fn
range i
cout cin
nn SequentialCell modules
self base_layer x x
self dla_fn i x x
(x|) y
super DeformConv|self __init__
 self actf
BN_MOMENTUM momentum
nn ReLU
self conv x x
self actf x x
up_f int
enable_dcn bool
super IDAUp|self __init__
enable_dcn self enable_dcn
DeformConv cin|cout self proj
DeformConv cout|cout self node
self proj down_layer project
self up project upsample
self node upsample|up_layer node
self node self concat (upsample|up_layer) node
startp int
last_level int
super DLAUp|self __init__
startp self startp
last_level self last_level
len self channels self num_levels
len self channels
IDAUp channels i]|channels[i-1 ida_up
idaup_fns append ida_up
nn CellList idaup_fns self idaup_fns
range 1|self last_level i
final_fn append ida
nn CellList final_fn self final_idaup_fns
(stages[self startp]|) first_ups
(stages) ida_node
(ida_node|) ida_ups
range i|0| j
self idaup_fns j-1] ida_node|first_ups[i-j ida_node
ida_ups first_ups
first_ups self num_levels-1 final_up
range self startp i
self final_idaup_fns|final_up final_up
down_ratio int
stage_levels listint
stage_channels listint
super DLASeg|self __init__
int np log2 down_ratio self first_level
DLA34 stage_levels|stage_channels|block self dla
DLAUp self first_level|stage_channels|last_level self dla_up
self dla image stages
self dla_up stages output
cin int np log2 down_ratio self first_level
cout int np log2 down_ratio self first_level
stride int np log2 down_ratio self first_level
dilation int np log2 down_ratio self first_level
x residual out
x residual bool
x residual self residual
self conv_bn_act x out self tree1
self conv_bn_act x out self tree2
self conv_bn out out self tree1
self conv_bn out out self tree2
residual out self tree1
residual out self tree2
self relu out out self tree1
self relu out out self tree2
kernel_size int np log2 down_ratio self first_level
x children x
x children ida_node
self conv self cat x x ida_node
self conv self cat x x y
self bn x x ida_node
self bn x x y
children x ida_node
children x y
self relu x x ida_node
self relu x x y
root_dim int np log2 down_ratio self first_level
root_kernel_size int np log2 down_ratio self first_level
in_channels root_dim self root_dim
(bottom|) children ida_node
self tree1 x|residual x1 ida_node
self tree1 x|residual x1 children
self tree2 x1 x2 ida_node
(x2|x1)|children ida_node ida_ups
self root ida_node x y
self tree2 x1|children x y
range i j
self base_layer x x y
self dla_fn i x x y
up_f int np log2 down_ratio self first_level
DeformConv cout|cout self node ida_ups
self node upsample|up_layer node ida_ups
self node self concat (upsample|up_layer) node ida_ups
startp int np log2 down_ratio self first_level
last_level int np log2 down_ratio self first_level
len self channels self dla
range 1|self last_level i j
(stages[self startp]|) first_ups self num_levels-1 final_up
(stages) ida_node ida_ups
(ida_node|) ida_ups first_ups
ida_ups first_ups self num_levels-1 final_up
down_ratio int np log2 down_ratio self first_level
 dataset_config
np float32 dtype
 net_config
 train_config
 eval_config
 export_config
begin int
super GetOffsetPosition|self __init__
begin self begin
stride self stride
ops Meshgrid self meshgrid
ops Shape self shape
ops Reshape self reshape
ops Tile self tile
ops DType self dtype
nn Range -self begin|self begin|1 self range
ops Cast self cast
self shape offset offset_shape
offset_shape||2|offset_shape|offset_shape w
self range range_pn
self meshgrid (range_pn|range_pn) p_n_y
self cat_a0 (self reshape p_n_x|(N|1)) p_n
self reshape p_n|(1|2|N|1|1) p_n
nn Range self begin|h|self stride|1|self stride range_h
nn Range self begin|w|self stride|1|self stride range_w
self meshgrid (range_h|range_w) p_0_y
self reshape p_0_x|(1|1|h|w) p_0_x
self tile p_0_x|(1|N|1|1) p_0_x
self reshape p_0_y|(1|1|h|w) p_0_y
self tile p_0_y|(1|N|1|1) p_0_y
self cat_a1 (p_0_x|p_0_y) p_0
self dtype offset dtype
self cast p_0|dtype|self cast p_n|dtype|offset p
super GetSurroundFeature|self __init__
ops GatherNd self gather_nd
ops Transpose self transpose
(0|2|3|1) self perm_list
(0|3|1|2) self order_list
ops ExpandDims self expand_dims
self shape x w_p
self shape q_h N
h|w|N hwn
self transpose x|self perm_list x
self reshape x|(b|-1|c) x
q_h|w_p|q_w q
self reshape q|(-1|1) q
nn Range 0|b|1 ind_b
self reshape ind_b|(-1|1) ind_b
self tile ind_b|(1|hwn) ind_b
self concat (ind_b|q) index
self reshape index|(b|hwn|-1) index
self gather_nd x|index x_offset
self reshape x_offset|(b|h|w|N|c) x_offset
self transpose x_offset|self order_list x_offset
self reshape x_offset|(b|c|h|w|N) x_offset
super RegenerateFeatureMap|self __init__
ks self ks
ops Split axis self split
self shape x_offset _
self split x_offset splits
self concat splits x_offset
self ks ks
self reshape x_offset|(b|c|h|ks|w|ks) x_offset
inc int
outc int
images bboxes|score|keypointsandcategoryidofeachobjects
super DeformConv2d|self __init__
kernel_size self kernel_size
padding self padding
nn Pad ((0|0)) self zero_padding
modulation self modulation
ValueError  format kernel_size
kernel_size|kernel_size self N
kernel_size||2 self begin
ops Sigmoid self sigmoid
ops Floor self floor
ClipByValue self clip_value
GetOffsetPosition self begin|self stride self _get_offset
GetSurroundFeature self _get_surround
RegenerateFeatureMap self kernel_size self _generate_fm
self p_conv x offset
self shape x x_shape
self zero_padding x x
self _get_offset offset p
self transpose p|self perm_list p
self cast self floor p q_lt
q_lt|1 q_rb
self half q_lt q_lt_w
self clip_value q_lt_h|0|x_shape-1 q_lt_h
self clip_value q_lt_w|0|x_shape-1 q_lt_w
self half q_rb q_rb_w
self clip_value q_rb_h|0|x_shape-1 q_rb_h
self clip_value q_rb_w|0|x_shape-1 q_rb_w
self half p p_w
self clip_value p_h|self cast 0|dtype p_h
self clip_value p_w|self cast 0|dtype p_w
(1|(q_lt_h-p_h))|(1|(q_lt_w-p_w)) g_lt
(1-(q_rb_h-p_h))|(1-(q_rb_w-p_w)) g_rb
(1|(q_lt_h-p_h))|(1-(q_rb_w-p_w)) g_lb
(1-(q_rb_h-p_h))|(1|(q_lt_w-p_w)) g_rt
self _get_surround x|q_lt_h|q_lt_w x_q_lt
self _get_surround x|q_rb_h|q_rb_w x_q_rb
self _get_surround x|q_lt_h|q_rb_w x_q_lb
self _get_surround x|q_rb_h|q_lt_w x_q_rt
self expand_dims g_rb|1
self expand_dims g_lb|1
self sigmoid self m_conv x m
self transpose m|self perm_list m
self expand_dims m|1 m
x_offset|m x_offset
self _generate_fm x_offset x_offset
self conv x_offset out
ops Shape self shape w
self shape offset offset_shape w
offset_shape||2|offset_shape|offset_shape w hwn
offset_shape||2|offset_shape|offset_shape w q
self cast p_0|dtype|self cast p_n|dtype|offset p q
self shape x w_p q
self shape q_h N hwn
q_h|w_p|q_w q q
self gather_nd x|index x_offset x_offset
self reshape x_offset|(b|h|w|N|c) x_offset x_offset
self transpose x_offset|self order_list x_offset x_offset
self reshape x_offset|(b|c|h|w|N) x_offset x_offset
self concat splits x_offset x_offset
self reshape x_offset|(b|c|h|ks|w|ks) x_offset x_offset
ValueError  format kernel_size self N
ValueError  format kernel_size self begin
self p_conv x offset x_offset
self cast self floor p q_lt q_rb
self sigmoid self m_conv x m x_offset
self transpose m|self perm_list m x_offset
self expand_dims m|1 m x_offset
x_offset|m x_offset x_offset
os path dirname os path realpath __file__ _current_dir
data_dir str
data_opt edict
net_opt edict
run_mode str
super COCOHP|self __init__
os path isdir data_dir
run_mode self run_mode
os path join data_dir self annot_path
os path join data_dir| format(self run_mode) self image_path
np random RandomState self _data_rng
data_opt self data_opt
self data_opt mean reshape 1|1|3 self data_opt mean
self data_opt std reshape 1|1|3 self data_opt std
net_opt self net_opt
coco COCO self annot_path self coco
logger info  format self run_mode
logger info  format self image_path
logger info  format self annot_path
enable_visual_image self enable_visual_image
os path join save_path|self run_mode self save_path
os path exists self save_path
os makedirs self save_path
self coco getImgIds image_ids
image_ids img_id
self coco getAnnIds imgIds idxs
self images append img_id
idxs self anns img_id
image_ids self images
len self images self num_samples
keep_res self keep_res
flip_test self flip_test
logger info  format self run_mode|self num_samples
os path join mindrecord_dir|file_name mindrecord_path
FileWriter mindrecord_path|shard_num writer
writer add_schema centernet_json|
self images img_id
self coco loadImgs [img_id] image_info
self coco loadAnns self anns img_id annos
image_info img_name
os path join self image_path|img_name img_name
open img_name|
f read image
len annos num_objects
annos anno
keypoints append anno
category_id append anno
bbox append anno
np array keypoints|np int32
np array bbox|np float32
writer write_raw_data [row]
writer commit
np array |dtype bbox
self images index img_id
self coco loadImgs ids file_name
os path join self image_path|file_name img_path
cv2 imread img_path img
np array [img_id]|dtype image_id
(img|image_id) ret
image shape ch
image reshape (h|w|ch) image
image shape width
int height|scale new_height
int width|scale new_width
(new_height) inp_height
(new_width) inp_width
np array [new_width||2|new_height||2]|dtype c
np array [inp_width|inp_height]|dtype s
self data_opt input_res|self data_opt input_res inp_width
np array [new_width|2 |new_height|2 ]|dtype c
max height|width|1 0 s
get_affine_transform c|s|0|[inp_width|inp_height] trans_input
cv2 resize image|(new_width|new_height) resized_image
(inp_image astype(np float32)|255 -self data_opt mean)|self data_opt std inp_img
inp_img shape ch
copy deepcopy inp_img images
inp_img flip_image
inp_img reshape (1|h|w|ch) inp_img
flip_image reshape (1|h|w|ch) flip_image
images reshape (1|h|w|ch) images
images transpose 0|3|1|2 images
min len annos num_objs
self data_opt num_joints num_joints
range k
annos k ann
self _coco_box_to_bbox ann|scale bbox
int ann-1 cls_id
np array ann|np float32 reshape num_joints|3 pts
affine_transform bbox|trans_input bbox
np clip bbox|0|inp_width-1 bbox
np clip bbox|0|inp_height-1 bbox
bbox-bbox|bbox-bbox w
range j
[bbox|bbox|w|h] bbox
int img_id
int cls_id|1
float  format
pts reshape num_joints|3 tolist
ground_truth append gt
cv2 imwrite  format self save_path|image_name|inp_image
min num_objects|self data_opt max_objs num_objs
cv2 imdecode img|cv2 IMREAD_COLOR img
img shape width
np array [img shape|2 |img shape|2 ]|dtype c
max img shape|img shape|1 0 s
s|np random choice(np arange(0 6|1 4|0 1)) s
self _get_border self data_opt input_res|img shape h_border
self _get_border self data_opt input_res|img shape w_border
np random randint low c
self data_opt scale sf
self data_opt shift cf
s|np clip(np random randn|cf|-2|cf|2|cf) c
s|np clip(np random randn|sf|1|1-sf|1|sf) s
np random random
self data_opt rotate rf
np clip np random randn|rf|-rf|2|rf|2 rot
width-c-1 c
get_affine_transform c|s|rot|self data_opt input_res trans_input
color_aug self _data_rng|inp|255 |self data_opt eig_val|self data_opt eig_vec
self data_opt output_res output_res
self data_opt max_objs max_objs
self data_opt num_classes num_classes
get_affine_transform c|s|rot|[output_res|output_res] trans_output_rot
np zeros (num_classes|output_res|output_res) hm
np zeros (num_joints|output_res|output_res) hm_hp
np zeros (num_joints|2|output_res|output_res) dense_kps
np zeros (num_joints|output_res|output_res) dense_kps_mask
np zeros (max_objs|2) wh
np zeros (max_objs|num_joints|2) kps
np zeros (max_objs|2) reg
np zeros (max_objs) ind
np zeros (max_objs) reg_mask
np zeros (max_objs|num_joints|2) kps_mask
np zeros (max_objs|num_joints|2) hp_offset
np zeros (max_objs|num_joints) hp_ind
np zeros (max_objs|num_joints) hp_mask
self _coco_box_to_bbox bboxes k bbox
int category_id k cls_id
np array keypoints k pts
self data_opt flip_idx e
pts e] copy|pts[e pts e
[bbox|bbox] lt
[bbox|bbox] rb
affine_transform bbox|trans_output_rot bbox
affine_transform lt|trans_output_rot lt
affine_transform rb|trans_output_rot rb
min lt|rb|bbox|bbox bbox
max lt|rb|bbox|bbox bbox
np clip bbox|0|output_res-1 bbox
gaussian_radius (math ceil h) radius
np array |dtype ct
ct astype np int32 ct_int
ct_int|output_res|ct_int ind k
ct-ct_int reg k
pts sum num_kpts
radius hp_radius
pts astype np int32 pt_int
pt_int|output_res|pt_int hp_ind
draw_gaussian dense_kps_mask j
draw_gaussian hm_hp j
draw_gaussian hm cls_id
(inp|hm|reg_mask|ind|wh) ret
dense_kps reshape (num_joints|2|output_res|output_res) dense_kps
dense_kps_mask reshape (num_joints|1|output_res|output_res) dense_kps_mask
dense_kps_mask reshape (num_joints|2|output_res|output_res) dense_kps_mask
(dense_kps|dense_kps_mask) ret
(kps|kps_mask) ret
(reg|hm_hp|hp_offset|hp_ind|hp_mask) ret
cv2 warpAffine img|trans_output_rot|(output_res|output_res) out_img
self data_opt input_res||output_res ratio
os path isdir mindrecord_dir
os makedirs mindrecord_dir
os path isdir self image_pathandos path exists self annot_path
logger info
logger info  format mindrecord_dir
ValueError  format self image_path|self annot_path
os listdir mindrecord_dir files
files file_name
data_files append os path join mindrecord_dir|file_name
ValueError  format mindrecord_dir
columns columns_list
num_parallel_workers|shuffle num_parallel_workers
ds get_dataset_size ori_dataset_size
logger info  format ori_dataset_size
logger info  format ds get_dataset_size
logger info  format ds get_repeat_count
range i
self __getitem__ i
de GeneratorDataset generator|column|num_parallel_workers ds
self coco getImgIds image_ids img_id
self coco getImgIds image_ids self images
self coco getAnnIds imgIds idxs self anns img_id
image_ids self images reshape (1|h|w|ch) images
image_ids self images transpose 0|3|1|2 images
FileWriter mindrecord_path|shard_num writer add_schema centernet_json|
FileWriter mindrecord_path|shard_num writer write_raw_data [row]
FileWriter mindrecord_path|shard_num writer commit
self coco loadImgs [img_id] image_info img_name
self coco loadAnns self anns img_id annos anno
self coco loadAnns self anns img_id annos k ann
f read image ret
f read image shape ch
f read image reshape (h|w|ch) image
f read image shape width
np array |dtype bbox w
np array |dtype bbox bbox
np array |dtype bbox lt
np array |dtype bbox rb
cv2 imread img_path img ret
cv2 imread img_path img shape width
np array [img_id]|dtype image_id ret
np array [new_width||2|new_height||2]|dtype c ind k
np array([inp_width|inp_height]|dtype s random choice(np arange(0 6|1 4|0 1)) s
np array([inp_width|inp_height]|dtype s clip(np random randn|cf|-2|cf|2|cf) c
np array([inp_width|inp_height]|dtype s clip(np random randn|sf|1|1-sf|1|sf) s
np array [inp_width|inp_height]|dtype s ind k
np array [inp_width|inp_height]|dtype s hp_ind
np array [inp_width|inp_height]|dtype s ret
np array [inp_width|inp_height]|dtype s ret
np array [inp_width|inp_height]|dtype s num_parallel_workers
np array [new_width|2 |new_height|2 ]|dtype c ind k
max height|width|1 0 s random choice(np arange(0 6|1 4|0 1)) s
max height|width|1 0 s clip(np random randn|cf|-2|cf|2|cf) c
max height|width|1 0 s clip(np random randn|sf|1|1-sf|1|sf) s
max height|width|1 0 s ind k
max height|width|1 0 s hp_ind
max height|width|1 0 s ret
max height|width|1 0 s ret
max height|width|1 0 s num_parallel_workers
(inp_image astype(np float32)|255 -self data_opt mean)|self data_opt std inp_img shape ch
(inp_image astype(np float32)|255 -self data_opt mean)|self data_opt std inp_img flip_image
(inp_image astype(np float32)|255 -self data_opt mean)|self data_opt std inp_img reshape (1|h|w|ch) inp_img
copy deepcopy inp_img images reshape (1|h|w|ch) images
copy deepcopy inp_img images transpose 0|3|1|2 images
inp_img flip_image reshape (1|h|w|ch) flip_image
range k ret
range k ret
self _coco_box_to_bbox ann|scale bbox w
self _coco_box_to_bbox ann|scale bbox bbox
self _coco_box_to_bbox ann|scale bbox lt
self _coco_box_to_bbox ann|scale bbox rb
np array ann|np float32 reshape num_joints|3 pts reshape num_joints|3 tolist
np array ann|np float32 reshape num_joints|3 pts e] copy|pts[e pts e
np array ann|np float32 reshape num_joints|3 pts sum num_kpts
np array ann|np float32 reshape num_joints|3 pts astype np int32 pt_int
affine_transform bbox|trans_input bbox w
affine_transform bbox|trans_input bbox bbox
affine_transform bbox|trans_input bbox lt
affine_transform bbox|trans_input bbox rb
np clip bbox|0|inp_width-1 bbox w
np clip bbox|0|inp_width-1 bbox bbox
np clip bbox|0|inp_width-1 bbox lt
np clip bbox|0|inp_width-1 bbox rb
np clip bbox|0|inp_height-1 bbox w
np clip bbox|0|inp_height-1 bbox bbox
np clip bbox|0|inp_height-1 bbox lt
np clip bbox|0|inp_height-1 bbox rb
bbox-bbox|bbox-bbox w bbox
bbox-bbox|bbox-bbox w ret
[bbox|bbox|w|h] bbox bbox
[bbox|bbox|w|h] bbox lt
[bbox|bbox|w|h] bbox rb
cv2 imdecode img|cv2 IMREAD_COLOR img shape width
np array [img shape|2 |img shape|2 ]|dtype c ind k
max img shape|img shape|1 0 s random choice(np arange(0 6|1 4|0 1)) s
max img shape|img shape|1 0 s clip(np random randn|cf|-2|cf|2|cf) c
max img shape|img shape|1 0 s clip(np random randn|sf|1|1-sf|1|sf) s
max img shape|img shape|1 0 s ind k
max img shape|img shape|1 0 s hp_ind
max img shape|img shape|1 0 s ret
max img shape|img shape|1 0 s ret
max img shape|img shape|1 0 s num_parallel_workers
s|np random choice(np arange(0 6|1 4|0 1)) s random choice(np arange(0 6|1 4|0 1)) s
s|np random choice(np arange(0 6|1 4|0 1)) s clip(np random randn|cf|-2|cf|2|cf) c
s|np random choice(np arange(0 6|1 4|0 1)) s clip(np random randn|sf|1|1-sf|1|sf) s
s|np random choice(np arange(0 6|1 4|0 1)) s ind k
s|np random choice(np arange(0 6|1 4|0 1)) s hp_ind
s|np random choice(np arange(0 6|1 4|0 1)) s ret
s|np random choice(np arange(0 6|1 4|0 1)) s ret
s|np random choice(np arange(0 6|1 4|0 1)) s num_parallel_workers
np random randint low c ind k
s|np clip(np random randn|cf|-2|cf|2|cf) c ind k
s|np clip(np random randn|sf|1|1-sf|1|sf) s clip(np random randn|sf|1|1-sf|1|sf) s
s|np clip(np random randn|sf|1|1-sf|1|sf) s ind k
s|np clip(np random randn|sf|1|1-sf|1|sf) s hp_ind
s|np clip(np random randn|sf|1|1-sf|1|sf) s ret
s|np clip(np random randn|sf|1|1-sf|1|sf) s ret
s|np clip(np random randn|sf|1|1-sf|1|sf) s num_parallel_workers
width-c-1 c ind k
self data_opt output_res output_res ind k
self data_opt output_res output_res hp_ind
np zeros (num_classes|output_res|output_res) hm ret
np zeros (num_classes|output_res|output_res) hm ret
np zeros (num_joints|output_res|output_res) hm_hp ret
np zeros (num_joints|2|output_res|output_res) dense_kps reshape (num_joints|2|output_res|output_res) dense_kps
np zeros (num_joints|2|output_res|output_res) dense_kps ret
np zeros (num_joints|output_res|output_res) dense_kps_mask reshape (num_joints|1|output_res|output_res) dense_kps_mask
np zeros (num_joints|output_res|output_res) dense_kps_mask reshape (num_joints|2|output_res|output_res) dense_kps_mask
np zeros (num_joints|output_res|output_res) dense_kps_mask ret
np zeros (max_objs|2) wh ret
np zeros (max_objs|num_joints|2) kps ret
np zeros (max_objs|num_joints|2) kps ret
np zeros (max_objs|2) reg ret
np zeros (max_objs|2) reg ret
np zeros (max_objs) ind ret
np zeros (max_objs) ind ret
np zeros (max_objs) reg_mask ret
np zeros (max_objs|num_joints|2) kps_mask ret
np zeros (max_objs|num_joints|2) hp_offset ret
np zeros (max_objs|num_joints) hp_ind ret
np zeros (max_objs|num_joints) hp_mask ret
self _coco_box_to_bbox bboxes k bbox lt
self _coco_box_to_bbox bboxes k bbox rb
np array keypoints k pts e] copy|pts[e pts e
np array keypoints k pts sum num_kpts
np array keypoints k pts astype np int32 pt_int
gaussian_radius (math ceil h) radius hp_radius
np array |dtype ct astype np int32 ct_int
np array |dtype ct ind k
ct astype np int32 ct_int ind k
ct_int|output_res|ct_int ind k ret
ct_int|output_res|ct_int ind k ret
ct-ct_int reg k ret
ct-ct_int reg k ret
pts astype np int32 pt_int hp_ind
pt_int|output_res|pt_int hp_ind ret
os listdir mindrecord_dir files file_name
num_parallel_workers|shuffle num_parallel_workers num_parallel_workers
ops MultitypeFuncGraph clip_grad
clip_grad register
ops dtype grad dt
nn ClipByNorm grad|ops cast(ops tuple_to_array (clip_value|)) new_grad
clip_norm float
super ClipByNorm|self __init__
ops HyperMap self hyper_map
clip_norm self clip_norm
self hyper_map ops partial clip_grad|self clip_norm grads
ops Reciprocal reciprocal
ops MultitypeFuncGraph grad_scale
grad_scale register
reciprocal scale
super GradScale|self __init__
self hyper_map ops partial grad_scale|scale grads
super ClipByValue|self __init__
ops Minimum self min
ops Maximum self max
self min x|clip_value_max x_min
self max x_min|clip_value_min x_max
super GatherFeature|self __init__
ops Tile self tile
ops Shape self shape
ops Reshape self reshape
ops GatherNd self gather_nd
self shape ind N
self reshape ind|(-1|1) ind
nn Range 0|b|1 ind_b
self reshape ind_b|(-1|1) ind_b
self tile ind_b|(1|N) ind_b
self concat (ind_b|ind) index
self reshape index|(b|N|-1) index
self gather_nd feat|index feat
super TransposeGatherFeature|self __init__
ops Transpose self transpose
(0|2|3|1) self perm_list
GatherFeature self gather_feat
self transpose feat|self perm_list feat
self shape feat c
self reshape feat|(b|-1|c) feat
self gather_feat feat|ind feat
super Sigmoid|self __init__
ops Cast self cast
ops DType self dtype
nn Sigmoid self sigmoid
ops clip_by_value self clip_by_value
self sigmoid x x
self dtype x dt
alpha int
beta int
super FocalLoss|self __init__
alpha self alpha
beta self beta
ops Pow self pow
ops Log self log
ops Select self select
ops Equal self equal
ops Less self less
ops Fill self fill
ops ReduceSum self reduce_sum
self cast self equal target|1 0 pos_inds
self cast self less target|1 0 neg_inds
self pow 1-target|self beta neg_weights
self log out|self pow(1-out|self alpha)|pos_inds pos_loss
self log 1-out|self pow(out|self alpha)|neg_weights|neg_inds neg_loss
self reduce_sum pos_inds num_pos
self reduce_sum pos_loss pos_loss
self reduce_sum neg_loss neg_loss
-(pos_loss|neg_loss)|num_pos loss
bins int
momentum float
super GHMCLoss|self __init__
bins self bins
momentum self momentum
([float(x)|binsforxinrange(bins)]|dtype edges_left
Tensor edges_left reshape (bins|1|1|1|1) self edges_left
np array |dtype edges_right
Tensor edges_right reshape (bins|1|1|1|1) self edges_right
Parameter initializer 0|[bins]|mstype float32 self acc_sum
ops Abs self abs
ops Greater self greater
ops LogicalAnd self logical_and
ops GreaterEqual self greater_equal
ops ZerosLike self zeros_like
ops ExpandDims self expand_dims
self abs out-target g
self expand_dims g|0 g
self max self reduce_sum pos_inds| tot
self logical_and self greater_equal g|self edges_left inds_mask
self cast self zeros_like inds_mask zero_matrix
self cast inds_mask|mstype float32 inds
self reduce_sum inds|(1|2|3|4) num_in_bin
self greater num_in_bin|0 valid_bins
self reduce_sum self cast valid_bins|mstype float32 num_valid_bin
self acc_sum acc_sum
self reshape acc_sum|(self bins|1|1|1|1) acc_sum
acc_sum|zero_matrix acc_sum
self select self equal inds|1 weights
self reduce_sum weights|0 weights
self reshape num_in_bin|(self bins|1|1|1|1) num_in_bin
num_in_bin|zero_matrix num_in_bin
weights|num_valid_bin weights
(target-1 0)|self log(1 0-out)-target|self log out ghmc_loss
self reduce_sum ghmc_loss|weights||tot ghmc_loss
mu float
super GHMRLoss|self __init__
mu self mu
ops Sqrt self sqrt
out-target diff
self abs diff|self sqrt(self mu|self mu|diff|diff) g
self sqrt diff|diff|self mu|self mu-self mu ghmr_loss
self reduce_sum ghmr_loss|weights||tot ghmr_loss
mode str
super RegLoss|self __init__
TransposeGatherFeature self gather_feature
nn SmoothL1Loss self loss
self gather_feature output|ind pred
self cast mask|mstype float32 mask
self reduce_sum mask num
self expand_dims mask|2 mask
target|mask target
pred|mask pred
self loss pred|target regr_loss
regr_loss|(num|1e-4) regr_loss
super RegWeightedL1Loss|self __init__
self l1_loss pred|mask|target|mask loss
loss|(num|1e-4) loss
super LossCallBack|self __init__
dataset_size self _dataset_size
run_context original_args cb_params
math modf cb_params cur_step_num|self _dataset_size epoch_num
learning_rate float
end_learning_rate float
warmup_steps int
decay_steps int
power int
super CenterNetPolynomialDecayLR|self __init__
WarmUpLR learning_rate|warmup_steps self warmup_lr
PolynomialDecayLR learning_rate|end_learning_rate|decay_steps|power self decay_lr
Tensor np array [warmup_steps] astype np float32 self warmup_steps
Tensor np array astype np float32 self one
self decay_lr global_step decay_lr
self cast self greater self warmup_steps|global_step is_warmup
self warmup_lr global_step warmup_lr
(self one-is_warmup)|decay_lr|is_warmup|warmup_lr lr
decay_lr lr
multi_steps listint
steps_per_epoch int
factor int
super CenterNetMultiEpochsDecayLR|self __init__
MultiEpochsDecayLR learning_rate|multi_epochs|steps_per_epoch|factor self decay_lr
super MultiEpochsDecayLR|self __init__
isinstance multi_epochs|(list|tuple)
Tensor np array multi_epochs|dtype self multi_epochs
len multi_epochs self num
learning_rate self start_learning_rate
steps_per_epoch self steps_per_epoch
factor self factor
ops LessEqual self less_equal
self cast global_step|mstype float32 cur_step
self cast self less_equal self multi_epochs|cur_step epochs
self start_learning_rate|self pow(self factor|self reduce_sum epochs|) lr
ops MultitypeFuncGraph clip_grad register
ops dtype grad dt edges_left
ops Reciprocal reciprocal scale
ops MultitypeFuncGraph grad_scale register
ops DType self dtype edges_left
self dtype x dt edges_left
self log out|self pow(1-out|self alpha)|pos_inds pos_loss loss
self log 1-out|self pow(out|self alpha)|neg_weights|neg_inds neg_loss loss
self reduce_sum pos_inds num_pos loss
self reduce_sum pos_loss pos_loss loss
self reduce_sum neg_loss neg_loss loss
-(pos_loss|neg_loss)|num_pos loss loss
-(pos_loss|neg_loss)|num_pos loss regr_loss
-(pos_loss|neg_loss)|num_pos loss loss
Parameter initializer 0|[bins]|mstype float32 self acc_sum acc_sum
self cast self zeros_like inds_mask zero_matrix acc_sum
self cast self zeros_like inds_mask zero_matrix num_in_bin
self reduce_sum inds|(1|2|3|4) num_in_bin num_in_bin
self reduce_sum self cast valid_bins|mstype float32 num_valid_bin weights
self acc_sum acc_sum acc_sum
self reshape acc_sum|(self bins|1|1|1|1) acc_sum acc_sum
acc_sum|zero_matrix acc_sum acc_sum
self select self equal inds|1 weights weights
self reduce_sum weights|0 weights weights
self reshape num_in_bin|(self bins|1|1|1|1) num_in_bin num_in_bin
num_in_bin|zero_matrix num_in_bin num_in_bin
weights|num_valid_bin weights weights
nn SmoothL1Loss self loss regr_loss
nn SmoothL1Loss self loss loss
self gather_feature output|ind pred pred
self cast mask|mstype float32 mask target
self cast mask|mstype float32 mask pred
self reduce_sum mask num regr_loss
self reduce_sum mask num loss
self expand_dims mask|2 mask target
self expand_dims mask|2 mask pred
target|mask target target
pred|mask pred pred
self loss pred|target regr_loss regr_loss
regr_loss|(num|1e-4) regr_loss regr_loss
self l1_loss pred|mask|target|mask loss loss
loss|(num|1e-4) loss loss
PolynomialDecayLR learning_rate|end_learning_rate|decay_steps|power self decay_lr lr
self decay_lr global_step decay_lr lr
data_cfg num_joints _NUM_JOINTS
np array |dtype bbox
image shape|image shape w
np array [image shape|2 |image shape|2 ]|dtype c
max image shape|image shape|1 0 s
get_affine_transform c|s|0|[width|height] trans_output
cv2 warpAffine image|trans_output|(width|height) out_img
len anns num_objects
range i
anns i ann
coco_box_to_bbox ann bbox
np array ann|np float32 reshape _NUM_JOINTS|3 pts
affine_transform bbox|trans_output bbox
np clip bbox|0|width-1 bbox
np clip bbox|0|height-1 bbox
bbox-bbox|bbox-bbox w
np array |dtype ct
range j
[ct-w|2|ct-h|2|w|h|1] bbox
pts reshape _NUM_JOINTS|3 tolist keypoints
bbox ann
keypoints ann
ann gt
resize_anno append gt
os listdir ann_path files
files file_name
data_files append os path join ann_path|file_name
{} pred
data_files file
json load open file| anno
anno img
pred append img
anno ann
pred append ann
json dump pred|open
merge_pred ann_path|mode|name
os path join ann_path|name| ann_path
visual_allimages ann_path|image_path|save_path|ratio
COCO COCO anno_file coco
coco getImgIds image_ids
image_ids img_id
coco getAnnIds imgIds idxs
images append img_id
idxs anns img_id
images img_id
coco loadImgs ids file_name
os path join image_path|file_name img_path
coco loadAnns anns img_id annos
cv2 imread img_path img
visual_image img|annos|save_path|ratio
img shape|img shape w
resize_image img|annos|width|height annos
resize_image img|annos|w|ratio|h|ratio annos
len annos num_objects
annos i ann
ann score
( format ann) txt
cv2 putText img|txt|(bbox|bbox)|cv2 FONT_HERSHEY_SIMPLEX|0 5|(255|0|0)|1
(int((bbox|bbox)|2)) ct
-1|lineType thickness
np array bbox|dtype bbox
cv2 rectangle img|(bbox|bbox)|(bbox|bbox)|(0|255|0)|2
ann keypoints
np array keypoints|dtype keypoints
[0|1|3|5|7|9|11|13|15] left_part
[0|2|4|6|8|10|12|14|16] right_part
data_cfg edges pair
pair partA
pair partB
(255|0|0) color
(0|0|255) color
(139|0|255) color
tuple keypoints partA p_a
tuple keypoints partB p_b
keypoints partA mask_a
keypoints partB mask_b
cv2 line img|p_a|p_b|color|2
annos img_id
random randint 0|9999999 img_id
cv2 imwrite  format save_path|image_name|img
np array |dtype bbox w
np array |dtype bbox ann
np array |dtype bbox ct
image shape|image shape w bbox
np array [image shape|2 |image shape|2 ]|dtype c bbox
anns i ann gt
anns i ann score
anns i ann keypoints
coco_box_to_bbox ann bbox w
coco_box_to_bbox ann bbox ann
coco_box_to_bbox ann bbox ct
np array ann|np float32 reshape _NUM_JOINTS|3 pts reshape _NUM_JOINTS|3 tolist keypoints
affine_transform bbox|trans_output bbox w
affine_transform bbox|trans_output bbox ann
affine_transform bbox|trans_output bbox ct
np clip bbox|0|width-1 bbox w
np clip bbox|0|width-1 bbox ann
np clip bbox|0|width-1 bbox ct
np clip bbox|0|height-1 bbox w
np clip bbox|0|height-1 bbox ann
np clip bbox|0|height-1 bbox ct
bbox-bbox|bbox-bbox w bbox
np array |dtype ct bbox
[ct-w|2|ct-h|2|w|h|1] bbox ann
[ct-w|2|ct-h|2|w|h|1] bbox ct
pts reshape _NUM_JOINTS|3 tolist keypoints ann
pts reshape _NUM_JOINTS|3 tolist keypoints partA mask_a
pts reshape _NUM_JOINTS|3 tolist keypoints partB mask_b
bbox ann gt
bbox ann score
bbox ann keypoints
keypoints ann gt
keypoints ann score
keypoints ann keypoints
os listdir ann_path files file_name
{} pred append img
{} pred append ann
json load open file| anno img
json load open file| anno ann
anno img shape|img shape w
pred append img shape|img shape w
anno ann score
anno ann keypoints
pred append ann score
pred append ann keypoints
COCO COCO anno_file coco getImgIds image_ids
COCO COCO anno_file coco getAnnIds imgIds idxs
COCO COCO anno_file coco loadImgs ids file_name
COCO COCO anno_file coco loadAnns anns img_id annos
coco getImgIds image_ids img_id
coco getAnnIds imgIds idxs anns img_id
coco loadAnns anns img_id annos i ann
coco loadAnns anns img_id annos img_id
cv2 imread img_path img shape|img shape w
visual_image img shape|img shape w
visual_image annos i ann
visual_image ann score
visual_image ann keypoints
visual_image annos img_id
resize_image img|annos|width|height annos i ann
resize_image img|annos|width|height annos img_id
resize_image img|annos|w|ratio|h|ratio annos i ann
resize_image img|annos|w|ratio|h|ratio annos img_id
annos i ann score
annos i ann keypoints
cv2 putText img|txt|(bbox|bbox)|cv2 FONT_HERSHEY_SIMPLEX|0 (255|0|0) color
ann keypoints partA mask_a
ann keypoints partB mask_b
np array keypoints|dtype keypoints partA mask_a
np array keypoints|dtype keypoints partB mask_b
data_cfg edges pair partA
data_cfg edges pair partB
super GatherMultiPoseFeatureCell|self __init__
net_config head_conv head_conv
int np log2 net_config down_ratio first_level
{} heads
heads update
heads update({:data_cfg num_joints})
net_config stage_channels first_level in_channel
net_config final_kernel final_kernel
_generate_feature in_channel|heads|final_kernel|head_conv self hm_fn
_generate_feature in_channel|heads|final_kernel|head_conv self wh_fn
_generate_feature in_channel|heads|final_kernel|head_conv self hps_fn
_generate_feature in_channel|heads|final_kernel|head_conv self reg_fn
_generate_feature in_channel|heads|final_kernel|head_conv self hm_hp_fn
_generate_feature in_channel|heads|final_kernel|head_conv self reg_hp_fn
Sigmoid self sigmoid
net_config hm_hp self hm_hp
net_config reg_offset self reg_offset
net_config reg_hp_offset self reg_hp_offset
self dla_seg image output
self hm_fn output output_hm
self sigmoid output_hm output_hm
self hps_fn output output_hps
self wh_fn output output_wh
(output_hm|output_hps|output_wh) feature
self hm_hp_fn output output_hm_hp
self sigmoid output_hm_hp output_hm_hp
(output_hm_hp|) feature
self reg_fn output output_reg
(output_reg|) feature
self reg_hp_fn output output_hp_offset
(output_hp_offset|) feature
super CenterNetMultiPoseLossCell|self __init__
GatherMultiPoseFeatureCell net_config self network
ops ReduceSum self reduce_sum
FocalLoss self crit
RegLoss net_config reg_loss self crit_reg
net_config hm_weight self hm_weight
net_config hm_hp_weight self hm_hp_weight
net_config hp_weight self hp_weight
net_config wh_weight self wh_weight
net_config off_weight self off_weight
net_config dense_hp self dense_hp
self hm_hp_ind|1ifself reg_offsetelseself hm_hp_ind self reg_ind
self reg_ind|1ifself reg_hp_offsetelseself reg_ind self reg_hp_ind
ops Print self print
ops Reshape self reshape
self network image feature
feature output_hm
self crit output_hm|hm hm_loss
feature output_hps
self reduce_sum kps_mask||1e-4 mask_weight
self crit_kp output_hps|kps_mask|kps|kps_mask|mask_weight hp_loss
self crit_kp output_hps|kps_mask|ind|kps hp_loss
feature output_wh
self crit_reg output_wh|reg_mask|ind|wh wh_loss
feature self hm_hp_ind output_hm_hp
self crit_hm_hp output_hm_hp|hm_hp hm_hp_loss
feature self reg_ind output_reg
self crit_reg output_reg|reg_mask|ind|reg off_loss
feature self reg_hp_ind output_hp_offset
self crit_reg output_hp_offset|hp_mask|hp_ind|hp_offset hp_offset_loss
ImagePreProcess self image
network self network
self network set_grad
optimizer parameters self weights
optimizer self optimizer
ops AllReduce self allreduce
context get_auto_parallel_context self parallel_mode
ops identity self grad_reducer
get_group_size self degree
DistributedGradReducer optimizer parameters|False|self degree self grad_reducer
(self parallel_mode) self is_distributed
ops Cast self cast
ops NPUAllocFloatStatus self alloc_status
ops NPUGetFloatStatus self get_status
ops NPUClearFloatStatus self clear_before_grad
Tensor 1|mstype float32 self base
ops LessEqual self less_equal
GradScale self grad_scale
sens self loss_scale
self image image image
self weights weights
self cast self loss_scale|mstype float32|2 0|2 0 scaling_sens
self alloc_status init
self clear_before_grad init
self grad_reducer grads grads
self grad_scale scaling_sens|self degree|grads grads
self get_status init
self reduce_sum init|(0|) flag_sum
self allreduce flag_sum flag_reduce
self less_equal self base|flag_reduce cond
self less_equal self base|flag_sum cond
cond overflow
self optimizer grads succ
(loss|cond|scaling_sens) ret
ops depend ret|succ
flip_test bool
K number
images bboxes|score|keypointsandcategoryidofeachobjects
super CenterNetMultiPoseEval|self __init__
MultiPoseDecode net_config|flip_test|K self decode
flip_test self flip_test
ops Shape self shape
self network image features
self decode features detections
super ImagePreProcess|self __init__
ops Transpose self transpose
(0|3|1|2) self perm_list
Tensor data_cfg mean reshape (1|1|1|3) self mean
Tensor data_cfg std reshape (1|1|1|3) self std
self cast image|mstype float32 image
(image|255 0-self mean)|self std image
self transpose image|self perm_list image
{} heads update
{} heads update({:data_cfg num_joints})
net_config hm_hp self hm_hp feature
self dla_seg image output feature
self hm_fn output output_hm feature
self sigmoid output_hm output_hm feature
self hps_fn output output_hps feature
self wh_fn output output_wh feature
(output_hm|output_hps|output_wh) feature output_hm
(output_hm|output_hps|output_wh) feature output_hps
(output_hm|output_hps|output_wh) feature output_wh
(output_hm|output_hps|output_wh) feature self hm_hp_ind output_hm_hp
(output_hm|output_hps|output_wh) feature self reg_ind output_reg
(output_hm|output_hps|output_wh) feature self reg_hp_ind output_hp_offset
self hm_hp_fn output output_hm_hp feature
self sigmoid output_hm_hp output_hm_hp feature
(output_hm_hp|) feature output_hm
(output_hm_hp|) feature output_hps
(output_hm_hp|) feature output_wh
(output_hm_hp|) feature self hm_hp_ind output_hm_hp
(output_hm_hp|) feature self reg_ind output_reg
(output_hm_hp|) feature self reg_hp_ind output_hp_offset
self reg_fn output output_reg feature
(output_reg|) feature output_hm
(output_reg|) feature output_hps
(output_reg|) feature output_wh
(output_reg|) feature self hm_hp_ind output_hm_hp
(output_reg|) feature self reg_ind output_reg
(output_reg|) feature self reg_hp_ind output_hp_offset
self reg_hp_fn output output_hp_offset feature
(output_hp_offset|) feature output_hm
(output_hp_offset|) feature output_hps
(output_hp_offset|) feature output_wh
(output_hp_offset|) feature self hm_hp_ind output_hm_hp
(output_hp_offset|) feature self reg_ind output_reg
(output_hp_offset|) feature self reg_hp_ind output_hp_offset
GatherMultiPoseFeatureCell net_config self network self network
self network image feature output_hm
self network image feature output_hps
self network image feature output_wh
self network image feature self hm_hp_ind output_hm_hp
self network image feature self reg_ind output_reg
self network image feature self reg_hp_ind output_hp_offset
ImagePreProcess self image 0-self mean)|self std image
self image image image 0-self mean)|self std image
self cast self loss_scale|mstype float32|2 0|2 0 scaling_sens ret
self less_equal self base|flag_reduce cond overflow
self less_equal self base|flag_reduce cond ret
self less_equal self base|flag_sum cond overflow
self less_equal self base|flag_sum cond ret
self cast image|mstype float32 image 0-self mean)|self std image
(image|255 0-self mean)|self std image 0-self mean)|self std image
kernel int
super NMS|self __init__
(kernel-1)||2 self pad
ops Cast self cast
ops DType self dtype
ops Equal self equal
self dtype heat dtype
self cast heat|mstype float16 heat
self max_pool heat heat_max
self equal heat|heat_max keep
self cast keep|dtype keep
self cast heat|dtype heat
heat|keep heat
super GatherTopK|self __init__
ops Shape self shape
ops Reshape self reshape
GatherFeature self gather_feat
ops Mod self mod
ops Div self div
self shape scores w
self reshape scores|(b|c|-1) scores
self topk scores|K topk_inds
self div topk_inds|w topk_ys
self mod topk_inds|w topk_xs
self topk self reshape topk_scores|(b|-1) topk_ind
self cast self div topk_ind|K topk_clses
self gather_feat self reshape topk_inds|(b|-1|1) topk_inds
self reshape topk_inds|(b|K) topk_inds
self gather_feat self reshape topk_ys|(b|-1|1) topk_ys
self cast self reshape topk_ys|(b|K) topk_ys
self gather_feat self reshape topk_xs|(b|-1|1) topk_xs
self cast self reshape topk_xs|(b|K) topk_xs
super GatherTopKChannel|self __init__
self cast topk_ys|self dtype scores topk_ys
self cast topk_xs|self dtype scores topk_xs
super GatherFeatureByInd|self __init__
ops Tile self tile
ops GatherNd self gather_nd
self shape ind K
self reshape feat|(b|J|K|-1) feat
self shape feat N
self reshape ind|(-1|1) ind
nn Range 0|b|J|1 ind_b
self reshape ind_b|(-1|1) ind_b
self tile ind_b|(1|K) ind_b
self concat (ind_b|ind) index
self reshape index|(-1|K|2) index
self reshape feat|(-1|K|N) feat
self gather_nd feat|index feat
super FlipTensor|self __init__
ops ReverseV2 axis self flip
self half feat feat_f
(feat_o|self flip feat_f)|2 0 output
super GatherFlipFeature|self __init__
ops Transpose self transpose
(1|0|2|3) self perm_list
self shape feat w
self transpose feat|self perm_list feat
self reshape feat|(J|-1) feat
self reshape index|(J|-1) index
self reshape feat|(J|b|h|w) feat
super FlipLR|self __init__
GatherFlipFeature self gather_flip_feat
Tensor np array [0|2|1|4|3|6|5|8|7|10|9|12|11|14|13|16|15]|np int32 self flip_index
self flip feat_f feat_f
self gather_flip_feat feat_f|self flip_index feat_f
(feat_o|feat_f)|2 0 output
super FlipLROff|self __init__
self half kps kps_f
self flip kps_f kps_f
self split kps_o kps_oh
self split kps_f kps_fh
-1 0|kps_fw kps_fw
self gather_flip_feat kps_fw|self flip_index kps_fw
self gather_flip_feat kps_fh|self flip_index kps_fh
(kps_ow|kps_fw)|2 0 kps_w
(kps_oh|kps_fh)|2 0 kps_h
self concat (kps_w|kps_h) kps
net_config edict
flip_test bool
K int
super MultiPoseDecode|self __init__
K self K
flip_test self flip_test
NMS self nms
GatherTopK self gather_topk
GatherTopKChannel self gather_topk_channel
GatherFeatureByInd self gather_by_ind
FlipLR self flip_lr
FlipLROff self flip_lr_off
FlipTensor self flip_tensor
TransposeGatherFeature self trans_gather_feature
ops ExpandDims self expand_dims
ops TensorAdd self add
(0|2|1|3) self perm_list
ops Greater self greater
ops Square self square
ops Sqrt self sqrt
ops ReduceSum self reduce_sum
ops Maximum self max
net_config hm_hp self hm_hp
net_config dense_hp self dense_hp
net_config reg_offset self reg_offset
net_config reg_hp_offset self reg_hp_offset
self hm_hp_ind|1ifself reg_offsetelseself hm_hp_ind self reg_ind
self reg_ind|1ifself reg_hp_offsetelseself reg_ind self reg_hp_ind
feature heat
self flip_tensor heat heat
self K K
self shape heat _
self nms heat heat
self gather_topk heat|K xs
self reshape ys|(b|K|1) ys
self reshape xs|(b|K|1) xs
feature kps
self flip_lr_off kps kps
self shape kps|2 num_joints
self trans_gather_feature kps|inds kps
self reshape kps|(b|K|num_joints|2) kps
self half kps kps_h
self reshape kps_w|(b|K|num_joints) kps_w
self reshape kps_h|(b|K|num_joints) kps_h
self add kps_h|ys kps_h
self add kps_w|xs kps_w
self reshape kps_w|(b|K|num_joints|1) kps_w
self reshape kps_h|(b|K|num_joints|1) kps_h
self concat_a3 (kps_w|kps_h) kps
feature wh
self flip_tensor wh wh
self trans_gather_feature wh|inds wh
self half wh hs
feature self reg_ind reg
self half_first reg _
self trans_gather_feature reg|inds reg
self reshape reg|(b|K|2) reg
self half reg reg_h
self add ys|reg_h ys
self add xs|reg_w xs
ys|0 5 ys
xs|0 5 xs
self concat_a2 (xs-ws|2|ys-hs|2|xs|ws|2|ys|hs|2) bboxes
feature self hm_hp_ind hm_hp
self flip_lr hm_hp hm_hp
self nms hm_hp hm_hp
self gather_topk_channel hm_hp|K hm_xs
feature self reg_hp_ind hp_offset
self half_first hp_offset _
self trans_gather_feature hp_offset|self reshape hm_inds|(b|-1) hp_offset
self reshape hp_offset|(b|num_joints|K|2) hp_offset
self half hp_offset hp_hs
self reshape hp_ws|(b|num_joints|K) hp_ws
self reshape hp_hs|(b|num_joints|K) hp_hs
hm_xs|hp_ws hm_xs
hm_ys|hp_hs hm_ys
hm_xs|0 5 hm_xs
hm_ys|0 5 hm_ys
self greater hm_score|self thresh mask
self cast mask|self dtype hm_score mask
mask|hm_score-(1 0-mask) hm_score
(1-mask)||mask|hm_ys hm_ys
(1-mask)||mask|hm_xs hm_xs
self reshape hm_xs|(b|num_joints|K|1) hm_xs
self reshape hm_ys|(b|num_joints|K|1) hm_ys
self concat_a3 (hm_xs|hm_ys) hm_kps
self expand_dims hm_kps|2 reg_hm_kps
self tile reg_hm_kps|(1|1|K|1|1) reg_hm_kps
self transpose kps|self perm_list kps
self expand_dims kps|3 reg_kps
self tile reg_kps|(1|1|1|K|1) reg_kps
self sqrt self reduce_sum self square reg_kps-reg_hm_kps dist
self min dist min_dist
self gather_by_ind hm_score|min_ind hm_score
self expand_dims min_dist|-1 min_dist
self gather_by_ind hm_kps|min_ind hm_kps
self half hm_kps hm_kps_ys
self split bboxes d
self tile self reshape l|(b|1|K|1) l
self tile self reshape t|(b|1|K|1) t
self tile self reshape r|(b|1|K|1) r
self tile self reshape d|(b|1|K|1) d
self cast self greater hm_kps_xs|r|self dtype hm_score
self cast self greater t|hm_kps_ys|self dtype hm_score
self cast self greater hm_kps_ys|d|self dtype hm_score
self cast self greater self thresh|hm_score|self dtype hm_score
self cast self greater mask|0 0 mask
(1 0-mask)|hm_kps|mask|kps kps
self reshape self transpose kps|self perm_list kps
self expand_dims scores|2 scores
self expand_dims clses|2 clses
self concat_a2 (bboxes|scores|kps|clses) detection
self cast heat|mstype float16 heat heat
self equal heat|heat_max keep heat
self cast keep|dtype keep heat
self cast heat|dtype heat heat
heat|keep heat heat
self shape scores w 0 kps_w
self shape ind K int
self shape ind K self K
self reshape feat|(b|J|K|-1) feat 0 output
self reshape feat|(-1|K|N) feat 0 output
self gather_nd feat|index feat 0 output
self half feat feat_f 0 output
self shape feat w 0 kps_w
self transpose feat|self perm_list feat 0 output
self reshape feat|(J|-1) feat 0 output
self reshape feat|(J|b|h|w) feat 0 output
self flip feat_f feat_f 0 output
self gather_flip_feat feat_f|self flip_index feat_f 0 output
self half kps kps_f 0 kps_w
self half kps kps_f 0 kps_h
self flip kps_f kps_f 0 kps_w
self flip kps_f kps_f 0 kps_h
self split kps_o kps_oh 0 kps_h
self split kps_f kps_fh 0 kps_h
-1 0|kps_fw kps_fw 0 kps_w
self gather_flip_feat kps_fw|self flip_index kps_fw 0 kps_w
self gather_flip_feat kps_fh|self flip_index kps_fh 0 kps_h
self gather_topk heat|K xs 5 xs
self gather_topk heat|K xs hm_xs
self gather_topk heat|K xs 5 hm_xs
self reshape ys|(b|K|1) ys 5 ys
self reshape ys|(b|K|1) ys hm_ys
self reshape ys|(b|K|1) ys 5 hm_ys
self reshape xs|(b|K|1) xs 5 xs
self reshape xs|(b|K|1) xs hm_xs
self reshape xs|(b|K|1) xs 5 hm_xs
self add ys|reg_h ys 5 ys
self add ys|reg_h ys hm_ys
self add ys|reg_h ys 5 hm_ys
self add xs|reg_w xs 5 xs
self add xs|reg_w xs hm_xs
self add xs|reg_w xs 5 hm_xs
ys|0 5 ys 5 ys
ys|0 5 ys hm_ys
ys|0 5 ys 5 hm_ys
xs|0 5 xs 5 xs
xs|0 5 xs hm_xs
xs|0 5 xs 5 hm_xs
self gather_topk_channel hm_hp|K hm_xs hm_xs
self gather_topk_channel hm_hp|K hm_xs 5 hm_xs
self gather_topk_channel hm_hp|K hm_xs hm_xs
self half hp_offset hp_hs hm_ys
self reshape hp_ws|(b|num_joints|K) hp_ws hm_xs
self reshape hp_hs|(b|num_joints|K) hp_hs hm_ys
hm_xs|hp_ws hm_xs hm_xs
hm_xs|hp_ws hm_xs 5 hm_xs
hm_xs|hp_ws hm_xs hm_xs
hm_ys|hp_hs hm_ys hm_ys
hm_ys|hp_hs hm_ys 5 hm_ys
hm_ys|hp_hs hm_ys hm_ys
hm_xs|0 5 hm_xs 5 hm_xs
hm_xs|0 5 hm_xs hm_xs
hm_ys|0 5 hm_ys 5 hm_ys
hm_ys|0 5 hm_ys hm_ys
self greater hm_score|self thresh mask 0-mask) hm_score
self greater hm_score|self thresh mask hm_ys
self greater hm_score|self thresh mask hm_xs
self cast mask|self dtype hm_score mask 0-mask) hm_score
self cast mask|self dtype hm_score mask hm_ys
self cast mask|self dtype hm_score mask hm_xs
mask|hm_score-(1 0-mask) hm_score 0-mask) hm_score
(1-mask)||mask|hm_ys hm_ys hm_ys
(1-mask)||mask|hm_xs hm_xs hm_xs
config num_joints _NUM_JOINTS
meta w
dets shape N
dets reshape (K|N) dets
transform_preds dets reshape -1|2 bbox
transform_preds dets reshape -1|2 pts
np concatenate top_preds
results tolist results
np array detections reshape (-1|39) detections
{} pred_anno
detections shape _
range i
detections i score
detections i bbox
bbox-bbox bbox
list map to_float|bbox bbox
 keypoints
np float32) reshape(-1|2 dtype
list map to_float|keypoints keypoints
int img_id
int class_id
to_float score
pred_anno append pred
pred_anno append {:int img_id}
float  format x
gt|gt width
np array [pred|2 |pred|2 ]|dtype c
max pred|pred|1 0 s
get_affine_transform c|s|0|[width|height] trans_output
detection anns
len anns num_objects
{} resized_detection
anns i ann
coco_box_to_bbox ann bbox
np array ann|np float32 reshape _NUM_JOINTS|3 pts
affine_transform bbox|trans_output bbox
np clip bbox|0|width-1 bbox
np clip bbox|0|height-1 bbox
bbox-bbox|bbox-bbox w
range j
[bbox|bbox|w|h] bbox
pts reshape _NUM_JOINTS|3 tolist keypoints
list map to_float|bbox ann
list map to_float|keypoints ann
resized_detection append ann
meta w bbox
transform_preds dets reshape -1|2 bbox w
transform_preds dets reshape -1|2 bbox bbox
transform_preds dets reshape -1|2 pts reshape _NUM_JOINTS|3 tolist keypoints
np array detections reshape (-1|39) detections shape _
np array detections reshape (-1|39) detections i score
np array detections reshape (-1|39) detections i bbox
{} pred_anno append pred
{} pred_anno append {:int img_id}
detections i bbox w
detections i bbox bbox
bbox-bbox bbox w
bbox-bbox bbox bbox
list map to_float|bbox bbox w
list map to_float|bbox bbox bbox
float  format x w
float  format x bbox
detection anns i ann
{} resized_detection append ann
coco_box_to_bbox ann bbox w
coco_box_to_bbox ann bbox bbox
np array ann|np float32 reshape _NUM_JOINTS|3 pts reshape _NUM_JOINTS|3 tolist keypoints
affine_transform bbox|trans_output bbox w
affine_transform bbox|trans_output bbox bbox
np clip bbox|0|width-1 bbox w
np clip bbox|0|width-1 bbox bbox
np clip bbox|0|height-1 bbox w
np clip bbox|0|height-1 bbox bbox
bbox-bbox|bbox-bbox w bbox
[bbox|bbox|w|h] bbox bbox
1] copy
np zeros coords shape target_coords
range p
np array [0|0]|dtype shift
isinstance scale|np ndarrayandnotisinstance scale|list
np array [scale|scale]|dtype scale
scale scale_tmp
scale_tmp src_w
output_size dst_w
output_size dst_h
np pi|rot|180 rot_rad
get_dir [0|src_w|-0 5]|rot_rad src_dir
np array [0|dst_w|-0 5]|np float32 dst_dir
np zeros (3|2) src
np zeros (3|2) dst
center|scale_tmp|shift src
center|src_dir|scale_tmp|shift src
cv2 getAffineTransform np float32 dst trans
cv2 getAffineTransform np float32 src trans
np array [pt|pt|1 ]|dtype new_pt
np dot t|new_pt new_pt
a-b direct
np float32 dtype
np sin rot_rad cs
[0|0] src_result
src_point|cs-src_point|sn src_result
src_point|sn|src_point|cs src_result
get_affine_transform center|scale|rot|output_size trans
 int output_size|int output_size
det_size width
(height|width) b1
width|height|(1-min_overlap)|(1|min_overlap) c1
np sqrt b12-4|a1|c1 sq1
(b1|sq1)|(2|a1) r1
(1-min_overlap)|width|height c2
np sqrt b22-4|a2|c2 sq2
(b2|sq2)|(2|a2) r2
-2|min_overlap|(height|width) b3
(min_overlap-1)|width|height c3
np sqrt b32-4|a3|c3 sq3
(b3|sq3)|(2|a3) r3
math ceil min r1|r2|r3
[ ss-1 |2 forssinshape] n
np ogrid x
np exp -(x|x|y|y)|(2|sigma|sigma) h
gaussian2D (diameter|diameter) gaussian
int center y
heatmap shape width
min x|radius right
min y|radius bottom
heatmap masked_heatmap
min masked_gaussian shape>0andmin masked_heatmap shape
masked_heatmap out
np array value|dtype value
value reshape (-1|1|1) value
value shape dim
np ones (dim|diameter|2|1|diameter|2|1) reg
np arange diameter|2|1-radius delta
reg-delta reshape 1|-1 reg
reg-delta reshape -1|1 reg
regmap masked_regmap
(masked_gaussian) idx
(1-idx)|masked_regmap|idx|masked_reg masked_regmap
masked_regmap regmap
sigma|3 tmp_size
int center|0 5 mu_x
int center|0 5 mu_y
heatmap shape|heatmap shape h
[int mu_x-tmp_size] ul
np arange 0|size|1|np float32 x
x y
np exp -((x-x0)2|(y-y0)2)|(2|sigma2) g
max 0|-ul g_x
max 0|-ul g_y
max 0|ul img_x
max 0|ul img_y
np maximum heatmap
cv2 cvtColor image|cv2 COLOR_BGR2GRAY
data_rng normal scale alpha
np dot eigvec|eigval|alpha image
image2 image1
blend_ alpha|image|gs
blend_ alpha|image|gs_mean
[brightness_|contrast_|saturation_] functions
random shuffle functions
grayscale image gs
gs mean gs_mean
functions f
f data_rng|image|gs|gs_mean|0 4
lighting_ data_rng|image|0 1|eig_val|eig_vec
range p src
range p src
range p b3
range p masked_regmap
np array [0|0]|dtype shift src
np array [0|0]|dtype shift src
isinstance scale|np ndarrayandnotisinstance scale scale_tmp
isinstance scale|np ndarrayandnotisinstance  int output_size|int output_size
np array [scale|scale]|dtype scale scale_tmp
np array [scale|scale]|dtype scale src
np array [scale|scale]|dtype scale src
scale scale_tmp src_w
scale scale_tmp src
scale scale_tmp src
get_dir [0|src_w|-0 5]|rot_rad src_dir src
np zeros (3|2) src src
np zeros (3|2) src src_result
center|scale_tmp|shift src src
center|scale_tmp|shift src src_result
center|src_dir|scale_tmp|shift src src
center|src_dir|scale_tmp|shift src src_result
np sin rot_rad cs src_result
np sin rot_rad cs src_result
det_size width b1
det_size width c1
det_size width c2
det_size width b3
det_size width c3
(height|width) b1 r1
np sqrt b12-4|a1|c1 sq1 r1
np sqrt b22-4|a2|c2 sq2 r2
-2|min_overlap|(height|width) b3 r3
np sqrt b32-4|a3|c3 sq3 r3
np ogrid x masked_regmap
np ogrid x y
heatmap masked_heatmap out
np array(value|dtype value reshape (-1|1|1) value
np array value|dtype value shape dim
regmap masked_regmap masked_regmap
regmap masked_regmap regmap
(masked_gaussian) idx masked_regmap
(1-idx)|masked_regmap|idx|masked_reg masked_regmap masked_regmap
(1-idx)|masked_regmap|idx|masked_reg masked_regmap regmap
np arange 0|size|1|np float32 x y
blend_ gs mean gs_mean
blend_ gs mean gs_mean
[brightness_|contrast_|saturation_] functions f
random shuffle functions f
grayscale image gs mean gs_mean
functions f data_rng|image|gs|gs_mean|0 4
int os getenv devid
config num_classes num_classes
config anchors_mask anchors_mask
backbone_HwYolov3 num_classes|num_anchors_list|args network
os path isfile args pretrained
load_checkpoint args pretrained param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
print  format args pretrained
Tensor input_data tensor_input_data
parser parse_args arg
save_air arg
load_checkpoint args pretrained param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
int os getenv devid
argparse ArgumentParser parser
parser parse_known_args _
save_air arg
get_rank args local_rank
get_group_size args world_size
config batch_size args batch_size
config warmup_lr args warmup_lr
config lr_rates args lr_rates
config lr_steps args lr_steps
config gamma args gamma
config weight_decay args weight_decay
config momentum args momentum
config max_epoch args max_epoch
config log_interval args log_interval
config ckpt_path args ckpt_path
config ckpt_interval args ckpt_interval
os path join args ckpt_path|datetime datetime now strftime args outputs_dir
print args outputs_dir
get_logger args outputs_dir|args local_rank args logger
[i|8||args world_sizeforiinargs lr_steps] args lr_steps
ParallelMode DATA_PARALLEL parallel_mode
ParallelMode STAND_ALONE parallel_mode
args mindrecord_path mindrecord_path
config num_classes num_classes
config anchors anchors
config anchors_mask anchors_mask
args momentum momentum
args logger info  format momentum
args weight_decay|float(args batch_size) weight_decay
args logger info  format weight_decay
args world_size|8 lr_scale
args logger info  format lr_scale
args logger info
args max_epoch epoch
ds get_dataset_size args steps_per_epoch
warmup_step_new args|lr_scale lr
ds repeat epoch ds
args logger info  format args steps_per_epoch
args logger info  format args world_size
args logger info  format args local_rank
args logger save_args args
args logger important_info
time time create_network_start
backbone_HwYolov3 num_classes|num_anchors_list|args network
os path isfile args pretrained
load_checkpoint args pretrained param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
args logger info  format args pretrained
BuildTrainNetworkV2 network|criterion0|criterion1|criterion2|args train_net
TrainOneStepWithLossScaleCell train_net|opt train_net
train_net set_broadcast_flag
args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num
CheckpointConfig save_checkpoint_steps train_config
_InternalCallbackParam cb_params
train_net cb_params train_network
ckpt_max_num cb_params epoch_num
RunContext cb_params run_context
ckpt_cb begin run_context
train_net set_train
time time t_end
time time t_epoch
-1 old_progress
data batch_images
data batch_labels
data coord_mask_0
data conf_pos_mask_0
data conf_neg_mask_0
data cls_mask_0
data t_coord_0
data t_conf_0
data t_cls_0
data gt_list_0
data coord_mask_1
data conf_pos_mask_1
data conf_neg_mask_1
data cls_mask_1
data t_coord_1
data t_conf_1
data t_cls_1
data gt_list_1
data coord_mask_2
data conf_pos_mask_2
data conf_neg_mask_2
data cls_mask_2
data t_coord_2
data t_conf_2
data t_cls_2
data gt_list_2
Tensor batch_images|mstype float32 img_tensor
Tensor coord_mask_0 astype np float32 coord_mask_tensor_0
Tensor conf_pos_mask_0 astype np float32 conf_pos_mask_tensor_0
Tensor conf_neg_mask_0 astype np float32 conf_neg_mask_tensor_0
Tensor cls_mask_0 astype np float32 cls_mask_tensor_0
Tensor t_coord_0 astype np float32 t_coord_tensor_0
Tensor t_conf_0 astype np float32 t_conf_tensor_0
Tensor t_cls_0 astype np float32 t_cls_tensor_0
Tensor gt_list_0 astype np float32 gt_list_tensor_0
Tensor coord_mask_1 astype np float32 coord_mask_tensor_1
Tensor conf_pos_mask_1 astype np float32 conf_pos_mask_tensor_1
Tensor conf_neg_mask_1 astype np float32 conf_neg_mask_tensor_1
Tensor cls_mask_1 astype np float32 cls_mask_tensor_1
Tensor t_coord_1 astype np float32 t_coord_tensor_1
Tensor t_conf_1 astype np float32 t_conf_tensor_1
Tensor t_cls_1 astype np float32 t_cls_tensor_1
Tensor gt_list_1 astype np float32 gt_list_tensor_1
Tensor coord_mask_2 astype np float32 coord_mask_tensor_2
Tensor conf_pos_mask_2 astype np float32 conf_pos_mask_tensor_2
Tensor conf_neg_mask_2 astype np float32 conf_neg_mask_tensor_2
Tensor cls_mask_2 astype np float32 cls_mask_tensor_2
Tensor t_coord_2 astype np float32 t_coord_tensor_2
Tensor t_conf_2 astype np float32 t_conf_tensor_2
Tensor t_cls_2 astype np float32 t_cls_tensor_2
Tensor gt_list_2 astype np float32 gt_list_tensor_2
Tensor scale_manager get_loss_scale|dtype scaling_sens
np all overflow asnumpy overflow
scale_manager update_loss_scale overflow
scale_manager update_loss_scale False
i|1 cb_params cur_step_num
i|2 cb_params batch_num
ckpt_cb step_end run_context
time time-create_network_start time_for_graph_compile
time time-t_end time_used
int i|args steps_per_epoch epoch
args batch_size|(i-old_progress)args world_size|time_used fps
args logger info  format epoch|i|loss0|fps
i old_progress
time time-t_epoch epoch_time_used
args batch_sizeargs world_sizeargs steps_per_epoch|epoch_time_used fps
args logger info  format epoch|i|fps
i|1 i
parse_args arg
train arg
argparse ArgumentParser parser parse_known_args _
save_air arg world_sizeforiinargs lr_steps] args lr_steps
args world_size|8 lr_scale lr
args logger info  format lr_scale lr
warmup_step_new args|lr_scale lr lr
load_checkpoint args pretrained param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
BuildTrainNetworkV2 network|criterion0|criterion1|criterion2|args train_net set_broadcast_flag
BuildTrainNetworkV2 network|criterion0|criterion1|criterion2|args train_net cb_params train_network
BuildTrainNetworkV2 network|criterion0|criterion1|criterion2|args train_net set_train
TrainOneStepWithLossScaleCell train_net|opt train_net set_broadcast_flag
TrainOneStepWithLossScaleCell train_net|opt train_net cb_params train_network
TrainOneStepWithLossScaleCell train_net|opt train_net set_train
args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num cb_params epoch_num
args logger info  format i old_progress
i|1 i i
plt switch_backend
int os getenv devid
argparse ArgumentParser parser
parser parse_known_args _
config batch_size args batch_size
config input_shape args input_shape
config result_path args result_path
config conf_thresh args conf_thresh
config nms_thresh args nms_thresh
args mindrecord_path mindrecord_path
print  format mindrecord_path
config num_classes num_classes
config anchors anchors
config anchors_mask anchors_mask
{0} classes
de MindDataset mindrecord_path|columns_list ds
SingleScaleTrans resize single_scale_trans
ds get_dataset_size args steps_per_epoch
backbone_HwYolov3 num_classes|num_anchors_list|args network
os path isfile args pretrained
load_checkpoint args pretrained param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
print  format args pretrained
ds repeat ds
args pretrained split model_name
os path join args result_path|model_name result_path
os path exists result_path
os path isdir result_path
os path join result_path|
print args conf_thresh
data batch_images
data batch_labels
data batch_image_name
data batch_image_size
Tensor batch_images|mstype float32 img_tensor
test_net img_tensor cls_scores_2
tdets append converted_boxes_0
tdets append converted_boxes_1
tdets append converted_boxes_2
len tdets batch
range b
range op
single_dets extend tdets op b
dets append single_dets
enumerate} k|v
print eval_times
print args batch_size
args input_shape neth
voc_wrapper reorg_detection det|netw|neth|img_size reorg_dets
voc_wrapper gen_results reorg_dets|result_path|img_size|args nms_thresh
parse_gt_from_anno img_anno|classes ground_truth
parse_rets ret_files_set ret_list
calc_recall_presicion_ap ground_truth|ret_list|iou_thr evaluate
evaluate cls
range]|[i i
plt axis [0|1 2|0|1 2]
plt xlabel
plt ylabel
plt grid
plt legend
plt title
os path join result_path|result_path replace ap_save_path
print  format ap_save_path
plt savefig ap_save_path
parse_args arg
val arg
argparse ArgumentParser parser parse_known_args _
de MindDataset mindrecord_path|columns_list ds get_dataset_size args steps_per_epoch
de MindDataset mindrecord_path|columns_list ds repeat ds
load_checkpoint args pretrained param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
param_dict items val arg
calc_recall_presicion_ap ground_truth|ret_list|iou_thr evaluate cls
super LOGGER|self __init__ logger_name
logging StreamHandler sys stdout console
console setLevel logging INFO
logging Formatter formatter
console setFormatter formatter
self addHandler console
local_rank self local_rank
os path exists log_dir
datetime now strftime log_name
os path join log_dir|log_name self log_fn
logging FileHandler self log_fn fh
fh setLevel logging INFO
fh setFormatter formatter
self addHandler fh
self _log logging INFO|msg|args|kwargs
self info
vars args args_dict
args_dict keys key
self info key|args_dict[key]
|line_width important_msg
|2 important_msg
self info important_msg|args|kwargs
LOGGER logger_name_1 logger
logger setup_logging_file path|rank
name self name
fmt self fmt
self reset
tb_writer self tb_writer
val self val
val|n self sum
n self count
self sum|self count self avg
self tb_writer add_scalar self name|self val|self cur_step
fmtstr format self __dict__
logging StreamHandler sys stdout console setLevel logging INFO
logging StreamHandler sys stdout console setFormatter formatter
logging FileHandler self log_fn fh setLevel logging INFO
logging FileHandler self log_fn fh setFormatter formatter
vars args args_dict keys key
LOGGER logger_name_1 logger setup_logging_file path|rank
fmtstr format self __dict__
crop_anno Boolean|optional
intersection_threshold numberorlist|optional
fill_color self fill_color
jitter self jitter
input_dim self input_dim
isinstance img|Image Image
self _tf_pil img _
isinstance img|np ndarray
self _tf_cv img _
self _tf_anno annos annos
np asarray annos annos
self input_dim self output_h
img shape orig_w
int self jitter|orig_w dw
int self jitter|orig_h dh
float orig_w|random randint -dw|dw|(orig_h|random randint -dh|dh) new_ar
save_info new_ar
random random||0 25 scale
save_info scale
int scale|orig_h nh
int nh|new_ar nw
int scale|orig_w nw
int nw|new_ar nh
random randint 0|self output_w-nw dx
random randint self output_w-nw|0 dx
save_info dx
random randint 0|self output_h-nh dy
random randint self output_h-nh|0 dy
save_info dy
max 0|-dx nxmin
max 0|-dy nymin
min nw|-dx|self output_w-1 nxmax
min nh|-dy|self output_h-1 nymax
float orig_w|nw|float(orig_h)|nh sy
int nxmin|sx orig_xmin
int nymin|sy orig_ymin
int nxmax|sx orig_xmax
int nymax|sy orig_ymax
img orig_crop
cv2 resize orig_crop|(nxmax-nxmin|nymax-nymin) orig_crop_resize
np ones (self output_h|self output_w|channels) output_img
int min output_img shape|orig_crop_resize shape y_lim
int min output_img shape|orig_crop_resize shape x_lim
[sx|sy|nxmin|nymin|nxmax|nymax] self crop_info
img size orig_h
np array img img_np
img crop (orig_xmin|orig_ymin|orig_xmax|orig_ymax) orig_crop
orig_crop resize (nxmax-nxmin|nymax-nymin) orig_crop_resize
Image new img mode|(self output_w|self output_h) output_img
output_img paste orig_crop_resize|(0|0)
anno value
self crop_info crop_ymax
range i
annos i anno
is_negative anno
max crop_xmin|int(anno|sx) x1
min crop_xmax|int((anno|anno)|sx) x2
max crop_ymin|int(anno|sy) y1
min crop_ymax|int((anno|anno)|sy) y2
x2-x1 w
y2-y1 h
np zeros annos i
x1-crop_xmin annos i
y1-crop_ymin annos i
w annos i
h annos i
threshold self threshold
self _tf_pil img img
self _tf_cv img img
self _get_flip self flip
img size self im_w
img transpose Image FLIP_LEFT_RIGHT img
img shape self im_w
cv2 flip img|1 img
random random flip
self im_w-anno-anno anno
hue self hue
saturation self saturation
value self value
random uniform -self hue|self hue dh
random uniform 1|self saturation ds
random uniform 1|self value dv
self _tf_pil img|dh|ds|dv img
 self _tf_cv img|dh|ds|dv|annos
img convert img
list img split channels
int dh|255 x
channels point change_hue channels
Image merge img mode|tuple(channels) img
img astype np float32|255 0 img
cv2 cvtColor img|cv2 COLOR_RGB2HSV img
cv2 cvtColor img|cv2 COLOR_HSV2RGB img
(img|255) astype(np uint8) img
self input_dim net_h
img size im_h
net_w|im_w self scale
net_h|im_h self scale
Image NEAREST resample_mode
img resize (int(self scale|im_w)) img
(net_w-im_w)|2 pad_w
(net_h-im_h)|2 pad_h
(int(pad_w)) self pad
ImageOps expand img|border img
crop_anno  self _tf_cv img|dh|ds|dv|annos
intersection_threshold  self _tf_cv img|dh|ds|dv|annos
intersection_threshold list img split channels
isinstance img|Image Image new img mode|(self output_w|self output_h) output_img
isinstance img|Image Image merge img mode|tuple(channels) img
isinstance img|Image Image NEAREST resample_mode
self _tf_anno annos annos i anno
np asarray annos annos i anno
max 0|-dx nxmin self crop_info
max 0|-dy nymin self crop_info
min nw|-dx|self output_w-1 nxmax self crop_info
min nh|-dy|self output_h-1 nymax self crop_info
float orig_w|nw|float(orig_h)|nh sy self crop_info
img orig_crop resize (nxmax-nxmin|nymax-nymin) orig_crop_resize
np ones (self output_h|self output_w|channels) output_img paste orig_crop_resize|(0|0)
img crop (orig_xmin|orig_ymin|orig_xmax|orig_ymax) orig_crop resize (nxmax-nxmin|nymax-nymin) orig_crop_resize
Image new img mode|(self output_w|self output_h) output_img paste orig_crop_resize|(0|0)
output_img paste  self _tf_cv img|dh|ds|dv|annos
anno value self value
range i self scale
range i self scale
x2-x1 w annos i
x2-x1 w self scale
y2-y1 h annos i
y2-y1 h self scale
np zeros annos i self scale
np zeros annos i self scale
x1-crop_xmin annos i self scale
x1-crop_xmin annos i self scale
y1-crop_ymin annos i self scale
y1-crop_ymin annos i self scale
w annos i self scale
w annos i self scale
h annos i self scale
h annos i self scale
self _tf_pil img img size self im_w
self _tf_pil img img transpose Image FLIP_LEFT_RIGHT img
self _tf_pil img img shape self im_w
self _tf_pil img img convert img
self _tf_pil img img astype np float32|255 0 img
self _tf_pil img img astype(np uint8) img
self _tf_pil img img size im_h
self _tf_pil img img resize (int(self scale|im_w)) img
self _tf_cv img img size self im_w
self _tf_cv img img transpose Image FLIP_LEFT_RIGHT img
self _tf_cv img img shape self im_w
self _tf_cv img img convert img
self _tf_cv img img astype np float32|255 0 img
self _tf_cv img img astype(np uint8) img
self _tf_cv img img size im_h
self _tf_cv img img resize (int(self scale|im_w)) img
img size self im_w self scale
img shape self im_w self scale
cv2 flip img|1 img convert img
cv2 flip img|1 img astype np float32|255 0 img
cv2 flip img|1 img astype(np uint8) img
cv2 flip img|1 img size im_h
cv2 flip img|1 img resize (int(self scale|im_w)) img
self _tf_pil img|dh|ds|dv img convert img
self _tf_pil img|dh|ds|dv img astype np float32|255 0 img
self _tf_pil img|dh|ds|dv img astype(np uint8) img
self _tf_pil img|dh|ds|dv img size im_h
self _tf_pil img|dh|ds|dv img resize (int(self scale|im_w)) img
 self _tf_cv  self _tf_cv img|dh|ds|dv|annos
 self _tf_cv img convert img
 self _tf_cv img astype np float32|255 0 img
 self _tf_cv img size im_h
 self _tf_cv img resize (int(self scale|im_w)) img
list img split channels point change_hue channels
Image merge img mode|tuple(channels) img astype np float32|255 0 img
Image merge img mode|tuple(channels) img astype(np uint8) img
Image merge img mode|tuple(channels) img size im_h
Image merge img mode|tuple(channels) img resize (int(self scale|im_w)) img
cv2 cvtColor img|cv2 COLOR_RGB2HSV img astype(np uint8) img
cv2 cvtColor img|cv2 COLOR_RGB2HSV img size im_h
cv2 cvtColor img|cv2 COLOR_RGB2HSV img resize (int(self scale|im_w)) img
cv2 cvtColor img|cv2 COLOR_HSV2RGB img astype(np uint8) img
cv2 cvtColor img|cv2 COLOR_HSV2RGB img size im_h
cv2 cvtColor img|cv2 COLOR_HSV2RGB img resize (int(self scale|im_w)) img
(img|255) astype(np uint8) img astype(np uint8) img
(img|255) astype(np uint8) img size im_h
(img|255) astype(np uint8) img resize (int(self scale|im_w)) img
self input_dim net_h self scale
img size im_h self scale
super Conv2dBatchReLU|self __init__
in_channels self in_channels
out_channels self out_channels
kernel_size self kernel_size
stride self stride
isinstance kernel_size|(list|tuple)
[int ii|2foriiinkernel_size] self padding
int kernel_size|2 self padding
nn ReLU self relu
self conv x x
self bn x x
self relu x x
super Conv2dBatch|self __init__
padding self padding
super MakeYoloLayer|self __init__
layer x
self layers append Conv2dBatchReLU x|x|x|x
self layers append Conv2dBatch x|x|x|x|x
nn CellList self layers self layers
self layers block
block x x
super UpsampleLayer|self __init__
P Upsample factor self upsample
self upsample x x
super HwYolov3|self __init__
MakeYoloLayer layer0 self layer0
MakeYoloLayer layer1 self layer1
MakeYoloLayer layer2 self layer2
MakeYoloLayer layer3 self layer3
args self args
P Concat self concat
MakeYoloLayer layer5 self layer5
MakeYoloLayer layer7 self layer7
self layer0 x stem
self layer1 stem stage4
self layer2 stage4 stage5
self layer3 stage5 stage6_det1
self layer4 stage6_det1 upsample1
self relu upsample1 upsample1_relu
self concat (upsample1_relu|stage5) concat_s5_s6
self layer5 concat_s5_s6 stage7_det2
self layer6 stage7_det2 upsample2
self relu upsample2 upsample2_relu
self concat (upsample2_relu|stage4) concat_s4_s7
self layer7 concat_s4_s7 stage8_det3
self head1_conv stage6_det1 det1
self head2_conv stage7_det2 det2
self head3_conv stage8_det3 det3
[int ii|2foriiinkernel_size] self padding self padding
int kernel_size|2 self padding self padding
self layers block x x
super PtLinspace|self __init__
P TupleToArray self tuple_to_array
(end-start|1)|steps step
range start|end i
(i|) lin_x
self tuple_to_array lin_x lin_x
super MSELoss|self __init__
P Sum self sum
P Pow self pow
P Sqrt self sqrt
nembeddings1-nembeddings2 dist
self pow dist|2 0 dist_pow
self sum dist_pow|1 dist_sum
self sqrt dist_sum dist_sqrt
self mean dist_sqrt|0 loss
super YoloLoss|self __init__
num_classes self num_classes
len anchors_mask self num_anchors
len anchors self anchor_step
np array anchors|dtype self anchors
Tensor self anchors|mstype float32 self tensor_anchors
anchors_mask self anchors_mask
range i
anchors_w append self anchors[self anchors_mask i]
anchors_h append self anchors[self anchors_mask i]
Tensor np array anchors_w reshape len self anchors_mask self anchors_w
Tensor np array anchors_h reshape len self anchors_mask self anchors_h
reduction self reduction
seen self seen
head_idx self head_idx
Tensor self zero
coord_scale self coord_scale
no_object_scale self no_object_scale
object_scale self object_scale
class_scale self class_scale
thresh self thresh
P Shape self shape
P Reshape self reshape
P Sigmoid self sigmoid
P ZerosLike self zeros_like
P Concat self concat0
P Concat self concat0_2
P Concat self concat0_3
P Concat self concat0_4
P Concat self concat1
P Concat self concat1_2
P Concat self concat1_3
P Concat self concat1_4
P Concat self concat2
P Concat self concat2_2
P Concat self concat2_3
P Concat self concat2_4
P Tile self tile
P Transpose self transpose
P Cast self cast
P Exp self exp
P ReduceSum self sum
P SmoothL1Loss self smooth_l1_loss
P SigmoidCrossEntropyWithLogits self bce
P SoftmaxCrossEntropyWithLogits self ce
PtLinspace self pt_linspace
nn OneHot -1|self num_classes|1 0|0 0 self one_hot
P Squeeze self squeeze_2
P ReduceSum self reduce_sum
P Select self select
P IOU self iou
self shape output output_d
output_d num_batch
self num_anchors num_anchors
self num_classes num_classes
output_d|num_anchors num_channels
output_d height
output_d width
self reshape output|(num_batch|num_anchors|num_channels|height|width) output
output coord_01
output coord_23
self concat2 (coord_01|coord_23) coord
self squeeze_2 output conf
output cls
self reshape cls|(num_batch|num_anchors|num_classes|height|width) cls
(0|2|1) perm
self transpose cls|perm cls
self shape cls cls_shp
self reshape cls|(cls_shp|cls_shp|cls_shp|num_classes|num_classes) cls
self pt_linspace 0|width-1|width lin_x
self tile lin_x|(height|) lin_x
self cast lin_x|mstype float32 lin_x
self pt_linspace 0|height-1|height lin_y
self reshape lin_y|(height|1) lin_y
self tile lin_y|(1|width) lin_y
self reshape lin_y|(self shape lin_y|self shape lin_y) lin_y
self cast lin_y|mstype float32 lin_y
self anchors_w anchor_w
self anchors_h anchor_h
self cast anchor_w|mstype float32 anchor_w
self cast anchor_h|mstype float32 anchor_h
self sigmoid coord coord_x
self squeeze_2 coord_x|lin_x pred_boxes_0
self shape pred_boxes_0 shape_pb0
self reshape pred_boxes_0|(shape_pb0|shape_pb0|shape_pb0|1) pred_boxes_0
self sigmoid coord coord_y
self squeeze_2 coord_y|lin_y pred_boxes_1
self shape pred_boxes_1 shape_pb1
self reshape pred_boxes_1|(shape_pb1|shape_pb1|shape_pb1|1) pred_boxes_1
self exp self squeeze_2 coord|anchor_w pred_boxes_2
self shape pred_boxes_2 shape_pb2
self reshape pred_boxes_2|(shape_pb2|shape_pb2|shape_pb2|1) pred_boxes_2
self exp self squeeze_2 coord|anchor_h pred_boxes_3
self shape pred_boxes_3 shape_pb3
self reshape pred_boxes_3|(shape_pb3|shape_pb3|shape_pb3|1) pred_boxes_3
pred_boxes_0-pred_boxes_2|2 pred_boxes_x1
pred_boxes_1-pred_boxes_3|2 pred_boxes_y1
pred_boxes_0|pred_boxes_2|2 pred_boxes_x2
pred_boxes_1|pred_boxes_3|2 pred_boxes_y2
self concat1_4 (pred_boxes_x1|pred_boxes_y1|pred_boxes_x2|pred_boxes_y2) pred_boxes_points
num_anchors|height|width total_anchors
self zeros_like conf_neg_mask conf_neg_mask_zero
pred_boxes_points|64 pred_boxes_points
gt_list|64 gt_list
range b
pred_boxes_points cur_pred_boxes
self iou self cast cur_pred_boxes|mstype float16 iou_gt_pred
self cast (iou_gt_pred) mask
self reduce_sum mask|0 mask
self shape conf_neg_mask shape_neg
self reshape mask|(1|shape_neg|shape_neg) mask
mask mask_concat
self concat0_2 (mask_concat|mask) mask_concat
self select mask_concat|conf_neg_mask_zero|conf_neg_mask conf_neg_mask
self tile coord_mask|(1|1|4|1) coord_mask
coord coord_center
t_coord t_coord_center
coord coord_wh
t_coord t_coord_wh
self shape t_cls shape_t_cls
self reshape t_cls|(shape_t_cls|shape_t_cls|shape_t_cls|) t_cls
self one_hot self cast t_cls|mstype int32 one_hot_label
self shape cls_mask shape_cls_mask
self reshape cls_mask|(1|shape_cls_mask|shape_cls_mask|shape_cls_mask) cls_mask
added_scale|2 0|1 0|self coord_scale|self sum loss_coord_center
added_scale|2 0|1 5|self coord_scale|self sum loss_coord_wh
added_scale|2 0|self object_scale|self sum(conf_pos_mask|self bce conf|t_conf) loss_conf_pos
loss_conf_pos|loss_conf_neg loss_conf
self class_scale|1 0|self sum(cls_mask|self ce cls|one_hot_label) loss_cls
self squeeze_2 output cls
added_scale|2 0|self object_scale|self sum(conf_pos_mask|self bce cls|t_conf) loss_cls_pos
loss_cls_pos|loss_cls_neg loss_cls
loss_coord|0 5|loss_conf|0 5|loss_cls loss_tot
(end-start|1)|steps step step
range start|end i lin_x
self mean dist_sqrt|0 loss loss_conf
self mean dist_sqrt|0 loss loss_cls
len anchors_mask self num_anchors num_channels
len anchors_mask self num_anchors total_anchors
np array anchors|dtype self anchors total_anchors
self shape output output_d num_batch
self shape output output_d num_channels
self shape output output_d height
self shape output output_d width
self num_anchors num_anchors num_channels
self num_anchors num_anchors total_anchors
output_d height total_anchors
output_d width total_anchors
self reshape output|(num_batch|num_anchors|num_channels|height|width) output coord_01
self reshape output|(num_batch|num_anchors|num_channels|height|width) output coord_23
self reshape output|(num_batch|num_anchors|num_channels|height|width) output cls
self concat2 (coord_01|coord_23) coord coord_center
self concat2 (coord_01|coord_23) coord coord_wh
self concat2 (coord_01|coord_23) coord 5|loss_conf|0 5|loss_cls loss_tot
self squeeze_2 coord_x|lin_x pred_boxes_0 pred_boxes_x2
self reshape pred_boxes_0|(shape_pb0|shape_pb0|shape_pb0|1) pred_boxes_0 pred_boxes_x2
self squeeze_2 coord_y|lin_y pred_boxes_1 pred_boxes_y2
self reshape pred_boxes_1|(shape_pb1|shape_pb1|shape_pb1|1) pred_boxes_1 pred_boxes_y2
self exp self squeeze_2 coord|anchor_w pred_boxes_2 pred_boxes_x1
self exp self squeeze_2 coord|anchor_w pred_boxes_2 pred_boxes_x2
self reshape pred_boxes_2|(shape_pb2|shape_pb2|shape_pb2|1) pred_boxes_2 pred_boxes_x1
self reshape pred_boxes_2|(shape_pb2|shape_pb2|shape_pb2|1) pred_boxes_2 pred_boxes_x2
self exp self squeeze_2 coord|anchor_h pred_boxes_3 pred_boxes_y1
self exp self squeeze_2 coord|anchor_h pred_boxes_3 pred_boxes_y2
self reshape pred_boxes_3|(shape_pb3|shape_pb3|shape_pb3|1) pred_boxes_3 pred_boxes_y1
self reshape pred_boxes_3|(shape_pb3|shape_pb3|shape_pb3|1) pred_boxes_3 pred_boxes_y2
self concat1_4 (pred_boxes_x1|pred_boxes_y1|pred_boxes_x2|pred_boxes_y2) pred_boxes_points pred_boxes_points
self concat1_4 (pred_boxes_x1|pred_boxes_y1|pred_boxes_x2|pred_boxes_y2) pred_boxes_points cur_pred_boxes
pred_boxes_points|64 pred_boxes_points pred_boxes_points
pred_boxes_points|64 pred_boxes_points cur_pred_boxes
gt_list|64 gt_list gt_list
self cast (iou_gt_pred) mask mask_concat
self reduce_sum mask|0 mask mask_concat
self reshape mask|(1|shape_neg|shape_neg) mask mask_concat
added_scale|2 0|self object_scale|self sum(conf_pos_mask|self bce conf|t_conf) loss_conf_pos loss_conf
loss_conf_pos|loss_conf_neg loss_conf loss_conf
self class_scale|1 0|self sum(cls_mask|self ce cls|one_hot_label) loss_cls loss_cls
added_scale|2 0|self object_scale|self sum(conf_pos_mask|self bce cls|t_conf) loss_cls_pos loss_cls
loss_cls_pos|loss_cls_neg loss_cls loss_cls
super PtLinspace|self __init__
P TupleToArray self tuple_to_array
(end-start|1)|steps step
range start|end i
(i|) lin_x
self tuple_to_array lin_x lin_x
super YoloPostProcess|self __init__
P Print self print
num_classes self num_classes
cur_anchors self anchors
conf_thresh self conf_thresh
network_size self network_size
reduction self reduction
anchors_mask self anchors_mask
len anchors_mask self num_anchors
range i
anchors_w append self anchors i
anchors_h append self anchors i
Tensor np array anchors_w reshape (1|len(self anchors_mask)) self anchors_w
Tensor np array anchors_h reshape (1|len(self anchors_mask)) self anchors_h
P Shape self shape
P Reshape self reshape
P Sigmoid self sigmoid
P Cast self cast
P Exp self exp
P Concat self concat3
P Tile self tile
P ExpandDims self expand_dims
PtLinspace self pt_linspace
self shape output output_d
output_d num_batch
self num_anchors num_anchors
output_d|num_anchors num_channels
output_d height
output_d width
self pt_linspace 0|width-1|width lin_x
self tile lin_x|(height|) lin_x
self cast lin_x|mstype float32 lin_x
self pt_linspace 0|height-1|height lin_y
self reshape lin_y|(height|1) lin_y
self tile lin_y|(1|width) lin_y
self reshape lin_y|(self shape lin_y|self shape lin_y) lin_y
self cast lin_y|mstype float32 lin_y
self anchors_w anchor_w
self anchors_h anchor_h
self cast anchor_w|mstype float32 anchor_w
self cast anchor_h|mstype float32 anchor_h
self reshape output|(num_batch|num_anchors|num_channels|height|width) output
(self sigmoid output|lin_x)|width coord_x
(self sigmoid output|lin_y)|height coord_y
self exp output|anchor_w|width coord_w
self exp output|anchor_h|height coord_h
self sigmoid output obj_conf
self sigmoid output cls_conf
obj_conf|cls_conf cls_scores
self expand_dims coord_x|3 coord_x_t
self expand_dims coord_y|3 coord_y_t
self expand_dims coord_w|3 coord_w_t
self expand_dims coord_h|3 coord_h_t
self concat3 (coord_x_t|coord_y_t) coord_1
self concat3 (coord_w_t|coord_h_t) coord_2
self concat3 (coord_1|coord_2) coords
(end-start|1)|steps step step
range start|end i lin_x
len anchors_mask self num_anchors num_channels
self shape output output_d num_batch
self shape output output_d num_channels
self shape output output_d height
self shape output output_d width
self num_anchors num_anchors num_channels
self sigmoid output obj_conf cls_scores
self sigmoid output cls_conf cls_scores
dst_txt replace dst_txt_rm5050
os path exists dst_txt_rm5050
os remove dst_txt_rm5050
open dst_txt|
file readlines lines
lines line
line replace info
info img_name
img_size img_name size
float info-float(info) w
float info-float(info) h
max float size|1920 |float(size)|1080  radio
float w|radio new_w
float h|radio new_h
write_lines append line
file close
open dst_txt_rm5050|
write_lines line
fw write line
boxes x1
boxes y1
boxes x2
boxes y2
boxes scores
(x2-x1|1)|(y2-y1|1) areas
scores argsort order
order i
reserved_boxes append i
np maximum x1 i]|x1[order max_x1
np maximum y1 i]|y1[order max_y1
np minimum x2 i]|x2[order min_x2
np minimum y2 i]|y2[order min_y2
np maximum 0 0|min_x2-max_x1|1 intersect_w
np maximum 0 0|min_y2-max_y1|1 intersect_h
intersect_w|intersect_h intersect_area
intersect_area|(areas-intersect_area) ovr
np where ovr indexs
reorg_dets items label|pieces
pieces keys name
np array pieces[name]|dtype pred
nms pred|nms_thresh keep
keep ik
ret append line
open dst_fp|
fd write  join ret
remove_5050_face dst_fp|img_size
dets items k|v
k name
img_sizes k orig_height
min float netw|orig_width|float(neth)|orig_height scale
orig_width|scale new_width
orig_height|scale new_height
(netw-new_width)|2 0 pad_w
(neth-new_height)|2 0 pad_h
v iv
iv x_top_left xmin
iv y_top_left ymin
xmin|iv width xmax
ymin|iv height ymax
iv confidence conf
iv class_label class_label
max 0|float(xmin-pad_w)|scale xmin
min orig_width-1|float(xmax-pad_w)|scale xmax
max 0|float(ymin-pad_h)|scale ymin
min orig_height-1|float(ymax-pad_h)|scale ymax
reorg_dets setdefault class_label|
reorg_dets class_label setdefault name|
(xmin|ymin|xmax|ymax|conf) piece
reorg_dets class_label name append piece
file readlines lines line
lines line replace info
line replace info img_name
float info-float(info) w intersect_area
float info-float(info) h new_width
boxes x1 areas
boxes y1 areas
boxes scores argsort order
scores argsort order i
order i intersect_area
order i width xmax
order i height ymax
reserved_boxes append i intersect_area
reserved_boxes append i width xmax
reserved_boxes append i height ymax
np maximum 0 0|min_x2-max_x1|1 intersect_w intersect_area
np maximum 0 0|min_y2-max_y1|1 intersect_h intersect_area
intersect_w|intersect_h intersect_area ovr
reorg_dets items pieces keys name
nms pred|nms_thresh keep ik
dets items k name
dets items v iv
img_sizes k orig_height new_height
min float netw|orig_width|float(neth)|orig_height scale new_width
min float netw|orig_width|float(neth)|orig_height scale new_height
v iv x_top_left xmin
v iv y_top_left ymin
v iv width xmax
v iv height ymax
v iv confidence conf
v iv class_label class_label
iv x_top_left xmin width xmax
iv x_top_left xmin piece
iv y_top_left ymin height ymax
iv y_top_left ymin piece
xmin|iv width xmax piece
ymin|iv height ymax piece
iv confidence conf piece
max 0|float(xmin-pad_w)|scale xmin piece
min orig_width-1|float(xmax-pad_w)|scale xmax piece
max 0|float(ymin-pad_h)|scale ymin piece
min orig_height-1|float(ymax-pad_h)|scale ymax piece
{} class_indexing_1
dataset_root_list dataset_root
os path isdir dataset_root
os path join dataset_root anno_dir
os path join dataset_root image_dir
os path join dataset_root valid_txt
filter_valid_files_by_txt image_dir|anno_dir|valid_txt ret_image_names
image_files extend ret_image_files
anno_files extend ret_anno_files
image_names extend ret_image_names
open valid_txt|
txt readlines valid_names
valid_names name
name strip strip_name
os path join anno_dir|strip_name| anno_joint_path
os path isfile anno_joint_path
os path join image_dir|strip_name| image_joint_path
image_joint_path split image_name
os path isfile image_joint_path
image_files append image_joint_path
anno_files append anno_joint_path
image_names append image_name
member text class_name
class_indexing class_name class_num
member find bnx
float bnx find text box_x_min
float bnx find text box_y_min
float bnx find text box_x_max
float bnx find text box_y_max
float box_x_max-box_x_min|1 width
float box_y_max-box_y_min|1 height
float member find text ignore
ET parse anno_file tree
tree getroot root
Image open image_file
fd size orig_height
open image_file|
f read img
root findall member
deserialize member|class_indexing_1 anno
annotation extend anno
FileWriter mindrecord_file_name|mindrecord_num writer
prepare_file_paths image_names
len anno_files dataset_size
range i
data append get_data image_files i i i
writer add_schema yolo_json|
writer write_raw_data data
writer commit
open txt readlines valid_names
txt readlines valid_names name
valid_names name strip strip_name
os path join image_dir|strip_name| image_joint_path split image_name
ET parse anno_file tree getroot root
tree getroot root findall member
FileWriter mindrecord_file_name|mindrecord_num writer add_schema yolo_json|
FileWriter mindrecord_file_name|mindrecord_num writer write_raw_data data
FileWriter mindrecord_file_name|mindrecord_num writer commit
 config
[(8|9|10|11)|(4|5|6|7)|(0|1|2|3)
(resize|resize) self resize
max_anno_count self max_anno_count
self resize size
P Decode decode
ResizeLetterbox input_dim resize_letter_box_op
P ToTensor to_tensor
enumerate i|image
decode image img_pil
img_pil|ann[i] input_data
resize_letter_box_op |input_data input_data
to_tensor input_data image_arr
ret_imgs append image_arr
ret_anno append input_data
enumerate i|anno
anno shape anno_count
np concatenate ret_anno i
np array ret_imgs|np array ret_anno
gt anno
anno data
new_gt append anno
np minimum b1x2|b2x2 transpose-np maximum(b1x1|b2x1 transpose) dx
np maximum dx|0 dx
np minimum b1y2|b2y2 transpose-np maximum(b1y1|b2y1 transpose) dy
np maximum dy|0 dy
dx|dy intersections
(b1x2-b1x1)|(b1y2-b1y1) areas1
(b2x2-b2x1)|(b2y2-b2y1) areas2
(areas1|areas2 transpose)-intersections unions
anno ground_truth
img shape img_shape
int img_shape|img_shape_para n_h
int img_shape|img_shape_para n_w
np array anchors|reduction anchors_ori
len anchors_mask num_anchor
np zeros (num_anchor|n_h|n_w) conf_pos_mask
np ones (num_anchor|n_h|n_w) conf_neg_mask
np zeros (num_anchor|1|n_h|n_w) coord_mask
np zeros (num_anchor|n_h|n_w) cls_mask
np zeros (num_anchor|4|n_h|n_w) t_coord
np zeros (num_anchor|n_h|n_w) t_conf
np zeros (num_anchor|n_h|n_w) t_cls
check_gt_negative_or_empty ground_truth filtered_ground_truth
np zeros (len(ground_truth)) gt_np
gt_np gt_temp
gt_temp gt_list
np zeros (len(filtered_ground_truth)) gt
enumerate i|annotation
np copy gt gt_wh
bbox_ious_numpy gt_wh|anchors iou_gt_anchors
annotation annotation_ignore
annotation annotation_width
annotation annotation_height
annotation annotation_class_id
min n_w-1|max(0|int(gt[i|0])) gi
min n_h-1|max(0|int(gt[i|1])) gj
best_anchors i cur_n
annotation_class_id t_cls
config jitter jitter
config flip flip
config hue hue
config sat sat
config val val
config input_shape size
config anchors anchors
config anchors_mask anchors_mask
RandomCropLetterbox jitter random_crop_letter_box_op
RandomFlip flip random_flip_op
HSVShift hue|sat|val hsv_shift_op
img_pil|annotation input_data
random_crop_letter_box_op |input_data input_data
random_flip_op |input_data input_data
hsv_shift_op |input_data input_data
image_arr ret_img
input_data ret_anno
ret_anno shape anno_count
np array ret_img ret_img
np array ret_anno ret_anno
 gt_list_0
build_targets_brambox ret_img|ret_anno|reduction_0|int reduction_0|anchors_mask|anchors
 gt_list_1
build_targets_brambox ret_img|ret_anno|reduction_1|int reduction_1|anchors_mask|anchors
 gt_list_2
build_targets_brambox ret_img|ret_anno|reduction_2|int reduction_2|anchors_mask|anchors
(preprocess_fn) compose_map_func
(resize|resize) self resize self resize
P Decode decode image img_pil
ResizeLetterbox input_dim resize_letter_box_op |input_data input_data
P ToTensor to_tensor input_data image_arr
enumerate  gt_list_0
enumerate  gt_list_1
enumerate  gt_list_2
decode image img_pil input_data
decode image img_pil input_data
img_pil|ann[i] input_data ret_anno
resize_letter_box_op |input_data input_data ret_anno
to_tensor input_data image_arr ret_img
ret_imgs append image_arr ret_img
ret_anno append input_data ret_anno
enumerate anno shape anno_count
enumerate anno data
enumerate anno ground_truth
enumerate  gt_list_0
enumerate  gt_list_1
enumerate  gt_list_2
np array ret_imgs|np array ret_anno shape anno_count
gt anno data
gt anno ground_truth
gt anno input_data
new_gt append anno ground_truth
new_gt append anno input_data
np minimum b1x2|b2x2 transpose-np maximum(b1x1|b2x1 transpose) dx intersections
np maximum dx|0 dx intersections
np minimum b1y2|b2y2 transpose-np maximum(b1y1|b2y1 transpose) dy intersections
np maximum dy|0 dy intersections
(b1x2-b1x1)|(b1y2-b1y1) areas1 transpose)-intersections unions
(b2x2-b2x1)|(b2y2-b2y1) areas2 transpose)-intersections unions
np zeros (len(ground_truth)) gt_np gt_temp
gt_np gt_temp gt_list
enumerate annotation annotation_ignore
enumerate annotation annotation_width
enumerate annotation annotation_height
enumerate annotation annotation_class_id
enumerate  gt_list_0
enumerate  gt_list_1
enumerate  gt_list_2
annotation annotation_class_id t_cls
RandomCropLetterbox jitter random_crop_letter_box_op |input_data input_data
RandomFlip flip random_flip_op |input_data input_data
HSVShift hue|sat|val hsv_shift_op |input_data input_data
img_pil|annotation input_data ret_anno
random_crop_letter_box_op |input_data input_data ret_anno
random_flip_op |input_data input_data ret_anno
hsv_shift_op |input_data input_data ret_anno
input_data ret_anno shape anno_count
build_targets_brambox ret_img|ret_anno|reduction_0|int  gt_list_1
build_targets_brambox ret_img|ret_anno|reduction_0|int  gt_list_2
build_targets_brambox ret_img|ret_anno|reduction_1|int  gt_list_2
{} class_indexing_1
dataset_root_list dataset_root
os path isdir dataset_root
os path join dataset_root anno_dir
os path join dataset_root image_dir
os path join dataset_root valid_txt
filter_valid_files_by_txt image_dir|anno_dir|valid_txt ret_anno_files
image_files extend ret_image_files
anno_files extend ret_anno_files
open valid_txt|
txt readlines valid_names
valid_names name
name strip strip_name
os path join anno_dir|strip_name| anno_joint_path
os path isfile anno_joint_path
os path join image_dir|strip_name| image_joint_path
os path isfile image_joint_path
image_files append image_joint_path
anno_files append anno_joint_path
member text class_name
class_indexing class_name class_num
member find bnx
float bnx find text box_x_min
float bnx find text box_y_min
float bnx find text box_x_max
float bnx find text box_y_max
float box_x_max-box_x_min|1 width
float box_y_max-box_y_min|1 height
float member find text ignore
ET parse anno_file tree
tree getroot root
open image_file|
f read img
root findall member
deserialize member|class_indexing_1 anno
annotation extend anno
FileWriter mindrecord_file_name|mindrecord_num writer
prepare_file_paths anno_files
len anno_files dataset_size
range i
data append get_data image_files i i
writer add_schema yolo_json|
writer write_raw_data data
writer commit
open txt readlines valid_names
txt readlines valid_names name
valid_names name strip strip_name
ET parse anno_file tree getroot root
tree getroot root findall member
FileWriter mindrecord_file_name|mindrecord_num writer add_schema yolo_json|
FileWriter mindrecord_file_name|mindrecord_num writer write_raw_data data
FileWriter mindrecord_file_name|mindrecord_num writer commit
{} class_indexing_1
dataset_root_list dataset_root
os path isdir dataset_root
os path join dataset_root anno_dir
os path join dataset_root image_dir
os path join dataset_root valid_txt
filter_valid_files_by_txt image_dir|anno_dir|valid_txt ret_anno_files
image_files extend ret_image_files
anno_files extend ret_anno_files
open valid_txt|
txt readlines valid_names
valid_names name
name strip strip_name
os path join anno_dir|strip_name| anno_joint_path
os path isfile anno_joint_path
os path join image_dir|strip_name| image_joint_path
os path isfile image_joint_path
image_files append image_joint_path
anno_files append anno_joint_path
member text class_name
class_indexing class_name class_num
member find bnx
float bnx find text box_x_min
float bnx find text box_y_min
float bnx find text box_x_max
float bnx find text box_y_max
float box_x_max-box_x_min|1 width
float box_y_max-box_y_min|1 height
float member find text ignore
ET parse anno_file tree
tree getroot root
open image_file|
f read img
root findall member
deserialize member|class_indexing_1 anno
annotation extend anno
FileWriter open_for_append mindrecord_file_name| writer
prepare_file_paths anno_files
len anno_files dataset_size
range i
data append get_data image_files i i
writer write_raw_data data
writer commit
open txt readlines valid_names
txt readlines valid_names name
valid_names name strip strip_name
ET parse anno_file tree getroot root
tree getroot root findall member
FileWriter open_for_append mindrecord_file_name| writer write_raw_data data
FileWriter open_for_append mindrecord_file_name| writer commit
C MultitypeFuncGraph _grad_scale
P Reciprocal reciprocal
_grad_scale register
reciprocal scale
super BuildTrainNetwork|self __init__
network self network
criterion self criterion
self network input_data output
self criterion output|label loss
ParameterTuple network trainable_params self weights
optimizer self optimizer
C HyperMap self hyper_map
NPUAllocFloatStatus self alloc_status
NPUGetFloatStatus self get_status
NPUClearFloatStatus self clear_status
Tensor 1|mstype float32 self base
LessEqual self less_equal
P AllReduce self allreduce
_get_parallel_mode self parallel_mode
_get_parallel_mode parallel_mode
_get_gradients_mean mean
_get_device_num degree
DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
self parallel_mode self is_distributed
scale_update_cell self loss_scaling_manager
self weights weights
self alloc_status init
self clear_status init
self loss_scale scaling_sens
sens scaling_sens
self hyper_map F partial _grad_scale|scaling_sens grads
self grad_reducer grads grads
self get_status init
self reduce_sum init|(0|) flag_sum
self allreduce flag_sum flag_reduce
self less_equal self base|flag_reduce cond
self less_equal self base|flag_sum cond
self optimizer grads opt
(loss|cond|scaling_sens) ret
F depend ret|opt
super BuildTrainNetworkV2|self __init__
criterion0 self criterion0
criterion1 self criterion1
criterion2 self criterion2
args self args
self network input_data output2
loss0|loss1|loss2 total_loss
super BuildTestNetwork|self __init__
P Print self print
reduction_0 self reduction_0
reduction_1 self reduction_1
reduction_2 self reduction_2
anchors self anchors
anchors_mask self anchors_mask
self args conf_thresh self conf_thresh
self args nms_thresh self nms_thresh
num_classes self num_classes
args input_shape self network_size
[ ii|self reduction_0|ii|self reduction_0foriiincur_anchors_0] cur_anchors_0
[ ii|self reduction_1|ii|self reduction_1foriiincur_anchors_1] cur_anchors_1
[ ii|self reduction_2|ii|self reduction_2foriiincur_anchors_2] cur_anchors_2
self postprocess_0 output0 cls_scores_0
self postprocess_1 output1 cls_scores_1
self postprocess_2 output2 cls_scores_2
cls instance
isinstance obj|str
instance deserialize obj
isinstance obj|Box
obj class_label instance class_label
obj object_id instance object_id
obj x_top_left instance x_top_left
obj y_top_left instance y_top_left
obj width instance width
obj height instance height
super Detection|self __init__
super Detection|cls create obj instance
isinstance obj|Detection
obj confidence instance confidence
coords_0 asnumpy coords_0
coords_1 asnumpy coords_1
coords_2 asnumpy coords_2
cls_scores_0 asnumpy cls_scores_0
cls_scores_1 asnumpy cls_scores_1
cls_scores_2 asnumpy cls_scores_2
cls_scores_0 shape batch
int input_shape|64 w_0
int input_shape|64 h_0
int input_shape|32 w_1
int input_shape|32 h_1
int input_shape|16 w_2
int input_shape|16 h_2
cls_scores_0 shape num_anchors_0
cls_scores_1 shape num_anchors_1
cls_scores_2 shape num_anchors_2
cls_scores_0 score_thresh_0
cls_scores_1 score_thresh_1
cls_scores_2 score_thresh_2
score_thresh_0 reshape score_thresh_flat_0
score_thresh_1 reshape score_thresh_flat_1
score_thresh_2 reshape score_thresh_flat_2
coords_0 score_thresh_cat_0 -1|4 coords_0
coords_1 score_thresh_cat_1 -1|4 coords_1
coords_2 score_thresh_cat_2 -1|4 coords_2
cls_scores_0 score_thresh_0 -1|1 scores_0
cls_scores_1 score_thresh_1 -1|1 scores_1
cls_scores_2 score_thresh_2 -1|1 scores_2
np tile (np arange num_classes) idx_0
idx_0 score_thresh_0 -1|1 idx_0
np tile (np arange num_classes) idx_1
idx_1 score_thresh_1 -1|1 idx_1
np tile (np arange num_classes) idx_2
idx_2 score_thresh_2 -1|1 idx_2
num_anchors_0|h_0|w_0|num_classes max_det_per_batch_0
([score_thresh_flat_0[s] astype(np int32) sumforsinslices_0]|dtype det_per_batch_0
num_anchors_1|h_1|w_1|num_classes max_det_per_batch_1
([score_thresh_flat_1[s] astype(np int32) sumforsinslices_1]|dtype det_per_batch_1
num_anchors_2|h_2|w_2|num_classes max_det_per_batch_2
([score_thresh_flat_2[s] astype(np int32) sumforsinslices_2]|dtype det_per_batch_2
split_idx_0 end
boxes_0 append detections_0
end start
split_idx_1 end
boxes_1 append detections_1
split_idx_2 end
boxes_2 append detections_2
boxes box
Detection det
box det x_top_left
box det y_top_left
box det width
box det height
box det confidence
class_label_map[int box] det class_label
str int box det class_label
brambox append det
boxes_0 box
converted_boxes_0 append
converted_boxes_0 append convert_tensor_to_brambox box|input_shape|input_shape|labels
boxes_1 box
converted_boxes_1 append
converted_boxes_1 append convert_tensor_to_brambox box|input_shape|input_shape|labels
boxes_2 box
converted_boxes_2 append
converted_boxes_2 append convert_tensor_to_brambox box|input_shape|input_shape|labels
img_anno items img_name|annos
annos anno
anno xmin
anno ymin
xmin|anno-1 xmax
ymin|anno-1 ymax
int xmin xmin
int ymin ymin
int xmax xmax
int ymax ymax
classes[int anno] cls
{} gt_box
objs append gt_box
objs ground_truth img_name
ret_files_set cls
open ret_files_set cls ret_file
ret_file readlines line
line strip split info
info img_name
float info scole
float info xmin
float info ymin
float info xmax
float info ymax
gt_set img
gt_set obj
bd_i-bd_i|0 001 iw
bd_i-bd_i|0 001 ih
calc_rect_area rect1|calc_rect_area(rect2)-iw|ih ua
iw|ih|ua iou
len recall lenght
precision lenght-1 cur_prec
recall lenght-1 cur_rec
range 0|lenght i
max precision i cur_prec
abs recall i
cur_prec|abs(recall[i]-cur_rec) ap_val
recall i cur_rec
len recall num
np zeros 10|1 max_precs
num-1 start_idx
range j
range 0|start_idx i
i start_idx
precision i max_precs j
max_precs j ap_val
ret_list cls
ret_list cls ret
calc_gt_count ground_truth|cls n_gt_obj
print %(cls|n_gt_obj)
np zeros len ret tp
np zeros len ret fp
enumerate ret_idx|info
print %img_name
ground_truth img_name img_gts
-1 max_idx
enumerate idx|gt
calc_iou info iou
iou max_iou
idx max_idx
tp cumsum tp
fp cumsum fp
tp|n_gt_obj recall
tp|(tp|fp) presicion
cal_ap_voc2012 recall|presicion ap
{} evaluate cls
C MultitypeFuncGraph _grad_scale register
P Reciprocal reciprocal scale
self criterion output|label loss ret
self criterion output|label loss total_loss
self loss_scale scaling_sens ret
sens scaling_sens ret
self less_equal self base|flag_reduce cond ret
self less_equal self base|flag_sum cond ret
P Print self print %(cls|n_gt_obj)
P Print self print %img_name
self postprocess_0 output0 cls_scores_0 asnumpy cls_scores_0
self postprocess_0 output0 cls_scores_0 shape batch
self postprocess_0 output0 cls_scores_0 shape num_anchors_0
self postprocess_0 output0 cls_scores_0 score_thresh_0
self postprocess_0 output0 cls_scores_0 score_thresh_0 -1|1 scores_0
self postprocess_1 output1 cls_scores_1 asnumpy cls_scores_1
self postprocess_1 output1 cls_scores_1 shape num_anchors_1
self postprocess_1 output1 cls_scores_1 score_thresh_1
self postprocess_1 output1 cls_scores_1 score_thresh_1 -1|1 scores_1
self postprocess_2 output2 cls_scores_2 asnumpy cls_scores_2
self postprocess_2 output2 cls_scores_2 shape num_anchors_2
self postprocess_2 output2 cls_scores_2 score_thresh_2
self postprocess_2 output2 cls_scores_2 score_thresh_2 -1|1 scores_2
cls instance deserialize obj
isinstance obj class_label instance class_label
isinstance obj object_id instance object_id
isinstance obj x_top_left instance x_top_left
isinstance obj y_top_left instance y_top_left
isinstance obj width instance width
isinstance obj height instance height
isinstance obj confidence instance confidence
isinstance str int box det class_label
instance deserialize obj class_label instance class_label
instance deserialize obj object_id instance object_id
instance deserialize obj x_top_left instance x_top_left
instance deserialize obj y_top_left instance y_top_left
instance deserialize obj width instance width
instance deserialize obj height instance height
instance deserialize obj confidence instance confidence
isinstance obj class_label instance class_label
isinstance obj object_id instance object_id
isinstance obj x_top_left instance x_top_left
isinstance obj y_top_left instance y_top_left
isinstance obj width instance width
isinstance obj height instance height
isinstance obj confidence instance confidence
isinstance obj confidence instance confidence
isinstance Detection det
int input_shape|64 w_0 max_det_per_batch_0
int input_shape|64 h_0 max_det_per_batch_0
int input_shape|32 w_1 max_det_per_batch_1
int input_shape|32 h_1 max_det_per_batch_1
int input_shape|16 w_2 max_det_per_batch_2
int input_shape|16 h_2 max_det_per_batch_2
cls_scores_0 shape num_anchors_0 max_det_per_batch_0
cls_scores_1 shape num_anchors_1 max_det_per_batch_1
cls_scores_2 shape num_anchors_2 max_det_per_batch_2
cls_scores_0 score_thresh_0 reshape score_thresh_flat_0
cls_scores_1 score_thresh_1 reshape score_thresh_flat_1
cls_scores_2 score_thresh_2 reshape score_thresh_flat_2
np tile (np arange num_classes) idx_0 score_thresh_0 -1|1 idx_0
np tile (np arange num_classes) idx_1 score_thresh_1 -1|1 idx_1
np tile (np arange num_classes) idx_2 score_thresh_2 -1|1 idx_2
split_idx_0 end start
end start i
boxes box det x_top_left
boxes box det y_top_left
boxes box det width
boxes box det height
boxes box det confidence
converted_boxes_0 append convert_tensor_to_brambox i start_idx
converted_boxes_1 append convert_tensor_to_brambox i start_idx
converted_boxes_2 append convert_tensor_to_brambox i start_idx
img_anno items annos anno
img_anno items anno xmin
img_anno items anno ymin
annos anno xmin
annos anno ymin
annos anno xmax
annos anno ymax
anno xmin xmax
anno ymin ymax
open ret_files_set cls ret_file readlines line
ret_file readlines line strip split info
line strip split info img_name
bd_i-bd_i|0 001 iw iou
bd_i-bd_i|0 001 ih iou
calc_rect_area rect1|calc_rect_area(rect2)-iw|ih ua iou
iw|ih|ua iou max_iou
len recall lenght i
precision lenght-1 cur_prec ap_val
range 0|lenght i start_idx
max precision i cur_prec ap_val
abs recall i start_idx
np zeros 10|1 max_precs j ap_val
num-1 start_idx i
range 0|start_idx i start_idx
calc_gt_count ground_truth|cls n_gt_obj recall
np zeros len ret tp cumsum tp
np zeros len ret tp recall
np zeros len ret tp presicion
np zeros len ret fp cumsum fp
np zeros len ret fp presicion
enumerate idx max_idx
enumerate idx max_idx
calc_iou info iou max_iou
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step learning_rate
args lr base_lr
int args max_epochargs steps_per_epoch total_steps
int args warmup_epochsargs steps_per_epoch warmup_steps
args lr_epochs milestones
milestones milestone
milestoneargs steps_per_epoch milestones_step
milestones_steps append milestones_step
base_lr lr
Counter milestones_steps milestones_steps_counter
range i
linear_warmup_learning_rate lr
lr_scale|lr|gammamilestones_steps_counter[i] lr
print  format i|lr
lr_each_step append lr
np array lr_each_step astype np float32
args warmup_lr|args batch_size warmup_lr
[lr_rate|args batch_size|lr_scaleforlr_rateinargs lr_rates] lr_rates
args lr_steps lr_steps
lr_steps warmup_steps
print warmup_lr
print lr_rates
lr_steps append args max_epochargs steps_per_epoch
lr_rates append lr_rates
warmup_lr lr
lr_rates lr_left lr
lr_left|1 lr_left
lr base_lr
int max_epoch|steps_per_epoch total_steps
int warmup_epochs|steps_per_epoch warmup_steps
i||steps_per_epoch last_epoch
linear_warmup_learning_rate i|1|warmup_steps|base_lr|warmup_init_lr lr
eta_min|(base_lr-eta_min)|(1 |math cos(math pi|last_epoch|t_max))|2 lr
args lr base_lr lr
args lr_epochs milestones milestone
base_lr lr lr
base_lr lr base_lr
range i last_epoch
linear_warmup_learning_rate lr lr
linear_warmup_learning_rate lr base_lr
lr_scale|lr|gammamilestones_steps_counter[i] lr lr
lr_scale|lr|gammamilestones_steps_counter[i] lr base_lr
print  format lr base_lr
lr_each_step append lr base_lr
args warmup_lr|args batch_size warmup_lr lr
[lr_rate|args batch_size|lr_scaleforlr_rateinargs lr_rates] lr_rates append lr_rates
[lr_rate|args batch_size|lr_scaleforlr_rateinargs lr_rates] lr_rates lr_left lr
args lr_steps lr_steps warmup_steps
args lr_steps lr_steps append args max_epochargs steps_per_epoch
print warmup_lr lr
print lr_rates append lr_rates
print lr_rates lr_left lr
lr_steps append args max_epochargs steps_per_epoch last_epoch
warmup_lr lr base_lr
lr_rates lr_left lr base_lr
lr_left|1 lr_left lr_left
int os getenv devid
get_backbone args network
args pretrained ckpt_path
os path isfile ckpt_path
load_checkpoint ckpt_path param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
network set_train False
Tensor input_data tensor_input_data
ckpt_path replace file_path
print  format file_path
parser parse_args args
parse_args arg
main arg
get_backbone args network set_train False
args pretrained ckpt_path replace file_path
os path isfile ckpt_path replace file_path
load_checkpoint ckpt_path param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
load_param_into_net network set_train False
mindspore common seed set_seed
int os getenv devid
super DistributedHelper|self __init__
backbone self backbone
margin_fc self margin_fc
self backbone x embeddings
self margin_fc embeddings|label
super BuildTrainNetwork|self __init__
network self network
criterion self criterion
args_1 self args
self network input_data|label output
self criterion output|label loss
self network input_data|label _
self criterion None|label loss
argparse ArgumentParser parser
parser parse_known_args _
parse_args args_opt
args_opt train_stage lower
args_opt is_distributed args is_distributed
get_rank args local_rank
get_group_size args world_size
ParallelMode HYBRID_PARALLEL parallel_mode
ParallelMode STAND_ALONE parallel_mode
os path exists args data_dir
args logger info
list map int|args lr_epochs split args lr_epochs
os path join args ckpt_path log_path
get_logger log_path|args local_rank args logger
os path exists args ckpt_path
os makedirs args ckpt_path
args logger info  format args world_size
args logger info  format args local_rank
args logger info  format args lr
args momentum momentum
args weight_decay weight_decay
get_de_dataset args num_classes
args logger info  format de_dataset get_dataset_size
steps_per_epoch args steps_per_epoch
num_classes args num_classes
args logger info  format args num_classes
(args num_classes||16|1)|16 args num_classes
(args num_classes||(args world_size|16)|1)args world_size|16 args num_classes
args logger info  format args steps_per_epoch
args logger info  format args steps_per_epochargs per_batch_size
get_backbone args _backbone
get_metric_fc args margin_fc_1
DistributedHelper _backbone|margin_fc_1 network_1
get_loss args criterion_1
os path isfile args pretrained
load_checkpoint args pretrained param_dict
param_dict items key|value
key startswith
value param_dict_new key
load_param_into_net network_1|param_dict_new
args logger info  format args pretrained
init_net args|network_1
BuildTrainNetwork network_1|criterion_1|args train_net
args logger info  format args
list_to_gen args lrs lrs_gen
args ckpt_steps save_checkpoint_steps
args logger info  format save_checkpoint_steps
int args steps_per_epochargs max_epoch|save_checkpoint_steps|5 keep_checkpoint_max
args max_ckpts keep_checkpoint_max
args logger info  format keep_checkpoint_max
CheckpointConfig save_checkpoint_steps ckpt_config
args max_epoch max_epoch_train
args logger info  format max_epoch_train
ProgressMonitor args progress_cb
max_epoch_train|steps_per_epoch||args log_interval new_epoch_train
[progress_cb|ckpt_cb]|sink_size callbacks
args_1 self args logger info
args_1 self args logger info  format args world_size
args_1 self args logger info  format args local_rank
args_1 self args logger info  format args lr
args_1 self args momentum momentum
args_1 self args weight_decay weight_decay
args_1 self args logger info  format de_dataset get_dataset_size
args_1 self args logger info  format args num_classes
args_1 self args logger info  format args steps_per_epoch
args_1 self args logger info  format args steps_per_epochargs per_batch_size
args_1 self args logger info  format args pretrained
args_1 self args logger info  format args
args_1 self args ckpt_steps save_checkpoint_steps
args_1 self args logger info  format save_checkpoint_steps
args_1 self args max_ckpts keep_checkpoint_max
args_1 self args logger info  format keep_checkpoint_max
args_1 self args max_epoch max_epoch_train
args_1 self args logger info  format max_epoch_train
args_1 self args log_interval new_epoch_train
argparse ArgumentParser parser parse_known_args _
parse_args args_opt train_stage lower
parse_args args_opt is_distributed args is_distributed
get_de_dataset args num_classes args num_classes
args logger info  format args steps_per_epoch log_interval new_epoch_train
load_checkpoint args pretrained param_dict items key|value
param_dict items key startswith
param_dict items value param_dict_new key
init_net args logger info  format args
init_net args ckpt_steps save_checkpoint_steps
init_net args logger info  format save_checkpoint_steps
init_net args max_ckpts keep_checkpoint_max
init_net args logger info  format keep_checkpoint_max
init_net args max_epoch max_epoch_train
init_net args logger info  format max_epoch_train
args max_epoch max_epoch_train log_interval new_epoch_train
args logger info  format max_epoch_train log_interval new_epoch_train
ProgressMonitor args progress_cb callbacks
int os getenv devid
super TxtDataset|self __init__
zip root|filename
open filename fin
self imgs append os path join root|line strip split
self labels append line strip
fin close
cv2 cvtColor cv2 imread self imgs index img
print self imgs index
len self imgs
dataset self dataset
int math ceil len self dataset|1 0|self num_replicas self num_samples
list range len self dataset indices
iter indices
TxtDataset img_predix_all|img_list_all dataset
DistributedSampler dataset sampler
de GeneratorDataset dataset|column_names ds
ds map input_columns ds
ds repeat ds
len dataset|dataset get_all_labels
[jk_list|zj_list] file_paths
[jk_dict|zj_dict] jk_zj_dict_list
zip path|x_dict
open path|
fr line
line strip split label
x_dict get label tmp
tmp append line strip
tmp x_dict label
jk_dict key
jk_dict key jk_file_list
zj_dict key zj_file_list
zj_file_list zj_file
zj2jk_pairs append [zj_file|jk_file_list]
data min min_data
data max max_data
np isnan min_dataornp isnan max_data
args logger info
get_backbone args net
args weight endswith
load_checkpoint args weight param_dict
param_dict items key|value
key startswith
value param_dict_new key
load_param_into_net net|param_dict_new
args logger info  format args weight
net set_train False
np arange matrix shape 1-axis row_index
np argpartition -matrix|k|axis topk_index
matrix topk_index|row_index topk_data
np argsort -topk_data|axis topk_index_sort
topk_data topk_index_sort|row_index topk_data_sort
topk_index topk_index_sort
np arange matrix shape column_index
matrix column_index|topk_index topk_data
topk_data column_index|topk_index_sort topk_data_sort
args logger info  format idx
np array |2 correct
np array tot
zj2jk_pairs idx jk_all
test_embedding_tot zj zj_embedding
args logger info  format idx|zj_embedding shape
args logger info  format idx|jk_all_embedding shape
time time test_time
topk np matmul jk_all_embedding|dis_embedding_tot top100_zj2jk
time time-test_time test_time_used
len jk_all tot
enumerate i|jk
test_embedding_tot jk jk_embedding
np dot jk_embedding|zj_embedding similarity
os path exists args test_dir
time time all_start_time
get_model args net
time time-all_start_time compile_time_used
transforms Compose [vision ToTensor|vision Normalize((0 5|0 5|0 5))] img_transforms
time time step1_start_time
args logger info  format img_tot|ds get_dataset_size
np zeros (img_tot|args emb_size) test_embedding_tot_np
all_labels test_img_labels
enumerate i|data
data idxs
net Tensor img asnumpy astype np float32 out
l2normalize out embeddings
range batch
embeddings batch test_embedding_tot_np idxs batch
enumerate idx|label
test_embedding_tot_np idx test_embedding_tot label
time time step2_start_time
step2_start_time-step1_start_time step1_time_used
get_dataloader args dis_img_predix|args dis_img_list|args dis_batch_size|img_transforms _
np zeros (img_tot|args emb_size) dis_embedding_tot_np
ds_dis get_dataset_size total_batch
args logger info  format img_tot|total_batch
time time start_time
int math ceil 1 0|img_tot|args world_size img_per_gpu
img_per_gpuargs world_size-img_tot delta_num
img_per_gpuargs local_rank-max(0|args local_rank-(args world_size-delta_num)) start_idx
enumerate idx|data
data img
embeddings dis_embedding_tot_np
embeddings shape start_idx
(total_batch-idx-1)args dis_batch_sizeargs world_size|speed time_left
time time step3_start_time
step3_start_time-step2_start_time step2_time_used
args logger info  format step2_time_used
np transpose dis_embedding_tot_np|(1|0) dis_embedding_tot_np
args logger info  format dis_embedding_tot_np shape
int len args test_img_list|2 task_num
np array |(2|task_num) correct
np array |task_num tot
range i
args test_img_list 2|i jk_list
args test_img_list zj_list
sorted generate_test_pair jk_list|zj_list zj2jk_pairs
DistributedSampler zj2jk_pairs sampler
args logger info  format len sampler
sampler idx
cal_topk idx|zj2jk_pairs|test_embedding_tot|dis_embedding_tot_np out2
out1 correct
out2 tot i
time time-step3_start_time step3_time_used
args logger info  format step3_time_used
correct 2|i]|tot[i zj2jk_acc
correct jk2zj_acc
(zj2jk_acc|jk2zj_acc)|2 avg_acc
args logger info results
args logger info  format time time-all_start_time
config_inference arg
[arg test_dir|arg test_dir] arg test_img_predix
[arg test_dir|] arg dis_img_predix
[os path join arg test_dir|] arg dis_img_list
os path join arg ckpt_path log_path
get_logger log_path|arg local_rank arg logger
arg logger info %pformat arg
main arg
open filename fin close
DistributedSampler dataset sampler idx
de GeneratorDataset dataset|column_names ds map input_columns ds
de GeneratorDataset dataset|column_names ds repeat ds
zip x_dict get label tmp
fr line strip split label
x_dict get label tmp append line strip
x_dict get label tmp x_dict label
jk_dict key startswith
zj_dict key zj_file_list zj_file
get_backbone args net set_train False
get_backbone args net Tensor img asnumpy astype np float32 out
load_checkpoint args weight param_dict items key|value
param_dict items key startswith
param_dict items value param_dict_new key
load_param_into_net net set_train False
load_param_into_net net Tensor img asnumpy astype np float32 out
np argpartition -matrix|k|axis topk_index topk_index_sort
matrix topk_index|row_index topk_data topk_index_sort|row_index topk_data_sort
matrix topk_index|row_index topk_data column_index|topk_index_sort topk_data_sort
matrix column_index|topk_index topk_data column_index|topk_index_sort topk_data_sort
np array |2 correct 2|i]|tot[i zj2jk_acc
np array |2 correct jk2zj_acc
get_model args net Tensor img asnumpy astype np float32 out
np zeros (img_tot|args emb_size) test_embedding_tot_np idx test_embedding_tot label
enumerate data idxs
enumerate data img
l2normalize out embeddings batch test_embedding_tot_np idxs batch
l2normalize out embeddings dis_embedding_tot_np
l2normalize out embeddings shape start_idx
enumerate data img
np array |(2|task_num) correct 2|i]|tot[i zj2jk_acc
np array |(2|task_num) correct jk2zj_acc
DistributedSampler zj2jk_pairs sampler idx
args logger info  format len sampler idx
cal_topk idx|zj2jk_pairs|test_embedding_tot|dis_embedding_tot_np out2 tot i
out1 correct 2|i]|tot[i zj2jk_acc
out1 correct jk2zj_acc
correct 2|i]|tot[i zj2jk_acc avg_acc
correct jk2zj_acc avg_acc
config_inference arg logger info %pformat arg
super CrossEntropy|self __init__
args self args_1
P Exp self exp
P ReduceSum self sum
P Reshape self reshape
P Log self log
P Cast self cast
Tensor eps|dtype self eps_const
P OneHot self onehot
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
self exp logit exp
self sum exp|-1 exp_sum
self reshape exp_sum|(F shape exp_sum) exp_sum
exp|exp_sum softmax_result
self onehot one_hot_label
self cast one_hot_label|mstype float32
F shape logit batch_size
self cast batch_size_tensor
self sum loss|-1|batch_size_tensor loss
super Criterions|self __init__
CrossEntropy args self criterion_ce
Tensor 0 0|dtype self total_loss
self total_loss total_loss
self criterion_ce margin_logit|label loss_ce
total_loss|loss_ce total_loss
Criterions args
P Exp self exp softmax_result
self exp logit exp softmax_result
self sum exp|-1 exp_sum softmax_result
self reshape exp_sum|(F shape exp_sum) exp_sum softmax_result
self sum loss|-1|batch_size_tensor loss total_loss
Tensor 0 0|dtype self total_loss total_loss
self total_loss total_loss total_loss
self criterion_ce margin_logit|label loss_ce total_loss
total_loss|loss_ce total_loss total_loss
 config_base
 config_beta
 config_inference
np random seed
network cells_and_names name|cell
isinstance cell|nn Conv2d
cell bias set_data initializer cell bias shape
args logger info  format find_info
args logger info
isinstance cell|nn Dense
isinstance cell|nn BatchNorm2d
isinstance cell|nn BatchNorm1d
isinstance cell|metric_factory CombineMarginFC
isinstance cell|nn PReLU
isinstance cell|IRBlock
cell bn3 gamma set_data initializer cell bn3 gamma shape
network cells_and_names cell bias set_data initializer cell bias shape
network cells_and_names cell bn3 gamma set_data initializer cell bn3 gamma shape
isinstance cell bn3 gamma set_data initializer cell bn3 gamma shape
isinstance dataset|CustomDataset
get_group_size num_replicas
get_rank rank
dataset self dataset
num_replicas self num_replicas
rank self rank
len self dataset classes self data_len
int math ceil self data_len|1 0|self num_replicas self num_ids
self num_ids|self num_replicas self total_ids
math ceil len self dataset|1 0|self num_replicas self num_samples
self num_samples|self num_replicas self total_size
shuffle self shuffle
k self k
indices indice
indice sampled_id
sampled extend np random choice self dataset id2range sampled_id k tolist
(self epoch_gen|1) self epoch_gen
np random seed self epoch_gen
np random permutation len self dataset classes indices
indices tolist indices
list range len self dataset classes indices
self _sample_ indices sampled_idxs
iter sampled_idxs
epoch self epoch
range i
list_result append list2 ct_2
list_result append list1 ct_1
filename lower endswith extensions
os path expanduser dir_1 dir_1
has_file_allowed_extension x|extensions
f is_valid_file
sorted target
os path join dir_1|target d
os path isdir d
sorted root|_|fnames
sorted fname
os path join root|fname path
is_valid_file path
(path|class_to_idx[target]) item
images append item
os path isfile cache_path
self _find_classes root self classes_to_idx
make_dataset root|self classes_to_idx|IMG_EXTENSIONS|None self samples
self _build_id2range self id2range
dict cache
self classes cache
self classes_to_idx cache
self samples cache
self id2range cache
open cache_path|
pickle dump cache|fw
print  format cache_path
print %cache_path
pickle load fr cache
cache| self id2range
range len self samples self all_image_idxs
list self id2range keys self classes
[dfordinos listdir dir_1ifos path isdir os path join dir_1|d] classes
classes sort
{classes[i]} class_to_idx
defaultdict list id2range
defaultdict list ret_range
enumerate idx|sample
sample label
id2range label append (sample|idx)
id2range key
id2range item
ret_range key append item
len self samples
open path|
Image open f img
img convert
ImageFolderDataset root|cache_path|is_distributed self dataset
print  format len self dataset
loader self loader
transform self transform
target_transform self target_transform
self dataset classes self classes
self dataset id2range self id2range
self dataset index target
self loader path sample
self transform sample sample
self target_transform target target
len self dataset
isinstance dataset self dataset
get_group_size num_replicas self num_replicas
get_rank rank self rank
indices indice sampled_id
np random permutation len self dataset classes indices tolist indices
f is_valid_file path
os path join root|fname path item
is_valid_file path item
self _build_id2range self id2range label append (sample|idx)
self _build_id2range self id2range key
self _build_id2range self id2range item
dict cache self id2range
self classes cache self id2range
self classes_to_idx cache self id2range
self samples cache self id2range
self id2range cache self id2range
pickle load fr cache self id2range
cache| self id2range label append (sample|idx)
cache| self id2range key
cache| self id2range item
list self id2range keys self classes sort
[dfordinos listdir dir_1ifos path isdir os path join dir_1|d] classes sort
defaultdict list id2range label append (sample|idx)
defaultdict list id2range key
defaultdict list id2range item
defaultdict list ret_range key append item
enumerate sample label
Image open f img convert
[F ToType np int32] lbl_transforms
F2 Compose lbl_transforms transform_label
F RandomHorizontalFlip
F ToTensor
F2 Compose transforms transform
os path join cache_path
print cache_path
os path exists os path dirname cache_path
os makedirs os path dirname cache_path
CustomDataset args data_dir|cache_path|args is_distributed dataset
args logger info  format dataset __len__
de GeneratorDataset dataset||sampler de_dataset
args logger info  format de_dataset get_dataset_size
de_dataset project columns de_dataset
de_dataset batch args per_batch_size|drop_remainder de_dataset
math ceil len dataset|1 0|args world_size|args per_batch_size num_iter_per_npu
len dataset classes num_classes
de GeneratorDataset dataset||sampler de_dataset project columns de_dataset
de GeneratorDataset dataset||sampler de_dataset batch args per_batch_size|drop_remainder de_dataset
super CustomMatMul|self __init__
P MatMul transpose_a self fc
self fc x1|x2 out
nn Dense input_channels|out_channels
super ProgressMonitor|self __init__
reid_args self reid_args
reid_args steps_per_epoch self _dataset_size
run_context self run_context_
self reid_args logger info
run_context original_args cb_params
time time self step_start_time
time time-self step_start_time time_used
self reid_args lrs cb_params cur_step_num cur_lr
self reid_args per_batch_size|self reid_args log_interval|self reid_args world_size|time_used fps_mean
super HFLogger|self __init__ logger_name
logging StreamHandler sys stdout console
console setLevel logging INFO
logging Formatter formatter
console setFormatter formatter
self addHandler console
local_rank self local_rank
os path exists log_dir
datetime now strftime| format local_rank log_name
os path join log_dir|log_name log_fn
logging FileHandler log_fn fh
fh setLevel logging INFO
fh setFormatter formatter
self addHandler fh
fh close
self isEnabledFor logging INFO
self _log logging INFO|msg|args|kwargs
HFLogger logger_name_1|rank logger
logger setup_logging_file path|rank
name self name
fmt self fmt
self reset
tb_writer self tb_writer
val self val
val|n self sum
n self count
self sum|self count self avg
self tb_writer add_scalar self name|self val|self cur_step
 format self avg
logging StreamHandler sys stdout console setLevel logging INFO
logging StreamHandler sys stdout console setFormatter formatter
logging FileHandler log_fn fh setLevel logging INFO
logging FileHandler log_fn fh setFormatter formatter
logging FileHandler log_fn fh close
self addHandler fh close
self _log logging  format self avg
HFLogger logger_name_1|rank logger setup_logging_file path|rank
logger setup_logging_file  format self avg
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|(current_step|1) learning_rate
args lrargs lr_scale base_lr
int args max_epochargs steps_per_epoch total_steps
int args warmup_epochsargs steps_per_epoch warmup_steps
args lr_epochs milestones
milestones milestone
milestoneargs steps_per_epoch milestones_step
milestones_steps append milestones_step
base_lr lr
Counter milestones_steps milestones_steps_counter
range i
linear_warmup_learning_rate lr
lr|gammamilestones_steps_counter[i] lr
lrs append lr
nlist nlist_item
warmup_step_list args|gamma lrs
lrs lr
args lrargs lr_scale base_lr lr
args lr_epochs milestones milestone
base_lr lr lr
linear_warmup_learning_rate lr lr
lr|gammamilestones_steps_counter[i] lr lr
warmup_step_list args|gamma lrs lr
math sqrt
isinstance param|boolandisinstance param|intorisinstance param|float
param negative_slope
ValueError  format param
math sqrt 2 0|(1|negative_slope2)
ValueError  format nonlinearity
mode lower mode
ValueError  format mode|valid_modes
_calculate_fan_in_and_fan_out array fan_out
mathcal{U}(-\text{bound}|\text{bound})
 text{bound}
_calculate_correct_fan arr|mode fan
calculate_gain nonlinearity|a gain
gain|math sqrt fan std
math sqrt|std bound
np random uniform -bound|bound|arr shape
mathcal{N}(0|\text{std}^2)
 text{std}
np random normal 0|std|arr shape
len arr shape dimensions
arr shape num_input_fmaps
arr shape num_output_fmaps
arr size receptive_field_size
num_input_fmaps|receptive_field_size fan_in
num_output_fmaps|receptive_field_size fan_out
mathcal{U}(-a|a)
 a
_calculate_fan_in_and_fan_out arr fan_out
gain|math sqrt(2 0|float(fan_in|fan_out)) std
math sqrt|std a
np random uniform -a|a|arr shape
super ReidXavierUniform|self __init__
gain self gain
xavier_uniform_ arr|self gain tmp
_assignment arr|tmp
super ReidKaimingUniform|self __init__
a self a
mode self mode
nonlinearity self nonlinearity
kaiming_uniform_ arr|self a|self mode|self nonlinearity tmp
super ReidKaimingNormal|self __init__
kaiming_normal_ arr|self a|self mode|self nonlinearity tmp
isinstance param|boolandisinstance param|intorisinstance param negative_slope
isinstance param|boolandisinstance param|intorisinstance  text{bound}
isinstance param|boolandisinstance param|intorisinstance  text{std}
isinstance param|boolandisinstance param|intorisinstance  a
math sqrt 2  text{bound}
math sqrt 2  text{std}
math sqrt 2  a
ValueError  format nonlinearity self nonlinearity
ValueError  format  text{bound}
ValueError  format  text{std}
ValueError  format  a
ValueError  format mode self mode
calculate_gain nonlinearity|a gain sqrt fan std
calculate_gain nonlinearity|a gain sqrt(2 0|float(fan_in|fan_out)) std
calculate_gain nonlinearity|a gain self gain
arr shape num_input_fmaps fan_in
arr shape num_output_fmaps fan_out
arr size receptive_field_size fan_in
arr size receptive_field_size fan_out
 a self a
math sqrt|std a self a
np random seed
super CombineMarginFC|self __init__
[args num_classes|args emb_size] weight_shape
initializer me_init ReidXavierUniform|weight_shape weight_init
args margin_m self m
args margin_s self s
args margin_a self a
args margin_b self b
Tensor self m|dtype self m_const
Tensor self a|dtype self a_const
Tensor self b|dtype self b_const
Tensor self s|dtype self s_const
Tensor 0|dtype self m_const_zero
Tensor 1|dtype self a_const_one
P OneHot self onehot
P Transpose self transpose
P ACos self acos
P Cos self cos
P Cast self cast
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
self normalize x x
self normalize self weight w
self fc x|w cosine
F shape cosine cosine_shape
self onehot one_hot_float
self cast one_hot_float|mstype float16 one_hot_float
one_hot_float|self b_const one_hot_float
cosine-one_hot_float output
output|self s_const output
self acos cosine theta
self a_const|theta theta
self m_const|theta theta
self cos theta body
body-self b_const body
self cast F scalar_to_array cos_mask
body|one_hot_float|cosine|cos_mask output
CombineMarginFC args
args margin_s self s b_const one_hot_float
args margin_s self s s_const output
P Cos self cos output
self fc x|w cosine output
self onehot one_hot_float b_const one_hot_float
self onehot one_hot_float output
self cast one_hot_float|mstype float16 one_hot_float b_const one_hot_float
self cast one_hot_float|mstype float16 one_hot_float output
one_hot_float|self b_const one_hot_float b_const one_hot_float
one_hot_float|self b_const one_hot_float output
cosine-one_hot_float output s_const output
output|self s_const output s_const output
self cos theta body output
body-self b_const body output
self cast F scalar_to_array cos_mask output
super Sigmoid|self __init__
P Sigmoid self sigmoid
self sigmoid x out
super SEBlock|self __init__
fc_with_initialize channel|channel||reduction self fc1
nn PReLU self act_layer
fc_with_initialize channel||reduction|channel self fc2
P Reshape self reshape
P Shape self shape
P ReduceMean True self reduce_mean
P Cast self cast
self shape x _
self reduce_mean x|(2|3) y
self reshape y|(b|c) y
self fc1 y y
self act_layer y y
self fc2 y y
self sigmoid y y
self cast y|mstype float16 y
self reshape y|(b|c|1|1) y
super IRBlock|self __init__
bn_with_initialize inplanes|use_inference self bn1
Cut self bn1
bn_with_initialize planes|use_inference self bn2
conv3x3 planes|planes|stride self conv2
bn_with_initialize planes|use_inference self bn3
Cut self downsample
downsample self downsample
use_se self use_se
SEBlock planes|act_type self se
TensorAdd self add
x identity
self bn1 x out
self conv1 out out
self bn2 out out
self act_layer out out
self conv2 out out
self bn3 out out
self se out out
self downsample x identity
self cast identity|mstype float16 identity
self cast out|mstype float16 out
self add out|identity out
super DownSample|self __init__
bn_with_initialize planes|expansion|use_inference self bn1
self conv1 x out
self bn1 out out
super MakeLayer|self __init__
inplanes self inplanes
DownSample self downsample
planes self inplanes
range _
nn CellList self layers self layers
self layers block
block x x
super FaceResNet|self __init__
args act_type self act_type
args use_se self use_se
bn_with_initialize 64|use_inference self bn1
MakeLayer self layer1
MakeLayer self layer2
MakeLayer self layer3
MakeLayer self layer4
get_head args self head
np random seed
self cells_and_names _|cell
isinstance cell|nn Conv2d
cell bias set_data initializer cell bias shape
isinstance cell|nn Dense
isinstance cell|(nn BatchNorm2d|nn BatchNorm1d)
isinstance cell|IRBlock
cell bn3 gamma set_data initializer cell bn3 gamma shape
self conv1 x x
self bn1 x x
self prelu x x
self layer1 x x
self layer2 x x
self layer3 x x
self layer4 x x
self head x x
FaceResNet block|layers|args model
[1|1|1|1] units
[2|2|2|2] units
[3|4|6|3] units
[3|4|14|3] units
[3|6|24|3] units
[3|8|30|3] units
[3|13|30|3] units
[3|4|23|3] units
[3|8|36|3] units
[3|24|36|3] units
[3|30|48|8] units
_faceresnet IRBlock|units|args
args backbone backbone_type
int backbone_type layer_num
get_faceresnet layer_num|args
get_backbone_faceres args
Cut self downsample self downsample
self layers block x x
self cells_and_names cell bias set_data initializer cell bias shape
self cells_and_names cell bn3 gamma set_data initializer cell bn3 gamma shape
isinstance cell bn3 gamma set_data initializer cell bn3 gamma shape
_faceresnet args backbone backbone_type
super Head0|self __init__
bn_with_initialize 512|use_inference self bn1
Cut self bn1
Cut self drop
fc_with_initialize 512|7|7|emb_size self fc1
Cut self bn2
P Reshape self reshape
P Shape self shape
self bn1 x x
self drop x x
self shape x _
(b|-1) shp
self reshape x|shp x
self fc1 x x
self bn2 x x
args emb_size emb_size
Head0 emb_size|args
open filename
fr line
Tensor (np array(line strip)) astype(np int32) reshape -1|1 ind
index append ind
get_index index_filename index
rate rate|index index|kwargs resnet50
NotImplementedError f
parser parse_args args_opt
config_ascend config_platform
int os getenv device_id
config_gpu config_platform
NotImplementedError f
net to_float mstype float16
net cells_and_names _|cell
isinstance cell|nn Dense
cell to_float mstype float32
config_platform config
args_opt platform platform
dataset get_dataset_size step_size
f line
Tensor (np array(line strip)) astype(np int32) reshape -1|1 ind
index append ind
resnet50 net
load_checkpoint args_opt checkpoint_path param_dict
load_param_into_net net|param_dict
net set_train False
Model net|loss_fn model
model eval dataset res
parser parse_args args_opt platform platform
config_ascend config_platform config
config_gpu config_platform config
NotImplementedError f line
net cells_and_names cell to_float mstype float32
resnet50 net set_train False
resnet50 net model
load_param_into_net net set_train False
Model net|loss_fn model eval dataset res
 config_ascend
 config_gpu
np random randn |shape astype(np float32)|factor init_value
Tensor init_value
(out_channel|in_channel|3|3) weight_shape
_weight_variable weight_shape weight
(out_channel|in_channel|1|1) weight_shape
(out_channel|in_channel|7|7) weight_shape
nn BatchNorm2d channel
(out_channel|in_channel) weight_shape
super ResidualBlock|self __init__
out_channel||self expansion channel
math ceil channel|rate prune_channel
_bn prune_channel self bn1
_conv3x3 prune_channel|prune_channel|stride self conv2
_bn prune_channel self bn2
_conv1x1 prune_channel|math ceil self conv3
_bn_last math ceil channel|rate|self expansion self bn3
nn ReLU self relu
P TensorAdd self add
P ScatterNd self op
P Transpose self transpose
(out_channel|1|56|56) self shape
index self idx
(out_channel|1|28|28) self shape
(out_channel|1|14|14) self shape
(out_channel|1|7|7) self shape
x identity
self conv1 x out
self bn1 out out
self relu out out
self conv2 out out
self bn2 out out
self conv3 out out
self bn3 out out
self down_sample_layer identity identity
self transpose out|(1|0|2|3) output
self op self idx|output|self shape output
self transpose output|(1|0|2|3) output
self add identity|output output
self relu output output
super ResNet|self __init__
_bn self bn1
P ReLU self relu
P Pad ((0|0)) self pad_op
in_channels in_channel
out_channels out_channel
strides stride
nn Flatten self flatten
_fc out_channels|num_classes self end_point
self _initialize_weights
_make_layer ResidualBlock|3|128|256|2
layers append resnet_block
range _
nn SequentialCell layers
self conv1 x x1
self bn1 x1 x2
self relu x2 x3
self pad_op x3 x4
self maxpool x4 c1
self layer1 c1 c2
self layer2 c2 c3
self layer3 c3 c4
self layer4 c4 c5
self mean c5|(2|3) out
self flatten out out
self end_point out out
self init_parameters_data
self cells_and_names _|m
isinstance m|(nn Conv2d)
m kernel_size|m kernel_size|m out_channels n
isinstance m|nn BatchNorm2d
isinstance m|nn Dense
resnet50 net
resnet101 net
nn BatchNorm2d channel weight_shape
nn BatchNorm2d channel expansion channel
nn BatchNorm2d channel self conv2
nn BatchNorm2d channel self shape
nn BatchNorm2d channel self shape
nn BatchNorm2d channel self shape
nn BatchNorm2d channel self shape
out_channel||self expansion channel expansion channel
out_channel||self expansion channel self conv2
out_channel||self expansion channel self shape
out_channel||self expansion channel self shape
out_channel||self expansion channel self shape
out_channel||self expansion channel self shape
math ceil channel|rate prune_channel self conv2
self cells_and_names m kernel_size|m kernel_size|m out_channels n
dataset_path string
do_train bool
repeat_num int
batch_size int
int os getenv rank_size
int os getenv rank_id
de MindDataset ds
config image_height resize_height
C RandomCropDecodeResize resize_crop_op
C RandomColorAdjust color_op
C Rescale 1|255 0|0 rescale_op
C Normalize normalize_op
C HWC2CHW change_swap_op
P Decode decode_p
P Resize 256|interpolation resize_p
P CenterCrop center_crop_p
P ToTensor totensor
P Normalize (0 485|0 456|0 406) normalize_p
P ComposeOp composeop
composeop trans
C2 TypeCast mstype int32 type_cast_op
ds shuffle buffer_size ds
ds repeat repeat_num ds
repeat_num int os getenv rank_size
repeat_num int os getenv rank_id
batch_size int os getenv rank_size
batch_size int os getenv rank_id
de MindDataset ds shuffle buffer_size ds
de MindDataset ds repeat repeat_num ds
P ComposeOp composeop trans
int os getenv devid
args pretrained ckpt_path
os path isfile ckpt_path
load_checkpoint ckpt_path param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
network set_train False
Tensor input_data tensor_input_data
parser parse_args arg
main arg
load_checkpoint ckpt_path param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
load_param_into_net network set_train False
warnings filterwarnings
int os getenv devid
random seed
np random seed
parser parse_args args
reid_1p_cfg cfg
reid_8p_cfg cfg
args pretrained cfg pretrained
args data_dir cfg data_dir
get_rank cfg local_rank
get_group_size cfg world_size
ParallelMode DATA_PARALLEL parallel_mode
ParallelMode STAND_ALONE parallel_mode
mindspore common set_seed
os path join cfg ckpt_path|datetime datetime now strftime cfg outputs_dir
get_logger cfg outputs_dir|cfg local_rank cfg logger
AverageMeter loss_meter
cfg logger save_args cfg
cfg logger info
get_de_dataset cfg class_num
steps_per_epoch cfg steps_per_epoch
cfg logger info |str cfg steps_per_epoch
de_dataset create_tuple_iterator de_dataloader
cfg logger info |str class_num
(class_num||16|1)|16 class_num
class_num cfg class_num
cfg logger info |str cfg class_num
cfg logger important_info
time time create_network_start
SphereNet num_layers network
CombineMarginFCFp16 embbeding_size head
CrossEntropy criterion
os path isfile cfg pretrained
load_checkpoint cfg pretrained param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
cfg logger info  format cfg pretrained
BuildTrainNetworkWithHead network|head|criterion train_net
TrainOneStepCell train_net|opt|sens train_net
cfg max_epoch|cfg steps_per_epoch||cfg ckpt_interval ckpt_max_num
CheckpointConfig save_checkpoint_steps train_config
_InternalCallbackParam cb_params
train_net cb_params train_network
ckpt_max_num cb_params epoch_num
RunContext cb_params run_context
ckpt_cb begin run_context
train_net set_train
time time t_end
time time t_epoch
-1 old_progress
enumerate i|total_data
total_data gt
Tensor data data
Tensor gt gt
train_net data|gt loss
loss_meter update loss asnumpy
i|1 cb_params cur_step_num
i|2 cb_params batch_num
ckpt_cb step_end run_context
time time-create_network_start time_for_graph_compile
time time-t_end time_used
int i|cfg steps_per_epoch epoch
cfg per_batch_size|(i-old_progress)|cfg world_size|time_used fps
loss_meter reset
i old_progress
time time-t_epoch epoch_time_used
cfg per_batch_size|cfg world_size|cfg steps_per_epoch|epoch_time_used fps
cfg logger info  format epoch|i|fps
parser parse_args args pretrained cfg pretrained
parser parse_args args data_dir cfg data_dir
reid_1p_cfg cfg logger save_args cfg
reid_1p_cfg cfg logger info
reid_1p_cfg cfg logger info |str cfg steps_per_epoch
reid_1p_cfg cfg logger info |str class_num
reid_1p_cfg cfg logger info |str cfg class_num
reid_1p_cfg cfg logger important_info
reid_1p_cfg cfg logger info  format cfg pretrained
reid_1p_cfg cfg max_epoch|cfg steps_per_epoch||cfg ckpt_interval ckpt_max_num
reid_1p_cfg cfg per_batch_size|(i-old_progress)|cfg world_size|time_used fps
reid_1p_cfg cfg per_batch_size|cfg world_size|cfg steps_per_epoch|epoch_time_used fps
reid_1p_cfg cfg logger info  format epoch|i|fps
reid_8p_cfg cfg logger save_args cfg
reid_8p_cfg cfg logger info
reid_8p_cfg cfg logger info |str cfg steps_per_epoch
reid_8p_cfg cfg logger info |str class_num
reid_8p_cfg cfg logger info |str cfg class_num
reid_8p_cfg cfg logger important_info
reid_8p_cfg cfg logger info  format cfg pretrained
reid_8p_cfg cfg max_epoch|cfg steps_per_epoch||cfg ckpt_interval ckpt_max_num
reid_8p_cfg cfg per_batch_size|(i-old_progress)|cfg world_size|time_used fps
reid_8p_cfg cfg per_batch_size|cfg world_size|cfg steps_per_epoch|epoch_time_used fps
reid_8p_cfg cfg logger info  format epoch|i|fps
AverageMeter loss_meter update loss asnumpy
AverageMeter loss_meter reset
get_de_dataset cfg class_num class_num
get_de_dataset cfg class_num cfg class_num
cfg logger info |str class_num class_num
cfg logger info |str class_num cfg class_num
(class_num||16|1)|16 class_num class_num
(class_num||16|1)|16 class_num cfg class_num
load_checkpoint cfg pretrained param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
BuildTrainNetworkWithHead network|head|criterion train_net train_net
BuildTrainNetworkWithHead network|head|criterion train_net cb_params train_network
BuildTrainNetworkWithHead network|head|criterion train_net set_train
BuildTrainNetworkWithHead network|head|criterion train_net data|gt loss
TrainOneStepCell train_net|opt|sens train_net train_net
TrainOneStepCell train_net|opt|sens train_net cb_params train_network
TrainOneStepCell train_net|opt|sens train_net set_train
TrainOneStepCell train_net|opt|sens train_net data|gt loss
cfg max_epoch|cfg steps_per_epoch||cfg ckpt_interval ckpt_max_num cb_params epoch_num
enumerate total_data gt
enumerate i old_progress
warnings filterwarnings
int os getenv devid
ims_info name|_|fea
re split name
obj_feas[re split name] append fea
tqdm _|feas
np array feas feas
np dot feas|np transpose feas tolist likehood_mat
likehood_mat row
row likehoods
feas tolist fea
np array likehoods likehoods
tqdm name1|_|fea1
re split _
np array fea1 fea1
ims_info name2|_|fea2
np array fea2 fea2
likehoods append np sum fea1|fea2
likehoods append np sum -(fea1-fea2)2
[0 5|0 3|0 1|0 01|0 001|0 0001|0 00001] test_point
test_point point
btlikehoods[int btlikehoods size|point] thre
np sum inlikehoods n_ta
tar_far append  point|float n_ta|inlikehoods size|thre
V Resize (96|64) resize
 transform
V ToTensor
enumerate i|_
Image open paths i im
resize im im
np array im img
transform img ts
ll append ts
ll clear
args pretrained model_path
model_path replace result_file
os path exists result_file
os remove result_file
open result_file|
result_fw write(model_path|)
os path isfile model_path
load_checkpoint model_path param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
network set_train False
args eval_dir root_path
os listdir root_path root_file_list
root_file_list sub_path
os listdir im_path
ims_info append  im_path split|os path join root_path|sub_path|im_path
[pathforname|pathinims_info] paths
[nameforname|pathinims_info] names
load_images batch
batch astype np float32 batch
Tensor batch batch
network batch fea
l_t append fea asnumpy astype np float16
list zip names|paths|feas tolist ims_info
inclass_likehood ims_info inlikehoods
1] sort
btclass_likehood ims_info btlikehoods
tar_at_far inlikehoods|btlikehoods tar_far
tar_far far|tar|thre
print  format far|tar|thre
result_fw write  format far|tar|thre
parser parse_args arg
print arg
main arg
ims_info  transform
re split name paths
re split name names
tqdm feas tolist fea
tqdm  transform
np array feas feas tolist fea
np dot feas|np transpose feas tolist likehood_mat row
likehood_mat row likehoods
row likehoods append np sum fea1|fea2
row likehoods append np sum -(fea1-fea2)2
np array likehoods likehoods append np sum fea1|fea2
np array likehoods likehoods append np sum -(fea1-fea2)2
tqdm  transform
ims_info  transform
likehoods append np sum  transform
[0 5|0 3|0 1|0 01|0 001|0 0001|0 00001] test_point point
tar_far append  point|float n_ta|inlikehoods  transform
V Resize (96|64) resize im im
 transform img ts
args pretrained model_path replace result_file
load_checkpoint model_path param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
load_param_into_net network set_train False
load_param_into_net network batch fea
os listdir root_path root_file_list sub_path
load_images batch astype np float32 batch
tar_at_far inlikehoods|btlikehoods tar_far far|tar|thre
Dense input_channels|out_channels
super BaseBlock|self __init__
bn_with_initialize channels self bn1
P ReLU self relu1
bn_with_initialize channels self bn2
P ReLU self relu2
P Cast self cast
TensorAdd self add
x identity
self conv1 x out
self bn1 out out
self relu1 out out
self conv2 out out
self bn2 out out
self relu2 out out
self cast identity|mstype float16 identity
self cast out|mstype float16 out
self add out|identity out
super MakeLayer|self __init__
bn_with_initialize planes self bn
P ReLU self relu
range _
self layers append block planes
nn CellList self layers self layers
self conv x x
self bn x x
self relu x x
self layers block
block x x
super SphereNet|self __init__
[1|1|1|1] layers
[3|16|32|64|128] filter_list
[1|2|4|1] layers
[3|64|128|256|512] filter_list
[2|4|4|2] layers
[3|32|64|128|256] filter_list
[3|7|16|3] layers
ValueError |str num_layers|
P Shape self shape
P Reshape self reshape
shape self arg_shape
BaseBlock block
fc_with_initialize fc_size|feature_dim self fc
self cells_and_names _|cell
isinstance cell|(nn Conv2d|nn Dense)
cell bias set_data initializer cell bias shape
cell weight set_data initializer me_init ReidXavierUniform|cell weight shape
self layer1 x x
self layer2 x x
self layer3 x x
self layer4 x x
self shape x _
self reshape x|(b|-1) x
self fc x x
self last_bn x x
self cast x|mstype float16 x
self l2norm x x
self cast x|mstype float32 x
super CombineMarginFC|self __init__
[classnum|embbeding_size] weight_shape
initializer me_init ReidXavierUniform|weight_shape weight_init
m self m
s self s
a self a
b self b
Tensor self m|dtype self m_const
Tensor self a|dtype self a_const
Tensor self b|dtype self b_const
Tensor self s|dtype self s_const
Tensor 0 0|dtype self m_const_zero
Tensor 1 0|dtype self a_const_one
P OneHot self onehot
P Transpose self transpose
P ACos self acos
P Cos self cos
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
self normalize self weight w
self fc self cast x|mstype float16 cosine
self cast cosine|mstype float32 cosine
F shape cosine cosine_shape
self onehot one_hot_float
self acos cosine theta
self a_const|theta theta
self m_const|theta theta
self cos theta body
body-self b_const body
F scalar_to_array-one_hot_float cos_mask
body|one_hot_float|cosine|cos_mask output
output|self s_const output
super CombineMarginFCFp16|self __init__
Tensor 0|dtype self m_const_zero
Tensor 1|dtype self a_const_one
self fc x|w cosine
self cast one_hot_float|mstype float16 one_hot_float
self cast F scalar_to_array|mstype float16-one_hot_float cos_mask
super BuildTrainNetwork|self __init__
network self network
criterion self criterion
self network input_data output
self criterion output|label loss
super BuildTrainNetworkWithHead|self __init__
model self model
head self head
self model input_data embeddings
self head embeddings|labels _
self criterion thetas|labels loss
Dense s self s
self layers block x x
ValueError |str s self s
P Shape self shape self arg_shape
self cells_and_names cell bias set_data initializer cell bias shape
self cells_and_names cell weight set_data initializer me_init ReidXavierUniform|cell weight shape
P Cos self cos output
self fc self cast x|mstype float16 cosine output
self cast cosine|mstype float32 cosine output
self onehot one_hot_float output
self cos theta body output
body-self b_const body output
F scalar_to_array-one_hot_float cos_mask output
body|one_hot_float|cosine|cos_mask output s_const output
output|self s_const output s_const output
 reid_1p_cfg
 reid_8p_cfg
Dense input_channels|out_channels
super BaseBlock|self __init__
bn_with_initialize channels self bn1
P ReLU self relu1
bn_with_initialize channels self bn2
P ReLU self relu2
P Cast self cast
TensorAdd self add
x identity
self conv1 x out
self bn1 out out
self relu1 out out
self conv2 out out
self bn2 out out
self relu2 out out
self cast identity|mstype float16 identity
self cast out|mstype float16 out
self add out|identity out
super MakeLayer|self __init__
bn_with_initialize planes self bn
P ReLU self relu
range _
self layers append block planes
nn CellList self layers self layers
self conv x x
self bn x x
self relu x x
self layers block
block x x
super SphereNet|self __init__
[1|1|1|1] layers
[3|16|32|64|128] filter_list
[1|2|4|1] layers
[3|64|128|256|512] filter_list
[2|4|4|2] layers
[3|32|64|128|256] filter_list
[3|7|16|3] layers
ValueError |str num_layers|
P Shape self shape
P Reshape self reshape
shape self arg_shape
BaseBlock block
fc_with_initialize fc_size|feature_dim self fc
self cells_and_names _|cell
isinstance cell|(nn Conv2d|nn Dense)
cell bias set_data initializer cell bias shape
cell weight set_data initializer me_init ReidXavierUniform|cell weight shape
self layer1 x x
self layer2 x x
self layer3 x x
self layer4 x x
self shape x _
self reshape x|(b|-1) x
self fc x x
self last_bn x x
self cast x|mstype float16 x
self l2norm x x
super CombineMarginFC|self __init__
[classnum|embbeding_size] weight_shape
initializer me_init ReidXavierUniform|weight_shape weight_init
m self m
s self s
a self a
b self b
Tensor self m|dtype self m_const
Tensor self a|dtype self a_const
Tensor self b|dtype self b_const
Tensor self s|dtype self s_const
Tensor 0 0|dtype self m_const_zero
Tensor 1 0|dtype self a_const_one
P OneHot self onehot
P Transpose self transpose
P ACos self acos
P Cos self cos
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
self normalize self weight w
self fc self cast x|mstype float16 cosine
self cast cosine|mstype float32 cosine
F shape cosine cosine_shape
self onehot one_hot_float
self acos cosine theta
self a_const|theta theta
self m_const|theta theta
self cos theta body
body-self b_const body
F scalar_to_array-one_hot_float cos_mask
body|one_hot_float|cosine|cos_mask output
output|self s_const output
super CombineMarginFCFp16|self __init__
Tensor 0|dtype self m_const_zero
Tensor 1|dtype self a_const_one
self fc x|w cosine
self cast one_hot_float|mstype float16 one_hot_float
self cast F scalar_to_array|mstype float16-one_hot_float cos_mask
super BuildTrainNetwork|self __init__
network self network
criterion self criterion
self network input_data output
self criterion output|label loss
super BuildTrainNetworkWithHead|self __init__
model self model
head self head
self model input_data embeddings
self head embeddings|labels _
self criterion thetas|labels loss
Dense s self s
self layers block x x
ValueError |str s self s
P Shape self shape self arg_shape
self cells_and_names cell bias set_data initializer cell bias shape
self cells_and_names cell weight set_data initializer me_init ReidXavierUniform|cell weight shape
P Cos self cos output
self fc self cast x|mstype float16 cosine output
self cast cosine|mstype float32 cosine output
self onehot one_hot_float output
self cos theta body output
body-self b_const body output
F scalar_to_array-one_hot_float cos_mask output
body|one_hot_float|cosine|cos_mask output s_const output
output|self s_const output s_const output
super LOGGER|self __init__ logger_name
logging StreamHandler sys stdout console
console setLevel logging INFO
logging Formatter formatter
console setFormatter formatter
self addHandler console
local_rank self local_rank
os path exists log_dir
datetime now strftime log_name
os path join log_dir|log_name self log_fn
logging FileHandler self log_fn fh
fh setLevel logging INFO
fh setFormatter formatter
self addHandler fh
self _log logging INFO|msg|args|kwargs
self info
vars args args_dict
args_dict keys key
self info key|args_dict[key]
|line_width important_msg
|2 important_msg
self info important_msg|args|kwargs
LOGGER logger_name_1 logger
logger setup_logging_file path|rank
name self name
fmt self fmt
self reset
tb_writer self tb_writer
val self val
val|n self sum
n self count
self sum|self count self avg
self tb_writer add_scalar self name|self val|self cur_step
fmtstr format self __dict__
logging StreamHandler sys stdout console setLevel logging INFO
logging StreamHandler sys stdout console setFormatter formatter
logging FileHandler self log_fn fh setLevel logging INFO
logging FileHandler self log_fn fh setFormatter formatter
vars args args_dict keys key
LOGGER logger_name_1 logger setup_logging_file path|rank
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step learning_rate
args lr base_lr
int args max_epochargs steps_per_epoch total_steps
int args warmup_epochsargs steps_per_epoch warmup_steps
args lr_epochs milestones
milestones milestone
milestoneargs steps_per_epoch milestones_step
milestones_steps append milestones_step
base_lr lr
Counter milestones_steps milestones_steps_counter
range i
linear_warmup_learning_rate i|warmup_steps|base_lr|warmup_init_lr lr
lr|gammamilestones_steps_counter[i] lr
float init_lr|lr_inc|current_step lr
lr base_lr
int max_epoch|steps_per_epoch total_steps
int warmup_epochs|steps_per_epoch warmup_steps
lr_epochs milestones
milestone|steps_per_epoch milestones_step
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr
lr_each_step append lr
np array lr_each_step astype np float32
lr_epochs append i
args lr base_lr lr
args lr_epochs milestones milestone
milestones milestone milestones_step
base_lr lr lr
base_lr lr base_lr
linear_warmup_learning_rate i|warmup_steps|base_lr|warmup_init_lr lr lr
linear_warmup_learning_rate i|warmup_steps|base_lr|warmup_init_lr lr base_lr
lr|gammamilestones_steps_counter[i] lr lr
lr|gammamilestones_steps_counter[i] lr base_lr
float init_lr|lr_inc|current_step lr base_lr
sys path append
warnings filterwarnings
[C TypeCast mstype int32] transform_label
VC Resize (96|64)
VC RandomHorizontalFlip
VC Normalize (127 5|127 5|127 5)|(127 5|127 5|127 5)
de_dataset project columns de_dataset
de_dataset get_dataset_size num_iter_per_gpu
de_dataset repeat args max_epoch de_dataset
de_dataset num_classes num_classes
super CrossEntropyNew|self __init__
P OneHot self onehot
Tensor 1 0-smooth_factor|mstype float32 self on_value
Tensor 1 0|smooth_factor|(num_classes-1) self off_value
P Cast self cast
nn SoftmaxCrossEntropyWithLogits self ce
P ReduceMean False self mean
self ce logit|one_hot_label loss
self mean loss|0 loss
super CrossEntropy|self __init__
P Exp self exp
P ReduceSum self sum
P Reshape self reshape
P Log self log
Tensor eps|dtype self eps_const
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
self exp logit exp
self sum exp|-1 exp_sum
self reshape exp_sum|(F shape exp_sum) exp_sum
exp|exp_sum softmax_result
self onehot one_hot_label
self sum (self log(softmax_result|self eps_const)|self cast) loss
F shape logit batch_size
self cast batch_size_tensor
self sum loss|-1|batch_size_tensor loss
super CrossEntropyWithIgnoreIndex|self __init__
P Greater self greater
P Maximum self maximum
P Fill self fill
P DType self dtype
P ReLU self relu
self reshape label|(F shape label) mask
self cast mask|mstype float32 mask
mask|F scalar_to_array mask
self relu mask|(mask) mask
x|mask x
self onehot self cast label|mstype int32 one_hot_label
self ce x|one_hot_label loss
self sum loss|0 loss
super CEWithIgnoreIndex3D|self __init__
P OnesLike self ones
logit|mask logit
self log exp|exp_sum|self eps_const softmax_result
self sum loss|-1 loss
P Exp self exp softmax_result
self exp logit exp softmax_result
self sum exp|-1 exp_sum softmax_result
self reshape exp_sum|(F shape exp_sum) exp_sum softmax_result
self reshape label|(F shape label) mask scalar_to_array mask
self reshape label|(F shape label) mask x
self reshape label|(F shape label) mask logit
self cast mask|mstype float32 mask scalar_to_array mask
self cast mask|mstype float32 mask x
self cast mask|mstype float32 mask logit
mask|F scalar_to_array mask scalar_to_array mask
mask|F scalar_to_array mask x
mask|F scalar_to_array mask logit
self relu mask|(mask) mask x
self relu mask|(mask) mask logit
x|mask x x
logit|mask logit logit
math sqrt a
isinstance param|boolandisinstance param|intorisinstance param|float
param negative_slope
ValueError  format param
math sqrt 2 0|(1|negative_slope2) a
ValueError  format nonlinearity
mode lower mode
ValueError  format mode|valid_modes
_calculate_fan_in_and_fan_out array fan_out
mathcal{U}(-\text{bound}|\text{bound})
 text{bound}
torch empty 3|5 w
_calculate_correct_fan arr|mode fan
calculate_gain nonlinearity|a gain
gain|math sqrt fan std
math sqrt|std bound
np random uniform -bound|bound|arr shape
mathcal{N}(0|\text{std}^2)
 text{std}
np random normal 0|std|arr shape
len arr shape dimensions
arr shape num_input_fmaps
arr shape num_output_fmaps
arr size receptive_field_size
num_input_fmaps|receptive_field_size fan_in
num_output_fmaps|receptive_field_size fan_out
mathcal{U}(-a|a)
 a
nn init calculate_gain gain
_calculate_fan_in_and_fan_out arr fan_out
gain|math sqrt(2 0|float(fan_in|fan_out)) std
math sqrt|std a
np random uniform -a|a|arr shape
super ReidXavierUniform|self __init__
gain self gain
xavier_uniform_ arr|self gain tmp
assignment arr|tmp
super ReidKaimingUniform|self __init__
a self a
mode self mode
nonlinearity self nonlinearity
kaiming_uniform_ arr|self a|self mode|self nonlinearity tmp
super ReidKaimingNormal|self __init__
kaiming_normal_ arr|self a|self mode|self nonlinearity tmp
math sqrt a
math sqrt a self a
isinstance param|boolandisinstance param|intorisinstance param negative_slope
isinstance param|boolandisinstance param|intorisinstance  text{bound}
isinstance param|boolandisinstance param|intorisinstance  text{std}
isinstance param|boolandisinstance param|intorisinstance  a
math sqrt 2 0|(1|negative_slope2) a
math sqrt 2 0|(1|negative_slope2) a self a
ValueError  format nonlinearity self nonlinearity
ValueError  format  text{bound}
ValueError  format  text{std}
ValueError  format  a
ValueError  format mode self mode
calculate_gain nonlinearity|a gain sqrt fan std
calculate_gain nonlinearity|a gain sqrt(2 0|float(fan_in|fan_out)) std
calculate_gain nonlinearity|a gain self gain
arr shape num_input_fmaps fan_in
arr shape num_output_fmaps fan_out
arr size receptive_field_size fan_in
arr size receptive_field_size fan_out
 a self a
nn init calculate_gain gain sqrt(2 0|float(fan_in|fan_out)) std
nn init calculate_gain gain self gain
math sqrt|std a self a
parser parse_args args
print sys argv
context set_context context GRAPH_MODE mode
int os getenv devid
devid device_id
context reset_auto_parallel_context
get_rank args rank_id
get_group_size args rank_size
args model split sub_name
args num_classes num_classes
args drop drop_rate
args drop_connect drop_connect_rate
args bn_tf bn_tf
args bn_momentum bn_momentum
print count_params net
net default_cfg input_size
os path join args data_path train_data_url
os path join args data_path val_data_url
args workers workers
args distributed distributed
train_dataset get_dataset_size batches_per_epoch
LabelSmoothingCrossEntropy loss
TimeMonitor data_size time_cb
FixedLossScaleManager loss_scale_manager
args epochs total_epochs
batches_per_epoch steps_per_epoch
args decay_epochs decay_epochs
args decay_rate decay_rate
args warmup_epochs warmup_epochs
args warmup_lr warmup_lr_init
Tensor lr_array lr
args per_print_times per_print_times
add_weight_decay net|weight_decay param_group
lr learning_rate
args momentum momentum
args weight_decay weight_decay
args opt_eps epsilon
load_checkpoint args ckpt ckpt
load_param_into_net net|ckpt
net set_train False
copy deepcopy net net_ema
net_ema set_train False
net_ema ema_network
loss loss_fn
val_dataset eval_dataset
args ema_decay decay
args ckpt_save_epoch save_epoch
args dataset_sink dataset_sink_mode
[loss_cb|ema_cb|time_cb]ifis_masterelse callbacks
parser parse_args args model split sub_name
parser parse_args args num_classes num_classes
parser parse_args args drop drop_rate
parser parse_args args drop_connect drop_connect_rate
parser parse_args args bn_tf bn_tf
parser parse_args args bn_momentum bn_momentum
parser parse_args args workers workers
parser parse_args args distributed distributed
parser parse_args args epochs total_epochs
parser parse_args args decay_epochs decay_epochs
parser parse_args args decay_rate decay_rate
parser parse_args args warmup_epochs warmup_epochs
parser parse_args args warmup_lr warmup_lr_init
parser parse_args args per_print_times per_print_times
parser parse_args args momentum momentum
parser parse_args args weight_decay weight_decay
parser parse_args args opt_eps epsilon
parser parse_args args ema_decay decay
parser parse_args args ckpt_save_epoch save_epoch
parser parse_args args dataset_sink dataset_sink_mode
int os getenv devid device_id
print count_params net default_cfg input_size
print count_params net param_group
print count_params net set_train False
train_dataset get_dataset_size batches_per_epoch steps_per_epoch
LabelSmoothingCrossEntropy loss loss_fn
TimeMonitor data_size time_cb callbacks
Tensor lr_array lr learning_rate
load_param_into_net net set_train False
copy deepcopy net net_ema set_train False
copy deepcopy net net_ema ema_network
parser parse_args args
print sys argv
context set_context context GRAPH_MODE mode
args model split sub_name
args num_classes num_classes
print count_params net
net default_cfg input_size
os path join args data_path val_data_url
args workers workers
load_checkpoint args ckpt ckpt
load_param_into_net net|ckpt
net set_train False
Model net|loss|metrics model
print metrics
parser parse_args args model split sub_name
parser parse_args args num_classes num_classes
parser parse_args args workers workers
print count_params net default_cfg input_size
print count_params net set_train False
print count_params net model
load_param_into_net net set_train False
net parameters_and_names _|param
array_dict param name new_param
param_not_load append param name
network self network
ema_network self ema_network
eval_dataset self eval_dataset
loss_fn self loss_fn
decay self decay
save_epoch self save_epoch
start_epoch self _start_epoch
dataset_sink_mode self dataset_sink_mode
self network parameters_and_names _|param
deepcopy param data asnumpy self shadow param name
(1 0-self decay)|param data asnumpy copy| new_average
new_average self shadow param name
run_context original_args cb_params
cb_params cur_epoch_num|self _start_epoch-1 cur_epoch
load_nparray_into_net self ema_network|self shadow
Model self network|loss_fn model
model eval acc
model_ema eval ema_acc
print acc
print ema_acc
ema_acc self ema_accuracy cur_epoch
ema_acc self best_ema_accuracy
cur_epoch self best_ema_epoch
save_checkpoint output|
acc self best_accuracy
cur_epoch self best_epoch
save_checkpoint output|ckpt
save_checkpoint cb_params train_network|
super LossMonitor|self __init__
isinstance per_print_times|int
per_print_times self _per_print_times
lr_array self _lr_array
total_epochs self _total_epochs
cb_params net_outputs loss
cb_params cur_epoch_num|self _start_epoch-1 cur_epoch_num
isinstance loss|(tuple|list)
isinstance loss|Tensorandisinstance loss asnumpy|np ndarray
np mean loss asnumpy loss
cb_params cur_step_num-1 global_step
global_step%cb_params batch_num|1 cur_step_in_epoch
isinstance loss|floatand np isnan lossornp isinf loss
(1 0-self decay)|param data asnumpy copy| new_average self shadow param name
run_context original_args cb_params cur_epoch_num|self _start_epoch-1 cur_epoch
run_context original_args cb_params net_outputs loss
run_context original_args cb_params cur_epoch_num|self _start_epoch-1 cur_epoch_num
run_context original_args cb_params cur_step_num-1 global_step
cb_params cur_epoch_num|self _start_epoch-1 cur_epoch self best_ema_epoch
cb_params cur_epoch_num|self _start_epoch-1 cur_epoch self best_epoch
Model self network|loss_fn model eval acc
model eval acc self best_accuracy
model_ema eval ema_acc self ema_accuracy cur_epoch
model_ema eval ema_acc self best_ema_accuracy
print acc self best_accuracy
print ema_acc self ema_accuracy cur_epoch
print ema_acc self best_ema_accuracy
ema_acc self ema_accuracy cur_epoch self best_ema_epoch
ema_acc self ema_accuracy cur_epoch self best_epoch
isinstance per_print_times self _per_print_times
(0 485|0 456|0 406) IMAGENET_DEFAULT_MEAN
(0 229|0 224|0 225) IMAGENET_DEFAULT_STD
(0 08|1 0) SCALE
(3 |4 |4 |3 ) RATIO
ds config set_seed
enumerate i|image
ret_imgs append image
ret_labels append labels i
np array ret_imgs|np array ret_labels
os path exists train_data_url
py_vision Decode decode_op
c_transforms TypeCast mstype int32 type_cast_op
SCALE|ratio scale
py_vision RandomHorizontalFlip random_horizontal_flip_op
(max(0|1-color_jitter)) adjust_range
adjust_range contrast
py_vision ToTensor to_tensor
py_vision Normalize normalize_op
workers num_parallel_workers
rank_size num_shards
image_ops operations
type_cast_op operations
split_imgs_and_labels per_batch_map
ds_train repeat ds_train
os path exists val_data_url
isinstance input_size|tuple
int math floor input_size|DEFAULT_CROP_PCT scale_size
tuple [int x|DEFAULT_CROP_PCTforxininput_size] scale_size
py_vision Resize size resize_op
py_vision CenterCrop size center_crop
dataset repeat dataset
(0 08|1 0) SCALE scale
c_transforms TypeCast mstype int32 type_cast_op operations
(max(0|1-color_jitter)) adjust_range contrast
isinstance tuple [int x|DEFAULT_CROP_PCTforxininput_size] scale_size
super LabelSmoothingCrossEntropy|self __init__
P OneHot self onehot
Tensor 1 0-smooth_factor|mstype float32 self on_value
nn SoftmaxCrossEntropyWithLogits self ce
P ReduceMean False self mean
P Cast self cast
self cast label|mstype int32 label
self onehot label|F shape one_hot_label
self ce logits|one_hot_label loss_logit
self mean loss_logit|0 loss_logit
value lowerin
argparse ArgumentTypeError
steps_per_epoch|total_epochs total_steps
steps_per_epoch|global_epoch global_steps
range i
math floor i|steps_per_epoch epochs
warmup_lr_init|epochs|self_warmup_delta warmup_lr
math floor epochs|decay_epochs decay_nums
math pow self_decay_rate|decay_nums decay_rate
base_lr|decay_rate decay_lr
cond|warmup_lr|(1-cond)|decay_lr lr
lr_each_step append lr
np array lr_each_step astype np float32 lr_each_step
net trainable_params param
param name endswith
no_decay append param
decay append param
np prod param shape total_params
math floor i|steps_per_epoch epochs warmup_lr
warmup_lr_init|epochs|self_warmup_delta warmup_lr lr
math pow self_decay_rate|decay_nums decay_rate decay_lr
base_lr|decay_rate decay_lr lr
cond|warmup_lr|(1-cond)|decay_lr lr lr
net trainable_params param name endswith
(0 485|0 456|0 406) IMAGENET_DEFAULT_MEAN
(0 229|0 224|0 225) IMAGENET_DEFAULT_STD
P ReLU relu
P Sigmoid sigmoid
dict momentum _BN_ARGS_PT
dict momentum _BN_ARGS_TF
decay append param
isinstance shape|(tuple|list)
shape|shape|shape n
Normal math sqrt 2 0|n
shape n
Uniform init_range
_initialize_weight_goog weight_init_value
padding|pad_mode padding
kwargs pop None bn_momentum
bn_momentum bn_args
kwargs pop None bn_eps
bn_eps bn_args
max new_channels
int channels|divisor|2
divisor new_channels
ss isdigit
int ss
ss split k
isinstance block_str|str
block_str split ops
ops block_type
ops op
op startswith
op key
op v
value options key
re split op splits
splits value
int options num_repeat
dict block_args
_parse_ksize options dw_kernel_size
int options out_chs
float options exp_ratio
int options stride
_parse_ksize options exp_kernel_size
int options kernel_size
eachstage  othermodelsthatmayhavemultipleblockargdefinitions
sum repeats num_repeat
max 1|round(num_repeat|depth_multiplier) num_repeat_scaled
int math ceil num_repeat|depth_multiplier num_repeat_scaled
repeats r
max 1|round((r|num_repeat|num_repeat_scaled)) rs
repeats_scaled append rs
zip ba|rep
range] _
enumerate _|block_strings
isinstance block_strings|list
block_strings block_str
_decode_block_str block_str rep
stack_args append ba
repeats append rep
super Swish|self __init__
P Sigmoid self sigmoid
self sigmoid x
nn Sigmoid x
super BlockBuilder|self __init__
channel_multiplier self channel_multiplier
channel_divisor self channel_divisor
channel_min self channel_min
pad_type self pad_type
Swish self act_fn
se_gate_fn self se_gate_fn
se_reduce_mid self se_reduce_mid
bn_args self bn_args
drop_connect_rate self drop_connect_rate
verbose self verbose
self _make_layer builder_in_channels|builder_block_args self layer
_round_channels chs|self channel_multiplier|self channel_divisor|self channel_min
ba pop bt
self in_chs ba
self bn_args ba
self pad_type ba
self drop_connect_rate| ba
self se_gate_fn ba
self se_reduce_mid ba
InvertedResidual ba block
DepthwiseSeparableConv ba block
ba self in_chs
enumerate i|ba
self _make_block ba block
blocks append block
nn SequentialCell blocks
configuration s
in_chs self in_chs
enumerate _|stack
isinstance stack|list
self _make_stack stack stack
blocks append stack
self layer x
super DepthWiseConv|self __init__
context get_context platform
[1|kernel_size|in_planes] weight_shape
_initialize_weight_goog shape weight_init
int kernel_size|2 pad
self depthwise_conv x|self weight x
super DropConnect|self __init__
P Shape self shape
P DType self dtype
P Dropout keep_prob self dropout
Tensor self keep_prob|dtype self keep_prob_tensor
self shape x shape
self dtype x dtype
P Fill dtype|(shape|1|1|1) ones_tensor
self dropout ones_tensor mask
x|mask x
x|self keep_prob_tensor x
DropConnect drop_connect_rate inputs
super SqueezeExcite|self __init__
gate_fn self gate_fn
self avg_global_pool x|(2|3) x_se
self conv_reduce x_se x_se
self act_fn x_se x_se
self conv_expand x_se x_se
self gate_fn x_se x_se
x|x_se x
super DepthwiseSeparableConv|self __init__
pw_act self has_pw_act
DepthWiseConv in_chs|dw_kernel_size|stride self conv_dw
_fused_bn in_chs|bn_args self bn1
_conv1x1 in_chs|out_chs self conv_pw
_fused_bn out_chs|bn_args self bn2
x identity
self conv_dw x x
self bn1 x x
self act_fn x x
self se x x
self conv_pw x x
self bn2 x x
drop_connect x|self training|self drop_connect_rate x
x|identity x
super InvertedResidual|self __init__
int in_chs|exp_ratio mid_chs
_conv in_chs|mid_chs|exp_kernel_size self conv_pw
_fused_bn mid_chs|bn_args self bn1
shuffle_type self shuffle_type
isinstance exp_kernel_size|list
DepthWiseConv mid_chs|dw_kernel_size|stride self conv_dw
_fused_bn mid_chs|bn_args self bn2
SqueezeExcite self se
max 1|int(se_base_chs|se_ratio) reduce_chs
act_fn|gate_fn act_fn
_conv mid_chs|out_chs|pw_kernel_size self conv_pwl
_fused_bn out_chs|bn_args self bn3
self conv_pwl x x
self bn3 x x
super GenEfficientNet|self __init__
num_classes self num_classes
drop_rate self drop_rate
num_features self num_features
_fused_bn stem_size|bn_args self bn1
stem_size in_chans
self blocks in_chs in_chs
_conv1x1 in_chs|self num_features self conv_head
_dense self num_features|self num_classes self classifier
P Reshape self reshape
self conv_stem x x
self blocks x x
self global_pool x|(2|3) x
self conv_head x x
self reshape self shape x x
self reshape x|(self shape x) x
self drop_out x x
self classifier x
max 1280|_round_channels num_features
GenEfficientNet model
_resolve_bn_args kwargs bn_args
Swish act_fn
TINYNET_CFG sub_model d
default_cfgs default_cfg
default_cfg width
int r|height height
int r|width width
(channel|height|width) default_cfg
print default_cfg
print %(w|d|r)
_gen_efficientnet model
w|depth_multiplier channel_multiplier
default_cfg model default_cfg
isinstance shape n
shape|shape|shape n act_fn
shape n act_fn
padding|pad_mode padding padding
kwargs pop None bn_momentum bn_args
bn_momentum bn_args self bn_args
kwargs pop None bn_eps bn_args
bn_eps bn_args self bn_args
int divisor new_channels
int ss split k
ss split k weight_shape
isinstance block_str split ops
block_str split ops block_type
block_str split ops op
ops op startswith
ops op key
ops op v
re split op splits value
int options kernel_size weight_shape
zip ba pop bt
zip ba self in_chs
enumerate block_strings block_str
isinstance block_strings block_str
stack_args append ba pop bt
stack_args append ba self in_chs
self sigmoid x x
self sigmoid x keep_prob_tensor x
self sigmoid x x
self sigmoid x identity
self sigmoid x x
nn Sigmoid x x
nn Sigmoid x keep_prob_tensor x
nn Sigmoid x x
nn Sigmoid x identity
nn Sigmoid x x
Swish self act_fn act_fn
self in_chs ba self in_chs
self bn_args ba self in_chs
self pad_type ba self in_chs
self drop_connect_rate| ba self in_chs
self se_gate_fn ba self in_chs
self se_reduce_mid ba self in_chs
ba self in_chs self in_chs
nn SequentialCell blocks append stack
configuration s keep_prob_tensor x
self layer x x
self layer x keep_prob_tensor x
self layer x x
self layer x identity
self layer x x
self depthwise_conv x|self weight x x
self depthwise_conv x|self weight x keep_prob_tensor x
self depthwise_conv x|self weight x x
self depthwise_conv x|self weight x identity
self depthwise_conv x|self weight x x
self dropout ones_tensor mask x
x|mask x x
x|mask x keep_prob_tensor x
x|mask x x
x|mask x identity
x|mask x x
x|self keep_prob_tensor x keep_prob_tensor x
x|self keep_prob_tensor x x
x|self keep_prob_tensor x identity
x|self keep_prob_tensor x x
self avg_global_pool x|(2|3) x_se x
self conv_reduce x_se x_se x
self act_fn x_se x_se x
self conv_expand x_se x_se x
self gate_fn x_se x_se x
x|x_se x x
x|x_se x identity
x|x_se x x
x identity x
self conv_dw x x x
self bn1 x x x
self act_fn x x x
self se x x x
self conv_pw x x x
self bn2 x x x
drop_connect x|self training|self drop_connect_rate x x
x|identity x x
act_fn|gate_fn act_fn act_fn
TINYNET_CFG sub_model d channel_multiplier
default_cfgs default_cfg width
default_cfgs default_cfg model default_cfg
default_cfg width default_cfg
int r|height height default_cfg
int r|width width default_cfg
(channel|height|width) default_cfg model default_cfg
print default_cfg model default_cfg
argparse ArgumentParser parser
parser parse_args args
CityScapes CS
make_dataset args cityscapes_dir cityscapes
np zeros (CS class_num|CS class_num) hist_perframe
enumerate i|img_path
print % i|len cityscapes
os path split img_path img_name
CS get_id os path join args cityscapes_dir|img_name ids1
CS get_id os path join args result_dir|img_name ids2
fast_hist ids1 flatten|ids2 flatten|CS class_num hist_perframe
get_scores hist_perframe per_class_iou
print f
f write %mean_pixel_acc
f write %mean_class_acc
f write %mean_class_iou
f write
enumerate i|cl
len cl
argparse ArgumentParser parser parse_args args
CityScapes CS get_id os path join args cityscapes_dir|img_name ids1
CityScapes CS get_id os path join args result_dir|img_name ids2
print f write %mean_pixel_acc
print f write %mean_class_acc
print f write %mean_class_iou
print f write
get_args args
get_generator args G_A
get_generator args G_B
G_A set_train True
G_B set_train True
load_ckpt args|G_A|G_B
os path join args outputs_dir imgs_out
os path exists imgs_out
os makedirs imgs_out
os path exists os path join imgs_out|
os makedirs os path join imgs_out|
create_dataset args ds
Reporter args reporter
reporter start_predict
Tensor data img_A
G_A img_A fake_B
save_image fake_B|os path join imgs_out|path_A
reporter info os path join imgs_out|path_A
reporter end_predict
args dataset_size reporter dataset_size
Tensor data img_B
G_B img_B fake_A
save_image fake_A|os path join imgs_out|path_B
reporter info os path join imgs_out|path_B
get_args args dataset_size reporter dataset_size
get_generator args G_A set_train True
get_generator args G_A img_A fake_B
get_generator args G_B set_train True
get_generator args G_B img_B fake_A
load_ckpt G_A img_A fake_B
load_ckpt args dataset_size reporter dataset_size
load_ckpt G_B img_B fake_A
Reporter args reporter start_predict
Reporter args reporter info os path join imgs_out|path_A
Reporter args reporter end_predict
Reporter args reporter info os path join imgs_out|path_B
get_generator args|kwargs G_A
get_generator args|kwargs G_B
G_A set_train True
G_B set_train True
NotImplementedError f
get_generator args|kwargs G_A set_train True
get_generator args|kwargs G_B set_train True
get_args args
context GRAPH_MODE mode|args platform device_target context set_context
get_generator args G_A
get_generator args G_B
G_A set_train True
G_B set_train True
load_ckpt args|G_A|G_B
[1|3|args image_size|args image_size] input_shp
Tensor np random uniform -1 0|1 0|size input_array
f G_A_file
G_A_file|file_format file_name
f G_B_file
G_B_file|file_format file_name
get_args args image_size|args image_size] input_shp
get_generator args G_A set_train True
get_generator args G_B set_train True
f G_A_file file_name
f G_B_file file_name
load_ckpt args|G_A|G_B
get_args args
create_dataset args ds
get_generator args G_A
get_generator args G_B
get_discriminator args D_A
get_discriminator args D_B
load_ckpt args|G_A|G_B|D_A|D_B
ImagePool args pool_size imgae_pool_A
ImagePool args pool_size imgae_pool_B
DiscriminatorLoss args|D_A|D_B loss_D
GeneratorLoss args|generator|D_A|D_B loss_G
nn Adam generator trainable_params|get_lr(args) optimizer_G
nn Adam loss_D trainable_params|get_lr(args) optimizer_D
TrainOneStepG loss_G|generator|optimizer_G net_G
TrainOneStepD loss_D|optimizer_D net_D
ds create_dict_iterator data_loader
Reporter args reporter
range _
reporter epoch_start
data_loader data
data img_A
data img_B
net_G img_A|img_B res_G
res_G fake_A
res_G fake_B
net_D img_A|img_B|imgae_pool_A query fake_A res_D
reporter step_end res_G|res_D
reporter visualizer img_A|img_B|fake_A|fake_B
reporter epoch_end net_G
profiler analyse
create_dataset args ds create_dict_iterator data_loader
TrainOneStepG loss_G|generator|optimizer_G net_G img_A|img_B res_G
TrainOneStepD loss_D|optimizer_D net_D img_A|img_B|imgae_pool_A query fake_A res_D
ds create_dict_iterator data_loader data
Reporter args reporter epoch_start
Reporter args reporter step_end res_G|res_D
Reporter args reporter visualizer img_A|img_B|fake_A|fake_B
Reporter args reporter epoch_end net_G
data_loader data img_A
data_loader data img_B
net_G img_A|img_B res_G fake_A
net_G img_A|img_B res_G fake_B
IMG_EXTENSIONS extension
os path isdir dir_path
sorted root|_|fnames
fnames fname
is_image_file fname
os path join root|fname path
images append path
images[:min max_dataset_size|len images
os path join dataroot|phase| self dir_A
os path join dataroot|phase| self dir_B
sorted make_dataset self dir_A|max_dataset_size self A_paths
sorted make_dataset self dir_B|max_dataset_size self B_paths
len self A_paths self A_size
len self B_paths self B_size
random shuffle self A_paths
self A_paths index%self A_size A_path
random randint 0|self B_size-1 index_B
self B_paths index_B B_path
np array Image open A_path convert A_img
np array Image open B_path convert B_img
max self A_size|self B_size
dataroot self dataroot
sorted make_dataset dataroot|max_dataset_size self paths
len self paths self size
self paths index%self size img_path
np array Image open img_path convert img
os path split img_path
sorted fnames fname
args dataroot dataroot
args phase phase
args batch_size batch_size
args device_num device_num
args rank rank
multiprocessing cpu_count cores
min 8|int(cores|device_num) num_parallel_workers
args image_size image_size
[0 5|255]|3 mean
[0 5|255]|3 std
UnalignedDataset dataroot|phase|max_dataset_size dataset
DistributedSampler len dataset distributed_sampler
(0 5|1 0) scale
mean mean|std std C Normalize
C HWC2CHW
ds map operations ds
ds repeat ds
os path join dataroot|args data_dir datadir
ImageFolderDataset datadir|max_dataset_size dataset
C Resize (image_size|image_size)
len dataset args dataset_size
args dataroot dataroot dataset
args phase phase dataset
[0 5|255]|3 mean mean|std std C Normalize
os path join dataroot|args data_dir datadir dataset
C HWC2CHW
dataset_size self dataset_size
num_replicas self num_replicas
rank self rank
int math ceil dataset_size|1 0|self num_replicas self num_samples
self num_samples|self num_replicas self total_size
shuffle self shuffle
np random RandomState seed indices
indices tolist indices
list range self dataset_size indices
iter indices
np random RandomState seed indices tolist indices
np bincount n|a|minlength bc
bc reshape n|n
np diag hist sum|(hist sum|1e-12) acc
np diag hist|(hist sum|1e-12) cl_acc
np diag hist|(hist sum|hist sum-np diag hist|1e-12) iu
np nanmean cl_acc|np nanmean iu
self classes name
self color_list append label2color name color
len self classes self class_num
np array Image open img_path convert img
img shape _
np tile img|(1|1|self class_num) reshape(w|h|self class_num|3) img_tile
np abs img_tile-self color_list sum axis diff
diff argmin axis ids
np bincount n|a|minlength bc reshape n|n
np array Image open img_path convert img shape _
np abs img_tile-self color_list sum axis diff argmin axis ids
pool_size self pool_size
isinstance images|Tensor
images asnumpy images
Tensor images
images image
self num_imgs|1 self num_imgs
self images append image
return_images append image
random uniform 0|1 p
random randint 0|self pool_size-1 random_id
self images random_id tmp
image self images random_id
return_images append tmp
np array return_images return_images
ValueError  format return_images shape
Tensor return_images
isinstance img|Tensor
decode_image img img
isinstance img|np ndarray
ValueError  format type img
Image fromarray img img_pil
img_pil save img_path
 img asnumpy|std|mean astype np uint8 transpose (1|2|0)
[args lr]args dataset_sizeargs n_epochs lrs
range epoch
args lr|(args n_epochs_decay-epoch)|args n_epochs_decay lr_epoch
[lr_epoch]args dataset_size lrs
[lr_epoch]args dataset_size|(args max_epoch-args n_epochs_decay-args n_epochs) lrs
Tensor np array lrs astype np float32
load_checkpoint args G_A_ckpt param_GA
load_param_into_net G_A|param_GA
load_checkpoint args G_B_ckpt param_GB
load_param_into_net G_B|param_GB
load_checkpoint args D_A_ckpt param_DA
load_param_into_net D_A|param_DA
load_checkpoint args D_B_ckpt param_DB
load_param_into_net D_B|param_DB
load_checkpoint ckpt_path param
param items k|v
k replace student|teacher new_name
v name replace student|teacher new_param_name
new_param_name v name
v new_param new_name
load_param_into_net net|new_param
isinstance images asnumpy images
isinstance Tensor images
isinstance images image
isinstance Tensor return_images
isinstance  img asnumpy|std|mean astype np uint8 transpose (1|2|0)
isinstance Tensor np array lrs astype np float32
Tensor images image
images image self images random_id
self images append image self images random_id
return_images append image self images random_id
isinstance  img asnumpy|std|mean astype np uint8 transpose (1|2|0)
isinstance Tensor np array lrs astype np float32
Image fromarray img img_pil save img_path
 img asnumpy|std|mean astype np uint8 transpose  img asnumpy|std|mean astype np uint8 transpose (1|2|0)
load_param_into_net param items k|v
load_param_into_net param items k|v
load_param_into_net param items k|v
load_param_into_net param items k|v
load_checkpoint ckpt_path param items k|v
param items k replace student|teacher new_name
param items v name replace student|teacher new_param_name
param items v new_param new_name
v name replace student|teacher new_param_name v name
super Reporter|self __init__
os path join args outputs_dir self log_dir
os path join args outputs_dir self imgs_dir
os path join args outputs_dir self ckpts_dir
os path exists self log_dir
os path exists self imgs_dir
os path exists self ckpts_dir
args rank self rank
args save_checkpoint_epochs self save_checkpoint_epochs
args save_imgs self save_imgs
logging StreamHandler console
console setLevel logging INFO
logging Formatter formatter
console setFormatter formatter
self addHandler console
datetime now strftime| format(self rank) log_name
os path join self log_dir|log_name self log_fn
logging FileHandler self log_fn fh
fh setLevel logging INFO
fh setFormatter formatter
self addHandler fh
self save_args args
args dataset_size self dataset_size
args print_iter self print_iter
self isEnabledFor logging INFO
self _log logging INFO|msg|args|kwargs
self info
vars args args_dict
args_dict keys key
self info key|args_dict[key]
|line_width important_msg
|2 important_msg
self info important_msg|args|kwargs
time time self step_start_time
time time self epoch_start_time
float res_D asnumpy loss_D
res_G item
res append float item asnumpy
self G_loss append res
self D_loss append loss_D
(time time-self step_start_time)|1000|self print_iter step_cost
(time time-self epoch_start_time)|1000 epoch_cost
epoch_cost|self dataset_size pre_step_time
sum self G_loss|self dataset_size mean_loss_G
sum self D_loss|self dataset_size mean_loss_D
save_checkpoint net G generator G_A|os path join self ckpts_dir|f
save_checkpoint net G generator G_B|os path join self ckpts_dir|f
save_checkpoint net G D_A|os path join self ckpts_dir|f
save_checkpoint net G D_B|os path join self ckpts_dir|f
save_image img_A|os path join self imgs_dir|f
save_image img_B|os path join self imgs_dir|f
save_image fake_A|os path join self imgs_dir|f
save_image fake_B|os path join self imgs_dir|f
time time self predict_start_time
direction self direction
(time time-self predict_start_time)|1000 cost
cost|self dataset_size pre_step_cost
self info  format self dataset_size|cost|pre_step_cost
logging StreamHandler console setLevel logging INFO
logging StreamHandler console setFormatter formatter
logging FileHandler self log_fn fh setLevel logging INFO
logging FileHandler self log_fn fh setFormatter formatter
self save_args args dataset_size self dataset_size
self save_args args print_iter self print_iter
vars args args_dict keys key
(time time-self epoch_start_time)|1000 epoch_cost dataset_size pre_step_time
(time time-self predict_start_time)|1000 cost dataset_size pre_step_cost
argparse ArgumentParser parser
parser parse_args opt
Image open path convert resize (256|256)
os path basename segmap_path replace segmap_identifier
os path basename photo_path replace photo_identifier
os path join output_dir|save_phase savedir
print f
os path join gtFine_dir|phase segmap_expr
glob glob segmap_expr segmap_paths
sorted segmap_paths segmap_paths
os path join leftImg8bit_dir|phase photo_expr
glob glob photo_expr photo_paths
sorted photo_paths photo_paths
check_matching_pair segmap_path|photo_path
load_resized_img segmap_path segmap
load_resized_img photo_path photo
os path join savedir|f savepath
photo save savepath
segmap save savepath
print % i|len segmap_paths|savepath
process_cityscapes opt gtFine_dir|opt leftImg8bit_dir|opt output_dir|
argparse ArgumentParser parser parse_args opt
check_matching_pair photo save savepath
load_resized_img segmap_path segmap save savepath
load_resized_img photo_path photo save savepath
parser parse_args args
context GRAPH_MODE mode|args platform device_target|args save_graphs save_graphs context set_context
context reset_auto_parallel_context
get_rank args rank
args max_epoch-args n_epochs args n_epochs_decay
phase args phase
parser parse_args args max_epoch-args n_epochs args n_epochs_decay
super UnetGenerator|self __init__
range n_layers _
self model x
super UnetSkipConnectionBlock|self __init__
nn BatchNorm2d inner_nc downnorm
nn BatchNorm2d outer_nc upnorm
outer_nc in_planes
nn LeakyReLU alpha downrelu
nn ReLU uprelu
[downconv] down
[uprelu|upconv|nn Tanh] up
down|[submodule]|up model
[downrelu|downconv] down
[uprelu|upconv|upnorm] up
down|up model
[downrelu|downconv|downnorm] down
model append nn Dropout
nn SequentialCell model self model
self model x out
self concat (out|x) out
nn BatchNorm2d inner_nc downnorm down
nn BatchNorm2d outer_nc upnorm up
nn LeakyReLU alpha downrelu down
nn LeakyReLU alpha downrelu down
nn ReLU uprelu Tanh] up
nn ReLU uprelu up
[downconv] down model
[downconv] down down
[downconv] down model
[downconv] down down
[uprelu|upconv|nn Tanh] up Tanh] up
[uprelu|upconv|nn Tanh] up model
[uprelu|upconv|nn Tanh] up up
[uprelu|upconv|nn Tanh] up model
down|[submodule]|up model append nn Dropout
[downrelu|downconv] down down
[downrelu|downconv] down model
[downrelu|downconv] down down
[uprelu|upconv|upnorm] up up
[uprelu|upconv|upnorm] up model
down|up model append nn Dropout
[downrelu|downconv|downnorm] down down
net cells_and_names cell
isinstance cell|nn Conv2d
cell weight set_data init initializer init Normal init_gain
cell weight set_data init initializer init XavierUniform init_gain
NotImplementedError %init_type
isinstance cell|nn BatchNorm2d
cell gamma set_data init initializer cell gamma shape
cell beta set_data init initializer cell beta shape
super ConvNormReLU|self __init__
nn BatchNorm2d out_planes norm
(kernel_size-1)||2 padding
[conv|norm] layers
((0|0)) paddings
nn Pad paddings pad
[pad|conv|norm] layers
nn ReLU relu
nn LeakyReLU alpha relu
layers append relu
nn SequentialCell layers self features
self features x output
super ConvTransposeNormReLU|self __init__
net cells_and_names cell weight set_data init initializer init Normal init_gain
net cells_and_names cell weight set_data init initializer init XavierUniform init_gain
net cells_and_names cell gamma set_data init initializer cell gamma shape
net cells_and_names cell beta set_data init initializer cell beta shape
nn BatchNorm2d out_planes norm layers
nn BatchNorm2d out_planes norm layers
[conv|norm] layers append relu
nn Pad paddings pad layers
[pad|conv|norm] layers append relu
super ResidualBlock|self __init__
ConvNormReLU dim|dim|3|1|0|norm_mode|pad_mode self conv1
dropout self dropout
nn Dropout self dropout
self conv1 x out
self dropout out out
self conv2 out out
super ResNetGenerator|self __init__
ConvNormReLU in_planes|ngf|7|1|alpha|norm_mode|pad_mode self conv_in
ConvNormReLU ngf|ngf|2|3|2|alpha|norm_mode self down_1
ConvNormReLU ngf|2|ngf|4|3|2|alpha|norm_mode self down_2
[ResidualBlock ngf|4|norm_mode|dropout layers
nn SequentialCell layers self residuals
ConvTransposeNormReLU ngf|4|ngf|2|3|2|alpha|norm_mode self up_2
ConvTransposeNormReLU ngf|2|ngf|3|2|alpha|norm_mode self up_1
nn Pad paddings pad
nn SequentialCell [pad|conv] self conv_out
ops Tanh self activate
self conv_in x x
self down_1 x x
self down_2 x x
self residuals x x
self up_2 x x
self up_1 x x
self conv_out x output
self activate output
nn Dropout self dropout layers
init_weights net|args init_type|args init_gain
args t_gl_num|alpha n_layers
args slope|norm_mode alpha
Discriminator 3|64|3
super Discriminator|self __init__
nn LeakyReLU alpha
ndf nf_mult
range i
nf_mult nf_mult_prev
min 2i|8|ndf nf_mult
min 2n_layers|8|ndf nf_mult
nn SequentialCell layers self features
self features x output
Generator G_A|G_B
super Generator|self __init__
G_A self G_A
G_B self G_B
ops OnesLike self ones
use_identity self use_identity
self G_B img_B fake_A
self G_A img_A fake_B
self G_B fake_B rec_A
self G_A fake_A rec_B
self G_B img_A identity_A
self G_A img_B identity_B
self ones img_A identity_A
self ones img_B identity_B
network self network
self network img_A|img_B _
optimizer self optimizer
G self G
self G set_grad
self G set_train
self G D_A set_grad False
self G D_A set_train False
self G D_B set_grad False
self G D_B set_train False
sens self sens
ms ParameterTuple generator trainable_params self weights
WithLossCell G self net
context get_auto_parallel_context self parallel_mode
context get_auto_parallel_context mean
auto_parallel_context get_device_num_is_set
context get_auto_parallel_context degree
get_group_size degree
nn DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
self weights weights
self G img_A|img_B lib
ops Fill ops DType lg sens
self grad self net|weights(img_A|img_B|sens) grads_g
self grad_reducer grads_g grads_g
ops depend lg|self optimizer grads_g
D self D
self D set_grad
self D set_train
ms ParameterTuple D trainable_params self weights
self D img_A|img_B|fake_A|fake_B ld
ops Fill ops DType ld sens_d
self grad self D|weights(img_A|img_B|fake_A|fake_B|sens_d) grads_d
self grad_reducer grads_d grads_d
ops depend ld|self optimizer grads_d
ndf nf_mult nf_mult_prev
Generator G_A self G_A
Generator G_B self G_B
Generator G self G
super BCEWithLogits|self __init__
ValueError f
ops SigmoidCrossEntropyWithLogits self loss
ops ReduceSum self reduce_mode
ops ReduceMean self reduce_mode
self loss predict|target loss
self reduce_mode loss loss
super GANLoss|self __init__
ops OnesLike self ones
nn MSELoss reduction self loss
BCEWithLogits reduction self loss
ops cast target|ops dtype predict target
self ones predict|target target
super GeneratorLoss|self __init__
GANLoss args gan_mode self dis_loss
nn L1Loss self rec_loss
generator self generator
D_A self D_A
D_B self D_B
Tensor True|mstype bool_ self true
args kd self kd
get_generator args|True self GT_A
load_teacher_ckpt self GT_A|args GT_A_ckpt|
get_generator args|True self GT_B
load_teacher_ckpt self GT_B|args GT_B_ckpt|
self GT_A set_train True
self GT_B set_train True
self generator img_A|img_B identity_B
self dis_loss self D_B fake_B loss_G_A
self dis_loss self D_A fake_A loss_G_B
loss_G_A|loss_G_B|loss_C_A|loss_C_B|loss_idt_A|loss_idt_B loss_G
self GT_B img_B teacher_A
self GT_A img_A teacher_B
kd_loss_A|kd_loss_B loss_G
super DiscriminatorLoss|self __init__
Tensor False|mstype bool_ self false
self D_A fake_A D_fake_A
self D_A img_A D_img_A
self D_B fake_B D_fake_B
self D_B img_B D_img_B
self dis_loss D_fake_A|self false|self dis_loss(D_img_A|self true) loss_D_A
self dis_loss D_fake_B|self false|self dis_loss(D_img_B|self true) loss_D_B
(loss_D_A|loss_D_B)|0 5 loss_D
ops SigmoidCrossEntropyWithLogits self loss loss_G
ops SigmoidCrossEntropyWithLogits self loss 5 loss_D
self loss predict|target loss loss_G
self loss predict|target loss 5 loss_D
self reduce_mode loss loss loss_G
self reduce_mode loss loss 5 loss_D
nn MSELoss reduction self loss loss_G
nn MSELoss reduction self loss 5 loss_D
BCEWithLogits reduction self loss loss_G
BCEWithLogits reduction self loss 5 loss_D
args kd self kd loss_G
self dis_loss self D_B fake_B loss_G_A loss_G
self dis_loss self D_A fake_A loss_G_B loss_G
loss_G_A|loss_G_B|loss_C_A|loss_C_B|loss_idt_A|loss_idt_B loss_G loss_G
self dis_loss D_fake_A|self false|self dis_loss(D_img_A|self true) loss_D_A 5 loss_D
self dis_loss D_fake_B|self false|self dis_loss(D_img_B|self true) loss_D_B 5 loss_D
(loss_D_A|loss_D_B)|0 5 loss_D 5 loss_D
parser parse_args args_opt
args_opt net||args_opt dataset onnx_filename
args_opt net||args_opt dataset air_filename
squeezenet num_classes net
load_checkpoint args_opt checkpoint_path param_dict
load_param_into_net net|param_dict
Tensor np zeros [1|3|227|227]|np float32 input_arr
parser parse_args args_opt net||args_opt dataset onnx_filename
parser parse_args args_opt net||args_opt dataset air_filename
parser parse_args args_opt
load_param_into_net net|param_dict
args_opt device_target target
config save_checkpoint_path ckpt_save_dir
int os getenv device_id
args_opt device_num device_num
ParallelMode DATA_PARALLEL parallel_mode
get_group_size device_num
config save_checkpoint_path||str ckpt_save_dir
config batch_size batch_size
dataset get_dataset_size step_size
squeezenet num_classes net
load_checkpoint args_opt pre_trained param_dict
config lr_end lr_end
config lr_max lr_max
config epoch_size total_epochs
config warmup_epochs warmup_epochs
config pretrain_epoch_size pretrain_epochs
step_size steps_per_epoch
Tensor lr lr
config label_smooth_factor smooth_factor
loss loss_fn
opt optimizer
loss_scale loss_scale_manager
Model net|loss_fn model
TimeMonitor data_size time_cb
LossMonitor loss_cb
[time_cb|loss_cb] cb
CheckpointConfig config_ck
config save_checkpoint_epochs|step_size save_checkpoint_steps
ckpt_save_dir directory
[ckpt_cb] cb
parser parse_args args_opt device_target target
parser parse_args args_opt device_num device_num
config save_checkpoint_path ckpt_save_dir directory
config save_checkpoint_path||str ckpt_save_dir directory
dataset get_dataset_size step_size steps_per_epoch
squeezenet num_classes net model
loss loss_fn model
TimeMonitor data_size time_cb cb
LossMonitor loss_cb cb
[time_cb|loss_cb] cb cb
parser parse_args args_opt
load_param_into_net net|param_dict
args_opt device_target target
int os getenv device_id
target device_target
config batch_size batch_size
dataset get_dataset_size step_size
squeezenet num_classes net
load_checkpoint args_opt checkpoint_path param_dict
net set_train False
config label_smooth_factor smooth_factor
loss loss_fn
model eval dataset res
parser parse_args args_opt device_target target
load_param_into_net net set_train False
args_opt device_target target device_target
squeezenet num_classes net set_train False
 config1
 config2
 config3
 config4
super Fire|self __init__
inplanes self inplanes
nn ReLU self squeeze_activation
nn ReLU self expand1x1_activation
nn ReLU self expand3x3_activation
self squeeze_activation self squeeze x x
SqueezeNet net
super SqueezeNet|self __init__
 self features
nn ReLU
Fire 96|16|64|64
Fire 128|16|64|64
Fire 128|32|128|128
Fire 256|32|128|128
Fire 256|48|192|192
Fire 384|48|192|192
Fire 384|64|256|256
Fire 512|64|256|256
nn ReLU self relu
nn Flatten self flatten
self custom_init_weight
self cells_and_names _|cell
isinstance cell|nn Conv2d
self features x x
self dropout x x
self final_conv x x
self relu x x
self mean x|(2|3) x
self flatten x x
SqueezeNet_Residual net
super SqueezeNet_Residual|self __init__
Fire 96|16|64|64 self fire2
Fire 128|16|64|64 self fire3
Fire 128|32|128|128 self fire4
Fire 256|32|128|128 self fire5
Fire 256|48|192|192 self fire6
Fire 384|48|192|192 self fire7
Fire 384|64|256|256 self fire8
Fire 512|64|256|256 self fire9
P TensorAdd self add
self conv1 x x
self max_pool2d x x
self fire2 x x
self add x|self fire3 x x
self fire4 x x
self add x|self fire5 x x
self fire6 x x
self add x|self fire7 x x
self fire8 x x
self add x|self fire9 x x
self conv10 x x
lr_init float
lr_end float
lr_max float
total_epochs int
warmup_epochs int
pretrain_epochs int
steps_per_epoch int
lr_decay_mode string
steps_per_epoch|total_epochs total_steps
steps_per_epoch|warmup_epochs warmup_steps
steps_per_epoch|pretrain_epochs pretrain_steps
total_steps-warmup_steps decay_steps
range i
lr_max lr
lr_max|0 1 lr
lr_max|0 01 lr
lr_max|0 001 lr
lr_each_step append lr
linear_warmup_lr i|warmup_steps|lr_max|lr_init lr
(1 0-(i-warmup_steps)|decay_steps) base
lr_max|base|base lr
(total_steps-i)|decay_steps linear_decay
linear_decay|cosine_decay|0 00001 decayed
lr_max|decayed lr
np array lr_each_step astype np float32 lr_each_step
lr_each_step learning_rate
(base_lr-init_lr)|warmup_steps lr_inc
init_lr|lr_inc|current_step lr
steps_per_epoch|warmup_epochs warmup_steps lr_inc
total_steps-warmup_steps decay_steps linear_decay
lr_max lr lr
lr_max|0 1 lr lr
lr_max|0 01 lr lr
lr_max|0 001 lr lr
lr_each_step append lr lr
linear_warmup_lr i|warmup_steps|lr_max|lr_init lr lr
(1 0-(i-warmup_steps)|decay_steps) base lr
lr_max|base|base lr lr
(total_steps-i)|decay_steps linear_decay 00001 decayed
linear_decay|cosine_decay|0 00001 decayed lr
lr_max|decayed lr lr
np array lr_each_step astype np float32 lr_each_step learning_rate
(base_lr-init_lr)|warmup_steps lr_inc lr
init_lr|lr_inc|current_step lr lr
dataset_path string
do_train bool
repeat_num int
batch_size int
target str
_get_rank_info rank_id
get_rank rank_id
get_group_size device_num
device_num num_shards
C RandomCrop (32|32)|(4|4|4|4)
C Resize (227|227)
C Rescale 1 0|255 0|0 0
C Normalize [0 4914|0 4822|0 4465]|[0 2023|0 1994|0 2010]
C CutOut
C HWC2CHW
C2 TypeCast mstype int32 type_cast_op
ds repeat repeat_num ds
[0 485|255|0 456|255|0 406|255] mean
[0 229|255|0 224|255|0 225|255] std
(0 08|1 0) scale
mean mean|std std C Normalize
C Decode
C Resize (256|256)
C CenterCrop image_size
int os environ get rank_size
get_group_size rank_size
repeat_num int os environ get rank_size
batch_size int os environ get rank_size
get_group_size device_num num_shards
[0 485|255|0 456|255|0 406|255] mean mean|std std C Normalize
super CrossEntropySmooth|self __init__
P OneHot self onehot
sparse self sparse
Tensor 1 0-smooth_factor|mstype float32 self on_value
Tensor 1 0|smooth_factor|(num_classes-1) self off_value
nn SoftmaxCrossEntropyWithLogits reduction self ce
self onehot label|F shape logit label
self ce logit|label loss
ghostnet_1x args|kwargs
ghostnet_nose_1x args|kwargs
ghostnet_600m args|kwargs
NotImplementedError f
parser parse_args args_opt
config_ascend config_platform
int os getenv device_id
config_gpu config_platform
NotImplementedError f
ghostnet_1x num_classes net
ghostnet_nose_1x num_classes net
ghostnet_600m num_classes net
net to_float mstype float16
net cells_and_names _|cell
isinstance cell|nn Dense
cell to_float mstype float32
config_platform config
args_opt platform platform
config_platform batch_size batch_size
dataset get_dataset_size step_size
load_checkpoint args_opt checkpoint_path param_dict
load_param_into_net net|param_dict
net set_train False
Model net|loss_fn model
model eval dataset res
parser parse_args args_opt platform platform
config_ascend config_platform config
config_ascend config_platform batch_size batch_size
config_gpu config_platform config
config_gpu config_platform batch_size batch_size
ghostnet_1x num_classes net to_float mstype float16
ghostnet_1x num_classes net cells_and_names _|cell
ghostnet_1x num_classes net set_train False
ghostnet_1x num_classes net model
ghostnet_nose_1x num_classes net to_float mstype float16
ghostnet_nose_1x num_classes net cells_and_names _|cell
ghostnet_nose_1x num_classes net set_train False
ghostnet_nose_1x num_classes net model
ghostnet_600m num_classes net to_float mstype float16
ghostnet_600m num_classes net cells_and_names _|cell
ghostnet_600m num_classes net set_train False
ghostnet_600m num_classes net model
net cells_and_names cell to_float mstype float32
load_param_into_net net set_train False
Model net|loss_fn model eval dataset res
int np ceil x|1 |divisor|divisor
super MyHSigmoid|self __init__
nn ReLU6 self relu6
self relu6 x|3 
act_func string
super Activation|self __init__
nn ReLU self act
nn ReLU6 self act
MyHSigmoid self act
nn HSwish self act
self act x
super GlobalAvgPooling|self __init__
P ReduceMean keep_dims self mean
self mean x|(2|3) x
super SE|self __init__
_make_divisible num_out||ratio num_mid
Activation self act1
Activation self act2
P Mul self mul
self pool x out
self conv_reduce out out
self act1 out out
self conv_expand out out
self act2 out out
self mul x|out out
ConvUnit 3|3
super ConvUnit|self __init__
num_out out_channels
num_groups group
nn BatchNorm2d num_out self bn
use_act self use_act
self conv x out
self bn out out
self act out out
GhostModule 3|3
super GhostModule|self __init__
math ceil num_out|ratio init_channels
init_channels|(ratio-1) new_channels
self primary_conv x x1
self cheap_operation x1 x2
self concat (x1|x2)
GhostBottleneck 16|3|1|1
super GhostBottleneck|self __init__
stride self use_dw
use_se self use_se
SE num_mid self se
 self shortcut
P TensorAdd self add
x shortcut
self ghost1 x out
self dw out out
self se out out
self ghost2 out out
self shortcut shortcut shortcut
self add shortcut|out out
super GhostNet|self __init__
model_cfgs self cfgs
_make_divisible multiplier|self inplanes first_conv_out_channel
first_conv_out_channel out_channels
nn BatchNorm2d first_conv_out_channel self bn1
self cfgs layer_cfg
_make_divisible exp_ch
_make_divisible out_channel
layer_cfg use_se
layer_cfg act_func
_make_divisible output_channel
nn SequentialCell self blocks self blocks
model_cfgs out_channels
P Flatten self squeeze
final_drop self final_drop
nn Dropout self final_drop self dropout
nn Dense self classifier
self _initialize_weights
self conv_stem x x
self bn1 x x
self act1 x x
self blocks x x
self global_pool x x
self conv_head x x
self act2 x x
self squeeze x x
self dropout x x
self classifier x x
exp_ch mid_planes
out_channel out_planes
out_planes self inplanes
self init_parameters_data
self cells_and_names _|m
isinstance m|(nn Conv2d)
m kernel_size|m kernel_size|m out_channels n
isinstance m|nn BatchNorm2d
isinstance m|nn Dense
GhostNet model_cfgs model_name
int np ceil x|1  self shortcut
self relu6 x|3  new_channels
self relu6 x|3  self shortcut
self act x shortcut
self mean x|(2|3) x shortcut
ConvUnit  self shortcut
GhostModule  self shortcut
math ceil num_out|ratio init_channels new_channels
self concat  self shortcut
self concat x shortcut
GhostBottleneck  self shortcut
_make_divisible multiplier|self inplanes first_conv_out_channel out_channels
self cfgs layer_cfg use_se
self cfgs layer_cfg act_func
_make_divisible exp_ch mid_planes
_make_divisible out_channel out_planes
out_channel out_planes self inplanes
self cells_and_names m kernel_size|m kernel_size|m out_channels n
 config_ascend
 config_gpu
max min_value|int(v|divisor|2)||divisor|divisor new_v
divisor new_v
_make_divisible channels|divisor|channel_min
super MyHSigmoid|self __init__
nn ReLU6 self relu6
self relu6 x|3 
act_func string
super Activation|self __init__
nn ReLU self act
nn ReLU6 self act
MyHSigmoid self act
nn HSwish self act
self act x
super GlobalAvgPooling|self __init__
P ReduceMean keep_dims self mean
self mean x|(2|3) x
super SE|self __init__
_make_divisible num_out||ratio num_mid
Activation self act1
Activation self act2
P Mul self mul
self pool x out
self conv_reduce out out
self act1 out out
self conv_expand out out
self act2 out out
self mul x|out out
ConvUnit 3|3
super ConvUnit|self __init__
num_out out_channels
num_groups group
use_act self use_act
self conv x out
self bn out out
self act out out
GhostModule 3|3
super GhostModule|self __init__
math ceil num_out|ratio init_channels
init_channels|(ratio-1) new_channels
self primary_conv x x1
self cheap_operation x1 x2
self concat (x1|x2)
GhostBottleneck 16|3|1|1
super GhostBottleneck|self __init__
stride self use_dw
use_se self use_se
SE num_mid|ratio self se
 self shortcut
P TensorAdd self add
x shortcut
self ghost1 x out
self dw out out
self se out out
self ghost2 out out
self shortcut shortcut shortcut
self add shortcut|out out
super GhostNet|self __init__
model_cfgs self cfgs
_round_channels first_conv_out_channel
first_conv_out_channel self inplanes
first_conv_out_channel out_channels
self cfgs layer_cfg
_make_divisible exp_ch
_round_channels out_channel
layer_cfg use_se
layer_cfg act_func
_make_divisible output_channel
nn SequentialCell self blocks self blocks
model_cfgs out_channels
P Squeeze axis self squeeze
final_drop self final_drop
nn Dropout self final_drop self dropout
nn Dense self classifier
self _initialize_weights
self conv_stem x x
self bn1 x x
self act1 x x
self blocks x x
self global_pool x x
self conv_head x x
self act2 x x
self squeeze x x
self dropout x x
self classifier x x
exp_ch mid_planes
out_channel out_planes
out_planes self inplanes
self init_parameters_data
self cells_and_names _|m
isinstance m|(nn Conv2d)
m kernel_size|m kernel_size|m out_channels n
isinstance m|nn BatchNorm2d
isinstance m|nn Dense
GhostNet model_cfgs model_name
_make_divisible  self shortcut
self relu6 x|3  new_channels
self relu6 x|3  self se
self relu6 x|3  self shortcut
self act x shortcut
self mean x|(2|3) x shortcut
_make_divisible num_out||ratio num_mid self se
ConvUnit  self shortcut
GhostModule  self shortcut
math ceil num_out|ratio init_channels new_channels
self concat  self shortcut
self concat x shortcut
GhostBottleneck  self shortcut
_round_channels first_conv_out_channel self inplanes
_round_channels first_conv_out_channel out_channels
self cfgs layer_cfg use_se
self cfgs layer_cfg act_func
_make_divisible exp_ch mid_planes
_round_channels out_channel out_planes
out_channel out_planes self inplanes
self cells_and_names m kernel_size|m kernel_size|m out_channels n
global_step int
lr_init float
lr_end float
lr_max float
warmup_epochs int
total_epochs int
steps_per_epoch int
steps_per_epoch|total_epochs total_steps
steps_per_epoch|warmup_epochs warmup_steps
range i
lr_init|(lr_max-lr_init)|i|warmup_steps lr
lr_end| lr
lr_each_step append lr
global_step current_step
np array lr_each_step astype np float32 lr_each_step
lr_each_step learning_rate
steps_per_epoch|warmup_epochs warmup_steps lr
range i lr
np array lr_each_step astype np float32 lr_each_step learning_rate
dataset_path string
do_train bool
repeat_num int
batch_size int
int os getenv rank_size
int os getenv rank_id
de MindDataset ds
config image_height resize_height
C RandomCropDecodeResize resize_crop_op
C RandomColorAdjust color_op
C Rescale 1|255 0|0 rescale_op
C Normalize normalize_op
C HWC2CHW change_swap_op
P Decode decode_p
P Resize s|interpolation resize_p
P CenterCrop c center_crop_p
P ToTensor totensor
P Normalize (0 485|0 456|0 406) normalize_p
P ComposeOp composeop
composeop trans
C2 TypeCast mstype int32 type_cast_op
ds shuffle buffer_size ds
ds repeat repeat_num ds
repeat_num int os getenv rank_size
repeat_num int os getenv rank_id
batch_size int os getenv rank_size
batch_size int os getenv rank_id
de MindDataset ds shuffle buffer_size ds
de MindDataset ds repeat repeat_num ds
P ComposeOp composeop trans
batch_size int
parser parse_known_args unknown
unknown args training_script_args
print __file__
parse_args args
print args
args visible_devices split visible_devices
os path isfile args training_script
print  format visible_devices
print  format args server_id
open readlines hccn_configs
hccn_configs hccn_item
hccn_item strip hccn_item
hccn_item startswith
hccn_item split device_ip
device_id split device_id
device_ip device_ips device_id
print  format device_id|device_ip
range instance_id
visible_devices instance_id device_id
device_ips device_id device_ip
str device_id usable_dev
str instance_id instance
args server_id instance
instance_list append instance
str args nproc_per_node
visible_devices instance_id eth_id
hccn_table append  format eth_id
str args nproc_per_node hccn_table
os getcwd table_path
os path exists table_path
os mkdir table_path
open table_fn|
sys stdout flush
os environ copy env
str args nproc_per_node env
os getcwd cur_path
range rank_id
os chdir cur_path
visible_devices rank_id device_id
os path join cur_path| format rank_id device_dir
str rank_id env
str device_id env
table_fn env
os path exists device_dir
shutil rmtree device_dir
os mkdir device_dir
os chdir device_dir
[sys executable|] cmd
cmd append args training_script
cmd extend args training_script_args
open log_file
subprocess Popen process
processes append process
cmds append cmd
log_files append log_file
zip process|cmd|log_file
process wait
process returncode|cmd cmd subprocess CalledProcessError
log_file close
parser parse_known_args unknown args training_script_args
parse_args args visible_devices split visible_devices
parse_args args server_id instance
print args visible_devices split visible_devices
print args server_id instance
args visible_devices split visible_devices instance_id device_id
args visible_devices split visible_devices instance_id eth_id
args visible_devices split visible_devices rank_id device_id
print  format visible_devices instance_id device_id
print  format visible_devices instance_id eth_id
print  format visible_devices rank_id device_id
open readlines hccn_configs hccn_item
hccn_configs hccn_item strip hccn_item
hccn_configs hccn_item startswith
hccn_configs hccn_item split device_ip
hccn_item split device_ip device_ips device_id
open table_fn env
[sys executable|] cmd append args training_script
[sys executable|] cmd extend args training_script_args
open log_file close
subprocess Popen process wait
subprocess Popen process returncode|cmd cmd subprocess CalledProcessError
processes append process wait
processes append process returncode|cmd cmd subprocess CalledProcessError
log_files append log_file close
zip process wait
zip process returncode|cmd cmd subprocess CalledProcessError
zip log_file close
int os getenv devid
FaceQABackbone network
args pretrained ckpt_path
os path isfile ckpt_path
load_checkpoint ckpt_path param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
Tensor input_data tensor_input_data
parser parse_args arg
main arg
load_checkpoint ckpt_path param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
warnings filterwarnings
int os getenv devid
mindspore common seed set_seed
faceqa_1p_cfg cfg
faceqa_8p_cfg cfg
args train_label_file cfg data_lst
args pretrained cfg pretrained
get_rank cfg local_rank
get_group_size cfg world_size
ParallelMode DATA_PARALLEL parallel_mode
ParallelMode STAND_ALONE parallel_mode
mindspore common set_seed
os path join cfg ckpt_path|datetime datetime now strftime cfg outputs_dir
get_logger cfg outputs_dir|cfg local_rank cfg logger
AverageMeter loss_meter
cfg logger info
de_dataset get_dataset_size cfg steps_per_epoch
de_dataset repeat cfg max_epoch de_dataset
cfg logger save_args cfg
cfg logger important_info
time time create_network_start
FaceQABackbone network
CriterionsFaceQA criterion
os path isfile cfg pretrained
load_checkpoint cfg pretrained param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
cfg logger info  format cfg pretrained
lr learning_rate
cfg momentum momentum
cfg weight_decay weight_decay
BuildTrainNetwork network|criterion train_net
TrainOneStepCell train_net|opt|sens train_net
cfg max_epoch|cfg steps_per_epoch||cfg ckpt_interval ckpt_max_num
CheckpointConfig save_checkpoint_steps train_config
_InternalCallbackParam cb_params
train_net cb_params train_network
ckpt_max_num cb_params epoch_num
RunContext cb_params run_context
ckpt_cb begin run_context
train_net set_train
time time t_end
time time t_epoch
-1 old_progress
data astype np float32 data
gt astype np float32 gt
Tensor data data
Tensor gt gt
train_net data|gt loss
loss_meter update loss asnumpy
i|1 cb_params cur_step_num
i|2 cb_params batch_num
ckpt_cb step_end run_context
time time-create_network_start time_for_graph_compile
time time-t_end time_used
int i|cfg steps_per_epoch epoch
cfg per_batch_size|(i-old_progress)|cfg world_size|time_used fps
cfg logger info  format epoch|i|loss_meter|fps
loss_meter reset
i old_progress
time time-t_epoch epoch_time_used
cfg per_batch_size|cfg world_size|cfg steps_per_epoch|epoch_time_used fps
cfg logger info  format epoch|i|fps
parser parse_args arg
main arg
faceqa_1p_cfg cfg logger info
faceqa_1p_cfg cfg logger save_args cfg
faceqa_1p_cfg cfg logger important_info
faceqa_1p_cfg cfg logger info  format cfg pretrained
faceqa_1p_cfg cfg momentum momentum
faceqa_1p_cfg cfg weight_decay weight_decay
faceqa_1p_cfg cfg max_epoch|cfg steps_per_epoch||cfg ckpt_interval ckpt_max_num
faceqa_1p_cfg cfg per_batch_size|(i-old_progress)|cfg world_size|time_used fps
faceqa_1p_cfg cfg logger info  format epoch|i|loss_meter|fps
faceqa_1p_cfg cfg per_batch_size|cfg world_size|cfg steps_per_epoch|epoch_time_used fps
faceqa_1p_cfg cfg logger info  format epoch|i|fps
faceqa_8p_cfg cfg logger info
faceqa_8p_cfg cfg logger save_args cfg
faceqa_8p_cfg cfg logger important_info
faceqa_8p_cfg cfg logger info  format cfg pretrained
faceqa_8p_cfg cfg momentum momentum
faceqa_8p_cfg cfg weight_decay weight_decay
faceqa_8p_cfg cfg max_epoch|cfg steps_per_epoch||cfg ckpt_interval ckpt_max_num
faceqa_8p_cfg cfg per_batch_size|(i-old_progress)|cfg world_size|time_used fps
faceqa_8p_cfg cfg logger info  format epoch|i|loss_meter|fps
faceqa_8p_cfg cfg per_batch_size|cfg world_size|cfg steps_per_epoch|epoch_time_used fps
faceqa_8p_cfg cfg logger info  format epoch|i|fps
AverageMeter loss_meter update loss asnumpy
AverageMeter loss_meter reset
load_checkpoint cfg pretrained param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
BuildTrainNetwork network|criterion train_net train_net
BuildTrainNetwork network|criterion train_net cb_params train_network
BuildTrainNetwork network|criterion train_net set_train
BuildTrainNetwork network|criterion train_net data|gt loss
TrainOneStepCell train_net|opt|sens train_net train_net
TrainOneStepCell train_net|opt|sens train_net cb_params train_network
TrainOneStepCell train_net|opt|sens train_net set_train
TrainOneStepCell train_net|opt|sens train_net data|gt loss
cfg max_epoch|cfg steps_per_epoch||cfg ckpt_interval ckpt_max_num cb_params epoch_num
cfg logger info  format loss_meter reset
cfg logger info  format i old_progress
warnings filterwarnings
int os getenv devid
out asnumpy astype np float32 out_eul
out asnumpy astype np float32 heatmap
out_eul|90 eulers
list kp_scores
list kp_coord_ori
enumerate i|_
heatmap i 1|48|48 map_1
softmax map_1 map_1
map_1 argmax kp_coor
map_1 max max_response
kp_scores append max_response
min max_response|0 25 kps_score_sum
int (kp_coor%48)|2 0 kp_coor
kp_coord_ori append kp_coor
open txt_path readline txt_line
txt_line strip split eulers_txt
 [-1|-1]|[-1|-1]|[-1|-1]|[-1|-1]|[-1|-1] kp_list
txt_line strip split box_cur
range index
bndbox append
-1 kp_id
bndbox box
kp_id|1 kp_id
float box x_coord
float box y_coord
int float x_coord|x_length|96 kp_list kp_id
int float y_coord|y_length|96 kp_list kp_id
cv2 imread img_path img_ori
cv2 cvtColor img_ori|cv2 COLOR_BGR2RGB img
cv2 resize img|(96|96) img
img transpose 2|0|1 img
np array [img] astype np float32|255  img
Tensor img img
nn Softmax blur_soft
nn Softmax kps_soft
P Reshape reshape
P ArgMaxWithValue argmax
args pretrained model_path
model_path replace result_file
os path exists result_file
os remove result_file
open result_file epoch_result
epoch_result write(model_path|)
FaceQABackbone network
model_path ckpt_path
os path isfile ckpt_path
load_checkpoint ckpt_path param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
args eval_dir path
[||||] kp_error_all
[||] eulers_error_all
os listdir path file_list
tqdm file_name
file_name endswith
os path join path|file_name img_path
read_img img_path img_ori
img_path replace txt_path
os path exists txt_path
img_ori shape x_length
img_ori shape y_length
read_gt txt_path|x_length|y_length kp_list
network img out
get_md_output out _
list eulers_gt eulgt
enumerate euler_id|_
eulers_ori euler_id eulori
eulers_error_all euler_id append abs eulori-float eulgt euler_id
kp_list eye01
kp_list eye02
np sqrt np square abs eye01-eye02|np square abs eye01-eye02 eye_dis
range i
kp_list i kp_coord_gt
kp_coord_ori i kp_coord_model
np sqrt np square dis
kp_error_all i append dis
cur_error_list append dis
kp_ipn append sum cur_error_list|len cur_error_list|eye_dis
enumerate kps|_
kp_ave_error append % sum kp_error_all kps kp_error_all kps
enumerate eulers|_
euler_ave_error append % sum eulers_error_all eulers eulers_error_all eulers
elur_mae append  sum eulers_error_all eulers eulers_error_all eulers
print |str kp_ave_error
print |str euler_ave_error
print |str sum kp_ipn|len kp_ipn|100
print |str sum elur_mae|len elur_mae
parser parse_args arg
test_trains arg
out asnumpy astype np float32 out_eul eulers
out asnumpy astype np float32 heatmap i 1|48|48 map_1
list kp_scores append max_response
list kp_coord_ori append kp_coor
list kp_coord_ori i kp_coord_model
enumerate  [-1|-1]|[-1|-1]|[-1|-1]|[-1|-1]|[-1|-1] kp_list
heatmap i 1|48|48 map_1 argmax kp_coor
heatmap i 1|48|48 map_1 max max_response
softmax map_1 map_1 argmax kp_coor
softmax map_1 map_1 max max_response
open txt_path readline txt_line strip split eulers_txt
open txt_path readline txt_line strip split box_cur
 [-1|-1]|[-1|-1]|[-1|-1]|[-1|-1]|[-1|-1] kp_list eye01
 [-1|-1]|[-1|-1]|[-1|-1]|[-1|-1]|[-1|-1] kp_list eye02
 [-1|-1]|[-1|-1]|[-1|-1]|[-1|-1]|[-1|-1] kp_list i kp_coord_gt
-1 kp_id kp_id
kp_id|1 kp_id kp_id
cv2 imread img_path img_ori shape x_length
cv2 imread img_path img_ori shape y_length
cv2 cvtColor img_ori|cv2 COLOR_BGR2RGB img transpose 2|0|1 img
cv2 resize img|(96|96) img transpose 2|0|1 img
args pretrained model_path replace result_file
args pretrained model_path ckpt_path
open result_file epoch_result write(model_path|)
epoch_result model_path ckpt_path
FaceQABackbone network img out
load_checkpoint ckpt_path param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
load_param_into_net network img out
[||||] kp_error_all i append dis
[||] eulers_error_all euler_id append abs eulori-float eulgt euler_id
tqdm file_name endswith
os path join path|file_name img_path replace txt_path
read_img img_path img_ori shape x_length
read_img img_path img_ori shape y_length
read_gt txt_path|x_length|y_length kp_list eye01
read_gt txt_path|x_length|y_length kp_list eye02
read_gt txt_path|x_length|y_length kp_list i kp_coord_gt
 faceqa_1p_cfg
 faceqa_8p_cfg
super LOGGER|self __init__ logger_name
logging StreamHandler sys stdout console
console setLevel logging INFO
logging Formatter formatter
console setFormatter formatter
self addHandler console
local_rank self local_rank
os path exists log_dir
datetime now strftime log_name
os path join log_dir|log_name self log_fn
logging FileHandler self log_fn fh
fh setLevel logging INFO
fh setFormatter formatter
self addHandler fh
self _log logging INFO|msg|args|kwargs
self info
vars args args_dict
args_dict keys key
self info key|args_dict[key]
|line_width important_msg
|2 important_msg
self info important_msg|args|kwargs
LOGGER logger_name_1 logger
logger setup_logging_file path|rank
name self name
fmt self fmt
self reset
tb_writer self tb_writer
val self val
val|n self sum
n self count
self sum|self count self avg
self tb_writer add_scalar self name|self val|self cur_step
fmtstr format self __dict__
logging StreamHandler sys stdout console setLevel logging INFO
logging StreamHandler sys stdout console setFormatter formatter
logging FileHandler self log_fn fh setLevel logging INFO
logging FileHandler self log_fn fh setFormatter formatter
vars args args_dict keys key
LOGGER logger_name_1 logger setup_logging_file path|rank
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step learning_rate
args lr base_lr
int args max_epochargs steps_per_epoch total_steps
int args warmup_epochsargs steps_per_epoch warmup_steps
args lr_epochs milestones
milestones milestone
milestoneargs steps_per_epoch milestones_step
milestones_steps append milestones_step
base_lr lr
Counter milestones_steps milestones_steps_counter
range i
linear_warmup_learning_rate i|warmup_steps|base_lr|warmup_init_lr lr
lr|gammamilestones_steps_counter[i] lr
args lr base_lr lr
args lr_epochs milestones milestone
base_lr lr lr
linear_warmup_learning_rate i|warmup_steps|base_lr|warmup_init_lr lr lr
lr|gammamilestones_steps_counter[i] lr lr
warnings filterwarnings
(96|96) img_shape
imlist self imlist
img_shape self img_shape
heatmap_shape self heatmap_shape
open imlist
fr readlines self imgs_info
list map float|landmark landmark
np array landmark reshape (5|2) landmark
enumerate _|cor
cor y
-1 heatmap_label
float x|float(x_length)|96  x
float y|float(y_length)|96  y
int x|1 0|self heatmap_shape|self img_shape x_out
int y|1 0|self heatmap_shape|self img_shape y_out
y_out|self heatmap_shape|x_out heatmap_label
landmark_class_label append heatmap_label
len self imgs_info
self imgs_info idx path_label_info
path_label_info impath
Image open impath convert image
image size x_length
image size y_length
image resize (96|96) image
self _trans_cor path_label_info|x_length|y_length landmarks
np array [e|90 foreinlist map float|path_label_info] eulers
image sample
dataset self dataset
rank self rank
group_size self group_size
len self dataset self dataset_length
int math ceil self dataset_length|1 0|self group_size self num_samples
self num_samples|self group_size self total_size
shuffle self shuffle
seed self seed
(self seed|1) self seed
np random seed self seed
np random permutation self dataset_length tolist indices
list range len self dataset classes indices
iter indices
F2 Compose [F ToTensor] transform_img
MdFaceDataset imlist dataset
DistributedSampler dataset|local_rank|world_size sampler
(96|96) img_shape self img_shape
enumerate cor y
int y|1 0|self heatmap_shape|self img_shape y_out heatmap_shape|x_out heatmap_label
self imgs_info idx path_label_info impath
Image open impath convert image size x_length
Image open impath convert image size y_length
Image open impath convert image resize (96|96) image
Image open impath convert image sample
super CEWithIgnoreIndex3D|self __init__
P Exp self exp
P ReduceSum self sum
P Reshape self reshape
P Log self log
P Cast self cast
Tensor eps|dtype self eps_const
P OnesLike self ones
P OneHot self onehot
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
P ReLU self relu
P Maximum self maximum
self reshape label|(F shape label) mask
self cast mask|mstype float32 mask
mask|F scalar_to_array mask
self relu mask|(mask) mask
logit|mask logit
self exp logit exp
self sum exp|-1 exp_sum
self reshape exp_sum|(F shape exp_sum) exp_sum
self log exp|exp_sum|self eps_const softmax_result
self onehot one_hot_label
self sum loss|-1 loss
self sum loss|0 loss
super CriterionsFaceQA|self __init__
P GatherV2 self gatherv2
P Shape self shape
Tensor [0|1|2]|dtype self euler_label_list
Tensor [3|4|5|6|7]|dtype self kp_label_list
CEWithIgnoreIndex3D self kps_loss
self gatherv2 label|self euler_label_list|1 euler_label
self mse_loss x1|euler_label loss_euler
self shape x2 _
self reshape x2|(b|5|48|48) x2
self gatherv2 label|self kp_label_list|1 kps_label
self kps_loss x2|kps_label loss_kps
(loss_kps|loss_euler)|b loss_tot
self reshape label|(F shape label) mask scalar_to_array mask
self reshape label|(F shape label) mask logit
self cast mask|mstype float32 mask scalar_to_array mask
self cast mask|mstype float32 mask logit
mask|F scalar_to_array mask scalar_to_array mask
mask|F scalar_to_array mask logit
self relu mask|(mask) mask logit
logit|mask logit logit
self sum loss|-1 loss loss_tot
self sum loss|0 loss loss_tot
self mse_loss x1|euler_label loss_euler loss_tot
self kps_loss x2|kps_label loss_kps loss_tot
Dense input_channels|out_channels
super Block1|self __init__
bn_with_initialize self bk1_bn0
P ReLU self bk1_relu0
bn_with_initialize self bk1_bn1
bn_with_initialize self bk1_bn2
P ReLU self bk1_relu1
bn_with_initialize self bk1_bn3
P ReLU self bk1_relu3
bn_with_initialize self bk1_bn4
P ReLU self bk1_relu4
P Cast self cast
TensorAdd self add
x identity
self bk1_conv0 x out
self bk1_bn0 out out
self bk1_relu0 out out
self bk1_conv1 out out
self bk1_bn1 out out
self bk1_conv2 identity identity
self bk1_bn2 identity identity
self add out|identity out
self bk1_relu1 out out
out identity
self bk1_conv3 out out
self bk1_bn3 out out
self bk1_relu3 out out
self bk1_conv4 out out
self bk1_bn4 out out
self bk1_relu4 out out
super Block2|self __init__
bn_with_initialize self bk2_bn0
P ReLU self bk2_relu0
bn_with_initialize self bk2_bn1
bn_with_initialize self bk2_bn2
P ReLU self bk2_relu1
bn_with_initialize self bk2_bn3
P ReLU self bk2_relu3
bn_with_initialize self bk2_bn4
P ReLU self bk2_relu4
self bk2_conv0 x out
self bk2_bn0 out out
self bk2_relu0 out out
self bk2_conv1 out out
self bk2_bn1 out out
self bk2_conv2 identity identity
self bk2_bn2 identity identity
self bk2_relu1 out out
self bk2_conv3 out out
self bk2_bn3 out out
self bk2_relu3 out out
self bk2_conv4 out out
self bk2_bn4 out out
self bk2_relu4 out out
super FaceQABackbone|self __init__
P Shape self shape
P Reshape self reshape
bn_with_initialize self bn0
P ReLU self relu0
bn_with_initialize self bn1
P ReLU self relu1
 self backbone
bn_with_initialize self euler_bn
P ReLU self euler_relu
fc_with_initialize 128|6|6|256 self euler_fc1
P ReLU self euler_relu1
fc_with_initialize 256|128 self euler_fc2
P ReLU self euler_relu2
fc_with_initialize 128|3 self euler_fc3
self conv0 x x
self bn0 x x
self relu0 x x
self conv1 x x
self bn1 x x
self relu1 x x
self backbone x x
self euler_conv x out1
self euler_bn out1 out1
self euler_relu out1 out1
self shape out1 _
self reshape out1|(b|-1) out1
self euler_fc1 out1 out1
self euler_relu1 out1 out1
self euler_fc2 out1 out1
self euler_relu2 out1 out1
self euler_fc3 out1 out1
self kps_deconv x out2
self kps_up out2 out2
super BuildTrainNetwork|self __init__
network self network
criterion self criterion
self network input_data out_kps
self criterion out_eul|out_kps|label loss
Dense out identity
Dense  self backbone
self bk1_conv0 x out identity
self bk1_bn0 out out identity
self bk1_relu0 out out identity
self bk1_conv1 out out identity
self bk1_bn1 out out identity
self add out|identity out identity
self bk1_relu1 out out identity
int os getenv devid
get_resnet18 args network
args model_path ckpt_path
os path isfile ckpt_path
load_checkpoint ckpt_path param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
Tensor input_data tensor_input_data
parser parse_args args_opt
parse_args args_1
config dst_h args_1 dst_h
config dst_w args_1 dst_w
config attri_num args_1 attri_num
config classes args_1 classes
config flat_dim args_1 flat_dim
config fc_dim args_1 fc_dim
main args_1
load_checkpoint ckpt_path param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
int os getenv devid
super BuildTrainNetwork|self __init__
network self network
criterion self criterion
P Print self print
self network input_data logit2
self criterion logit0|logit1|logit2|label loss
argparse ArgumentParser parser
parser parse_known_args _
parse_args args
get_rank args local_rank
get_group_size args world_size
config per_batch_size args per_batch_size
config dst_h args dst_h
config dst_w args dst_w
config workers args workers
config attri_num args attri_num
config classes args classes
config backbone args backbone
config loss_scale args loss_scale
config flat_dim args flat_dim
config fc_dim args fc_dim
config lr args lr
config lr_scale args lr_scale
config lr_epochs args lr_epochs
config weight_decay args weight_decay
config momentum args momentum
config max_epoch args max_epoch
config warmup_epochs args warmup_epochs
config log_interval args log_interval
config ckpt_path args ckpt_path
args lr|4  args lr
ParallelMode DATA_PARALLEL parallel_mode
ParallelMode STAND_ALONE parallel_mode
context reset_auto_parallel_context
os path join args ckpt_path|datetime datetime now strftime args outputs_dir
get_logger args outputs_dir|args local_rank args logger
AverageMeter loss_meter
args logger info
data_generator args num_classes
steps_per_epoch args steps_per_epoch
num_classes args num_classes
args logger save_args args
args logger important_info
time time create_network_start
get_resnet18 args network
get_loss criterion
os path isfile args pretrained
load_checkpoint args pretrained param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
args logger info  format args pretrained
lr learning_rate
args momentum momentum
args weight_decay weight_decay
BuildTrainNetwork network|criterion train_net
TrainOneStepCell train_net|opt|sens train_net
args max_epoch ckpt_max_num
CheckpointConfig save_checkpoint_steps train_config
_InternalCallbackParam cb_params
train_net cb_params train_network
ckpt_max_num cb_params epoch_num
RunContext cb_params run_context
ckpt_cb begin run_context
train_net set_train
time time t_end
time time t_epoch
-1 old_progress
Tensor data|dtype data_tensor
Tensor gt_classes|dtype gt_tensor
train_net data_tensor|gt_tensor loss
loss_meter update loss asnumpy
i|1 cb_params cur_step_num
i|2 cb_params batch_num
ckpt_cb step_end run_context
time time-create_network_start time_for_graph_compile
time time-t_end time_used
int i|args steps_per_epoch epoch
args per_batch_size|(i-old_progress)args world_size|time_used fps
args logger info  format epoch|i|loss_meter|fps
loss_meter reset
i old_progress
time time-t_epoch epoch_time_used
args per_batch_sizeargs world_sizeargs steps_per_epoch|epoch_time_used fps
args logger info  format epoch|i|fps
argparse ArgumentParser parser parse_known_args _
parse_args args lr|4  args lr
parse_args args logger info
parse_args args logger save_args args
parse_args args logger important_info
parse_args args logger info  format args pretrained
parse_args args momentum momentum
parse_args args weight_decay weight_decay
parse_args args max_epoch ckpt_max_num
parse_args args per_batch_size|(i-old_progress)args world_size|time_used fps
parse_args args logger info  format epoch|i|loss_meter|fps
parse_args args per_batch_sizeargs world_sizeargs steps_per_epoch|epoch_time_used fps
parse_args args logger info  format epoch|i|fps
config classes args classes gt_tensor
config lr args lr learning_rate
args lr|4  args lr learning_rate
AverageMeter loss_meter update loss asnumpy
AverageMeter loss_meter reset
data_generator args num_classes args num_classes
load_checkpoint args pretrained param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
BuildTrainNetwork network|criterion train_net train_net
BuildTrainNetwork network|criterion train_net cb_params train_network
BuildTrainNetwork network|criterion train_net set_train
BuildTrainNetwork network|criterion train_net data_tensor|gt_tensor loss
TrainOneStepCell train_net|opt|sens train_net train_net
TrainOneStepCell train_net|opt|sens train_net cb_params train_network
TrainOneStepCell train_net|opt|sens train_net set_train
TrainOneStepCell train_net|opt|sens train_net data_tensor|gt_tensor loss
args max_epoch ckpt_max_num cb_params epoch_num
args logger info  format loss_meter reset
args logger info  format i old_progress
int os getenv devid
get_resnet18 args network
args model_path ckpt_path
os path isfile ckpt_path
load_checkpoint ckpt_path param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
network set_train False
data_generator_eval args _
print  format step_i|1|steps_per_epoch
Tensor data|dtype data_tensor
network data_tensor fea
gt_classes gt_mask
fea mask_result
age_result asnumpy age_result_np
gen_result asnumpy gen_result_np
mask_result asnumpy mask_result_np
softmax age_result_np astype np float32 tolist age_prob
softmax gen_result_np astype np float32 tolist gen_prob
softmax mask_result_np astype np float32 tolist mask_prob
age_prob index max age_prob age
gen_prob index max gen_prob gen
mask_prob index max mask_prob mask
float age_num|float(total_data_num_age) age_accuracy
float gen_tp_num|(float(gen_tp_num)|float(gen_fp_num)) gen_precision
float gen_tp_num|(float(gen_tp_num)|float(gen_fn_num)) gen_recall
float gen_num|float(total_data_num_gen) gen_accuracy
float mask_tp_num|(float(mask_tp_num)|float(mask_fp_num)) mask_precision
float mask_tp_num|(float(mask_tp_num)|float(mask_fn_num)) mask_recall
float mask_num|float(total_data_num_mask) mask_accuracy
print ckpt_path
print total_data_num_age
print total_data_num_gen
print total_data_num_mask
print age_accuracy
print gen_accuracy
print mask_accuracy
print gen_precision
print gen_recall
print gen_f1
print mask_precision
print mask_recall
print mask_f1
os path basename ckpt_path split model_name
os path dirname ckpt_path model_dir
os path join model_dir|model_name| result_txt
os path exists result_txt
os remove result_txt
open result_txt|
ft write  format ckpt_path
ft write  format total_data_num_age
ft write  format total_data_num_gen
ft write  format total_data_num_mask
ft write  format age_accuracy
ft write  format gen_accuracy
ft write  format mask_accuracy
ft write  format gen_precision
ft write  format gen_recall
ft write  format gen_f1
ft write  format mask_precision
ft write  format mask_recall
ft write  format mask_f1
parser parse_args args_opt
parse_args args_1
config dst_h args_1 dst_h
config dst_w args_1 dst_w
config attri_num args_1 attri_num
config classes args_1 classes
config flat_dim args_1 flat_dim
config fc_dim args_1 fc_dim
config workers args_1 workers
main args_1
get_resnet18 args network set_train False
get_resnet18 args network data_tensor fea
load_checkpoint ckpt_path param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
load_param_into_net network set_train False
load_param_into_net network data_tensor fea
network data_tensor fea mask_result
fea mask_result asnumpy mask_result_np
softmax age_result_np astype np float32 tolist age_prob index max age_prob age
softmax gen_result_np astype np float32 tolist gen_prob index max gen_prob gen
softmax mask_result_np astype np float32 tolist mask_prob index max mask_prob mask
super LOGGER|self __init__ logger_name
logging StreamHandler sys stdout console
console setLevel logging INFO
logging Formatter formatter
console setFormatter formatter
self addHandler console
local_rank self local_rank
os path exists log_dir
datetime now strftime log_name
os path join log_dir|log_name self log_fn
logging FileHandler self log_fn fh
fh setLevel logging INFO
fh setFormatter formatter
self addHandler fh
self _log logging INFO|msg|args|kwargs
self info
vars args args_dict
args_dict keys key
self info key|args_dict[key]
|line_width important_msg
|2 important_msg
self info important_msg|args|kwargs
LOGGER logger_name_1 logger
logger setup_logging_file path|rank
name self name
fmt self fmt
self reset
tb_writer self tb_writer
val self val
val|n self sum
n self count
self sum|self count self avg
self tb_writer add_scalar self name|self val|self cur_step
fmtstr format self __dict__
logging StreamHandler sys stdout console setLevel logging INFO
logging StreamHandler sys stdout console setFormatter formatter
logging FileHandler self log_fn fh setLevel logging INFO
logging FileHandler self log_fn fh setFormatter formatter
vars args args_dict keys key
LOGGER logger_name_1 logger setup_logging_file path|rank
config eval_dataset_txt_file dataset_txt_file
config eval_mindrecord_file_name mindrecord_file_name
FileWriter mindrecord_file_name|mindrecord_num writer
fmtstr format self __dict__
open dataset_txt_file|
ft readlines lines
lines line
line strip split sline
sline image_file
sline item
labels append int item
open image_file|
f read img
total_data append data
writer add_schema attri_json|
writer write_raw_data total_data
writer commit
FileWriter mindrecord_file_name|mindrecord_num writer add_schema attri_json|
FileWriter mindrecord_file_name|mindrecord_num writer write_raw_data total_data
FileWriter mindrecord_file_name|mindrecord_num writer commit
ft readlines lines line
lines line strip split sline
line strip split sline image_file
line strip split sline item
 config
args mindrecord_path mindrecord_path
args dst_w dst_w
args dst_h dst_h
args attri_num attri_num
F Resize (dst_w|dst_h)
F ToTensor
de MindDataset mindrecord_path|columns_list de_dataset
de_dataset batch batch_size de_dataset
de_dataset get_dataset_size steps_per_epoch
print  format steps_per_epoch
attri_num num_classes
args attri_num attri_num num_classes
de MindDataset mindrecord_path|columns_list de_dataset batch batch_size de_dataset
de MindDataset mindrecord_path|columns_list de_dataset get_dataset_size steps_per_epoch
args mindrecord_path mindrecord_path
args dst_w dst_w
args dst_h dst_h
args per_batch_size batch_size
args attri_num attri_num
args max_epoch max_epoch
F Resize (dst_w|dst_h)
F ToTensor
de_dataset get_dataset_size steps_per_epoch
de_dataset repeat max_epoch de_dataset
attri_num num_classes
args attri_num attri_num num_classes
config train_dataset_txt_file dataset_txt_file
config train_mindrecord_file_name mindrecord_file_name
FileWriter mindrecord_file_name|mindrecord_num writer
F ToTensor
open dataset_txt_file|
ft readlines lines
lines line
line strip split sline
sline image_file
sline item
labels append int item
open image_file|
f read img
total_data append data
writer add_schema attri_json|
writer write_raw_data total_data
writer commit
FileWriter mindrecord_file_name|mindrecord_num writer add_schema attri_json|
FileWriter mindrecord_file_name|mindrecord_num writer write_raw_data total_data
FileWriter mindrecord_file_name|mindrecord_num writer commit
ft readlines lines line
lines line strip split sline
line strip split sline image_file
line strip split sline item
config train_append_dataset_txt_file dataset_txt_file
config train_append_mindrecord_file_name mindrecord_file_name
writer commit
FileWriter open_for_append mindrecord_file_name writer
open dataset_txt_file|
ft readlines lines
lines line
line strip split sline
sline image_file
sline item
labels append int item
open image_file|
f read img
total_data append data
writer write_raw_data total_data
FileWriter open_for_append mindrecord_file_name writer write_raw_data total_data
ft readlines lines line
lines line strip split sline
line strip split sline image_file
line strip split sline item
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step learning_rate
args lr base_lr
int args max_epochargs steps_per_epoch total_steps
int args warmup_epochsargs steps_per_epoch warmup_steps
args lr_epochs milestones
milestones milestone
milestoneargs steps_per_epoch milestones_step
milestones_steps append milestones_step
base_lr lr
Counter milestones_steps milestones_steps_counter
range i
linear_warmup_learning_rate i|warmup_steps|base_lr|warmup_init_lr lr
lr|gammamilestones_steps_counter[i] lr
args lr base_lr lr
args lr_epochs milestones milestone
base_lr lr lr
linear_warmup_learning_rate i|warmup_steps|base_lr|warmup_init_lr lr lr
lr|gammamilestones_steps_counter[i] lr lr
super IRBlock|self __init__
conv3x3 inplanes|planes|stride self conv1
bn_with_initialize planes self bn1
P ReLU self relu1
bn_with_initialize planes self bn2
Cut self downsample
downsample self downsample
TensorAdd self add
P Cast self cast
P ReLU self relu2
self conv1 x out
self bn1 out out
self relu1 out out
self conv2 out out
self bn2 out out
self downsample x identity
self add out|identity out
self relu2 out out
super DownSample|self __init__
bn_with_initialize planes|expansion self bn1
super MakeLayer|self __init__
inplanes self inplanes
DownSample self inplanes|planes|block expansion|stride self downsample
self layers append block self inplanes|planes|stride|self downsample
planes self inplanes
range _
self layers append block self inplanes|planes
nn CellList self layers self layers
self layers block
block x x
super AttriResNet|self __init__
bn_with_initialize self inplanes self bn1
P ReLU self relu
P Shape self shape
P Reshape self reshape
get_attri_head flat_dim|fc_dim|attri_num_list self head
self conv1 x x
self bn1 x x
self relu x x
self layer1 x x
self layer2 x x
self layer3 x x
self layer4 x x
self mean x|(2|3) x
self shape x _
self reshape x|(b|c) x
self head x
args flat_dim flat_dim
args fc_dim fc_dim
args classes strip split str_classes
enumerate i|_
attri_num_list append int str_classes i
AttriResNet IRBlock|(2|2|2|2) attri_resnet18
Cut self downsample self downsample
self layers block x x
super CriterionsFaceAttri|self __init__
P GatherV2 self gatherv2
P Cast self cast
P Reshape self reshape
P ReduceMean self mean
Tensor |dtype self label0_param
Tensor |dtype self label1_param
Tensor |dtype self label2_param
CrossEntropyWithIgnoreIndex self ce_ignore_loss
P Print self printn
self squeeze self gatherv2 label|self label0_param|1 label0
self ce_ignore_loss x0|label0 loss0
self squeeze self gatherv2 label|self label1_param|1 label1
self ce_ignore_loss x1|label1 loss1
self squeeze self gatherv2 label|self label2_param|1 label2
self ce_ignore_loss x2|label2 loss2
loss0|loss1|loss2 loss
self ce_ignore_loss x0|label0 loss0 loss
self ce_ignore_loss x1|label1 loss1 loss
self ce_ignore_loss x2|label2 loss2 loss
loss0|loss1|loss2 loss loss
super CrossEntropyWithIgnoreIndex|self __init__
P OneHot self onehot
Tensor 1 0|dtype self on_value
Tensor 0 0|dtype self off_value
P Cast self cast
nn SoftmaxCrossEntropyWithLogits self ce
P Greater self greater
P Maximum self maximum
P Fill self fill
P DType self dtype
P ReLU self relu
P Reshape self reshape
Tensor np ones|dtype self const_one
Tensor 0 00001|dtype self const_eps
self reshape label|(F shape label) mask
self cast mask|mstype float32 mask
mask|self const_eps mask
self relu mask|mask mask
x|mask x
self onehot self cast label|mstype int32 one_hot_label
self ce x|one_hot_label loss
self maximum positive|self const_one positive
self sum loss|0|positive loss
self reshape label|(F shape label) mask const_eps mask
self reshape label|(F shape label) mask x
self cast mask|mstype float32 mask const_eps mask
self cast mask|mstype float32 mask x
mask|self const_eps mask const_eps mask
mask|self const_eps mask x
self relu mask|mask mask x
x|mask x x
super IRBlock|self __init__
conv3x3 inplanes|planes|stride self conv1
bn_with_initialize planes self bn1
P ReLU self relu1
bn_with_initialize planes self bn2
Cut self downsample
downsample self downsample
TensorAdd self add
P Cast self cast
P ReLU self relu2
self conv1 x out
self bn1 out out
self relu1 out out
self conv2 out out
self bn2 out out
self downsample x identity
self add out|identity out
self relu2 out out
super DownSample|self __init__
bn_with_initialize planes|expansion self bn1
super MakeLayer|self __init__
inplanes self inplanes
DownSample self inplanes|planes|block expansion|stride self downsample
self layers append block self inplanes|planes|stride|self downsample
planes self inplanes
range _
self layers append block self inplanes|planes
nn CellList self layers self layers
self layers block
block x x
super AttriResNet|self __init__
bn_with_initialize self inplanes self bn1
P ReLU self relu
P Shape self shape
P Reshape self reshape
get_attri_head flat_dim|fc_dim|attri_num_list self head
self conv1 x x
self bn1 x x
self relu x x
self layer1 x x
self layer2 x x
self layer3 x x
self layer4 x x
self mean x|(2|3) x
self shape x _
self reshape x|(b|c) x
self head x
args flat_dim flat_dim
args fc_dim fc_dim
args classes strip split str_classes
enumerate i|_
attri_num_list append int str_classes i
AttriResNet IRBlock|(2|2|2|2) attri_resnet18
Cut self downsample self downsample
self layers block x x
super AttriHead|self __init__
fc_with_initialize flat_dim|fc_dim self fc1
P ReLU self fc1_relu
fc_with_initialize fc_dim|attri_num_list self attri_fc1
P ReLU self attri_fc1_relu
fc_with_initialize flat_dim|fc_dim self fc2
P ReLU self fc2_relu
fc_with_initialize fc_dim|attri_num_list self attri_fc2
P ReLU self attri_fc2_relu
fc_with_initialize flat_dim|fc_dim self fc3
P ReLU self fc3_relu
fc_with_initialize fc_dim|attri_num_list self attri_fc3
P ReLU self attri_fc3_relu
self fc1 x output0
self fc1_relu output0 output0
self fc1_bn output0 output0
self attri_fc1 output0 output0
self attri_fc1_relu output0 output0
self attri_bn1 output0 output0
self fc2 x output1
self fc2_relu output1 output1
self fc2_bn output1 output1
self attri_fc2 output1 output1
self attri_fc2_relu output1 output1
self attri_bn2 output1 output1
self fc3 x output2
self fc3_relu output2 output2
self fc3_bn output2 output2
self attri_fc3 output2 output2
self attri_fc3_relu output2 output2
self attri_bn3 output2 output2
AttriHead flat_dim|fc_dim|attri_num_list attri_head
Dense input_channels|out_channels
super AttriHead|self __init__
fc_with_initialize flat_dim|fc_dim self fc1
P ReLU self fc1_relu
fc_with_initialize fc_dim|attri_num_list self attri_fc1
P ReLU self attri_fc1_relu
P Softmax self softmax1
fc_with_initialize flat_dim|fc_dim self fc2
P ReLU self fc2_relu
fc_with_initialize fc_dim|attri_num_list self attri_fc2
P ReLU self attri_fc2_relu
P Softmax self softmax2
fc_with_initialize flat_dim|fc_dim self fc3
P ReLU self fc3_relu
fc_with_initialize fc_dim|attri_num_list self attri_fc3
P ReLU self attri_fc3_relu
P Softmax self softmax3
self fc1 x output0
self fc1_relu output0 output0
self fc1_bn output0 output0
self attri_fc1 output0 output0
self attri_fc1_relu output0 output0
self attri_bn1 output0 output0
self softmax1 output0 output0
self fc2 x output1
self fc2_relu output1 output1
self fc2_bn output1 output1
self attri_fc2 output1 output1
self attri_fc2_relu output1 output1
self attri_bn2 output1 output1
self softmax2 output1 output1
self fc3 x output2
self fc3_relu output2 output2
self fc3_bn output2 output2
self attri_fc3 output2 output2
self attri_fc3_relu output2 output2
self attri_bn3 output2 output2
self softmax3 output2 output2
AttriHead flat_dim|fc_dim|attri_num_list attri_head
SSD300 ssd_ghostnet|config|kwargs
NotImplementedError f
parser parse_args args_opt
args_opt device_num device_num
context reset_auto_parallel_context
args_opt device_id%device_num rank
config mindrecord_dir mindrecord_dir
os path join mindrecord_dir|prefix| mindrecord_file
os path exists mindrecord_file
os path isdir mindrecord_dir
os makedirs mindrecord_dir
os path isdir config coco_root
data_to_mindrecord_byte_image True|prefix
print  format mindrecord_dir
os path isdir config voc_dir
voc_data_to_mindrecord mindrecord_dir|True|prefix
os path isdir config image_dirandos path exists config anno_path
float args_opt loss_scale loss_scale
dataset get_dataset_size dataset_size
ssd_ghostnet backbone
SSD300 backbone ssd
SSDWithLossCell ssd|config net
init_net_param net
CheckpointConfig ckpt_config
ModelCheckpoint ckpoint_cb
load_checkpoint args_opt pre_trained param_dict
filter_checkpoint_parameter param_dict
load_param_into_net net|param_dict
config lr_init|lr_end lr_init
config warmup_epochs warmup_epochs
args_opt epoch_size total_epochs
TrainingWrapper net|opt|loss_scale net
Model net model
parser parse_args args_opt device_num device_num
parser parse_args args_opt device_id%device_num rank
parser parse_args args_opt epoch_size total_epochs
create_ssd_dataset ds
load_param_into_net net|param_dict
load_checkpoint ckpt_path param_dict
net init_parameters_data
net set_train False
batch_size i
ds get_dataset_size|batch_size total
time time start
print total
ds create_dict_iterator data
data img_id
data img_np
data image_shape
net Tensor img_np output
range batch_idx
output asnumpy
int np squeeze img_id batch_idx
round i|total|100 |2 percent
int (time time-start)|1000 cost_time
metrics pred_data mAP
print f
parser parse_args args_opt
config mindrecord_dir mindrecord_dir
os path join mindrecord_dir|prefix| mindrecord_file
config voc_root config coco_root
os path exists mindrecord_file
os path isdir mindrecord_dir
os makedirs mindrecord_dir
os path isdir config coco_root
data_to_mindrecord_byte_image False|prefix
print  format mindrecord_dir
os path isdir config voc_dirandos path isdir config voc_root
voc_data_to_mindrecord mindrecord_dir|False|prefix
os path isdir config image_dirandos path exists config anno_path
ssd_eval mindrecord_file|args_opt checkpoint_path
create_ssd_dataset ds get_dataset_size|batch_size total
create_ssd_dataset ds create_dict_iterator data
load_param_into_net net init_parameters_data
load_param_into_net net set_train False
load_param_into_net net Tensor img_np output
ds create_dict_iterator data img_id
ds create_dict_iterator data img_np
ds create_dict_iterator data image_shape
net Tensor img_np output asnumpy
global_step int
lr_init float
lr_end float
lr_max float
warmup_epochs float
total_epochs int
steps_per_epoch int
steps_per_epoch|total_epochs total_steps
steps_per_epoch|warmup_epochs warmup_steps
range i
lr_init|(lr_max-lr_init)|i|warmup_steps lr
lr_end| lr
lr_each_step append lr
global_step current_step
np array lr_each_step astype np float32 lr_each_step
lr_each_step learning_rate
steps_per_epoch|warmup_epochs warmup_steps lr
range i lr
np array lr_each_step astype np float32 lr_each_step learning_rate
network trainable_params params
params p
net parameters_and_names _|param
param name replace param_name
param_name split name_split
param_name replace param_name
param set_parameter_data param_dict param_name data
list key
network trainable_params params p
net parameters_and_names param name replace param_name
net parameters_and_names param set_parameter_data param_dict param_name data
param name replace param_name split name_split
param name replace param_name replace param_name
 config
[(2|)|(2|3)|(2|3)|(2|3)|(2|3)|(2|3)
all_boxes y1
all_boxes x1
all_boxes y2
all_boxes x2
(x2-x1|1)|(y2-y1|1) areas
all_scores argsort order
order i
keep append i
np maximum x1 i]|x1[order xx1
np maximum y1 i]|y1[order yy1
np minimum x2 i]|x2[order xx2
np minimum y2 i]|y2[order yy2
np maximum 0 0|xx2-xx1|1 w
np maximum 0 0|yy2-yy1|1 h
w|h inter
inter|(areas-inter) ovr
np where ovr inds
config num_classes num_classes
config coco_root coco_root
config val_data_type data_type
config coco_classes val_cls
enumerate i|cls
cls val_cls_dict i
os path join coco_root|config instances_set format data_type anno_json
COCO anno_json coco_gt
coco_gt loadCats coco_gt getCatIds cat_ids
cat_ids cat
pred_data sample
sample pred_boxes
sample box_scores
sample img_id
sample w
ssd_bboxes_decode pred_boxes pred_boxes
img_ids append img_id
range c
box_scores class_box_scores
class_box_scores score_mask
class_box_scores score_mask class_box_scores
pred_boxes score_mask]|[h|w|h|w class_boxes
score_mask any
apply_nms nms_index
class_boxes nms_index class_boxes
class_box_scores nms_index class_box_scores
class_boxes tolist final_boxes
class_box_scores tolist final_score
 classs_dict val_cls_dict c final_label
len class_box_scores
zip loc|label|score
img_id res
[loc|loc|loc-loc|loc-loc] res
score res
label res
predictions append res
json dump predictions|f
coco_gt loadRes coco_dt
img_ids E params imgIds
E evaluate
E accumulate
E summarize
all_boxes y1 areas
all_boxes x1 areas
all_scores argsort order i
np maximum 0 0|xx2-xx1|1 w inter
np maximum 0 0|yy2-yy1|1 h inter
w|h inter ovr
enumerate cls val_cls_dict i
enumerate  classs_dict val_cls_dict c final_label
COCO anno_json coco_gt loadCats coco_gt getCatIds cat_ids
COCO anno_json coco_gt loadRes coco_dt
coco_gt loadCats coco_gt getCatIds cat_ids cat
pred_data sample pred_boxes
pred_data sample box_scores
pred_data sample img_id
pred_data sample w
sample pred_boxes score_mask]|[h|w|h|w class_boxes
sample box_scores class_box_scores
sample img_id res
ssd_bboxes_decode pred_boxes pred_boxes score_mask]|[h|w|h|w class_boxes
img_ids append img_id res
range c res
box_scores class_box_scores score_mask
box_scores class_box_scores score_mask class_box_scores
box_scores class_box_scores nms_index class_box_scores
box_scores class_box_scores tolist final_score
class_box_scores score_mask any
pred_boxes score_mask]|[h|w|h|w class_boxes nms_index class_boxes
pred_boxes score_mask]|[h|w|h|w class_boxes tolist final_boxes
zip score res
zip label res
config img_shape|np array(config steps) fk
(config max_scale-config min_scale)| scale_rate
 len config num_default-1
enumerate idex|feature_size
scales idex sk1
scales sk2
math sqrt sk1|sk2 sk3
sk1|math sqrt|sk1|math sqrt h
[ 0 1|0 1] all_sizes
[ sk1|sk1] all_sizes
config aspect_ratios aspect_ratio
sk1|math sqrt aspect_ratio h
math sqrt aspect_ratio
all_sizes append (w|h)
all_sizes append (h|w)
all_sizes append (sk3|sk3)
all_sizes w|h
(j|0 5)|fk cy
self default_boxes append [cy|cx|h|w]
np array self default_boxes_ltrb
GeneratDefaultBoxes default_boxes_ltrb default_boxes_ltrb
GeneratDefaultBoxes default_boxes default_boxes
np split default_boxes_ltrb|4|axis x2
(x2-x1)|(y2-y1) vol_anchors
config match_thershold matching_threshold
np maximum y1|bbox ymin
np maximum x1|bbox xmin
np minimum y2|bbox ymax
np minimum x2|bbox xmax
np maximum xmax-xmin|0  w
np maximum ymax-ymin|0  h
h|w inter_vol
vol_anchors| union_vol
inter_vol|union_vol jaccard
np squeeze jaccard
np zeros (config num_ssd_boxes) pre_scores
np zeros (config num_ssd_boxes|4) t_boxes
np zeros (config num_ssd_boxes) t_label
boxes bbox
int bbox label
jaccard_with_anchors bbox scores
np argmax scores idx
(scores) mask
np maximum pre_scores|scores|mask pre_scores
mask|label|(1-mask)|t_label t_label
range i
np nonzero t_label index
np zeros (config num_ssd_boxes|4) bboxes
bboxes index bboxes_t
default_boxes index default_boxes_t
np log bboxes_t
bboxes_t bboxes index
([len(np nonzero t_label)]|dtype num_match
t_label astype np int32
boxes copy boxes_t
default_boxes copy default_boxes_t
np exp boxes_t
np zeros (len(boxes_t)) bboxes
np clip bboxes|0|1
np minimum box_a|box_b max_yx
np maximum box_a|box_b min_yx
intersect box_a|box_b inter
area_a|area_b-inter union
scales idex sk1 sqrt|sk1|math sqrt h
scales idex sk1 sqrt aspect_ratio h
sk1|math sqrt|sk1|math sqrt h inter_vol
[ 0 1|0 1] all_sizes append (w|h)
[ 0 1|0 1] all_sizes append (h|w)
[ 0 1|0 1] all_sizes append (sk3|sk3)
[ 0 1|0 1] all_sizes w|h
[ sk1|sk1] all_sizes append (w|h)
[ sk1|sk1] all_sizes append (h|w)
[ sk1|sk1] all_sizes append (sk3|sk3)
[ sk1|sk1] all_sizes w|h
sk1|math sqrt aspect_ratio h inter_vol
self default_boxes append h|w inter_vol
GeneratDefaultBoxes default_boxes default_boxes index default_boxes_t
GeneratDefaultBoxes default_boxes default_boxes copy default_boxes_t
(x2-x1)|(y2-y1) vol_anchors union_vol
np maximum xmax-xmin|0  w inter_vol
np maximum ymax-ymin|0  h inter_vol
h|w inter_vol jaccard
vol_anchors| union_vol jaccard
np zeros (config num_ssd_boxes) t_label t_label
np zeros (config num_ssd_boxes) t_label astype np int32
int bbox label t_label
(scores) mask t_label
mask|label|(1-mask)|t_label t_label t_label
mask|label|(1-mask)|t_label t_label astype np int32
np zeros (config num_ssd_boxes|4) bboxes index bboxes_t
bboxes index bboxes_t bboxes index
np log bboxes_t bboxes index
np random rand|(b-a)
os path splitext filename filename
int filename
image shape _
np random choice [None|0 1|0 3|0 5|0 7|0 9] min_iou
range _
image image_t
_rand 0 3|1 0|width w
_rand 0 3|1 0|height h
_rand|(width-w) left
_rand|(height-h) top
np array rect
jaccard_numpy boxes|rect overlap
overlap drop_mask
drop_mask any
overlap drop_mask min<min_iouandoverlap[drop_mask] max>(min_iou|0 2)
(boxes)|2 0 centers
(rect) m1
(rect) m2
m1|m2|drop_mask mask
mask any
boxes copy boxes_t
input_shape input_w
cv2 resize image|(input_w|input_h) image
np expand_dims image|axis image
np concatenate [image|image|image]|axis image
np array (img_h|img_w)|np float32
image_size h
_infer_data image|image_size
box astype np float32 box
random_sample_crop image|box box
cv2 resize image|(w|h) image
_rand flip
ssd_bboxes_encode box num_match
config img_shape image_size
config voc_dir voc_dir
{name} cls_map
os path join voc_dir|sub_dir voc_dir
os path isdir voc_dir
os path isdir os path join voc_dir|
os path join voc_dir image_dir
os path join voc_dir anno_dir
config voc_root data_dir
os path join json_file
os path split json_file file_dir
os path isdir file_dir
os makedirs file_dir
os listdir anno_file
print anno_file
anno_file endswith
et parse os path join anno_dir|anno_file tree
tree getroot root_node
root_node find text file_name
get_imageId_from_fileName file_name img_id
os path join image_dir|file_name image_path
print image_path
os path isfile image_path
root_node iter obj
obj find text cls_name
obj find bnd_box
int bnd_box find text-1 x_min
int bnd_box find text-1 y_min
int bnd_box find text-1 x_max
int bnd_box find text-1 y_max
labels append [y_min|x_min|y_max|x_max|cls_map[cls_name]]
abs x_max-x_min o_width
abs y_max-y_min o_height
json_dict append ann
bnd_id|1 bnd_id
images append img_id
image_path image_files_dict img_id
np array labels image_anno_dict img_id
root_node find size
int size find text width
int size find text height
json_dict append image
cls_map items cls_name|cid
{} cat
json_dict append cat
open json_file json_fp
json dumps json_dict json_str
json_fp write json_str
json_fp close
config coco_root coco_root
config val_data_type data_type
config train_data_type data_type
config coco_classes train_cls
enumerate i|cls
i train_cls_dict cls
os path join coco_root|config instances_set format data_type anno_json
COCO anno_json coco
coco loadCats coco getCatIds cat_ids
cat_ids cat
coco getImgIds image_ids
image_ids img_id
coco loadImgs img_id image_info
image_info file_name
coco loadAnns anno_ids anno
os path join coco_root|data_type|file_name image_path
anno label
label bbox
classs_dict label class_name
bbox|bbox|bbox x_max
bbox|bbox|bbox y_max
image_path image_path_dict img_id
np array annos image_anno_dict img_id
annos_str anno_str
list map int|anno_str strip split anno
annos append anno
os path isdir image_dir
os path isfile anno_path
open anno_path|
f readlines lines
enumerate img_id|line
line decode strip line_str
str line_str split line_split
line_split file_name
anno_parser line_split image_anno_dict img_id
os path join mindrecord_dir|prefix mindrecord_path
FileWriter mindrecord_path|file_num writer
create_voc_label is_training image_anno_dict
writer add_schema ssd_json|
images img_id
image_path_dict img_id image_path
open image_path|
f read img
np array image_anno_dict[img_id]|dtype annos
np array [img_id]|dtype img_id
{} row
writer write_raw_data [row]
writer commit
config mindrecord_dir mindrecord_dir
create_coco_label image_anno_dict
filter_valid_data image_anno_dict
C Decode decode
ds map input_columns ds
C HWC2CHW change_swap_op
C Normalize normalize_op
C RandomColorAdjust color_adjust_op
(lambdaimg_id|image|annotation) compose_map_func
[color_adjust_op|normalize_op|change_swap_op] trans
[normalize_op|change_swap_op] trans
output_columns|columns_order output_columns
compose_map_func|python_multiprocessing operations
ds repeat repeat_num ds
jaccard_numpy boxes|rect overlap drop_mask
jaccard_numpy boxes|rect overlap drop_mask min<min_iouandoverlap[drop_mask] max>(min_iou|0 2)
overlap drop_mask any
overlap drop_mask mask
(rect) m1 mask
(rect) m2 mask
m1|m2|drop_mask mask any
cv2 resize image|(input_w|input_h) image compose_map_func
np expand_dims image|axis image compose_map_func
np concatenate [image|image|image]|axis image compose_map_func
_infer_data i train_cls_dict cls
random_sample_crop image|box box x_max
random_sample_crop image|box box y_max
cv2 resize image|(w|h) image compose_map_func
{name} cls_map items cls_name|cid
os listdir anno_file endswith
print anno_file endswith
et parse os path join anno_dir|anno_file tree getroot root_node
tree getroot root_node find text file_name
tree getroot root_node iter obj
tree getroot root_node find size
get_imageId_from_fileName file_name img_id compose_map_func
os path join image_dir|file_name image_path image_files_dict img_id
os path join image_dir|file_name image_path image_path_dict img_id
print image_path image_files_dict img_id
print image_path image_path_dict img_id
os path isfile image_path image_files_dict img_id
os path isfile image_path image_path_dict img_id
root_node iter obj find text cls_name
root_node iter obj find bnd_box
labels append cls_map items cls_name|cid
json_dict append ann compose_map_func
bnd_id|1 bnd_id bnd_id
images append img_id compose_map_func
image_path image_files_dict img_id compose_map_func
np array labels image_anno_dict img_id compose_map_func
json_dict append image compose_map_func
open json_file json_fp write json_str
open json_file json_fp close
enumerate i train_cls_dict cls
COCO anno_json coco loadCats coco getCatIds cat_ids
COCO anno_json coco getImgIds image_ids
COCO anno_json coco loadImgs img_id image_info
COCO anno_json coco loadAnns anno_ids anno
coco loadCats coco getCatIds cat_ids cat
coco getImgIds image_ids img_id
image_ids img_id compose_map_func
coco loadImgs img_id image_info file_name
coco loadAnns anno_ids anno label
coco loadAnns anno_ids anno compose_map_func
os path join coco_root|data_type|file_name image_path image_path_dict img_id
anno label bbox
label bbox x_max
label bbox y_max
image_path image_path_dict img_id compose_map_func
np array annos image_anno_dict img_id compose_map_func
list map int|anno_str strip split anno compose_map_func
annos append anno compose_map_func
enumerate line decode strip line_str
str line_str split line_split file_name
anno_parser line_split image_anno_dict img_id compose_map_func
FileWriter mindrecord_path|file_num writer add_schema ssd_json|
FileWriter mindrecord_path|file_num writer write_raw_data [row]
FileWriter mindrecord_path|file_num writer commit
images img_id compose_map_func
np array [img_id]|dtype img_id compose_map_func
C HWC2CHW change_swap_op trans
C HWC2CHW change_swap_op trans
C Normalize normalize_op trans
C Normalize normalize_op trans
C RandomColorAdjust color_adjust_op trans
(lambdaimg_id|image|annotation) compose_map_func operations
output_columns|columns_order output_columns output_columns
int np ceil x|1 |divisor|divisor
DepthwiseConv depthwise_conv
nn SequentialCell [depthwise_conv|_bn in_channel|nn ReLU6|conv]
super ConvBNReLU|self __init__
[conv|_bn(out_planes)] layers
layers append Activation act_type
nn SequentialCell layers self features
self features x output
super DepthwiseConv|self __init__
has_bias self has_bias
in_planes self in_channels
channel_multiplier self channel_multiplier
in_planes|channel_multiplier self out_channels
(kernel_size|kernel_size) self kernel_size
self kernel_size kernel_size
P BiasAdd self bias_add
[channel_multiplier|in_planes||self kernel_size] weight_shape
Parameter initializer self weight
[channel_multiplier|in_planes] bias_shape
Parameter initializer self bias
self depthwise_conv x|self weight output
self bias_add output|self bias output
super MyHSigmoid|self __init__
nn ReLU6 self relu6
self relu6 x|3 
act_func string
super Activation|self __init__
nn ReLU self act
nn ReLU6 self act
MyHSigmoid self act
nn HSwish self act
self act x
super GlobalAvgPooling|self __init__
P ReduceMean keep_dims self mean
self mean x|(2|3) x
super SE|self __init__
_make_divisible num_out||ratio num_mid
Activation self act1
Activation self act2
P Mul self mul
self pool x out
self conv_reduce out out
self act1 out out
self conv_expand out out
self act2 out out
self mul x|out out
GhostModule 3|3
super GhostModule|self __init__
math ceil num_out|ratio init_channels
init_channels|(ratio-1) new_channels
self primary_conv x x1
self cheap_operation x1 x2
self concat (x1|x2)
GhostBottleneck 16|3|1|1
super GhostBottleneck|self __init__
use_res_connect self use_res_connect
last_relu self last_relu
stride self use_dw
use_se self use_se
SE num_mid self se
nn ReLU self relu
 self shortcut
P TensorAdd self add
x shortcut
self ghost1 x out
self dw out out
self se out out
self ghost2 out out
self shortcut shortcut shortcut
self add shortcut|out out
self relu out out
ResidualBlock 3|256|1|1
super InvertedResidual|self __init__
int round inp|expand_ratio hidden_dim
_bn oup
nn SequentialCell layers self conv
P Cast self cast
nn ReLU6 self relu
x identity
self conv x x
self add identity|x x
self relu x x
super FlattenConcat|self __init__
config num_ssd_boxes self num_ssd_boxes
P Transpose self transpose
F shape inputs batch_size
inputs x
self transpose x|(0|2|3|1) x
(F reshape x|(batch_size|-1)) output
self concat output res
F reshape res|(batch_size|self num_ssd_boxes|-1)
super MultiBox|self __init__
config num_classes num_classes
config extras_out_channels out_channels
config num_default num_default
enumerate k|out_channel
nn layer CellList loc_layers self multi_loc_layers
nn layer CellList cls_layers self multi_cls_layers
FlattenConcat config self flatten_concat
range i
 self multi_loc_layers i inputs i loc_outputs
 self multi_cls_layers i inputs i cls_outputs
self flatten_concat loc_outputs|self flatten_concat cls_outputs
super SSD300|self __init__
backbone self backbone
config extras_in_channels in_channels
config extras_ratio ratios
config extras_srides strides
residual_list append residual
nn layer CellList residual_list self multi_residual
MultiBox config self multi_box
is_training self is_training
P Sigmoid self activation
self backbone x output
(layer_out_11|output) multi_feature
output feature
self multi_residual residual
residual feature feature
(feature|) multi_feature
self multi_box multi_feature pred_label
self activation pred_label pred_label
super SigmoidFocalClassificationLoss|self __init__
P SigmoidCrossEntropyWithLogits self sigmiod_cross_entropy
P Sigmoid self sigmoid
P Pow self pow
P OneHot self onehot
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
gamma self gamma
alpha self alpha
self onehot label|F shape label
self sigmiod_cross_entropy logits|label sigmiod_cross_entropy
self sigmoid logits sigmoid
F cast label|mstype float32 label
label|sigmoid|(1-label)|(1-sigmoid) p_t
self pow 1-p_t|self gamma modulating_factor
label|self alpha| alpha_weight_factor
modulating_factor|alpha_weight_factor|sigmiod_cross_entropy focal_loss
super SSDWithLossCell|self __init__
network self network
P Less self less
P Tile self tile
P ReduceSum self reduce_sum
P ReduceMean self reduce_mean
P ExpandDims self expand_dims
SigmoidFocalClassificationLoss self class_loss
nn SmoothL1Loss self loc_loss
self network x pred_label
F cast self less 0|gt_label mask
self reduce_sum num_matched_boxes
self tile self expand_dims mask|-1 mask_loc
self loc_loss pred_loc|gt_loc|mask_loc smooth_l1
self reduce_sum self reduce_mean smooth_l1|-1 loss_loc
self class_loss pred_label|gt_label loss_cls
self reduce_sum loss_cls|(1|2) loss_cls
self reduce_sum (loss_cls|loss_loc)|num_matched_boxes
ms ParameterTuple network trainable_params self weights
optimizer self optimizer
sens self sens
context get_auto_parallel_context self parallel_mode
context get_auto_parallel_context mean
auto_parallel_context get_device_num_is_set
context get_auto_parallel_context degree
get_group_size degree
nn DistributedGradReducer self grad_reducer
self weights weights
self network args loss
P Fill P DType loss sens
self grad self network|weights(args|sens) grads
self grad_reducer grads grads
F depend loss|self optimizer grads
super SSDWithGhostNet|self __init__
model_cfgs self cfgs
_make_divisible multiplier|self inplanes first_conv_out_channel
self cfgs layer_cfg
int round self inplanes|6 hidden_dim
ConvBNReLU self expand_layer_conv_11
_make_divisible exp_ch
_make_divisible out_channel
layer_cfg use_se
layer_cfg act_func
_make_divisible output_channel
nn SequentialCell blocks self features_1
nn SequentialCell blocks self features_2
exp_ch mid_planes
out_channel out_planes
out_planes self inplanes
self features_1 x out
self expand_layer_conv_11 out expand_layer_conv_11
self features_2 out out
SSDWithGhostNet model_cfgs|kwargs
int np ceil x|1  self shortcut
nn SequentialCell [depthwise_conv|_bn in_channel|nn  self shortcut
[conv|_bn(out_planes)] layers append Activation act_type
self features x output multi_feature
self features x output feature
(kernel_size|kernel_size) self kernel_size self kernel_size
self depthwise_conv x|self weight output multi_feature
self depthwise_conv x|self weight output feature
self bias_add output|self bias output multi_feature
self bias_add output|self bias output feature
self relu6 x|3  new_channels
self relu6 x|3  self shortcut
self relu6 x|3  multi_feature
self relu6 x|3  multi_feature
self relu6 x|3  p_t
self relu6 x|3  alpha| alpha_weight_factor
self relu6 x|3  focal_loss
self act x shortcut
self act x identity
self mean x|(2|3) x shortcut
self mean x|(2|3) x identity
self pool x out multi_feature
self conv_reduce out out multi_feature
self act1 out out multi_feature
self conv_expand out out multi_feature
self act2 out out multi_feature
self mul x|out out multi_feature
GhostModule  self shortcut
math ceil num_out|ratio init_channels new_channels
self concat  self shortcut
self concat x shortcut
self concat x identity
GhostBottleneck  self shortcut
SE num_mid self se alpha| alpha_weight_factor
self ghost1 x out multi_feature
self dw out out multi_feature
self se out out multi_feature
self ghost2 out out multi_feature
self add shortcut|out out multi_feature
self relu out out multi_feature
(F reshape x|(batch_size|-1)) output multi_feature
(F reshape x|(batch_size|-1)) output feature
enumerate out_channel out_planes
residual_list append residual feature feature
self backbone x output multi_feature
self backbone x output feature
output feature multi_feature
self multi_residual residual feature feature
residual feature feature multi_feature
P SigmoidCrossEntropyWithLogits self sigmiod_cross_entropy focal_loss
P Sigmoid self sigmoid p_t
self onehot label|F shape label p_t
self onehot label|F shape label alpha| alpha_weight_factor
self sigmiod_cross_entropy logits|label sigmiod_cross_entropy focal_loss
self sigmoid logits sigmoid p_t
F cast label|mstype float32 label p_t
F cast label|mstype float32 label alpha| alpha_weight_factor
self pow 1-p_t|self gamma modulating_factor focal_loss
label|self alpha| alpha_weight_factor focal_loss
self cfgs layer_cfg use_se
self cfgs layer_cfg act_func
_make_divisible exp_ch mid_planes
_make_divisible out_channel out_planes
out_channel out_planes self inplanes
ghostnet_1x args|kwargs
NotImplementedError f
parser parse_args args_opt
config_ascend config_platform
int os getenv device_id
config_gpu config_platform
NotImplementedError f
ghostnet_1x num_classes net
net to_float mstype float16
net cells_and_names _|cell
isinstance cell|nn Dense
cell to_float mstype float32
config_platform config
args_opt platform platform
dataset get_dataset_size step_size
load_checkpoint args_opt checkpoint_path param_dict
load_param_into_net net|param_dict
net set_train False
Model net|loss_fn model
model eval dataset res
parser parse_args args_opt platform platform
config_ascend config_platform config
config_gpu config_platform config
ghostnet_1x num_classes net to_float mstype float16
ghostnet_1x num_classes net cells_and_names _|cell
ghostnet_1x num_classes net set_train False
ghostnet_1x num_classes net model
net cells_and_names cell to_float mstype float32
load_param_into_net net set_train False
Model net|loss_fn model eval dataset res
int np ceil x|1 |divisor|divisor
super MyHSigmoid|self __init__
nn ReLU6 self relu6
self relu6 x|3 
act_func string
super Activation|self __init__
nn ReLU self act
nn ReLU6 self act
MyHSigmoid self act
nn HSwish self act
self act x
super GlobalAvgPooling|self __init__
P ReduceMean keep_dims self mean
self mean x|(2|3) x
super SE|self __init__
_make_divisible num_out||ratio num_mid
Activation self act1
Activation self act2
P Mul self mul
self pool x out
self conv_reduce out out
self act1 out out
self conv_expand out out
self act2 out out
self mul x|out out
ConvUnit 3|3
super ConvUnit|self __init__
num_out out_channels
num_groups group
nn BatchNorm2d num_out self bn
use_act self use_act
self conv x out
self bn out out
self act out out
GhostModule 3|3
super GhostModule|self __init__
math ceil num_out|ratio init_channels
init_channels|(ratio-1) new_channels
self primary_conv x x1
self cheap_operation x1 x2
self concat (x1|x2)
GhostBottleneck 16|3|1|1
super GhostBottleneck|self __init__
stride self use_dw
use_se self use_se
SE num_mid self se
 self shortcut
P TensorAdd self add
x shortcut
self ghost1 x out
self dw out out
self se out out
self ghost2 out out
self shortcut shortcut shortcut
self add shortcut|out out
super GhostNet|self __init__
model_cfgs self cfgs
_make_divisible multiplier|self inplanes first_conv_out_channel
first_conv_out_channel out_channels
nn BatchNorm2d first_conv_out_channel self bn1
self cfgs layer_cfg
_make_divisible exp_ch
_make_divisible out_channel
layer_cfg use_se
layer_cfg act_func
_make_divisible output_channel
nn SequentialCell self blocks self blocks
model_cfgs out_channels
P Flatten self squeeze
final_drop self final_drop
nn Dropout self final_drop self dropout
nn Dense self classifier
self _initialize_weights
self conv_stem x x
self bn1 x x
self act1 x x
self blocks x x
self global_pool x x
self conv_head x x
self act2 x x
self squeeze x x
self dropout x x
self classifier x x
exp_ch mid_planes
out_channel out_planes
out_planes self inplanes
self init_parameters_data
self cells_and_names _|m
isinstance m|(nn Conv2d)
m kernel_size|m kernel_size|m out_channels n
isinstance m|nn BatchNorm2d
isinstance m|nn Dense
GhostNet model_cfgs model_name
int np ceil x|1  self shortcut
self relu6 x|3  new_channels
self relu6 x|3  self shortcut
self act x shortcut
self mean x|(2|3) x shortcut
ConvUnit  self shortcut
GhostModule  self shortcut
math ceil num_out|ratio init_channels new_channels
self concat  self shortcut
self concat x shortcut
GhostBottleneck  self shortcut
_make_divisible multiplier|self inplanes first_conv_out_channel out_channels
self cfgs layer_cfg use_se
self cfgs layer_cfg act_func
_make_divisible exp_ch mid_planes
_make_divisible out_channel out_planes
out_channel out_planes self inplanes
self cells_and_names m kernel_size|m kernel_size|m out_channels n
 config_ascend
 config_gpu
global_step int
lr_init float
lr_end float
lr_max float
warmup_epochs int
total_epochs int
steps_per_epoch int
steps_per_epoch|total_epochs total_steps
steps_per_epoch|warmup_epochs warmup_steps
range i
lr_init|(lr_max-lr_init)|i|warmup_steps lr
lr_end| lr
lr_each_step append lr
global_step current_step
np array lr_each_step astype np float32 lr_each_step
lr_each_step learning_rate
steps_per_epoch|warmup_epochs warmup_steps lr
range i lr
np array lr_each_step astype np float32 lr_each_step learning_rate
dataset_path string
do_train bool
repeat_num int
batch_size int
int os getenv rank_size
int os getenv rank_id
de MindDataset ds
config image_height resize_height
C RandomCropDecodeResize resize_crop_op
C RandomColorAdjust color_op
C Rescale 1|255 0|0 rescale_op
C Normalize normalize_op
C HWC2CHW change_swap_op
P Decode decode_p
P Resize s|interpolation resize_p
P CenterCrop c center_crop_p
P ToTensor totensor
P Normalize (0 485|0 456|0 406) normalize_p
P ComposeOp composeop
composeop trans
C2 TypeCast mstype int32 type_cast_op
ds shuffle buffer_size ds
ds repeat repeat_num ds
repeat_num int os getenv rank_size
repeat_num int os getenv rank_id
batch_size int os getenv rank_size
batch_size int os getenv rank_id
de MindDataset ds shuffle buffer_size ds
de MindDataset ds repeat repeat_num ds
P ComposeOp composeop trans
batch_size int
parser parse_known_args unknown
unknown args training_script_args
print __file__
parse_args args
print args
args visible_devices split visible_devices
os path isfile args training_script
print  format visible_devices
print  format args server_id
open readlines hccn_configs
hccn_configs hccn_item
hccn_item strip hccn_item
hccn_item startswith
hccn_item split device_ip
device_id split device_id
device_ip device_ips device_id
print  format device_id|device_ip
range instance_id
visible_devices instance_id device_id
device_ips device_id device_ip
str device_id usable_dev
str instance_id instance
args server_id instance
instance_list append instance
str args nproc_per_node
visible_devices instance_id eth_id
hccn_table append  format eth_id
str args nproc_per_node hccn_table
os getcwd table_path
os path exists table_path
os mkdir table_path
open table_fn|
sys stdout flush
os environ copy env
str args nproc_per_node env
os getcwd cur_path
range rank_id
os chdir cur_path
visible_devices rank_id device_id
os path join cur_path| format rank_id device_dir
str rank_id env
str device_id env
table_fn env
os path exists device_dir
shutil rmtree device_dir
os mkdir device_dir
os chdir device_dir
[sys executable|] cmd
cmd append args training_script
cmd extend args training_script_args
open log_file
subprocess Popen process
processes append process
cmds append cmd
log_files append log_file
zip process|cmd|log_file
process wait
process returncode|cmd cmd subprocess CalledProcessError
log_file close
parser parse_known_args unknown args training_script_args
parse_args args visible_devices split visible_devices
parse_args args server_id instance
print args visible_devices split visible_devices
print args server_id instance
args visible_devices split visible_devices instance_id device_id
args visible_devices split visible_devices instance_id eth_id
args visible_devices split visible_devices rank_id device_id
print  format visible_devices instance_id device_id
print  format visible_devices instance_id eth_id
print  format visible_devices rank_id device_id
open readlines hccn_configs hccn_item
hccn_configs hccn_item strip hccn_item
hccn_configs hccn_item startswith
hccn_configs hccn_item split device_ip
hccn_item split device_ip device_ips device_id
open table_fn env
[sys executable|] cmd append args training_script
[sys executable|] cmd extend args training_script_args
open log_file close
subprocess Popen process wait
subprocess Popen process returncode|cmd cmd subprocess CalledProcessError
processes append process wait
processes append process returncode|cmd cmd subprocess CalledProcessError
log_files append log_file close
zip process wait
zip process returncode|cmd cmd subprocess CalledProcessError
zip log_file close
P Floor self floor
P ExpandDims self expand_dims
Tensor 0|ms float32 self x_lower_bound
Tensor 28-1|ms float32 self x_upper_bound
Tensor -27-1|ms float32 self w_lower_bound
Tensor 27|ms float32 self w_upper_bound
Parameter initializer self scale_a
Parameter initializer self scale_w
Parameter initializer self zp_a
self floor in_data|self scale_a-self zp_a|0 5 x
C clip_by_value x|self x_lower_bound|self x_upper_bound x
(x|self zp_a)|self scale_a x
self scale_w exp_dim_scale_w
self expand_dims exp_dim_scale_w|1 exp_dim_scale_w
self expand_dims exp_dim_scale_w|2 exp_dim_scale_w
self expand_dims exp_dim_scale_w|3 exp_dim_scale_w
self floor self weight|exp_dim_scale_w|0 5 w
C clip_by_value w|self w_lower_bound|self w_upper_bound w
w|exp_dim_scale_w w
self conv2d x|w output
self bias_add output|self bias output
self floor in_data|self scale_a-self zp_a|0 5 x zp_a)|self scale_a x
C clip_by_value x|self x_lower_bound|self x_upper_bound x zp_a)|self scale_a x
(x|self zp_a)|self scale_a x zp_a)|self scale_a x
self scale_w exp_dim_scale_w w
self expand_dims exp_dim_scale_w|1 exp_dim_scale_w w
self expand_dims exp_dim_scale_w|2 exp_dim_scale_w w
self expand_dims exp_dim_scale_w|3 exp_dim_scale_w w
self floor self weight|exp_dim_scale_w|0 5 w w
C clip_by_value w|self w_lower_bound|self w_upper_bound w w
w|exp_dim_scale_w w w
enumerate index|exact_dir
os path exists exact_dir
IOError  format exact_dir
os listdir item
int index data
item split id_score
id_score split score
int id_score data
int score data
open os path join exact_dir|item review_file
review_file read review
review_file close
str review data
FileWriter MINDRECORD_FILE_NAME_TRAIN fw
FileWriter MINDRECORD_FILE_NAME_TEST fw
fw add_schema schema|
fw add_index
get_data_as_dict os path join ACLIMDB_DIR|data_type get_data_iter
range _
data_list append get_data_iter __next__
fw write_raw_data data_list
print  format transform_count
fw commit
os listdir item split id_score
item split id_score split score
open os path join exact_dir|item review_file read review
open os path join exact_dir|item review_file close
FileWriter MINDRECORD_FILE_NAME_TRAIN fw add_schema schema|
FileWriter MINDRECORD_FILE_NAME_TRAIN fw add_index
FileWriter MINDRECORD_FILE_NAME_TRAIN fw write_raw_data data_list
FileWriter MINDRECORD_FILE_NAME_TRAIN fw commit
FileWriter MINDRECORD_FILE_NAME_TEST fw add_schema schema|
FileWriter MINDRECORD_FILE_NAME_TEST fw add_index
FileWriter MINDRECORD_FILE_NAME_TEST fw write_raw_data data_list
FileWriter MINDRECORD_FILE_NAME_TEST fw commit
num_readers num_parallel_workers
print  format index|item
print  format index
len vectors length
vectors||(maxlen-length) input_
|length||(maxlen-length) mask
|maxlen segment
enumerate index|exact_dir
os path exists exact_dir
IOError  format exact_dir
load_vocab os path join data_dir| vocab_dict
os listdir item
item split id_score
id_score split score
open os path join exact_dir|item review_file
review_file read review
review_file close
inputs vectors segment
np reshape np array input_ input_ids
np reshape np array mask input_mask
np reshape np array segment segment_ids
int index
int id_score
int score
isinstance text|str
isinstance text|bytes
text decode
Exception %type text
collections OrderedDict vocab
vocab setdefault
open vocab_file
reader readline tmp
convert_to_uni tmp token
token strip token
index vocab token
FileWriter MINDRECORD_FILE_NAME_TRAIN fw
FileWriter MINDRECORD_FILE_NAME_TEST fw
fw add_schema schema|
fw add_index
load_vocab os path join ACLIMDB_DIR| vocab_dict
get_nlp_data os path join ACLIMDB_DIR|data_type get_data_iter
range _
data_list append get_data_iter __next__
fw write_raw_data data_list
print  format transform_count
fw commit
len vectors length mask
enumerate index vocab token
os listdir item split id_score
item split id_score split score
open os path join exact_dir|item review_file read review
open os path join exact_dir|item review_file close
int index vocab token
isinstance text decode
isinstance text decode
collections OrderedDict vocab setdefault
convert_to_uni tmp token strip token
FileWriter MINDRECORD_FILE_NAME_TRAIN fw add_schema schema|
FileWriter MINDRECORD_FILE_NAME_TRAIN fw add_index
FileWriter MINDRECORD_FILE_NAME_TRAIN fw write_raw_data data_list
FileWriter MINDRECORD_FILE_NAME_TRAIN fw commit
FileWriter MINDRECORD_FILE_NAME_TEST fw add_schema schema|
FileWriter MINDRECORD_FILE_NAME_TEST fw add_index
FileWriter MINDRECORD_FILE_NAME_TEST fw write_raw_data data_list
FileWriter MINDRECORD_FILE_NAME_TEST fw commit
num_readers num_parallel_workers
print  format index|item
print  format index
print  format index
parser parse_args args
socket gethostname hostname
socket gethostbyname hostname ip
print __file__
parse_args args
args visible_devices split visible_devices
print  format visible_devices
get_host_ip ip
args server_ip server_id
ip server_id
print  format server_id
int args device_num first_num
int args device_num last_num
ValueError  format args device_num
list range first_num|last_num device_num_list
print device_num_list
fin readlines hccn_item
hccn_item strip startswith
hccn_item split device_ip
device_id split device_id
device_ip strip device_ips device_id
device_num_list instance_id
visible_devices instance_id device_id
device_ips device_id device_ip
print  format rank_id|device_id|device_ip
device_list append device
os getcwd table_path
open table_fn|
sys stdout flush
print table_fn
parser parse_args args visible_devices split visible_devices
parser parse_args args server_ip server_id
socket gethostbyname hostname ip server_id
parse_args args visible_devices split visible_devices
parse_args args server_ip server_id
args visible_devices split visible_devices instance_id device_id
print  format visible_devices instance_id device_id
get_host_ip ip server_id
list range first_num|last_num device_num_list instance_id
print device_num_list instance_id
fin readlines hccn_item strip startswith
fin readlines hccn_item split device_ip
hccn_item split device_ip strip device_ips device_id
print table_fn
parser parse_args args
s cmd
print __file__
parse_args args
args run_script_dir run_script
args data_dir data_dir
configparser ConfigParser cf
cf read args hyper_parameter_config_dir
dict cf items cfg
print args hccl_config_dir
append_cmd_env cmd|args hccl_config_dir cmd
multiprocessing cpu_count cores
print cores
fin readlines hccn_item
hccn_item strip startswith
hccn_item split device_ip
device_id split device_id
device_ip strip device_ips device_id
json loads fin read hccl_config
hccl_config server
len server rank_size
device_ips values
server this_server
append_cmd_env cmd|str(rank_size) cmd
print rank_size
print len this_server
int int cores|len(this_server) avg_core_per_rank
avg_core_per_rank-1 core_gap
print avg_core_per_rank
this_server instance
instance device_id
instance rank_id
print rank_id
print device_id
count|int(avg_core_per_rank) start
start|core_gap end
str start||str(end) cmdopt
append_cmd_env cmd|str(device_id) cmd
append_cmd_env cmd|str(rank_id) cmd
append_cmd_env cmd cmd
append_cmd cmd||str(device_id) cmd
append_cmd cmd cmd
os getcwd cur_dir
print cmdopt
print str cfg
print data_dir
opt run_cmd
str rank_size
append_cmd cmd|run_cmd cmd
open args cmd_file|
f write cmd
parser parse_args args run_script_dir run_script
parser parse_args args data_dir data_dir
parse_args args run_script_dir run_script
parse_args args data_dir data_dir
configparser ConfigParser cf read args hyper_parameter_config_dir
fin readlines hccn_item strip startswith
fin readlines hccn_item split device_ip
hccn_item split device_ip strip device_ips device_id
json loads fin read hccl_config server
hccl_config server this_server
server this_server instance
print len this_server instance
avg_core_per_rank-1 core_gap end
this_server instance device_id
this_server instance rank_id
count|int(avg_core_per_rank) start end
(2||[|]) node_profile
(0|) edge_profile
print  format task_id
social_data edge
edge dst
node_list append src
node_list append dst
node_list sort
print node_list
node_list node_id
np int64 dtype
social_data undirected_edge
social_data edge dst
print node_list node_id
logger info
num_features self num_node_features
range i
i|1 k
{} field_value
field_value self union_schema_in_mindrecord field_key
num_features self num_edge_features
node schema
self union_schema_in_mindrecord graph_field_key graph_field_type
node_graph append k
np reshape np array node[node_field_key]|dtype node_graph graph_field_key
np reshape np array |dtype node_graph graph_field_key
edge schema
edge_graph append k
np reshape np array edge[edge_field_key]|dtype edge_graph graph_field_key
np reshape np array |dtype edge_graph graph_field_key
np array |dtype edge_graph graph_field_key
range i k
{} field_value self union_schema_in_mindrecord field_key
os environ split args
args CITESEER_PATH
(2||[|]) node_profile
(0|) edge_profile
np array features sum row_sum
np power row_sum|1 0|-1 flatten r_inv
sp diags r_inv r_mat_inv
r_mat_inv dot features features
open line
index append int line strip
logger info  format task_id
names name
open  format CITESEER_PATH|dataset_str|name|
tuple objects ally
_parse_index_file test_idx_reorder
np sort test_idx_reorder test_idx_range
_normalize_citeseer_features tx tx
_normalize_citeseer_features allx allx
range min test_idx_reorder test_idx_range_full
sp lil_matrix (len(test_idx_range_full)) tx_extended
tx tx_extended
tx_extended tx
np zeros (len(test_idx_range_full)) ty_extended
ty ty_extended
ty_extended ty
sp vstack (allx|tx) tolil features
features A features
np vstack (ally|ty) labels
enumerate i|label
label tolist
node_ids append i
logger info  format line_count
open  format CITESEER_PATH|dataset_str|
graph i
graph dst_id
logger info  format i
os environ split args CITESEER_PATH
sp diags r_inv r_mat_inv dot features features
r_mat_inv dot features features A features
_normalize_citeseer_features tx tx tx_extended
sp lil_matrix (len(test_idx_range_full)) tx_extended tx
tx tx_extended tx
np zeros (len(test_idx_range_full)) ty_extended ty
ty ty_extended ty
sp vstack (allx|tx) tolil features A features
enumerate label tolist
parser parse_args args
ds MindDataset args path data_set
print item
os environ split args
args CORA_PATH
(2||[|]) node_profile
(0|) edge_profile
np array features sum row_sum
np power row_sum|1 0|-1 flatten r_inv
sp diags r_inv r_mat_inv
r_mat_inv dot features features
open line
index append int line strip
print  format task_id
names name
open  format CORA_PATH|dataset_str|name|
tuple objects ally
_parse_index_file test_idx_reorder
np sort test_idx_reorder test_idx_range
sp vstack (allx|tx) tolil features
_normalize_cora_features features features
features A features
np vstack (ally|ty) labels
enumerate i|label
print  format line_count
open  format CORA_PATH|dataset_str|
graph i
graph dst_id
os environ split args CORA_PATH
sp diags r_inv r_mat_inv dot features features
r_mat_inv dot features features A features
sp vstack (allx|tx) tolil features A features
_normalize_cora_features features features A features
print  format task_id|parallel_writer
mindrecord_dict_data task_id imagenet_iter
range _
imagenet_iter __next__ data
graph_map_schema transform_edge data data
graph_map_schema transform_node data data
data_list append data
print  format transform_count
parser parse_args ret_args
FileWriter args mindrecord_file|args mindrecord_partitions mr_writer
mr_writer set_header_size header_size
mr_writer set_page_size page_size
mr_writer add_schema mr_schema|
mr_writer open_and_set_header
args mindrecord_workers num_workers
list range num_tasks task_list
num_tasks num_workers
task_list window_task_id
exec_task window_task_id|False
Pool num_workers
p map exec_task|task_list
exec_task 0|False
read_args args
print args
time time start_time
args graph_api_args os environ
import_module args mindrecord_script| mr_api
RuntimeError  format(args mindrecord_script|)
GraphMapSchema graph_map_schema
mr_api node_profile feature_shapes
graph_map_schema set_node_feature_profile num_features|feature_data_types|feature_shapes
mr_api edge_profile feature_shapes
graph_map_schema set_edge_feature_profile num_features|feature_data_types|feature_shapes
graph_map_schema get_schema graph_schema
init_writer graph_schema writer
mr_api yield_nodes mindrecord_dict_data
run_parallel_workers args num_node_tasks
mr_api yield_edges mindrecord_dict_data
run_parallel_workers args num_edge_tasks
writer commit ret
time time end_time
print  format end_time-start_time
print  format p map exec_task|task_list
mindrecord_dict_data task_id imagenet_iter __next__ data
FileWriter args mindrecord_file|args mindrecord_partitions mr_writer set_header_size header_size
FileWriter args mindrecord_file|args mindrecord_partitions mr_writer set_page_size page_size
FileWriter args mindrecord_file|args mindrecord_partitions mr_writer add_schema mr_schema|
FileWriter args mindrecord_file|args mindrecord_partitions mr_writer open_and_set_header
list range num_tasks task_list window_task_id
p map exec_task 0|False
read_args args graph_api_args os environ
print args graph_api_args os environ
import_module args mindrecord_script| mr_api node_profile feature_shapes
import_module args mindrecord_script| mr_api edge_profile feature_shapes
import_module args mindrecord_script| mr_api yield_nodes mindrecord_dict_data
import_module args mindrecord_script| mr_api yield_edges mindrecord_dict_data
GraphMapSchema graph_map_schema set_node_feature_profile num_features|feature_data_types|feature_shapes
GraphMapSchema graph_map_schema set_edge_feature_profile num_features|feature_data_types|feature_shapes
GraphMapSchema graph_map_schema get_schema graph_schema
init_writer graph_schema writer commit ret
os environ split args
args USER_FILE
args ITEM_FILE
args RATING_FILE
(0|) node_profile
(0|) edge_profile
print  format task_id
open USER_FILE
user_reader row
{} node
print  format line_count
open ITEM_FILE
item_reader row
open RATING_FILE
rating_reader row
{} edge
os environ split args USER_FILE
os environ split args ITEM_FILE
os environ split args RATING_FILE
open path|name|
dict ds_matrix_mapping
enumerate inner_id|true_id
inner_id ds_matrix_mapping true_id
generate_inverse_mapping user_mapping user_inverse_mapping
generate_inverse_mapping item_mapping item_inverse_mapping
enumerate user_id|_
user_mapping user_id real_user_id
list user_records real_user_id item_list
enumerate index|real_item_id
item_inverse_mapping real_item_id item_list index
inner_user_records append item_list
print %seed
enumerate _|item_list
train_test_split tmp_test_sample
item_list place
train_sample append place
tmp_test_sample place
test_sample append place
train_set append train_sample
test_set append test_sample
train_matrix toarray user_item_ratings
enumerate i|_
set neigh_items user2item i
user_item_ratings transpose item_user_ratings
enumerate j|_
set neigh_users item2user j
enumerate user_id|article_list
article_list article
row append user_id|user_shift
col append article|item_shift
data append
np array row row
np array col col
np array data data
csr_matrix rating_matrix
np argsort distance|1 top_ids
np zeros_like distance flat_distance
len adj i adj_len
values flat_distance i] top_ids[i
np random seed seed
random seed seed
len distances N
dict sampled_graph
np arange 0|N astype(np int) nodes
range i
random uniform 0|1
np random choice nodes|1|p sampled_node
[i] sampled_node
node_neighbors_dict sampled_node sampled_graph i
deepcopy data df
df value_counts counts
df[df isin counts counts] df
print  format min_counts
pkl dump obj|f
data_records data_records rating data_records
remove_infrequent_users data_records|10 filtered_data
remove_infrequent_items filtered_data|10 filtered_data
filtered_data groupby apply list data
filtered_data groupby nunique unique_data
data to_dict user_item_dict
set item_set
data iteritems user_id|item_list
user_mapping append user_id
item_list item_id
item_set add item_id
list item_set item_mapping
set1 union set2 union
len set1 intersection set2|len union
data values] x
time time start
Pool processes pool
pool map_async partial build_func|data results
results wait
pool close
pool join
np array results get squeeze distances
np fill_diagonal distances|0
distances astype np float16
preprocess_data src_path|data_name item_mapping
convert_to_inner_index item_inverse_mapping
split_data_randomly test_set
generate_rating_matrix train_matrix
create_adj_matrix train_matrix v_adj_list
train_matrix shape num_item
user_user_graph tocoo col user_self_neighs
np array np array_split user_self_neighs|num_user tolist user_self_neighs
item_item_graph tocoo col item_self_neighs
np array np array_split item_self_neighs|num_item tolist item_self_neighs
num_user item_start_id
out_path user_file
out_path item_file
out_path train_file
out_path test_file
open user_file|
user_inverse_mapping k
user_f file
open item_file|
item_inverse_mapping k
item_f file
open train_file|
print train_f file
u_adj_list user
sorted item
train_f file
v_adj_list item
v_adj_list user
user_self_neighs users
users dst_user
item_self_neighs items
items dst_item
open test_file|
print test_f file
test_set items
items item
test_f file
{x} sampled_item_graph
sampled_user_graph items k|items
items x
sampled_item_graph x add k
out_path sampled_file
open sampled_file|
print sampled_f file
sampled_user_graph user
sampled_user_graph item
sampled_f file
sampled_item_graph item
sampled_item_graph user
parser parse_args args
trans(args src_path|)
enumerate inner_id ds_matrix_mapping true_id
generate_inverse_mapping user_mapping user_inverse_mapping k
generate_inverse_mapping item_mapping item_inverse_mapping real_item_id item_list index
generate_inverse_mapping item_mapping item_inverse_mapping k
list user_records real_user_id item_list place
list user_records real_user_id item_list item_id
inner_user_records append item_list place
inner_user_records append item_list item_id
enumerate item_list place
enumerate item_list item_id
train_test_split tmp_test_sample place
train_matrix toarray user_item_ratings transpose item_user_ratings
enumerate article_list article
np array data data to_dict user_item_dict
np array data data iteritems user_id|item_list
np array data data values] x
deepcopy data df value_counts counts
remove_infrequent_users data_records|10 filtered_data groupby apply list data
remove_infrequent_users data_records|10 filtered_data groupby nunique unique_data
remove_infrequent_items filtered_data|10 filtered_data groupby apply list data
remove_infrequent_items filtered_data|10 filtered_data groupby nunique unique_data
filtered_data groupby apply list data to_dict user_item_dict
filtered_data groupby apply list data iteritems user_id|item_list
filtered_data groupby apply list data values] x
set item_set add item_id
data iteritems item_list item_id
Pool processes pool map_async partial build_func|data results
Pool processes pool close
Pool processes pool join
pool map_async partial build_func|data results wait
np array results get squeeze distances astype np float16
np fill_diagonal distances astype np float16
convert_to_inner_index item_inverse_mapping k
split_data_randomly test_set items
generate_rating_matrix train_matrix shape num_item
create_adj_matrix train_matrix v_adj_list item
create_adj_matrix train_matrix v_adj_list user
user_user_graph tocoo col user_self_neighs users
np array np array_split user_self_neighs|num_user tolist user_self_neighs users
item_item_graph tocoo col item_self_neighs items
np array np array_split item_self_neighs|num_item tolist item_self_neighs items
user_self_neighs users dst_user
item_self_neighs items dst_item
item_self_neighs items item
item_self_neighs items x
test_set items item
test_set items x
{x} sampled_item_graph x add k
{x} sampled_item_graph item
{x} sampled_item_graph user
sampled_user_graph items items x
os environ split args
args PUBMED_PATH
(2||[|]) node_profile
(0|) edge_profile
np array features sum row_sum
np power row_sum|1 0|-1 flatten r_inv
sp diags r_inv r_mat_inv
r_mat_inv dot features features
open line
index append int line strip
print  format task_id
names name
open  format PUBMED_PATH|dataset_str|name|
tuple objects ally
_parse_index_file test_idx_reorder
np sort test_idx_reorder test_idx_range
sp vstack (allx|tx) tolil features
_normalize_cora_features features features
features A features
np vstack (ally|ty) labels
enumerate i|label
print  format line_count
open  format PUBMED_PATH|dataset_str|
graph i
graph dst_id
os environ split args PUBMED_PATH
sp diags r_inv r_mat_inv dot features features
r_mat_inv dot features features A features
sp vstack (allx|tx) tolil features A features
_normalize_cora_features features features A features
open os path join CUB_200_2011_DIR| images_txt
images_txt line
line split single_images_txt
images_txt close
open os path join CUB_200_2011_DIR| bounding_boxes_txt
bounding_boxes_txt line
line split single_bounding_boxes_txt
float single_bounding_boxes_txt
bounding_boxes_txt close
open os path join CUB_200_2011_DIR| image_class_labels_txt
image_class_labels_txt line
line split single_image_class_labels_txt
int id_and_label[int single_image_class_labels_txt] single_image_class_labels_txt
image_class_labels_txt close
id_and_filename item
id_and_filename item segmentation_filename
segmentation_filename replace segmentation_filename
segmentation_filename id_and_segmentation_file_name item
open os path join CUB_200_2011_DIR| classes_txt
classes_txt line
line split single_classes_txt
str label_and_class[int single_classes_txt] single_classes_txt replace
classes_txt close
np asarray id_and_bbox[item]|dtype data
open id_and_filename item image_file
image_file read image_bytes
image_file close
image_bytes data
id_and_filename item image_filename
image_filename data
id_and_label item data
label_and_class id_and_label item data
open id_and_segmentation_file_name item segmentation_file
segmentation_file read segmentation_bytes
segmentation_file close
segmentation_bytes data
FileWriter MINDRECORD_FILE_NAME fw
fw add_schema schema|
get_data_as_dict get_data_iter
range _
data_list append get_data_iter __next__
fw write_raw_data data_list
print  format transform_count
fw commit
open os path join CUB_200_2011_DIR| images_txt line
open os path join CUB_200_2011_DIR| images_txt close
images_txt line split single_images_txt
images_txt line split single_bounding_boxes_txt
images_txt line split single_image_class_labels_txt
images_txt line split single_classes_txt
open os path join CUB_200_2011_DIR| bounding_boxes_txt line
open os path join CUB_200_2011_DIR| bounding_boxes_txt close
bounding_boxes_txt line split single_bounding_boxes_txt
bounding_boxes_txt line split single_image_class_labels_txt
bounding_boxes_txt line split single_classes_txt
open os path join CUB_200_2011_DIR| image_class_labels_txt line
open os path join CUB_200_2011_DIR| image_class_labels_txt close
image_class_labels_txt line split single_image_class_labels_txt
image_class_labels_txt line split single_classes_txt
id_and_filename item segmentation_filename replace segmentation_filename
id_and_filename item segmentation_filename id_and_segmentation_file_name item
open os path join CUB_200_2011_DIR| classes_txt line
open os path join CUB_200_2011_DIR| classes_txt close
classes_txt line split single_classes_txt
open id_and_filename item image_file read image_bytes
open id_and_filename item image_file close
image_file read image_bytes data
id_and_filename item image_filename data
open id_and_segmentation_file_name item segmentation_file read segmentation_bytes
open id_and_segmentation_file_name item segmentation_file close
segmentation_file read segmentation_bytes data
FileWriter MINDRECORD_FILE_NAME fw add_schema schema|
FileWriter MINDRECORD_FILE_NAME fw write_raw_data data_list
FileWriter MINDRECORD_FILE_NAME fw commit
num_readers num_parallel_workers
print  format index|item
print  format index
print  format index
mindrecord_dict_data task_id
pickle load mindrecord_argument_file_handle ARG_LIST
parser parse_args ARG_LIST args
print args
print  format task_id
range i
i data
range i data
print  format task_id
mindrecord_dict_data task_id
pickle load mindrecord_argument_file_handle ARG_LIST
parser parse_args ARG_LIST args
print args
os path exists args label_file
IOError  format args label_file
open args label_file
file_handle readline line
line split labels
labels label_dict labels
label_dict item
os path join args image_dir|label_dict[item] real_path
os path isdir real_path
print  format real_path
real_path dir_paths item
print  format args image_dir
dir_paths label
dir_list append label
_user_defined_private_func dir_paths_global
len dir_list_global
dir_list_global task_id label
os listdir item
os path join dir_paths_global label file_name
item endswith
print  format file_name
str file_name data
int label data
open file_name image_file
image_file read image_bytes
image_file close
image_bytes data
file_handle readline line split labels
line split labels label_dict labels
label_dict item endswith
os path join args image_dir|label_dict[item] real_path dir_paths item
os path isdir real_path dir_paths item
print  format real_path dir_paths item
real_path dir_paths item endswith
len dir_list_global task_id label
os listdir item endswith
open file_name image_file read image_bytes
open file_name image_file close
image_file read image_bytes data
print  format task_id|parallel_writer
mindrecord_dict_data task_id imagenet_iter
range _
data_list append imagenet_iter __next__
print  format transform_count
parser parse_known_args args
parser parse_known_args other_args
print args
print other_args
pickle dump other_args|file_handle
import_module args mindrecord_script| mr_api
RuntimeError  format(args mindrecord_script|)
mr_api mindrecord_task_number num_tasks
mr_api mindrecord_dict_data mindrecord_dict_data
FileWriter args mindrecord_file|args mindrecord_partitions writer
time time start_time
mr_api mindrecord_header_size header_size
writer set_header_size header_size
print  format 1<<24
mr_api mindrecord_page_size page_size
writer set_page_size page_size
print  format 1<<25
mr_api mindrecord_schema mindrecord_schema
writer add_schema mindrecord_schema|
mr_api mindrecord_index_fields index_fields
writer add_index index_fields
writer open_and_set_header
list range num_tasks task_list
args mindrecord_workers num_workers
num_tasks num_workers
task_list window_task_id
_exec_task window_task_id|False
Pool num_workers
p map _exec_task|task_list
_exec_task 0|False
writer commit ret
time time end_time
print  format end_time-start_time
print  format p map _exec_task|task_list
parser parse_known_args args mindrecord_workers num_workers
print args mindrecord_workers num_workers
pickle dump args mindrecord_workers num_workers
import_module args mindrecord_script| mr_api mindrecord_task_number num_tasks
import_module args mindrecord_script| mr_api mindrecord_dict_data mindrecord_dict_data
import_module args mindrecord_script| mr_api mindrecord_header_size header_size
import_module args mindrecord_script| mr_api mindrecord_page_size page_size
import_module args mindrecord_script| mr_api mindrecord_schema mindrecord_schema
import_module args mindrecord_script| mr_api mindrecord_index_fields index_fields
mr_api mindrecord_task_number num_tasks num_workers
FileWriter args mindrecord_file|args mindrecord_partitions writer set_header_size header_size
FileWriter args mindrecord_file|args mindrecord_partitions writer set_page_size page_size
FileWriter args mindrecord_file|args mindrecord_partitions writer add_schema mindrecord_schema|
FileWriter args mindrecord_file|args mindrecord_partitions writer add_index index_fields
FileWriter args mindrecord_file|args mindrecord_partitions writer open_and_set_header
FileWriter args mindrecord_file|args mindrecord_partitions writer commit ret
list range num_tasks task_list window_task_id
p map _exec_task 0|False
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
rconst TOP_K topk
rconst NUM_EVAL_NEGATIVES num_eval_neg
print  format end_time-start_time
num_eval_items num_items
cfg num_factors num_factors
cfg layers model_layers
[0 0|0 0|0 0|0 0] mlp_reg_layers
load_checkpoint args ckpt_file param_dict
load_param_into_net ncf_net|param_dict
PredictWithSigmoid ncf_net|topk|num_eval_neg network
Tensor np zeros [cfg eval_batch_size|1] astype(np int32) users
Tensor np zeros [cfg eval_batch_size|1] astype(np int32) items
Tensor np zeros [cfg eval_batch_size|1] astype(np float32) masks
[users|items|masks] input_data
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
Tensor np zeros [cfg eval_batch_size|1] astype(np int32) users input_data
Tensor np zeros [cfg eval_batch_size|1] astype(np int32) items input_data
Tensor np zeros [cfg eval_batch_size|1] astype(np float32) masks input_data
load_param_into_net ncf_net|param_dict
logging set_verbosity logging INFO
parser parse_args args
context set_context args device_id device_id
get_rank args rank
get_group_size args group_size
args group_size device_num
context reset_auto_parallel_context
context GRAPH_MODE mode|args device_target device_target context set_context
os path exists args output_path
os makedirs args output_path
cfg layers layers
cfg num_factors num_factors
args train_epochs epochs
print  format ds_train get_dataset_size
num_train_items num_items
layers model_layers
[0 0|0 0|0 0|0 0] mlp_reg_layers
NetWithLossClass ncf_net loss_net
TrainStepWrap loss_net|ds_train get_dataset_size|(epochs|1) train_net
train_net set_train
Model train_net model
LossMonitor per_print_times callback
[TimeMonitor ds_train get_dataset_size] callbacks
parser parse_args args group_size device_num
parser parse_args args train_epochs epochs
cfg layers layers model_layers
TrainStepWrap loss_net|ds_train get_dataset_size|(epochs|1) train_net set_train
logging set_verbosity logging INFO
parser parse_known_args _
os path exists args output_path
os makedirs args output_path
cfg layers layers
cfg num_factors num_factors
rconst TOP_K topk
rconst NUM_EVAL_NEGATIVES num_eval_neg
print  format ds_eval get_dataset_size
num_eval_items num_items
layers model_layers
[0 0|0 0|0 0|0 0] mlp_reg_layers
load_checkpoint args checkpoint_file_path param_dict
load_param_into_net ncf_net|param_dict
NetWithLossClass ncf_net loss_net
TrainStepWrap loss_net train_net
PredictWithSigmoid ncf_net|topk|num_eval_neg eval_net
NCFMetric ncf_metric
Model train_net|eval_network model
ncf_metric clear
model eval ds_eval out
os path join args output_path|args eval_file_name eval_file_path
open eval_file_path eval_file
eval_file close
int os getenv devid
cfg layers layers model_layers
TrainStepWrap loss_net train_net model
PredictWithSigmoid ncf_net|topk|num_eval_neg eval_net model
NCFMetric ncf_metric clear
Model train_net|eval_network model eval ds_eval out
open eval_file_path eval_file close
super NCFMetric|self __init__
pred_items index gt_item index
np reciprocal np log2 index|2
batch_indices asnumpy batch_indices
batch_items asnumpy batch_items
metric_weights asnumpy metric_weights
batch_items shape num_user
range user
batch_items user] batch_indices[user recommends
batch_items user items
self hr append self hit items|recommends
self ndcg append self ndcg_function items|recommends
np mean self hr|np mean self ndcg
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step learning_rate
float current_step-warmup_steps|float(decay_steps) base
(1|math cos(base|math pi))|2|base_lr learning_rate
range i
lr append _linear_warmup_learning_rate i|warmup_steps|base_lr|base_lr|0 01
lr append _cosine_learning_rate i|base_lr|warmup_steps|total_steps
lr append _cosine_learning_rate lr append _cosine_learning_rate i|base_lr|warmup_steps|total_steps
 cfg
super DenseLayer|self __init__
validator check_positive_int in_channels self in_channels
validator check_positive_int out_channels self out_channels
validator check_bool has_bias self has_bias
isinstance weight_init|Tensor
Parameter initializer weight_init|[out_channels|in_channels] self weight
isinstance bias_init|Tensor
Parameter initializer bias_init|[out_channels] self bias
P BiasAdd self bias_add
P Cast self cast
get_activation activation self activation
self cast x|mstype float16 x
self cast self weight|mstype float16 weight
self cast self bias|mstype float16 bias
self matmul x|weight output
self bias_add output|bias output
self activation output output
self cast output|mstype float32 output
 format self in_channels|self out_channels|self weight|self has_bias
super NCFModel|self __init__
num_users self num_users
num_items self num_items
num_factors self num_factors
model_layers self model_layers
mf_regularization self mf_regularization
mlp_reg_layers self mlp_reg_layers
mf_dim self mf_dim
len self model_layers self num_layers
nn Embedding self embedding_user
self embedding_initializer embedding_table
nn Embedding self embedding_item
self model_layers out_channels
P Mul self mul
self embedding_user user_input embedding_user
self embedding_item item_input embedding_item
self squeeze embedding_user mf_user_latent
self squeeze embedding_item mf_item_latent
self squeeze embedding_user mlp_user_latent
self squeeze embedding_item mlp_item_latent
self mul mf_user_latent|mf_item_latent mf_vector
self concat (mlp_user_latent|mlp_item_latent) mlp_vector
self mlp_dense1 mlp_vector mlp_vector
self mlp_dense2 mlp_vector mlp_vector
self concat (mf_vector|mlp_vector) predict_vector
self logits_dense predict_vector logits
network self network
P ZerosLike self zeroslike
P Reciprocal self reciprocal
self network batch_users|batch_items predict
self concat (self zeroslike predict) predict
self squeeze labels labels
self loss predict|labels loss
self mul loss|self squeeze valid_pt_mask loss
self mul self reducesum loss mean_loss
self network set_train
ParameterTuple network trainable_params self weights
dynamic_lr 0 01|total_steps|5000 lr
lr learning_rate
C HyperMap self hyper_map
sens self sens
_get_parallel_mode parallel_mode
_get_gradients_mean mean
_get_device_num degree
DistributedGradReducer self optimizer parameters|mean|degree self grad_reducer
self weights weights
self network batch_users|batch_items|labels|valid_pt_mask loss
P Fill P DType loss sens
self grad self network|weights(batch_users|batch_items|labels|valid_pt_mask|sens) grads
self grad_reducer grads grads
F depend loss|self optimizer grads
super PredictWithSigmoid|self __init__
P Squeeze self squeeze
k self k
num_eval_neg self num_eval_neg
P GatherV2 self gather
P Reshape self reshape
P NotEqual self notequal
self network batch_users|batch_items predicts
self reshape predicts|(-1|self num_eval_neg|1) predicts
self reshape batch_items|(-1|self num_eval_neg|1) batch_items
self reshape duplicated_masks|(-1|self num_eval_neg|1) duplicated_masks
self reducesum duplicated_masks|1 masks_sum
self notequal masks_sum|self num_eval_neg metric_weights
self topk predicts|self k indices
isinstance  format self in_channels|self out_channels|self weight|self has_bias
isinstance  format self in_channels|self out_channels|self weight|self has_bias
dynamic_lr 0 01|total_steps|5000 lr learning_rate
sys path append os path dirname os path abspath __file__
np int32 USER_DTYPE
np int32 ITEM_DTYPE
logging info
os path join data_dir|dataset|movielens RATINGS_FILE raw_rating_path
os path join data_dir|dataset|rconst RAW_CACHE_FILE cache_path
os path exists cache_path valid_cache
open cache_path|
pickle load f cached_data
_EXPECTED_CACHE_KEYS key
os remove cache_path
cached_data data
open raw_rating_path
pd read_csv f df
df groupby movielens USER_COLUMN grouped
df movielens USER_COLUMN original_users
df movielens ITEM_COLUMN original_items
{user} user_map
{item} item_map
df movielens USER_COLUMN df movielens USER_COLUMN
df movielens ITEM_COLUMN df movielens ITEM_COLUMN
len original_users num_users
len original_items num_items
df reset_index df
train_df[movielens USER_COLUMN] values astype rconst USER_DTYPE
train_df[movielens ITEM_COLUMN] values astype rconst ITEM_DTYPE
eval_df[movielens USER_COLUMN] values astype rconst USER_DTYPE
eval_df[movielens ITEM_COLUMN] values astype rconst ITEM_DTYPE
pickle HIGHEST_PROTOCOL protocol
DATASET_TO_NUM_USERS_AND_ITEMS dataset num_items
index_bounds upper
sorted_train_pos_items items
np concatenate negatives_since_last_positive
np cumsum negatives_since_last_positive
timeit default_timer start_time
np array |inner_bounds tolist|[upper_bound] index_bounds
np array_equal train_pos_users index_bounds arange num_users
train_pos_items copy sorted_train_pos_items
range i
sorted_train_pos_items sort
 total_negatives
pos_users self _pos_users
pos_items self _pos_items
num_users self _num_users
num_items self _num_items
batch_size self _batch_size
total_negatives self _total_negatives
index_bounds self _index_bounds
sorted_train_pos_items self _sorted_train_pos_items
is_training self _is_training
self _pos_users shape self _train_pos_count
int self _eval_users_per_batch
np zeros shape output
self _index_bounds negative_users left_index
self _index_bounds-1 right_index
right_index-left_index|1 num_positives
self _num_items-num_positives num_negatives
stat_utils very_slightly_biased_randint num_negatives neg_item_choice
neg_item_choice use_shortcut
np all use_shortcut
np logical_not use_shortcut not_use_shortcut
left_index not_use_shortcut left_index
right_index not_use_shortcut right_index
neg_item_choice not_use_shortcut neg_item_choice
np max num_loops
range _
(left_index|right_index)||2 mid_index
self _total_negatives mid_index right_criteria
np logical_not right_criteria left_criteria
mid_index right_criteria right_index right_criteria
mid_index left_criteria left_index left_criteria
np mod index|self _train_pos_count index_mod
self _pos_users index_mod users
np greater_equal index|self _train_pos_count negative_indices
users negative_indices negative_users
self lookup_negative_items negative_users negative_items
self _pos_items index_mod items
negative_items items negative_indices
np logical_not negative_indices labels
self _batch_size-index shape pad_length
np arange pad_length|dtype user_pad
np arange pad_length|dtype item_pad
np zeros shape label_pad
np concatenate [users|user_pad] users
np concatenate [items|item_pad] items
np concatenate [labels|label_pad] labels
np reshape users|(self _batch_size|1) users
np reshape items|(self _batch_size|1) items
np array mask_start_index|dtype mask_start_index
np expand_dims valid_pt_mask
np reshape labels|(self _batch_size|1) astype(np int32) labels
users_per_batch-users shape pad_rows
np zeros shape padding
index high_index
self _pos_items positive_items
self _assemble_eval_batch duplicate_mask
np reshape users flatten|(self _batch_size|1) users
np reshape items flatten|(self _batch_size|1) items
np reshape duplicate_mask flatten|(self _batch_size|1) duplicate_mask
self _get_train_item index
self _get_eval_item index
pos_count self pos_count
(1|num_train_negatives)|self pos_count self _num_samples
math ceil self _num_samples|self _batch_size self _num_batches
stat_utils permutation (self _num_samples|stat_utils random_int32) indices
iter batch_indices
(1|num_train_negatives)|pos_count self _num_samples
rank_id self _rank_id
rank_size self _rank_size
int math ceil self _num_samples|self _batch_size|rank_size self _batchs_per_rank
int math ceil self _batchs_per_rank|self _batch_size self _samples_per_rank
self _samples_per_rank|self _rank_size self _total_num_samples
indices tolist indices
indices extend indices
iter np array batch_indices
num_users|(1|rconst NUM_EVAL_NEGATIVES) self _eval_elements_in_epoch
self count_batches self _eval_batches_per_epoch
iter indices
(example_count|batch_size-1)||batch_size x
eval_batch_size self _eval_batch_size
int math ceil self _eval_batches_per_epoch|rank_size self _batchs_per_rank
iter np array indices
load_data data_dir|dataset num_items
data rconst TRAIN_USER_KEY train_pos_users
data rconst TRAIN_ITEM_KEY train_pos_items
data rconst EVAL_USER_KEY eval_pos_users
data rconst EVAL_ITEM_KEY eval_pos_items
 sorted_train_pos_items
construct_lookup_variables train_pos_users|train_pos_items|num_users
RandomSampler train_pos_users shape|num_neg|batch_size sampler
DistributedSamplerOfTrain train_pos_users shape|num_neg|batch_size|rank_id|rank_size sampler
parse_eval_batch_size eval_batch_size eval_batch_size
SequenceSampler eval_batch_size|num_users sampler
train_epochsiftest_trainelsetrain_epochs|1 repeat_count
ds repeat repeat_count ds
open  total_negatives
open  sorted_train_pos_items
pickle load f cached_data data
cached_data data rconst TRAIN_USER_KEY train_pos_users
cached_data data rconst TRAIN_ITEM_KEY train_pos_items
cached_data data rconst EVAL_USER_KEY eval_pos_users
cached_data data rconst EVAL_ITEM_KEY eval_pos_items
pd read_csv f df groupby movielens USER_COLUMN grouped
pd read_csv f df movielens USER_COLUMN original_users
pd read_csv f df movielens ITEM_COLUMN original_items
pd read_csv f df movielens USER_COLUMN df movielens USER_COLUMN
pd read_csv f df movielens ITEM_COLUMN df movielens ITEM_COLUMN
pd read_csv f df reset_index df
len original_users num_users self _num_users
len original_users num_users NUM_EVAL_NEGATIVES) self _eval_elements_in_epoch
len original_items num_items self _num_items
DATASET_TO_NUM_USERS_AND_ITEMS dataset num_items self _num_items
np array |inner_bounds tolist|[upper_bound] index_bounds self _index_bounds
np array_equal train_pos_users index_bounds arange num_users self _num_users
np array_equal train_pos_users index_bounds arange num_users NUM_EVAL_NEGATIVES) self _eval_elements_in_epoch
train_pos_items copy sorted_train_pos_items sort
train_pos_items copy sorted_train_pos_items self _sorted_train_pos_items
 total_negatives self _total_negatives
self _index_bounds negative_users left_index num_positives
self _index_bounds negative_users left_index not_use_shortcut left_index
self _index_bounds negative_users left_index mid_index
self _index_bounds-1 right_index not_use_shortcut right_index
self _index_bounds-1 right_index mid_index
stat_utils very_slightly_biased_randint num_negatives neg_item_choice use_shortcut
stat_utils very_slightly_biased_randint num_negatives neg_item_choice not_use_shortcut neg_item_choice
(left_index|right_index)||2 mid_index right_criteria right_index right_criteria
(left_index|right_index)||2 mid_index left_criteria left_index left_criteria
self _pos_users index_mod users negative_indices negative_users
self _pos_users index_mod users NUM_EVAL_NEGATIVES) self _eval_elements_in_epoch
self lookup_negative_items negative_users negative_items items negative_indices
np concatenate [users|user_pad] users NUM_EVAL_NEGATIVES) self _eval_elements_in_epoch
np reshape users|(self _batch_size|1) users NUM_EVAL_NEGATIVES) self _eval_elements_in_epoch
np reshape users flatten|(self _batch_size|1) users NUM_EVAL_NEGATIVES) self _eval_elements_in_epoch
stat_utils permutation (self _num_samples|stat_utils random_int32) indices tolist indices
stat_utils permutation (self _num_samples|stat_utils random_int32) indices extend indices
[ML_1M|ML_20M] DATASETS
len GENRES N_GENRE
[USER_COLUMN|ITEM_COLUMN|RATING_COLUMN|TIMESTAMP_COLUMN] RATING_COLUMNS
[ITEM_COLUMN|TITLE_COLUMN|GENRE_COLUMN] MOVIE_COLUMNS
arg_parser parse_known_args _
os path join data_dir|dataset data_subdir
[ format dataset] expected_files
tf io gfile makedirs data_subdir
set expected_files
logging info  format dataset
tempfile mkdtemp temp_dir
os path join temp_dir| format dataset zip_path
urllib request urlretrieve url|zip_path _
os stat zip_path statinfo
zipfile ZipFile zip_path| extractall temp_dir
_regularize_1m_dataset temp_dir
_regularize_20m_dataset temp_dir
tf io gfile listdir fname
tf io gfile exists os path join data_subdir|fname
tf io gfile rmtree temp_dir
[six ensure_text n|forninnames] names
tf io gfile GFile output_path|
tf io gfile GFile input_path|
f_out write b
enumerate i|line
line split separator fields
os path join temp_dir|ML_1M working_dir
os path join working_dir input_path
os path join temp_dir|RATINGS_FILE output_path
os path join temp_dir|MOVIES_FILE output_path
tf io gfile rmtree working_dir
os path join temp_dir|ML_20M working_dir
_download_and_clean dataset|data_dir
[_download_and_clean d|data_dirfordinDATASETS] _
tf io gfile GFile os path join data_dir|dataset|RATINGS_FILE
ratings_csv_to_dataframe data_dir|dataset ratings
tf io gfile GFile os path join data_dir|dataset|MOVIES_FILE
ratings merge movies|on df
df RATING_COLUMN np float32 df RATING_COLUMN
entry replace
entry split movie_genres
np zeros (len(GENRES)) output
enumerate i|genre
dataframe GENRE_COLUMN _map_fn dataframe GENRE_COLUMN
download args dataset|args data_path
enumerate line split separator fields
ratings_csv_to_dataframe data_dir|dataset ratings merge movies|on df
ratings merge movies|on df RATING_COLUMN np float32 df RATING_COLUMN
super EvalCallBack|self __init__
model self model
eval_dataset self eval_dataset
metric self metric
self metric clear
eval_file_path self eval_file_path
run_context self run_context
self model eval self eval_dataset out
open self eval_file_path eval_file
eval_file close
open self eval_file_path eval_file close
args seed
np random RandomState seed state
np arange x|dtype output
state shuffle output
np uint64 sample_dtype
max_val_vector dtype out_dtype
np mod samples|max_val_vector astype sample_dtype astype out_dtype
x sorted_x
sorted_x diffs
np concatenate diffs
np random RandomState seed state shuffle output
x sorted_x diffs
ModelConfig model_config
TrainConfig train_config
ModelBuilder model_config|train_config model_builder
model_builder get_train_eval_net deepfm_eval_net
NotImplementedError f
ModelBuilder model_config|train_config model_builder get_train_eval_net deepfm_eval_net
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
DataConfig data_config
ModelBuilder ModelConfig|TrainConfig model_builder
model_builder get_train_eval_net network
network net
Tensor np zeros [data_config batch_size|data_config data_field_size] astype(np int32) batch_ids
Tensor np zeros [data_config batch_size|data_config data_field_size] astype(np float32) batch_wts
Tensor np zeros [data_config batch_size|1] astype(np float32) labels
[batch_ids|batch_wts|labels] input_data
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
ModelBuilder ModelConfig|TrainConfig model_builder get_train_eval_net network
model_builder get_train_eval_net network net
Tensor np zeros [data_config batch_size|data_config data_field_size] astype(np int32) batch_ids input_data
Tensor np zeros [data_config batch_size|data_config data_field_size] astype(np float32) batch_wts input_data
Tensor np zeros [data_config batch_size|1] astype(np float32) labels input_data
sys path append os path dirname os path dirname os path abspath __file__
parser parse_known_args _
int os environ get rank_size
DataConfig data_config
ModelConfig model_config
TrainConfig train_config
int os getenv device_id
context GRAPH_MODE mode|args_opt device_target device_target|device_id device_id context set_context
context reset_auto_parallel_context
int os environ get rank_id
context GRAPH_MODE mode|args_opt device_target device_target context set_context
ParallelMode DATA_PARALLEL parallel_mode
get_rank rank_id
print args_opt device_target
train_config batch_size batch_size
DataType data_config data_format data_type
ds_train get_dataset_size steps_size
ModelBuilder model_config|train_config model_builder
model_builder get_train_eval_net eval_net
AUCMetric auc_metric
Model train_net|eval_network model
TimeMonitor data_size time_callback
LossCallBack loss_file_path loss_callback
[time_callback|loss_callback] callback_list
train_config ckpt_file_name_prefix|str(get_rank) train_config ckpt_file_name_prefix
os path join args_opt ckpt_path args_opt ckpt_path
args_opt ckpt_path directory
callback_list append ckpt_cb
callback_list append eval_callback
callback_list callbacks
TrainConfig train_config batch_size batch_size
TrainConfig train_config ckpt_file_name_prefix|str(get_rank) train_config ckpt_file_name_prefix
ModelBuilder model_config|train_config model_builder get_train_eval_net eval_net
model_builder get_train_eval_net eval_net model
TimeMonitor data_size time_callback callback_list
LossCallBack loss_file_path loss_callback callback_list
[time_callback|loss_callback] callback_list append ckpt_cb
[time_callback|loss_callback] callback_list append eval_callback
[time_callback|loss_callback] callback_list callbacks
sys path append os path dirname os path dirname os path abspath __file__
parser parse_known_args _
int os getenv device_id
context GRAPH_MODE mode|args_opt device_target device_target|device_id device_id context set_context
file_out write(print_str|)
DataConfig data_config
ModelConfig model_config
TrainConfig train_config
ModelBuilder model_config|train_config model_builder
model_builder get_train_eval_net eval_net
train_net set_train
eval_net set_train False
AUCMetric auc_metric
Model train_net|eval_network model
load_checkpoint args_opt checkpoint_path param_dict
load_param_into_net eval_net|param_dict
time time start
model eval ds_eval res
time time-start eval_time
time strftime time localtime time_str
print out_str
add_write str out_str
ModelBuilder model_config|train_config model_builder get_train_eval_net eval_net
model_builder get_train_eval_net eval_net set_train False
model_builder get_train_eval_net eval_net model
Model train_net|eval_network model eval ds_eval res
file_out write(out_str|)
super EvalCallBack|self __init__
model self model
eval_dataset self eval_dataset
auc_metric self aucMetric
self aucMetric clear
eval_file_path self eval_file_path
time time start_time
self model eval self eval_dataset out
int time time-start_time eval_time
time strftime time localtime time_str
print out_str
add_write self eval_file_path|out_str
super LossCallBack|self __init__
isinstance per_print_times|int
loss_file_path self loss_file_path
per_print_times self _per_print_times
run_context original_args cb_params
cb_params net_outputs asnumpy loss
(cb_params cur_step_num-1)%cb_params batch_num|1 cur_step_in_epoch
cb_params cur_step_num cur_num
open self loss_file_path|
super TimeMonitor|self __init__
data_size self data_size
time time self epoch_time
(time time-self epoch_time)|1000 epoch_mseconds
epoch_mseconds|self data_size per_step_mseconds
time time self step_time
(time time-self step_time)|1000 step_mseconds
isinstance per_print_times self _per_print_times
run_context original_args cb_params net_outputs asnumpy loss
run_context original_args cb_params cur_step_num cur_num
(time time-self epoch_time)|1000 epoch_mseconds data_size per_step_mseconds
DataConfig batch_size batch_size
DataConfig data_field_size data_field_size
DataConfig data_vocab_size data_vocab_size
 [1024|512|256|128]| deep_layer_args
[-0 01|0 01] init_args
np float32 np_type
mstype float32 ms_type
super AUCMetric|self __init__
inputs asnumpy batch_predict
inputs asnumpy batch_label
self pred_probs extend batch_predict flatten tolist
self true_labels extend batch_label flatten tolist
roc_auc_score self true_labels|self pred_probs auc
Parameter initializer Uniform max_val params
Parameter initializer shape|ms_type params
init_args max_val
enumerate i|_
var_list i method
var_map keys
Parameter initializer Uniform max_val var_map key
Parameter initializer shape|ms_type var_map key
super DenseLayer|self __init__
weight_bias_init bias_init
self _init_activation act_str self act_func
P BiasAdd self bias_add
P Cast self cast
P Mul self mul
P RealDiv self realDiv
scale_coef self scale_coef
convert_dtype self convert_dtype
use_act self use_act
act_str lower act_str
P ReLU act_func
P Sigmoid act_func
P Tanh act_func
self dropout x x
self cast x|mstype float16 x
self cast self weight|mstype float16 weight
self cast self bias|mstype float16 bias
self matmul x|weight wx
self bias_add wx|bias wx
self act_func wx wx
self cast wx|mstype float32 wx
self matmul x|self weight wx
self bias_add wx|self bias wx
deep_layer_args list
 [100|100|100]| deep_layer_args
[min|max|seeds] init_args
weight_bias_init list
 weight_bias_init
super DeepFMModel|self __init__
config batch_size self batch_size
config data_field_size self field_size
config data_vocab_size self vocab_size
config data_emb_dim self emb_dim
config deep_layer_args self deep_layer_act
config init_args self init_args
config weight_bias_init self weight_bias_init
config keep_prob self keep_prob
config convert_dtype convert_dtype
init_var_dict self init_args|init_acts var_map
var_map self fm_w
var_map self embedding_table
self field_size|self emb_dim self deep_input_dims
[self deep_input_dims]|self deep_layer_dims_list self all_dim_list
P GatherV2 self Gatherv2
P Mul self Mul
P Reshape self Reshape
P Square self Square
P Shape self Shape
P Tile self Tile
P Cast self Cast
self Reshape wt_hldr|(self batch_size|self field_size|1) mask
self Gatherv2 self fm_w|id_hldr|0 fm_id_weight
self Mul fm_id_weight|mask wx
self ReduceSum wx|1 linear_out
self Gatherv2 self embedding_table|id_hldr|0 fm_id_embs
self Mul fm_id_embs|mask vx
self ReduceSum vx|1 v1
self Square v1 v1
self Square vx v2
self ReduceSum v2|1 v2
self Reshape fm_out|(-1|1) fm_out
self Reshape vx|(-1|self field_size|self emb_dim) deep_in
self dense_layer_1 deep_in deep_in
self dense_layer_2 deep_in deep_in
self dense_layer_3 deep_in deep_in
self dense_layer_4 deep_in deep_in
self dense_layer_5 deep_in deep_out
linear_out|fm_out|deep_out out
P SigmoidCrossEntropyWithLogits self loss
network self network
l2_coef self l2_coef
self network batch_ids|batch_wts fm_id_embs
self loss predict|label log_loss
self ReduceMean_false log_loss mean_log_loss
self ReduceSum_false self Square fm_id_weight l2_loss_w
self ReduceSum_false self Square fm_id_embs l2_loss_v
self l2_coef|(l2_loss_v|l2_loss_w)|0 5 l2_loss_all
mean_log_loss|l2_loss_all loss
self network set_train
ParameterTuple network trainable_params self weights
Adam self weights|learning_rate self optimizer
C HyperMap self hyper_map
loss_scale self sens
_get_parallel_mode parallel_mode
_get_gradients_mean mean
_get_device_num degree
DistributedGradReducer self optimizer parameters|mean|degree self grad_reducer
self weights weights
self network batch_ids|batch_wts|label loss
P Fill P DType loss sens
self grad self network|weights(batch_ids|batch_wts|label|sens) grads
self grad_reducer grads grads
F depend loss|self optimizer grads
P Sigmoid self sigmoid
self sigmoid logits pred_probs
model_config self model_config
train_config self train_config
self train_config output_path directory
callback_list append ckpt_cb
AUCMetric auc_metric
callback_list append eval_callback
callback_list append loss_callback
DeepFMModel self model_config deepfm_net
NetWithLossClass deepfm_net|l2_coef loss_net
PredictWithSigmoid deepfm_net eval_net
enumerate  [100|100|100]| deep_layer_args
enumerate  weight_bias_init
self dropout x x init_args
self cast x|mstype float16 x init_args
init_var_dict self init_args|init_acts var_map self fm_w
init_var_dict self init_args|init_acts var_map self embedding_table
self ReduceSum wx|1 linear_out out
self Reshape fm_out|(-1|1) fm_out out
self dense_layer_5 deep_in deep_out out
linear_out|fm_out|deep_out out out
P SigmoidCrossEntropyWithLogits self loss loss
self loss predict|label log_loss loss
self ReduceMean_false log_loss mean_log_loss loss
self l2_coef|(l2_loss_v|l2_loss_w)|0 5 l2_loss_all loss
mean_log_loss|l2_loss_all loss loss
DeepFMModel self model_config deepfm_net loss_net
DataConfig train_num_of_parts train_num_of_parts
data_path self _hdf_data_dir
train_mode self _is_training
train_num_of_parts self _num_of_parts
test_num_of_parts self _num_of_parts
self _bin_count self _hdf_data_dir|self _file_prefix|self _num_of_parts self data_size
print  format self data_size
range part
pd read_hdf os path join hdf_data_dir| _y
_y shape size
files blocks
np arange num_of_parts parts
range _
np random shuffle parts
enumerate i|p
os path join self _hdf_data_dir|
np ceil 1 |X shape|batch_size number_of_batches
np arange X shape sample_index
np random shuffle sample_index
sample_index batch_index
X batch_index X_batch
y batch_index y_batch
pd read_hdf hdf_in|start X_all
pd read_hdf hdf_out|start y_all
data_gen __next__ finished
X X_id
X X_va
np array(X_id astype np int32) dtype
np array(X_va astype np float32) dtype
np array(y astype np float32) dtype
{} data_para
H5Dataset data_path h5_dataset
math ceil h5_dataset data_size|batch_size numbers_of_batch
h5_dataset batch_generator data_para train_eval_gen
train_eval_gen __next__
de GeneratorDataset _iter_h5_data ds
ds repeat epochs ds
train_mode shuffle
rank_size|shard_id num_shards
np array y flatten reshape batch_size|39
filenames filename
dataset_files append os path join dir_path|filename
de Schema schema
schema add_column mstype int32 de_type
schema add_column mstype float32 de_type
ds map operations ds
np array x flatten reshape batch_size|39
TFRECORD)  (default
_get_h5_dataset directory|train_mode|epochs|batch_size
DataConfig train_num_of_parts train_num_of_parts self _num_of_parts
pd read_hdf os path join hdf_data_dir| _y shape size
_y shape size num_shards
np arange X shape sample_index batch_index
np random shuffle sample_index batch_index
H5Dataset data_path h5_dataset batch_generator data_para train_eval_gen
h5_dataset batch_generator data_para train_eval_gen __next__
de GeneratorDataset _iter_h5_data ds repeat epochs ds
de GeneratorDataset _iter_h5_data ds map operations ds
de Schema schema add_column mstype int32 de_type
de Schema schema add_column mstype float32 de_type
sys path append os path dirname os path dirname os path abspath __file__
WideDeepModel config wide_deep_net
NetWithLossClass wide_deep_net|config loss_net
PredictWithSigmoid wide_deep_net eval_net
LossCallBack callback
hooks append callback
get_wide_deep_net config
config data_path data_path
config batch_size batch_size
config epochs epochs
DataType TFRECORD dataset_type
DataType MINDRECORD dataset_type
DataType H5 dataset_type
bool config parameter_server parameter_server
config vocab_cache_size cache_enable
print  format epochs
print  format ds_train get_dataset_size
print  format ds_eval get_dataset_size
ModelBuilder net_builder
net_builder get_net config eval_net
train_net set_train
AUCMetric auc_metric
Model train_net|eval_network model
EvalCallBack model|ds_eval|auc_metric|config eval_callback
LossCallBack config callback
[TimeMonitor ds_train get_dataset_size] callback_list
callback_list callbacks
WideDeepConfig wide_deep_config
wide_deep_config argparse_init
train_and_eval wide_deep_config
PredictWithSigmoid wide_deep_net eval_net model
get_wide_deep_net config data_path data_path
get_wide_deep_net config batch_size batch_size
get_wide_deep_net config epochs epochs
get_wide_deep_net config vocab_cache_size cache_enable
ModelBuilder net_builder get_net config eval_net
net_builder get_net config eval_net model
[TimeMonitor ds_train get_dataset_size] callback_list callbacks
WideDeepConfig wide_deep_config argparse_init
sys path append os path dirname os path dirname os path abspath __file__
WideDeepModel config wide_deep_net
NetWithLossClass wide_deep_net|config loss_net
VirtualDatasetCellTriple loss_net loss_net
PredictWithSigmoid wide_deep_net eval_net
VirtualDatasetCellTriple eval_net eval_net
LossCallBack callback
hooks append callback
get_wide_deep_net config
config data_path data_path
config batch_size batch_size
config epochs epochs
DataType TFRECORD dataset_type
DataType MINDRECORD dataset_type
DataType H5 dataset_type
bool config parameter_server parameter_server
print  format epochs
de config set_seed
batch_size|rank_id batch_size
print  format ds_train get_dataset_size
print  format ds_eval get_dataset_size
ModelBuilder net_builder
net_builder get_net config eval_net
train_net set_train
AUCMetric auc_metric
Model train_net|eval_network model
EvalCallBack model|ds_eval|auc_metric|config eval_callback
LossCallBack config callback
config ckpt_path directory
context set_auto_parallel_context config stra_ckpt strategy_ckpt_save_file
[TimeMonitor ds_train get_dataset_size] callback_list
callback_list append ckpoint_cb
callback_list callbacks
WideDeepConfig wide_deep_config
wide_deep_config argparse_init
wide_deep_config vocab_cache_size cache_enable
train_and_eval wide_deep_config
PredictWithSigmoid wide_deep_net eval_net model
VirtualDatasetCellTriple eval_net eval_net model
get_wide_deep_net config data_path data_path
get_wide_deep_net config batch_size batch_size
get_wide_deep_net config epochs epochs
get_wide_deep_net config ckpt_path directory
config batch_size batch_size batch_size
batch_size|rank_id batch_size batch_size
ModelBuilder net_builder get_net config eval_net
net_builder get_net config eval_net model
[TimeMonitor ds_train get_dataset_size] callback_list append ckpoint_cb
[TimeMonitor ds_train get_dataset_size] callback_list callbacks
WideDeepConfig wide_deep_config argparse_init
WideDeepConfig wide_deep_config vocab_cache_size cache_enable
WideDeepModel config WideDeep_net
NetWithLossClass WideDeep_net|config loss_net
TrainStepWrap loss_net|sparse train_net
PredictWithSigmoid WideDeep_net eval_net
LossCallBack callback
hooks append callback
get_WideDeep_net config
config data_path data_path
config batch_size batch_size
config epochs epochs
config sparse sparse
DataType TFRECORD dataset_type
DataType MINDRECORD dataset_type
DataType H5 dataset_type
print  format ds_train get_dataset_size
print  format ds_eval get_dataset_size
ModelBuilder net_builder
net_builder get_net config eval_net
train_net set_train
AUCMetric auc_metric
Model train_net|eval_network model
EvalCallBack model|ds_eval|auc_metric|config eval_callback
LossCallBack config callback
model eval ds_eval|dataset_sink_mode out
[TimeMonitor ds_train get_dataset_size] callbacks
WideDeepConfig wide_deep_config
wide_deep_config argparse_init
context GRAPH_MODE mode|wide_deep_config device_target device_target context set_context
context set_context wide_deep_config sparse enable_sparse
test_train_eval wide_deep_config
NetWithLossClass WideDeep_net|config loss_net train_net
TrainStepWrap loss_net|sparse train_net set_train
TrainStepWrap loss_net|sparse train_net model
PredictWithSigmoid WideDeep_net eval_net model
get_WideDeep_net config data_path data_path
get_WideDeep_net config batch_size batch_size
get_WideDeep_net config epochs epochs
get_WideDeep_net config sparse sparse
ModelBuilder net_builder get_net config eval_net
net_builder get_net config eval_net model
Model train_net|eval_network model eval ds_eval|dataset_sink_mode out
WideDeepConfig wide_deep_config argparse_init
WideDeepModel config WideDeep_net
PredictWithSigmoid WideDeep_net eval_net
WideDeepConfig wide_deep_config
get_WideDeep_net wide_deep_config eval_net
NotImplementedError f
super PredictWithSigmoid|self __init__
network self network
P Sigmoid self sigmoid
self sigmoid logits pred_probs
WideDeepModel config WideDeep_net
PredictWithSigmoid WideDeep_net eval_net
WideDeepConfig widedeep_config
widedeep_config argparse_init
widedeep_config ckpt_path ckpt_path
get_WideDeep_net widedeep_config net
load_checkpoint ckpt_path param_dict
load_param_into_net net|param_dict
Tensor np ones [widedeep_config eval_batch_size|widedeep_config field_size] astype(np int32) ids
Tensor np ones [widedeep_config eval_batch_size|widedeep_config field_size] astype(np float32) wts
[ids|wts] input_tensor_list
WideDeepConfig widedeep_config argparse_init
WideDeepConfig widedeep_config ckpt_path ckpt_path
Tensor np ones [widedeep_config eval_batch_size|widedeep_config field_size] astype(np int32) ids input_tensor_list
Tensor np ones [widedeep_config eval_batch_size|widedeep_config field_size] astype(np float32) wts input_tensor_list
sys path append os path dirname os path dirname os path abspath __file__
WideDeepModel config WideDeep_net
NetWithLossClass WideDeep_net|config loss_net
TrainStepWrap loss_net|sparse train_net
PredictWithSigmoid WideDeep_net eval_net
LossCallBack callback
hooks append callback
get_WideDeep_net config
config data_path data_path
config batch_size batch_size
config sparse sparse
config epochs epochs
DataType TFRECORD dataset_type
DataType MINDRECORD dataset_type
DataType H5 dataset_type
print  format epochs
batch_size|rank_id batch_size
print  format ds_train get_dataset_size
print  format ds_eval get_dataset_size
ModelBuilder net_builder
net_builder get_net config eval_net
train_net set_train
AUCMetric auc_metric
Model train_net|eval_network model
EvalCallBack model|ds_eval|auc_metric|config eval_callback
LossCallBack config callback
config ckpt_path directory
model eval ds_eval|dataset_sink_mode out
[TimeMonitor ds_train get_dataset_size] callback_list
callback_list append ckpoint_cb
callback_list callbacks
ds_train get_dataset_size sink_size
WideDeepConfig wide_deep_config
wide_deep_config argparse_init
context set_context wide_deep_config sparse enable_sparse
train_and_eval wide_deep_config
NetWithLossClass WideDeep_net|config loss_net train_net
TrainStepWrap loss_net|sparse train_net set_train
TrainStepWrap loss_net|sparse train_net model
PredictWithSigmoid WideDeep_net eval_net model
get_WideDeep_net config data_path data_path
get_WideDeep_net config batch_size batch_size
get_WideDeep_net config sparse sparse
get_WideDeep_net config epochs epochs
get_WideDeep_net config ckpt_path directory
config batch_size batch_size batch_size
batch_size|rank_id batch_size batch_size
ModelBuilder net_builder get_net config eval_net
net_builder get_net config eval_net model
Model train_net|eval_network model eval ds_eval|dataset_sink_mode out
[TimeMonitor ds_train get_dataset_size] callback_list append ckpoint_cb
[TimeMonitor ds_train get_dataset_size] callback_list callbacks
WideDeepConfig wide_deep_config argparse_init
WideDeepModel configure WideDeep_net
NetWithLossClass WideDeep_net|configure loss_net
TrainStepWrap loss_net train_net
PredictWithSigmoid WideDeep_net eval_net
LossCallBack callback
hooks append callback
get_WideDeep_net configure
configure data_path data_path
configure batch_size batch_size
configure epochs epochs
DataType TFRECORD dataset_type
DataType MINDRECORD dataset_type
DataType H5 dataset_type
print  format ds_train get_dataset_size
ModelBuilder net_builder
net_builder get_net configure _
train_net set_train
Model train_net model
LossCallBack config callback
[TimeMonitor ds_train get_dataset_size] callbacks
WideDeepConfig config
config argparse_init
context GRAPH_MODE mode|config device_target device_target context set_context
test_train config
TrainStepWrap loss_net train_net set_train
get_WideDeep_net configure data_path data_path
get_WideDeep_net configure batch_size batch_size
get_WideDeep_net configure epochs epochs
ModelBuilder net_builder get_net configure _
WideDeepConfig config argparse_init
WideDeepModel config WideDeep_net
NetWithLossClass WideDeep_net|config loss_net
TrainStepWrap loss_net train_net
PredictWithSigmoid WideDeep_net eval_net
LossCallBack callback
hooks append callback
get_WideDeep_net config
config data_path data_path
config batch_size batch_size
DataType TFRECORD dataset_type
DataType MINDRECORD dataset_type
DataType H5 dataset_type
print  format ds_eval get_dataset_size
ModelBuilder net_builder
net_builder get_net config eval_net
config ckpt_path ckpt_path
ckpt_path split ckpt_paths
build_searched_strategy config stra_ckpt strategy
ckpt_paths slice_path
load_checkpoint slice_path param_slice_dict
param_slice_dict items key|value
param_list_dict key append value
param_list_dict items key|value
merge_sliced_parameter value|strategy merged_parameter
merge_sliced_parameter value merged_parameter
merged_parameter param_dict key
load_checkpoint ckpt_path param_dict
load_param_into_net eval_net|param_dict
AUCMetric auc_metric
Model train_net|eval_network model
EvalCallBack model|ds_eval|auc_metric|config eval_callback
eval_callback callbacks
WideDeepConfig widedeep_config
widedeep_config argparse_init
context GRAPH_MODE mode|widedeep_config device_target device_target context set_context
test_eval widedeep_config
TrainStepWrap loss_net train_net model
PredictWithSigmoid WideDeep_net eval_net model
get_WideDeep_net config data_path data_path
get_WideDeep_net config batch_size batch_size
get_WideDeep_net config ckpt_path ckpt_path
ModelBuilder net_builder get_net config eval_net
net_builder get_net config eval_net model
config ckpt_path ckpt_path split ckpt_paths
ckpt_path split ckpt_paths slice_path
load_checkpoint slice_path param_slice_dict items key|value
merge_sliced_parameter value|strategy merged_parameter param_dict key
merge_sliced_parameter value merged_parameter param_dict key
EvalCallBack model|ds_eval|auc_metric|config eval_callback callbacks
WideDeepConfig widedeep_config argparse_init
sys path append os path dirname os path dirname os path abspath __file__
WideDeepModel config WideDeep_net
NetWithLossClass WideDeep_net|config loss_net
VirtualDatasetCellTriple loss_net loss_net
PredictWithSigmoid WideDeep_net eval_net
VirtualDatasetCellTriple eval_net eval_net
LossCallBack callback
hooks append callback
get_WideDeep_net config
config data_path data_path
config batch_size batch_size
config epochs epochs
DataType TFRECORD dataset_type
DataType MINDRECORD dataset_type
DataType H5 dataset_type
bool config host_device_mix host_device_mix
config sparse sparse
print  format epochs
de config set_seed
compute_manual_shape config|get_group_size
batch_size|get_group_size|data_type batch_size
batch_size|rank_id batch_size
print  format ds_train get_dataset_size
print  format ds_eval get_dataset_size
ModelBuilder net_builder
net_builder get_net config eval_net
train_net set_train
AUCMetric auc_metric
EvalCallBack eval_callback
context set_auto_parallel_context config stra_ckpt strategy_ckpt_save_file
[TimeMonitor] callback_list
callback_list append ckpoint_cb
WideDeepConfig wide_deep_config
wide_deep_config argparse_init
train_and_eval wide_deep_config
get_WideDeep_net config data_path data_path
get_WideDeep_net config batch_size batch_size
get_WideDeep_net config epochs epochs
get_WideDeep_net config sparse sparse
config batch_size batch_size batch_size
config batch_size batch_size batch_size
batch_size|get_group_size|data_type batch_size batch_size
batch_size|get_group_size|data_type batch_size batch_size
batch_size|rank_id batch_size batch_size
ModelBuilder net_builder get_net config eval_net
[TimeMonitor] callback_list append ckpoint_cb
WideDeepConfig wide_deep_config argparse_init
field_size self field_size
dense_dim self dense_dim
slot_dim self slot_dim
bool skip_id_convert self skip_id_convert
{col} self val_min_dict
{col} self val_max_dict
{col} self cat_count_dict
enumerate} i|col
self val_cols i key
float val
float val self val_max_dict key
float val self val_min_dict key
enumerate i|val
map_max_min i|val
self cat_cols i key
enumerate i|cat
map_cat_count i|cat
pickle dump self val_max_dict|file_wrt
pickle dump self val_min_dict|file_wrt
pickle dump self cat_count_dict|file_wrt
pickle load file_wrt self val_max_dict
pickle load file_wrt self val_min_dict
pickle load file_wrt self cat_count_dict
print  format list self val_max_dict items
print  format list self val_min_dict items
self cat_count_dict items key|cat_count_d
new_cat_count_d items cat_str|_
len self cat2id_dict self cat2id_dict
print  format len self cat2id_dict
print  format list self cat2id_dict items
float self val_max_dict max_v
id_list append i
weight_list append
id_list append self cat2id_dict key
weight_list append minmax_scale_value i|float val
enumerate i|cat_str
id_list append cat_str
id_list append self cat2id_dict
os path exists file_path
os makedirs file_path
line strip line
line split items
errorline_list append count
print  format count||10000
items values
items cats
recommendation_dataset_stats_dict stats_vals values
recommendation_dataset_stats_dict stats_cats cats
recommendation_dataset_stats_dict save_dict dict_output_path
int train_line_count|test_size test_size
np random seed seed
np random shuffle all_indices
print  format len all_indices
set all_indices test_indices_set
print  format len test_indices_set
print |2
FileWriter os path join output_file_path| writer_train
FileWriter os path join output_file_path| writer_test
writer_train add_schema schema|
writer_test add_schema schema|
enumerate i|line
items_error_size_lineCount append i
float items label
recommendation_dataset_stats_dict map_cat2id values|cats wts
ids_list extend ids
wts_list extend wts
label_list append label
np float32 dtype
writer_train write_raw_data train_data_list
train_data_list clear
writer_test write_raw_data test_data_list
test_data_list clear
ids_list clear
wts_list clear
label_list clear
writer_train commit
writer_test commit
print |10
print  format len items_error_size_lineCount
np save items_error_size_lineCount
parser parse_known_args _
args data_path data_path
args dense_dim|args slot_dim target_field_size
data_path data_file_path
data_path stats_output_path
mkdir_path stats_output_path
args dense_dim|slot_dim dense_dim
stats get_cat2id args threshold threshold
data_path in_file_path
data_path output_path
mkdir_path output_path
print  format list self val_max_dict items values
print  format list self val_max_dict items cats
print  format list self val_min_dict items values
print  format list self val_min_dict items cats
print  format list self cat2id_dict items values
print  format list self cat2id_dict items cats
line split items values
line split items cats
FileWriter os path join output_file_path| writer_train add_schema schema|
FileWriter os path join output_file_path| writer_train write_raw_data train_data_list
FileWriter os path join output_file_path| writer_train commit
FileWriter os path join output_file_path| writer_test add_schema schema|
FileWriter os path join output_file_path| writer_test write_raw_data test_data_list
FileWriter os path join output_file_path| writer_test commit
writer_train write_raw_data train_data_list clear
writer_test write_raw_data test_data_list clear
args data_path data_path data_file_path
args data_path data_path stats_output_path
args data_path data_path in_file_path
args data_path data_path output_path
super AUCMetric|self __init__
self clear
inputs asnumpy flatten tolist all_predict
inputs asnumpy flatten tolist all_label
self pred_probs extend all_predict
self true_labels extend all_label
roc_auc_score self true_labels|self pred_probs auc
[1024|512|256|128] self deep_layer_dim
[-0 01|0 01] self init_args
argparse_init parser
parser parse_known_args _
args device_target self device_target
args data_path self data_path
args epochs self epochs
bool args full_batch self full_batch
args batch_size self batch_size
args eval_batch_size self eval_batch_size
args field_size self field_size
args vocab_size self vocab_size
args vocab_cache_size self vocab_cache_size
args emb_dim self emb_dim
args deep_layer_dim self deep_layer_dim
args deep_layer_act self deep_layer_act
args keep_prob self keep_prob
bool args dropout_flag self dropout_flag
args output_path self output_path
args eval_file_name self eval_file_name
args loss_file_name self loss_file_name
args ckpt_path self ckpt_path
args stra_ckpt self stra_ckpt
args host_device_mix self host_device_mix
args dataset_type self dataset_type
args parameter_server self parameter_server
bool args field_slice self field_slice
bool args sparse self sparse
args deep_table_slice_mode self deep_table_slice_mode
argparse_init parser parse_known_args _
(vocabulary_size-dense_dim)||slot_dim part_size
time time start
open output_path|
range i
i%label_dim label
example append label
example extend dense_feature
range j
i%part_size sp
example]) item
time time end
print  format i|1|speed
fp write
parser parse_args args
bool args random_slot_values args random_slot_values
args dense_dim|slot_dim dense_dim
parser parse_args args dense_dim|slot_dim dense_dim
data_path self _hdf_data_dir
train_mode self _is_training
train_num_of_parts self _num_of_parts
test_num_of_parts self _num_of_parts
print  format self data_size
range part
_y shape size
files blocks
np arange num_of_parts parts
range _
np random shuffle parts
enumerate i|p
np ceil 1 |X shape|batch_size number_of_batches
np arange X shape sample_index
np random shuffle sample_index
sample_index batch_index
X batch_index X_batch
y batch_index y_batch
pd read_hdf hdf_in|start X_all
pd read_hdf hdf_out|start y_all
data_gen __next__ finished
X X_id
X X_va
np array(X_id astype np int32) dtype
X_va astype np float32 dtype
H5Dataset data_path h5_dataset
math ceil h5_dataset data_size|batch_size numbers_of_batch
h5_dataset batch_generator data_para train_eval_gen
train_eval_gen __next__
de GeneratorDataset _iter_h5_data ds
ds repeat epochs ds
int target_column|len(generate_concat_offset) part_size
range i
filled_value append generate_concat_offset[i||part_size]-1
print filled_value
np array x flatten reshape batch_size|field_size x
np array y flatten reshape batch_size|field_size y
np array z flatten reshape batch_size|1 z
np concatenate mask
train_mode shuffle
filenames filename
dataset_files append os path join dirpath|filename
de Schema schema
schema add_column mstype int32 de_type
schema add_column mstype float32 de_type
rank_size|shard_id num_shards
inidival_vocabs|| new_vocabs
int target_column_number|worker_size part_size
new_vocab_size append sum new_vocabs
[per_vocab_size]|worker_size new_vocab_size
sum new_vocab_size cur_sum
total_vocab_size|cur_sum k
sum new_vocab_size
total_vocab_size- new_vocab_size
range worker_size i
index_offsets off
index_offsets append off
print index_offsets
tuple manual_shape
sum new_vocab_size vocab_total
(config field_size||worker_size|1)|worker_size target_column
target_column config field_size
manual_shape config manual_shape
int vocab_total config vocab_size
rank_size|rank_id rank_size
_get_h5_dataset data_dir|train_mode|epochs|batch_size
_y shape size num_shards
_y shape size k
_y shape size rank_size
np arange X shape sample_index batch_index
np random shuffle sample_index batch_index
X X_va astype np float32 dtype
H5Dataset data_path h5_dataset batch_generator data_para train_eval_gen
h5_dataset batch_generator data_para train_eval_gen __next__
de GeneratorDataset _iter_h5_data ds repeat epochs ds
de Schema schema add_column mstype int32 de_type
de Schema schema add_column mstype float32 de_type
sum new_vocab_size cur_sum k
tuple manual_shape config manual_shape
(config field_size||worker_size|1)|worker_size target_column config field_size
rank_size|rank_id rank_size rank_size
np float32 np_type
mstype float32 ms_type
Parameter initializer params
Parameter initializer shape|ms_type params
init_args _max_val
enumerate _|iterm
iterm method
var_map keys
Parameter initializer var_map key
super DenseLayer|self __init__
weight_bias_init bias_init
init_method self weight
self _init_activation act_str self act_func
P BiasAdd self bias_add
P Cast self cast
Dropout keep_prob self dropout
use_activation self use_activation
convert_dtype self convert_dtype
drop_out self drop_out
act_str lower act_str
P ReLU act_func
P Sigmoid act_func
P Tanh act_func
self dropout x x
self cast x|mstype float16 x
self cast self weight|mstype float16 weight
self cast self bias|mstype float16 bias
self matmul x|weight wx
self bias_add wx|bias wx
self act_func wx wx
self cast wx|mstype float32 wx
self matmul x|self weight wx
self bias_add wx|self bias wx
super WideDeepModel|self __init__
config batch_size self batch_size
bool config host_device_mix host_device_mix
bool config parameter_server parameter_server
context get_auto_parallel_context parallel_mode
parallel_modein ParallelMode SEMI_AUTO_PARALLEL|ParallelMode AUTO_PARALLEL is_auto_parallel
self batch_size|get_group_size self batch_size
config field_slice is_field_slice
config sparse sparse
config field_size self field_size
config vocab_size self vocab_size
config vocab_cache_size self vocab_cache_size
config emb_dim self emb_dim
config deep_layer_dim self deep_layer_dims_list
config deep_layer_act self deep_layer_act
config init_args self init_args
config weight_bias_init self bias_init
config weight_bias_init self weight_bias_init
config emb_init self emb_init
config dropout_flag self drop_out
config keep_prob self keep_prob
self field_size|self emb_dim self deep_input_dims
self deep_layer_dims_list self layer_dims
[self deep_input_dims]|self layer_dims self all_dim_list
[ |self emb_init] init_acts
init_var_dict self init_args|init_acts var_map
var_map self wide_b
P Mul self wide_mul
P Mul self deep_mul
P Reshape self reshape
P Reshape self deep_reshape
P Square self square
P Shape self shape
P Tile self tile
P Unique shard ((1|)) self unique
P GatherV2 self wide_gatherv2
P GatherV2 self deep_gatherv2
self dense_layer_1 dropout dropout shard ((1|get_group_size)|)
self dense_layer_1 dropout dropout_do_mask shard ((1|get_group_size)|)
self dense_layer_1 matmul shard ((1|get_group_size)|(get_group_size|1))
self dense_layer_1 matmul add_prim_attr self field_size
self deep_mul shard ((1|1|get_group_size)|(1|1|1))
self deep_reshape add_prim_attr True
self reduce_sum add_prim_attr True
self deep_embeddinglookup embedding_table self embedding_table
nn EmbeddingLookup FIELD_SLICE slice_mode
self deep_mul shard ((1|get_group_size|1)|(1|get_group_size|1))
self wide_mul shard ((1|get_group_size|1)|(1|get_group_size|1))
self reduce_sum shard ((1|get_group_size|1)|)
self vocab_cache_size cache_enable
nn EmbeddingLookup TABLE_ROW_SLICE slice_mode
self deep_embeddinglookup embedding_table set_param_ps
self wide_embeddinglookup embedding_table set_param_ps
self wide_embeddinglookup id_hldr wide_id_weight
self deep_embeddinglookup id_hldr deep_id_embs
self reshape wt_hldr|(self batch_size|self field_size|1) mask
self wide_mul wide_id_weight|mask wx
self reshape self reduce_sum wx|1|self wide_b|(-1|1) wide_out
self deep_mul deep_id_embs|mask vx
self deep_reshape vx|(-1|self field_size|self emb_dim) deep_in
self dense_layer_1 deep_in deep_in
self dense_layer_2 deep_in deep_in
self dense_layer_3 deep_in deep_in
self dense_layer_4 deep_in deep_in
self dense_layer_5 deep_in deep_out
wide_out|deep_out out
network self network
config l2_coef self l2_coef
P SigmoidCrossEntropyWithLogits self loss
self reduceMean_false add_prim_attr True
self network batch_ids|batch_wts embedding_table
self loss predict|label log_loss
self reduceMean_false log_loss wide_loss
wide_loss deep_loss
self reduceSum_false self square embedding_table|2 l2_loss_v
self reduceMean_false log_loss|self l2_coef|l2_loss_v deep_loss
super IthOutputCell|self __init__
output_index self output_index
self network x1|x2|x3[self output_index] predict
super TrainStepWrap|self __init__
self network set_train
network trainable_params self trainable_params
self trainable_params params
weights_w append params
weights_d append params
ParameterTuple weights_w self weights_w
ParameterTuple weights_d self weights_d
LazyAdam self optimizer_d
Adam self optimizer_d
C HyperMap self hyper_map
sens self sens
self loss_net_w set_grad
self loss_net_d set_grad
context get_auto_parallel_context mean
context get_auto_parallel_context degree
DistributedGradReducer self optimizer_w parameters|mean|degree self grad_reducer_w
DistributedGradReducer self optimizer_d parameters|mean|degree self grad_reducer_d
self weights_w weights_w
self weights_d weights_d
self network batch_ids|batch_wts|label loss_d
P Fill P DType loss_w sens_w
P Fill P DType loss_d sens_d
self grad_reducer_w grads_w grads_w
self grad_reducer_d grads_d grads_d
super PredictWithSigmoid|self __init__
P Sigmoid self sigmoid
context get_auto_parallel_context full_batch
self sigmoid shard ((1|1)|)
self sigmoid logits pred_probs
enumerate iterm method
init_var_dict self init_args|init_acts var_map self wide_b
self reshape self reduce_sum wx|1|self wide_b|(-1|1) wide_out out
self dense_layer_5 deep_in deep_out out
wide_out|deep_out out out
self reduceMean_false log_loss wide_loss deep_loss
file_out write(out_str|)
super LossCallBack|self __init__
isinstance per_print_times|int
per_print_times self _per_print_times
config self config
run_context original_args cb_params
cb_params net_outputs asnumpy|cb_params net_outputs asnumpy deep_loss
(cb_params cur_step_num-1)%cb_params batch_num|1 cur_step_in_epoch
cb_params cur_step_num cur_num
context get_auto_parallel_context parallel_mode
get_rank rank_id
open self config loss_file_name loss_file
loss_file write
loss_file close
super EvalCallBack|self __init__
isinstance print_per_step|int
print_per_step self print_per_step
model self model
eval_dataset self eval_dataset
auc_metric self aucMetric
self aucMetric clear
config eval_file_name self eval_file_name
config sparse self sparse
time time start_time
self model eval self eval_dataset|dataset_sink_mode out
time time end_time
int end_time-start_time eval_time
time strftime time localtime time_str
format time_str|rank_id|out values|eval_time
print out_str
out values self eval_values
add_write self eval_file_name|out_str
isinstance per_print_times self _per_print_times
isinstance int end_time-start_time eval_time
run_context original_args cb_params net_outputs asnumpy|cb_params net_outputs asnumpy deep_loss
run_context original_args cb_params cur_step_num cur_num
open self config loss_file_name loss_file write
open self config loss_file_name loss_file close
isinstance print_per_step self print_per_step
isinstance int end_time-start_time eval_time
self model eval self eval_dataset|dataset_sink_mode out values self eval_values
{col} self val_min_dict
{col} self val_max_dict
{col} self cat_count_dict
enumerate} i|col
self val_cols i key
float val
float val self val_max_dict key
float val self val_min_dict key
enumerate i|val
map_max_min i|val
self cat_cols i key
enumerate i|cat
map_cat_count i|cat
pickle dump self val_max_dict|file_wrt
pickle dump self val_min_dict|file_wrt
pickle dump self cat_count_dict|file_wrt
pickle load file_wrt self val_max_dict
pickle load file_wrt self val_min_dict
pickle load file_wrt self cat_count_dict
print  format list self val_max_dict items
print  format list self val_min_dict items
self cat_count_dict items key|cat_count_d
new_cat_count_d items cat_str|_
len self cat2id_dict self cat2id_dict
print  format len self cat2id_dict
print  format self cat2id_dict items
float self val_max_dict max_v
id_list append i
weight_list append
id_list append self cat2id_dict key
weight_list append minmax_sclae_value i|float val
enumerate i|cat_str
id_list append self cat2id_dict
os path exists file_path
os makedirs file_path
line strip line
line strip items
errorline_list append count
print  format line
print  format count||10000
items values
items cats
recommendation_dataset_stats stats_vals values
recommendation_dataset_stats stats_cats cats
recommendation_dataset_stats save_dict output_path
file_out write(wr_str|)
int TRAIN_LINE_COUNT|test_size test_size
np random seed seed
np random shuffle all_indices
print  format len all_indices
set all_indices test_indices_set
print  format len test_indices_set
print |2
os path join output_path train_feature_file_name
os path join output_path train_label_file_name
os path join output_path test_feature_file_name
os path join output_path test_label_file_name
enumerate i|line
line split items
float items label
recommendation_dataset_stats map_cat2id values|cats wts
train_feature_list append ids|wts
train_label_list append label
test_feature_list append ids|wts
test_label_list append label
parser parse_known_args _
args raw_data_path base_path
RecommendationDatasetStatsDict recommendation_dataset_stat
base_path datafile_path
base_path stats_out_path
mkdir_path stats_out_path
statsdata datafile_path|stats_out_path|recommendation_dataset_stat
print |10
base_path infile_path
mkdir_path args output_path
print  format list self val_max_dict items values
print  format list self val_max_dict items cats
print  format list self val_min_dict items values
print  format list self val_min_dict items cats
print  format self cat2id_dict items values
print  format self cat2id_dict items cats
line strip items values
line strip items cats
print  format line split items
enumerate line split items
args raw_data_path base_path datafile_path
args raw_data_path base_path stats_out_path
args raw_data_path base_path infile_path
sys path append os path dirname os path dirname os path abspath __file__
WideDeepModel config WideDeep_net
NetWithLossClass WideDeep_net|config loss_net
TrainStepWrap loss_net|config train_net
PredictWithSigmoid WideDeep_net eval_net
LossCallBack callback
hooks append callback
get_WideDeep_net config
config data_path data_path
config epochs epochs
print  format epochs
print  format ds_train get_dataset_size
print  format ds_eval get_dataset_size
ModelBuilder net_builder
net_builder get_net config eval_net
train_net set_train
AUCMetric auc_metric
Model train_net|eval_network model
EvalCallBack model|ds_eval|auc_metric|config eval_callback
LossCallBack config callback
WideDeepConfig wide_and_deep_config
wide_and_deep_config argparse_init
compute_emb_dim wide_and_deep_config
train_and_eval wide_and_deep_config
TrainStepWrap loss_net|config train_net set_train
TrainStepWrap loss_net|config train_net model
PredictWithSigmoid WideDeep_net eval_net model
get_WideDeep_net config data_path data_path
get_WideDeep_net config epochs epochs
ModelBuilder net_builder get_net config eval_net
net_builder get_net config eval_net model
WideDeepConfig wide_and_deep_config argparse_init
WideDeepModel config WideDeep_net
PredictWithSigmoid WideDeep_net eval_net
WideDeepConfig wide_deep_config
get_WideDeep_net wide_deep_config eval_net
NotImplementedError f
sys path append os path dirname os path dirname os path abspath __file__
WideDeepModel config WideDeep_net
NetWithLossClass WideDeep_net|config loss_net
TrainStepWrap loss_net|config train_net
PredictWithSigmoid WideDeep_net eval_net
LossCallBack callback
hooks append callback
get_WideDeep_net config
config data_path data_path
config epochs epochs
print  format epochs
config batch_size|is_tf_dataset batch_size
print  format ds_train get_dataset_size
print  format ds_eval get_dataset_size
ModelBuilder net_builder
net_builder get_net config eval_net
train_net set_train
AUCMetric auc_metric
Model train_net|eval_network model
EvalCallBack model|ds_eval|auc_metric|config eval_callback
LossCallBack config callback
config ckpt_path directory
[TimeMonitor ds_train get_dataset_size] callback_list
callback_list append ckpoint_cb
callback_list|sink_size callbacks
WideDeepConfig wide_and_deep_config
wide_and_deep_config argparse_init
compute_emb_dim wide_and_deep_config
train_and_eval wide_and_deep_config
TrainStepWrap loss_net|config train_net set_train
TrainStepWrap loss_net|config train_net model
PredictWithSigmoid WideDeep_net eval_net model
get_WideDeep_net config data_path data_path
get_WideDeep_net config epochs epochs
get_WideDeep_net config batch_size|is_tf_dataset batch_size
get_WideDeep_net config ckpt_path directory
ModelBuilder net_builder get_net config eval_net
net_builder get_net config eval_net model
[TimeMonitor ds_train get_dataset_size] callback_list append ckpoint_cb
[TimeMonitor ds_train get_dataset_size] callback_list callbacks
WideDeepConfig wide_and_deep_config argparse_init
sys path append os path dirname os path dirname os path abspath __file__
WideDeepModel config WideDeep_net
NetWithLossClass WideDeep_net|config loss_net
TrainStepWrap loss_net|config train_net
PredictWithSigmoid WideDeep_net eval_net
LossCallBack callback
hooks append callback
get_WideDeep_net config
config data_path data_path
config epochs epochs
print  format epochs
print  format ds_eval get_dataset_size
ModelBuilder net_builder
net_builder get_net config eval_net
load_checkpoint config ckpt_path param_dict
load_param_into_net eval_net|param_dict
AUCMetric auc_metric
Model train_net|eval_network model
EvalCallBack model|ds_eval|auc_metric|config eval_callback
eval_callback callbacks
WideDeepConfig wide_and_deep_config
wide_and_deep_config argparse_init
compute_emb_dim wide_and_deep_config
train_and_eval wide_and_deep_config
TrainStepWrap loss_net|config train_net model
PredictWithSigmoid WideDeep_net eval_net model
get_WideDeep_net config data_path data_path
get_WideDeep_net config epochs epochs
ModelBuilder net_builder get_net config eval_net
net_builder get_net config eval_net model
EvalCallBack model|ds_eval|auc_metric|config eval_callback callbacks
WideDeepConfig wide_and_deep_config argparse_init
test_df groupby gb_key data_groups
batch_groups df
df head topk df
df values preds
df values labels
np sum labels
results append average_precision_score labels|preds
results append
np argsort y_preds ind_list
set ind_list
list ind_list index label rank
zip label|preds
ap_score label|preds|topk mAP
mAP_list append mAP
time time total_start
test_df display_ids
test_df labels
test_df predictions
np split predictions tolist|display_ids_idx tolist preds
np split labels tolist|display_ids_idx tolist labels
ele_l|[0 0foriinrange 30-len(ele_l)] res_list
range idx
labels batch_labels
preds batch_preds
mean_AP_topk batch_labels|batch_preds|topk meanAP
result_list extend meanAP
np mean result_list mean_AP
print  format time time-total_start
print  format mean_AP
super AUCMetric|self __init__
inputs asnumpy all_predict
inputs asnumpy all_label
inputs asnumpy all_display_id
self true_labels extend all_label flatten tolist
self pred_probs extend all_predict flatten tolist
self display_id extend all_display_id flatten tolist
 result_df
roc_auc_score self true_labels|self pred_probs auc
print  format auc|MAP
batch_groups df head topk df
batch_groups df values preds
batch_groups df values labels
df values preds batch_preds
df values preds meanAP
df values labels batch_labels
df values labels meanAP
np sum labels batch_labels
np sum labels meanAP
results append average_precision_score labels batch_labels
results append average_precision_score preds batch_preds
results append average_precision_score  result_df
zip preds batch_preds
zip  result_df
test_df labels batch_labels
test_df labels meanAP
np split predictions tolist|display_ids_idx tolist preds batch_preds
np split predictions tolist|display_ids_idx tolist preds meanAP
np split labels tolist|display_ids_idx tolist labels batch_labels
np split labels tolist|display_ids_idx tolist labels meanAP
labels batch_labels meanAP
preds batch_preds meanAP
[-0 01|0 01] self init_args
argparse_init parser
parser parse_known_args _
args data_path self data_path
args epochs self epochs
args batch_size self batch_size
args eval_batch_size self eval_batch_size
args deep_layers_act self deep_layers_act
args keep_prob self keep_prob
args l2_coef self l2_coef
args ftrl_lr self ftrl_lr
args adam_lr self adam_lr
bool args is_tf_dataset self is_tf_dataset
args output_path self output_path
args eval_file_name self eval_file_name
args loss_file_name self loss_file_name
args ckpt_path self ckpt_path
bool args dropout_flag self dropout_flag
argparse_init parser parse_known_args _
data_path self _hdf_data_dir
train_mode self _is_training
train_num_of_parts self _num_of_parts
test_num_of_parts self _num_of_parts
print  format self data_size
range part
pd read_hdf _y
_y shape size
files blocks
np arange num_of_parts parts
range _
np random shuffle parts
enumerate i|p
np ceil 1 |X shape|batch_size number_of_batches
np arange X shape sample_index
np random shuffle sample_index
X batch_index X_batch
y batch_index y_batch
self _iterate_hdf_files_ hdf_in|hdf_out|_
pd read_hdf hdf_in|start X_all
pd read_hdf hdf_out|start y_all
data_gen __next__ finished
X X_id
X X_va
np array(X_id astype np int32) dtype
X_va astype np float32 dtype
H5Dataset data_path h5_dataset
math ceil h5_dataset data_size|batch_size numbers_of_batch
h5_dataset batch_generator data_para train_eval_gen
train_eval_gen __next__
ds repeat epochs ds
bool train_mode shuffle
filenames filename
dataset_files append os path join dirpath|filename
de Schema schema
schema_dict items key|attr_dict
print  format key|attr_dict
columns_list append key
set float_key_list
mstype float32 ms_dtype
mstype int32 ms_dtype
ms_dtype de_type
rank_size num_shards
rank_id shard_id
columns_list key
print |10
print input_shape_dict
print schema_dict
np asarray a reshape batch_size| a
np array b flatten reshape batch_size|-1 b
np array c flatten reshape batch_size|-1 c
np array d flatten reshape batch_size|-1 d
np array e flatten reshape batch_size|-1 e
np array f flatten reshape batch_size|-1 f
np array g flatten reshape batch_size|-1 g
np array h flatten reshape batch_size|-1 h
np array i flatten reshape batch_size|-1 i
np array j flatten reshape batch_size|-1 j
np array k flatten reshape batch_size|-1 k
np array l flatten reshape batch_size|-1 l
np array m flatten reshape batch_size|-1 m
np array n flatten reshape batch_size|-1 n
np array o flatten reshape batch_size|-1 o
np array p flatten reshape batch_size|-1 p
np array q flatten reshape batch_size|-1 q
np array r flatten reshape batch_size|-1 r
np array s flatten reshape batch_size|-1 s
np array t flatten reshape batch_size|-1 t
np array u flatten reshape batch_size|-1 u
ds map ds
mixup operations
pickle load file_in input_shape_dict
input_shape_dict items key|shape
len shape
shape input_field_size key
input_field_size| config input_emb_dim
len multi_key_list
print os path join(data_dir|)
pickle load file_in schema_dict
os path join(data_dir|)
_get_h5_dataset data_dir|train_mode|epochs|batch_size
pd read_hdf _y shape size
_y shape size config input_emb_dim
X X_va astype np float32 dtype
H5Dataset data_path h5_dataset batch_generator data_para train_eval_gen
h5_dataset batch_generator data_para train_eval_gen __next__
mstype float32 ms_dtype de_type
mstype int32 ms_dtype de_type
print input_shape_dict items key|shape
np array e flatten reshape batch_size|-1 e config input_emb_dim
pickle load file_in input_shape_dict items key|shape
input_shape_dict items shape input_field_size key
len shape input_field_size key
np float32 np_type
mstype float32 ms_type
Parameter initializer shape|ms_type params
Parameter Tensor params
init_args _max_val
enumerate _|iterm
iterm method
var_map keys
Parameter Tensor var_map key
super DenseLayer|self __init__
weight_bias_init bias_init
self _init_activation act_str self act_func
P BiasAdd self bias_add
P Cast self cast
Dropout keep_prob self dropout
P Mul self mul
P RealDiv self realDiv
scale_coef self scale_coef
use_activation self use_activation
convert_dtype self convert_dtype
drop_out self drop_out
act_str lower act_str
P ReLU act_func
P Sigmoid act_func
P Tanh act_func
self dropout x x
self cast x|mstype float16 x
self cast self weight|mstype float16 weight
self cast self bias|mstype float16 bias
self matmul x|weight wx
self bias_add wx|bias wx
self act_func wx wx
self cast wx|mstype float32 wx
self matmul x|self weight wx
self bias_add wx|self bias wx
super WideDeepModel|self __init__
[1024|1024|1024|1024|1024] deep_dim_list
[0 0|0 0] wide_reg_coef
[0 0|0 0] deep_reg_coef
config input_emb_dim self input_emb_dim
config batch_size self batch_size
config deep_layers_act self deep_layer_act
config init_args self init_args
config weight_bias_init self bias_init
config weight_bias_init self weight_bias_init
config emb_init self emb_init
config keep_prob self keep_prob
deep_dim_list self layer_dims
[self input_emb_dim]|self layer_dims self all_dim_list
emb_128_size self emb_128_size
emb64_single_size self emb64_single_size
emb64_multi_size self emb64_multi_size
indicator_size self indicator_size
wide_reg_coef self wide_l2_coef
deep_reg_coef self deep_l2_coef
wide_lr self wide_lr
deep_lr self deep_lr
init_var_dict self init_args|init_acts_embedding_metrix var_map
var_map self emb128_embedding
var_map self emb64_single
var_map self emb64_multi
var_map self emb64_indicator
init_var_dict self init_args|init_acts_wide_weight var_map
var_map self wide_continue_w
var_map self wide_emb128_w
var_map self wide_emb64_single_w
var_map self wide_emb64_multi_w
var_map self wide_indicator_w
var_map self wide_bias
config dropout_flag drop_out
P GatherV2 self gather_v2
P Reshape self reshape
P Square self square
P Shape self shape
P Tile self tile
P BiasAdd self BiasAdd
P ExpandDims self expand_dims
Flatten self flatten
continue_val val_hldr
indicator_id ind_hldr
emb_128_id emb128_id_hldr
emb_64_single_id emb64_single_hldr
self gather_v2 self emb64_indicator|ind_hldr|0 ind_emb
self flatten ind_emb ind_emb
self flatten emb128_id_emb emb128_id_emb
self gather_v2 self emb64_single|emb64_single_hldr|0 emb64_sgl_emb
self flatten emb64_sgl_emb emb64_sgl_emb
self mul mult_emb_1
self cast mult_emb_1|mstype float32
self reduceMean_false mult_emb_1|1 mult_emb_1
self mul mult_emb_2
self cast mult_emb_2|mstype float32
self reduceMean_false mult_emb_2|1 mult_emb_2
self mul mult_emb_3
self cast mult_emb_3|mstype float32
self reduceMean_false mult_emb_3|1 mult_emb_3
self mul mult_emb_4
self cast mult_emb_4|mstype float32
self reduceMean_false mult_emb_4|1 mult_emb_4
self mul mult_emb_5
self cast mult_emb_5|mstype float32
self reduceMean_false mult_emb_5|1 mult_emb_5
self gather_v2 self emb64_multi|multi_doc_ad_topic_id|0 mult_emb_6
self mul mult_emb_6
self cast mult_emb_6|mstype float32
self reduceMean_false mult_emb_6|1 mult_emb_6
self dense_layer_1 input_embedding deep_out
self dense_layer_2 deep_out deep_out
self dense_layer_3 deep_out deep_out
self dense_layer_4 deep_out deep_out
self dense_layer_5 deep_out deep_out
self deep_predict deep_out deep_out
self reduce_sum_true val_weight|1 val_w_sum
self gather_v2 self wide_indicator_w|ind_hldr|0 ind_weight
self reduce_sum_true ind_weight|1 ind_w_sum
self reduce_sum_true emb128_id_weight|1 emb128_w_sum
self reduce_sum_true emb64_sgl_weight|1 emb64_w_sum
self mul mult_weight_1
self cast mult_weight_1|mstype float32
self reduce_sum_true mult_weight_1|1 mult_weight_1
self mul mult_weight_2
self cast mult_weight_2|mstype float32
self reduce_sum_true mult_weight_2|1 mult_weight_2
self mul mult_weight_3
self cast mult_weight_3|mstype float32
self reduce_sum_true mult_weight_3|1 mult_weight_3
self mul mult_weight_4
self cast mult_weight_4|mstype float32
self reduce_sum_true mult_weight_4|1 mult_weight_4
self mul mult_weight_5
self cast mult_weight_5|mstype float32
self reduce_sum_true mult_weight_5|1 mult_weight_5
self mul mult_weight_6
self cast mult_weight_6|mstype float32
self reduce_sum_true mult_weight_6|1 mult_weight_6
mult_weight_1|mult_weight_2|mult_weight_3|mult_weight_4|mult_weight_5|mult_weight_6 mult_weight_sum
self BiasAdd wide_out
wide_out|deep_out out
network self network
config l2_coef self l2_coef
P SigmoidCrossEntropyWithLogits self loss
self network _
self reshape predict|(-1|) predict
self loss predict|label basic_loss
self reduceMean_false basic_loss wide_loss
self reduceMean_false basic_loss deep_loss
super IthOutputCell|self __init__
output_index self output_index
super TrainStepWrap|self __init__
self network set_train
network trainable_params self trainable_params
self trainable_params params
weights_w append params
weights_d append params
ParameterTuple weights_w self weights_w
ParameterTuple weights_d self weights_d
self weights_w params
config adam_lr learning_rate
C HyperMap self hyper_map
sens self sens
self loss_net_w set_grad
context get_auto_parallel_context parallel_mode
context get_auto_parallel_context mean
context get_auto_parallel_context degree
DistributedGradReducer self grad_reducer_w
DistributedGradReducer self grad_reducer_d
self weights_w weights_w
self weights_d weights_d
self network loss_d
P Fill P DType loss_w sens_w
P Fill P DType loss_d sens_d
self grad_w self loss_net_w|weights_w grads_w
self grad_d self loss_net_d|weights_d grads_d
self grad_reducer_w grads_w grads_w
self grad_reducer_d grads_d grads_d
F depend loss_w|self optimizer_w grads_w
super PredictWithSigmoid|self __init__
P Sigmoid self sigmoid
self reshape logits|(-1|) logits
self sigmoid logits pred_probs
enumerate iterm method
P Mul self mul mult_weight_sum
[1024|1024|1024|1024|1024] deep_dim_list self layer_dims
[0 0|0 0] wide_reg_coef self wide_l2_coef
[0 0|0 0] deep_reg_coef self deep_l2_coef
init_var_dict self init_args|init_acts_embedding_metrix var_map self emb128_embedding
init_var_dict self init_args|init_acts_embedding_metrix var_map self emb64_single
init_var_dict self init_args|init_acts_embedding_metrix var_map self emb64_multi
init_var_dict self init_args|init_acts_embedding_metrix var_map self emb64_indicator
init_var_dict self init_args|init_acts_embedding_metrix var_map self wide_continue_w
init_var_dict self init_args|init_acts_embedding_metrix var_map self wide_emb128_w
init_var_dict self init_args|init_acts_embedding_metrix var_map self wide_emb64_single_w
init_var_dict self init_args|init_acts_embedding_metrix var_map self wide_emb64_multi_w
init_var_dict self init_args|init_acts_embedding_metrix var_map self wide_indicator_w
init_var_dict self init_args|init_acts_embedding_metrix var_map self wide_bias
init_var_dict self init_args|init_acts_wide_weight var_map self wide_continue_w
init_var_dict self init_args|init_acts_wide_weight var_map self wide_emb128_w
init_var_dict self init_args|init_acts_wide_weight var_map self wide_emb64_single_w
init_var_dict self init_args|init_acts_wide_weight var_map self wide_emb64_multi_w
init_var_dict self init_args|init_acts_wide_weight var_map self wide_indicator_w
init_var_dict self init_args|init_acts_wide_weight var_map self wide_bias
self dense_layer_1 input_embedding deep_out out
self dense_layer_2 deep_out deep_out out
self dense_layer_3 deep_out deep_out out
self dense_layer_4 deep_out deep_out out
self dense_layer_5 deep_out deep_out out
self deep_predict deep_out deep_out out
self mul mult_weight_1 mult_weight_sum
self reduce_sum_true mult_weight_1|1 mult_weight_1 mult_weight_sum
self mul mult_weight_2 mult_weight_sum
self reduce_sum_true mult_weight_2|1 mult_weight_2 mult_weight_sum
self mul mult_weight_3 mult_weight_sum
self reduce_sum_true mult_weight_3|1 mult_weight_3 mult_weight_sum
self mul mult_weight_4 mult_weight_sum
self reduce_sum_true mult_weight_4|1 mult_weight_4 mult_weight_sum
self mul mult_weight_5 mult_weight_sum
self reduce_sum_true mult_weight_5|1 mult_weight_5 mult_weight_sum
self mul mult_weight_6 mult_weight_sum
self reduce_sum_true mult_weight_6|1 mult_weight_6 mult_weight_sum
self BiasAdd wide_out out
wide_out|deep_out out out
file_out write(out_str|)
super LossCallBack|self __init__
isinstance per_print_times|int
per_print_times self _per_print_times
config self config
run_context original_args cb_params
cb_params net_outputs asnumpy| deep_loss
cb_params net_outputs asnumpy
(cb_params cur_step_num-1)%cb_params batch_num|1 cur_step_in_epoch
cb_params cur_step_num cur_num
open self config loss_file_name loss_file
loss_file write
loss_file close
super EvalCallBack|self __init__
isinstance print_per_step|int
print_per_step self print_per_step
model self model
eval_dataset self eval_dataset
auc_metric self aucMetric
self aucMetric clear
config eval_file_name self eval_file_name
time time start_time
self model eval self eval_dataset out
time time end_time
int end_time-start_time eval_time
time strftime time localtime time_str
print out_str
add_write self eval_file_name|out_str
isinstance per_print_times self _per_print_times
isinstance int end_time-start_time eval_time
run_context original_args cb_params net_outputs asnumpy| deep_loss
run_context original_args cb_params net_outputs asnumpy
run_context original_args cb_params cur_step_num cur_num
open self config loss_file_name loss_file write
open self config loss_file_name loss_file close
isinstance print_per_step self print_per_step
isinstance int end_time-start_time eval_time
GAT args|kwargs
gat args|kwargs
NotImplementedError f
parser parse_args args_opt
[1|3312|3703] feature_size
[1|3312|3312] biases_size
[1|2708|1433] feature_size
[1|2708|2708] biases_size
GatConfig hid_units hid_units
GatConfig n_heads n_heads
np random uniform 0 0|1 0|size feature
np random uniform 0 0|1 0|size biases
feature shape feature_size
feature shape num_nodes
gat_net set_train False
gat_net net
np random uniform 0 0|1 0|size feature shape feature_size
np random uniform 0 0|1 0|size feature shape num_nodes
argparse ArgumentParser parser
parser parse_args args
os path exists
os mkdir
GatConfig hid_units hid_units
GatConfig n_heads n_heads
GatConfig early_stopping early_stopping
GatConfig lr lr
GatConfig l2_coeff l2_coeff
GatConfig num_epochs num_epochs
feature shape feature_size
feature shape num_nodes
y_train shape num_class
GatConfig attn_dropout attn_drop
Tensor feature feature
Tensor biases biases
train_net set_train True
np inf val_loss_min
range _epoch
train_net feature|biases train_result
train_result asnumpy train_loss
train_result asnumpy train_acc
eval_net feature|biases eval_result
eval_result asnumpy eval_loss
eval_result asnumpy eval_acc
eval_acc val_acc_model
eval_loss val_loss_model
os remove
save_checkpoint train_net network|
np max (val_acc_max|eval_acc) val_acc_max
np min (val_loss_min|eval_loss) val_loss_min
print  format val_loss_min|val_acc_max
print  format val_loss_model|val_acc_model
load_checkpoint gat_net_test net
test_net feature|biases test_result
argparse ArgumentParser parser parse_args args
train_net feature|biases train_result asnumpy train_loss
train_net feature|biases train_result asnumpy train_acc
eval_net feature|biases eval_result asnumpy eval_loss
eval_net feature|biases eval_result asnumpy eval_acc
eval_result asnumpy eval_loss val_loss_model
eval_result asnumpy eval_acc val_acc_model
[8|1] n_heads
{AAAI} booktitle
{http} url
adj shape num_graphs
np empty adj shape adj_temp
range i
adj i adj_temp i
ds GraphData data_dir g
g get_all_nodes nodes
nodes tolist nodes_list
g get_node_feature nodes_list|[1|2] row_tensor
row_tensor features
features np newaxis features
row_tensor labels
labels shape nodes_num
labels max|1 class_num
np eye nodes_num|class_num[labels] astype(np float32) labels_onehot
g get_all_neighbors nodes_list|0 neighbor
{node_id} node_map
np zeros [nodes_num|nodes_num]|dtype adj
np ndenumerate index|value
adj np newaxis adj
adj_to_bias adj biases
np zeros [total] astype np float32 mask
np bool dtype
get_biases_features_labels data_dir label
label shape nodes_num
get_mask nodes_num|0|train_node_num train_mask
get_mask nodes_num|train_node_num|train_node_num|eval_node_num eval_mask
get_mask nodes_num|nodes_num-test_node_num|nodes_num test_mask
np zeros label shape y_train
np zeros label shape y_val
np zeros label shape y_test
y_train np newaxis y_train
y_val np newaxis y_val
y_test np newaxis y_test
train_mask np newaxis train_mask
eval_mask np newaxis eval_mask
test_mask np newaxis test_mask
ds GraphData data_dir g get_all_nodes nodes
ds GraphData data_dir g get_node_feature nodes_list|[1|2] row_tensor
ds GraphData data_dir g get_all_neighbors nodes_list|0 neighbor
g get_all_nodes nodes tolist nodes_list
g get_node_feature nodes_list|[1|2] row_tensor features
g get_node_feature nodes_list|[1|2] row_tensor labels
row_tensor features np newaxis features
row_tensor labels shape nodes_num
row_tensor labels max|1 class_num
np zeros [nodes_num|nodes_num]|dtype adj np newaxis adj
get_biases_features_labels data_dir label shape nodes_num
get_mask nodes_num|0|train_node_num train_mask np newaxis train_mask
get_mask nodes_num|train_node_num|train_node_num|eval_node_num eval_mask np newaxis eval_mask
get_mask nodes_num|nodes_num-test_node_num|nodes_num test_mask np newaxis test_mask
np zeros label shape y_train np newaxis y_train
np zeros label shape y_val np newaxis y_val
np zeros label shape y_test np newaxis y_test
super MaskedSoftMaxLoss|self __init__
num_class self num_class
label self label
mask self mask
P SoftmaxCrossEntropyWithLogits self softmax
P ReduceMean self reduce_mean
P Cast self cast
l2_coeff self l2_coeff
P ReduceSum self reduce_sum
len self params self num_params
range i
l2_loss|self l2_coeff|P L2Loss self params i l2_loss
P Reshape logits|(-1|self num_class) logits
P Reshape self label|(-1|self num_class) label
P Reshape self mask|(-1|) mask
self cast logits|mstype float32 logits
self softmax logits|label loss
self reduce_mean loss loss
P Cast l2_loss|mstype float32 l2_loss
super MaskedAccuracy|self __init__
P Equal self equal
Tensor label|dtype self label
Tensor mask|dtype self mask
P Reshape self label|(-1|self num_class) labels
self cast labels|mstype float32 labels
self equal self argmax logits correct_prediction
self cast correct_prediction|mstype float32 accuracy_all
self cast mask|mstype float32 mask
self reduce_mean accuracy_all
super LossAccuracyWrapper|self __init__
network self network
Tensor label|dtype label
Tensor mask|dtype mask
MaskedSoftMaxLoss num_class|label|mask|l2_coeff|self network trainable_params self loss_func
MaskedAccuracy num_class|label|mask self acc_func
self loss_func logits loss
self acc_func logits accuracy
super LossNetWrapper|self __init__
MaskedSoftMaxLoss num_class|label|mask|l2_coeff|params self loss_func
self network feature|biases logits
self network set_grad
ParameterTuple network trainable_params self weights
optimizer self optimizer
sens self sens
self weights weights
self network feature|biases loss
P Fill P DType loss sens
self grad self network|weights(feature|biases|sens) grads
F depend loss|self optimizer grads
LossNetWrapper network|num_class|label|mask|l2_coeff loss_net
TrainOneStepCell loss_net|optimizer self loss_train_net
MaskedAccuracy num_class|label|mask self accuracy_func
self loss_train_net feature|biases loss
self accuracy_func self network feature|biases accuracy
l2_loss|self l2_coeff|P L2Loss self params i l2_loss l2_coeff|P L2Loss self params i l2_loss
P Reshape self label|(-1|self num_class) label self label
P Reshape self label|(-1|self num_class) label label
P Reshape self mask|(-1|) mask self mask
P Reshape self mask|(-1|) mask mask
Tensor label|dtype self label self label
Tensor label|dtype self label label
Tensor mask|dtype self mask self mask
Tensor mask|dtype self mask mask
self cast mask|mstype float32 mask mask
Tensor label|dtype label label
Tensor mask|dtype mask mask
 text{outputs}
nn Dense 3|4 net
Tensor np random randint 0|255|[2|3] input
net input
super GNNFeatureTransform|self __init__
in_channels self in_channels
out_channels self out_channels
has_bias self has_bias
isinstance weight_init|Tensor
Parameter initializer weight_init|[out_channels|in_channels] self weight
isinstance bias_init|Tensor
Parameter initializer bias_init|[out_channels] self bias
P BiasAdd self bias_add
F shape x tensor_shape
F reshape x|(tensor_shape|tensor_shape|tensor_shape) input_feature
self matmul input_feature|self weight output
self bias_add output|self bias output
F reshape output|(tensor_shape|tensor_shape|self out_channels) output
MyAggregator _BaseAggregator
__init__ self
super MyAggregator|self __init__ self|feature_in_dim|feature_out_dim
P ReduceSum self reduce_mean
construct self|x
self reduce_mean x|1
super _BaseAggregator|self __init__
feature_in_dim self in_dim
feature_out_dim self out_dim
use_fc self use_fc
weight_init self weight_init
bias_init self bias_init
self weight_init weight_init
self bias_init bias_init
dropout_ratio self dropout_ratio
nn Dropout keep_prob self dropout
get_activation activation self activation
Tensor np array np random rand 32|3|32 input_data
net input_data output
super MeanAggregator|self
self fc input_feature input_feature
self dropout input_feature input_feature
self activation input_feature input_feature
self reduce_mean input_feature|1 output_feature
nn LeakyReLU
nn ELU
Tensor np array np random rand 1|2708|1433 input_data
nn LeakyReLU coef_activation
super AttentionHead|self __init__
in_channel self in_channel
out_channel self out_channel
in_drop_ratio self in_drop_ratio
GNNFeatureTransform self feature_transform
self in_channel in_channels
self out_channel out_channels
GNNFeatureTransform self f_1_transform
self out_channel in_channels
GNNFeatureTransform self f_2_transform
nn Softmax self softmax
P MatMul self matmul
Parameter initializer self out_channel self bias
residual self residual
GNNFeatureTransform self residual_transform
coef_activation self coef_activation
activation self activation
self in_drop input_feature input_feature
self feature_transform input_feature feature
self f_1_transform feature f_1
self f_2_transform feature f_2
f_1|P Transpose f_2|(0|2|1) logits
self coef_activation logits|bias_mat logits
self softmax logits coefs
self coef_drop coefs coefs
self in_drop_2 feature feature
P Squeeze coefs coefs
P Squeeze feature feature
self matmul coefs|feature ret
self bias_add ret|self bias ret
P ExpandDims ret|0 ret
self residual_transform input_feature res
ret|res ret
ret|input_feature ret
self activation ret ret
Tensor np array np random rand 1|2708|2708 biases
net input_data|biases
nn ELU activation
super AttentionAggregator|self __init__
num_heads self num_heads
range _
in_drop in_drop_ratio
coef_drop coef_drop_ratio
nn layer CellList self attns self attns
P Concat self out_trans
P AddN self out_trans
range i
(self attns i input_data|bias_mat|training) res
self out_trans res
nn Elu
[8|1] n_heads
np array np random rand 1|2708|1433 input_data
np array np random rand 1|2708|2708 biases
hid_units hidden_units
n_heads num_heads
net input_data|biases output
super GAT|self __init__
ftr_dims self ftr_dims
num_class self num_class
num_nodes self num_nodes
hidden_units self hidden_units
attn_drop self attn_drop
ftr_drop self ftr_drop
nn layer CellList self layers self layers
feature input_data
biases bias_mat
self layers cell
cell input_data|bias_mat|training input_data
nn Dense 3|4 net input
nn Dense 3|4 net input_data output
nn Dense 3|4 net input_data|biases
nn Dense 3|4 net input_data|biases output
Tensor np random randint 0|255|[2|3] input ret
net input ret
super GNNFeatureTransform|self __init__ self
isinstance weight_init self weight_init
isinstance Tensor np array np random rand 32|3|32 input_data
isinstance Tensor np array np random rand 1|2708|1433 input_data
isinstance Tensor np array np random rand 1|2708|2708 biases
isinstance bias_init self bias_init
isinstance Tensor np array np random rand 32|3|32 input_data
isinstance Tensor np array np random rand 1|2708|1433 input_data
isinstance Tensor np array np random rand 1|2708|2708 biases
F reshape x|(tensor_shape|tensor_shape|tensor_shape) input_feature ret
__init__ self reduce_mean x|1
__init__ self weight_init weight_init
__init__ self bias_init bias_init
__init__ self fc input_feature input_feature
__init__ self dropout input_feature input_feature
__init__ self activation input_feature input_feature
__init__ self reduce_mean input_feature|1 output_feature
__init__ self in_channel in_channels
__init__ self out_channel out_channels
__init__ self out_channel in_channels
__init__ self in_drop input_feature input_feature
__init__ self feature_transform input_feature feature
__init__ self f_1_transform feature f_1
__init__ self f_2_transform feature f_2
__init__ self coef_activation logits|bias_mat logits
__init__ self softmax logits coefs
__init__ self coef_drop coefs coefs
__init__ self in_drop_2 feature feature
__init__ self matmul coefs|feature ret
__init__ self bias_add ret|self bias ret
__init__ self residual_transform input_feature res
__init__ self activation ret ret
__init__ self out_trans res
__init__ self layers cell
super MyAggregator|self __init__ self reduce_mean x|1
super MyAggregator|self __init__ feature_in_dim self in_dim
super MyAggregator|self __init__ feature_out_dim self out_dim
super MyAggregator|self __init__ self weight_init weight_init
super MyAggregator|self __init__ self bias_init bias_init
super MyAggregator|self __init__ self fc input_feature input_feature
super MyAggregator|self __init__ self dropout input_feature input_feature
super MyAggregator|self __init__ self activation input_feature input_feature
super MyAggregator|self __init__ self reduce_mean input_feature|1 output_feature
super MyAggregator|self __init__ self in_channel in_channels
super MyAggregator|self __init__ self out_channel out_channels
super MyAggregator|self __init__ self out_channel in_channels
super MyAggregator|self __init__ self in_drop input_feature input_feature
super MyAggregator|self __init__ self feature_transform input_feature feature
super MyAggregator|self __init__ self f_1_transform feature f_1
super MyAggregator|self __init__ self f_2_transform feature f_2
super MyAggregator|self __init__ self coef_activation logits|bias_mat logits
super MyAggregator|self __init__ self softmax logits coefs
super MyAggregator|self __init__ self coef_drop coefs coefs
super MyAggregator|self __init__ self in_drop_2 feature feature
super MyAggregator|self __init__ self matmul coefs|feature ret
super MyAggregator|self __init__ self bias_add ret|self bias ret
super MyAggregator|self __init__ self residual_transform input_feature res
super MyAggregator|self __init__ self activation ret ret
super MyAggregator|self __init__ self out_trans res
super MyAggregator|self __init__ feature input_data
super MyAggregator|self __init__ self layers cell
construct self reduce_mean x|1
construct self weight_init weight_init
construct self bias_init bias_init
construct self fc input_feature input_feature
construct self dropout input_feature input_feature
construct self activation input_feature input_feature
construct self reduce_mean input_feature|1 output_feature
construct self in_channel in_channels
construct self out_channel out_channels
construct self out_channel in_channels
construct self in_drop input_feature input_feature
construct self feature_transform input_feature feature
construct self f_1_transform feature f_1
construct self f_2_transform feature f_2
construct self coef_activation logits|bias_mat logits
construct self softmax logits coefs
construct self coef_drop coefs coefs
construct self in_drop_2 feature feature
construct self matmul coefs|feature ret
construct self bias_add ret|self bias ret
construct self residual_transform input_feature res
construct self activation ret ret
construct self out_trans res
construct self layers cell
get_activation activation self activation self activation
super self fc input_feature input_feature
super self dropout input_feature input_feature
super self activation input_feature input_feature
super self reduce_mean input_feature|1 output_feature
super self in_channel in_channels
super self out_channel out_channels
super self out_channel in_channels
super self in_drop input_feature input_feature
super self feature_transform input_feature feature
super self f_1_transform feature f_1
super self f_2_transform feature f_2
super self coef_activation logits|bias_mat logits
super self softmax logits coefs
super self coef_drop coefs coefs
super self in_drop_2 feature feature
super self matmul coefs|feature ret
super self bias_add ret|self bias ret
super self residual_transform input_feature res
super self activation ret ret
super self out_trans res
super self layers cell
self fc input_feature input_feature ret
self dropout input_feature input_feature ret
self activation input_feature input_feature ret
nn LeakyReLU coef_activation self coef_activation
self in_drop input_feature input_feature ret
self feature_transform input_feature feature input_data
self f_1_transform feature f_1 Transpose f_2|(0|2|1) logits
self in_drop_2 feature feature input_data
P Squeeze feature feature input_data
self matmul coefs|feature ret ret
self matmul coefs|feature ret ret
self bias_add ret|self bias ret ret
self bias_add ret|self bias ret ret
P ExpandDims ret|0 ret ret
P ExpandDims ret|0 ret ret
self residual_transform input_feature res ret
ret|res ret ret
ret|res ret ret
ret|input_feature ret ret
Tensor np array np random rand 1|2708|2708 biases bias_mat
net biases bias_mat
[8|1] n_heads num_heads
np array np random rand 1|2708|2708 biases bias_mat
hid_units hidden_units self hidden_units
self layers cell input_data|bias_mat|training input_data
BGCF args|kwargs
bgcf args|kwargs
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
network net
ForwardBGCF network forward_net
Tensor np zeros [num_user|] astype(np int32) users
Tensor np zeros [num_item|] astype(np int32) items
Tensor np zeros [num_item|1] astype(np int32) neg_items
Tensor np zeros [num_user|args row_neighs] astype(np int32) u_test_neighs
Tensor np zeros [num_user|args gnew_neighs] astype(np int32) u_test_gnew_neighs
Tensor np zeros [num_item|args row_neighs] astype(np int32) i_test_neighs
Tensor np zeros [num_item|args gnew_neighs] astype(np int32) i_test_gnew_neighs
[users|items|neg_items|u_test_neighs|u_test_gnew_neighs|i_test_neighs|i_test_gnew_neighs] input_data
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
Tensor np zeros [num_user|] astype(np int32) users input_data
Tensor np zeros [num_item|] astype(np int32) items input_data
Tensor np zeros [num_item|1] astype(np int32) neg_items input_data
Tensor np zeros [num_user|args row_neighs] astype(np int32) u_test_neighs input_data
Tensor np zeros [num_user|args gnew_neighs] astype(np int32) u_test_gnew_neighs input_data
Tensor np zeros [num_item|args row_neighs] astype(np int32) i_test_neighs input_data
Tensor np zeros [num_item|args gnew_neighs] astype(np int32) i_test_gnew_neighs input_data
train_graph graph_info num_user
train_graph graph_info num_item
train_graph graph_info num_pairs
train_net set_train True
int num_pairs|parser batch_pairs num_iter
range 1|parser num_epoch _epoch
time time epoch_start
itr data
Tensor data|mstype int32 u_id
Tensor convert_item_id data|num_user pos_item_id
Tensor convert_item_id data|num_user neg_item_id
Tensor data|mstype int32 pos_users
Tensor convert_item_id data|num_user pos_items
Tensor data|mstype int32 u_group_nodes
Tensor convert_item_id data|num_user u_neighs
Tensor convert_item_id data|num_user u_gnew_neighs
Tensor convert_item_id data|num_user i_group_nodes
Tensor data|mstype int32 i_neighs
Tensor data|mstype int32 i_gnew_neighs
Tensor convert_item_id data|num_user neg_group_nodes
Tensor data|mstype int32 neg_neighs
Tensor data|mstype int32 neg_gnew_neighs
save_checkpoint bgcfnet|parser ckptpath| format _epoch
parser_args parser
parser device os environ
load_graph parser datapath sampled_graph_list
parser_args parser device os environ
train_graph graph_info num_user
train_graph graph_info num_item
BGCFEvaluate parser|train_graph|test_graph|parser Ks eval_class
range parser eval_interval|parser num_epoch _epoch
bgcfnet_test net
ForwardBGCF bgcfnet_test forward_net
TestBGCF forward_net|num_user|num_item|parser input_dim|test_graph_dataset item_reps
eval_class eval_with_rep user_reps|item_reps|parser test_nov
parser_args parser
parser device os environ
load_graph parser datapath sampled_graph_list
parser gnew_neighs num_bgcn_neigh
datetime datetime now strftime now
vars arg
save_checkpoint bgcfnet|parser ckptpath| format _epoch
BGCFEvaluate parser|train_graph|test_graph|parser Ks eval_class eval_with_rep user_reps|item_reps|parser test_nov
parser_args parser device os environ
parser_args parser gnew_neighs num_bgcn_neigh
np zeros [num_user|input_dim|3] user_reps
np zeros [num_item|input_dim|3] item_reps
range _
test_graph_dataset random_select_sampled_graph
test_graph_dataset get_user_sapmled_neighbor u_test_gnew_neighs
test_graph_dataset get_item_sampled_neighbor i_test_gnew_neighs
Tensor convert_item_id u_test_neighs|num_user u_test_neighs
Tensor convert_item_id u_test_gnew_neighs|num_user u_test_gnew_neighs
Tensor i_test_neighs|mstype int32 i_test_neighs
Tensor i_test_gnew_neighs|mstype int32 i_test_gnew_neighs
Tensor np arange num_user reshape -1| users
Tensor np arange num_item reshape -1| items
Tensor np arange num_item reshape -1|1 neg_items
user_rep asnumpy user_reps
item_rep asnumpy item_reps
super ForwardBGCF|self __init__
network self network
super BGCFLoss|self __init__
neg_item_num self neg_item_num
l2_embed self l2_embed
dist_reg self dist_reg
P Log self log
P Pow self pow
P Cast self cast
P Tile self tile
P Shape self shape
P Reshape self reshape
P Concat self concat
P Concat self concat2
P Split 0|2 self split
P ReduceSum self reduce_sum
P ExpandDims self expand_dims
P Mul self multiply
P BatchMatMul self matmul
P Squeeze self squeeze
P Transpose self transpose
P L2Loss self l2_loss
P Sigmoid self sigmoid
self cast all_user_embed|mstype float16 all_user_embed
self concat (all_user_rep|all_user_embed) all_user_rep
self split all_user_rep pos_user_rep
self split all_user_embed pos_user_embed
self reduce_sum self pow user_rep-pos_user_rep|2 user_user_distance
self reduce_sum self pow user_embed-pos_user_embed|2
self cast user_user_distance|mstype float32 user_user_distance
self expand_dims user_rep|1 user_rep
self cast all_pos_item_embed|mstype float16 all_pos_item_embed
self concat (all_pos_item_rep|all_pos_item_embed) all_pos_item_rep
self split all_pos_item_rep pos_item_neigh_rep
self split all_pos_item_embed pos_item_neigh_embed
self reduce_sum self pow pos_item_rep-pos_item_neigh_rep|2 pos_item_item_distance
self reduce_sum self pow pos_item_embed-pos_item_neigh_embed|2
self cast pos_item_item_distance|mstype float32 pos_item_item_distance
self cast neg_item_embed|mstype float16 neg_item_embed
self concat2 (neg_item_rep|neg_item_embed) neg_item_rep
self concat (self expand_dims pos_item_rep|1) item_rep
self reduce_sum self multiply self squeeze user_rep pos_rating
self expand_dims pos_rating|1 pos_rating
self tile pos_rating|(1|self neg_item_num) pos_rating
self reshape pos_rating|(self shape pos_rating|self neg_item_num|1) pos_rating
self cast pos_rating|mstype float32 pos_rating
self transpose neg_item_rep|(0|2|1) batch_neg_item_embedding
self matmul user_rep|batch_neg_item_embedding neg_rating
self squeeze neg_rating neg_rating
self reshape neg_rating|(self shape neg_rating|self neg_item_num|1) neg_rating
self cast neg_rating|mstype float32 neg_rating
pos_rating-neg_rating bpr_loss
self sigmoid bpr_loss bpr_loss
-self log bpr_loss bpr_loss
self reduce_sum bpr_loss bpr_loss
self l2_embed|(self l2_loss user_rep|self l2_loss item_rep) reg_loss
bpr_loss|reg_loss|self dist_reg|(user_user_distance|pos_item_item_distance) loss
BGCFLoss neg_item_num|l2_embed|dist_reg self loss_func
Net net
nn SoftmaxCrossEntropyWithLogits loss_fn
nn WithLossCell net|loss_fn loss_net
nn TrainOneStepCell loss_net|optim train_net
ParameterTuple network trainable_params self weights
optimizer self optimizer
sens self sens
self weights weights
P Fill P DType loss sens
F depend loss|self optimizer grads
TrainOneStepCell loss_net|optimizer self loss_train_net
pos_rating-neg_rating bpr_loss dist_reg|(user_user_distance|pos_item_item_distance) loss
self sigmoid bpr_loss bpr_loss dist_reg|(user_user_distance|pos_item_item_distance) loss
-self log bpr_loss bpr_loss dist_reg|(user_user_distance|pos_item_item_distance) loss
self reduce_sum bpr_loss bpr_loss dist_reg|(user_user_distance|pos_item_item_distance) loss
self l2_embed|(self l2_loss user_rep|self l2_loss item_rep) reg_loss dist_reg|(user_user_distance|pos_item_item_distance) loss
bpr_loss|reg_loss|self dist_reg|(user_user_distance|pos_item_item_distance) loss dist_reg|(user_user_distance|pos_item_item_distance) loss
idcg_k actual|topk idcg
sum dcg_k
dcg_k|idcg res
sum res
np asfarray r r
np sum r
topk_items item
avg_nov append -np log2 (item_degree_dict[item]|1e-8)|num_user
np mean avg_nov
test_items i
rating i item_score i
max Ks K_max
heapq nlargest K_max|item_score|key K_max_item_score
K_max_item_score i
r append
Ks K
recall append recall_at_k_2 r|K|len user_pos_test
ndcg append ndcg_k user_pos_test|K_max_item|K
novelty append novelty_at_k K_max_item|item_degree_dict|num_user|K
np array recall|:np array novelty
train_graph graph_info self num_user
train_graph graph_info self num_item
Ks self Ks
range i
self train_set append train_item
self test_set append test_item
convert_item_id self train_set|self num_user tolist self train_set
convert_item_id self test_set|self num_user tolist self test_set
range self num_user|self num_user i
train_users tolist train_users
isinstance train_users|int
test_users tolist test_users
isinstance test_users|int
self item_full_set append train_users|test_users
x rating
x u
self train_set u training_items
self test_set u user_pos_test
set range self num_item all_items
list all_items-set(training_items) test_items
ranklist_by_heapq user_pos_test|test_items|rating|self Ks k_max_items
get_performance user_pos_test|r|k_max_items|self item_deg_dict|self num_user|self Ks
Pool parser workers pool
np arange self num_user user_indexes
user_rep rating_preds
zip rating_preds|user_indexes user_rating_uid
pool map self test_one_user|user_rating_uid all_result
all_result re
top20 append re
pool close
[foriinrange len self Ks-1] sedp
range k
range u
all_result u][k pred_items_at_k
pred_items_at_k item
len self item_full_set item avg_prob_all_user
sum diff|self Ks k one_user_sedp
sedp k append one_user_sedp
np array sedp mean sedp
result tolist
idcg_k actual|topk idcg res
sum dcg_k res
np asfarray r r append
np sum r append
heapq nlargest K_max|item_score|key K_max_item_score i
Pool parser workers pool map self test_one_user|user_rating_uid all_result
Pool parser workers pool close
pool map self test_one_user|user_rating_uid all_result re
pool map self test_one_user|user_rating_uid all_result u][k pred_items_at_k
[foriinrange len self Ks-1] sedp k append one_user_sedp
all_result u][k pred_items_at_k item
argparse ArgumentParser parser
parser parse_args
argparse ArgumentParser parser parse_args
super MeanConv|self __init__
Parameter self out_weight
P Tanh self act
P ReLU self act
P Cast self cast
P MatMul self matmul
self reduce_mean neigh_feature|1 neigh_matrix
self dropout neigh_matrix neigh_matrix
self concat (self_feature|neigh_matrix) output
self act self matmul output|self out_weight output
super AttenConv|self __init__
P Squeeze self squeeze
P ExpandDims self expanddims
P Softmax axis self softmax
P BatchMatMul self matmul_3
self expanddims self_feature|1 query
self dropout neigh_feature neigh_matrix
self matmul_t query|neigh_matrix score
self softmax score score
self matmul_3 score|neigh_matrix atten_agg
self squeeze atten_agg atten_agg
self matmul self concat (atten_agg|self_feature) output
super BGCF|self __init__
Parameter initializer [num_user|input_dim]|dtype self user_embed
Parameter initializer [num_item|input_dim]|dtype self item_embed
P Tanh self tanh
P Shape self shape
P Split 0|2 self split
P GatherV2 self gather
P Reshape self reshape
P Concat self concat_0
P Concat self concat_1
architect_argv self layer_dim
self gnew_agg_mean to_float mstype float16
AttenConv self input_dim|self layer_dim|dropout self gnew_agg_user
self gnew_agg_user to_float mstype float16
AttenConv self input_dim|self layer_dim|dropout self gnew_agg_item
self gnew_agg_item to_float mstype float16
self input_dim self user_feature_dim
self input_dim self item_feature_dim
Parameter self final_weight
self raw_agg_funcs_user to_float mstype float16
self raw_agg_funcs_item to_float mstype float16
self gather self user_embed|self concat_0 (u_id|pos_users) all_user_embed
self gather self user_embed|u_group_nodes|0 u_self_matrix_at_layers
self gather self item_embed|u_neighs|0 u_neigh_matrix_at_layers
self raw_agg_funcs_user u_self_matrix_at_layers|u_neigh_matrix_at_layers u_output_mean
self gather self item_embed|u_gnew_neighs|0 u_gnew_neighs_matrix
self gnew_agg_mean u_self_matrix_at_layers|u_gnew_neighs_matrix u_output_from_gnew_mean
self concat_1 (u_output_mean|u_output_from_gnew_mean|u_output_from_gnew_att) u_output
self tanh u_output all_user_rep
self gather self item_embed|self concat_0 (pos_item_id|pos_items) all_pos_item_embed
self gather self item_embed|i_group_nodes|0 i_self_matrix_at_layers
self gather self user_embed|i_neighs|0 i_neigh_matrix_at_layers
self raw_agg_funcs_item i_self_matrix_at_layers|i_neigh_matrix_at_layers i_output_mean
self gather self user_embed|i_gnew_neighs|0 i_gnew_neighs_matrix
self gnew_agg_mean i_self_matrix_at_layers|i_gnew_neighs_matrix i_output_from_gnew_mean
self concat_1 (i_output_mean|i_output_from_gnew_mean|i_output_from_gnew_att) i_output
self tanh i_output all_pos_item_rep
self gather self item_embed|neg_item_id|0 neg_item_embed
self gather self item_embed|neg_group_nodes|0 neg_self_matrix_at_layers
self gather self user_embed|neg_neighs|0 neg_neigh_matrix_at_layers
self raw_agg_funcs_item neg_self_matrix_at_layers|neg_neigh_matrix_at_layers neg_output_mean
self gather self user_embed|neg_gnew_neighs|0 neg_gnew_neighs_matrix
self gnew_agg_mean neg_self_matrix_at_layers|neg_gnew_neighs_matrix neg_output_from_gnew_mean
self concat_1 (neg_output_mean|neg_output_from_gnew_mean|neg_output_from_gnew_att) neg_output
self tanh neg_output neg_output
self shape neg_output neg_output_shape
{R He|J McAuley} author
{WWW} journal
{http} url
super __init__
index_range self index_range
num_edges_per_sample self num_edges_per_sample
np random shuffle indices
range i
indices result
result append self sampled_graph_index
train_graph self g
batch_num self batch_num
sampled_graphs self sampled_graphs
len sampled_graphs self sampled_graph_num
num_samples self num_samples
num_bgcn_neigh self num_bgcn_neigh
num_neg self num_neg
self g graph_info
index%self sampled_graph_num sampled_graph_index
self g train_graph
self sampled_graphs sampled_graph_index sampled_graph
train_graph get_nodes_from_edges index astype np int32 rating
rating users
train_graph get_sampled_neighbors u_group_nodes
u_group_nodes pos_users
u_group_nodes reshape -1| tolist u_group_nodes
train_graph get_sampled_neighbors u_neighs
sampled_graph get_sampled_neighbors u_gnew_neighs
rating items
train_graph get_sampled_neighbors i_group_nodes
i_group_nodes pos_items
i_group_nodes reshape -1| tolist i_group_nodes
train_graph get_sampled_neighbors i_neighs
sampled_graph get_sampled_neighbors i_gnew_neighs
train_graph get_neg_sampled_neighbors neg_item_id
neg_item_id reshape -1| neg_group_nodes
train_graph get_sampled_neighbors neg_neighs
sampled_graph get_sampled_neighbors neg_gnew_neighs
g self g
self g graph_info self num_user
self g graph_info self num_item
np random randint len self sampled_graphs self sampled_graph_index
np arange self num_user|dtype users
self g get_sampled_neighbors u_neighs
self sampled_graphs self sampled_graph_index sampled_graph
np arange self num_user|self num_user|self num_item|dtype items
self g get_sampled_neighbors i_neighs
ds GraphData train_graph
ds GraphData test_graph
ds GraphData sampled_graph
sampled_graph_list append sampled_graph
train_graph graph_info edge_num
TrainGraphDataset train_graph_dataset
dataset repeat repeat_size dataset
np random shuffle indices result
indices result append self sampled_graph_index
train_graph self g self g
self g train_graph get_nodes_from_edges index astype np int32 rating
self g train_graph get_sampled_neighbors u_group_nodes
self g train_graph get_sampled_neighbors u_neighs
self g train_graph get_sampled_neighbors i_group_nodes
self g train_graph get_sampled_neighbors i_neighs
self g train_graph get_neg_sampled_neighbors neg_item_id
self g train_graph get_sampled_neighbors neg_neighs
self g train_graph graph_info edge_num
self sampled_graphs sampled_graph_index sampled_graph get_sampled_neighbors u_gnew_neighs
self sampled_graphs sampled_graph_index sampled_graph get_sampled_neighbors i_gnew_neighs
self sampled_graphs sampled_graph_index sampled_graph get_sampled_neighbors neg_gnew_neighs
train_graph get_nodes_from_edges index astype np int32 rating users
train_graph get_nodes_from_edges index astype np int32 rating items
train_graph get_sampled_neighbors u_group_nodes pos_users
train_graph get_sampled_neighbors u_group_nodes reshape -1| tolist u_group_nodes
train_graph get_sampled_neighbors i_group_nodes pos_items
train_graph get_sampled_neighbors i_group_nodes reshape -1| tolist i_group_nodes
train_graph get_neg_sampled_neighbors neg_item_id reshape -1| neg_group_nodes
ds GraphData train_graph graph_info edge_num
open path|name|
sys stdout self terminal
os path join foldername|logname|now path
os makedirs path
glob glob filenames
filenames filename
shutil copy filename|path
open file|mode self file
self terminal write message
self terminal flush
self file write message
self file flush
np array item_list
glob glob filenames filename
GCN args|kwargs
gcn args|kwargs
NotImplementedError f
parser parse_args args_opt
ConfigGCN config
Tensor np zeros (2708|2708) adj
Tensor np zeros (2708|1433) feature
Tensor np zeros (3312|3312) adj
Tensor np zeros (3312|3703) feature
GCN config|input_dim|class_num gcn_net
gcn_net set_train False
gcn_net net
GCN config|input_dim|class_num gcn_net set_train False
GCN config|input_dim|class_num gcn_net net
t_sne fit_transform out_feature
scat set_offsets data i
plt title  format i
parser parse_args args_opt
os path exists
os mkdir
ConfigGCN config
get_adj_features_labels args_opt data_dir label
label_onehot shape nodes_num
get_mask nodes_num|0|args_opt train_nodes_num train_mask
get_mask nodes_num|args_opt train_nodes_num|args_opt train_nodes_num|args_opt eval_nodes_num eval_mask
get_mask nodes_num|nodes_num-args_opt test_nodes_num|nodes_num test_mask
label_onehot shape class_num
feature shape input_dim
GCN config|input_dim|class_num gcn_net
Tensor adj adj
Tensor feature feature
LossAccuracyWrapper gcn_net|label_onehot|eval_mask|config weight_decay eval_net
TrainNetWrapper gcn_net|label_onehot|train_mask|config train_net
gcn_net out_feature
t_SNE out_feature asnumpy|2 tsne_result
graph_data append tsne_result
plt figure fig
range epoch
time time t
train_net set_train
train_net adj|feature train_result
train_result asnumpy train_loss
train_result asnumpy train_accuracy
eval_net set_train False
eval_net adj|feature eval_result
eval_result asnumpy eval_loss
eval_result asnumpy eval_accuracy
loss_list append eval_loss
np mean loss_list
save_checkpoint gcn_net|
GCN config|input_dim|class_num gcn_net_test
load_checkpoint gcn_net_test net
LossAccuracyWrapper gcn_net_test|label_onehot|test_mask|config weight_decay test_net
time time t_test
test_net set_train False
test_net adj|feature test_result
test_result asnumpy test_loss
test_result asnumpy test_accuracy
animation FuncAnimation fig|update_graph|frames ani
GCN config|input_dim|class_num gcn_net out_feature
LossAccuracyWrapper gcn_net|label_onehot|eval_mask|config weight_decay eval_net set_train False
LossAccuracyWrapper gcn_net|label_onehot|eval_mask|config weight_decay eval_net adj|feature eval_result
TrainNetWrapper gcn_net|label_onehot|train_mask|config train_net set_train
TrainNetWrapper gcn_net|label_onehot|train_mask|config train_net adj|feature train_result
train_net adj|feature train_result asnumpy train_loss
train_net adj|feature train_result asnumpy train_accuracy
eval_net adj|feature eval_result asnumpy eval_loss
eval_net adj|feature eval_result asnumpy eval_accuracy
LossAccuracyWrapper gcn_net_test|label_onehot|test_mask|config weight_decay test_net set_train False
LossAccuracyWrapper gcn_net_test|label_onehot|test_mask|config weight_decay test_net adj|feature test_result
test_net adj|feature test_result asnumpy test_loss
test_net adj|feature test_result asnumpy test_accuracy
Tensor label self label
Tensor mask self mask
P SoftmaxCrossEntropyWithLogits self loss
Tensor 1 0|mstype float32 self one
Tensor 0 0|mstype float32 self zero
P ReduceMean self mean
P Cast self cast
P L2Loss self l2_loss
P ReduceSum self reduce_sum
weight_decay self weight_decay
param self param
self l2_loss self param param
self weight_decay|param loss
self cast preds|mstype float32 preds
loss|self loss(preds|self label) loss
self cast self mask|mstype float32 mask
self mean mask mask_reduce
mask|mask_reduce mask
loss|mask loss
self mean loss loss
P Equal self equal
P Argmax self argmax
self equal self argmax preds correct_prediction
self cast correct_prediction|mstype float32 accuracy_all
self mean accuracy_all
network self network
Loss label|mask|weight_decay|network trainable_params self loss
Accuracy label|mask self accuracy
self network adj|feature preds
self loss preds loss
self accuracy preds accuracy
Net net
nn SoftmaxCrossEntropyWithLogits loss_fn
nn WithLossCell net|loss_fn loss_net
nn TrainOneStepCell loss_net|optim train_net
self network set_grad
ParameterTuple network trainable_params self weights
optimizer self optimizer
sens self sens
self weights weights
self network adj|feature loss
P Fill P DType loss sens
self grad self network|weights(adj|feature|sens) grads
F depend loss|self optimizer grads
LossWrapper network|label|mask|config weight_decay loss_net
TrainOneStepCell loss_net|optimizer self loss_train_net
self loss_train_net adj|feature loss
self accuracy self network adj|feature accuracy
Tensor mask self mask mask
Tensor mask self mask loss
P SoftmaxCrossEntropyWithLogits self loss loss(preds|self label) loss
P SoftmaxCrossEntropyWithLogits self loss loss
self weight_decay|param loss loss(preds|self label) loss
self weight_decay|param loss loss
loss|self loss(preds|self label) loss loss(preds|self label) loss
loss|self loss(preds|self label) loss loss
self cast self mask|mstype float32 mask mask
self cast self mask|mstype float32 mask loss
self mean mask mask_reduce mask
mask|mask_reduce mask mask
mask|mask_reduce mask loss
loss|mask loss loss
np sqrt 6 0|(shape|shape) init_range
np random uniform -init_range|init_range|shape astype(np float32) initial
Tensor initial
super GraphConvolution|self __init__
feature_in_dim self in_dim
feature_out_dim self out_dim
glorot [self out_dim|self in_dim] self weight_init
self weight_init weight_init
dropout_ratio self dropout_ratio
get_activation activation self activation
P MatMul self matmul
input_feature dropout
self dropout dropout dropout
self fc dropout fc
self matmul adj|fc output_feature
self activation output_feature output_feature
super GCN|self __init__
self layer0 adj|feature output0
self layer1 adj|output0 output1
{AAAI} booktitle
{http} url
np array adj sum rowsum
np power rowsum|-0 5 flatten d_inv_sqrt
sp diags d_inv_sqrt d_mat_inv_sqrt
adj dot d_mat_inv_sqrt transpose dot d_mat_inv_sqrt tocoo
ds GraphData data_dir g
g get_all_nodes nodes
nodes tolist nodes_list
g get_node_feature nodes_list|[1|2] row_tensor
row_tensor features
row_tensor labels
labels shape nodes_num
labels max|1 class_num
np eye nodes_num|class_num[labels] astype(np float32) labels_onehot
g get_all_neighbors nodes_list|0 neighbor
{node_id} node_map
np zeros [nodes_num|nodes_num]|dtype adj
np ndenumerate index|value
sp coo_matrix adj adj
adj|adj T multiply(adj T) adj
normalize_adj adj nor_adj
np array nor_adj todense nor_adj
np zeros [total] astype np float32 mask
ds GraphData data_dir g get_all_nodes nodes
ds GraphData data_dir g get_node_feature nodes_list|[1|2] row_tensor
ds GraphData data_dir g get_all_neighbors nodes_list|0 neighbor
g get_all_nodes nodes tolist nodes_list
g get_node_feature nodes_list|[1|2] row_tensor features
g get_node_feature nodes_list|[1|2] row_tensor labels
row_tensor labels shape nodes_num
row_tensor labels max|1 class_num
np zeros([nodes_num|nodes_num]|dtype adj T multiply(adj T) adj
sp coo_matrix adj adj T multiply(adj T) adj
adj|adj T multiply(adj T) adj T multiply(adj T) adj
ckpt_list ckpt
ckpt endswith
os path exists ckpt
FileNotFoundError f
print f
load_checkpoint ckpt ms_ckpt
ms_ckpt param_name
avg_model param_name append ms_ckpt param_name data asnumpy
avg_model name
sum avg_model name avg_model name
parser parse_known_args _
ckpt_list extend args input_files split
os path exists args input_folderandos path isdir args input_folder
os listdir file
ckpt_list append os path join args input_folder|file
average_me_models ckpt_list avg_weights
np savez args output_file|avg_weights
ckpt_list ckpt endswith
load_checkpoint ckpt ms_ckpt param_name
parser parse_known_args _
np savez args output_file|avg_weights
args src_folder source_folder
args output_folder output_folder
args codes codes
os path exists codes
os path exists source_folderornotos path isdir source_folder
os path exists output_folderornotos path isdir output_folder
isinstance args prefix|strorlen args prefix
isinstance args processes|int
os listdir file
file startswith args prefix
file endswith
os path join output_folder|file replace output_path
os path join output_folder|file replace dict_path
available_dict append dict_path
min kernel_size|cpu_count kernel_size
Pool kernel_size pool
args_groups arg
arg args
pool close
pool join
Dictionary load_from_text available_dict vocab
vocab shrink args threshold vocab
vocab persistence args vocab_path
print f
np savez args file startswith args prefix
np savez args file endswith
os listdir file startswith args prefix
os listdir file endswith
Pool kernel_size pool close
Pool kernel_size pool join
args_groups arg args
Dictionary load_from_text available_dict vocab shrink args threshold vocab
Dictionary load_from_text available_dict vocab persistence args vocab_path
file lowerorinfile lower
os listdir file
_is_dataset_file file
_files append os path join folder|file
os path isdir folder
_get_files_from_dir folder _list
_is_dataset_file folder
_list append folder
inferring Default beamsearch
mstype float32 dtype
save_graphs self save_graphs
random_seed self random_seed
get_source_list pre_train_dataset self pre_train_dataset
get_source_list fine_tune_dataset self fine_tune_dataset
get_source_list valid_dataset self valid_dataset
get_source_list test_dataset self test_dataset
isinstance epochs|int
epochs self epochs
dataset_sink_mode self dataset_sink_mode
dataset_sink_step self dataset_sink_step
ckpt_path self ckpt_path
keep_ckpt_max self keep_ckpt_max
save_ckpt_steps self save_ckpt_steps
ckpt_prefix self ckpt_prefix
existed_ckpt self existed_ckpt
batch_size self batch_size
seq_length self seq_length
vocab_size self vocab_size
hidden_size self hidden_size
num_hidden_layers self num_hidden_layers
num_attention_heads self num_attention_heads
hidden_act self hidden_act
intermediate_size self intermediate_size
hidden_dropout_prob self hidden_dropout_prob
attention_dropout_prob self attention_dropout_prob
max_position_embeddings self max_position_embeddings
initializer_range self initializer_range
label_smoothing self label_smoothing
beam_width self beam_width
length_penalty_weight self length_penalty_weight
max_decode_length self max_decode_length
mstype float16 self compute_type
dtype self dtype
loss_scale_mode self loss_scale_mode
scale_window self scale_window
loss_scale_factor self loss_scale_factor
init_loss_scale self init_loss_scale
optimizer self optimizer
lr self lr
lr_scheduler self lr_scheduler
min_lr self min_lr
poly_lr_scheduler_power self poly_lr_scheduler_power
decay_steps self decay_steps
decay_start_step self decay_start_step
warmup_steps self warmup_steps
PARAM_NODES node
json_object key
json_object node][key _params key
cls _params
open json_file|
cls from_dict json load reader
copy deepcopy self __dict__ output
_get_files_from_dir folder _list append folder
mstype float32 dtype self dtype
isinstance epochs self epochs
Callable TOKENIZER
print f
open file_path|
file sen
TOKENIZER sen tokens
len tokens
tokenized_sen append
open tokenized_file|
file writelines tokenized_sen
parser parse_known_args _
args corpus_folder split src_folder
word_tokenize TOKENIZER
jieba cut TOKENIZER
Pool args pool_size pool
src_folder folder
os listdir file
file endswith
os path join folder|file file_path
os path join args output_folder|file replace out_path
pool apply_async create_tokenized_sentences|(file_path|out_path|)
pool close
pool join
Callable TOKENIZER sen tokens
open file writelines tokenized_sen
open file endswith
args corpus_folder split src_folder folder
Pool args pool_size pool apply_async create_tokenized_sentences|(file_path|out_path|)
Pool args pool_size pool close
Pool args pool_size pool join
os listdir file endswith
TransformerConfig from_json_file config config
mstype float16 config compute_type
mstype float32 config dtype
get_config kwargs config
NotImplementedError f
kwargs get False is_training
is_training|args is_training
TransformerInferModel config|args
kwargs get False is_training is_training
is_training|args is_training is_training
parser parse_known_args _
NotImplementedError f
Dictionary load_from_persisted_dict args existed_vocab vocab
args src_folder folder_path
args output_folder output_folder_path
vocab vocabulary
args mask_ratio mask_ratio
args max_len max_sen_len
args processes cores
print f
Dictionary load_from_persisted_dict args existed_vocab vocab vocabulary
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
TransformerConfig from_json_file config_file tfm_config
mstype float16 tfm_config compute_type
mstype float32 tfm_config dtype
Dictionary load_from_persisted_dict args vocab_file vocab
get_config args gigaword_infer_config config
config max_decode_length dec_len
tfm_model init_parameters_data
tfm_model trainable_params params
load_infer_weights config weights
params param
param data value
param name name
name weights_name
f write(weights_name|)
isinstance value|Tensor
param set_data Tensor weights weights_name float32
tfm_model set_train False
Tensor np ones (1|config seq_length) astype(np int32) source_ids
Tensor np ones (1|config seq_length) astype(np int32) source_mask
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
get_config args gigaword_infer_config config max_decode_length dec_len
tfm_model trainable_params params param
params param data value
params param name name
params param set_data Tensor weights weights_name float32
param name name weights_name
isinstance Tensor np ones (1|config seq_length) astype(np int32) source_ids
isinstance Tensor np ones (1|config seq_length) astype(np int32) source_mask
parser parse_known_args _
Dictionary load_from_persisted_dict args existed_vocab vocab
BiLingualDataLoader train
args train_src src_filepath
args train_ref tgt_filepath
vocab|tgt_dict src_dict
NoiseChannelLanguageModel add_noise_prob language_model
args max_len max_sen_len
args format lower
os path join args output_folder path
BiLingualDataLoader test
args test_src src_filepath
args test_ref tgt_filepath
print f
Dictionary load_from_persisted_dict args existed_vocab vocab src_dict
TransformerConfig from_json_file config config
mstype float16 config compute_type
mstype float32 config dtype
print f
callbacks|dataset_sink_mode callbacks
infer _config result
pickle dump result|f|1
config existed_ckpt endswith
np load config existed_ckpt weights
load_checkpoint config existed_ckpt weights
network trainable_params param
param name weights_name
ValueError f
isinstance weights weights_name
param set_data weights weights_name data
param set_data Tensor weights weights_name asnumpy|config dtype
isinstance weights weights_name ndarray
param set_data Tensor weights weights_name dtype
param set_data weights weights_name
param name name
param data value
isinstance value|Tensor
name endswith
param set_data one_weight value asnumpy shape
param set_data zero_weight value asnumpy shape
param set_data weight_variable value asnumpy shape
update_steps update_num
config decay_start_step decay_start_step
config warmup_steps warmup_steps
config min_lr min_lr
config decay_steps decay_steps
update_steps total_update_num
config lr lr
net_with_loss init_parameters_data
_load_checkpoint_to_net config|net_with_loss
config epochs|dataset get_dataset_size update_steps
_get_lr config|update_steps lr
_get_optimizer config|net_with_loss|lr optimizer
config loss_scale_factor scale_factor
net_with_grads set_train True
Model net_with_grads model
TimeMonitor data_size time_cb
os getenv rank_size
callbacks append time_cb
int rank_size
LossCallBack config|rank_id loss_monitor
callbacks append loss_monitor
ModelCheckpoint ckpt_callback
config ckpt_prefix prefix
os path join config ckpt_path| format(MultiAscend get_rank) directory
callbacks append ckpt_callback
os path join config ckpt_path| format(os getenv) directory
context reset_auto_parallel_context
MultiAscend init
ParallelMode DATA_PARALLEL parallel_mode
MultiAscend get_group_size device_num
_setup_parallel_env platform
load_dataset pre_train_dataset
config pre_train_dataset data_files
config dataset_sink_mode sink_mode
config dataset_sink_step sink_step
MultiAscend get_group_size rank_size
MultiAscend get_rank rank_id
load_dataset fine_tune_dataset
config fine_tune_dataset data_files
load_dataset test_dataset
config test_dataset data_files
pre_train_dataset pre_training_dataset
config batch_size batch_size
os path exists config
isinstance config|str
parser parse_known_args _
os getenv None device_id
int device_id device_id
context GRAPH_MODE mode
args platform device_target
os getenv _rank_size
_check_args args config
get_config args config _config
set_seed _config random_seed
context set_context _config save_graphs save_graphs
int _rank_size
train_parallel _config|args platform
train_single _config|args platform
TransformerConfig from_json_file config config existed_ckpt endswith
TransformerConfig from_json_file config config decay_start_step decay_start_step
TransformerConfig from_json_file config config warmup_steps warmup_steps
TransformerConfig from_json_file config config min_lr min_lr
TransformerConfig from_json_file config config decay_steps decay_steps
TransformerConfig from_json_file config config lr lr
TransformerConfig from_json_file config config epochs|dataset get_dataset_size update_steps
TransformerConfig from_json_file config config loss_scale_factor scale_factor
TransformerConfig from_json_file config config loss_monitor
TransformerConfig from_json_file config config ckpt_prefix prefix
TransformerConfig from_json_file config config pre_train_dataset data_files
TransformerConfig from_json_file config config dataset_sink_mode sink_mode
TransformerConfig from_json_file config config dataset_sink_step sink_step
TransformerConfig from_json_file config config fine_tune_dataset data_files
TransformerConfig from_json_file config config test_dataset data_files
TransformerConfig from_json_file config config batch_size batch_size
callbacks|dataset_sink_mode callbacks callbacks
callbacks|dataset_sink_mode callbacks append time_cb
callbacks|dataset_sink_mode callbacks append loss_monitor
callbacks|dataset_sink_mode callbacks append ckpt_callback
network trainable_params param name weights_name
network trainable_params param set_data weights weights_name data
network trainable_params param set_data Tensor weights weights_name asnumpy|config dtype
network trainable_params param set_data Tensor weights weights_name dtype
network trainable_params param set_data weights weights_name
network trainable_params param name name
network trainable_params param data value
network trainable_params param set_data one_weight value asnumpy shape
network trainable_params param set_data zero_weight value asnumpy shape
network trainable_params param set_data weight_variable value asnumpy shape
param name name endswith
_load_checkpoint_to_net config epochs|dataset get_dataset_size update_steps
_load_checkpoint_to_net config loss_scale_factor scale_factor
_load_checkpoint_to_net config ckpt_prefix prefix
_load_checkpoint_to_net config pre_train_dataset data_files
_load_checkpoint_to_net config dataset_sink_mode sink_mode
_load_checkpoint_to_net config dataset_sink_step sink_step
_load_checkpoint_to_net config fine_tune_dataset data_files
_load_checkpoint_to_net config test_dataset data_files
_load_checkpoint_to_net config batch_size batch_size
load_dataset pre_train_dataset pre_training_dataset
TransformerConfig from_json_file config config
mstype float16 config compute_type
mstype float32 config dtype
parser parse_known_args _
Dictionary load_from_persisted_dict args vocab vocab
get_config args config _config
os getenv None device_id
int device_id device_id
context GRAPH_MODE mode
args platform device_target
infer _config result
infer_ppl _config result
open args output|
pickle dump result|f|1
get_score result|vocab|metric score
print score
Dictionary load_from_persisted_dict args vocab vocab score
infer _config result score
infer_ppl _config result score
parser parse_known_args _
os listdir file
file startswith args train_prefixandinfileandfile endswith
os path join args src_folder|file train_src_file
os path join args src_folder|file train_tgt_file
file startswith args test_prefixandinfileandfile endswith
os path join args src_folder|file test_src_file
os path join args src_folder|file test_tgt_file
file startswith args valid_prefixandinfileandfile endswith
os path join args src_folder|file valid_src_file
os path join args src_folder|file valid_tgt_file
Dictionary load_from_persisted_dict args existed_vocab vocab
train_src_file src_filepath
train_tgt_file tgt_filepath
vocab|tgt_dict src_dict
NoiseChannelLanguageModel add_noise_prob language_model
args max_len max_sen_len
os path join path
test_src_file src_filepath
test_tgt_file tgt_filepath
os path join args src_folder|valid_src_file src_filepath
os path join args src_folder|valid_tgt_file tgt_filepath
print f
os listdir file startswith args train_prefixandinfileandfile endswith
os listdir file startswith args test_prefixandinfileandfile endswith
os listdir file startswith args valid_prefixandinfileandfile endswith
os path join args src_folder|file train_src_file src_filepath
os path join args src_folder|file train_tgt_file tgt_filepath
os path join args src_folder|file test_src_file src_filepath
os path join args src_folder|file test_tgt_file tgt_filepath
Dictionary load_from_persisted_dict args existed_vocab vocab src_dict
super BiLingualDataLoader|self __init__ max_sen_len
src_filepath self _src_filepath
tgt_filepath self _tgt_filepath
src_dict self _src_dict
tgt_dict self _tgt_dict
src_lang self src_lang
tgt_lang self tgt_lang
language_model self _lm
max_sen_len self max_sen_len
merge_dict self share_dict
self _merge_dict
merged_dict self _src_dict
merged_dict self _tgt_dict
open self _src_filepath|
print f
open self _tgt_filepath|
enumerate _|_pair
self _src_dict index t
_pair strip splitift t
self _tgt_dict index t
src_tokens append self _src_dict eos_index
tgt_tokens append self _tgt_dict eos_index
self _lm emit opt
np array src_tokens|dtype sentence
np array tgt_tokens|dtype target
self _src_dict mask_index mask_symbol_idx
self _tgt_dict bos_index bos_symbol_idx
opt src_len
opt tgt_len
min _min_len|opt _min_len
max _max_len|opt _max_len
np zeros shape src_padding
np zeros shape tgt_padding
range i
range j
opt shape tokens_count
np min decoder_input
np max decoder_input
self _add_example example
super BiLingualDataLoader|self __init__ max_sen_len self max_sen_len
enumerate _pair strip splitift t
self _lm emit opt src_len
self _lm emit opt tgt_len
self _lm emit opt shape tokens_count
SCHEMA _SCHEMA
max_sen_len self) __init__(max_sen_len
src_filepath self _file_path
lang self _lang
dictionary self _dictionary
language_model self _lm
max_sen_len self max_sen_len
min_sen_len self min_sen_len
np zeros shape src_padding
open self _file_path|
print f
enumerate _|_line
tokens append self _dictionary eos_index
opt src_len
min _min_len|opt _min_len
max _max_len|opt _max_len
self _add_example example
self _add_example example
isinstance sink_mode|bool
input_files datafile
print f
de TFRecordDataset ds
shuffle|num_shards shuffle
ds get_dataset_size ori_dataset_size
epoch_count repeat_count
deC TypeCast mstype int32 type_cast_op
ds rename ds
ds repeat repeat_count ds
isinstance de TFRecordDataset ds
de TFRecordDataset ds get_dataset_size ori_dataset_size
de TFRecordDataset ds rename ds
de TFRecordDataset ds repeat repeat_count ds
shuffle|num_shards shuffle shuffle
SCHEMA _SCHEMA
max_sen_len self _max_sentence_len
sen new_sen
os path isabs path
os path abspath path path
FileWriter file_name writer
writer add_schema self _SCHEMA|desc
self _load
writer write_raw_data self _examples
writer commit
print f
range i
path|%(i|1|shard_num) output_file
output_files append output_file
output_files output_file
writers append tf io TFRecordWriter output_file
collections OrderedDict features
self _examples example
example key
tf train Feature int64_list features key
tf train Example features tf_example
writers writer
writer write tf_example SerializeToString
writer close
output_files p
self _examples append example
os path isabs path output_file
os path abspath path path output_file
FileWriter file_name writer add_schema self _SCHEMA|desc
FileWriter file_name writer write_raw_data self _examples
FileWriter file_name writer commit
FileWriter file_name writer write tf_example SerializeToString
FileWriter file_name writer close
range i output_file
self _examples example key
writers writer write tf_example SerializeToString
writers writer close
super DecoderCell|self __init__
SelfAttention self masked_attn
SelfAttention self enc_dec_attn
FeedForwardNet self feed_forward_net
attn_embed_dim in_channels
intermediate_size hidden_size
attn_embed_dim out_channels
dropout_prob hidden_dropout_prob
self masked_attn attention_output
self enc_dec_attn attention_output
self feed_forward_net attention_output output
super TransformerDecoder|self __init__
decoder_layers self num_layers
attn_embed_dim self attn_embed_dim
DecoderCell self layer0
DecoderCell self layer1
DecoderCell self layer2
DecoderCell self layer3
DecoderCell self layer4
DecoderCell self layer5
input_tensor prev_output
self layer0 prev_output|attention_mask|encoder_out|enc_attention_mask prev_output
self layer1 prev_output|attention_mask|encoder_out|enc_attention_mask prev_output
self layer2 prev_output|attention_mask|encoder_out|enc_attention_mask prev_output
self layer3 prev_output|attention_mask|encoder_out|enc_attention_mask prev_output
self layer4 prev_output|attention_mask|encoder_out|enc_attention_mask prev_output
self layer5 prev_output|attention_mask|encoder_out|enc_attention_mask prev_output
self layer_preprocess prev_output prev_output
super FeedForwardNet|self __init__
hidden_act activation
ResidualConnection self residual
P Shape self get_shape
P Reshape self reshape
self get_shape input_tensor shape
shape batch_size
shape max_len
shape embed_dim
self layer_norm input_tensor output
self fc1 output output
self dropout output output
self fc2 output output
self get_shape input_tensor shape batch_size
self get_shape input_tensor shape max_len
self get_shape input_tensor shape embed_dim
super EmbeddingLookup|self __init__
embed_dim self embedding_dim
vocab_size self vocab_size
use_one_hot_embeddings self use_one_hot_embeddings
np random normal 0|embed_dim-0 5|size init_weight
Parameter Tensor init_weight self embedding_table
P ExpandDims self expand
P GatherV2 self gather
P OneHot self one_hot
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
P MatMul self array_mul
P Reshape self reshape
P Shape self get_shape
self get_shape input_ids _shape
_shape _batch_size
_shape _max_len
self reshape input_ids|(_batch_size|_max_len|) flat_ids
self one_hot flat_ids|self vocab_size|self on_value|self off_value one_hot_ids
self array_mul output_for_reshape
self gather self embedding_table|flat_ids|0 output_for_reshape
self reshape output_for_reshape|(_batch_size|_max_len|self embedding_dim) output
self get_shape input_ids _shape _batch_size
self get_shape input_ids _shape _max_len
super EncoderCell|self __init__
SelfAttention self attention
attention_dropout_prob attn_dropout_prob
hidden_dropout_prob dropout_prob
FeedForwardNet self feed_forward_net
attn_embed_dim in_channels
intermediate_size hidden_size
attn_embed_dim out_channels
hidden_dropout_prob dropout
self feed_forward_net attention_output output
super TransformerEncoder|self __init__
encoder_layers self num_layers
range _
EncoderCell layer
layers append layer
nn CellList layers self layers
LayerNorm in_channels self layer_norm
input_tensor prev_output
self layers layer_module
self layer_norm prev_output prev_output
super LengthPenalty|self __init__
weight self weight
P TensorAdd self add
P Pow self pow
P RealDiv self div
Tensor 5 0|mstype float32 self five
Tensor 6 0|mstype float32 self six
P Cast self cast
self cast length_tensor|mstype float32 length_tensor
self add length_tensor|self five output
self div output|self six output
self pow output|self weight output
super TileBeam|self __init__
beam_width self beam_width
P ExpandDims self expand
P Tile self tile
P Reshape self reshape
P Shape self shape
self shape input_tensor shape
self expand input_tensor|1 input_tensor
(1|)|(self beam_width|) tile_shape
range _
tile_shape|(1|) tile_shape
self tile input_tensor|tile_shape output
(shape|self beam_width|)|shape out_shape
self reshape output|out_shape output
super Mod|self __init__
compute_type self compute_type
P FloorDiv self floor_div
P Sub self sub
P Mul self multiply
self floor_div input_x|input_y x
self multiply x|input_y x
self sub input_x|x x
inferring Default beamsearch
batch_size self batch_size
vocab_size self vocab_size
length_penalty_weight self length_penalty_weight
max_decode_length self max_decode_length
decoder self decoder
(-1|) self shape_flat
Tensor np zeros [batch_size|beam_width] self zero_tensor
Tensor np full [batch_size|beam_width]|-INF self ninf_tensor
P Select self select
(batch_size|beam_width|vocab_size) self flat_shape
Tensor self vocab_size|mstype int32 self vocab_size_tensor
P RealDiv self real_div
Mod self mod
P Equal self equal
Tensor np full [batch_size|beam_width]|eos_id self eos_ids
np tile np arange beam_width reshape (1|beam_width) beam_ids
Tensor beam_ids|mstype int32 self beam_ids
np arange batch_size|beam_width reshape (batch_size|beam_width)||beam_width batch_ids
Tensor batch_ids|mstype int32 self batch_ids
P Concat axis self concat
P GatherNd self gather_nd
Tensor np full [batch_size|beam_width|1]|sos_id self start_ids
Tensor np full [batch_size|beam_width|1]|sos_id self init_seq
np tile np array init_scores
Tensor np zeros [batch_size|beam_width|1] self init_total_log_probs
Tensor init_scores|mstype float32 self init_scores
Tensor np zeros [batch_size|beam_width|seq_length|1] self init_attention
Tensor np zeros [batch_size|beam_width]|dtype self init_finished
Tensor np zeros [batch_size|beam_width]|dtype self init_length
LengthPenalty weight self length_penalty
Tensor 1|mstype int32 self one
P GreaterEqual self greater_equal
P ZerosLike self zeroslike
self decoder cur_input_ids|enc_states|enc_attention_mask log_probs
self reshape log_probs|(self batch_size|self beam_width|self vocab_size) log_probs
self add log_probs|self expand state_log_probs|-1 total_log_probs
self select state_finished|self ninf_tensor|self zero_tensor mask_tensor
self add total_log_probs|self expand mask_tensor|-1 total_log_probs
self reshape total_log_probs|self flat_shape flat_scores
self topk flat_scores|self beam_width topk_indices
topk_indices temp
self zeroslike topk_indices beam_indices
range self beam_width _
self sub temp|self vocab_size_tensor temp
self cast self greater_equal temp|0 res
beam_indices|res beam_indices
topk_indices-beam_indices|self vocab_size_tensor word_indices
self gather_nd current_word_pro
self expand beam_indices|-1
self reshape current_word_pro|(self batch_size|self beam_width) current_word_pro
self select state_finished|self beam_ids|beam_indices beam_indices
self select state_finished|self eos_ids|word_indices word_indices
self select state_finished|state_log_probs|topk_scores topk_scores
self select state_finished|self ninf_tensor|current_word_pro current_word_pro
self select tmp_log_probs
self equal word_indices|self eos_ids
self topk tmp_log_probs|self beam_width tmp_indices
self concat (self expand(self batch_ids|-1)) tmp_gather_indices
self gather_nd beam_indices|tmp_gather_indices beam_indices
self gather_nd word_indices|tmp_gather_indices word_indices
self gather_nd topk_scores|tmp_gather_indices topk_scores
self gather_nd current_word_pro|tmp_gather_indices sorted_current_word_pro
self concat (self expand(self batch_ids|-1)) gather_indices
self add state_length|self one length_add
self select state_finished|state_length|length_add state_length
self gather_nd state_length|gather_indices state_length
self gather_nd state_seq|gather_indices seq
self concat (seq|self expand word_indices|-1) state_seq
self gather_nd entire_log_probs|gather_indices selected_entire_log_probs
self equal word_indices|self eos_ids state_finished
topk_scores state_log_probs
self reshape state_seq|(self batch_size|self beam_width|-1) cur_input_ids
self start_ids cur_input_ids
self init_scores state_log_probs
self init_seq state_seq
self init_finished state_finished
self init_length state_length
self init_total_log_probs entire_log_probs
self one_step entire_log_probs
self length_penalty state_length penalty_len
self real_div state_log_probs|penalty_len log_probs
self topk log_probs|self beam_width top_beam_indices
self gather_nd state_seq|gather_indices predicted_ids
P Shape self shape tile_shape
P Shape self shape beam_width|)|shape out_shape
self shape input_tensor shape tile_shape
self shape input_tensor shape beam_width|)|shape out_shape
(1|)|(self beam_width|) tile_shape tile_shape
tile_shape|(1|) tile_shape tile_shape
self topk flat_scores|self beam_width topk_indices temp
self zeroslike topk_indices beam_indices beam_indices
self zeroslike topk_indices beam_indices vocab_size_tensor word_indices
self cast self greater_equal temp|0 res beam_indices
beam_indices|res beam_indices beam_indices
beam_indices|res beam_indices vocab_size_tensor word_indices
self select state_finished|state_log_probs|topk_scores topk_scores state_log_probs
self gather_nd topk_scores|tmp_gather_indices topk_scores state_log_probs
super CreateAttentionMaskFromInputMask|self __init__
P Cast self cast
P Shape self shape
P Reshape self reshape
P BatchMatMul self batch_matmul
P Mul self multiply
np ones shape ones
Tensor np tril ones self lower_triangle_mask
self shape input_mask input_shape
(input_shape|1|input_shape) shape_right
input_shape|(1|) shape_left
self cast input_mask|mstype float32 input_mask
self reshape input_mask|shape_left mask_left
self reshape input_mask|shape_right mask_right
self batch_matmul mask_left|mask_right attention_mask
self multiply attention_mask|self lower_triangle_mask attention_mask
P Shape self shape shape_right
P Shape self shape shape_left
self shape input_mask input_shape shape_right
self shape input_mask input_shape shape_left
super SelfAttention|self __init__
MultiHeadAttention self multi_head_self_attention
attn_embed_dim src_dim
attn_embed_dim tgt_dim
attn_dropout_prob attention_dropout_prob
LayerNorm in_channels self layer_norm
ResidualConnection dropout_prob self residual
self layer_norm queries q
self multi_head_self_attention attention_output
self residual attention_output|queries q
src_max_len|T' T
super Transformer|self __init__
use_positional_embedding self use_positional_embedding
copy deepcopy config config
is_training self is_training
config batch_size self batch_size
config seq_length self max_positions
config hidden_size self attn_embed_dim
config num_hidden_layers self num_layers
config hidden_size self word_embed_dim
self num_layers-1 self last_idx
EmbeddingLookup self embedding_lookup
config vocab_size vocab_size
self word_embed_dim embed_dim
PositionalEmbedding self positional_embedding
self word_embed_dim embedding_size
TransformerEncoder self encoder
self attn_embed_dim attn_embed_dim
self num_layers encoder_layers
config num_attention_heads num_attn_heads
config intermediate_size intermediate_size
config attention_dropout_prob attention_dropout_prob
config initializer_range initializer_range
config hidden_dropout_prob hidden_dropout_prob
config hidden_act hidden_act
TransformerDecoder self decoder
self num_layers decoder_layers
config attention_dropout_prob attn_dropout_prob
config hidden_dropout_prob dropout_prob
P Cast self cast
config dtype self dtype
SaturateCast dst_type self cast_compute_type
P StridedSlice self slice
CreateAttentionMaskFromInputMask config self _create_attention_mask_from_input_mask
P Mul self multiply
self embedding_lookup source_ids embedding_tables
self multiply src_embeddings|self scale src_embeddings
self positional_embedding src_embeddings src_embeddings
self dropout src_embeddings src_embeddings
self _create_attention_mask_from_input_mask source_mask enc_attention_mask
self encoder encoder_output
self cast_compute_type src_embeddings
self cast_compute_type enc_attention_mask
self embedding_lookup target_ids _
self multiply tgt_embeddings|self scale tgt_embeddings
self positional_embedding tgt_embeddings tgt_embeddings
self dropout tgt_embeddings tgt_embeddings
self _create_attention_mask_from_input_mask tgt_attention_mask
self decoder decoder_output
self cast_compute_type tgt_embeddings
self cast_compute_type tgt_attention_mask
src_max_len|T' T T
copy deepcopy config config batch_size self batch_size
copy deepcopy config config seq_length self max_positions
copy deepcopy config config hidden_size self attn_embed_dim
copy deepcopy config config num_hidden_layers self num_layers
copy deepcopy config config hidden_size self word_embed_dim
copy deepcopy config config vocab_size vocab_size
copy deepcopy config config num_attention_heads num_attn_heads
copy deepcopy config config intermediate_size intermediate_size
copy deepcopy config config attention_dropout_prob attention_dropout_prob
copy deepcopy config config initializer_range initializer_range
copy deepcopy config config hidden_dropout_prob hidden_dropout_prob
copy deepcopy config config hidden_act hidden_act
copy deepcopy config config attention_dropout_prob attn_dropout_prob
copy deepcopy config config hidden_dropout_prob dropout_prob
copy deepcopy config config dtype self dtype
network self network
tfm_model init_parameters_data
tfm_model trainable_params params
load_infer_weights config weights
params param
param data value
param name name
ValueError f
name weights_name
f write(weights_name|)
isinstance value|Tensor
print name|value asnumpy shape
param set_data Tensor weights weights_name float32
TypeError f
TransformerInferCell tfm_model tfm_infer
Model tfm_infer model
source_sentences append batch
target_sentences append batch
Tensor batch|mstype int32 source_ids
Tensor batch|mstype int32 source_mask
time time start_time
model predict source_ids|source_mask entire_probs
predictions append predicted_ids asnumpy
probs append entire_probs asnumpy
range i
inputs i tolist
ref i tolist
batch_out i tolist
batch_probs i tolist
output append example
config batch_size batch_size
config dataset_sink_mode sink_mode
transformer_infer config|eval_dataset prediction
config TransformerConfig
super TransformerInferPPLCell|self __init__
config batch_size self batch_size
config vocab_size self vocab_size
P OneHot self one_hot
Tensor float|mstype float32 self on_value
Tensor float|mstype float32 self off_value
P ReduceSum self reduce_sum
P Reshape self reshape
P Cast self cast
(config batch_size|config seq_length|) self flat_shape
(config batch_size|config seq_length) self batch_shape
(-1|) self last_idx
self transformer source_ids|source_mask|target_ids|target_mask predicted_log_probs
self reshape label_ids|self flat_shape label_ids
self cast label_mask|mstype float32 label_mask
self one_hot label_ids|self vocab_size|self on_value|self off_value one_hot_labels
self reduce_sum predicted_log_probs|one_hot_labels|self last_idx label_log_probs
self reshape label_log_probs|self batch_shape label_log_probs
label_log_probs|label_mask log_probs
self reduce_sum label_mask|self last_idx lengths
TransformerInferPPLCell config tfm_infer
tfm_infer init_parameters_data
load_checkpoint config existed_ckpt parameter_dict
load_param_into_net tfm_infer|parameter_dict
Tensor batch|mstype int32 target_ids
Tensor batch|mstype int32 target_mask
Tensor batch|mstype int32 label_ids
Tensor batch|mstype int32 label_mask
model predict source_ids|source_mask|target_ids|target_mask|label_ids|label_mask length
log_probs append log_prob asnumpy
lengths append length asnumpy
log_prob i tolist
transformer_infer_ppl config|eval_dataset prediction
tfm_model trainable_params params param
params param data value
params param name name
params param set_data Tensor weights weights_name float32
param name name weights_name
ValueError f write(weights_name|)
isinstance Tensor batch|mstype int32 source_ids
isinstance Tensor batch|mstype int32 source_mask
isinstance Tensor float|mstype float32 self on_value
isinstance Tensor float|mstype float32 self off_value
isinstance Tensor batch|mstype int32 target_ids
isinstance Tensor batch|mstype int32 target_mask
isinstance Tensor batch|mstype int32 label_ids
isinstance Tensor batch|mstype int32 label_mask
TransformerInferCell tfm_model tfm_infer init_parameters_data
Model tfm_infer model predict source_ids|source_mask entire_probs
Model tfm_infer model predict source_ids|source_mask|target_ids|target_mask|label_ids|label_mask length
self cast label_mask|mstype float32 label_mask log_probs
self reduce_sum predicted_log_probs|one_hot_labels|self last_idx label_log_probs log_probs
self reshape label_log_probs|self batch_shape label_log_probs log_probs
label_log_probs|label_mask log_probs log_probs
label_log_probs|label_mask log_probs append log_prob asnumpy
self reduce_sum label_mask|self last_idx lengths append length asnumpy
TransformerInferPPLCell config tfm_infer init_parameters_data
depth||2 depth
np arange length|dtype positions
(np log max_timescale|min_timescale|(depth-1)) log_timescale_increment
min_timescale|np exp inv_timescales
np expand_dims positions|1|np expand_dims inv_timescales|0 scaled_time
super PositionalEmbedding|self __init__
P TensorAdd self add
P ExpandDims self expand_dims
Tensor self position_embedding_table
position_encoding max_position_embeddings|embedding_size
P GatherV2 self gather
P Shape self get_shape
self get_shape word_embeddings input_shape
input_shape input_len
self position_embedding_table position_embeddings
self expand_dims position_embeddings|0 position_embeddings
self add word_embeddings|position_embeddings output
depth||2 depth depth
self get_shape word_embeddings input_shape input_len
super ClipGradients|self __init__
nn ClipByNorm self clip_by_norm
P Cast self cast
P DType self dtype
grads grad
self dtype grad dt
self clip_by_norm grad|self cast(F tuple_to_array (clip_value|)) t
new_grads|(t|) new_grads
self clip_by_norm grad|self cast(F tuple_to_array (clip_value|)) t new_grads
new_grads|(t|) new_grads new_grads
super SaturateCast|self __init__
P Cast self cast
dst_type self dst_type
self cast x|self dst_type
super LayerNorm|self __init__
return_2d self return_2d
nn LayerNorm (in_channels|) self layer_norm
P DType self get_dtype
P Reshape self reshape
P Shape self get_shape
self get_shape input_tensor shape
shape batch_size
shape max_len
shape embed_dim
self reshape input_tensor|(-1|embed_dim) output
self cast output|mstype float32 output
self layer_norm output output
self cast output|self get_dtype input_tensor output
self reshape output|(batch_size|max_len|embed_dim) output
self get_shape input_tensor shape batch_size
self get_shape input_tensor shape max_len
self get_shape input_tensor shape embed_dim
Wq D|embed_dim|Wk D|embed_dim|Wv D|embed_dim
Input|Wq(N|T|embed_dim) Q
Input|Wk(N|T|embed_dim) K
Input|Wv(N|T|embed_dim) V
A O
super MultiHeadAttention|self __init__
attn_embed_dim self attn_embed_dim
num_attn_heads self num_attn_heads
attn_embed_dim||num_attn_heads self size_per_head
src_dim self src_dim
tgt_dim self tgt_dim
has_attention_mask self has_attention_mask
P Reshape self reshape
query_act activation
key_act activation
value_act activation
out_act activation
P Mul self multiply
P Transpose self transpose
Tensor |dtype self multiply_data
P BatchMatMul self matmul
nn Softmax self softmax
nn Dropout 1 0-attention_dropout_prob self dropout
P ExpandDims self expand_dims
P Sub self sub
P TensorAdd self add
P Cast self cast
P DType self get_dtype
do_return_2d_tensor self do_return_2d_tensor
SaturateCast dst_type self cast_compute_type
P Cast self softmax_cast
P Shape self get_shape
(0|2|1|3) self transpose_orders
self get_shape queries q_shape
q_shape batch_size
q_shape src_max_len
self get_shape keys k_shape
k_shape tgt_max_len
(batch_size|src_max_len|self num_attn_heads|self size_per_head) _src_4d_shape
(batch_size|tgt_max_len|self num_attn_heads|self size_per_head) _tgt_4d_shape
self reshape queries|(-1|self src_dim) queries_2d
self reshape keys|(-1|self tgt_dim) keys_2d
self reshape values|(-1|self tgt_dim) values_2d
self query_layer queries_2d query_out
self key_layer keys_2d key_out
self value_layer values_2d value_out
self multiply query_out|self scores_mul query_out
self reshape query_out|_src_4d_shape query_layer
self transpose query_layer|self transpose_orders query_layer
self reshape key_out|_tgt_4d_shape key_layer
self transpose key_layer|self transpose_orders key_layer
self reshape value_out|_tgt_4d_shape value_layer
self transpose value_layer|self transpose_orders value_layer
self matmul_trans_b query_layer|key_layer attention_scores
self expand_dims attention_mask|1 attention_mask
self sub multiply_out
self cast F tuple_to_array  1 0||self get_dtype attention_scores
self cast attention_mask|self get_dtype attention_scores
self multiply multiply_out|self multiply_data adder
self softmax_cast adder|mstype float32 adder
self softmax_cast attention_scores|mstype float32 attention_scores
self add adder|attention_scores attention_scores
self softmax attention_scores attention_prob
self softmax_cast attention_prob|self get_dtype key_layer attention_prob
self dropout attention_prob attention_prob
self matmul attention_prob|value_layer context_layer
self transpose context_layer|self transpose_orders context_layer
self out_layer context_layer context_layer
self reshape context_layer
self get_shape queries q_shape batch_size
self get_shape queries q_shape src_max_len
q_shape batch_size num_attn_heads|self size_per_head) _src_4d_shape
q_shape batch_size num_attn_heads|self size_per_head) _tgt_4d_shape
q_shape src_max_len num_attn_heads|self size_per_head) _src_4d_shape
self get_shape keys k_shape tgt_max_len
k_shape tgt_max_len num_attn_heads|self size_per_head) _tgt_4d_shape
super ResidualConnection|self __init__
P TensorAdd self add
nn Dropout 1 0-dropout_prob self dropout
self dropout hidden_tensor output
self add output|residual output
super PredLogProbs|self __init__
config hidden_size self width
P Reshape self reshape
nn LogSoftmax axis self log_softmax
(config batch_size|config seq_length|self width) self shape_flat_sequence_tensor
P Cast self cast
config compute_type self compute_type
config dtype self dtype
P Shape self get_shape
self get_shape input_tensor shape
self reshape input_tensor|(shape|shape|shape) input_tensor
self cast input_tensor|self compute_type input_tensor
self cast output_weights|self compute_type output_weights
self matmul input_tensor|output_weights logits
self cast logits|self dtype logits
self log_softmax logits log_probs
super TransformerTraining|self __init__
Transformer config|is_training|use_one_hot_embeddings self transformer
PredLogProbs config self projection
 embedding_table
self transformer source_ids|source_mask|target_ids|target_mask
super LabelSmoothedCrossEntropyCriterion|self __init__
config vocab_size self vocab_size
P OneHot self onehot
Tensor float 1-config label_smoothing self on_value
Tensor config label_smoothing|float(self vocab_size-1) self off_value
P ReduceSum self reduce_sum
P ReduceMean self reduce_mean
(-1|) self last_idx
P Flatten self flatten
P Neg self neg
(config batch_size|config seq_length|) self flat_shape
self get_shape label_ids label_shape
self reshape label_ids|(label_shape|label_shape|) label_ids
self cast label_weights
self reshape label_weights|(label_shape|label_shape|)
self onehot label_ids|self vocab_size|self on_value|self off_value one_hot_labels
self neg self reduce_sum prediction_scores|one_hot_labels|self last_idx per_example_loss
self reduce_sum label_weights|per_example_loss numerator
self reduce_sum label_weights||self cast(F tuple_to_array (1e-5|)) denominator
numerator|denominator loss
super TransformerNetworkWithLoss|self __init__
TransformerTraining config|is_training|use_one_hot_embeddings self transformer
LabelSmoothedCrossEntropyCriterion config self loss
self transformer source_ids|source_mask|target_ids|target_mask prediction_scores
self loss prediction_scores|label_ids|label_weights total_loss
self cast total_loss|mstype float32
C MultitypeFuncGraph grad_scale
P Reciprocal reciprocal
grad_scale register
F cast reciprocal scale|F dtype grad
C MultitypeFuncGraph _grad_overflow
P FloatStatus grad_overflow
_grad_overflow register
grad_overflow grad
network self network
self network set_grad
optimizer parameters self weights
optimizer self optimizer
P AllReduce self all_reduce
_get_parallel_mode self parallel_mode
ValueError self parallel_mode
_get_gradients_mean mean
_get_device_num degree
DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
(self parallel_mode) self is_distributed
ClipGradients self clip_gradients
P FloatStatus self float_status
P AddN self addn
P NPUAllocFloatStatus self alloc_status
P NPUGetFloatStatus self get_status
P NPUClearFloatStatus self clear_status
Tensor 1|mstype float32 self base
P LessEqual self less_equal
C HyperMap self hyper_map
scale_update_cell self loss_scaling_manager
Parameter Tensor scale_update_cell get_loss_scale|dtype self loss_scale
source_eos_ids source_ids
source_eos_mask source_mask
target_sos_ids target_ids
target_sos_mask target_mask
target_eos_ids label_ids
target_eos_mask label_weights
self weights weights
self alloc_status init
self clear_status init
self loss_scale scaling_sens
sens scaling_sens
self hyper_map F partial grad_scale|scaling_sens grads
self clip_gradients grads|GRADIENT_CLIP_TYPE|GRADIENT_CLIP_VALUE grads
self grad_reducer grads grads
self get_status init
self reduce_sum init|(0|) flag_sum
self hyper_map F partial _grad_overflow flag_sum
self addn flag_sum flag_sum
self reshape flag_sum flag_sum
self all_reduce flag_sum flag_reduce
self less_equal self base|flag_reduce cond
self less_equal self base|flag_sum cond
cond overflow
self loss_scaling_manager self loss_scale|cond overflow
self optimizer grads succ
(loss|cond|scaling_sens) ret
F depend ret|succ
self reduce_sum label_weights|per_example_loss numerator loss
self reduce_sum label_weights||self cast(F tuple_to_array (1e-5|)) denominator loss
numerator|denominator loss ret
LabelSmoothedCrossEntropyCriterion config self loss ret
C MultitypeFuncGraph grad_scale register
C MultitypeFuncGraph _grad_overflow register
P FloatStatus grad_overflow grad
self loss_scale scaling_sens ret
sens scaling_sens ret
self less_equal self base|flag_reduce cond overflow
self less_equal self base|flag_reduce cond ret
self less_equal self base|flag_sum cond overflow
self less_equal self base|flag_sum cond ret
mstype float32 compute_type
super PredLogProbs|self __init__
batch_size self batch_size
seq_length self seq_length
width self width
compute_type self compute_type
dtype self dtype
P Reshape self reshape
nn LogSoftmax axis self log_softmax
(self batch_size|self seq_length|self width) self shape_flat_sequence_tensor
P Cast self cast
self reshape input_tensor|self shape_flat_sequence_tensor input_tensor
self cast input_tensor|self compute_type input_tensor
self cast output_weights|self compute_type output_weights
self matmul input_tensor|output_weights logits
self cast logits|self dtype logits
self log_softmax logits log_probs
embedding_lookup self embedding_lookup
positional_embedding self positional_embedding
projection self projection
TransformerDecoder self decoder
num_hidden_layers decoder_layers
hidden_dropout_prob dropout_prob
P OnesLike self ones_like
P Shape self shape
CreateAttentionMaskFromInputMask config self _create_attention_mask_from_input_mask
P ExpandDims self expand
P Mul self multiply
np ones shape ones
Tensor np tril ones self future_mask
SaturateCast dst_type self cast_compute_type
 [math sqrt float attn_embed_dim]|dtype self scale
self embedding_lookup input_ids embedding_tables
self multiply input_embedding|self scale input_embedding
self positional_embedding input_embedding input_embedding
self cast_compute_type input_embedding input_embedding
self shape input_ids input_shape
input_shape input_len
self future_mask future_mask
self ones_like input_ids input_mask
self _create_attention_mask_from_input_mask input_mask input_mask
self multiply input_mask|self expand future_mask|0 input_mask
self cast_compute_type input_mask input_mask
self decoder input_embedding|input_mask|enc_states|enc_attention_mask decoder_output
self projection decoder_output|embedding_tables log_probs
super TransformerInferModel|self __init__
copy deepcopy config config
config batch_size self batch_size
config seq_length self seq_length
config hidden_size self hidden_size
config num_hidden_layers self num_hidden_layers
config hidden_size self embedding_size
config hidden_size self attn_embed_dim
config num_hidden_layers self num_layers
self num_hidden_layers-1 self last_idx
EmbeddingLookup self embedding_lookup
config vocab_size vocab_size
self embedding_size embed_dim
PositionalEmbedding self positional_embedding
self embedding_size embedding_size
PredLogProbs self projection
config batch_size|config beam_width batch_size
self hidden_size width
TransformerEncoder self encoder
self attn_embed_dim attn_embed_dim
self num_layers encoder_layers
config num_attention_heads num_attn_heads
config intermediate_size intermediate_size
config attention_dropout_prob attention_dropout_prob
config initializer_range initializer_range
config hidden_dropout_prob hidden_dropout_prob
config hidden_act hidden_act
TransformerDecoderStep decoder_cell
config num_hidden_layers num_hidden_layers
config seq_length seq_length
config compute_type compute_type
self embedding_lookup embedding_lookup
self positional_embedding positional_embedding
config attention_dropout_prob attn_dropout_prob
self projection projection
BeamSearchDecoder self decoder
config batch_size batch_size
decoder_cell decoder
config beam_width beam_width
config length_penalty_weight length_penalty_weight
config dtype self dtype
TileBeam beam_width self tile_beam
Tensor ones|dtype self encode_mask
self embedding_lookup source_ids _
self multiply src_embeddings|self scale src_embeddings
self positional_embedding src_embeddings src_embeddings
self _create_attention_mask_from_input_mask source_mask enc_attention_mask
self tile_beam encoder_output beam_encoder_output
self multiply enc_attention_mask
self tile_beam enc_attention_mask beam_enc_attention_mask
self cast_compute_type beam_enc_attention_mask beam_enc_attention_mask
self decoder beam_encoder_output|beam_enc_attention_mask predicted_probs
self reshape predicted_ids|(self batch_size|-1) predicted_ids
mstype float32 compute_type self compute_type
np ones shape ones self encode_mask
self shape input_ids input_shape input_len
copy deepcopy config config batch_size self batch_size
copy deepcopy config config seq_length self seq_length
copy deepcopy config config hidden_size self hidden_size
copy deepcopy config config num_hidden_layers self num_hidden_layers
copy deepcopy config config hidden_size self embedding_size
copy deepcopy config config hidden_size self attn_embed_dim
copy deepcopy config config num_hidden_layers self num_layers
copy deepcopy config config vocab_size vocab_size
copy deepcopy config config batch_size|config beam_width batch_size
copy deepcopy config config num_attention_heads num_attn_heads
copy deepcopy config config intermediate_size intermediate_size
copy deepcopy config config attention_dropout_prob attention_dropout_prob
copy deepcopy config config initializer_range initializer_range
copy deepcopy config config hidden_dropout_prob hidden_dropout_prob
copy deepcopy config config hidden_act hidden_act
copy deepcopy config config num_hidden_layers num_hidden_layers
copy deepcopy config config seq_length seq_length
copy deepcopy config config compute_type compute_type
copy deepcopy config config attention_dropout_prob attn_dropout_prob
copy deepcopy config config batch_size batch_size
copy deepcopy config config beam_width beam_width
copy deepcopy config config length_penalty_weight length_penalty_weight
copy deepcopy config config dtype self dtype
TransformerDecoderStep decoder_cell decoder
config dtype self dtype self encode_mask
s find idx
ValueError f
zip h|r
cut h replace strip h
cut r replace strip r
edited_hyp append(h|)
edited_ref append(r|)
Rouge _rouge
print f
open H_PATH|
f writelines edited_hyp
open R_PATH|
f writelines edited_ref
ValueError f writelines edited_hyp
ValueError f writelines edited_ref
print f writelines edited_hyp
print f writelines edited_ref
ISR inversesquareroot
np linspace 0|lr|warmup_steps lrs
lr|sqrt(warmup_steps) decay_factor
decay_factor|sqrt(step)ifstep lr
lr warmup_end_lr
(warmup_end_lr-warmup_init_lr)|warmup_steps lr_step
lr|warmup_steps0 5 decay_factor
np empty shape lrs
np linspace warmup_init_lr|warmup_end_lr|warmup_steps lrs
warmup_steps _start_step
range step
warmup_init_lr|step|lr_step _lr
lr _lr
decay_factor|step-0 5 _lr
min_lr _lr
_lr lrs step
np zeros shape lrs
step-_start_step _step
ceil _step|decay_steps ratio
decay_steps|ratio _decay_steps
(lr-min_lr)|pow(1-_step|_decay_steps|power)|min_lr lrs step
super BertLearningRate|self __init__
lr_schedules WarmUpLR learning_rate|warmup_steps self warmup_lr
lr_schedules PolynomialDecayLR learning_rate|end_learning_rate|decay_steps|power self decay_lr
Tensor np array [warmup_steps] astype np float32 self warmup_steps
P Greater self greater
Tensor np array astype np float32 self one
P Cast self cast
self cast self greater self warmup_steps|global_step is_warmup
self warmup_lr global_step warmup_lr
self decay_lr global_step decay_lr
(self one-is_warmup)|decay_lr|is_warmup|warmup_lr lr
lr|sqrt(warmup_steps) decay_factor lr
lr|sqrt(warmup_steps) decay_factor 5 _lr
decay_factor|sqrt(step)ifstep lr warmup_end_lr
decay_factor|sqrt(step)ifstep lr 5 decay_factor
decay_factor|sqrt(step)ifstep lr _lr
decay_factor|sqrt(step)ifstep lr _lr
(warmup_end_lr-warmup_init_lr)|warmup_steps lr_step _lr
lr|warmup_steps0 5 decay_factor 5 _lr
range step _lr
range step 5 _lr
range step lrs step
warmup_init_lr|step|lr_step _lr _lr
warmup_init_lr|step|lr_step _lr lrs step
lr _lr lrs step
decay_factor|step-0 5 _lr lrs step
min_lr _lr lrs step
_lr lrs step lrs step
step-_start_step _step lrs step
ceil _step|decay_steps ratio _decay_steps
decay_steps|ratio _decay_steps lrs step
(lr-min_lr)|pow(1-_step|_decay_steps|power)|min_lr lrs step lrs step
Perplexity PPL
isinstance prob|(np ndarray|list)
isinstance prob|np ndarray
np array prob prob
np sum prob|length prob
range i
pow p|1|length ppl
suffixifnotsuffixelse|suffix suffix
MonoLingualDataLoader loader
text_file src_filepath
LooseMaskedLanguageModel mask_ratio language_model
max_sen_len|min_sen_len max_sen_len
os path basename text_file src_file_name
os path join file_name
src_file_name replace
loader write_to_tfrecord file_name path
loader write_to_mindrecord file_name path
os path exists output_folder_path
NotADirectoryError f
os path isdir output_folder_path
os listdir folder_path dirs
dirs file
file startswith prefixandfile endswith
data_file append os path join folder_path|file
data_file text_file
min cores|cpu_count cores
Pool cores pool
args_groups arg
arg args
pool close
pool join
print f
suffixifnotsuffixelse|suffix suffix suffix
MonoLingualDataLoader loader write_to_tfrecord file_name path
MonoLingualDataLoader loader write_to_mindrecord file_name path
max_sen_len|min_sen_len max_sen_len max_sen_len
os path basename text_file src_file_name replace
os listdir folder_path dirs file
dirs file startswith prefixandfile endswith
Pool cores pool close
Pool cores pool join
args_groups arg args
super LossCallBack|self __init__
isinstance per_print_times|int
config self config
per_print_times self _per_print_times
rank_id self rank_id
self _get_ms_timestamp self time_stamp_first
run_context original_args cb_params
open file_name|
self _get_ms_timestamp time_stamp_current
str cb_params net_outputs asnumpy
time time t
int round t|1000
isinstance per_print_times self _per_print_times
isinstance int round t|1000
shape fan_in
shape fan_out
shape dim
shape|receptive_field_size fan_in
shape|receptive_field_size fan_out
int fan_in|int fan_out
shape scale_shape
_compute_fans scale_shape fan_out
math sqrt 3 0|scale limit
np random uniform -limit|limit|shape astype(np float32) values
Tensor values
np ones shape astype np float32 ones
Tensor ones
np zeros shape astype np float32 zeros
Tensor zeros
np random normal 0 0|num_units-0 5|shape astype(np float32) norm
Tensor norm
Perplexity PPL
result sample
sample log_prob
sample length
log_probs extend log_prob
length total_length
print f
sample]) t
rouge predictions|targets
get_rouge_score result|vocab score
get_ppl_score result score
result sample log_prob
result sample length
sample length total_length
config existed_ckpt model_path
model_path endswith
np load model_path ms_ckpt
load_checkpoint model_path ms_ckpt
ms_ckpt param_name
param_name replace infer_name
infer_name startswith
infer_name replace infer_name
ms_ckpt param_name weights infer_name
f write infer_name
f write
f close
config existed_ckpt model_path endswith
np load model_path ms_ckpt param_name
np load model_path ms_ckpt param_name weights infer_name
load_checkpoint model_path ms_ckpt param_name
load_checkpoint model_path ms_ckpt param_name weights infer_name
ms_ckpt param_name replace infer_name
param_name replace infer_name startswith
param_name replace infer_name replace infer_name
bos self _bos
eos self _eos
unk self _unk
mask self _mask
padding self _padding
self _init_symbols
max_size self max_vocab_size
Dictionary _new_dict
[ f|ifori|finenumerate(self _frequency)] freq_idx
np array self _frequency|dtype freqs
np where freqs filtered_count
self size-filtered_count left_count
CUBE_SIZE-left_count%CUBE_SIZE supplement
freq_idx f|i
_new_dict add_symbol self _symbols i
learn self is_learning
len self _symbols
self add_symbol self _padding|0 self _padding_index
self add_symbol self _bos|0 self _bos_index
self add_symbol self _eos|0 self _eos_index
self add_symbol self _unk|0 self _unk_index
self add_symbol self _mask|0 self _mask_index
self _mapping get symbol idx
symbol isalpha
self add_symbol symbol
symbol lower
self _mapping get symbol lower
self _mapping get symbol lower idx
self _frequency idx freq
self _mapping symbol idx
self _frequency idx self _frequency idx
len self _symbols idx
idx self _mapping symbol
self _symbols append symbol
self _frequency append times
cls _dict
filepaths filepath
enumerate _|line
line strip line
line split freq
int freq times
open filepath|
pickle load f
open path|
other is_empty
Dictionary _dict
zip s|f
f times
zip token|freq
_lines append f
f writelines _lines
Dictionary _new_dict add_symbol self _symbols i
[ f|ifori|finenumerate(self _frequency)] freq_idx f|i
freq_idx f times
freq_idx f writelines _lines
self _mapping get symbol idx self _mapping symbol
self add_symbol symbol lower
self _mapping get symbol lower idx self _mapping symbol
self _mapping symbol idx self _mapping symbol
self _frequency idx self _frequency idx self _mapping symbol
len self _symbols idx self _mapping symbol
enumerate line strip line
enumerate line split freq
pickle load f times
pickle load f writelines _lines
zip f times
zip f writelines _lines
zip f writelines _lines
_lines append f writelines _lines
os path isabs src_path
os path isabs output_path
os path exists os path dirname src_path
os path exists os path dirname output_path
ENCODER split commands
subprocess call commands
LEARN_DICT split commands
super LooseMaskedLanguageModel|self __init__
mask_ratio self mask_ratio
k self _k
mask_all_prob self _threshold
sentence copy encoder_input
np concatenate ([vocabulary bos_index]|sentence) right_shifted_sentence
right_shifted_sentence decoder_input
vocabulary mask_index decoder_input
sentence copy decoder_output
u start|v stop encoder_input[np arange
np array [vocabulary padding_index]|(u-1) padding
np concatenate (padding|decoder_input) decoder_input
np concatenate (padding|decoder_output) decoder_output
min length|fix_length interval_length
min length|round(self mask_ratio|length) interval_length
np random random _magic
np concatenate ([vocabulary bos_index]|sentence) right_shifted_sentence decoder_input
super MaskedLanguageModel|self __init__
mask_ratio self mask_ratio
k self _k
mask_all_prob self _threshold
sentence copy encoder_input
encoder_input shape seq_len
np array [vocabulary mask_index]|_len|dtype decoder_input
encoder_input copy decoder_input
np array [vocabulary mask_index]|(v-u) decoder_input
encoder_input copy decoder_output
vocabulary mask_index encoder_input
u start|v stop encoder_input[np arange
np array [vocabulary padding_index]|u|dtype padding
np concatenate (padding|decoder_input) decoder_input
np concatenate (padding|decoder_output) decoder_output
min length|fix_length interval_length
min length|round(self mask_ratio|length) interval_length
np random random _magic
sentence copy encoder_input shape seq_len
sentence copy encoder_input copy decoder_input
sentence copy encoder_input copy decoder_output
super MaskedLanguageModel|self __init__
super MassLanguageModel|self __init__
fragment_ratio self fragment_ratio
keep_ratio self keep_ratio
random_ratio self random_ratio
mask_all_prob self _threshold
sentence copy encoder_input
encoder_input shape seq_len
self _get_masked_interval v
len encoder_input
self _threshold threshold_to_mask_all
np array [vocabulary mask_index]|_len|dtype decoder_input
encoder_input copy decoder_input
np array [vocabulary mask_index]|(v-u) decoder_input
encoder_input copy decoder_output
vocabulary mask_index encoder_input
u start|v stop encoder_input[np arange
np array [vocabulary padding_index]|u|dtype padding
np concatenate (padding|decoder_input) decoder_input
np concatenate (padding|decoder_output) decoder_output
sentence replacement
src_idx position
self keep_ratio repl_prob
np where decoder_input prev_opt_idx
vocabulary mask_index replacement
prev_opt_idx position
[repl_prob|random_prob] _probs
np floor _random_len
np array _probs
isinstance replacement|np ndarray
replacement _repl_idx sentence _repl_idx
replacement sentence _repl_idx
np random randint sentence _random_idx
_random_idx shape|dtype size
min length|fix_length interval_length
min length|round(self fragment_ratio|length) interval_length
np random random _magic
sentence copy encoder_input shape seq_len
sentence copy encoder_input copy decoder_input
sentence copy encoder_input copy decoder_output
len encoder_input copy decoder_input
len encoder_input copy decoder_output
sentence replacement _repl_idx sentence _repl_idx
sentence replacement sentence _repl_idx
self keep_ratio repl_prob _probs
np where decoder_input prev_opt_idx position
vocabulary mask_index replacement _repl_idx sentence _repl_idx
vocabulary mask_index replacement sentence _repl_idx
np random randint sentence _random_idx shape|dtype size
super NoiseChannelLanguageModel|self __init__
add_noise_prob self _noisy_prob
sentence copy encoder_input
target shape tgt_seq_len
enumerate i|_
np random random _prob
mask_symbol_idx encoder_input i
np empty shape decoder_input
target decoder_input
bos_symbol_idx decoder_input
file lowerorinfile lower
os listdir file
_is_dataset_file file
_files append os path join folder|file
os path isdir folder
_get_files_from_dir folder _list
_is_dataset_file folder
_list append folder
inferring  beamsearch
lr_scheduler_power float
save_graphs self save_graphs
random_seed self random_seed
dataset_schema self dataset_schema
get_source_list pre_train_dataset self pre_train_dataset
get_source_list fine_tune_dataset self fine_tune_dataset
get_source_list valid_dataset self valid_dataset
get_source_list test_dataset self test_dataset
isinstance epochs|int
epochs self epochs
dataset_sink_mode self dataset_sink_mode
ckpt_path self ckpt_path
keep_ckpt_max self keep_ckpt_max
save_ckpt_steps self save_ckpt_steps
ckpt_prefix self ckpt_prefix
existed_ckpt self existed_ckpt
batch_size self batch_size
seq_length self seq_length
vocab_size self vocab_size
hidden_size self hidden_size
num_hidden_layers self num_hidden_layers
hidden_act self hidden_act
intermediate_size self intermediate_size
hidden_dropout_prob self hidden_dropout_prob
attention_dropout_prob self attention_dropout_prob
initializer_range self initializer_range
label_smoothing self label_smoothing
beam_width self beam_width
length_penalty_weight self length_penalty_weight
max_decode_length self max_decode_length
input_mask_from_dataset self input_mask_from_dataset
mstype float16 self compute_type
dtype self dtype
scale_window self scale_window
loss_scale_factor self loss_scale_factor
init_loss_scale self init_loss_scale
optimizer self optimizer
lr self lr
lr_scheduler self lr_scheduler
min_lr self min_lr
lr_scheduler_power self lr_scheduler_power
warmup_lr_remain_steps self warmup_lr_remain_steps
warmup_lr_decay_interval self warmup_lr_decay_interval
decay_steps self decay_steps
decay_start_step self decay_start_step
warmup_steps self warmup_steps
PARAM_NODES node
json_object key
json_object node][key _params key
cls _params
open json_file|
cls from_dict json load reader
copy deepcopy self __dict__ output
_get_files_from_dir folder _list append folder
isinstance epochs self epochs
parser parse_known_args _
os path exists args output_folder
os makedirs args output_folder
args src_folder vocab
args src_folder bpe_codes
TextDataLoader test
os path join args src_folder|test_src_file src_filepath
args output_folder schema_address
print f
os path join path
os path basename test_src_file
BiLingualDataLoader train
os path join args src_folder|train_src_file src_filepath
os path join args src_folder|train_tgt_file tgt_filepath
os path basename train_src_file
os getenv None device_id
print f
int device_id device_id
context GRAPH_MODE mode
GNMTConfig from_json_file config config
mstype float16 config compute_type
mstype float32 config dtype
pre_training_dataset get_repeat_count epoch_size
print epoch_size
fine_tune_dataset get_repeat_count epoch_size
config existed_ckpt endswith
np load config existed_ckpt weights
load_checkpoint config existed_ckpt weights
network trainable_params param
param name weights_name
ValueError f
isinstance weights weights_name
param set_data weights weights_name data
param set_data Tensor weights weights_name asnumpy|config dtype
isinstance weights weights_name ndarray
param set_data Tensor weights weights_name dtype
param set_data weights weights_name
param name name
param data value
isinstance value|Tensor
name endswith
param set_data one_weight value asnumpy shape
param set_data  weight_variable value asnumpy shape astype np float32
param set_data  weight_variable value asnumpy shape astype np float16
param set_data Tensor weight_variable value asnumpy shape astype np float32
param set_data Tensor weight_variable value asnumpy shape astype np float16
update_steps update_num
config decay_start_step decay_start_step
config warmup_steps warmup_steps
config min_lr min_lr
config decay_steps decay_steps
update_steps total_update_num
config warmup_lr_remain_steps remain_steps
config warmup_lr_decay_interval decay_interval
config lr lr
net_with_loss init_parameters_data
_load_checkpoint_to_net config|net_with_loss
config epochs|dataset get_dataset_size update_steps
_get_lr config|update_steps lr
_get_optimizer config|net_with_loss|lr optimizer
config loss_scale_factor scale_factor
GNMTTrainOneStepWithLossScaleCell net_with_grads
net_with_loss|optimizer network
scale_manager get_update_cell scale_update_cell
net_with_grads set_train True
Model net_with_grads model
LossCallBack config loss_monitor
dataset get_dataset_size dataset_size
TimeMonitor data_size time_cb
os getenv rank_size
[time_cb|loss_monitor] callbacks
ModelCheckpoint ckpt_callback
config ckpt_prefix prefix
os path join config ckpt_path| format(os getenv) directory
callbacks append ckpt_callback
callbacks append summary_callback
context reset_auto_parallel_context
MultiAscend init
ParallelMode DATA_PARALLEL parallel_mode
MultiAscend get_group_size device_num
load_dataset pre_train_dataset
config pre_train_dataset data_files
config dataset_schema schema
config batch_size batch_size
config dataset_sink_mode sink_mode
MultiAscend get_group_size rank_size
MultiAscend get_rank rank_id
load_dataset fine_tune_dataset
config fine_tune_dataset|schema data_files
load_dataset test_dataset
config test_dataset|schema data_files
pre_train_dataset pre_training_dataset
os path exists config
isinstance config|str
os getenv _rank_size
parser parse_known_args _
_check_args args config
get_config args config _config
args dataset_schema_train _config dataset_schema
args pre_train_dataset _config pre_train_dataset
set_seed _config random_seed
int _rank_size
train_parallel _config
train_single _config
GNMTConfig from_json_file config config existed_ckpt endswith
GNMTConfig from_json_file config config decay_start_step decay_start_step
GNMTConfig from_json_file config config warmup_steps warmup_steps
GNMTConfig from_json_file config config min_lr min_lr
GNMTConfig from_json_file config config decay_steps decay_steps
GNMTConfig from_json_file config config warmup_lr_remain_steps remain_steps
GNMTConfig from_json_file config config warmup_lr_decay_interval decay_interval
GNMTConfig from_json_file config config lr lr
GNMTConfig from_json_file config config epochs|dataset get_dataset_size update_steps
GNMTConfig from_json_file config config loss_scale_factor scale_factor
GNMTConfig from_json_file config config ckpt_prefix prefix
GNMTConfig from_json_file config config pre_train_dataset data_files
GNMTConfig from_json_file config config dataset_schema schema
GNMTConfig from_json_file config config batch_size batch_size
GNMTConfig from_json_file config config dataset_sink_mode sink_mode
GNMTConfig from_json_file config config fine_tune_dataset|schema data_files
GNMTConfig from_json_file config config test_dataset|schema data_files
network trainable_params param name weights_name
network trainable_params param set_data weights weights_name data
network trainable_params param set_data Tensor weights weights_name asnumpy|config dtype
network trainable_params param set_data Tensor weights weights_name dtype
network trainable_params param set_data weights weights_name
network trainable_params param name name
network trainable_params param data value
network trainable_params param set_data one_weight value asnumpy shape
network trainable_params param set_data  weight_variable value asnumpy shape astype np float32
network trainable_params param set_data  weight_variable value asnumpy shape astype np float16
network trainable_params param set_data Tensor weight_variable value asnumpy shape astype np float32
network trainable_params param set_data Tensor weight_variable value asnumpy shape astype np float16
param name name endswith
_load_checkpoint_to_net config epochs|dataset get_dataset_size update_steps
_load_checkpoint_to_net config loss_scale_factor scale_factor
_load_checkpoint_to_net config ckpt_prefix prefix
_load_checkpoint_to_net config pre_train_dataset data_files
_load_checkpoint_to_net config dataset_schema schema
_load_checkpoint_to_net config batch_size batch_size
_load_checkpoint_to_net config dataset_sink_mode sink_mode
_load_checkpoint_to_net config fine_tune_dataset|schema data_files
_load_checkpoint_to_net config test_dataset|schema data_files
_get_optimizer config|net_with_loss|lr optimizer network
GNMTTrainOneStepWithLossScaleCell net_with_grads set_train True
LossCallBack config loss_monitor callbacks
TimeMonitor data_size time_cb callbacks
[time_cb|loss_monitor] callbacks append ckpt_callback
[time_cb|loss_monitor] callbacks append summary_callback
load_dataset pre_train_dataset pre_training_dataset
GNMTConfig from_json_file config config
mstype float16 config compute_type
mstype float32 config dtype
os path exists config
isinstance config|str
parser parse_known_args _
_check_args args config
get_config args config _config
args dataset_schema_test _config dataset_schema
args test_dataset _config test_dataset
args existed_ckpt _config existed_ckpt
infer _config result
open args output|
pickle dump result|f|1
args output result_npy_addr
args vocab vocab
args bpe_codes bpe_codes
args test_tgt test_tgt
Tokenizer vocab|bpe_codes tokenizer
bleu_calculate tokenizer|result_npy_addr|test_tgt scores
print f
super BiLingualDataLoader|self __init__
src_filepath self _src_filepath
tgt_filepath self _tgt_filepath
tokenizer self tokenizer
min_sen_len self min_sen_len
source_max_sen_len self source_max_sen_len
target_max_sen_len self target_max_sen_len
schema_address self schema_address
open self _src_filepath|
print f
enumerate _|_pair
int self tokenizer tok2idx t
_pair strip splitift t
len src_tokens src_len
src_len max_src
max_src|2 self source_max_sen_len
len src_tokens tgt_len
tgt_len max_tgt
max_tgt|1 self target_max_sen_len
open self _tgt_filepath|
src_tokens insert 0|self tokenizer bos_index
src_tokens append self tokenizer eos_index
tgt_tokens insert 0|self tokenizer bos_index
tgt_tokens append self tokenizer eos_index
np array src_tokens src_tokens
np array tgt_tokens tgt_tokens
src_tokens shape src_len
tgt_tokens shape tgt_len
self padding src_tokens|self tokenizer padding_index|self source_max_sen_len encoder_input
np zeros shape src_padding
range i
self padding tgt_tokens|self tokenizer padding_index|self target_max_sen_len decoder_input
self padding tgt_tokens|self tokenizer padding_index|self target_max_sen_len decoder_output
np zeros shape tgt_padding
range j
np array decoder_input|dtype decoder_input
np array decoder_output|dtype decoder_output
np array tgt_padding|dtype tgt_padding
self _add_example example
f write
f write %provlist
columns name
f write %provlist[t]
len columns
print |self schema_address
super TextDataLoader|self __init__
self tokenizer tokenize _pair src_tokens
max_src self source_max_sen_len
[count|self source_max_sen_len|self source_max_sen_len] provlist
print f write
print f write %provlist
print f write %provlist[t]
enumerate _pair strip splitift t
int self tokenizer tok2idx t self target_max_sen_len
int self tokenizer tok2idx t source_max_sen_len|self source_max_sen_len] provlist
_pair strip splitift t self target_max_sen_len
_pair strip splitift t source_max_sen_len|self source_max_sen_len] provlist
len src_tokens src_len max_src
src_len max_src self source_max_sen_len
src_len max_src self source_max_sen_len
len src_tokens tgt_len max_tgt
tgt_len max_tgt self target_max_sen_len
np array src_tokens src_tokens shape src_len
np array tgt_tokens tgt_tokens shape tgt_len
isolator self isolator
self init_bpe bpe_code_address
self vocab_establist vocab_address|vocab_pad
sacremoses MosesTokenizer src_en self sacremoses_tokenizer
sacremoses MosesDetokenizer tgt_de self sacremoses_detokenizer
os path exists bpe_code_address
open bpe_code_address|
subword_nmt apply_bpe BPE f1 self bpe
[self pad_word|self unk_word|self bos_word|self eos_word] vocab_words
open vocab_address
f1 sentence
vocab_words append sentence strip
len vocab_words vocab_size
(vocab_size|vocab_pad-1)||vocab_pad|vocab_pad padded_vocab_size
range 0|padded_vocab_size idx
vocab_words append fil_token
len vocab_words self vocab_size
defaultdict partial int|self unk_index self tok2idx
enumerate idx|token
idx self tok2idx token
defaultdict partial str| self idx2tok
self tok2idx items token|idx
token self idx2tok idx
self bpe process_line tokenized bpe
bpe strip split sentence
reconstruction_bpe replace self isolator| reconstruction_bpe
reconstruction_bpe replace self isolator reconstruction_bpe
reconstruction_bpe replace self bos_word reconstruction_bpe
reconstruction_bpe replace self eos_word reconstruction_bpe
reconstruction_bpe replace self unk_word reconstruction_bpe
reconstruction_bpe replace self pad_word reconstruction_bpe
reconstruction_bpe strip reconstruction_bpe
self sacremoses_detokenizer detokenize reconstruction_bpe split reconstruction_words
subword_nmt apply_bpe BPE f1 self bpe strip split sentence
[self pad_word|self unk_word|self bos_word|self eos_word] vocab_words append sentence strip
[self pad_word|self unk_word|self bos_word|self eos_word] vocab_words append fil_token
len vocab_words vocab_size padded_vocab_size
(vocab_size|vocab_pad-1)||vocab_pad|vocab_pad padded_vocab_size idx
range 0|padded_vocab_size idx self tok2idx token
enumerate idx self tok2idx token
enumerate token self idx2tok idx
idx self tok2idx token self idx2tok idx
self tok2idx items token self idx2tok idx
self bpe process_line tokenized bpe strip split sentence
vocab_words append fil_token
os path exists schema_file
os path isfile schema_file
isinstance sink_mode|bool
input_files datafile
print f
de MindDataset ds
ds get_dataset_size ori_dataset_size
ds shuffle buffer_size ds
deC TypeCast mstype int32 type_cast_op
ds rename ds
ds batch batch_size|drop_remainder ds
isinstance de MindDataset ds
de MindDataset ds get_dataset_size ori_dataset_size
de MindDataset ds shuffle buffer_size ds
de MindDataset ds rename ds
de MindDataset ds batch batch_size|drop_remainder ds
SCHEMA _SCHEMA
TEST_SCHEMA _TEST_SCHEMA
np array [padding_idx]|need_sentence_len|dtype new_sen
sen new_sen
os path isabs path
os path abspath path path
FileWriter file_name writer
writer add_schema self _SCHEMA|desc
writer add_schema self _TEST_SCHEMA|desc
self _load
writer write_raw_data self _examples
writer commit
print f
self _examples append example
FileWriter file_name writer add_schema self _SCHEMA|desc
FileWriter file_name writer add_schema self _TEST_SCHEMA|desc
FileWriter file_name writer write_raw_data self _examples
FileWriter file_name writer commit
isinstance values|float
int values|total_steps values
ISR inversesquareroot
np linspace 0|lr|warmup_steps lrs
lr|sqrt(warmup_steps) decay_factor
decay_factor|sqrt(step)ifstep lr
lr warmup_end_lr
(warmup_end_lr-warmup_init_lr)|warmup_steps lr_step
lr|warmup_steps0 5 decay_factor
np empty shape lrs
np linspace warmup_init_lr|warmup_end_lr|warmup_steps lrs
warmup_steps _start_step
range step
warmup_init_lr|step|lr_step _lr
lr _lr
decay_factor|step-0 5 _lr
min_lr _lr
_lr lrs step
np zeros shape lrs
step-_start_step _step
ceil _step|decay_steps ratio
decay_steps|ratio _decay_steps
(lr-min_lr)|pow(1-_step|_decay_steps|power)|min_lr lrs step
convert_float2int remain_steps|total_update_num remain_steps
convert_float2int warmup_steps|total_update_num warmup_steps
remain_steps warmup_steps
total_update_num-remain_steps decay_iterations
decay_iterations||decay_steps decay_interval
max decay_interval|1 decay_interval
convert_float2int decay_interval|total_update_num decay_interval
range last_epoch
math exp math log|warmup_steps warmup_factor
warmup_factor(warmup_steps-last_epoch) inv_decay
base_lr|inv_decay lrs last_epoch
last_epoch-remain_steps decay_iter
decay_iter||decay_interval|1 num_decay_step
min num_decay_step|decay_steps num_decay_step
base_lr|(decay_factornum_decay_step) lrs last_epoch
base_lr lrs last_epoch
lr|sqrt(warmup_steps) decay_factor lr
lr|sqrt(warmup_steps) decay_factor 5 _lr
decay_factor|sqrt(step)ifstep lr warmup_end_lr
decay_factor|sqrt(step)ifstep lr 5 decay_factor
decay_factor|sqrt(step)ifstep lr _lr
decay_factor|sqrt(step)ifstep lr _lr
decay_factor|sqrt(step)ifstep lr lrs last_epoch
decay_factor|sqrt(step)ifstep lr lrs last_epoch
(warmup_end_lr-warmup_init_lr)|warmup_steps lr_step _lr
lr|warmup_steps0 5 decay_factor 5 _lr
range step _lr
range step 5 _lr
range step lrs step
warmup_init_lr|step|lr_step _lr _lr
warmup_init_lr|step|lr_step _lr lrs step
warmup_init_lr|step|lr_step _lr lrs last_epoch
warmup_init_lr|step|lr_step _lr lrs last_epoch
lr _lr lrs step
lr _lr lrs last_epoch
lr _lr lrs last_epoch
decay_factor|step-0 5 _lr lrs step
decay_factor|step-0 5 _lr lrs last_epoch
decay_factor|step-0 5 _lr lrs last_epoch
min_lr _lr lrs step
min_lr _lr lrs last_epoch
min_lr _lr lrs last_epoch
_lr lrs step lrs step
step-_start_step _step lrs step
ceil _step|decay_steps ratio _decay_steps
decay_steps|ratio _decay_steps lrs step
(lr-min_lr)|pow(1-_step|_decay_steps|power)|min_lr lrs step lrs step
convert_float2int remain_steps|total_update_num remain_steps warmup_steps
total_update_num-remain_steps decay_iterations decay_interval
decay_iterations||decay_steps decay_interval num_decay_step
max decay_interval|1 decay_interval num_decay_step
convert_float2int decay_interval|total_update_num decay_interval num_decay_step
warmup_factor(warmup_steps-last_epoch) inv_decay lrs last_epoch
last_epoch-remain_steps decay_iter num_decay_step
super LossCallBack|self __init__
isinstance per_print_times|int
config self config
per_print_times self _per_print_times
self _get_ms_timestamp self time_stamp_first
run_context original_args cb_params
open file_name|
self _get_ms_timestamp time_stamp_current
str cb_params net_outputs asnumpy
time time t
int round t|1000
isinstance per_print_times self _per_print_times
isinstance int round t|1000
shape fan_in
shape fan_out
shape dim
shape|receptive_field_size fan_in
shape|receptive_field_size fan_out
int fan_in|int fan_out
np random uniform -limit|limit|shape values
np ones shape astype np float32 ones
Tensor ones
np zeros shape astype np float32 zeros
Tensor zeros
np random normal 0 0|num_units-0 5|shape astype(np float32) norm
Tensor norm
config existed_ckpt model_path
model_path endswith
np load model_path ms_ckpt
load_checkpoint model_path ms_ckpt
ms_ckpt param_name
param_name replace infer_name
infer_name startswith
ms_ckpt param_name weights infer_name
f write infer_name
f write
infer_name replace infer_name
f close
config existed_ckpt model_path endswith
np load model_path ms_ckpt param_name
np load model_path ms_ckpt param_name weights infer_name
load_checkpoint model_path ms_ckpt param_name
load_checkpoint model_path ms_ckpt param_name weights infer_name
ms_ckpt param_name replace infer_name
param_name replace infer_name startswith
param_name replace infer_name replace infer_name
ms_ckpt param_name weights infer_name replace infer_name
f write infer_name replace infer_name
C MultitypeFuncGraph adam_opt
adam_opt register
range  the1stmomentestimates Shouldbe
range  the2ndmomentestimates Shouldbe
P Mul op_mul
P Square op_square
P Sqrt op_sqrt
P Cast op_cast
P Reshape op_reshape
P Shape op_shape
op_cast param|mstype float32 param_fp32
op_cast m|mstype float32 m_fp32
op_cast v|mstype float32 v_fp32
op_cast gradient|mstype float32 gradient_fp32
op_mul beta1|m_fp32|op_mul(op_cast(F tuple_to_array((1 0|)))) next_m
next_m|(op_sqrt(next_v)|eps) update
update|op_mul(weight_decay_tensor|param_fp32) update
op_mul lr|update update_with_lr
param_fp32-op_reshape(update_with_lr|op_shape(param_fp32)) next_param
F depend next_v|F assign param|next_param next_v
F depend next_v|F assign m|next_m next_v
F depend next_v|F assign v|next_v next_v
validator check_value_type beta1|[float]|prim_name
validator check_value_type beta2|[float]|prim_name
validator check_value_type eps|[float]|prim_name
validator check_value_type weight_decay|[float]|prim_name
validator check_float_positive learning_rate|prim_name
validator check_float_legal_value learning_rate|prim_name
validator check_float_positive end_learning_rate|prim_name
validator check_float_legal_value end_learning_rate|prim_name
validator check_float_positive power|prim_name
validator check_float_legal_value power|prim_name
validator check_integer decay_steps|0|Rel GT|prim_name
 m
 v
 l
w-l| w
range Default the1stmomentestimates Shouldbe
range Default the2ndmomentestimates Shouldbe
Net net
nn Adam params optim
nn SoftmaxCrossEntropyWithLogits loss
Model net|loss_fn model
super Adam|self __init__ learning_rate|params|weight_decay|loss_scale
_check_param_value beta1|beta2|eps|weight_decay|self cls_name
validator check_value_type use_locking|[bool]|self cls_name
validator check_value_type use_nesterov|[bool]|self cls_name
validator check_value_type loss_scale|[float]|self cls_name
Tensor beta1|mstype float32 self beta1
Tensor beta2|mstype float32 self beta2
Parameter initializer 1||mstype float32 self beta1_power
Parameter initializer 1||mstype float32 self beta2_power
eps self eps
C HyperMap self hyper_map
P Adam use_locking|use_nesterov self opt
P Pow self pow
P Sqrt self sqrt
Tensor np array astype np float32 self one
P RealDiv self realdiv
P ScalarSummary self lr_scalar
self parameters params
self moment1 moment1
self moment2 moment2
self decay_weight gradients gradients
self scale_grad gradients gradients
self get_lr lr
self lr_scalar lr
self beta1_power|self beta1 beta1_power
beta1_power self beta1_power
self beta2_power|self beta2 beta2_power
beta2_power self beta2_power
nn AdamWeightDecay params optim
super AdamWeightDecay|self __init__ learning_rate|params
RuntimeError f
Tensor np array [beta1] astype np float32 self beta1
Tensor np array [beta2] astype np float32 self beta2
Tensor np array [eps] astype np float32 self eps
Tensor np array [weight_decay] astype np float32 self weight_decay_tensor
self parameters self params
super AdamWeightDecayDynamicLR|self __init__ learning_rate|params
_check_learning_rate_value learning_rate|end_learning_rate|decay_steps|power|self cls_name
Parameter initializer 0| self global_step
Tensor np array [warmup_steps] astype np float32 self warmup_steps
Tensor np array [decay_steps] astype np float32 self decay_steps
Tensor np array [end_learning_rate] astype np float32 self end_learning_rate
Tensor np array [learning_rate-end_learning_rate] astype(np float32) self diff_learning_rate
power self power
P Minimum self min
P Greater self greater
P Cast self cast
Tensor np array [learning_rate] astype np float32 self start_learning_rate
self min self global_step|self decay_steps step
step|self decay_steps p
self diff_learning_rate|self pow(self one-p|self power)|self end_learning_rate lr
self global_step|self warmup_steps warmup_percent
self start_learning_rate|warmup_percent warmup_lr
self cast self greater self warmup_steps|self global_step is_warmup
(self one-is_warmup)|lr|is_warmup|warmup_lr lr
self global_step|self one added_global_step
F control_depend lr|added_global_step
added_global_step self global_step
C MultitypeFuncGraph adam_opt register
P Mul op_mul beta1|m_fp32|op_mul(op_cast(F tuple_to_array((1 0|)))) next_m
P Mul op_mul update
P Mul op_mul lr|update update_with_lr
P Cast op_cast param|mstype float32 param_fp32
P Cast op_cast m|mstype float32 m_fp32
P Cast op_cast v|mstype float32 v_fp32
P Cast op_cast gradient|mstype float32 gradient_fp32
P Shape op_shape next_param
op_cast param|mstype float32 param_fp32 update
op_mul beta1|m_fp32|op_mul(op_cast(F tuple_to_array((1 0|)))) next_m update
next_m|(op_sqrt(next_v)|eps) update update
update|op_mul(weight_decay_tensor|param_fp32) update update
op_mul lr|update update_with_lr next_param
validator check_value_type  m
validator check_value_type  v
validator check_value_type  l
validator check_value_type  m
validator check_value_type  v
validator check_value_type  l
validator check_value_type  m
validator check_value_type  v
validator check_value_type  l
validator check_value_type eps self eps
validator check_value_type  m
validator check_value_type  v
validator check_value_type  l
validator check_float_positive  m
validator check_float_positive  v
validator check_float_positive  l
validator check_float_legal_value  m
validator check_float_legal_value  v
validator check_float_legal_value  l
validator check_float_positive  m
validator check_float_positive  v
validator check_float_positive  l
validator check_float_legal_value  m
validator check_float_legal_value  v
validator check_float_legal_value  l
validator check_float_positive  m
validator check_float_positive  v
validator check_float_positive  l
validator check_float_positive power self power
validator check_float_legal_value  m
validator check_float_legal_value  v
validator check_float_legal_value  l
validator check_float_legal_value power self power
validator check_integer decay_steps|0|Rel  m
validator check_integer decay_steps|0|Rel  v
validator check_integer decay_steps|0|Rel  l
 l w
 l model
Net net model
nn SoftmaxCrossEntropyWithLogits loss model
Parameter initializer 1||mstype float32 self beta1_power self beta1_power
Parameter initializer 1||mstype float32 self beta2_power self beta2_power
self beta1_power|self beta1 beta1_power self beta1_power
self beta2_power|self beta2 beta2_power self beta2_power
self min self global_step|self decay_steps step decay_steps p
step|self decay_steps p decay_steps p
self global_step|self one added_global_step self global_step
F control_depend added_global_step self global_step
super PredLogProbs|self __init__
P Reshape self reshape
nn LogSoftmax axis self log_softmax
P Shape self get_shape
self get_shape input_tensor shape
self reshape input_tensor|(shape|shape|shape) logits
self log_softmax logits log_probs
super GNMTTraining|self __init__
GNMT config|is_training|use_one_hot_embeddings self gnmt
PredLogProbs config self projection
self gnmt source_ids|source_mask|target_ids decoder_outputs
self projection decoder_outputs prediction_scores
super LabelSmoothedCrossEntropyCriterion|self __init__
config vocab_size self vocab_size
config batch_size self batch_size
(-1|) self last_idx
P ReduceSum self reduce_sum
P ReduceMean self reduce_mean
P Neg self neg
P Cast self cast
Tensor np arange config batch_size|config max_decode_length reshape (-1|1) self index_ids
P GatherNd self gather_nd
P ExpandDims self expand
P Concat axis self concat
self reshape prediction_scores|(-1|self vocab_size) prediction_scores
self reshape label_ids|(-1|1) label_ids
self reshape label_weights|(-1|) label_weights
self concat (self index_ids|label_ids) tmp_gather_indices
self neg self gather_nd prediction_scores|tmp_gather_indices nll_loss
label_weights|nll_loss nll_loss
self neg self reduce_mean prediction_scores|self last_idx smooth_loss
label_weights|smooth_loss smooth_loss
self reduce_sum self confidence|nll_loss|self smoothing|smooth_loss loss
loss|self batch_size loss
super GNMTNetworkWithLoss|self __init__
GNMTTraining config|is_training|use_one_hot_embeddings self gnmt
LabelSmoothedCrossEntropyCriterion config self loss
self gnmt source_ids|source_mask|target_ids prediction_scores
self loss prediction_scores|label_ids|label_weights total_loss
self cast total_loss|mstype float32
C MultitypeFuncGraph grad_scale
P Reciprocal reciprocal
grad_scale register
F cast reciprocal scale|F dtype grad
C MultitypeFuncGraph _grad_overflow
P FloatStatus grad_overflow
_grad_overflow register
grad_overflow grad
network self network
self network set_grad
optimizer parameters self weights
optimizer self optimizer
P AllReduce self all_reduce
_get_parallel_mode self parallel_mode
ValueError self parallel_mode
_get_gradients_mean mean
_get_device_num degree
DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
(self parallel_mode) self is_distributed
ClipGradients self clip_gradients
P NPUAllocFloatStatus self alloc_status
P NPUGetFloatStatus self get_status
P NPUClearFloatStatus self clear_before_grad
Tensor 1|mstype float32 self base
P LessEqual self less_equal
C HyperMap self hyper_map
scale_update_cell self loss_scaling_manager
Parameter Tensor scale_update_cell get_loss_scale|dtype self loss_scale
P ScalarSummary self loss_scalar
source_eos_ids source_ids
source_eos_mask source_mask
target_sos_ids target_ids
target_eos_ids label_ids
target_eos_mask label_weights
self weights weights
self alloc_status init
self clear_before_grad init
self loss_scale scaling_sens
sens scaling_sens
self hyper_map F partial grad_scale|scaling_sens grads
self clip_gradients grads|GRADIENT_CLIP_TYPE|GRADIENT_CLIP_VALUE grads
self grad_reducer grads grads
self get_status init
self reduce_sum init|(0|) flag_sum
self all_reduce flag_sum flag_reduce
self less_equal self base|flag_reduce cond
self less_equal self base|flag_sum cond
cond overflow
self loss_scaling_manager self loss_scale|cond overflow
self optimizer grads succ
self loss_scalar loss
(loss|cond|scaling_sens) ret
F depend ret|succ
self reshape label_weights|(-1|) label_weights nll_loss
self reshape label_weights|(-1|) label_weights smooth_loss
self neg self gather_nd prediction_scores|tmp_gather_indices nll_loss nll_loss
label_weights|nll_loss nll_loss nll_loss
self neg self reduce_mean prediction_scores|self last_idx smooth_loss smooth_loss
label_weights|smooth_loss smooth_loss smooth_loss
self reduce_sum self confidence|nll_loss|self smoothing|smooth_loss loss batch_size loss
self reduce_sum self confidence|nll_loss|self smoothing|smooth_loss loss ret
loss|self batch_size loss batch_size loss
loss|self batch_size loss ret
LabelSmoothedCrossEntropyCriterion config self loss ret
C MultitypeFuncGraph grad_scale register
C MultitypeFuncGraph _grad_overflow register
P FloatStatus grad_overflow grad
self loss_scale scaling_sens ret
sens scaling_sens ret
self less_equal self base|flag_reduce cond overflow
self less_equal self base|flag_reduce cond ret
self less_equal self base|flag_sum cond overflow
self less_equal self base|flag_sum cond ret
self loss_scalar loss ret
super GNMTDecoder|self __init__
is_training self is_training
config hidden_size self attn_embed_dim
config num_hidden_layers self num_layers
config hidden_dropout_prob self hidden_dropout_prob
config vocab_size self vocab_size
config max_decode_length self seq_length
config batch_size|infer_beam_width self batch_size
config hidden_size self word_embed_dim
P Transpose self transpose
(1|0|2) self transpose_orders
P Reshape self reshape
P Concat axis self concat
range i
self batch_size batchsize
scaler|self word_embed_dim word_embed_dim
decoder_layers append layer
nn CellList decoder_layers self decoder_layers
self word_embed_dim input_size
self attn_embed_dim context_size
self attn_embed_dim hidden_size
Uniform initializer_range weight_init
P Cast self cast
P Shape self shape_op
P ExpandDims self expand
self shape_op tgt_embeddings query_shape
self all_decoder_state hidden_state
decoder_init_state hidden_state
self concat (x|attn) x
self dropout x x
self decoder_layers x|hidden_state state_1
self state_concat (self expand state_0|0) all_decoder_state
decoder_outputs residual
self concat (decoder_outputs|attn) decoder_outputs
self dropout decoder_outputs decoder_outputs
self decoder_layers decoder_state
residual decoder_outputs
self state_concat (all_decoder_state|self expand decoder_state|0) all_decoder_state
self reshape decoder_outputs|(-1|self word_embed_dim) decoder_outputs
self cast decoder_outputs|mstype float16 decoder_outputs
self classifier decoder_outputs decoder_outputs
self cast decoder_outputs|mstype float32 decoder_outputs
self reshape decoder_outputs|(query_shape|query_shape|self vocab_size) decoder_outputs
decoder_outputs residual decoder_outputs
context GRAPH_MODE mode
print  format model_path
load_checkpoint model_path ms_ckpt
ms_ckpt msname
f write(msname|)
params param
param name name
f write(name|)
network self network
tfm_model trainable_params params
get_weight_and_variable config existed_ckpt|params
load_infer_weights config weights
param data value
ValueError f
name weights_name
f write weights_name
f write
isinstance value|Tensor
print name|value asnumpy shape
isinstance weights weights_name
param set_data Tensor weights weights_name data asnumpy|mstype float32
param set_data Tensor weights weights_name data asnumpy|mstype float16
param set_data Tensor weights weights_name asnumpy|config dtype
isinstance weights weights_name ndarray
param set_data Tensor weights weights_name dtype
param set_data weights weights_name
print |weights_name
param set_data zero_weight value asnumpy shape
f close
GNMTInferCell tfm_model tfm_infer
Model tfm_infer model
P Shape shape
dataset create_dict_iterator batch
source_sentences append batch asnumpy
Tensor batch|mstype int32 source_ids
Tensor batch|mstype int32 source_mask
shape source_ids active_num
concat (source_ids|source_ids_pad) source_ids
concat (source_mask|source_mask_pad) source_mask
time time start_time
model predict source_ids|source_mask predicted_ids
batch_index|1 batch_index
predictions append predicted_ids asnumpy
zip inputs|batch_out
enumerate i|_
inputs i tolist
batch_out i tolist
output append example
config dataset_schema schema
config batch_size batch_size
config dataset_sink_mode sink_mode
gnmt_infer config|eval_dataset prediction
load_checkpoint model_path ms_ckpt msname
f name weights_name
params param name name
params param data value
params param set_data Tensor weights weights_name data asnumpy|mstype float32
params param set_data Tensor weights weights_name data asnumpy|mstype float16
params param set_data Tensor weights weights_name asnumpy|config dtype
params param set_data Tensor weights weights_name dtype
params param set_data weights weights_name
params param set_data zero_weight value asnumpy shape
param name name weights_name
f name weights_name
get_weight_and_variable config param data value
get_weight_and_variable config param set_data Tensor weights weights_name data asnumpy|mstype float32
get_weight_and_variable config param set_data Tensor weights weights_name data asnumpy|mstype float16
get_weight_and_variable config param set_data Tensor weights weights_name asnumpy|config dtype
get_weight_and_variable config param set_data Tensor weights weights_name dtype
get_weight_and_variable config param set_data weights weights_name
get_weight_and_variable config param set_data zero_weight value asnumpy shape
ValueError f write weights_name
ValueError f write
ValueError f close
isinstance Tensor batch|mstype int32 source_ids
isinstance Tensor batch|mstype int32 source_mask
print name|value asnumpy shape source_ids active_num
param set_data zero_weight value asnumpy shape source_ids active_num
Model tfm_infer model predict source_ids|source_mask predicted_ids
P Shape shape source_ids active_num
batch_index|1 batch_index batch_index
zip inputs i tolist
zip batch_out i tolist
src_max_len|T' T
super GNMT|self __init__
config input_mask_from_dataset self input_mask_from_dataset
config seq_length self max_positions
config hidden_size self attn_embed_dim
copy deepcopy config config
is_training self is_training
config num_hidden_layers self num_layers
config hidden_dropout_prob self hidden_dropout_prob
config vocab_size self vocab_size
config seq_length self seq_length
config batch_size self batch_size
config max_decode_length self max_decode_length
config hidden_size self word_embed_dim
config beam_width self beam_width
P Transpose self transpose
(1|0|2) self transpose_orders
EmbeddingLookup self embedding_lookup
self is_training is_training
self vocab_size vocab_size
self word_embed_dim embed_dim
GNMTEncoder config|is_training self gnmt_encoder
GNMTDecoder config|is_training self gnmt_decoder
P ExpandDims self expand
P Mul self multiply
P Reshape self reshape
TileBeam beam_width self tile_beam
SaturateCast dst_type self cast_compute_type
BeamDecoderStep config|use_one_hot_embeddings beam_decoder_cell
BeamSearchDecoder self beam_decoder
config batch_size batch_size
config seq_length seq_length
config vocab_size vocab_size
beam_decoder_cell decoder
config beam_width beam_width
config num_hidden_layers decoder_layers_nums
config length_penalty_weight length_penalty_weight
config hidden_size hidden_size
P Shape self shape
self embedding_lookup source_ids _
self transpose src_embeddings|self transpose_orders inputs
self gnmt_encoder inputs encoder_outputs
self embedding_lookup target_ids _
self transpose tgt_embeddings|self transpose_orders tgt_embeddings
self transpose cell|self transpose_orders decoder_outputs
decoder_outputs out
self transpose encoder_outputs|self transpose_orders beam_encoder_output
self tile_beam beam_encoder_output beam_encoder_output
self tile_beam source_mask beam_enc_attention_pad
self beam_decoder beam_encoder_output|beam_enc_attention_pad predicted_ids
self reshape predicted_ids|(-1|self max_decode_length) predicted_ids
predicted_ids out
src_max_len|T' T T
copy deepcopy config config num_hidden_layers self num_layers
copy deepcopy config config hidden_dropout_prob self hidden_dropout_prob
copy deepcopy config config vocab_size self vocab_size
copy deepcopy config config seq_length self seq_length
copy deepcopy config config batch_size self batch_size
copy deepcopy config config max_decode_length self max_decode_length
copy deepcopy config config hidden_size self word_embed_dim
copy deepcopy config config beam_width self beam_width
copy deepcopy config config beam_decoder_cell
copy deepcopy config config batch_size batch_size
copy deepcopy config config seq_length seq_length
copy deepcopy config config vocab_size vocab_size
copy deepcopy config config beam_width beam_width
copy deepcopy config config num_hidden_layers decoder_layers_nums
copy deepcopy config config length_penalty_weight length_penalty_weight
copy deepcopy config config hidden_size hidden_size
BeamDecoderStep config|use_one_hot_embeddings beam_decoder_cell decoder
self transpose cell|self transpose_orders decoder_outputs out
self beam_decoder beam_encoder_output|beam_enc_attention_pad predicted_ids out
self reshape predicted_ids|(-1|self max_decode_length) predicted_ids out
super BahdanauAttention|self __init__
is_training self is_training
query_size self query_size
key_size self key_size
normalize self normalize
num_units self num_units
Parameter Tensor np array [1 0|num_units] self normalize_scalar
Parameter Tensor np zeros num_units self normalize_bias
P Transpose self transpose
(1|0|2) self transpose_orders
P Shape self shape_op
P ExpandDims self expand
P Tile self tile
nn Norm axis self norm
P Mul self mul
P MatMul self matmul
P BatchMatMul self batchMatmul
nn Tanh self tanh
nn Softmax axis self softmax
P Reshape self reshape
P Cast self cast
Shape N|t_k
self transpose keys|self transpose_orders keys
self transpose query|self transpose_orders query
self shape_op query query_shape
query_shape b
query_shape t_q
self shape_op keys t_k
self reshape query|(b|t_q|self query_size) query
self cast query|mstype float16 query
self linear_q query processed_query
self cast processed_query|mstype float32 processed_query
self reshape processed_query|(b|t_q|self num_units) processed_query
self reshape keys|(b|t_k|self key_size) keys
self cast keys|mstype float16 keys
self linear_k keys processed_key
self cast processed_key|mstype float32 processed_key
self reshape processed_key|(b|t_k|self num_units) processed_key
self calc_score processed_query|processed_key scores
attention_mask mask
self tile self expand mask|1 mask
mask|(-INF) scores
self softmax scores scores_normalized
self cast scores_normalized|mstype float16 scores_normalized_fp16
scores_normalized scores_normalized_fp16
self batchMatmul scores_normalized_fp16|keys context_attention
self transpose context_attention|self transpose_orders context_attention
self cast context_attention|mstype float32 context_attention
self shape_op att_keys n
self shape_op att_query t_q
self tile self expand att_query|2 att_query
self tile self expand att_keys|1 att_keys
att_query|att_keys sum_qk
sum_qk|self normalize_bias sum_qk
self linear_att|self norm(self linear_att) linear_att
self cast linear_att|mstype float32 linear_att
self mul linear_att|self normalize_scalar linear_att
self linear_att linear_att
self expand linear_att|-1 linear_att
self reshape sum_qk|(-1|n) sum_qk
self tanh sum_qk tanh_sum_qk
self cast linear_att|mstype float16 linear_att
self cast tanh_sum_qk|mstype float16 tanh_sum_qk
self matmul tanh_sum_qk|linear_att out
self reshape out|(b|t_q|t_k) out
self cast out|mstype float32 out
self transpose query|self transpose_orders query sum_qk
self shape_op query query_shape b
self shape_op query query_shape t_q
self reshape query|(b|t_q|self query_size) query sum_qk
self cast query|mstype float16 query sum_qk
attention_mask mask scores
self tile self expand mask|1 mask scores
self softmax scores scores_normalized scores_normalized_fp16
self tile self expand att_query|2 att_query sum_qk
self tile self expand att_keys|1 att_keys sum_qk
att_query|att_keys sum_qk normalize_bias sum_qk
sum_qk|self normalize_bias sum_qk normalize_bias sum_qk
super RecurrentAttention|self __init__
rnn self rnn
hidden_size query_size
hidden_size key_size
hidden_size num_units
self dropout decoder_embedding decoder_embedding
self rnn decoder_embedding|rnn_init_state rnn_state
self attn query scores
super EmbeddingLookup|self __init__
is_training self is_training
embed_dim self embedding_dim
vocab_size self vocab_size
use_one_hot_embeddings self use_one_hot_embeddings
np random normal -initializer_range|initializer_range|size init_weight
Parameter Tensor init_weight|mstype float32 self embedding_table
P ExpandDims self expand
P GatherV2 self gather
P OneHot self one_hot
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
P MatMul self array_mul
P Reshape self reshape
P Shape self get_shape
P Cast self cast
self get_shape input_ids _shape
_shape _batch_size
_shape _max_len
self cast self embedding_table|mstype float16 embedding_table
self embedding_table embedding_table
self reshape input_ids|(_batch_size|_max_len|) flat_ids
self one_hot flat_ids|self vocab_size|self on_value|self off_value one_hot_ids
self cast one_hot_ids|mstype float16 one_hot_ids
self array_mul output_for_reshape
self gather embedding_table|flat_ids|0 output_for_reshape
self reshape output_for_reshape|(_batch_size|_max_len|self embedding_dim) output
self cast output|mstype float32 output
self cast embedding_table|mstype float32 embedding_table
self get_shape input_ids _shape _batch_size
self get_shape input_ids _shape _max_len
load_result_data result_npy_addr result
enumerate _|info
info prediction
tokenizer detokenize prediction prediction_str
prediction_list append prediction_str
round float sacrebleu stdout strip bleu_scores
get_bleu_data tokenizer|result_npy_addr prediction
print prediction
open eval_path|
eval_file writelines lines
target_addr reference_path
calculate_sacrebleu eval_path|reference_path bleu_scores
enumerate info prediction
mstype float32 compute_type
super PredLogProbs|self __init__
batch_size self batch_size
seq_length self seq_length
width self width
compute_type self compute_type
dtype self dtype
nn LogSoftmax axis self log_softmax
P Cast self cast
self log_softmax logits log_probs
config vocab_size self vocab_size
config hidden_size self word_embed_dim
EmbeddingLookup self embedding_lookup
config vocab_size vocab_size
self word_embed_dim embed_dim
PredLogProbs self projection
config batch_size|config beam_width batch_size
config vocab_size width
config max_decode_length self seq_length
P OnesLike self ones_like
P Shape self shape
P ExpandDims self expand
P Mul self multiply
np ones shape ones
Tensor np tril ones self future_mask
SaturateCast dst_type self cast_compute_type
P Transpose self transpose
(1|0|2) self transpose_orders
self embedding_lookup input_ids _
self cast_compute_type input_embedding input_embedding
self shape input_ids input_shape
input_shape input_len
self transpose input_embedding|self transpose_orders input_embedding
self transpose enc_states|self transpose_orders enc_states
self transpose decoder_output|self transpose_orders decoder_output
self projection decoder_output log_probs
mstype float32 compute_type self compute_type
self shape input_ids input_shape input_len
super GNMTEncoder|self __init__
config input_mask_from_dataset self input_mask_from_dataset
config seq_length self max_positions
config hidden_size self attn_embed_dim
config num_hidden_layers self num_layers
config hidden_dropout_prob self hidden_dropout_prob
config vocab_size self vocab_size
config seq_length self seq_length
config batch_size self batch_size
config hidden_size self word_embed_dim
P Transpose self transpose
(1|0|2) self transpose_orders
P Reshape self reshape
P Concat axis self concat
range 0|self num_layers i
self batch_size batchsize
scaler|self word_embed_dim word_embed_dim
encoder_layers append layer
nn CellList encoder_layers self encoder_layers
P ReverseV2 axis self reverse_v2
self dropout inputs inputs
self encoder_layers inputs _
self reverse_v2 inputs inputs_r
self encoder_layers inputs_r _
self reverse_v2 bak_encoder_outputs bak_encoder_outputs
self concat (fwd_encoder_outputs|bak_encoder_outputs) bi_encoder_outputs
self dropout bi_encoder_outputs bi_encoder_outputs
self encoder_layers bi_encoder_outputs _
range 3|self num_layers i
encoder_outputs residual
self dropout encoder_outputs encoder_outputs
self encoder_layers i encoder_outputs _
encoder_outputs_o|residual encoder_outputs
encoder_outputs residual encoder_outputs
super LengthPenalty|self __init__
weight self weight
P TensorAdd self add
P Pow self pow
P RealDiv self div
Tensor 5 0|mstype float32 self five
Tensor 6 0|mstype float32 self six
P Cast self cast
self cast length_tensor|mstype float32 length_tensor
self add length_tensor|self five output
self div output|self six output
self pow output|self weight output
super TileBeam|self __init__
beam_width self beam_width
P ExpandDims self expand
P Tile self tile
P Reshape self reshape
P Shape self shape
self shape input_tensor shape
self expand input_tensor|1 input_tensor
(1|)|(self beam_width|) tile_shape
range _
tile_shape|(1|) tile_shape
self tile input_tensor|tile_shape output
(shape|self beam_width|)|shape out_shape
self reshape output|out_shape output
super Mod|self __init__
compute_type self compute_type
P FloorDiv self floor_div
P Sub self sub
P Mul self multiply
self floor_div input_x|input_y x
self multiply x|input_y x
self sub input_x|x x
inferring Default beamsearch
super BeamSearchDecoder|self __init__
seq_length self encoder_length
hidden_size self hidden_size
batch_size self batch_size
vocab_size self vocab_size
decoder_layers_nums self decoder_layers_nums
length_penalty_weight self length_penalty_weight
cov_penalty_factor self cov_penalty_factor
max_decode_length self max_decode_length
decoder self decoder
(-1|) self shape_flat
Tensor np zeros [batch_size|beam_width] self zero_tensor
Tensor np full [batch_size|beam_width]|-INF self ninf_tensor
P Select self select
(batch_size|beam_width|vocab_size) self flat_shape
Tensor self vocab_size|mstype int32 self vocab_size_tensor
P RealDiv self real_div
Mod self mod
P Equal self equal
Tensor np full [batch_size|beam_width]|eos_id self eos_ids
np tile np arange beam_width reshape (1|beam_width) beam_ids
Tensor beam_ids|mstype int32 self beam_ids
np arange batch_size|beam_width reshape (batch_size|beam_width)||beam_width batch_ids
Tensor batch_ids|mstype int32 self batch_ids
P Concat axis self concat
P GatherNd self gather_nd
Tensor 0|dtype self start
Tensor np full [batch_size|beam_width|1]|sos_id self start_ids
Tensor np full [batch_size|beam_width|self max_decode_length]|sos_id self init_seq
np tile np array init_scores
Tensor init_scores|mstype float32 self init_scores
Tensor np zeros [batch_size|beam_width]|dtype self init_finished
Tensor np zeros [batch_size|beam_width]|dtype self init_length
LengthPenalty weight self length_penalty
Tensor 1|mstype int32 self one
Tensor np zeros [batch_size|beam_width]|dtype self zeros_scores
Tensor np ones [batch_size|beam_width]|dtype self active_index
Tensor np zeros [batch_size|beam_width]|dtype self init_zeros
Tensor np ones [batch_size|beam_width]|dtype self init_ones
Tensor np zeros [batch_size|beam_width|self encoder_length]|dtype self accu_attn_scores
Tensor |mstype int32 self zeros
Tensor np full [batch_size|beam_width|beam_width]|eos_id self eos_tensor
Tensor np full [batch_size|beam_width|self encoder_length]|1 self ones_3d
Tensor np full [batch_size|beam_width|self encoder_length]|-INF self neg_inf_3d
Tensor np full [batch_size|beam_width|self encoder_length]|0 self zeros_3d
Tensor np full [batch_size|beam_width|self encoder_length]|0 self zeros_2d
P ReduceSum self reducesum
P Div self div
P Shape self shape_op
P Mul self mul
P Log self log
P Less self less
P Neg self noteq
P ZerosLike self zeroslike
P GreaterEqual self greater_equal
self reshape attn|(-1|self beam_width|self encoder_length) attn
self cast state_finished|mstype int32 state_finished_attn
self tile self expand state_finished_attn|2 attn_mask_0
self cast attn_mask_0|mstype bool_ attn_mask_0
self select attn_mask_0|self zeros_3d|attn attn_new
self add accu_attn_scores|attn_new accu_attn_scores
self reshape log_probs|(-1|self beam_width|self vocab_size) log_probs
self add log_probs|self expand state_log_probs|-1 total_log_probs
self select state_finished|self ninf_tensor|self zero_tensor mask_tensor
self add total_log_probs|self expand mask_tensor|-1 total_log_probs
self reshape total_log_probs|(-1|self beam_width|self vocab_size) flat_scores
self topk flat_scores|self beam_width topk_indices
topk_indices temp
self zeroslike topk_indices beam_indices
range self beam_width _
self sub temp|self vocab_size_tensor temp
self cast self greater_equal temp|0 res
beam_indices|res beam_indices
topk_indices-beam_indices|self vocab_size_tensor word_indices
self select state_finished|self beam_ids|beam_indices beam_indices
self select state_finished|self eos_ids|word_indices word_indices
self select state_finished|state_log_probs|topk_scores topk_scores
self select tmp_log_probs
self equal word_indices|self eos_ids
self topk tmp_log_probs|self beam_width tmp_indices
self concat (self expand(self batch_ids|-1)) tmp_gather_indices
self gather_nd beam_indices|tmp_gather_indices beam_indices
self gather_nd word_indices|tmp_gather_indices word_indices
self gather_nd topk_scores|tmp_gather_indices topk_scores
self concat (self expand(self batch_ids|-1)) gather_indices
self add state_length|self one length_add
self select state_finished|state_length|length_add state_length
self gather_nd state_length|gather_indices state_length
self gather_nd state_seq|gather_indices seq
self gather_nd accu_attn_scores|gather_indices accu_attn_scores
range self decoder_layers_nums i
self cast seq|mstype float32 state_seq_new
self cast word_indices|mstype float32 word_indices_fp32
word_indices_fp32 state_seq_new
self cast state_seq_new|mstype int32 state_seq
self reshape word_indices|(-1|1) cur_input_ids
topk_scores state_log_probs
self equal word_indices|self eos_ids state_finished
self start_ids cur_input_ids
self init_scores state_log_probs
self init_seq state_seq
self init_finished state_finished
self init_length state_length
self decoder_hidden_state decoder_hidden_state
self accu_attn_scores accu_attn_scores
self start|1 idx
self start|self max_decode_length|1 ends
idx|1 idx
self length_penalty state_length penalty_len
self real_div state_log_probs|penalty_len log_probs
C clip_by_value accu_attn_scores|0 0|1 0 penalty_cov
self log penalty_cov penalty_cov
self less penalty_cov|self neg_inf_3d penalty_less
self select penalty_less|self zeros_3d|penalty_cov penalty
self reducesum penalty|2 penalty
log_probs|penalty|self cov_penalty_factor log_probs
self topk log_probs|self beam_width top_beam_indices
self gather_nd state_seq|gather_indices predicted_ids
P Shape self shape tile_shape
P Shape self shape beam_width|)|shape out_shape
self shape input_tensor shape tile_shape
self shape input_tensor shape beam_width|)|shape out_shape
(1|)|(self beam_width|) tile_shape tile_shape
tile_shape|(1|) tile_shape tile_shape
self floor_div input_x|input_y x idx
self multiply x|input_y x idx
self sub input_x|x x idx
self reshape log_probs|(-1|self beam_width|self vocab_size) log_probs cov_penalty_factor log_probs
self topk flat_scores|self beam_width topk_indices temp
self zeroslike topk_indices beam_indices beam_indices
self zeroslike topk_indices beam_indices vocab_size_tensor word_indices
self cast self greater_equal temp|0 res beam_indices
beam_indices|res beam_indices beam_indices
beam_indices|res beam_indices vocab_size_tensor word_indices
self select state_finished|state_log_probs|topk_scores topk_scores state_log_probs
self gather_nd topk_scores|tmp_gather_indices topk_scores state_log_probs
self cast word_indices|mstype float32 word_indices_fp32 state_seq_new
self start|1 idx idx
idx|1 idx idx
self real_div state_log_probs|penalty_len log_probs cov_penalty_factor log_probs
self select penalty_less|self zeros_3d|penalty_cov penalty cov_penalty_factor log_probs
self reducesum penalty|2 penalty cov_penalty_factor log_probs
log_probs|penalty|self cov_penalty_factor log_probs cov_penalty_factor log_probs
super CreateAttentionPaddingsFromInputPaddings|self __init__
is_training self is_training
P Cast self cast
P Shape self shape
P Reshape self reshape
P BatchMatMul self batch_matmul
P Mul self multiply
np ones shape ones
Tensor np tril ones self lower_triangle_mask
self shape input_mask input_shape
(input_shape|1|input_shape) shape_right
input_shape|(1|) shape_left
self cast input_mask|mstype float16 input_mask
self reshape input_mask|shape_left mask_left
self reshape input_mask|shape_right mask_right
self batch_matmul mask_left|mask_right attention_mask
self cast attention_mask|mstype float32 attention_mask
self multiply attention_mask|self lower_triangle_mask attention_mask
P Shape self shape shape_right
P Shape self shape shape_left
self shape input_mask input_shape shape_right
self shape input_mask input_shape shape_left
super DynamicRNNCell|self __init__
P DynamicRNN self rnn
num_setp self num_step
batch_size self batch_size
word_embed_dim self input_size
hidden_size self hidden_size
Parameter Tensor dynamicRNN_w|mstype float32 self dynamicRNN_w
np random uniform -initializer_range|initializer_range|size dynamicRNN_b
Parameter Tensor dynamicRNN_b|mstype float32 self dynamicRNN_b
Tensor np zeros (1|self batch_size|self hidden_size) self dynamicRNN_h
Tensor np zeros (1|self batch_size|self hidden_size) self dynamicRNN_c
P Cast self cast
self cast self dynamicRNN_w|mstype float16 w
self cast self dynamicRNN_b|mstype float16 b
self cast self dynamicRNN_h|mstype float16 init_h
self cast self dynamicRNN_c|mstype float16 init_c
self rnn x|w|b|None|init_h|init_c out
super DynamicRNNNet|self __init__
seq_length self max_length
P Shape self get_shape
batchsize batch_size
self cast inputs|mstype float16 inputs
self cast init_state|mstype float16 init_h
self cast init_state|mstype float16 init_c
self net inputs|init_h|init_c state_c
self net inputs state_c
self cast out|mstype float32 out
self concat (state_h) state
self cast state|mstype float32 state
super ClipGradients|self __init__
nn ClipByNorm self clip_by_norm
P Cast self cast
P DType self dtype
grads grad
self dtype grad dt
self clip_by_norm grad|self cast(F tuple_to_array (clip_value|)) t
new_grads|(t|) new_grads
self clip_by_norm grad|self cast(F tuple_to_array (clip_value|)) t new_grads
new_grads|(t|) new_grads new_grads
super SaturateCast|self __init__
P Cast self cast
dst_type self dst_type
self cast x|self dst_type
super LayerNorm|self __init__
return_2d self return_2d
nn LayerNorm (in_channels|) self layer_norm
P DType self get_dtype
P Reshape self reshape
P Shape self get_shape
self get_shape input_tensor shape
shape batch_size
shape max_len
shape embed_dim
self reshape input_tensor|(-1|embed_dim) output
self cast output|mstype float32 output
self layer_norm output output
self cast output|self get_dtype input_tensor output
self reshape output|(batch_size|max_len|embed_dim) output
self get_shape input_tensor shape batch_size
self get_shape input_tensor shape max_len
self get_shape input_tensor shape embed_dim
parser parse_args args_opt
int os getenv device_id
D init
args_opt device_num device_num
device_id%device_num rank
print  format device_id|rank
context reset_auto_parallel_context
mstype float16 compute_dtype
GPT config gpt
CrossEntropyLoss config loss
GPTWithLoss gpt|loss gpt_with_loss
create_dataset config batch_size|data_path ds
args_opt epoch_size epoch_num
ds get_dataset_size step_per_epoch
args_opt end_lr end_learning_rate
args_opt warmup_step warmup_steps
gpt trainable_params params
list filter decay_filter|params decay_params
nn Lamb group_params|learning_rate optimizer
nn AdamWeightDecay group_params|learning_rate optimizer
args_opt sink_size callback_size
int epoch_num|step_per_epoch|callback_size actual_epoch_num
[TimeMonitor callback_size] callback
callback append ckpoint_cb
Model gpt_with_grads model
callback|sink_size callbacks
parser parse_args args_opt device_num device_num
parser parse_args args_opt epoch_size epoch_num
parser parse_args args_opt end_lr end_learning_rate
parser parse_args args_opt warmup_step warmup_steps
parser parse_args args_opt sink_size callback_size
GPT config gpt trainable_params params
create_dataset config batch_size|data_path ds get_dataset_size step_per_epoch
[TimeMonitor callback_size] callback append ckpoint_cb
[TimeMonitor callback_size] callback callbacks
context set_context context GRAPH_MODE mode
np sum probs|length prob
probs p
np power prob|1 0|length ppl
dataset data
data asnumpy data
data input_ids
model Tensor input_ids|mstype int32 asnumpy logits
PPL append logits|len data
len data tokens
sum PPL|tokens val_loss
math exp min 20|val_loss ppl
np sum input_mask|1 length
np zeros length shape label
enumerate i|idx
data i][idx-1 label i
logits reshape len length logits
np zeros length shape predicted_label
logits i][idx-2 predicted_label i
len label total_num
acc_num|total_num acc
parser parse_args args
args task_type task
args metrics metrics
args ckpt_path ckpt_path
ValueError  format task
ValueError  format metrics
mstype float16 compute_dtype
load_checkpoint ckpt_path ckpt_dict
GPT config gpt
CrossEntropyLoss config loss
GPTWithLoss gpt|loss gpt_eval
gpt_eval set_train False
load_param_into_net gpt_eval|ckpt_dict
[6170|318|257] start_sentence
np array start_sentence reshape 1|-1 input_ids
generate gpt_eval|input_ids|config seq_length outputs
outputs tolist output_list
print output_list
args data_path data_path
get_acc gpt_eval|eval_dataset acc
print acc
get_ppl gpt_eval|eval_dataset ppl
print ppl
dataset data asnumpy data
dataset data input_ids
dataset data i][idx-1 label i
model Tensor input_ids|mstype int32 asnumpy logits reshape len length logits
model Tensor input_ids|mstype int32 asnumpy logits i][idx-2 predicted_label i
PPL append logits|len data i][idx-1 label i
len label total_num acc
parser parse_args args task_type task
parser parse_args args metrics metrics
parser parse_args args ckpt_path ckpt_path
parser parse_args args data_path data_path
GPTWithLoss gpt|loss gpt_eval set_train False
generate gpt_eval|input_ids|config seq_length outputs tolist output_list
print ppl
GPT2Tokenizer from_pretrained tokenizer
range i
range _
batch append next it
string replace string
re sub rstring string
string replace chr string
iterator file_path
f read split para
tokenizer tokenize para tokenized_text
tokenizer convert_tokens_to_ids tokenized_text content
chunks chunk
np array chunk|dtype sample
clean_wikitext split para
f readlines line
json loads line replace para
tokenizer convert_tokens_to_ids tokenized_text|[EOT] content
current_process p
tokenize_openwebtext iterator item_iter
data_batch append next item_iter
argparse ArgumentParser parser
parser parse_args args
os path split os path abspath args output_file out_file
os path exists out_dir
os mkdir out_dir
{} schema
writer add_schema schema|args dataset_type
writer open_and_set_header
tokenize_wiki x
writer write_raw_data [x]
print  format transforms_count
tokenize_lambada x
glob iglob args input_glob file_iter
pool map task_unit|package_file file_iter|args file_batch_size
writer commit
args output_file out_file
print  format out_file
GPT2Tokenizer from_pretrained tokenizer tokenize para tokenized_text
GPT2Tokenizer from_pretrained tokenizer convert_tokens_to_ids tokenized_text content
GPT2Tokenizer from_pretrained tokenizer convert_tokens_to_ids tokenized_text|[EOT] content
re sub rstring string replace chr string
argparse ArgumentParser parser parse_args args
parser parse_args args output_file out_file
os path join os getcwd|data_path home_path
[os path join home_path|namefornameinos listdir data_pathifname endswith] data
print data
C TypeCast mstype int32 type_cast_op
dataset batch batch_size|drop_remainder dataset
dataset repeat dataset
C MultitypeFuncGraph clip_grad
clip_grad register
F dtype grad dt
nn ClipByNorm grad|F cast(F tuple_to_array (clip_value|)) new_grad
C MultitypeFuncGraph grad_scale
P Reciprocal reciprocal
grad_scale register
reciprocal scale
network self network
optimizer parameters self weights
optimizer self optimizer
enable_global_norm self enable_global_norm
P AllReduce self allreduce
context get_auto_parallel_context self parallel_mode
F identity self grad_reducer
get_group_size self degree
DistributedGradReducer optimizer parameters|False|self degree self grad_reducer
(self parallel_mode) self is_distributed
P Cast self cast
P NPUAllocFloatStatus self alloc_status
P NPUGetFloatStatus self get_status
P NPUClearFloatStatus self clear_before_grad
Tensor 1|mstype float32 self base
P LessEqual self less_equal
C HyperMap self hyper_map
scale_update_cell self loss_scaling_manager
Parameter Tensor scale_update_cell get_loss_scale|dtype self loss_scale
self weights weights
self loss_scale scaling_sens
sens scaling_sens
self alloc_status init
self clear_before_grad init
self grad_reducer grads grads
self hyper_map F partial grad_scale|scaling_sens|self degree grads
ClipByGlobalNorm grads grads
self hyper_map F partial clip_grad|GRADIENT_CLIP_TYPE|GRADIENT_CLIP_VALUE grads
self get_status init
self reduce_sum init|(0|) flag_sum
self allreduce flag_sum flag_reduce
self less_equal self base|flag_reduce cond
self less_equal self base|flag_sum cond
cond overflow
self loss_scaling_manager self loss_scale|cond overflow
self optimizer grads succ
(loss|cond|scaling_sens) ret
F depend ret|succ
C MultitypeFuncGraph clip_grad register
C MultitypeFuncGraph grad_scale register
P Reciprocal reciprocal scale
self loss_scale scaling_sens ret
sens scaling_sens ret
self less_equal self base|flag_reduce cond overflow
self less_equal self base|flag_reduce cond ret
self less_equal self base|flag_sum cond overflow
self less_equal self base|flag_sum cond ret
mstype float16 compute_dtype
batch_size self batch_size
seq_length self seq_length
vocab_size self vocab_size
embedding_size self embedding_size
num_layers self num_layers
num_heads self num_heads
expand_ratio self expand_ratio
post_layernorm_residual self post_layernorm_residual
dropout_rate self dropout_rate
compute_dtype self compute_dtype
use_past self use_past
C MultitypeFuncGraph get_square_sum
get_square_sum register
P ReduceSum False F square grad norm
F expand_dims F cast norm|mstype float32 norm
C MultitypeFuncGraph apply_global_norm
apply_global_norm register
grad|clip_norm|global_norm grad
super GlobalNorm|self __init__
nn Norm self norm
C HyperMap self hyper_map
self hyper_map get_square_sum|grads square_sum
F sqrt F addn square_sum|F scalar_to_array len square_sum global_norms
super ClipByGlobalNorm|self __init__
GlobalNorm self global_norm
Tensor [clip_norm]|mstype float32 self clip_norm
self global_norm grads global_norm
P GreaterEqual global_norm|self clip_norm cond
F select cond|global_norm|self clip_norm global_norm
self hyper_map F partial apply_global_norm|self clip_norm|global_norm grads
super LearningRate|self __init__
WarmUpLR learning_rate|warmup_steps self warmup_lr
PolynomialDecayLR learning_rate|end_learning_rate|decay_steps|power self decay_lr
CosineDecayLR end_learning_rate|learning_rate|decay_steps self cosine_decay_lr
Tensor np array [warmup_steps] astype np float32 self warmup_steps
P Greater self greater
Tensor np array astype np float32 self one
P Cast self cast
use_cosine self use_cosine
self decay_lr global_step decay_lr
self cosine_decay_lr global_step decay_lr
self cast self greater self warmup_steps|global_step is_warmup
self warmup_lr global_step warmup_lr
(self one-is_warmup)|decay_lr|is_warmup|warmup_lr lr
decay_lr lr
mstype float16 compute_dtype self compute_dtype
C MultitypeFuncGraph get_square_sum register
P ReduceSum False F square grad norm grad
F expand_dims F cast norm|mstype float32 norm grad
C MultitypeFuncGraph apply_global_norm register
grad|clip_norm|global_norm grad grad
PolynomialDecayLR learning_rate|end_learning_rate|decay_steps|power self decay_lr lr
self decay_lr global_step decay_lr lr
self cosine_decay_lr global_step decay_lr lr
origin_inputs shape valid_length
seq_length-origin_inputs shape pad_length
np pad origin_inputs|((0|0)) input_ids
print input_ids
Tensor input_ids|mstype int32 inputs
model inputs asnumpy logits
logits reshape bs|seq_length|-1 logits
logits probs
probs argsort p_args
probs p_args p
p|sum(p) p
np random choice len p target_index
input_ids outputs
p_args target_index input_ids valid_length
np pad origin_inputs|((0|0)) input_ids outputs
print input_ids outputs
model inputs asnumpy logits reshape bs|seq_length|-1 logits
model inputs asnumpy logits probs
logits probs argsort p_args
logits probs p_args p
probs argsort p_args target_index input_ids valid_length
probs p_args p p
p|sum(p) p p
super LayerNorm|self __init__
Parameter initializer normalized_shape self gamma
Parameter initializer normalized_shape self beta
eps self eps
self mean x|-1 mean
self mean F square x-mean variance
(x-mean)|F sqrt(variance|self eps) output
output|self gamma|self beta rescaled_output
super Softmax|self __init__
axis self axis
self max x max_value
F tensor_pow np e|x-max_value exp_x
self sum exp_x|self axis sum_x
exp_x|sum_x output
super Mapping|self __init__
output_size self output_size
input_size self input_size
Parameter initializer [output_size|] self bias
dtype self dtype
P Cast self cast
P Shape x|(self output_size|) out_shape
P Reshape x|(-1|self input_size) x
nn MatMul x|self cast(self weight|self dtype)|self cast(self bias|self dtype) x
P Reshape x|out_shape output
config GPTConfig
super Output|self __init__
config embedding_size input_size
config embedding_size|config expand_ratio output_size
Mapping input_size|output_size|config compute_dtype self mapping
Mapping output_size|input_size|config compute_dtype|scale self projection
nn GELU self activation
nn Dropout 1-config dropout_rate self dropout
self activation self mapping x hidden
self projection hidden output
self dropout output output
super AttentionMask|self __init__
P Reshape self reshape
P BatchMatMul self mul
np ones shape ones
Tensor np tril ones self lower_triangle_mask
P Mul self multiply
P Shape input_mask input_shape
(input_shape|1|input_shape) shape_right
input_shape|(1|) shape_left
self reshape input_mask|shape_left mask_left
self reshape input_mask|shape_right mask_right
self mul mask_left|mask_right attention_mask
P ExpandDims self lower_triangle_mask|0 lower_traiangle
self multiply attention_mask|lower_traiangle attention_mask
super EmbeddingLookup|self __init__
config vocab_size self vocab_size
config embedding_size self embedding_size
Parameter initializer TruncatedNormal|[self vocab_size|self embedding_size] self embedding_table
P GatherV2 self gather
(-1|config seq_length|config embedding_size) self shape
self gather self embedding_table|input_ids|0 output
super Attention|self __init__
AttentionMask config self get_attention_mask
Mapping config embedding_size|config embedding_size|config compute_dtype|scale self projection
P Transpose self transpose
config num_heads self n_head
config embedding_size||self n_head self size_per_head
Tensor [-10000 0|]|dtype self multiply_data
P BatchMatMul self batch_matmul
scale self scale
Tensor math sqrt self size_per_head self scale_factor
math sqrt layer_idx|math sqrt(self size_per_head) self coeff
Tensor self coeff self coeff
config use_past self use_past
nn Dropout 1-config dropout_rate self prob_dropout
nn Dense config embedding_size|config embedding_size to_float(config compute_dtype) self dense1
nn Dense config embedding_size|config embedding_size to_float(config compute_dtype) self dense2
nn Dense config embedding_size|config embedding_size to_float(config compute_dtype) self dense3
F shape x original_shape
F reshape x|(-1|original_shape) x
self dense1 x query
self dense2 x key
self dense3 x value
self transpose F reshape query|(-1|original_shape|self n_head|self size_per_head) query
self transpose F reshape key|(-1|original_shape|self n_head|self size_per_head) key
self transpose F reshape value|(-1|original_shape|self n_head|self size_per_head) value
layer_past past_value
self transpose layer_past|(0|1|3|2) past_key
self concat_k (past_key|key) key
self concat_v past_value|value value
P Pack [self transpose key|(0|1|3|2)] layer_present
self _attn query|key|value|attention_mask attention
self merge_heads attention attention_merge
self projection attention_merge output
P Shape x x_size
x_size|(self n_head|self size_per_head) new_x_shape
self reshape x|new_x_shape x
self transpose x|transpose x_transpose
self transpose x|(0|2|1|3) x
P Shape x x_shape
x_shape|(x_shape|x_shape|) new_shape
self reshape x|new_shape x_merge
query|F cast(self coeff|F dtype query) query
key|F cast(self coeff|F dtype key) key
self batch_matmul query|key score
score|P Cast(self scale_factor|P DType score) score
P DType score ori_dtype
P Cast score|mstype float32 score
P Mul multiplu_out|self multiply_data adder
adder|score attention_scores
P Cast attention_scores|ori_dtype attention_scores
Softmax attention_scores attention_probs
self prob_dropout attention_probs attention_probs
self batch_matmul attention_probs|value weighted_values
layer input_idsforthefirstlayer
super Block|self __init__
LayerNorm (config embedding_size|) to_float(config compute_dtype) self layernorm1
Attention config|scale|layer_idx self attention
LayerNorm (config embedding_size|) to_float(config compute_dtype) self layernorm2
Output config|scale self output
config post_layernorm_residual self post_layernorm_residual
self layernorm1 x input_x
self attention input_x|attention_mask|layer_past layer_present
input_x|attention x
x|attention x
self layernorm2 x output_x
self output output_x mlp_logit
output_x|mlp_logit output
x|mlp_logit output
super GPT_Model|self __init__
EmbeddingLookup config self word_embedding
nn CellList self blocks
range i
self blocks append Block config|i|1
LayerNorm (config embedding_size|) to_float(config compute_dtype) self layernorm
tuple [None]|config num_layers self past
config num_layers self num_layers
self past layer_past
self word_embedding input_ids embedding_table
F shape input_ids seq_length
F tuple_to_array F make_range seq_length input_position
P Tile input_position|(batch_size|1) input_position
self position_embedding input_position position_embedding
input_embedding|position_embedding hidden_states
P Cast hidden_states|mstype float16 hidden_states
self get_attention_mask input_mask attention_mask
P ExpandDims attention_mask|1 attention_mask
self blocks i hidden_states|attention_mask|layer_past present
present_layer|(present|) present_layer
self layernorm hidden_states output_state
thevocab GPTtogetthelogitsofeachtoken
super GPT_Head|self __init__
P LogSoftmax axis self log_softmax
config compute_dtype self dtype
P Reshape state|(-1|self embedding_size) state
self matmul state|self cast(embedding_table|self dtype) logits
super GPT|self __init__
GPT_Model config self backbone
GPT_Head config self head
self backbone input_ids|input_mask|past embedding_table
self head output_states|embedding_table logits
super CrossEntropyLoss|self __init__
nn LogSoftmax axis self log_softmax
P ReduceMean self mean
P ReduceSum self sum
P OneHot self onehot
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
self log_softmax P Cast logits|mstype float32 logits
P Reshape label|(-1|) label
self onehot label|self vocab_size|self on_value|self off_value one_hot_label
P Neg self sum logits|one_hot_label|(-1|) loss_sum
P Reshape input_mask|(-1|) input_mask
self sum loss_sum|input_mask numerator
self sum input_mask|P Cast(F tuple_to_array (1e-5|)) denominator
numerator|denominator loss
network self network
loss self loss
eos_token self eos_token
input_ids tokens
F cast F not_equal tokens|self eos_token input_mask
self network tokens|input_mask|past logits
input_ids labels
self loss logits|labels|input_mask output
backbone self backbone
P Argmax self argmax
generate self generate
F cast F not_equal input_ids|0 input_mask
self backbone input_ids|input_mask logits
nn LogSoftmax logits outputs
F tensor_pow np e|outputs outputs
self argmax logits outputs
(x-mean)|F sqrt(variance|self eps) output gamma|self beta rescaled_output
F tensor_pow np e|x-max_value exp_x output
self sum exp_x|self axis sum_x output
P Reshape x|(-1|self input_size) x new_shape
P Reshape x|(-1|self input_size) x x
P Reshape x|(-1|self input_size) x x
P Reshape x|(-1|self input_size) x output
P Reshape x|(-1|self input_size) x output
nn MatMul x|self cast(self weight|self dtype)|self cast(self bias|self dtype) x new_shape
nn MatMul x|self cast(self weight|self dtype)|self cast(self bias|self dtype) x x
nn MatMul x|self cast(self weight|self dtype)|self cast(self bias|self dtype) x x
nn MatMul x|self cast(self weight|self dtype)|self cast(self bias|self dtype) x output
nn MatMul x|self cast(self weight|self dtype)|self cast(self bias|self dtype) x output
P Shape input_mask input_shape shape_right
P Shape input_mask input_shape shape_left
(-1|config seq_length|config embedding_size) self shape new_shape
F reshape x|(-1|original_shape) x new_shape
F reshape x|(-1|original_shape) x x
F reshape x|(-1|original_shape) x x
F reshape x|(-1|original_shape) x output
F reshape x|(-1|original_shape) x output
self dense1 x query cast(self coeff|F dtype query) query
self dense2 x key cast(self coeff|F dtype key) key
self transpose F reshape query|(-1|original_shape|self n_head|self size_per_head) query cast(self coeff|F dtype query) query
self transpose F reshape key|(-1|original_shape|self n_head|self size_per_head) key cast(self coeff|F dtype key) key
self concat_k (past_key|key) key cast(self coeff|F dtype key) key
self _attn query|key|value|attention_mask attention x
self _attn query|key|value|attention_mask attention x
P Shape x x_size n_head|self size_per_head) new_x_shape
self reshape x|new_x_shape x new_shape
self reshape x|new_x_shape x x
self reshape x|new_x_shape x x
self reshape x|new_x_shape x output
self reshape x|new_x_shape x output
self transpose x|(0|2|1|3) x new_shape
self transpose x|(0|2|1|3) x x
self transpose x|(0|2|1|3) x x
self transpose x|(0|2|1|3) x output
self transpose x|(0|2|1|3) x output
P Shape x x_shape new_shape
query|F cast(self coeff|F dtype query) query cast(self coeff|F dtype query) query
key|F cast(self coeff|F dtype key) key cast(self coeff|F dtype key) key
self batch_matmul query|key score Cast(self scale_factor|P DType score) score
self batch_matmul query|key score attention_scores
score|P Cast(self scale_factor|P DType score) score Cast(self scale_factor|P DType score) score
score|P Cast(self scale_factor|P DType score) score attention_scores
P Cast score|mstype float32 score attention_scores
P Mul multiplu_out|self multiply_data adder attention_scores
Attention config|scale|layer_idx self attention x
Attention config|scale|layer_idx self attention x
self layernorm1 x input_x x
input_x|attention x x
input_x|attention x x
input_x|attention x output
input_x|attention x output
x|attention x x
x|attention x output
x|attention x output
self layernorm2 x output_x output
self output output_x mlp_logit output
self output output_x mlp_logit output
self blocks append Block config num_layers self num_layers
self blocks append Block config compute_dtype self dtype
self position_embedding input_position position_embedding hidden_states
self blocks i hidden_states|attention_mask|layer_past present present_layer
present_layer|(present|) present_layer present_layer
GPT_Model config self backbone self backbone
self sum loss_sum|input_mask numerator loss
self sum input_mask|P Cast(F tuple_to_array (1e-5|)) denominator loss
numerator|denominator loss self loss
TransformerConfig transformer_net_cfg_large
mstype float32 dtype
mstype float16 compute_type
kwargs transformer_net_cfg_large batch_size
kwargs transformer_net_cfg_large seq_length
kwargs transformer_net_cfg_large vocab_size
kwargs get False is_training
TransformerModel transformer_net_cfg_large|is_training|args
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
load_weights cfg model_file parameter_dict
load_param_into_net tfm_model|parameter_dict
Tensor np ones (args batch_size|transformer_net_cfg seq_length) astype(np int32) source_ids
Tensor np ones (args batch_size|transformer_net_cfg seq_length) astype(np int32) source_mask
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
load_param_into_net tfm_model|parameter_dict
time time t
int round t|1000
super LossCallBack|self __init__
isinstance per_print_times|int
per_print_times self _per_print_times
rank_id self rank_id
get_ms_timestamp time_stamp_first
get_ms_timestamp time_stamp_current
run_context original_args cb_params
str cb_params net_outputs asnumpy
f write
argparse_init parser
parser parse_known_args _
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
args device_num device_num
D init
D get_group_size device_num
get_rank rank
rank args device_id
context reset_auto_parallel_context
args device_id%device_num rank_id
os path join args save_checkpoint_path save_ckpt_path
rank_id|do_shuffle rank_id
args data_path dataset_path
args bucket_boundaries bucket_boundaries
TransformerNetworkWithLoss transformer_net_cfg|True netwithloss
TransformerNetworkWithLoss transformer_net_cfg_gpu|True netwithloss
load_checkpoint args checkpoint_path parameter_dict
load_param_into_net netwithloss|parameter_dict
dataset get_dataset_sizeargs epoch_size training_steps
cfg lr_schedule warmup_steps warmup_steps
cfg lr_schedule start_decay_step start_decay_step
Adam netwithloss trainable_params|lr|beta2 optimizer
Adam netwithloss trainable_params|lr optimizer
[TimeMonitor dataset get_dataset_size] callbacks
callbacks append ckpoint_cb
cfg scale_factor scale_factor
scale_manager get_update_cell update_cell
TransformerTrainOneStepCell netwithloss|optimizer netwithgrads
netwithgrads set_train True
Model netwithgrads model
isinstance per_print_times self _per_print_times
argparse_init parser parse_known_args _
get_rank rank args device_id
args device_id%device_num rank_id rank_id
rank_id|do_shuffle rank_id rank_id
TransformerNetworkWithLoss transformer_net_cfg|True netwithloss netwithgrads
TransformerNetworkWithLoss transformer_net_cfg_gpu|True netwithloss netwithgrads
Adam netwithloss trainable_params|lr|beta2 optimizer netwithgrads
Adam netwithloss trainable_params|lr optimizer netwithgrads
[TimeMonitor dataset get_dataset_size] callbacks append ckpoint_cb
TransformerTrainOneStepCell netwithloss|optimizer netwithgrads set_train True
deC TypeCast mstype int32 type_cast_op
network self network
self network source_ids|source_mask predicted_ids
model_path endswith
np load model_path ms_ckpt
load_checkpoint model_path ms_ckpt
ms_ckpt msname
msname infer_name
ms_ckpt msname weights infer_name
 weights
weights name
Parameter Tensor weights name parameter_dict name
parser parse_args args
load_test_data batch_size dataset
load_weights cfg model_file parameter_dict
load_param_into_net tfm_model|parameter_dict
TransformerInferCell tfm_model tfm_infer
Model tfm_infer model
source_sents append batch
target_sents append batch
Tensor batch|mstype int32 source_ids
Tensor batch|mstype int32 source_mask
model predict source_ids|source_mask predicted_ids
predictions append predicted_ids asnumpy
open cfg output_file f
predictions batch_out
range i
f write
f close
np load model_path ms_ckpt msname
np load model_path ms_ckpt msname weights infer_name
load_checkpoint model_path ms_ckpt msname
load_checkpoint model_path ms_ckpt msname weights infer_name
ms_ckpt msname infer_name
 weights name
load_param_into_net model predict source_ids|source_mask predicted_ids
Model tfm_infer model predict source_ids|source_mask predicted_ids
open cfg output_file f write
open cfg output_file f close
source_sos_tokens self source_sos_tokens
source_eos_tokens self source_eos_tokens
target_sos_tokens self target_sos_tokens
target_eos_tokens self target_eos_tokens
self __str__
tokenizer convert_tokens_to_ids source_tokens source_ids
tokenizer convert_tokens_to_ids target_tokens target_ids
max len source_ids num
range index
tokenizer convert_tokens_to_ids input_tokens input_ids
|len(input_ids) input_mask
len input_ids
input_ids append
input_mask append
_find_bucket_length instance source_sos_tokens|instance target_sos_tokens seq_max_bucket_length
_convert_ids_and_mask instance source_sos_tokens|seq_max_bucket_length source_sos_mask
_convert_ids_and_mask instance source_eos_tokens|seq_max_bucket_length source_eos_mask
_convert_ids_and_mask instance target_sos_tokens|seq_max_bucket_length target_sos_mask
_convert_ids_and_mask instance target_eos_tokens|seq_max_bucket_length target_eos_mask
collections OrderedDict features
np asarray source_sos_ids features
np asarray source_sos_mask features
np asarray source_eos_ids features
np asarray source_eos_mask features
np asarray target_sos_ids features
np asarray target_sos_mask features
np asarray target_eos_ids features
np asarray target_eos_mask features
[SOS]|source_words source_sos_tokens
source_words|[EOS] source_eos_tokens
[SOS]|target_words target_sos_tokens
target_words|[EOS] target_eos_tokens
SampleInstance instance
argparse ArgumentParser parser
parser parse_args args
tokenization WhiteSpaceTokenizer vocab_file tokenizer
args input_file split input_pattern
input_files append input_pattern
logging info
input_files input_file
logging info input_file
args output_file output_file
logging info output_file
args bucket i
open input_file|
tokenization convert_to_unicode reader readline line
logging info total_read
line strip split target_line
tokenizer tokenize source_line source_tokens
tokenizer tokenize target_line target_tokens
feature_dict key
feature_dict key append features
features keys feature_name
features feature_name feature
logging info feature_name|feature
output_file output_file_name
FileWriter output_file_name|args num_splits writer
writer add_schema data_schema|
feature_dict i features_
logging info i|len features_
features_ item
writer write_raw_data [item]
writer commit
logging info total_written
logging basicConfig logging INFO level
tokenizer convert_tokens_to_ids input_tokens input_ids append
|len(input_ids) input_mask append
len input_ids append
collections OrderedDict features keys feature_name
collections OrderedDict features feature_name feature
np asarray source_sos_ids features keys feature_name
np asarray source_sos_ids features feature_name feature
np asarray source_sos_mask features keys feature_name
np asarray source_sos_mask features feature_name feature
np asarray source_eos_ids features keys feature_name
np asarray source_eos_ids features feature_name feature
np asarray source_eos_mask features keys feature_name
np asarray source_eos_mask features feature_name feature
np asarray target_sos_ids features keys feature_name
np asarray target_sos_ids features feature_name feature
np asarray target_sos_mask features keys feature_name
np asarray target_sos_mask features feature_name feature
np asarray target_eos_ids features keys feature_name
np asarray target_eos_ids features feature_name feature
np asarray target_eos_mask features keys feature_name
np asarray target_eos_mask features feature_name feature
argparse ArgumentParser parser parse_args args
parser parse_args args input_file split input_pattern
parser parse_args args output_file output_file
parser parse_args args bucket i
tokenization WhiteSpaceTokenizer vocab_file tokenizer tokenize source_line source_tokens
tokenization WhiteSpaceTokenizer vocab_file tokenizer tokenize target_line target_tokens
args output_file output_file output_file_name
logging info output_file output_file_name
tokenization convert_to_unicode reader readline line strip split target_line
feature_dict key append features keys feature_name
feature_dict key append features feature_name feature
FileWriter output_file_name|args num_splits writer add_schema data_schema|
FileWriter output_file_name|args num_splits writer write_raw_data [item]
FileWriter output_file_name|args num_splits writer commit
feature_dict i features_ item
logging info i|len features_ item
min [1 0|float current_step|float warmup_steps]
float max [current_step|warmup_steps]
float hidden_size
warmup_steps start_decay_step
range 1|training_steps current_step
schedule split name
lr cur_lr
max [cur_lr|min_lr] cur_lr
lr append cur_lr
float max warmup_steps start_decay_step
 cfg
TransformerConfig transformer_net_cfg
mstype float32 dtype
TransformerConfig transformer_net_cfg_gpu
mstype float32 dtype
batch_size self batch_size
seq_length self seq_length
vocab_size self vocab_size
hidden_size self hidden_size
num_hidden_layers self num_hidden_layers
num_attention_heads self num_attention_heads
hidden_act self hidden_act
intermediate_size self intermediate_size
hidden_dropout_prob self hidden_dropout_prob
attention_probs_dropout_prob self attention_probs_dropout_prob
max_position_embeddings self max_position_embeddings
initializer_range self initializer_range
label_smoothing self label_smoothing
beam_width self beam_width
max_decode_length self max_decode_length
length_penalty_weight self length_penalty_weight
dtype self dtype
compute_type self compute_type
super EmbeddingLookup|self __init__
embedding_size self embedding_size
use_one_hot_embeddings self use_one_hot_embeddings
Parameter normal_weight [vocab_size|embedding_size]|embedding_size self embedding_table
P ExpandDims self expand
(-1|) self shape_flat
P GatherV2 self gather
P OneHot self one_hot
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
P MatMul self array_mul
P Reshape self reshape
P Shape self shape
self shape input_ids input_shape
self reshape input_ids|self shape_flat flat_ids
self one_hot flat_ids|self vocab_size|self on_value|self off_value one_hot_ids
self array_mul one_hot_ids|self embedding_table output_for_reshape
self gather self embedding_table|flat_ids|0 output_for_reshape
input_shape|(self embedding_size|) out_shape
self reshape output_for_reshape|out_shape output
depth||2 depth
np arange length|dtype positions
(np log max_timescale|min_timescale|(depth-1)) log_timescale_increment
min_timescale|np exp np arange depth|dtype inv_timescales
np expand_dims positions|1|np expand_dims inv_timescales|0 scaled_time
super EmbeddingPostprocessor|self __init__
 [math sqrt float embedding_size]|dtype self scores_mul
P Mul self multiply
P TensorAdd self add
nn Dropout 1-dropout_prob|dtype self dropout
dropout_prob self use_dropout
P ExpandDims self expand_dims
self shape word_embeddings input_shape
input_shape input_len
self multiply word_embeddings|self scores_mul output
self position_embedding_table position_embeddings
self expand_dims position_embeddings|0 position_embeddings
self add output|position_embeddings output
self dropout output output
super CastWrapper|self __init__
P Cast self cast
dst_type self dst_type
self cast x|self dst_type
super LayerPreprocess|self __init__
nn LayerNorm (in_channels|) self layernorm
P DType self get_dtype
self cast input_tensor|mstype float32 output
self layernorm output output
self cast output|self get_dtype input_tensor output
super LayerPostprocess|self __init__
nn Dropout 1-dropout_prob self dropout
hidden_tensor output
self add output|input_tensor output
super MultiheadAttention|self __init__
size_per_head self size_per_head
has_attention_mask self has_attention_mask
do_return_2d_tensor self do_return_2d_tensor
([1 0|math sqrt(float(self size_per_head))]|dtype self scores_mul
(-1|from_tensor_width) self shape_from_2d
(-1|to_tensor_width) self shape_to_2d
num_attention_heads|size_per_head units
query_act activation
key_act activation
value_act activation
out_act activation
P Transpose self transpose
(0|2|1|3) self trans_shape
(2|0|1|3) self trans_shape_relative
(1|2|0|3) self trans_shape_position
Tensor [-10000 0|]|dtype self multiply_data
batch_size|num_attention_heads self batch_num
P BatchMatMul self matmul
nn Softmax self softmax
nn Dropout 1-attention_probs_dropout_prob self dropout
attention_probs_dropout_prob self use_dropout
P Sub self sub
CastWrapper dst_type self cast_compute_type
P Cast self softmax_cast
seq_length from_seq_length
enc_seq_length to_seq_length
(self batch_size|from_seq_length|self num_attention_heads|self size_per_head) shape_from
(self batch_size|to_seq_length|self num_attention_heads|self size_per_head) shape_to
(self batch_size|from_seq_length|self num_attention_heads|self size_per_head) shape_
(-1|self num_attention_heads|self size_per_head) shape_
self reshape from_tensor|self shape_from_2d from_tensor_2d
self reshape to_tensor|self shape_to_2d to_tensor_2d
self query_layer from_tensor_2d query_out
self key_layer to_tensor_2d key_out
self value_layer to_tensor_2d value_out
self reshape query_out|shape_from query_layer
self transpose query_layer|self trans_shape query_layer
self reshape key_out|shape_to key_layer
self transpose key_layer|self trans_shape key_layer
self matmul_trans_b query_layer|key_layer attention_scores
self multiply attention_scores|self scores_mul attention_scores
self expand_dims attention_mask|1 attention_mask
self multiply multiply_out|self multiply_data adder
self add adder|attention_scores attention_scores
self softmax_cast attention_scores|mstype float32 attention_scores
self softmax attention_scores attention_probs
self softmax_cast attention_probs|self get_dtype key_layer attention_probs
self dropout attention_probs attention_probs
self reshape value_out|shape_to value_layer
self transpose value_layer|self trans_shape value_layer
self matmul attention_probs|value_layer context_layer
self transpose context_layer|self trans_shape context_layer
self reshape context_layer|shape_return context_layer
self out_layer context_layer context_layer
super SelfAttention|self __init__
int hidden_size|num_attention_heads self size_per_head
is_encdec_att self is_encdec_att
MultiheadAttention self attention
hidden_size from_tensor_width
hidden_size to_tensor_width
hidden_size out_tensor_width
self size_per_head size_per_head
LayerPreprocess in_channels self preprocess
LayerPostprocess dropout_prob self postprocess
(-1|hidden_size) self shape
self reshape input_tensor|self shape input_tensor
self reshape memory_tensor|self shape memory_tensor
self preprocess input_tensor output
output memory_tensor
self attention output|memory_tensor|seq_length|enc_seq_length|attention_mask attention_output
self postprocess attention_output|input_tensor output
super FeedForward|self __init__
hidden_act activation
(-1|in_channels) self shape
nn Dropout 1-hidden_dropout_prob self dropout
hidden_dropout_prob self use_dropout
self conv1 output output
self conv2 output output
self postprocess output|input_tensor output
super EncoderCell|self __init__
SelfAttention self attention
FeedForward self feedforward
hidden_size in_channels
intermediate_size hidden_size
hidden_size out_channels
self attention hidden_states|hidden_states|attention_mask|seq_length|seq_length attention_output
self feedforward attention_output output
super TransformerEncoder|self __init__
range _
layers append layer
nn CellList layers self layers
LayerPreprocess in_channels self layer_preprocess
(self batch_size|seq_length|self hidden_size) out_shape
self reshape input_tensor|self shape prev_output
self layers layer_module
layer_module prev_output|attention_mask|seq_length layer_output
layer_output prev_output
self layer_preprocess prev_output prev_output
self reshape prev_output|out_shape output
super DecoderCell|self __init__
SelfAttention self self_attention
SelfAttention self cross_attention
self self_attention hidden_states|hidden_states|attention_mask|seq_length|seq_length attention_output
super TransformerDecoder|self __init__
super CreateAttentionMaskFromInputMask|self __init__
P BatchMatMul self batch_matmul
self shape input_mask input_shape
(input_shape|1|input_shape) shape_right
input_shape|(1|) shape_left
self cast input_mask|mstype float32 input_mask
self reshape input_mask|shape_left mask_left
self reshape input_mask|shape_right mask_right
self batch_matmul mask_left|mask_right attention_mask
mstype float32 compute_type
super PredLogProbs|self __init__
width self width
nn LogSoftmax axis self log_softmax
(self batch_size|seq_length|self width) shape_flat_sequence_tensor
self reshape input_tensor|shape_flat_sequence_tensor input_tensor
self cast input_tensor|self compute_type input_tensor
self cast output_weights|self compute_type output_weights
self matmul input_tensor|output_weights logits
self cast logits|self dtype logits
self log_softmax logits log_probs
embedding_lookup self tfm_embedding_lookup
embedding_processor self tfm_embedding_processor
projection self projection
TransformerDecoder self tfm_decoder
P OnesLike self ones_like
CreateAttentionMaskFromInputMask self _create_attention_mask_from_input_mask
np ones shape ones
Tensor np tril ones self future_mask
self tfm_embedding_lookup input_ids embedding_tables
self tfm_embedding_processor input_embedding input_embedding
self cast_compute_type input_embedding input_embedding
self future_mask future_mask
self ones_like input_ids input_mask
self _create_attention_mask_from_input_mask input_mask input_mask
self multiply input_mask|self expand future_mask|0 input_mask
self cast_compute_type input_mask input_mask
self tfm_decoder input_embedding|input_mask|enc_states|enc_attention_mask|-1|seq_length decoder_output
self projection decoder_output|embedding_tables|1 log_probs
super TransformerModel|self __init__
copy deepcopy config config
is_training self is_training
config batch_size self batch_size
config hidden_size self hidden_size
config num_hidden_layers self num_hidden_layers
config hidden_size self embedding_size
self num_hidden_layers-1 self last_idx
config beam_width self beam_width
config max_decode_length self max_decode_length
EmbeddingLookup self tfm_embedding_lookup
config vocab_size vocab_size
self embedding_size embedding_size
EmbeddingPostprocessor self tfm_embedding_postprocessor_for_encoder
config max_position_embeddings max_position_embeddings
EmbeddingPostprocessor self tfm_embedding_postprocessor_for_decoder
TransformerEncoder self tfm_encoder
self batch_size batch_size
self hidden_size hidden_size
config num_attention_heads num_attention_heads
self num_hidden_layers num_hidden_layers
config intermediate_size intermediate_size
config attention_probs_dropout_prob attention_probs_dropout_prob
config initializer_range initializer_range
config hidden_dropout_prob hidden_dropout_prob
config hidden_act hidden_act
PredLogProbs self projection
self hidden_size width
config compute_type compute_type
self batch_size|config beam_width batch_size
TransformerDecoderStep self tfm_decoder
config max_decode_length max_decode_length
config num_hidden_layers num_hidden_layers
self tfm_embedding_lookup embedding_lookup
self tfm_embedding_postprocessor_for_decoder embedding_processor
BeamSearchDecoder self tfm_decoder
config batch_size batch_size
config seq_length seq_length
self tfm_decoder decoder
config beam_width beam_width
config length_penalty_weight length_penalty_weight
TileBeam beam_width self tile_beam
Tensor ones|mstype float32 self encdec_mask
config dtype self dtype
self shape source_ids seq_length
self tfm_embedding_lookup source_ids embedding_tables
self tfm_embedding_postprocessor_for_encoder src_word_embeddings src_embedding_output
self _create_attention_mask_from_input_mask source_mask enc_attention_mask
self cast_compute_type enc_attention_mask
convert_np_to_tensor_encoder seq_length future_mask
self tfm_embedding_lookup target_ids _
self tfm_embedding_postprocessor_for_decoder tgt_word_embeddings tgt_embedding_output
self _create_attention_mask_from_input_mask target_mask tgt_attention_mask
self multiply tgt_attention_mask|self expand future_mask|0 tgt_attention_mask
self cast_compute_type tgt_attention_mask
self projection decoder_output|embedding_tables|seq_length log_probs
log_probs ret
self tile_beam encoder_output beam_encoder_output
self multiply enc_attention_mask|self expand(self encdec_mask|-1) enc_attention_mask
self tile_beam enc_attention_mask beam_enc_attention_mask
self cast_compute_type beam_enc_attention_mask beam_enc_attention_mask
self tfm_decoder beam_encoder_output|beam_enc_attention_mask predicted_ids
predicted_ids ret
mstype float32 dtype self dtype
P Shape self shape embedding_size|) out_shape
P Shape self shape shape_right
P Shape self shape shape_left
self shape input_ids input_shape embedding_size|) out_shape
self shape input_ids input_shape input_len
self shape input_ids input_shape shape_right
self shape input_ids input_shape shape_left
self reshape output_for_reshape|out_shape output memory_tensor
depth||2 depth depth
self shape word_embeddings input_shape input_len
self shape word_embeddings input_shape shape_right
self shape word_embeddings input_shape shape_left
self multiply word_embeddings|self scores_mul output memory_tensor
self add output|position_embeddings output memory_tensor
self dropout output output memory_tensor
self cast input_tensor|mstype float32 output memory_tensor
self layernorm output output memory_tensor
self cast output|self get_dtype input_tensor output memory_tensor
hidden_tensor output memory_tensor
self add output|input_tensor output memory_tensor
(-1|hidden_size) self shape shape_right
(-1|hidden_size) self shape shape_left
self preprocess input_tensor output memory_tensor
(-1|in_channels) self shape shape_right
(-1|in_channels) self shape shape_left
intermediate_size hidden_size out_channels
self layers layer_module prev_output|attention_mask|seq_length layer_output
layer_module prev_output|attention_mask|seq_length layer_output prev_output
self shape input_mask input_shape shape_right
self shape input_mask input_shape shape_left
self log_softmax logits log_probs ret
self projection decoder_output|embedding_tables|1 log_probs ret
copy deepcopy config config batch_size self batch_size
copy deepcopy config config hidden_size self hidden_size
copy deepcopy config config num_hidden_layers self num_hidden_layers
copy deepcopy config config hidden_size self embedding_size
copy deepcopy config config beam_width self beam_width
copy deepcopy config config max_decode_length self max_decode_length
copy deepcopy config config vocab_size vocab_size
copy deepcopy config config max_position_embeddings max_position_embeddings
copy deepcopy config config num_attention_heads num_attention_heads
copy deepcopy config config intermediate_size intermediate_size
copy deepcopy config config attention_probs_dropout_prob attention_probs_dropout_prob
copy deepcopy config config initializer_range initializer_range
copy deepcopy config config hidden_dropout_prob hidden_dropout_prob
copy deepcopy config config hidden_act hidden_act
copy deepcopy config config compute_type compute_type
copy deepcopy config config max_decode_length max_decode_length
copy deepcopy config config num_hidden_layers num_hidden_layers
copy deepcopy config config batch_size batch_size
copy deepcopy config config seq_length seq_length
copy deepcopy config config beam_width beam_width
copy deepcopy config config length_penalty_weight length_penalty_weight
copy deepcopy config config dtype self dtype
self projection decoder_output|embedding_tables|seq_length log_probs ret
self tfm_decoder beam_encoder_output|beam_enc_attention_mask predicted_ids ret
isinstance text|str
isinstance text|bytes
text decode
ValueError % type text
isinstance text|unicode
text encode
collections OrderedDict vocab_dict
open vocab_file|
convert_to_unicode vocab readline token
token strip token
index vocab_dict token
items item
output append vocab_dict item
output append vocab_dict
load_vocab_file vocab_file self vocab_dict
{index} self inv_vocab_dict
character regardaswhitespacehere
unicodedata category char uni
text char
ord char cp
self _is_whitespace_char char
output append
output append char
 join output
text strip text
text split tokens
convert_to_unicode text text
self _clean_text text text
self _whitespace_tokenize text tokens
convert_by_vocab_dict self vocab_dict|tokens
convert_by_vocab_dict self inv_vocab_dict|ids
isinstance text decode
isinstance text encode
isinstance text char
isinstance  join output
isinstance text strip text
isinstance text split tokens
isinstance text decode
isinstance text encode
isinstance text char
isinstance  join output
isinstance text strip text
isinstance text split tokens
ValueError % type text encode
ValueError % type text char
ValueError % type text strip text
ValueError % type text split tokens
isinstance text encode
isinstance text char
isinstance  join output
isinstance text strip text
isinstance text split tokens
open  join output
convert_to_unicode vocab readline token strip token
super LengthPenalty|self __init__
weight self weight
P TensorAdd self add
P Pow self pow
P RealDiv self div
P Cast self cast
Tensor 5 0|mstype float32 self five
Tensor 6 0|mstype float32 self six
self cast length_tensor|mstype float32 length_tensor
self add length_tensor|self five output
self div output|self six output
self pow output|self weight output
super TileBeam|self __init__
beam_width self beam_width
P ExpandDims self expand
P Tile self tile
P Reshape self reshape
P Shape self shape
self shape input_tensor shape
self expand input_tensor|1 input_tensor
(1|)|(self beam_width|) tile_shape
range _
tile_shape|(1|) tile_shape
self tile input_tensor|tile_shape output
(shape|self beam_width|)|shape out_shape
self reshape output|out_shape output
super Mod|self __init__
compute_type self compute_type
P FloorDiv self floor_div
P Sub self sub
P Mul self multiply
self floor_div input_x|input_y x
self multiply x|input_y x
self sub input_x|x x
seq_length self seq_length
batch_size self batch_size
vocab_size self vocab_size
length_penalty_weight self length_penalty_weight
max_decode_length self max_decode_length
decoder self decoder
(-1|) self shape_flat
Tensor np zeros [batch_size|beam_width] self zero_tensor
Tensor np full [batch_size|beam_width]|-INF self ninf_tensor
P Select self select
(batch_size|beam_width|vocab_size) self flat_shape
Tensor self vocab_size|mstype int32 self vocab_size_tensor
P RealDiv self real_div
Mod self mod
P Equal self equal
Tensor np full [batch_size|beam_width]|eos_id self eos_ids
np tile np arange beam_width reshape (1|beam_width) beam_ids
Tensor beam_ids|mstype int32 self beam_ids
np arange batch_size|beam_width reshape (batch_size|beam_width)||beam_width batch_ids
Tensor batch_ids|mstype int32 self batch_ids
P Concat axis self concat
P GatherNd self gather_nd
P GreaterEqual self greater_equal
P ZerosLike self zeroslike
Tensor np full [batch_size|beam_width|1]|sos_id self start_ids
Tensor np full [batch_size|beam_width|1]|sos_id self init_seq
np tile np array init_scores
Tensor init_scores|mstype float32 self init_scores
Tensor np zeros [batch_size|beam_width]|dtype self init_finished
Tensor np zeros [batch_size|beam_width]|dtype self init_length
LengthPenalty weight self length_penalty
Tensor 1|mstype int32 self one
self decoder cur_input_ids|enc_states|enc_attention_mask|self seq_length log_probs
self reshape log_probs|(self batch_size|self beam_width|self vocab_size) log_probs
self add log_probs|self expand state_log_probs|-1 total_log_probs
self select state_finished|self ninf_tensor|self zero_tensor mask_tensor
self add total_log_probs|self expand mask_tensor|-1 total_log_probs
self reshape total_log_probs|self flat_shape flat_scores
self topk flat_scores|self beam_width topk_indices
topk_indices temp
self zeroslike topk_indices beam_indices
range self beam_width _
self sub temp|self vocab_size_tensor temp
self cast self greater_equal temp|0 res
beam_indices|res beam_indices
topk_indices-beam_indices|self vocab_size_tensor word_indices
self select state_finished|self beam_ids|beam_indices beam_indices
self select state_finished|self eos_ids|word_indices word_indices
self select state_finished|state_log_probs|topk_scores topk_scores
self select tmp_log_probs
self equal word_indices|self eos_ids
self topk tmp_log_probs|self beam_width tmp_indices
self concat (self expand(self batch_ids|-1)) tmp_gather_indices
self gather_nd beam_indices|tmp_gather_indices beam_indices
self gather_nd word_indices|tmp_gather_indices word_indices
self gather_nd topk_scores|tmp_gather_indices topk_scores
self concat (self expand(self batch_ids|-1)) gather_indices
self add state_length|self one length_add
self select state_finished|state_length|length_add state_length
self gather_nd state_length|gather_indices state_length
self gather_nd state_seq|gather_indices seq
self concat (seq|self expand word_indices|-1) state_seq
self equal word_indices|self eos_ids state_finished
topk_scores state_log_probs
self reshape state_seq|(self batch_size|self beam_width|-1) cur_input_ids
self start_ids cur_input_ids
self init_scores state_log_probs
self init_seq state_seq
self init_finished state_finished
self init_length state_length
self one_step state_length
self length_penalty state_length penalty_len
self real_div state_log_probs|penalty_len log_probs
self topk log_probs|self beam_width top_beam_indices
self gather_nd state_seq|gather_indices predicted_ids
P Shape self shape tile_shape
P Shape self shape beam_width|)|shape out_shape
self shape input_tensor shape tile_shape
self shape input_tensor shape beam_width|)|shape out_shape
(1|)|(self beam_width|) tile_shape tile_shape
tile_shape|(1|) tile_shape tile_shape
self topk flat_scores|self beam_width topk_indices temp
self zeroslike topk_indices beam_indices beam_indices
self zeroslike topk_indices beam_indices vocab_size_tensor word_indices
self cast self greater_equal temp|0 res beam_indices
beam_indices|res beam_indices beam_indices
beam_indices|res beam_indices vocab_size_tensor word_indices
self select state_finished|state_log_probs|topk_scores topk_scores state_log_probs
self gather_nd topk_scores|tmp_gather_indices topk_scores state_log_probs
 cfg
TransformerConfig transformer_net_cfg
mstype float32 dtype
de config set_seed
deC TypeCast mstype int32 type_cast_op
ds repeat epoch_count ds
enumerate i|_
bucket_boundaries i bucket_len
batch_per_bucket bucket_len|dataset_path ds_per
ds_per ds
ds|ds_per ds
ds shuffle ds get_dataset_size ds
batch_per_bucket bucket_len|dataset_path ds_per ds
batch_per_bucket bucket_len|dataset_path ds_per ds
ds_per ds ds
ds_per ds shuffle ds get_dataset_size ds
ds|ds_per ds ds
ds|ds_per ds shuffle ds get_dataset_size ds
argparse ArgumentParser parser
parser parse_args args
tokenization WhiteSpaceTokenizer vocab_file tokenizer
tokenizer convert_ids_to_tokens token_ids tokens
sent split sent
print sent strip
argparse ArgumentParser parser parse_args args
tokenization WhiteSpaceTokenizer vocab_file tokenizer convert_ids_to_tokens token_ids tokens
super ClipGradients|self __init__
nn ClipByNorm self clip_by_norm
P Cast self cast
P DType self dtype
grads grad
self dtype grad dt
self clip_by_norm grad|self cast(F tuple_to_array (clip_value|)) t
new_grads|(t|) new_grads
config vocab_size self vocab_size
P OneHot self onehot
Tensor float 1-config label_smoothing self on_value
Tensor config label_smoothing|float(self vocab_size-1) self off_value
P ReduceSum self reduce_sum
P ReduceMean self reduce_mean
P Reshape self reshape
(-1|) self last_idx
P Flatten self flatten
P Neg self neg
config batch_size self batch_size
(self batch_size|seq_length|) flat_shape
self reshape label_ids|flat_shape label_ids
self cast self reshape label_weights|flat_shape label_weights
self onehot label_ids|self vocab_size|self on_value|self off_value one_hot_labels
self neg self reduce_sum prediction_scores|one_hot_labels|self last_idx per_example_loss
self reduce_sum label_weights|per_example_loss numerator
self reduce_sum label_weights|| denominator
self cast F tuple_to_array (1e-5|)|mstype float32
numerator|denominator loss
TransformerModel config|is_training|use_one_hot_embeddings self transformer
TransformerTrainingLoss config self loss
P Shape self shape
self transformer source_ids|source_mask|target_ids|target_mask prediction_scores
self shape source_ids seq_length
self loss prediction_scores|label_ids|label_weights|seq_length total_loss
self cast total_loss|mstype float32
network self network
ParameterTuple network trainable_params self weights
optimizer self optimizer
sens self sens
context get_auto_parallel_context self parallel_mode
ValueError self parallel_mode
context get_auto_parallel_context mean
get_group_size degree
DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
ClipGradients self clip_gradients
value self sens
source_eos_ids source_ids
source_eos_mask source_mask
target_sos_ids target_ids
target_sos_mask target_mask
target_eos_ids label_ids
target_eos_mask label_weights
self weights weights
self clip_gradients grads|GRADIENT_CLIP_TYPE|GRADIENT_CLIP_VALUE grads
self grad_reducer grads grads
self optimizer grads succ
F depend loss|succ
C MultitypeFuncGraph grad_scale
P Reciprocal reciprocal
grad_scale register
F cast reciprocal scale|F dtype grad
C MultitypeFuncGraph _grad_overflow
P FloatStatus grad_overflow
_grad_overflow register
grad_overflow grad
self network set_grad
P AllReduce self allreduce
_get_parallel_mode self parallel_mode
_get_gradients_mean mean
_get_device_num degree
(self parallel_mode) self is_distributed
P FloatStatus self float_status
P AddN self addn
P NPUAllocFloatStatus self alloc_status
P NPUGetFloatStatus self get_status
P NPUClearFloatStatus self clear_before_grad
Tensor 1|mstype float32 self base
P LessEqual self less_equal
C HyperMap self hyper_map
scale_update_cell self loss_scaling_manager
Parameter Tensor scale_update_cell get_loss_scale|dtype self loss_scale
self alloc_status init
self clear_before_grad init
self loss_scale scaling_sens
sens scaling_sens
self hyper_map F partial grad_scale|scaling_sens grads
self get_status init
self reduce_sum init|(0|) flag_sum
self hyper_map F partial _grad_overflow flag_sum
self addn flag_sum flag_sum
self reshape flag_sum flag_sum
self allreduce flag_sum flag_reduce
self less_equal self base|flag_reduce cond
self less_equal self base|flag_sum cond
cond overflow
self loss_scaling_manager self loss_scale|cond overflow
(loss|cond|scaling_sens) ret
F depend ret|succ
self clip_by_norm grad|self cast(F tuple_to_array (clip_value|)) t new_grads
new_grads|(t|) new_grads new_grads
self reduce_sum label_weights|per_example_loss numerator loss
self reduce_sum label_weights|| denominator loss
numerator|denominator loss ret
TransformerTrainingLoss config self loss ret
value self sens scaling_sens
C MultitypeFuncGraph grad_scale register
C MultitypeFuncGraph _grad_overflow register
P FloatStatus grad_overflow grad
self loss_scale scaling_sens ret
sens scaling_sens ret
self less_equal self base|flag_reduce cond overflow
self less_equal self base|flag_reduce cond ret
self less_equal self base|flag_sum cond overflow
self less_equal self base|flag_sum cond ret
float shape
float shape|shape
shape scale_shape
_average_units scale_shape avg_units
math sqrt 3 0|scale limit
np random uniform -limit|limit|shape astype(np float32) values
Tensor values
np ones shape astype np float32 ones
Tensor ones
np zeros shape astype np float32 zeros
Tensor zeros
np random normal 0 0|num_units-0 5|shape astype(np float32) norm
Tensor norm
float shape scale_shape
float shape scale_shape
parser parse_args args_opt
context GRAPH_MODE mode|args_opt device_target device_target context set_context
context set_context args_opt device_id device_id
instance create_train_dataset batch_size dataset
dataset get_dataset_size batch_num
learning_rate|warm_up|normal_run|shrink learning_rate
load_checkpoint cfg checkpoint_path param_dict
load_param_into_net net|param_dict
Model net|loss_fn model
TimeMonitor data_size time_cb
LossMonitor loss_cb
[time_cb|ckpoint_cb|loss_cb] callbacks
instance create_train_dataset batch_size dataset get_dataset_size batch_num
learning_rate|warm_up|normal_run|shrink learning_rate learning_rate
TimeMonitor data_size time_cb callbacks
LossMonitor loss_cb callbacks
parser parse_args args_opt
cfg device_target device_target
context GRAPH_MODE mode|cfg device_target device_target context set_context
context set_context cfg device_id device_id
instance create_test_dataset batch_size dataset
load_checkpoint args_opt checkpoint_path param_dict
print  format args_opt checkpoint_path
load_checkpoint cfg checkpoint_path param_dict
print  format cfg checkpoint_path
load_param_into_net net|param_dict
net set_train False
Model net|loss_fn model
model eval dataset acc
print acc
load_param_into_net net set_train False
Model net|loss_fn model eval dataset acc
 cfg
input_list self input_list
np int32 dtype
len self input_list
root_dir self path
Path self path mypath
mypath existsornotmypath is_dir
os walk root|_|filename
filename each
self files append os path join root|each
print  format len self files
float self minlen
float self maxlen
self files filename
codecs open filename f
f read ff
codecs open filename file_object
file_object write ff
self read_data filename
self Pos|self Neg self PosNeg
self text2vec maxlen maxlen
self split_dataset split split
open filePath|
f readlines sentence
sentence replace sentence
 replace
sentence split sentence
len sentence self word_num
self Pos append [sentence|self feelMap]
self Neg append [sentence|self feelMap]
dict self Vocab
self Pos SentenceLabel
|maxlen vector
enumerate index|word
self Vocab keys
len self Vocab self Vocab word
len self Vocab-1 vector index
self Vocab word vector index
vector SentenceLabel
math ceil (1-split)|len(self Pos) trunk_pos_size
math ceil (1-split)|len(self Neg) trunk_neg_size
int 1|(1-split) trunk_num
list pos_temp
list neg_temp
range index
pos_temp append self Pos
neg_temp append self Neg
pos_temp pop|neg_temp pop self test
random shuffle self train
len self Vocab
Path self path mypath existsornotmypath is_dir
os walk filename each
os walk f read ff
os walk f readlines sentence
os walk  replace
self files append os path join  replace
float self maxlen vector
codecs open filename f read ff
codecs open filename f readlines sentence
codecs open filename file_object write ff
self text2vec maxlen maxlen vector
open  replace
f readlines sentence replace sentence
f readlines sentence split sentence
|maxlen vector SentenceLabel
list pos_temp append self Pos
list pos_temp pop|neg_temp pop self test
list neg_temp append self Neg
sparse bool
Tensor np ones [64|512] input_data
Tensor np ones|dtype label
loss input_data|label
super SoftmaxCrossEntropyExpand|self __init__
P Exp self exp
P OneHot self onehot
Tensor 1 0|mindspore float32 self on_value
Tensor 0 0|mindspore float32 self off_value
P Div self div
P Log self log
P Mul self mul
P Mul self mul2
P Cast self cast
sparse self sparse
P Sub self sub
self reduce_max logit|-1 logit_max
self exp self sub logit|logit_max exp
self reduce_sum exp|-1 exp_sum
self div exp|exp_sum softmax_result
self onehot label|F shape logit label
self log softmax_result softmax_result_log
self sum_cross_entropy (self mul softmax_result_log|label) loss
self mul2 F scalar_to_array|loss loss
self reduce_mean loss|-1 loss
super TextCNN|self __init__
vec_length self vec_length
word_len self word_len
num_classes self num_classes
P ExpandDims self unsqueeze
P Slice self slice
P Concat self concat
nn Dense 96|3|self num_classes self fc
P Print self print
make_conv_layer (kernel_height|self vec_length)|nn ReLU
(self word_len-kernel_height|1 kernel_size|1) nn MaxPool2d
self unsqueeze x|1 x
self embedding x x
self layer1 x x1
self layer2 x x2
self layer3 x x3
self reducemax x1|(2|3) x1
self reducemax x2|(2|3) x2
self reducemax x3|(2|3) x3
self concat (x1|x2|x3) x
self drop x x
self fc x x
make_conv_layer (kernel_height|self vec_length)|nn ReLU
context GRAPH_MODE mode
int os getenv device_id
context set_context device_id device_id
os path exists cfg preprocess_path
shutil rmtree cfg preprocess_path
os mkdir cfg preprocess_path
convert_to_mindrecord cfg embed_size|cfg data_path|cfg preprocess_path|cfg emb_path
np loadtxt os path join cfg preprocess_path| astype(np float32) embedding_table
create_dataset cfg preprocess_path|cfg batch_size|cfg num_epochs|True ds_train
ds_train get_dataset_size step_size
get_lr cfg|step_size lr
nn Adam params opt
nn Momentum network trainable_params|lr|cfg momentum opt
LossMonitor loss_cb
ModelCheckpoint prefix ckpoint_cb
[ckpoint_cb|loss_cb] callbacks
create_dataset cfg preprocess_path|cfg batch_size|cfg num_epochs|True ds_train get_dataset_size step_size
LossMonitor loss_cb callbacks
ModelCheckpoint prefix ckpoint_cb callbacks
parser parse_args args
os path join args data_dir||label pos_file
pfhand readlines pos_samples
pfhand close
np random permutation len pos_samples perm
perm perm_train
perm perm_test
pos_samples_train append pos_samples pt
perm_test pt
pos_samples_test append pos_samples pt
open os path join args out_dir|label f
f write  join pos_samples_train
f close
f write  join pos_samples_test
np random permutation len pos_samples perm perm_train
np random permutation len pos_samples perm perm_test
perm perm_test pt
open os path join args out_dir|label f write  join pos_samples_train
open os path join args out_dir|label f close
open os path join args out_dir|label f write  join pos_samples_test
f close
parser add_argument str type
parser parse_args args
context GRAPH_MODE mode
int os getenv device_id
context set_context device_id device_id
np loadtxt os path join cfg preprocess_path| astype(np float32) embedding_table
nn Momentum network trainable_params|cfg lr|cfg momentum opt
LossMonitor loss_cb
create_dataset cfg preprocess_path|cfg batch_size|1|False ds_eval
load_checkpoint args ckpt_path param_dict
load_param_into_net network|param_dict
network set_train False
load_param_into_net network set_train False
 textrcnn_cfg
tokenized_samples sample
sample token
feature append word_to_idx token
feature append
features append feature
features feature
feature padded_feature
len padded_feature
padded_feature append pad
padded_features append padded_feature
pos_or_neg label
os path join path|seg|label f
open f rf
rf line
line strip line
data append [line|1]
data append [line|0]
text split tok
len vocab vocab_size
np zeros (vocab_size|1|embed_size) astype(np float32) weight_np
{i|1} idx_to_word
range i
word_to_idx wvmodel index2word i index
wvmodel get_vector weight_np
read_imdb data_path train_data
read_imdb data_path test_data
train_data review|_
train_tokenized append tokenizer review
test_data review|_
test_tokenized append tokenizer review
set chain |train_tokenized vocab
print vocab_size
{word} word_to_idx
np array pad_samples encode_samples train_tokenized|word_to_idx astype(np int32) train_features
np array [scorefor_|scoreintrain_data] astype(np int32) train_labels
np array pad_samples encode_samples test_tokenized|word_to_idx astype(np int32) test_features
np array [scorefor_|scoreintest_data] astype(np int32) test_labels
collect_weight glove_path|vocab|word_to_idx|embed_size weight_np
int label
data_list append data_json
 _
preprocess data_path|glove_path|embed_size
np savetxt os path join proprocess_path||weight_np
FileWriter os path join proprocess_path| writer
get_imdb_data train_labels|train_features data
writer add_schema schema_json|
writer add_index
writer write_raw_data data
writer commit
get_imdb_data test_labels|test_features data
os path join base_path path
ds MindDataset path|columns_list|num_consumer data_set
ds config set_seed
data_set shuffle buffer_size data_set
tokenized_samples sample token
features append feature padded_feature
features feature padded_feature
feature padded_feature append pad
len padded_feature append pad
open f rf line
rf line strip line
data append  _
data append  _
read_imdb data_path train_data review|_
read_imdb data_path test_data review|_
train_data  _
test_data  _
FileWriter os path join proprocess_path| writer add_schema schema_json|
FileWriter os path join proprocess_path| writer add_index
FileWriter os path join proprocess_path| writer write_raw_data data
FileWriter os path join proprocess_path| writer commit
ds MindDataset path|columns_list|num_consumer data_set shuffle buffer_size data_set
Tensor lr|mstype float32 lr_ret
cfg lr lr_ret
super textrcnn|self __init__
batch_size self batch_size
(1|self num_hiddens)0 5 k
nn Embedding vocab_size|self embed_size|embedding_table self embedding
cell self cell
P Cast self cast
Tensor np zeros shape self h1
Tensor np zeros shape self c1
Parameter self w1_fw
np random uniform -k|k|(self embed_size|self num_hiddens|4|self num_hiddens)
Parameter self w1_bw
nn Dense self num_hiddens|self num_hiddens self rnnW_fw
nn Dense self embed_size|self num_hiddens self rnnU_fw
nn Dense self num_hiddens|self num_hiddens self rnnW_bw
nn Dense self embed_size|self num_hiddens self rnnU_bw
nn Dense self num_hiddens|self embed_size|self num_hiddens self rnnWr_fw
nn Dense self num_hiddens|self embed_size|self num_hiddens self rnnWz_fw
nn Dense self num_hiddens|self embed_size|self num_hiddens self rnnWh_fw
nn Dense self num_hiddens|self embed_size|self num_hiddens self rnnWr_bw
nn Dense self num_hiddens|self embed_size|self num_hiddens self rnnWz_bw
nn Dense self num_hiddens|self embed_size|self num_hiddens self rnnWh_bw
Tensor np ones shape self ones
P Transpose self transpose
P ReduceMax self reduce_max
P ExpandDims self expand_dims
P Concat self concat
P Reshape self reshape
Tensor np zeros (1|self batch_size|self num_hiddens) astype(np float16) self left_pad_tensor
Tensor np zeros (1|self batch_size|self num_hiddens) astype(np float16) self right_pad_tensor
nn Dense self num_hiddens|1|2 self output_dense
P Concat self concat0
P Concat self concat2
P Concat self concat1
nn Dense 2|self num_hiddens|self embed_size|self num_hiddens self text_rep_dense
nn Dense self num_hiddens|2 self mydense
P Tanh self tanh
P Sigmoid self sigmoid
P Slice self slice
x output_fw
x output_bw
self embedding x x
self cast x|mstype float16 x
self transpose x|(1|0|2) x
self drop_out x x
self cast self h1|mstype float16 h1_fw
self tanh self rnnW_fw h1_fw|self rnnU_fw x h1_fw
self expand_dims h1_fw|0 output_fw
range i
self expand_dims h1_fw|0 h1_after_expand_fw
self concat (output_fw|h1_after_expand_fw) output_fw
self cast output_fw|mstype float16 output_fw
self cast self h1|mstype float16 h1_bw
self tanh self rnnW_bw h1_bw|self rnnU_bw x h1_bw
self expand_dims h1_bw|0 output_bw
self expand_dims h1_bw|0 h1_after_expand_bw
self concat (h1_after_expand_bw|output_bw) output_bw
self cast output_bw|mstype float16 output_bw
self cast self h1|mstype float16 h_fw
self concat1 (h_fw|x) h_x_fw
self sigmoid self rnnWr_fw h_x_fw r_fw
self sigmoid self rnnWz_fw h_x_fw z_fw
self tanh self rnnWh_fw self concat1 (r_fw|h_fw|x) h_tilde_fw
(self ones-z_fw)|h_fw|z_fw|h_tilde_fw h_fw
self expand_dims h_fw|0 output_fw
self expand_dims h_fw|0 h_after_expand_fw
self concat (output_fw|h_after_expand_fw) output_fw
self cast self h1|mstype float16 h_bw
self concat1 (h_bw|x) h_x_bw
self sigmoid self rnnWr_bw h_x_bw r_bw
self sigmoid self rnnWz_bw h_x_bw z_bw
self tanh self rnnWh_bw self concat1 (r_bw|h_bw|x) h_tilde_bw
(self ones-z_bw)|h_bw|z_bw|h_tilde_bw h_bw
self expand_dims h_bw|0 output_bw
self expand_dims h_bw|0 h_after_expand_bw
self concat (h_after_expand_bw|output_bw) output_bw
self h1 h1_fw_init
self c1 c1_fw_init
self lstm x|self w1_fw|self b1_fw|None|h1_fw_init|c1_fw_init _
self h1 h1_bw_init
self c1 c1_bw_init
self lstm x|self w1_bw|self b1_bw|None|h1_bw_init|c1_bw_init _
self concat0 (self left_pad_tensor|output_fw) c_left
self concat0 (output_bw|self right_pad_tensor) c_right
self concat2 (c_left|self cast(x|mstype float16)) output
self cast output|mstype float16 output
self reshape output|(F shape x|self batch_size|2|self num_hiddens|self embed_size) output_flat
self text_rep_dense output_flat output_dense
self tanh output_dense output_dense
self reshape output_dense|(F shape x) output
self reduce_max output|0 output
self cast self mydense output outputs
os getcwd _cur_dir
np random uniform -k|k|(self embed_size|self num_hiddens|4|self num_hiddens)
dataset get_dataset_size steps_per_epoch
optimizer_cfg AdamWeightDecay end_learning_rate end_learning_rate
int steps_per_epoch|epoch_num|0 1 warmup_steps
steps_per_epoch|epoch_num decay_steps
network trainable_params params
list filter optimizer_cfg AdamWeightDecay decay_filter|params decay_params
AdamWeightDecay group_params|lr_schedule|eps optimizer
optimizer_cfg Lamb end_learning_rate end_learning_rate
Lamb network trainable_params|learning_rate optimizer
load_checkpoint load_checkpoint_path param_dict
load_param_into_net network|param_dict
BertFinetuneCell network|optimizer netwithgrads
Model netwithgrads model
[TimeMonitor dataset get_dataset_size] callbacks
print  format callback TP|(callback TP|callback FP)
print  format callback TP|(callback TP|callback FN)
print  format 2|callback TP|(2|callback TP|callback FP|callback FN)
print  format callback cal
net_for_pretraining set_train False
load_param_into_net net_for_pretraining|param_dict
Model net_for_pretraining model
Accuracy callback
MCC callback
Spearman_Correlation callback
columns_list i
input_data append data i
input_data label_ids
model predict input_ids|input_mask|token_type_id|label_ids logits
callback update logits|label_ids
eval_result_print assessment_method|callback
parser parse_args args_opt
parse_args args_opt
args_opt epoch_num epoch_num
args_opt assessment_method lower assessment_method
args_opt load_pretrain_checkpoint_path load_pretrain_checkpoint_path
args_opt save_finetune_checkpoint_path save_finetune_checkpoint_path
args_opt load_finetune_checkpoint_path load_finetune_checkpoint_path
args_opt device_target target
logger warning
mstype float32 bert_net_cfg compute_type
open args_opt label_file_path
f label
label_list append label strip
convert_labels_to_index label_list tag_to_index
max tag_to_index values max_val
max_val|1 tag_to_index
max_val|2 tag_to_index
len tag_to_index number_labels
args_opt num_class number_labels
assessment_method|data_file_path assessment_method
args_opt schema_file_path schema_file_path
do_train ds|netwithloss|load_pretrain_checkpoint_path|save_finetune_checkpoint_path|epoch_num
_cur_dir load_finetune_checkpoint_dir
make_directory save_finetune_checkpoint_path load_finetune_checkpoint_dir
os getcwd _cur_dir load_finetune_checkpoint_dir
dataset get_dataset_size steps_per_epoch decay_steps
network trainable_params params optimizer
AdamWeightDecay group_params|lr_schedule|eps optimizer netwithgrads
Lamb network trainable_params|learning_rate optimizer netwithgrads
Model netwithgrads model predict input_ids|input_mask|token_type_id|label_ids logits
Model net_for_pretraining model predict input_ids|input_mask|token_type_id|label_ids logits
Accuracy callback update logits|label_ids
MCC callback update logits|label_ids
Spearman_Correlation callback update logits|label_ids
parser parse_args args_opt epoch_num epoch_num
parser parse_args args_opt assessment_method lower assessment_method
parser parse_args args_opt load_pretrain_checkpoint_path load_pretrain_checkpoint_path
parser parse_args args_opt save_finetune_checkpoint_path save_finetune_checkpoint_path
parser parse_args args_opt load_finetune_checkpoint_path load_finetune_checkpoint_path
parser parse_args args_opt device_target target
parser parse_args args_opt num_class number_labels
parser parse_args args_opt schema_file_path schema_file_path
parse_args args_opt epoch_num epoch_num
parse_args args_opt assessment_method lower assessment_method
parse_args args_opt load_pretrain_checkpoint_path load_pretrain_checkpoint_path
parse_args args_opt save_finetune_checkpoint_path save_finetune_checkpoint_path
parse_args args_opt load_finetune_checkpoint_path load_finetune_checkpoint_path
parse_args args_opt device_target target
parse_args args_opt num_class number_labels
parse_args args_opt schema_file_path schema_file_path
args_opt assessment_method lower assessment_method assessment_method
max tag_to_index values max_val tag_to_index
max tag_to_index values max_val tag_to_index
assessment_method|data_file_path assessment_method assessment_method
os path dirname os path realpath __file__ _current_dir
[29 all_reduce_fusion_config|58|87|116|145|174|203|217] context set_auto_parallel_context
[28 all_reduce_fusion_config|55|82|109|136|163|190|205] context set_auto_parallel_context
[30 all_reduce_fusion_config|90|150|210|270|330|390|421] context set_auto_parallel_context
[38 all_reduce_fusion_config|93|148|203|258|313|368|397] context set_auto_parallel_context
cfg Lamb end_learning_rate end_learning_rate
cfg Lamb warmup_steps warmup_steps
args_opt train_steps decay_steps
network trainable_params params
list filter cfg Lamb decay_filter|params decay_params
Lamb group_params|learning_rate optimizer
cfg AdamWeightDecay end_learning_rate end_learning_rate
cfg AdamWeightDecay warmup_steps warmup_steps
list filter cfg AdamWeightDecay decay_filter|params decay_params
AdamWeightDecay group_params|learning_rate optimizer
parser parse_args args_opt
context GRAPH_MODE mode|args_opt device_target device_target|args_opt device_id device_id context set_context
args_opt save_checkpoint_path ckpt_save_dir
D init
args_opt device_num device_num
args_opt device_id%device_num rank
D get_group_size device_num
D get_rank rank
context reset_auto_parallel_context
_auto_enable_graph_kernel args_opt device_target|args_opt enable_graph_kernel is_auto_enable_graph_kernel
logger warning
mstype float32 bert_net_cfg compute_type
logger info  format args_opt accumulation_steps
logger info  format cfg batch_sizeargs_opt accumulation_steps
logger info  format args_opt data_sink_steps
logger info  format args_opt save_checkpoint_steps
create_bert_dataset device_num|rank|args_opt do_shuffle|args_opt data_dir|args_opt schema_dir ds
BertNetworkWithLoss bert_net_cfg|True net_with_loss
args_opt epoch_size|ds get_dataset_size||args_opt data_sink_steps new_repeat_count
args_opt train_stepsargs_opt accumulation_steps train_steps
min new_repeat_count|train_steps||args_opt data_sink_steps new_repeat_count
args_opt epoch_size|ds get_dataset_size||args_opt accumulation_steps args_opt train_steps
logger info  format args_opt train_steps
_get_optimizer args_opt|net_with_loss optimizer
[TimeMonitor args_opt data_sink_steps] callback
callback append ckpoint_cb
load_checkpoint args_opt load_checkpoint_path param_dict
load_param_into_net net_with_loss|param_dict
cfg scale_factor scale_factor
args_opt accumulation_steps accumulation_steps
update_cell scale_update_cell
BertTrainOneStepCell net_with_loss|optimizer net_with_grads
Model net_with_grads model
network trainable_params params optimizer
network trainable_params params optimizer
Lamb group_params|learning_rate optimizer net_with_grads
AdamWeightDecay group_params|learning_rate optimizer net_with_grads
parser parse_args args_opt save_checkpoint_path ckpt_save_dir
parser parse_args args_opt device_num device_num
parser parse_args args_opt device_id%device_num rank
parser parse_args args_opt epoch_size|ds get_dataset_size||args_opt data_sink_steps new_repeat_count
parser parse_args args_opt train_stepsargs_opt accumulation_steps train_steps
parser parse_args args_opt epoch_size|ds get_dataset_size||args_opt accumulation_steps args_opt train_steps
parser parse_args args_opt accumulation_steps accumulation_steps
BertNetworkWithLoss bert_net_cfg|True net_with_loss net_with_grads
_get_optimizer args_opt|net_with_loss optimizer net_with_grads
[TimeMonitor args_opt data_sink_steps] callback append ckpoint_cb
os getcwd _cur_dir
load_param_into_net net_with_loss|param_dict
dataset get_dataset_size steps_per_epoch
optimizer_cfg AdamWeightDecay end_learning_rate end_learning_rate
int steps_per_epoch|epoch_num|0 1 warmup_steps
steps_per_epoch|epoch_num decay_steps
network trainable_params params
list filter optimizer_cfg AdamWeightDecay decay_filter|params decay_params
AdamWeightDecay group_params|lr_schedule|eps optimizer
optimizer_cfg Lamb end_learning_rate end_learning_rate
Lamb network trainable_params|learning_rate optimizer
load_checkpoint load_checkpoint_path param_dict
load_param_into_net network|param_dict
BertSquadCell network|optimizer netwithgrads
Model netwithgrads model
[TimeMonitor dataset get_dataset_size] callbacks
BertSquad bert_net_cfg|False|2 net
net set_train False
load_param_into_net net|param_dict
Model net model
collections namedtuple RawResult
columns_list i
input_data append data i
input_data unique_ids
Tensor |mstype float32 start_positions
Tensor |mstype float32 end_positions
Tensor |mstype float32 is_impossible
logits asnumpy ids
logits asnumpy start
logits asnumpy end
range i
int ids i unique_id
parser parse_args args_opt
args_opt epoch_num epoch_num
args_opt load_pretrain_checkpoint_path load_pretrain_checkpoint_path
args_opt save_finetune_checkpoint_path save_finetune_checkpoint_path
args_opt load_finetune_checkpoint_path load_finetune_checkpoint_path
args_opt device_target target
logger warning
mstype float32 bert_net_cfg compute_type
args_opt train_data_file_path data_file_path
args_opt schema_file_path schema_file_path
do_train ds|netwithloss|load_pretrain_checkpoint_path|save_finetune_checkpoint_path|epoch_num
_cur_dir load_finetune_checkpoint_dir
make_directory save_finetune_checkpoint_path load_finetune_checkpoint_dir
read_squad_examples args_opt eval_json_path|False eval_examples
convert_examples_to_features eval_features
eval_examples examples
bert_net_cfg seq_length max_seq_length
eval_features data_file_path
do_eval ds|load_finetune_checkpoint_path|args_opt eval_batch_size outputs
write_predictions eval_examples|eval_features|outputs|20|30|True all_predictions
os getcwd _cur_dir load_finetune_checkpoint_dir
dataset get_dataset_size steps_per_epoch decay_steps
network trainable_params params optimizer
AdamWeightDecay group_params|lr_schedule|eps optimizer netwithgrads
Lamb network trainable_params|learning_rate optimizer netwithgrads
BertSquad bert_net_cfg|False|2 net set_train False
parser parse_args args_opt epoch_num epoch_num
parser parse_args args_opt load_pretrain_checkpoint_path load_pretrain_checkpoint_path
parser parse_args args_opt save_finetune_checkpoint_path save_finetune_checkpoint_path
parser parse_args args_opt load_finetune_checkpoint_path load_finetune_checkpoint_path
parser parse_args args_opt device_target target
parser parse_args args_opt train_data_file_path data_file_path
parser parse_args args_opt schema_file_path schema_file_path
read_squad_examples args_opt eval_json_path|False eval_examples examples
convert_examples_to_features eval_features data_file_path
BertConfig bert_net_cfg_base
mstype float32 dtype
mstype float16 compute_type
BertConfig bert_net_cfg_nezha
kwargs bert_net_cfg_base seq_length
kwargs get False is_training
BertModel bert_net_cfg_base|is_training|args
kwargs bert_net_cfg_nezha seq_length
BertModel bert_net_cfg_nezha|is_training|args
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
open args label_file_path
f label
label_list append label strip
convert_labels_to_index label_list tag_to_index
max tag_to_index values max_val
max_val|1 tag_to_index
max_val|2 tag_to_index
len tag_to_index number_labels
args num_class number_labels
BertCLSModel bert_net_cfg|False|num_labels net
BertSquadModel bert_net_cfg|False net
net set_train False
Tensor np zeros [args batch_size|bert_net_cfg seq_length] input_ids
Tensor np zeros [args batch_size|bert_net_cfg seq_length] input_mask
Tensor np zeros [args batch_size|bert_net_cfg seq_length] token_type_id
Tensor np zeros [args batch_size|bert_net_cfg seq_length] label_ids
[input_ids|input_mask|token_type_id|label_ids] input_data
[input_ids|input_mask|token_type_id] input_data
args file_name|file_format file_name
parser parse_args args num_class number_labels
parser parse_args args file_name|file_format file_name
f label input_data
max tag_to_index values max_val tag_to_index
max tag_to_index values max_val tag_to_index
BertCLSModel bert_net_cfg|False|num_labels net set_train False
BertSquadModel bert_net_cfg|False net set_train False
Tensor np zeros [args batch_size|bert_net_cfg seq_length] input_ids input_data
Tensor np zeros [args batch_size|bert_net_cfg seq_length] input_ids input_data
Tensor np zeros [args batch_size|bert_net_cfg seq_length] input_mask input_data
Tensor np zeros [args batch_size|bert_net_cfg seq_length] input_mask input_data
Tensor np zeros [args batch_size|bert_net_cfg seq_length] token_type_id input_data
Tensor np zeros [args batch_size|bert_net_cfg seq_length] token_type_id input_data
Tensor np zeros [args batch_size|bert_net_cfg seq_length] label_ids input_data
os getcwd _cur_dir
net set_train False
dataset get_dataset_size steps_per_epoch
optimizer_cfg AdamWeightDecay end_learning_rate end_learning_rate
int steps_per_epoch|epoch_num|0 1 warmup_steps
steps_per_epoch|epoch_num decay_steps
network trainable_params params
list filter optimizer_cfg AdamWeightDecay decay_filter|params decay_params
AdamWeightDecay group_params|lr_schedule|eps optimizer
optimizer_cfg Lamb end_learning_rate end_learning_rate
Lamb network trainable_params|learning_rate optimizer
load_checkpoint load_checkpoint_path param_dict
load_param_into_net network|param_dict
BertFinetuneCell network|optimizer netwithgrads
Model netwithgrads model
[TimeMonitor dataset get_dataset_size] callbacks
print  format callback TP|(callback TP|callback FP)
print  format callback TP|(callback TP|callback FN)
print  format 2|callback TP|(2|callback TP|callback FP|callback FN)
print  format callback cal
network bert_net_cfg|False|num_class net_for_pretraining
net_for_pretraining set_train False
load_param_into_net net_for_pretraining|param_dict
Model net_for_pretraining model
Accuracy callback
F1 False|num_class callback
MCC callback
Spearman_Correlation callback
columns_list i
input_data append data i
input_data label_ids
model predict input_ids|input_mask|token_type_id|label_ids logits
callback update logits|label_ids
eval_result_print assessment_method|callback
"assessment_methodincluding[Mcc|Spearman_correlation|Accuracy|F1]| help
parser parse_args args_opt
args_opt epoch_num epoch_num
args_opt assessment_method lower assessment_method
args_opt load_pretrain_checkpoint_path load_pretrain_checkpoint_path
args_opt save_finetune_checkpoint_path save_finetune_checkpoint_path
args_opt load_finetune_checkpoint_path load_finetune_checkpoint_path
args_opt device_target target
logger warning
mstype float32 bert_net_cfg compute_type
args_opt train_data_file_path data_file_path
args_opt schema_file_path schema_file_path
do_train ds|netwithloss|load_pretrain_checkpoint_path|save_finetune_checkpoint_path|epoch_num
_cur_dir load_finetune_checkpoint_dir
make_directory save_finetune_checkpoint_path load_finetune_checkpoint_dir
args_opt eval_data_file_path data_file_path
do_eval ds|BertCLS|args_opt num_class|assessment_method|load_finetune_checkpoint_path
os getcwd _cur_dir load_finetune_checkpoint_dir
dataset get_dataset_size steps_per_epoch decay_steps
network trainable_params params optimizer
AdamWeightDecay group_params|lr_schedule|eps optimizer netwithgrads
Lamb network trainable_params|learning_rate optimizer netwithgrads
load_param_into_net network bert_net_cfg|False|num_class net_for_pretraining
Model netwithgrads model predict input_ids|input_mask|token_type_id|label_ids logits
network bert_net_cfg|False|num_class net_for_pretraining set_train False
Model net_for_pretraining model predict input_ids|input_mask|token_type_id|label_ids logits
Accuracy callback update logits|label_ids
F1 False|num_class callback update logits|label_ids
MCC callback update logits|label_ids
Spearman_Correlation callback update logits|label_ids
parser parse_args args_opt epoch_num epoch_num
parser parse_args args_opt assessment_method lower assessment_method
parser parse_args args_opt load_pretrain_checkpoint_path load_pretrain_checkpoint_path
parser parse_args args_opt save_finetune_checkpoint_path save_finetune_checkpoint_path
parser parse_args args_opt load_finetune_checkpoint_path load_finetune_checkpoint_path
parser parse_args args_opt device_target target
parser parse_args args_opt train_data_file_path data_file_path
parser parse_args args_opt schema_file_path schema_file_path
parser parse_args args_opt eval_data_file_path data_file_path
super myMetric|self __init__
self clear
self _convert_data inputs total_num
self _convert_data inputs acc_num
total_num self total_num
acc_num self acc_num
super GetLogProbs|self __init__
BertModel config|False self bert
GetMaskedLMOutput config self cls1
self bert input_ids|token_type_id|input_mask embedding_table
self cls1 sequence_output|embedding_table|masked_pos prediction_scores
super BertPretrainEva|self __init__
GetLogProbs config self bert
P Argmax axis self argmax
P Equal self equal
P ReduceMean self mean
P ReduceSum self sum
Parameter Tensor |mstype float32 self total
Parameter Tensor |mstype float32 self acc
P Reshape self reshape
P Shape self shape
P Cast self cast
self shape input_ids _
self bert input_ids|input_mask|token_type_id|masked_pos probs
self argmax probs index
self reshape index|(bs|-1) index
self equal index|masked_ids eval_acc
self cast eval_acc|mstype float32 eval_acc1
eval_acc1|masked_weights real_acc
self sum real_acc acc
self sum masked_weights total
total self total
acc self acc
C TypeCast mstype int32 type_cast_op
ds repeat repeat_count ds
int os getenv devid
get_enwiki_512_dataset cfg batch_size|1 dataset
BertPretrainEva bert_net_cfg net_for_pretraining
net_for_pretraining set_train False
load_checkpoint cfg finetune_ckpt param_dict
load_param_into_net net_for_pretraining|param_dict
Model net_for_pretraining model
bert_predict net_for_pretraining
res items _|v
print v
self _convert_data inputs total_num self total_num
self _convert_data inputs acc_num self acc_num
Parameter Tensor |mstype float32 self total self total
Parameter Tensor |mstype float32 self acc self acc
self cast eval_acc|mstype float32 eval_acc1 real_acc
self sum real_acc acc self acc
self sum masked_weights total self total
BertPretrainEva bert_net_cfg net_for_pretraining set_train False
print v
parser parse_args args
s cmd
print __file__
parse_args args
args run_script_dir run_script
args data_dir data_dir
configparser ConfigParser cf
cf read args hyper_parameter_config_dir
dict cf items cfg
print args hccl_config_dir
print args hccl_time_out
append_cmd_env cmd|args hccl_time_out cmd
append_cmd_env cmd|args hccl_config_dir cmd
multiprocessing cpu_count cores
print cores
fin readlines hccn_item
hccn_item strip startswith
hccn_item split device_ip
device_id split device_id
device_ip strip device_ips device_id
json loads fin read hccl_config
hccl_config server
len server rank_size
device_ips values
server this_server
append_cmd_env cmd|str(rank_size) cmd
print rank_size
print len this_server
int int cores|len(this_server) avg_core_per_rank
avg_core_per_rank-1 core_gap
print avg_core_per_rank
this_server instance
instance device_id
instance rank_id
print rank_id
print device_id
count|int(avg_core_per_rank) start
start|core_gap end
str start||str(end) cmdopt
append_cmd_env cmd|str(device_id) cmd
append_cmd_env cmd|str(rank_id) cmd
append_cmd_env cmd cmd
append_cmd cmd||str(device_id) cmd
append_cmd cmd cmd
os getcwd cur_dir
print cmdopt
print str cfg
print data_dir
opt run_cmd
str rank_size
append_cmd cmd|run_cmd cmd
open args cmd_file|
f write cmd
parser parse_args args run_script_dir run_script
parser parse_args args data_dir data_dir
parse_args args run_script_dir run_script
parse_args args data_dir data_dir
configparser ConfigParser cf read args hyper_parameter_config_dir
fin readlines hccn_item strip startswith
fin readlines hccn_item split device_ip
hccn_item split device_ip strip device_ips device_id
json loads fin read hccl_config server
hccl_config server this_server
server this_server instance
print len this_server instance
avg_core_per_rank-1 core_gap end
this_server instance device_id
this_server instance rank_id
count|int(avg_core_per_rank) start end
C MultitypeFuncGraph clip_grad
clip_grad register
F dtype grad dt
nn ClipByNorm grad|F cast(F tuple_to_array (clip_value|)) new_grad
super GetMaskedLMOutput|self __init__
config hidden_size self width
P Reshape self reshape
P GatherV2 self gather
TruncatedNormal config initializer_range weight_init
nn LayerNorm (config hidden_size|) to_float(config compute_type) self layernorm
Parameter self output_bias
nn LogSoftmax axis self log_softmax
(-1|1) self shape_flat_offsets
(-1|) self last_idx
(-1|self width) self shape_flat_sequence_tensor
Tensor np array (config seq_length|) astype(np int32) self seq_length_tensor
P Cast self cast
config compute_type self compute_type
config dtype self dtype
F tuple_to_array F make_range P Shape input_tensor rng
self reshape rng|self seq_length_tensor|self shape_flat_offsets flat_offsets
self reshape positions|flat_offsets|self last_idx flat_position
self reshape input_tensor|self shape_flat_sequence_tensor flat_sequence_tensor
self gather flat_sequence_tensor|flat_position|0 input_tensor
self cast input_tensor|self compute_type input_tensor
self cast output_weights|self compute_type output_weights
self dense input_tensor input_tensor
self layernorm input_tensor input_tensor
self matmul input_tensor|output_weights logits
self cast logits|self dtype logits
logits|self output_bias logits
self log_softmax logits log_probs
super GetNextSentenceOutput|self __init__
P LogSoftmax self log_softmax
self dense input_tensor logits
self log_softmax logits log_prob
super BertPreTraining|self __init__
BertModel config|is_training|use_one_hot_embeddings self bert
GetMaskedLMOutput config self cls1
GetNextSentenceOutput config self cls2
 embedding_table
self bert input_ids|token_type_id|input_mask
self cls2 pooled_output seq_relationship_score
super BertPretrainingLoss|self __init__
config vocab_size self vocab_size
P OneHot self onehot
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
P ReduceSum self reduce_sum
P ReduceMean self reduce_mean
P Neg self neg
self reshape masked_lm_ids|self last_idx label_ids
self cast self reshape masked_lm_weights|self last_idx label_weights
self onehot label_ids|self vocab_size|self on_value|self off_value one_hot_labels
self neg self reduce_sum prediction_scores|one_hot_labels|self last_idx per_example_loss
self reduce_sum label_weights|per_example_loss numerator
self reduce_sum label_weights||self cast(F tuple_to_array (1e-5|)) denominator
numerator|denominator masked_lm_loss
self reshape next_sentence_labels|self last_idx labels
self onehot labels|2|self on_value|self off_value one_hot_labels
self neg self reduce_sum per_example_loss
self reduce_mean per_example_loss|self last_idx next_sentence_loss
masked_lm_loss|next_sentence_loss total_loss
super BertNetworkWithLoss|self __init__
BertPreTraining config|is_training|use_one_hot_embeddings self bert
BertPretrainingLoss config self loss
 seq_relationship_score
self bert input_ids|input_mask|token_type_id|masked_lm_positions
self cast total_loss|mstype float32
super BertTrainOneStepCell|self __init__ network|optimizer|sens
C HyperMap self hyper_map
value self sens
self weights weights
self hyper_map F partial clip_grad|GRADIENT_CLIP_TYPE|GRADIENT_CLIP_VALUE grads
self grad_reducer grads grads
self optimizer grads succ
F depend loss|succ
C MultitypeFuncGraph grad_scale
P Reciprocal reciprocal
grad_scale register
reciprocal scale
network self network
self network set_grad
optimizer parameters self weights
optimizer self optimizer
P AllReduce self allreduce
context get_auto_parallel_context self parallel_mode
F identity self grad_reducer
get_group_size self degree
DistributedGradReducer optimizer parameters|False|self degree self grad_reducer
(self parallel_mode) self is_distributed
P NPUAllocFloatStatus self alloc_status
P NPUGetFloatStatus self get_status
P NPUClearFloatStatus self clear_before_grad
Tensor 1|mstype float32 self base
P LessEqual self less_equal
scale_update_cell self loss_scaling_manager
Parameter Tensor scale_update_cell get_loss_scale|dtype self loss_scale
self loss_scale scaling_sens
sens scaling_sens
self alloc_status init
self clear_before_grad init
self hyper_map F partial grad_scale|scaling_sens|self degree grads
self get_status init
self reduce_sum init|(0|) flag_sum
self allreduce flag_sum flag_reduce
self less_equal self base|flag_reduce cond
self less_equal self base|flag_sum cond
cond overflow
self loss_scaling_manager self loss_scale|cond overflow
(loss|cond|scaling_sens) ret
F depend ret|succ
P Cast cast
C MultitypeFuncGraph update_accu_grads
update_accu_grads register
F depend succ|F assign_add accu_grad|cast grad|mstype float32
P ZerosLike zeroslike
C MultitypeFuncGraph reset_accu_grads
reset_accu_grads register
F depend succ|F assign accu_grad|zeroslike accu_grad
accumulation_steps self accumulation_steps
enable_global_norm self enable_global_norm
Tensor np array astype np int32 self one
Tensor np array astype np int32 self zero
Parameter initializer 0||mstype int32 self local_step
Parameter initializer 0||mstype int32 self accu_overflow
Parameter initializer 0||mstype float32 self accu_loss
F identity self overflow_reducer
P AllReduce self overflow_reducer
P LogicalOr self logical_or
P NotEqual self not_equal
P Select self select
self not_equal self local_step|self accumulation_steps is_accu_step
self select is_accu_step|self local_step|self one|self one self local_step
self select is_accu_step|self accu_loss|loss|loss self accu_loss
self accu_loss|self local_step mean_loss
self hyper_map update_accu_grads|self accu_grads|grads accu_succ
F depend mean_loss|accu_succ mean_loss
self less_equal self base|flag_sum overflow
self logical_or self not_equal self accu_overflow|self zero overflow
self select overflow|self one|self zero accu_overflow
self select is_accu_step|accu_overflow|self zero self accu_overflow
self grad_reducer self accu_grads grads
scaling_sens|self degree|self accumulation_steps scaling
self hyper_map F partial grad_scale|scaling grads
C clip_by_global_norm grads|1 0|None grads
self overflow_reducer accu_overflow accu_overflow
F control_depend grads|accu_overflow
self less_equal self base|accu_overflow overflow
self hyper_map reset_accu_grads|self accu_grads accu_succ
F depend overflow|accu_succ overflow
self reshape overflow overflow
self loss_scaling_manager self loss_scale|overflow overflow
(mean_loss|overflow|scaling_sens) ret
C MultitypeFuncGraph clip_grad register
self matmul input_tensor|output_weights logits output_bias logits
self cast logits|self dtype logits output_bias logits
logits|self output_bias logits output_bias logits
self bert  seq_relationship_score
self reduce_sum label_weights|per_example_loss numerator masked_lm_loss
self reduce_sum label_weights||self cast(F tuple_to_array (1e-5|)) denominator masked_lm_loss
numerator|denominator masked_lm_loss total_loss
self reduce_mean per_example_loss|self last_idx next_sentence_loss total_loss
BertPretrainingLoss config self loss ret
BertPretrainingLoss config self loss ret
super BertTrainOneStepCell|self __init__ network self network
super BertTrainOneStepCell|self __init__ optimizer parameters self weights
super BertTrainOneStepCell|self __init__ optimizer self optimizer
super BertTrainOneStepCell|self __init__ sens scaling_sens
value self sens scaling_sens
value self sens degree|self accumulation_steps scaling
C MultitypeFuncGraph grad_scale register
P Reciprocal reciprocal scale
self loss_scale scaling_sens ret
self loss_scale scaling_sens degree|self accumulation_steps scaling
self loss_scale scaling_sens ret
sens scaling_sens ret
sens scaling_sens degree|self accumulation_steps scaling
sens scaling_sens ret
self less_equal self base|flag_reduce cond overflow
self less_equal self base|flag_reduce cond ret
self less_equal self base|flag_sum cond overflow
self less_equal self base|flag_sum cond ret
cond overflow ret
self loss_scaling_manager self loss_scale|cond overflow ret
C MultitypeFuncGraph update_accu_grads register
C MultitypeFuncGraph reset_accu_grads register
self accu_loss|self local_step mean_loss ret
F depend mean_loss|accu_succ mean_loss ret
self less_equal self base|flag_sum overflow ret
self logical_or self not_equal self accu_overflow|self zero overflow ret
scaling_sens|self degree|self accumulation_steps scaling ret
self less_equal self base|accu_overflow overflow ret
F depend overflow|accu_succ overflow ret
self reshape overflow overflow ret
self loss_scaling_manager self loss_scale|overflow overflow ret
 cfg
base thebaseversionofBERTmodel
BertConfig bert_net_cfg
mstype float32 dtype
mstype float16 compute_type
super CRF|self __init__
len tag_to_index self target_size
is_training self is_training
tag_to_index self tag_to_index
batch_size self batch_size
seq_length self seq_length
Tensor self target_size-2|dtype self START_VALUE
Tensor self target_size-1|dtype self STOP_VALUE
np random normal size transitions
-10000 transitions
Parameter Tensor transitions self transitions
P Concat axis self cat
P ArgMaxWithValue axis self argmax
P Log self log
P Exp self exp
P ReduceSum self sum
P Tile self tile
P Reshape self reshape
P ExpandDims self expand
P ReduceMean self mean
np ones shape init_alphas
Tensor init_alphas|dtype self init_alphas
P Cast self cast
Tensor 1 0|dtype self on_value
Tensor 0 0|dtype self off_value
P OneHot self onehot
self reduce_max logits|-1 max_score
self log self reduce_sum self exp logits-max_score score
max_score|score score
label|1 label
self tile self reshape self START_VALUE|(1|) concat_A
self reshape concat_A|(self batch_size|1) concat_A
self cat (concat_A|label) labels
self onehot label|self target_size|self on_value|self off_value onehot_label
features|onehot_label emits
self onehot labels|self target_size|self on_value|self off_value labels
labels label1
labels label2
self expand label1|3 label1
self expand label2|2 label2
label1|label2 label_trans
self expand self expand self transitions|0 transitions
transitions|label_trans trans
self sum emits|(1|2)|self sum trans|(1|2|3) score
labels stop_value_index
self transitions stop_value
stop_value|self reshape(stop_value_index|(self batch_size|self target_size)) stop_score
score|self sum stop_score|1 score
self reshape score|(self batch_size|-1) score
self init_alphas forward_var
self expand forward_var|1 forward_var
range idx
features feat
self reshape feat|(self batch_size|self target_size|1) emit_score
emit_score|self transitions|forward_var next_tag_var
self log_sum_exp next_tag_var forward_var
self reshape forward_var|(self batch_size|1|self target_size) forward_var
forward_var|self reshape(self transitions|(1|-1)) terminal_var
self log_sum_exp terminal_var alpha
self reshape alpha|(self batch_size|-1) alpha
self reshape feat|(self batch_size|self target_size) feat
self expand forward_var|1|self transitions next_tag_var
self argmax next_tag_var best_tag_value
(best_tag_id|) bptrs_t
best_tag_value|feat forward_var
(bptrs_t|) backpointers
self argmax terminal_var _
self _normalization_factor features forward_score
self _realpath_score features|label gold_score
self mean forward_score-gold_score return_value
self _decoder features tag
path_list|tag return_value
best_tag_id asnumpy best_tag_id
len best_tag_id batch_size
range i
best_path append
best_tag_id i best_local_id
1] append best_local_id
reversed bptrs_t
bptrs_t asnumpy bptrs_t
bptrs_t i local_idx
local_idx best_local_id best_local_id
1] pop
1] reverse
np random normal size transitions trans
-10000 transitions trans
Parameter Tensor transitions self transitions trans
np ones shape init_alphas self init_alphas
Tensor init_alphas|dtype self init_alphas self init_alphas
P OneHot self onehot emits
self reduce_max logits|-1 max_score score
self log self reduce_sum self exp logits-max_score score score
self log self reduce_sum self exp logits-max_score score sum stop_score|1 score
self log self reduce_sum self exp logits-max_score score transitions|forward_var next_tag_var
max_score|score score score
max_score|score score sum stop_score|1 score
max_score|score score transitions|forward_var next_tag_var
label|1 label label
label|1 label label_trans
label|1 label trans
self cat (concat_A|label) labels label1
self cat (concat_A|label) labels label2
self cat (concat_A|label) labels stop_value_index
self onehot label|self target_size|self on_value|self off_value onehot_label emits
self onehot labels|self target_size|self on_value|self off_value labels label1
self onehot labels|self target_size|self on_value|self off_value labels label2
self onehot labels|self target_size|self on_value|self off_value labels stop_value_index
labels label1 label_trans
labels label2 label_trans
self expand label1|3 label1 label_trans
self expand label2|2 label2 label_trans
label1|label2 label_trans trans
self expand self expand self transitions|0 transitions trans
self sum emits|(1|2)|self sum trans|(1|2|3) score sum stop_score|1 score
self sum emits|(1|2)|self sum trans|(1|2|3) score transitions|forward_var next_tag_var
self transitions stop_value reshape(stop_value_index|(self batch_size|self target_size)) stop_score
score|self sum stop_score|1 score sum stop_score|1 score
score|self sum stop_score|1 score transitions|forward_var next_tag_var
self reshape score|(self batch_size|-1) score transitions|forward_var next_tag_var
self init_alphas forward_var reshape(self transitions|(1|-1)) terminal_var
self expand forward_var|1 forward_var reshape(self transitions|(1|-1)) terminal_var
features feat forward_var
self reshape feat|(self batch_size|self target_size|1) emit_score transitions|forward_var next_tag_var
self log_sum_exp next_tag_var forward_var reshape(self transitions|(1|-1)) terminal_var
self reshape forward_var|(self batch_size|1|self target_size) forward_var reshape(self transitions|(1|-1)) terminal_var
self reshape feat|(self batch_size|self target_size) feat forward_var
self argmax next_tag_var best_tag_value forward_var
(best_tag_id|) bptrs_t backpointers
(best_tag_id|) bptrs_t asnumpy bptrs_t
(best_tag_id|) bptrs_t i local_idx
self _decoder features tag return_value
reversed bptrs_t asnumpy bptrs_t
reversed bptrs_t i local_idx
bptrs_t i local_idx best_local_id best_local_id
list text textlist
enumerate _|word
tokenizer tokenize word token
tokens extend token
ntokens append
segment_ids append
enumerate _|token
ntokens append token
convert_tokens_to_ids vocab|ntokens input_ids
|len(input_ids) input_mask
len input_ids
input_ids append
input_mask append
label_ids append
(input_ids|input_mask|segment_ids) feature
[text] data
[probs] probs
tag_to_index label2id
[kfork|vinlabel2id items] id2label
enumerate index|prob
prob v
result append id2label[int v]
zip _|t
re search t
result index-1 label
labels get label
text te_
 [start|index-1] labels label][te_
index start
result start label
enumerate  [start|index-1] labels label][te_
enumerate  [start|index-1] labels label][te_
convert_tokens_to_ids vocab|ntokens input_ids append
convert_tokens_to_ids vocab|ntokens input_ids feature
|len(input_ids) input_mask append
|len(input_ids) input_mask feature
len input_ids append
len input_ids feature
enumerate prob v
enumerate  [start|index-1] labels label][te_
enumerate index start
zip  [start|index-1] labels label][te_
mstype float32 dtype
seq_length self seq_length
vocab_size self vocab_size
hidden_size self hidden_size
num_hidden_layers self num_hidden_layers
num_attention_heads self num_attention_heads
hidden_act self hidden_act
intermediate_size self intermediate_size
hidden_dropout_prob self hidden_dropout_prob
attention_probs_dropout_prob self attention_probs_dropout_prob
max_position_embeddings self max_position_embeddings
type_vocab_size self type_vocab_size
initializer_range self initializer_range
use_relative_positions self use_relative_positions
dtype self dtype
compute_type self compute_type
super EmbeddingLookup|self __init__
use_one_hot_embeddings self use_one_hot_embeddings
P ExpandDims self expand
(-1|) self shape_flat
P GatherV2 self gather
P OneHot self one_hot
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
P MatMul self array_mul
P Reshape self reshape
tuple embedding_shape self shape
self expand input_ids|-1 extended_ids
self reshape extended_ids|self shape_flat flat_ids
self one_hot flat_ids|self vocab_size|self on_value|self off_value one_hot_ids
self array_mul output_for_reshape
self gather self embedding_table|flat_ids|0 output_for_reshape
self reshape output_for_reshape|self shape output
super EmbeddingPostprocessor|self __init__
use_token_type self use_token_type
token_type_vocab_size self token_type_vocab_size
Tensor 0 1|mstype float32 self off_value
nn LayerNorm (embedding_size|) self layernorm
nn Dropout 1-dropout_prob self dropout
P StridedSlice self slice
word_embeddings output
self reshape token_type_ids|self shape_flat flat_ids
self gather self embedding_table|flat_ids|0 token_type_embeddings
self reshape token_type_embeddings|self shape token_type_embeddings
token_type_embeddings output
self shape width
self slice self full_position_embeddings|(0|0) position_embeddings
self reshape position_embeddings|(1|seq|width) position_embeddings
position_embeddings output
self layernorm output output
self dropout output output
super BertOutput|self __init__
dropout_prob self dropout_prob
P TensorAdd self add
nn LayerNorm (out_channels|) to_float compute_type self layernorm
P Cast self cast
self dense hidden_status output
self add input_tensor|output output
super RelaPosMatrixGenerator|self __init__
length self _length
max_relative_position self _max_relative_position
-max_relative_position self _min_relative_position
-length|1 self range_length
P Tile self tile
P Reshape self range_mat
P Sub self sub
P ExpandDims self expanddims
self cast F tuple_to_array F make_range self _length range_vec_row_out
self range_mat range_vec_row_out|(self _length|-1) range_vec_col_out
self tile range_vec_row_out|(self _length|) tile_row_out
self tile range_vec_col_out|(1|self _length) tile_col_out
self range_mat tile_row_out|(self _length|self _length) range_mat_out
self range_mat tile_col_out|(self _length|self _length) transpose_out
self sub range_mat_out|transpose_out distance_mat
distance_mat_clipped|self _max_relative_position final_mat
super RelaPosEmbeddingsGenerator|self __init__
depth self depth
max_relative_position|2|1 self vocab_size
Parameter self embeddings_table
nn OneHot depth self one_hot
P Shape self shape
P BatchMatMul self matmul
self relative_positions_matrix relative_positions_matrix_out
self reshape relative_positions_matrix_out|(-1|) flat_relative_positions_matrix
self one_hot one_hot_relative_positions_matrix
self matmul one_hot_relative_positions_matrix|self embeddings_table embeddings
self shape relative_positions_matrix_out|(self depth|) my_shape
self reshape embeddings|my_shape embeddings
super SaturateCast|self __init__
mstype dtype_to_nptype dst_type np_type
float np finfo np_type min self tensor_min_type
float np finfo np_type max self tensor_max_type
P Minimum self min_op
P Maximum self max_op
dst_type self dst_type
self max_op x|self tensor_min_type out
self min_op out|self tensor_max_type out
self cast out|self dst_type
super BertAttention|self __init__
from_seq_length self from_seq_length
to_seq_length self to_seq_length
size_per_head self size_per_head
has_attention_mask self has_attention_mask
(-1|from_tensor_width) self shape_from_2d
(-1|to_tensor_width) self shape_to_2d
TruncatedNormal initializer_range weight
num_attention_heads|size_per_head units
query_act activation
key_act activation
value_act activation
(-1|from_seq_length|num_attention_heads|size_per_head) self shape_from
(-1|to_seq_length|num_attention_heads|size_per_head) self shape_to
P Mul self multiply
P Transpose self transpose
(0|2|1|3) self trans_shape
(2|0|1|3) self trans_shape_relative
(1|2|0|3) self trans_shape_position
-10000 0 self multiply_data
nn Softmax self softmax
nn Dropout 1-attention_probs_dropout_prob self dropout
P ExpandDims self expand_dims
P DType self get_dtype
(-1|num_attention_heads|size_per_head) self shape_
(-1|from_seq_length|num_attention_heads|size_per_head) self shape_
SaturateCast dst_type self cast_compute_type
 self _generate_relative_positions_embeddings
size_per_head depth
self reshape from_tensor|self shape_from_2d from_tensor_2d
self reshape to_tensor|self shape_to_2d to_tensor_2d
self query_layer from_tensor_2d query_out
self key_layer to_tensor_2d key_out
self value_layer to_tensor_2d value_out
self reshape query_out|self shape_from query_layer
self transpose query_layer|self trans_shape query_layer
self reshape key_out|self shape_to key_layer
self transpose key_layer|self trans_shape key_layer
self matmul_trans_b query_layer|key_layer attention_scores
self _generate_relative_positions_embeddings relations_keys
self cast_compute_type relations_keys relations_keys
self transpose query_layer|self trans_shape_relative query_layer_t
attention_scores|key_position_scores_r_t attention_scores
self multiply self scores_mul|attention_scores attention_scores
self expand_dims attention_mask|1 attention_mask
self multiply multiply_out|self multiply_data adder
self add adder|attention_scores attention_scores
self softmax attention_scores attention_probs
self dropout attention_probs attention_probs
self reshape value_out|self shape_to value_layer
self transpose value_layer|self trans_shape value_layer
self matmul attention_probs|value_layer context_layer
self _generate_relative_positions_embeddings relations_values
self cast_compute_type relations_values relations_values
self transpose attention_probs|self trans_shape_relative attention_probs_t
self reshape attention_probs_r
context_layer|value_position_scores_r_t context_layer
self transpose context_layer|self trans_shape context_layer
self reshape context_layer|self shape_return context_layer
super BertSelfAttention|self __init__
int hidden_size|num_attention_heads self size_per_head
BertAttention self attention
hidden_size from_tensor_width
hidden_size to_tensor_width
seq_length from_seq_length
seq_length to_seq_length
self size_per_head size_per_head
hidden_size out_channels
hidden_dropout_prob dropout_prob
(-1|hidden_size) self shape
self reshape input_tensor|self shape input_tensor
self attention input_tensor|input_tensor|attention_mask attention_output
self output attention_output|input_tensor output
super BertEncoderCell|self __init__
BertSelfAttention self attention
intermediate_size out_channels
hidden_act activation
self attention hidden_states|attention_mask attention_output
self intermediate attention_output intermediate_output
self output intermediate_output|attention_output output
mstype float32 compute_type
super BertTransformer|self __init__
return_all_encoders self return_all_encoders
range _
layers append layer
nn CellList layers self layers
(-1|seq_length|hidden_size) self out_shape
self reshape input_tensor|self shape prev_output
self layers layer_module
layer_module prev_output|attention_mask layer_output
layer_output prev_output
self reshape layer_output|self out_shape layer_output
all_encoder_layers|(layer_output|) all_encoder_layers
self reshape prev_output|self out_shape prev_output
all_encoder_layers|(prev_output|) all_encoder_layers
super CreateAttentionMaskFromInputMask|self __init__
(-1|1|config seq_length) self shape
self cast self reshape input_mask|self shape attention_mask
super BertModel|self __init__
copy deepcopy config config
config seq_length self seq_length
config hidden_size self hidden_size
config num_hidden_layers self num_hidden_layers
config hidden_size self embedding_size
self num_hidden_layers-1 self last_idx
[-1|self seq_length|self embedding_size] output_embedding_shape
EmbeddingLookup self bert_embedding_lookup
config vocab_size vocab_size
self embedding_size embedding_size
output_embedding_shape embedding_shape
EmbeddingPostprocessor self bert_embedding_postprocessor
config use_relative_positions use_relative_positions
config type_vocab_size token_type_vocab_size
config max_position_embeddings max_position_embeddings
BertTransformer self bert_encoder
self hidden_size hidden_size
self seq_length seq_length
config num_attention_heads num_attention_heads
self num_hidden_layers num_hidden_layers
config intermediate_size intermediate_size
config attention_probs_dropout_prob attention_probs_dropout_prob
config initializer_range initializer_range
config hidden_dropout_prob hidden_dropout_prob
config hidden_act hidden_act
config compute_type compute_type
config dtype self dtype
CreateAttentionMaskFromInputMask config self _create_attention_mask_from_input_mask
self bert_embedding_lookup input_ids embedding_tables
self _create_attention_mask_from_input_mask input_mask attention_mask
self cast encoder_output self last_idx sequence_output
P Shape input_ids batch_size
self squeeze_1 sequence_slice first_token
self dense first_token pooled_output
self cast pooled_output|self dtype pooled_output
mstype float32 dtype self dtype
self reshape output_for_reshape|self shape output all_encoder_layers
self reshape output_for_reshape|self shape output all_encoder_layers
word_embeddings output all_encoder_layers
word_embeddings output all_encoder_layers
self gather self embedding_table|flat_ids|0 token_type_embeddings output
self reshape token_type_embeddings|self shape token_type_embeddings output
token_type_embeddings output all_encoder_layers
token_type_embeddings output all_encoder_layers
self slice self full_position_embeddings|(0|0) position_embeddings output
self reshape position_embeddings|(1|seq|width) position_embeddings output
position_embeddings output all_encoder_layers
position_embeddings output all_encoder_layers
self layernorm output output all_encoder_layers
self layernorm output output all_encoder_layers
self dropout output output all_encoder_layers
self dropout output output all_encoder_layers
self dense hidden_status output all_encoder_layers
self dense hidden_status output all_encoder_layers
self add input_tensor|output output all_encoder_layers
self add input_tensor|output output all_encoder_layers
length self _length self shape_from
length self _length self shape_to
length self _length self shape_
length self _length self out_shape
self matmul_trans_b query_layer|key_layer attention_scores attention_scores
attention_scores|key_position_scores_r_t attention_scores attention_scores
self matmul attention_probs|value_layer context_layer context_layer
context_layer|value_position_scores_r_t context_layer context_layer
self output attention_output|input_tensor output all_encoder_layers
self output attention_output|input_tensor output all_encoder_layers
self output intermediate_output|attention_output output all_encoder_layers
self output intermediate_output|attention_output output all_encoder_layers
nn CellList layers self layers all_encoder_layers
nn CellList layers self layers all_encoder_layers
self reshape input_tensor|self shape prev_output all_encoder_layers
self layers layer_module prev_output|attention_mask layer_output
layer_module prev_output|attention_mask layer_output prev_output
layer_module prev_output|attention_mask layer_output all_encoder_layers
layer_output prev_output all_encoder_layers
self reshape layer_output|self out_shape layer_output all_encoder_layers
all_encoder_layers|(layer_output|) all_encoder_layers all_encoder_layers
all_encoder_layers|(layer_output|) all_encoder_layers all_encoder_layers
self reshape prev_output|self out_shape prev_output all_encoder_layers
all_encoder_layers|(prev_output|) all_encoder_layers all_encoder_layers
copy deepcopy config config seq_length self seq_length
copy deepcopy config config hidden_size self hidden_size
copy deepcopy config config num_hidden_layers self num_hidden_layers
copy deepcopy config config hidden_size self embedding_size
copy deepcopy config config vocab_size vocab_size
copy deepcopy config config use_relative_positions use_relative_positions
copy deepcopy config config type_vocab_size token_type_vocab_size
copy deepcopy config config max_position_embeddings max_position_embeddings
copy deepcopy config config num_attention_heads num_attention_heads
copy deepcopy config config intermediate_size intermediate_size
copy deepcopy config config attention_probs_dropout_prob attention_probs_dropout_prob
copy deepcopy config config initializer_range initializer_range
copy deepcopy config config hidden_dropout_prob hidden_dropout_prob
copy deepcopy config config hidden_act hidden_act
copy deepcopy config config compute_type compute_type
copy deepcopy config config dtype self dtype
[-1|self seq_length|self embedding_size] output_embedding_shape embedding_shape
text ret
isinstance text|str
isinstance text|bytes
text decode ret
ValueError % type text
collections OrderedDict vocab
open vocab_file|
convert_to_unicode reader readline token
token strip token
index vocab token
token vocab index
text strip text
text split tokens
vocab_to_dict_key_token vocab_file vocab_dict
tokens token
output append vocab_dict token
vocab_to_dict_key_id vocab_file vocab_dict
ids _id
output append vocab_dict _id
vocab_to_dict_key_token vocab_file self vocab_dict
do_lower_case self do_lower_case
BasicTokenizer do_lower_case self basic_tokenize
WordpieceTokenizer self vocab_dict self wordpiece_tokenize
convert_to_unicode text text
self basic_tokenize tokenize tokens
self wordpiece_tokenize tokenize tokens wordpiece_tokens
tokens_ret extend wordpiece_tokens
self _clean_text text text
self _tokenize_chinese_chars text text
whitespace_tokenize text orig_tokens
orig_tokens token
token lower token
self _run_strip_accents token token
self _run_split_on_punc token aaa
split_tokens extend aaa
whitespace_tokenize  join split_tokens output_tokens
unicodedata normalize text text
text char
unicodedata category char cat
output append char
 join output
_is_punctuation char
output append [char]
output append
1] append char
output x
ord char cp
_is_whitespace char
self _is_chinese_char cp
vocab self vocab_dict
convert_to_unicode tokens tokens
whitespace_tokenize token
list token chars
len chars len_chars
len_chars end
output_tokens append substr
end start
end-1 end
output_tokens append
cat startswith
isinstance text decode ret
isinstance text strip text
isinstance text split tokens
isinstance text char
isinstance  join output
isinstance text decode ret
isinstance text strip text
isinstance text split tokens
isinstance text char
isinstance  join output
ValueError % type text strip text
ValueError % type text split tokens
ValueError % type text char
collections OrderedDict vocab self vocab_dict
open  join output
convert_to_unicode reader readline token strip token
convert_to_unicode reader readline token vocab index
convert_to_unicode reader readline token lower token
index vocab token vocab index
index vocab token lower token
text split tokens token
tokens token lower token
output append vocab_dict token lower token
convert_to_unicode text text char
self _clean_text text text char
self _tokenize_chinese_chars text text char
whitespace_tokenize text orig_tokens token
orig_tokens token lower token
whitespace_tokenize  join split_tokens output_tokens append substr
whitespace_tokenize  join split_tokens output_tokens append
unicodedata normalize text text char
unicodedata category char cat startswith
 join output append [char]
 join output append
 join output x
len chars len_chars end
len_chars end start
super BertCLSModel|self __init__
BertModel config|is_training|use_one_hot_embeddings self bert
P Cast self cast
TruncatedNormal config initializer_range self weight_init
P LogSoftmax axis self log_softmax
config dtype self dtype
num_labels self num_labels
nn Dropout 1-dropout_prob self dropout
assessment_method self assessment_method
 _
self bert input_ids|token_type_id|input_mask
self cast pooled_output|self dtype cls
self dropout cls cls
self dense_1 cls logits
self cast logits|self dtype logits
self log_softmax logits logits
super BertSquadModel|self __init__
is_training self is_training
self bert input_ids|token_type_id|input_mask _
P Shape sequence_output hidden_size
P Reshape sequence_output|(-1|hidden_size) sequence
self dense1 sequence logits
P Cast logits|self dtype logits
P Reshape logits|(batch_size|seq_length|self num_labels) logits
super BertNERModel|self __init__
P Reshape self reshape
(-1|config hidden_size) self shape
use_crf self use_crf
(-1|config seq_length|self num_labels) self origin_shape
self dropout sequence_output seq
self reshape seq|self shape seq
self dense_1 seq logits
self reshape logits|self origin_shape return_value
self log_softmax logits return_value
os listdir data_dir files
files file_name
data_files append os path join data_dir|file_name
ds get_dataset_size ori_dataset_size
print ori_dataset_size
C TypeCast mstype int32 type_cast_op
logger info  format ds get_dataset_size
logger info  format ds get_repeat_count
C TypeCast mstype float32 type_cast_op_float
ds repeat repeat_count ds
data_features feature
os listdir data_dir files file_name
collections namedtuple _PrelimPrediction
unique_id_to_result feature unique_id result
_get_best_indexes result start_logits|n_best_size start_indexes
_get_best_indexes result end_logits|n_best_size end_indexes
start_indexes start_index
end_indexes end_index
feature token_is_max_context get start_index|False
end_index-start_index|1 length
result start_logits start_index start_logit
sorted prelim_predictions
collections namedtuple _NbestPrediction
prelim_predictions pred
features pred feature_index feature
feature tokens tok_tokens
feature token_to_orig_map pred start_index orig_doc_start
feature token_to_orig_map pred end_index orig_doc_end
example doc_tokens orig_tokens
tok_text replace " tok_text
tok_text strip tok_text
get_final_text tok_text|orig_text|do_lower_case final_text
final_text text
pred start_logit start_logit
collections defaultdict list example_index_to_features
all_features feature
example_index_to_features[feature example_index] append feature
all_results result
result unique_id_to_result result unique_id
collections OrderedDict all_predictions
example_index_to_features example_index features
get_prelim_predictions features|unique_id_to_result|n_best_size|max_answer_length prelim_predictions
get_nbest prelim_predictions|features|example|n_best_size|do_lower_case nbest
nbest entry
total_scores append entry start_logit|entry end_logit
entry best_non_null_entry
_compute_softmax total_scores probs
collections OrderedDict output
entry text output
probs i output
entry start_logit output
entry end_logit output
nbest_json append output
nbest_json all_predictions example qas_id
collections OrderedDict ns_to_s_map
i ns_to_s_map[len ns_chars]
ns_chars append c
tokenization BasicTokenizer do_lower_case tokenizer
tok_text find pred_text start_position
start_position|len(pred_text)-1 end_position
_strip_spaces(orig_text orig_ns_to_s_map)
_strip_spaces(tok_text tok_ns_to_s_map)
i tok_s_to_ns_map tok_index
tok_s_to_ns_map start_position ns_start_position
orig_ns_to_s_map ns_start_position orig_start_position
tok_s_to_ns_map end_position ns_end_position
orig_ns_to_s_map ns_end_position orig_end_position
orig_text output_text
best_indexes append score
scores score
score max_score
math exp score-max_score x
exp_scores append x
x total_sum
exp_scores score
probs append score|total_sum
unique_id_to_result feature unique_id result start_logits start_index start_logit
unique_id_to_result feature unique_id result unique_id_to_result result unique_id
_get_best_indexes result start_logits|n_best_size start_indexes start_index
_get_best_indexes result end_logits|n_best_size end_indexes end_index
start_indexes start_index length
feature token_is_max_context get x total_sum
sorted prelim_predictions pred
prelim_predictions pred start_logit start_logit
features pred feature_index feature tokens tok_tokens
features pred feature_index feature token_to_orig_map pred start_index orig_doc_start
features pred feature_index feature token_to_orig_map pred end_index orig_doc_end
get_final_text tok_text|orig_text|do_lower_case final_text text
collections defaultdict list example_index_to_features example_index features
all_results result unique_id_to_result result unique_id
get_nbest prelim_predictions|features|example|n_best_size|do_lower_case nbest entry
nbest entry best_non_null_entry
nbest entry text output
nbest entry start_logit output
nbest entry end_logit output
_compute_softmax total_scores probs i output
_compute_softmax total_scores probs append score|total_sum
tok_text find pred_text start_position end_position
best_indexes append score max_score
scores score max_score
math exp score-max_score x total_sum
exp_scores append x total_sum
super CrossEntropyCalculation|self __init__
P OneHot self onehot
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
P ReduceSum self reduce_sum
P ReduceMean self reduce_mean
P Reshape self reshape
(-1|) self last_idx
P Neg self neg
P Cast self cast
is_training self is_training
self reshape label_ids|self last_idx label_ids
self onehot label_ids|num_labels|self on_value|self off_value one_hot_labels
self neg self reduce_sum one_hot_labels|logits|self last_idx per_example_loss
self reduce_mean per_example_loss|self last_idx loss
self cast loss|mstype float32 return_value
logits|1 0 return_value
logger error path
os path realpath path path
logger debug path
os path exists path
path real_path
super LossCallBack|self __init__
dataset_size self _dataset_size
run_context original_args cb_params
math modf cb_params cur_step_num|self _dataset_size epoch_num
os listdir load_finetune_checkpoint_dir files
len prefix pre_len
files filename
os path splitext filename name_ext
filename find index
os path join load_finetune_checkpoint_dir|filename load_finetune_checkpoint_path
name_ext split name_split
filename num
int num
int num max_num
super BertLearningRate|self __init__
WarmUpLR learning_rate|warmup_steps self warmup_lr
PolynomialDecayLR learning_rate|end_learning_rate|decay_steps|power self decay_lr
Tensor np array [warmup_steps] astype np float32 self warmup_steps
P Greater self greater
Tensor np array astype np float32 self one
self decay_lr global_step decay_lr
self cast self greater self warmup_steps|global_step is_warmup
self warmup_lr global_step warmup_lr
(self one-is_warmup)|decay_lr|is_warmup|warmup_lr lr
decay_lr lr
collections OrderedDict label2id
label_list label
prefix pre
pre|label sub_label
index label2id sub_label
logger error path real_path
os path realpath path path real_path
logger debug path real_path
os path exists path real_path
os listdir load_finetune_checkpoint_dir files filename
files filename find index
files filename num
os path splitext filename name_ext split name_split
filename find index label2id sub_label
PolynomialDecayLR learning_rate|end_learning_rate|decay_steps|power self decay_lr lr
self decay_lr global_step decay_lr lr
label_list label sub_label
prefix pre sub_label
dataset map operations dataset
text Vocab from_list label_list label_vocab
text Lookup label_vocab label_lookup
text Vocab from_file bert_vocab_path vocab
dataset batch batch_size|drop_remainder dataset
re sub text
' join text split
set string punctuation exclude
textifchnot ch
text lower
white_space_fix remove_articles remove_punc lower s
normalize_answer prediction split prediction_tokens
normalize_answer ground_truth split ground_truth_tokens
Counter prediction_tokens common
sum common values num_same
(2|precision|recall)|(precision|recall) f1
ground_truths ground_truth
metric_fn prediction|ground_truth score
scores_for_ground_truths append score
max scores_for_ground_truths
dataset article
article paragraph
paragraph qa
sys stderr file
predictions qa prediction
metric_max_over_ground_truths exact_match
metric_max_over_ground_truths f1
open dataset_file
json load ds dataset_json
dataset_json dataset
evaluate dataset|all_predictions re_json
print json dumps re_json
open output_metrics|
wr write json dumps re_json
re sub text lower
dataset article paragraph
article paragraph qa
json load ds dataset_json dataset
 optimizer_cfg
BertConfig bert_net_cfg
mstype float32 dtype
mstype float16 compute_type
C MultitypeFuncGraph grad_scale
P Reciprocal reciprocal
grad_scale register
reciprocal scale
C MultitypeFuncGraph _grad_overflow
P FloatStatus grad_overflow
_grad_overflow register
grad_overflow grad
network self network
self network set_grad
optimizer parameters self weights
optimizer self optimizer
P AllReduce self allreduce
context get_auto_parallel_context self parallel_mode
context get_auto_parallel_context mean
get_group_size degree
DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
(self parallel_mode) self is_distributed
P Cast self cast
P FloatStatus self float_status
P AddN self addn
P Reshape self reshape
P NPUAllocFloatStatus self alloc_status
P NPUGetFloatStatus self get_status
P NPUClearFloatStatus self clear_before_grad
Tensor 1|mstype float32 self base
P LessEqual self less_equal
C HyperMap self hyper_map
scale_update_cell self loss_scaling_manager
Parameter Tensor scale_update_cell get_loss_scale|dtype self loss_scale
self weights weights
self loss_scale scaling_sens
sens scaling_sens
self alloc_status init
self clear_before_grad init clear_before_grad
F control_depend loss|init
self depend_parameter_use clear_before_grad|scaling_sens
self hyper_map F partial grad_scale|scaling_sens grads
self hyper_map F partial clip_grad|GRADIENT_CLIP_TYPE|GRADIENT_CLIP_VALUE grads
self grad_reducer grads grads
self get_status init flag
self reduce_sum init|(0|) flag_sum
F control_depend grads|flag
F control_depend flag|flag_sum
self hyper_map F partial _grad_overflow flag_sum
self addn flag_sum flag_sum
self reshape flag_sum flag_sum
self allreduce flag_sum flag_reduce
self less_equal self base|flag_reduce cond
self less_equal self base|flag_sum cond
cond overflow
self loss_scaling_manager self loss_scale|cond overflow
self optimizer grads succ
(loss|cond) ret
F depend ret|succ
super BertCLS|self __init__
CrossEntropyCalculation is_training self loss
num_labels self num_labels
assessment_method self assessment_method
is_training self is_training
self bert input_ids|input_mask|token_type_id logits
self loss logits|label_ids loss
logits loss
self loss logits|label_ids|self num_labels loss
super BertNER|self __init__
BertNERModel config|is_training|num_labels|use_crf|dropout_prob|use_one_hot_embeddings self bert
CRF tag_to_index|batch_size|config seq_length|is_training self loss
use_crf self use_crf
super BertSquad|self __init__
BertSquadModel config|is_training|num_labels|dropout_prob|use_one_hot_embeddings self bert
config seq_length self seq_length
Parameter Tensor |mstype float32 self total_num
Parameter Tensor |mstype float32 self start_num
Parameter Tensor |mstype float32 self end_num
P ReduceSum self sum
P Equal self equal
P Squeeze axis self squeeze
self squeeze logits unstacked_logits_0
self squeeze logits unstacked_logits_1
self loss unstacked_logits_0|start_position|self seq_length start_loss
self loss unstacked_logits_1|end_position|self seq_length end_loss
(start_loss|end_loss)|2 0 total_loss
self squeeze logits start_logits
start_logits|100|input_mask start_logits
self squeeze logits end_logits
end_logits|100|input_mask end_logits
(unique_id|start_logits|end_logits) total_loss
C MultitypeFuncGraph grad_scale register
P Reciprocal reciprocal scale
C MultitypeFuncGraph _grad_overflow register
P FloatStatus grad_overflow grad
self less_equal self base|flag_reduce cond overflow
self less_equal self base|flag_reduce cond ret
self less_equal self base|flag_sum cond overflow
self less_equal self base|flag_sum cond ret
CrossEntropyCalculation is_training self loss 0 total_loss
self bert input_ids|input_mask|token_type_id logits loss
self bert input_ids|input_mask|token_type_id logits start_logits
self bert input_ids|input_mask|token_type_id logits end_logits
self bert input_ids|input_mask|token_type_id logits total_loss
self loss logits|label_ids loss 0 total_loss
logits loss 0 total_loss
self loss logits|label_ids|self num_labels loss 0 total_loss
CRF tag_to_index|batch_size|config seq_length|is_training self loss 0 total_loss
self loss unstacked_logits_0|start_position|self seq_length start_loss 0 total_loss
self loss unstacked_logits_1|end_position|self seq_length end_loss 0 total_loss
self squeeze logits start_logits start_logits
self squeeze logits start_logits total_loss
start_logits|100|input_mask start_logits start_logits
start_logits|100|input_mask start_logits total_loss
self squeeze logits end_logits end_logits
self squeeze logits end_logits total_loss
end_logits|100|input_mask end_logits end_logits
end_logits|100|input_mask end_logits total_loss
[text] data
data i
process_one_example_p tokenizer_|vocab|i|max_seq_len feature
features append feature
feature token_type_id
Tensor np array input_ids input_ids
Tensor np array input_mask input_mask
Tensor np array token_type_id token_type_id
model predict input_ids|input_mask|token_type_id|Tensor best_tag_id
postprocess backpointers|best_tag_id best_path
best_path ele
logits extend ele
logits ids
model predict input_ids|input_mask|token_type_id|Tensor logits
logits asnumpy ids
np argmax ids|axis ids
list ids ids
label_generation text res
tokenization FullTokenizer vocab_file tokenizer_
open line
line strip
json loads line strip oneline
open write  join data
open label_file
f label
labels append label strip
get_result labels|path
[text] data i
data i feature
process_one_example_p tokenizer_|vocab|i|max_seq_len feature token_type_id
features append feature token_type_id
postprocess backpointers|best_tag_id best_path ele
model predict input_ids|input_mask|token_type_id|Tensor logits asnumpy ids
open line strip
qas_id self qas_id
question_text self question_text
doc_tokens self doc_tokens
orig_answer_text self orig_answer_text
start_position self start_position
end_position self end_position
is_impossible self is_impossible
unique_id self unique_id
example_index self example_index
doc_span_index self doc_span_index
tokens self tokens
token_to_orig_map self token_to_orig_map
token_is_max_context self token_is_max_context
input_ids self input_ids
input_mask self input_mask
segment_ids self segment_ids
open input_file|
json load reader input_data
paragraph_text c
is_whitespace c
doc_tokens append c
c doc_tokens
char_to_word_offset append len doc_tokens-1
qa qas_id
qa question_text
-1 start_position
-1 end_position
qa is_impossible
qa answer
answer orig_answer_text
answer answer_offset
len orig_answer_text answer_length
char_to_word_offset answer_offset start_position
char_to_word_offset end_position
SquadExample example
input_data entry
entry paragraph
paragraph paragraph_text
token_offset paragraph_text char_to_word_offset
paragraph qa
examples append one_example
doc_span start|doc_span length-1 end
position-doc_span start num_left_context
end-position num_right_context
min num_left_context|num_right_context|0 01|doc_span length score
score best_score
span_index best_span_index
range input_start|input_end new_start
range input_end|new_start new_end
tokenizer tokenize example question_text query_tokens
len query_tokens
orig_to_tok_index append len all_doc_tokens
tokenizer tokenize token sub_tokens
sub_tokens sub_token
tok_to_orig_index append i
all_doc_tokens append sub_token
-1 tok_start_position
-1 tok_end_position
orig_to_tok_index example start_position tok_start_position
len example doc_tokens
orig_to_tok_index-1 tok_end_position
len all_doc_tokens-1 tok_end_position
max_seq_length-len(query_tokens)-3 max_tokens_for_doc
collections namedtuple _DocSpan
len all_doc_tokens
len all_doc_tokens-start_offset length
max_tokens_for_doc length
start_offset _DocSpan start|length length doc_spans append
min length|doc_stride start_offset
tokens append
segment_ids append
query_tokens token
tokens append token
range i
doc_span start|i split_token_index
tok_to_orig_index split_token_index token_to_orig_map[len tokens]
_check_is_max_context doc_spans|doc_span_index|split_token_index is_max_context
is_max_context token_is_max_context[len tokens]
tokens append all_doc_tokens split_token_index
tokenization convert_tokens_to_ids vocab_file|tokens input_ids
|len(input_ids) input_mask
len input_ids
input_ids append
input_mask append
doc_span start doc_start
doc_span start|doc_span length-1 doc_end
len query_tokens|2 doc_offset
tok_start_position-doc_start|doc_offset start_position
tok_end_position-doc_start|doc_offset end_position
InputFeatures feature
output append feature
json load reader input_data entry
paragraph_text c doc_tokens
is_whitespace c doc_tokens
doc_tokens append c doc_tokens
qa answer orig_answer_text
qa answer answer_offset
input_data entry paragraph
entry paragraph paragraph_text
entry paragraph qa
doc_span start|doc_span length-1 end new_end
min num_left_context|num_right_context|0 01|doc_span length score best_score
range input_start|input_end new_start new_end
tokenizer tokenize example question_text query_tokens token
len query_tokens token
orig_to_tok_index append len all_doc_tokens append sub_token
tokenizer tokenize token sub_tokens sub_token
max_seq_length-len(query_tokens)-3 max_tokens_for_doc length
_check_is_max_context doc_spans|doc_span_index|split_token_index is_max_context token_is_max_context[len tokens]
tokenization convert_tokens_to_ids vocab_file|tokens input_ids append
|len(input_ids) input_mask append
len input_ids append
doc_span start doc_start start_position
doc_span start doc_start end_position
len query_tokens|2 doc_offset start_position
len query_tokens|2 doc_offset end_position
labels asnumpy labels
np reshape labels|-1 labels
logits asnumpy logits
np argmax logits|axis logit_id
len labels self total_num
use_crf self use_crf
num_labels self num_labels
logits best_tag_id
postprocess backpointers|best_tag_id best_path
best_path ele
logit_id extend ele
np reshape logit_id|-1 logit_id
np isin logit_id|[iforiinrange(1|self num_labels)] pos_eva
np isin labels|[iforiinrange(1|self num_labels)] pos_label
np sum pos_eva self TP
np sum pos_eva self FP
np sum () self FN
labels astype np bool labels
logit_id astype np bool logit_id
logit_id ornot
() self TP
(ornot) self FP
(ornot) self FN
() self TN
np reshape logits|-1 logits
self label append labels
self logit append logits
np concatenate self label label
np concatenate self logit logit
label argsort sort_label
logit argsort sort_logit
len label n
range i
d2 d_acc
np reshape labels|-1 labels astype np bool labels
np argmax logits|axis logit_id extend ele
np argmax logits|axis logit_id astype np bool logit_id
np argmax logits|axis logit_id ornot
postprocess backpointers|best_tag_id best_path ele
np reshape logit_id|-1 logit_id astype np bool logit_id
np reshape logit_id|-1 logit_id ornot
np concatenate self label label argsort sort_label
np concatenate self logit logit argsort sort_logit
len pre_lines
pre_lines index label pre_line
gold_lines index label gold_line
pre_line sample
gold_line sample
labels label
get_f1_score_for_each_label pre_lines|gold_lines|label f1
print %(label|f1)
f1 f1_sum
len labels
get_f1_score labels|pre_file avg
print %avg
len pre_lines index label pre_line
pre_lines index label pre_line sample
gold_lines index label gold_line sample
get_f1_score_for_each_label pre_lines|gold_lines|label f1 f1_sum
print f1 f1_sum
len labels avg
os path dirname os path realpath __file__ _current_dir
get_bert_lr lr
get_bert_damping damping
ValueError  format cfg optimizer
parser parse_args args_opt
args_opt save_checkpoint_path ckpt_save_dir
D init
D get_group_size device_num
D get_rank rank
context reset_auto_parallel_context
logger warning
mstype float32 bert_net_cfg compute_type
create_bert_dataset device_num|rank|args_opt do_shuffle|args_opt data_dir|args_opt schema_dir ds
BertNetworkWithLoss bert_net_cfg|True net_with_loss
args_opt epoch_size|ds get_dataset_size||args_opt data_sink_steps new_repeat_count
min new_repeat_count|args_opt train_steps||args_opt data_sink_steps new_repeat_count
args_opt epoch_size|ds get_dataset_size args_opt train_steps
logger info  format args_opt train_steps
_get_optimizer args_opt|net_with_loss optimizer
[TimeMonitor args_opt data_sink_steps] callback
callback append ckpoint_cb
load_checkpoint args_opt load_checkpoint_path param_dict
load_param_into_net net_with_loss|param_dict
cfg scale_factor scale_factor
BertTrainOneStepCell net_with_loss|optimizer net_with_grads
Model net_with_grads|frequency model
ValueError  format cfg optimizer net_with_grads
parser parse_args args_opt save_checkpoint_path ckpt_save_dir
parser parse_args args_opt epoch_size|ds get_dataset_size||args_opt data_sink_steps new_repeat_count
parser parse_args args_opt epoch_size|ds get_dataset_size args_opt train_steps
create_bert_dataset device_num|rank|args_opt do_shuffle|args_opt data_dir|args_opt schema_dir ds model
BertNetworkWithLoss bert_net_cfg|True net_with_loss net_with_grads
_get_optimizer args_opt|net_with_loss optimizer net_with_grads
[TimeMonitor args_opt data_sink_steps] callback append ckpoint_cb
BertTrainOneStepCell net_with_loss|optimizer net_with_grads model
BertConfig bert_net_cfg
mstype float32 dtype
mstype float16 compute_type
BertModel bert_net_cfg|is_training|args
NotImplementedError f
super myMetric|self __init__
self clear
self _convert_data inputs total_num
self _convert_data inputs acc_num
total_num self total_num
acc_num self acc_num
super GetLogProbs|self __init__
BertModel config|False self bert
GetMaskedLMOutput config self cls1
self bert input_ids|token_type_id|input_mask embedding_table
self cls1 sequence_output|embedding_table|masked_pos prediction_scores
super BertPretrainEva|self __init__
GetLogProbs config self bert
P Argmax axis self argmax
P Equal self equal
P ReduceMean self mean
P ReduceSum self sum
Parameter Tensor |mstype float32 self total
Parameter Tensor |mstype float32 self acc
P Reshape self reshape
P Shape self shape
P Cast self cast
self shape input_ids _
self bert input_ids|input_mask|token_type_id|masked_pos probs
self argmax probs index
self reshape index|(bs|-1) index
self equal index|masked_ids eval_acc
self cast eval_acc|mstype float32 eval_acc1
eval_acc1|masked_weights real_acc
self sum real_acc acc
self sum masked_weights total
total self total
acc self acc
C TypeCast mstype int32 type_cast_op
ds repeat repeat_count ds
int os getenv devid
get_enwiki_512_dataset bert_net_cfg batch_size|1 dataset
BertPretrainEva bert_net_cfg net_for_pretraining
net_for_pretraining set_train False
load_checkpoint cfg finetune_ckpt param_dict
load_param_into_net net_for_pretraining|param_dict
Model net_for_pretraining model
bert_predict net_for_pretraining
res items _|v
print v
str DEVICE_ID os environ
self _convert_data inputs total_num self total_num
self _convert_data inputs acc_num self acc_num
Parameter Tensor |mstype float32 self total self total
Parameter Tensor |mstype float32 self acc self acc
self cast eval_acc|mstype float32 eval_acc1 real_acc
self sum real_acc acc self acc
self sum masked_weights total self total
BertPretrainEva bert_net_cfg net_for_pretraining set_train False
print x_shape
x_shape norm_shape
(1|-1|1|int(np prod norm_shape)) output_shape
print output_shape
 y
parameter beta|gamma
rank inputs
Tensor np ones [20|5|10|10] x
x shape shape1
m x
-1 begin_norm_axis
-1 begin_params_axis
super FusedLayerNorm|self __init__
isinstance normalized_shape|(tuple|list)
normalized_shape self normalized_shape
begin_norm_axis self begin_norm_axis
begin_params_axis self begin_params_axis
Parameter initializer self gamma
Parameter initializer self beta
P LayerNorm begin_norm_axis self layer_norm
use_batch_norm self use_batch_norm
P Mul self mul
P TensorAdd self add
P Fill mstype float32|F shape input_x ones
P Fill mstype float32|F shape input_x zeros
F shape input_x shape_x
get_shape_for_norm shape_x|self begin_norm_axis norm_shape
F reshape input_x|norm_shape input_x
self batch_norm input_x|ones|zeros|None|None _
F reshape output|shape_x output
self mul output|self gamma y
self add y|self beta y
self layer_norm input_x|self gamma|self beta _
print x_shape norm_shape
Tensor np ones [20|5|10|10] x shape shape1
-1 begin_norm_axis self begin_norm_axis
-1 begin_params_axis self begin_params_axis
isinstance normalized_shape self normalized_shape
 cfg
BertConfig bert_net_cfg
mstype float32 dtype
mstype float16 compute_type
get_bert_damping damping
cfg Thor loss_scale loss_scale
cfg Thor frequency frequency
cfg Thor batch_size batch_size
C MultitypeFuncGraph clip_grad
clip_grad register
F dtype grad dt
nn ClipByNorm grad|F cast(F tuple_to_array (clip_value|)) new_grad
super GetMaskedLMOutput|self __init__
config hidden_size self width
P Reshape self reshape
P GatherV2 self gather
TruncatedNormal config initializer_range weight_init
config hidden_size out_channels
config hidden_act activation
nn LayerNorm (config hidden_size|) to_float(config compute_type) self layernorm
Parameter self output_bias
nn LogSoftmax axis self log_softmax
(-1|1) self shape_flat_offsets
Tensor np array range 0|config batch_size astype(np int32) self rng
(-1|) self last_idx
(config batch_size|config seq_length|self width) self shape_flat_sequence_tensor
Tensor np array (config seq_length|) astype(np int32) self seq_length_tensor
P Cast self cast
config compute_type self compute_type
config dtype self dtype
self reshape flat_offsets
self reshape positions|flat_offsets|self last_idx flat_position
self reshape input_tensor|self shape_flat_sequence_tensor flat_sequence_tensor
self gather flat_sequence_tensor|flat_position|0 input_tensor
self cast input_tensor|self compute_type input_tensor
self cast output_weights|self compute_type output_weights
self dense input_tensor input_tensor
self layernorm input_tensor input_tensor
self matmul input_tensor|output_weights logits
self cast logits|self dtype logits
logits|self output_bias logits
self log_softmax logits log_probs
super GetNextSentenceOutput|self __init__
P LogSoftmax self log_softmax
self dense input_tensor logits
self log_softmax logits log_prob
super BertPreTraining|self __init__
BertModel config|is_training|use_one_hot_embeddings self bert
GetMaskedLMOutput config self cls1
GetNextSentenceOutput config self cls2
 embedding_table
self bert input_ids|token_type_id|input_mask
self cls2 pooled_output seq_relationship_score
super BertPretrainingLoss|self __init__
config vocab_size self vocab_size
P OneHot self onehot
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
P ReduceSum self reduce_sum
P ReduceMean self reduce_mean
P Neg self neg
self reshape masked_lm_ids|self last_idx label_ids
self cast self reshape masked_lm_weights|self last_idx label_weights
self onehot label_ids|self vocab_size|self on_value|self off_value one_hot_labels
self neg self reduce_sum prediction_scores|one_hot_labels|self last_idx per_example_loss
self reduce_sum label_weights|per_example_loss numerator
self reduce_sum label_weights||self cast(F tuple_to_array (1e-5|)) denominator
numerator|denominator masked_lm_loss
self reshape next_sentence_labels|self last_idx labels
self onehot labels|2|self on_value|self off_value one_hot_labels
self neg self reduce_sum per_example_loss
self reduce_mean per_example_loss|self last_idx next_sentence_loss
masked_lm_loss|next_sentence_loss total_loss
super BertNetworkWithLoss|self __init__
BertPreTraining config|is_training|use_one_hot_embeddings self bert
BertPretrainingLoss config self loss
 seq_relationship_score
self bert input_ids|input_mask|token_type_id|masked_lm_positions
self cast total_loss|mstype float32
super BertTrainOneStepCell|self __init__ network|optimizer|sens
C HyperMap self hyper_map
value self sens
self weights weights
self hyper_map F partial clip_grad|GRADIENT_CLIP_TYPE|GRADIENT_CLIP_VALUE grads
self grad_reducer grads grads
self optimizer grads succ
F depend loss|succ
C MultitypeFuncGraph grad_scale
P Reciprocal reciprocal
grad_scale register
reciprocal scale
network self network
self network set_grad
optimizer parameters self weights
optimizer self optimizer
P AllReduce self allreduce
context get_auto_parallel_context self parallel_mode
F identity self grad_reducer
get_group_size self degree
DistributedGradReducer optimizer parameters|False|self degree self grad_reducer
(self parallel_mode) self is_distributed
P NPUAllocFloatStatus self alloc_status
P NPUGetFloatStatus self get_status
P NPUClearFloatStatus self clear_before_grad
Tensor 1|mstype float32 self base
P LessEqual self less_equal
scale_update_cell self loss_scaling_manager
Parameter Tensor scale_update_cell get_loss_scale|dtype self loss_scale
self loss_scale scaling_sens
sens scaling_sens
self alloc_status init
self clear_before_grad init
self hyper_map F partial grad_scale|scaling_sens|self degree grads
self get_status init
self reduce_sum init|(0|) flag_sum
self allreduce flag_sum flag_reduce
self less_equal self base|flag_reduce cond
self less_equal self base|flag_sum cond
cond overflow
self loss_scaling_manager self loss_scale|cond overflow
(loss|cond|scaling_sens) ret
F depend ret|succ
C MultitypeFuncGraph clip_grad register
self matmul input_tensor|output_weights logits output_bias logits
self cast logits|self dtype logits output_bias logits
logits|self output_bias logits output_bias logits
self bert  seq_relationship_score
self reduce_sum label_weights|per_example_loss numerator masked_lm_loss
self reduce_sum label_weights||self cast(F tuple_to_array (1e-5|)) denominator masked_lm_loss
numerator|denominator masked_lm_loss total_loss
self reduce_mean per_example_loss|self last_idx next_sentence_loss total_loss
BertPretrainingLoss config self loss ret
super BertTrainOneStepCell|self __init__ network self network
super BertTrainOneStepCell|self __init__ optimizer parameters self weights
super BertTrainOneStepCell|self __init__ optimizer self optimizer
super BertTrainOneStepCell|self __init__ sens scaling_sens
value self sens scaling_sens
C MultitypeFuncGraph grad_scale register
P Reciprocal reciprocal scale
self loss_scale scaling_sens ret
sens scaling_sens ret
self less_equal self base|flag_reduce cond overflow
self less_equal self base|flag_reduce cond ret
self less_equal self base|flag_sum cond overflow
self less_equal self base|flag_sum cond ret
 cfg
types np_type
pytype_to_dtype np_type ms_type
ms_types append ms_type
_convert_type dataset output_types dataset_types
dataset output_shapes dataset_shapes
exec_dataset get_batch_size batch_size
exec_dataset input_indexs input_indexs
_get_types_and_shapes exec_dataset dataset_shapes
Net nn Cell
__init__ self
super Net|self __init__
nn BatchNorm2d self bn
nn ReLU self relu
nn Flatten self flatten
construct self|x
self conv x x
self bn x x
self relu x x
self flatten x x
self fc x out
Net net
get_dataset dataset
model train 2|dataset
network self _network
loss_fn self _loss_fn
optimizer self _optimizer
self _check_kwargs kwargs
amp_level self _amp_level
self _process_amp_args kwargs
_get_parallel_mode self _parallel_mode
_get_device_num self _device_number
_get_global_rank self _global_rank
_get_parameter_broadcast self _parameter_broadcast
frequency self _frequency
stop_epoch self _stop_epoch
self _build_train_network self _train_network
self _build_eval_network metrics|eval_network|eval_indexes
self _build_predict_network
kwargs self _keep_bn_fp32
kwargs self _loss_scale_manager
kwargs arg
ValueError f
self _network network
self _amp_level level
self _loss_scale_manager loss_scale_manager
nn WithLossCell network|self _loss_fn network
network set_auto_parallel
get_metrics metrics self _metric_fns
eval_network self _eval_network
eval_indexes self _eval_indexes
[0|1|2] self _eval_indexes
_VirtualDatasetCell self _eval_network self _eval_network
self _eval_network set_auto_parallel
self _network self _predict_network
_VirtualDatasetCell self _network self _predict_network
self _predict_network set_auto_parallel
self _metric_fns values metric
metric clear
isinstance outputs|tuple
len outputs
metric update |outputs
isinstance metric|Loss
metric update outputs[self _eval_indexes]
metric update outputs[self _eval_indexes]|outputs[self _eval_indexes]
dict metrics
self _metric_fns items key|value
value eval metrics key
self _loss_scale_manager get_loss_scale scaling_sens
DatasetHelper dataset|dataset_sink_mode|sink_size|epoch_num|iter_first_order dataset_helper
connect_network_with_dataset network|dataset_helper network
network set_train is_train
phase network phase
get_train_dataset train_dataset
get_valid_dataset valid_dataset
Model net|loss_fn model
model init train_dataset|valid_dataset
model train 2|train_dataset
model eval valid_dataset
_device_number_check self _parallel_mode|self _device_number
_parameter_broadcast_check self _parallel_mode|self _parameter_broadcast
self _train_network set_train
self _train_network set_broadcast_flag
train_dataset dataset
train_network self _train_network
train_dataset_helper inputs
self _train_network compile |inputs
self _eval_network set_train False
valid_dataset dataset
valid_dataset_helper inputs
self _eval_network compile |inputs
Validator check_positive_int epoch epoch
_InternalCallbackParam cb_params
self _train_network cb_params train_network
epoch cb_params epoch_num
sink_size cb_params batch_num
train_dataset get_dataset_size cb_params batch_num
self _loss_fn cb_params loss_fn
self _optimizer cb_params optimizer
self _parallel_mode cb_params parallel_mode
self _device_number cb_params device_number
train_dataset cb_params train_dataset
self _transform_callbacks callbacks cb_params list_callback
self _network cb_params network
_CallbackManager callbacks
self _train_process epoch|train_dataset|list_callback|cb_params
self _train_dataset_sink_process epoch|train_dataset|list_callback|cb_params|sink_size
isinstance callbacks|Iterable
list callbacks
epoch epoch_num
math ceil epoch|sink_size|train_dataset get_dataset_size epoch_num
self _frequency-1 iter_first_order
iter_second_order train_dataset __loop_size__
RunContext cb_params run_context
list_callback begin run_context
range i
i|1 cb_params cur_epoch_num
list_callback epoch_begin run_context
dataset_helper inputs
_to_full_tensor inputs|self _device_number|self _global_rank inputs
inputs cb_params train_dataset_element
list_callback step_begin run_context
dataset_helper sink_size cb_params cur_step_num
iter_first_order cb_params cur_step_num
self _train_network |inputs outputs
outputs cb_params net_outputs
list_callback step_end run_context
list_callback epoch_end run_context
dataset_helper stop_send
list_callback end run_context
dataset_helper next_element
len next_element len_element
self _loss_scale_manager get_drop_overflow_update
self _get_scaling_sens scaling_sens
tuple next_element|(Tensor(scaling_sens|mstype float32)) next_element
next_element cb_params train_dataset_element
self _train_network |next_element outputs
outputs _
np all overflow asnumpy overflow
self _loss_scale_manager update_loss_scale overflow
train_dataset reset
-1|sinkthecompletedataseteachepoch  sink_size
FixedLossScaleManager loss_scale_manager
Validator check_bool dataset_sink_mode dataset_sink_mode
Validator check_is_int sink_size
ValueError  format sink_size
testmode  themodel
self _eval_network cb_params eval_network
self _eval_network |inputs outputs
self _update_metrics outputs
self _get_metrics metrics
metrics cb_params metrics
self _eval_network |next_element outputs
valid_dataset reset
model eval dataset
valid_dataset cb_params valid_dataset
valid_dataset get_dataset_size cb_params batch_num
self _clear_metrics
self _eval_dataset_sink_process valid_dataset|list_callback|cb_params
self _eval_process valid_dataset|list_callback|cb_params
array s
Tensor np random randint 0|255|[1|3|224|224] input_data
Model Net model
model predict input_data
self _predict_network set_train False
Tensor data_class
self _predict_network |predict_data result
check_output_data result
__init__ self conv x x
__init__ self bn x x
__init__ self relu x x
__init__ self flatten x x
__init__ self fc x out
__init__ self _check_kwargs kwargs
__init__ self _process_amp_args kwargs
__init__ self _build_train_network self _train_network
__init__ self _build_eval_network metrics|eval_network|eval_indexes
__init__ self _build_predict_network
__init__ self _network network
__init__ self _amp_level level
__init__ self _loss_scale_manager loss_scale_manager
__init__ self _eval_network set_auto_parallel
__init__ self _network self _predict_network
__init__ self _predict_network set_auto_parallel
__init__ self _metric_fns values metric
__init__ self _metric_fns items key|value
__init__ self _loss_scale_manager get_loss_scale scaling_sens
__init__ self _train_network set_train
__init__ self _train_network set_broadcast_flag
__init__ self _train_network compile |inputs
__init__ self _eval_network set_train False
__init__ self _eval_network compile |inputs
__init__ self _train_network cb_params train_network
__init__ self _loss_fn cb_params loss_fn
__init__ self _optimizer cb_params optimizer
__init__ self _parallel_mode cb_params parallel_mode
__init__ self _device_number cb_params device_number
__init__ self _transform_callbacks callbacks cb_params list_callback
__init__ self _network cb_params network
__init__ self _train_process epoch|train_dataset|list_callback|cb_params
__init__ self _train_dataset_sink_process epoch|train_dataset|list_callback|cb_params|sink_size
__init__ self _frequency-1 iter_first_order
__init__ self _train_network |inputs outputs
__init__ self _loss_scale_manager get_drop_overflow_update
__init__ self _get_scaling_sens scaling_sens
__init__ self _train_network |next_element outputs
__init__ self _loss_scale_manager update_loss_scale overflow
__init__ self _eval_network cb_params eval_network
__init__ self _eval_network |inputs outputs
__init__ self _update_metrics outputs
__init__ self _get_metrics metrics
__init__ self _eval_network |next_element outputs
__init__ self _clear_metrics
__init__ self _eval_dataset_sink_process valid_dataset|list_callback|cb_params
__init__ self _eval_process valid_dataset|list_callback|cb_params
__init__ self _predict_network set_train False
__init__ self _predict_network |predict_data result
construct self conv x x
construct self bn x x
construct self relu x x
construct self flatten x x
construct self fc x out
construct self _check_kwargs kwargs
construct self _process_amp_args kwargs
construct self _build_train_network self _train_network
construct self _build_eval_network metrics|eval_network|eval_indexes
construct self _build_predict_network
construct self _network network
construct self _amp_level level
construct self _loss_scale_manager loss_scale_manager
construct self _eval_network set_auto_parallel
construct self _network self _predict_network
construct self _predict_network set_auto_parallel
construct self _metric_fns values metric
construct self _metric_fns items key|value
construct self _loss_scale_manager get_loss_scale scaling_sens
construct self _train_network set_train
construct self _train_network set_broadcast_flag
construct self _train_network compile |inputs
construct self _eval_network set_train False
construct self _eval_network compile |inputs
construct self _train_network cb_params train_network
construct self _loss_fn cb_params loss_fn
construct self _optimizer cb_params optimizer
construct self _parallel_mode cb_params parallel_mode
construct self _device_number cb_params device_number
construct self _transform_callbacks callbacks cb_params list_callback
construct self _network cb_params network
construct self _train_process epoch|train_dataset|list_callback|cb_params
construct self _train_dataset_sink_process epoch|train_dataset|list_callback|cb_params|sink_size
construct self _frequency-1 iter_first_order
construct self _train_network |inputs outputs
construct self _loss_scale_manager get_drop_overflow_update
construct self _get_scaling_sens scaling_sens
construct self _train_network |next_element outputs
construct self _loss_scale_manager update_loss_scale overflow
construct self _eval_network cb_params eval_network
construct self _eval_network |inputs outputs
construct self _update_metrics outputs
construct self _get_metrics metrics
construct self _eval_network |next_element outputs
construct self _clear_metrics
construct self _eval_dataset_sink_process valid_dataset|list_callback|cb_params
construct self _eval_process valid_dataset|list_callback|cb_params
construct self _predict_network set_train False
construct self _predict_network |predict_data result
Net net model
self _check_kwargs kwargs self _keep_bn_fp32
self _check_kwargs kwargs self _loss_scale_manager
self _check_kwargs kwargs arg
self _process_amp_args kwargs self _keep_bn_fp32
self _process_amp_args kwargs self _loss_scale_manager
self _process_amp_args kwargs arg
self _build_eval_network network set_auto_parallel
self _build_eval_network eval_network self _eval_network
self _build_eval_network eval_indexes self _eval_indexes
self _build_eval_network network set_train is_train
self _build_eval_network metrics cb_params metrics
self _network network set_auto_parallel
self _network network set_train is_train
nn WithLossCell network|self _loss_fn network set_auto_parallel
nn WithLossCell network|self _loss_fn network set_train is_train
self _metric_fns values metric clear
self _metric_fns values metric update |outputs
self _metric_fns values metric update outputs[self _eval_indexes]
self _metric_fns values metric update outputs[self _eval_indexes]|outputs[self _eval_indexes]
isinstance outputs cb_params net_outputs
isinstance tuple next_element|(Tensor(scaling_sens|mstype float32)) next_element
isinstance outputs _
len outputs cb_params net_outputs
len outputs _
metric update outputs cb_params net_outputs
metric update outputs _
isinstance metric update outputs[self _eval_indexes]
isinstance metric update outputs[self _eval_indexes]|outputs[self _eval_indexes]
dict metrics cb_params metrics
self _metric_fns items value eval metrics key
DatasetHelper dataset|dataset_sink_mode|sink_size|epoch_num|iter_first_order dataset_helper inputs
DatasetHelper dataset|dataset_sink_mode|sink_size|epoch_num|iter_first_order dataset_helper sink_size cb_params cur_step_num
DatasetHelper dataset|dataset_sink_mode|sink_size|epoch_num|iter_first_order dataset_helper stop_send
DatasetHelper dataset|dataset_sink_mode|sink_size|epoch_num|iter_first_order dataset_helper next_element
connect_network_with_dataset network|dataset_helper network set_train is_train
get_train_dataset train_dataset dataset
get_train_dataset train_dataset get_dataset_size cb_params batch_num
get_train_dataset train_dataset cb_params train_dataset
get_train_dataset train_dataset reset
get_valid_dataset valid_dataset dataset
get_valid_dataset valid_dataset reset
get_valid_dataset valid_dataset cb_params valid_dataset
get_valid_dataset valid_dataset get_dataset_size cb_params batch_num
Model net|loss_fn model init train_dataset|valid_dataset
Model net|loss_fn model train 2|train_dataset
Model net|loss_fn model eval valid_dataset
Model net|loss_fn model eval dataset
Model net|loss_fn model predict input_data
model init train_dataset dataset
model init valid_dataset dataset
model init train_dataset get_dataset_size cb_params batch_num
model init train_dataset cb_params train_dataset
model init train_dataset reset
model init valid_dataset reset
model init valid_dataset cb_params valid_dataset
model init valid_dataset get_dataset_size cb_params batch_num
model train train_dataset dataset
model train train_dataset get_dataset_size cb_params batch_num
model train train_dataset cb_params train_dataset
model train train_dataset reset
model eval valid_dataset dataset
model eval valid_dataset reset
model eval valid_dataset cb_params valid_dataset
model eval valid_dataset get_dataset_size cb_params batch_num
train_dataset_helper inputs cb_params train_dataset_element
self _train_network compile inputs cb_params train_dataset_element
valid_dataset_helper inputs cb_params train_dataset_element
self _eval_network compile inputs cb_params train_dataset_element
Validator check_positive_int epoch epoch cb_params epoch_num
Validator check_positive_int epoch epoch epoch_num
self _transform_callbacks callbacks cb_params list_callback begin run_context
self _transform_callbacks callbacks cb_params list_callback epoch_begin run_context
self _transform_callbacks callbacks cb_params list_callback step_begin run_context
self _transform_callbacks callbacks cb_params list_callback step_end run_context
self _transform_callbacks callbacks cb_params list_callback epoch_end run_context
self _transform_callbacks callbacks cb_params list_callback end run_context
self _train_process list callbacks
self _train_process epoch epoch_num
self _train_process list_callback begin run_context
self _train_process list_callback epoch_begin run_context
self _train_process list_callback step_begin run_context
self _train_process list_callback step_end run_context
self _train_process list_callback epoch_end run_context
self _train_process list_callback end run_context
self _train_process train_dataset reset
self _train_dataset_sink_process list callbacks
self _train_dataset_sink_process epoch epoch_num
self _train_dataset_sink_process list_callback begin run_context
self _train_dataset_sink_process list_callback epoch_begin run_context
self _train_dataset_sink_process list_callback step_begin run_context
self _train_dataset_sink_process list_callback step_end run_context
self _train_dataset_sink_process list_callback epoch_end run_context
self _train_dataset_sink_process list_callback end run_context
self _train_dataset_sink_process train_dataset reset
self _frequency-1 iter_first_order cb_params cur_step_num
range i cb_params cur_epoch_num
dataset_helper inputs cb_params train_dataset_element
_to_full_tensor inputs|self _device_number|self _global_rank inputs cb_params train_dataset_element
self _train_network |inputs outputs cb_params net_outputs
self _train_network |inputs outputs _
dataset_helper next_element cb_params train_dataset_element
tuple next_element|(Tensor(scaling_sens|mstype float32)) next_element cb_params train_dataset_element
self _train_network |next_element outputs _
self _get_metrics metrics cb_params metrics
Model Net model predict input_data
C MultitypeFuncGraph momentum_opt
momentum_opt register
F depend success|opt(weight|moment|learning_rate|gradient|momentum) success
P AddN op_add
C MultitypeFuncGraph apply_decay
apply_decay register
op_add (weight|weight_decay|gradient)
super THOR|self __init__ learning_rate|params|weight_decay|loss_scale
isinstance momentum|float
ValueError  format momentum
Parameter Tensor momentum|mstype float32 self momentum
self parameters self params
C HyperMap self hyper_map
P ApplyMomentum self opt
ParameterTuple matrix_A self matrix_A
ParameterTuple matrix_G self matrix_G
P MatMul self matmul
P Transpose self transpose
P Shape self shape
P Reshape self reshape
P Mul self mul
P GatherV2 self gather
num_hidden_layers self num_hidden_layers
P Sqrt self sqrt
P Assign self assign
P Cast self cast
weight_decay|loss_scale self weight_decay
P ExpandDims self expand
P Square self square
P Inv self inv
batch_size self batch_size
damping self damping
Tensor 1|mstype int32 self one
self params params
self moments moments
range em_idx
gradients em_idx g
em_idx matrix_idx
self matrix_A matrix_idx temp_a_ori
self matrix_G matrix_idx temp_g
F depend temp_a_ori|g temp_a_ori
F depend temp_g|g temp_g
self expand temp_a_ori|1 temp_a
self cast temp_a|mstype float16 temp_a
self cast temp_g|mstype float16 temp_g
self cast g|mstype float16 g
self mul temp_a|g g
self matmul g|temp_g g
self cast g|mstype float32 g
self assign self matrix_A matrix_idx fake_A
self assign self matrix_G matrix_idx fake_G
F depend g|fake_A g
F depend g|fake_G g
new_grads|(g|) new_grads
gradients grad_idx beta_grad
gradients gamma_grad
self batch_size normalizer
self cast normalizer|mstype float32 normalizer
self gather self damping|self cov_step|0 damping_step
self cast damping_step|mstype float32 damping_step
self cov_step|self one self cov_step
self sqrt damping_step damping
self square beta_grad beta
self mul beta|1 0|normalizer beta_cov
beta_cov|damping beta_cov
self inv beta_cov beta_inv
self square gamma_grad gamma
self mul gamma|1 0|normalizer gamma_cov
gamma_cov|damping gamma_cov
self inv gamma_cov gamma_inv
self mul beta_inv|beta_grad beta
self mul gamma_inv|gamma_grad gamma
new_grads|(beta|gamma) new_grads
range i
encoder_layers_num|i|5 encoder_begin_idx
range j
encoder_begin_idx|j grad_idx
gradients grad_idx g
j||2 offset_idx
j||2-1 offset_idx
self matrix_A matrix_idx temp_a
F depend temp_a|g temp_a
self matmul temp_g|g g
self matmul g|temp_a g
new_grads|(gradients|) new_grads
encoder_layers_num|self num_hidden_layers|5 pooler_layer_idx
self num_hidden_layers|6|3 matrix_idx
gradients pooler_layer_idx g
gradients pooler_bias
new_grads|(g|pooler_bias) new_grads
encoder_layers_num|self num_hidden_layers|8 mlm_fc_idx
self num_hidden_layers|6|4 matrix_idx
gradients mlm_fc_idx g
gradients mlm_bias
new_grads|(gradients[mlm_fc_idx-1]|) new_grads
new_grads|(g|mlm_bias) new_grads
mlm_fc_idx|2 begin_idx
mlm_fc_idx|4 end_idx
new_grads|gradients new_grads
len gradients lenth
new_grads gradients
self expand temp_a|1 temp_a
self scale_grad gradients gradients
self get_lr lr
self hyper_map F partial momentum_opt|self opt|lr|self momentum success
C MultitypeFuncGraph momentum_opt register
P AddN op_add (weight|weight_decay|gradient)
C MultitypeFuncGraph apply_decay register
super THOR|self __init__ weight_decay|loss_scale self weight_decay
weight_decay|loss_scale self weight_decay self weight_decay
range em_idx matrix_idx
gradients em_idx g new_grads
gradients em_idx g new_grads
gradients em_idx g new_grads
gradients em_idx g new_grads
gradients em_idx g new_grads
self cast g|mstype float16 g new_grads
self cast g|mstype float16 g new_grads
self cast g|mstype float16 g new_grads
self cast g|mstype float16 g new_grads
self cast g|mstype float16 g new_grads
self mul temp_a|g g new_grads
self mul temp_a|g g new_grads
self mul temp_a|g g new_grads
self mul temp_a|g g new_grads
self mul temp_a|g g new_grads
self matmul g|temp_g g new_grads
self matmul g|temp_g g new_grads
self matmul g|temp_g g new_grads
self matmul g|temp_g g new_grads
self matmul g|temp_g g new_grads
self cast g|mstype float32 g new_grads
self cast g|mstype float32 g new_grads
self cast g|mstype float32 g new_grads
self cast g|mstype float32 g new_grads
self cast g|mstype float32 g new_grads
F depend g|fake_A g new_grads
F depend g|fake_A g new_grads
F depend g|fake_A g new_grads
F depend g|fake_A g new_grads
F depend g|fake_A g new_grads
F depend g|fake_G g new_grads
F depend g|fake_G g new_grads
F depend g|fake_G g new_grads
F depend g|fake_G g new_grads
F depend g|fake_G g new_grads
new_grads|(g|) new_grads new_grads
new_grads|(g|) new_grads new_grads
new_grads|(g|) new_grads new_grads
new_grads|(g|) new_grads new_grads
new_grads|(g|) new_grads new_grads
new_grads|(g|) new_grads new_grads
new_grads|(g|) new_grads new_grads
new_grads|(g|) new_grads gradients
self sqrt damping_step damping beta_cov
self sqrt damping_step damping gamma_cov
self square beta_grad beta new_grads
self mul beta|1 0|normalizer beta_cov beta_cov
beta_cov|damping beta_cov beta_cov
self square gamma_grad gamma new_grads
self mul gamma|1 0|normalizer gamma_cov gamma_cov
gamma_cov|damping gamma_cov gamma_cov
self mul beta_inv|beta_grad beta new_grads
self mul gamma_inv|gamma_grad gamma new_grads
new_grads|(beta|gamma) new_grads new_grads
new_grads|(beta|gamma) new_grads new_grads
new_grads|(beta|gamma) new_grads new_grads
new_grads|(beta|gamma) new_grads new_grads
new_grads|(beta|gamma) new_grads new_grads
new_grads|(beta|gamma) new_grads new_grads
new_grads|(beta|gamma) new_grads gradients
range i encoder_begin_idx
encoder_layers_num|i|5 encoder_begin_idx grad_idx
range j grad_idx
range j offset_idx
range j offset_idx
gradients grad_idx g new_grads
gradients grad_idx g new_grads
gradients grad_idx g new_grads
self matmul temp_g|g g new_grads
self matmul temp_g|g g new_grads
self matmul temp_g|g g new_grads
self matmul g|temp_a g new_grads
self matmul g|temp_a g new_grads
self matmul g|temp_a g new_grads
new_grads|(gradients|) new_grads new_grads
new_grads|(gradients|) new_grads new_grads
new_grads|(gradients|) new_grads new_grads
new_grads|(gradients|) new_grads new_grads
new_grads|(gradients|) new_grads new_grads
new_grads|(gradients|) new_grads gradients
gradients pooler_layer_idx g new_grads
gradients pooler_layer_idx g new_grads
gradients pooler_layer_idx g new_grads
gradients pooler_bias new_grads
new_grads|(g|pooler_bias) new_grads new_grads
new_grads|(g|pooler_bias) new_grads new_grads
new_grads|(g|pooler_bias) new_grads new_grads
new_grads|(g|pooler_bias) new_grads new_grads
new_grads|(g|pooler_bias) new_grads gradients
encoder_layers_num|self num_hidden_layers|8 mlm_fc_idx begin_idx
encoder_layers_num|self num_hidden_layers|8 mlm_fc_idx end_idx
gradients mlm_fc_idx g new_grads
gradients mlm_fc_idx g new_grads
gradients mlm_bias new_grads
new_grads|(gradients[mlm_fc_idx-1]|) new_grads new_grads
new_grads|(gradients[mlm_fc_idx-1]|) new_grads new_grads
new_grads|(gradients[mlm_fc_idx-1]|) new_grads new_grads
new_grads|(gradients[mlm_fc_idx-1]|) new_grads gradients
new_grads|(g|mlm_bias) new_grads new_grads
new_grads|(g|mlm_bias) new_grads new_grads
new_grads|(g|mlm_bias) new_grads gradients
new_grads|gradients new_grads new_grads
new_grads|gradients new_grads gradients
get_bert_damping damping
cfg Thor loss_scale loss_scale
cfg Thor frequency frequency
cfg Thor batch_size batch_size
mstype float32 dtype
mstype float32 compute_type
batch_size self batch_size
seq_length self seq_length
vocab_size self vocab_size
hidden_size self hidden_size
num_hidden_layers self num_hidden_layers
num_attention_heads self num_attention_heads
hidden_act self hidden_act
intermediate_size self intermediate_size
hidden_dropout_prob self hidden_dropout_prob
attention_probs_dropout_prob self attention_probs_dropout_prob
max_position_embeddings self max_position_embeddings
type_vocab_size self type_vocab_size
initializer_range self initializer_range
input_mask_from_dataset self input_mask_from_dataset
token_type_ids_from_dataset self token_type_ids_from_dataset
use_relative_positions self use_relative_positions
dtype self dtype
compute_type self compute_type
enable_fused_layernorm self enable_fused_layernorm
super EmbeddingLookup|self __init__
use_one_hot_embeddings self use_one_hot_embeddings
P ExpandDims self expand
(-1|) self shape_flat
P GatherV2 self gather
P OneHot self one_hot
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
P MatMul self array_mul
P Reshape self reshape
tuple embedding_shape self shape
self expand input_ids|-1 extended_ids
self reshape extended_ids|self shape_flat flat_ids
self one_hot flat_ids|self vocab_size|self on_value|self off_value one_hot_ids
self array_mul output_for_reshape
self gather self embedding_table|flat_ids|0 output_for_reshape
self reshape output_for_reshape|self shape output
super EmbeddingPostprocessor|self __init__
use_token_type self use_token_type
token_type_vocab_size self token_type_vocab_size
Embedding_Thor self token_type_embedding
token_type_vocab_size vocab_size
Tensor 0 1|mstype float32 self off_value
nn Dropout 1-dropout_prob self dropout
P StridedSlice self slice
self shape width
[1|seq|width] position_embedding_shape
Embedding_Thor self full_position_embedding
max_position_embeddings vocab_size
position_embedding_shape embedding_shape
Tensor np arange seq reshape -1|seq astype(np int32) self position_ids
nn LayerNorm (embedding_size|) self layernorm
P TensorAdd self add
word_embeddings output
self token_type_embedding token_type_ids _
self add output|token_type_embeddings output
self full_position_embedding self position_ids _
self add output|position_embeddings output
self layernorm output output
self dropout output output
super BertOutput|self __init__
TruncatedNormal initializer_range weight_init
dropout_prob self dropout_prob
nn LayerNorm (out_channels|) to_float compute_type self layernorm
P Cast self cast
self dense hidden_status output
self add input_tensor|output output
super RelaPosMatrixGenerator|self __init__
length self _length
max_relative_position self _max_relative_position
-max_relative_position self _min_relative_position
-length|1 self range_length
P Tile self tile
P Reshape self range_mat
P Sub self sub
P ExpandDims self expanddims
self cast F tuple_to_array F make_range self _length range_vec_row_out
self range_mat range_vec_row_out|(self _length|-1) range_vec_col_out
self tile range_vec_row_out|(self _length|) tile_row_out
self tile range_vec_col_out|(1|self _length) tile_col_out
self range_mat tile_row_out|(self _length|self _length) range_mat_out
self range_mat tile_col_out|(self _length|self _length) transpose_out
self sub range_mat_out|transpose_out distance_mat
distance_mat_clipped|self _max_relative_position final_mat
super RelaPosEmbeddingsGenerator|self __init__
depth self depth
max_relative_position|2|1 self vocab_size
Parameter self embeddings_table
nn OneHot depth self one_hot
P Shape self shape
P BatchMatMul self matmul
self relative_positions_matrix relative_positions_matrix_out
self reshape relative_positions_matrix_out|(-1|) flat_relative_positions_matrix
self one_hot one_hot_relative_positions_matrix
self matmul one_hot_relative_positions_matrix|self embeddings_table embeddings
self shape relative_positions_matrix_out|(self depth|) my_shape
self reshape embeddings|my_shape embeddings
super SaturateCast|self __init__
mstype dtype_to_nptype dst_type np_type
float np finfo np_type min self tensor_min_type
float np finfo np_type max self tensor_max_type
P Minimum self min_op
P Maximum self max_op
dst_type self dst_type
self max_op x|self tensor_min_type out
self min_op out|self tensor_max_type out
self cast out|self dst_type
super BertAttention|self __init__
from_seq_length self from_seq_length
to_seq_length self to_seq_length
size_per_head self size_per_head
has_attention_mask self has_attention_mask
(-1|from_tensor_width) self shape_from_2d
(-1|to_tensor_width) self shape_to_2d
TruncatedNormal initializer_range weight
num_attention_heads|size_per_head units
units out_channels
weight weight_init
query_act activation
key_act activation
value_act activation
(batch_size|from_seq_length|num_attention_heads|size_per_head) self shape_from
P Mul self multiply
P Transpose self transpose
(0|2|1|3) self trans_shape
(2|0|1|3) self trans_shape_relative
(1|2|0|3) self trans_shape_position
-10000 0 self multiply_data
batch_size|num_attention_heads self batch_num
nn Softmax self softmax
nn Dropout 1-attention_probs_dropout_prob self dropout
P ExpandDims self expand_dims
P DType self get_dtype
(batch_size|from_seq_length|num_attention_heads|size_per_head) self shape_
SaturateCast dst_type self cast_compute_type
 self _generate_relative_positions_embeddings
size_per_head depth
self reshape from_tensor|self shape_from_2d from_tensor_2d
self reshape to_tensor|self shape_to_2d to_tensor_2d
self query_layer from_tensor_2d query_out
self key_layer to_tensor_2d key_out
self value_layer to_tensor_2d value_out
self reshape query_out|self shape_from query_layer
self transpose query_layer|self trans_shape query_layer
self reshape key_out|self shape_to key_layer
self transpose key_layer|self trans_shape key_layer
self matmul_trans_b query_layer|key_layer attention_scores
self _generate_relative_positions_embeddings relations_keys
self cast_compute_type relations_keys relations_keys
self transpose query_layer|self trans_shape_relative query_layer_t
attention_scores|key_position_scores_r_t attention_scores
self multiply self scores_mul|attention_scores attention_scores
self expand_dims attention_mask|1 attention_mask
self multiply multiply_out|self multiply_data adder
self add adder|attention_scores attention_scores
self softmax attention_scores attention_probs
self dropout attention_probs attention_probs
self reshape value_out|self shape_to value_layer
self transpose value_layer|self trans_shape value_layer
self matmul attention_probs|value_layer context_layer
self _generate_relative_positions_embeddings relations_values
self cast_compute_type relations_values relations_values
self transpose attention_probs|self trans_shape_relative attention_probs_t
self reshape attention_probs_r
context_layer|value_position_scores_r_t context_layer
self transpose context_layer|self trans_shape context_layer
self reshape context_layer|self shape_return context_layer
super BertSelfAttention|self __init__
int hidden_size|num_attention_heads self size_per_head
BertAttention self attention
hidden_size from_tensor_width
hidden_size to_tensor_width
seq_length from_seq_length
seq_length to_seq_length
self size_per_head size_per_head
hidden_size out_channels
hidden_dropout_prob dropout_prob
(-1|hidden_size) self shape
self reshape input_tensor|self shape input_tensor
self attention input_tensor|input_tensor|attention_mask attention_output
self output attention_output|input_tensor output
super BertEncoderCell|self __init__
BertSelfAttention self attention
intermediate_size out_channels
hidden_act activation
self attention hidden_states|attention_mask attention_output
self intermediate attention_output intermediate_output
self output intermediate_output|attention_output output
super BertTransformer|self __init__
return_all_encoders self return_all_encoders
range _
layers append layer
nn CellList layers self layers
(batch_size|seq_length|hidden_size) self out_shape
self reshape input_tensor|self shape prev_output
self layers layer_module
layer_module prev_output|attention_mask layer_output
layer_output prev_output
self reshape layer_output|self out_shape layer_output
all_encoder_layers|(layer_output|) all_encoder_layers
self reshape prev_output|self out_shape prev_output
all_encoder_layers|(prev_output|) all_encoder_layers
super CreateAttentionMaskFromInputMask|self __init__
config input_mask_from_dataset self input_mask_from_dataset
initializer self input_mask
(config batch_size|1|config seq_length) self shape
initializer self broadcast_ones
P BatchMatMul self batch_matmul
self input_mask input_mask
self cast self reshape input_mask|self shape attention_mask
super BertModel|self __init__
copy deepcopy config config
config token_type_ids_from_dataset self token_type_ids_from_dataset
config batch_size self batch_size
config seq_length self seq_length
config hidden_size self hidden_size
config num_hidden_layers self num_hidden_layers
config hidden_size self embedding_size
self num_hidden_layers-1 self last_idx
initializer self token_type_ids
Embedding_Thor self bert_embedding_lookup
config vocab_size vocab_size
self embedding_size embedding_size
output_embedding_shape embedding_shape
config initializer_range initializer_range
EmbeddingPostprocessor self bert_embedding_postprocessor
config use_relative_positions use_relative_positions
config type_vocab_size token_type_vocab_size
config max_position_embeddings max_position_embeddings
BertTransformer self bert_encoder
self batch_size batch_size
self hidden_size hidden_size
self seq_length seq_length
config num_attention_heads num_attention_heads
self num_hidden_layers num_hidden_layers
config intermediate_size intermediate_size
config attention_probs_dropout_prob attention_probs_dropout_prob
config hidden_dropout_prob hidden_dropout_prob
config hidden_act hidden_act
config compute_type compute_type
config dtype self dtype
self hidden_size out_channels
TruncatedNormal config initializer_range weight_init
CreateAttentionMaskFromInputMask config self _create_attention_mask_from_input_mask
self token_type_ids token_type_ids
self bert_embedding_lookup input_ids embedding_tables
self _create_attention_mask_from_input_mask input_mask attention_mask
self cast encoder_output self last_idx sequence_output
self squeeze_1 sequence_slice first_token
self dense first_token pooled_output
self cast pooled_output|self dtype pooled_output
cfg Thor batch_size batch_size self batch_size
cfg Thor batch_size batch_size self shape_from
cfg Thor batch_size batch_size self batch_num
cfg Thor batch_size batch_size self shape_
cfg Thor batch_size batch_size self out_shape
mstype float32 dtype self dtype
mstype float32 compute_type self compute_type
self reshape output_for_reshape|self shape output all_encoder_layers
self reshape output_for_reshape|self shape output all_encoder_layers
self shape width position_embedding_shape
[1|seq|width] position_embedding_shape embedding_shape
word_embeddings output all_encoder_layers
word_embeddings output all_encoder_layers
self add output|token_type_embeddings output all_encoder_layers
self add output|token_type_embeddings output all_encoder_layers
self add output|position_embeddings output all_encoder_layers
self add output|position_embeddings output all_encoder_layers
self layernorm output output all_encoder_layers
self layernorm output output all_encoder_layers
self dropout output output all_encoder_layers
self dropout output output all_encoder_layers
self dense hidden_status output all_encoder_layers
self dense hidden_status output all_encoder_layers
self add input_tensor|output output all_encoder_layers
self add input_tensor|output output all_encoder_layers
length self _length self shape_from
length self _length self shape_
length self _length self out_shape
TruncatedNormal initializer_range weight weight_init
num_attention_heads|size_per_head units out_channels
self matmul_trans_b query_layer|key_layer attention_scores attention_scores
attention_scores|key_position_scores_r_t attention_scores attention_scores
self matmul attention_probs|value_layer context_layer context_layer
context_layer|value_position_scores_r_t context_layer context_layer
self output attention_output|input_tensor output all_encoder_layers
self output attention_output|input_tensor output all_encoder_layers
self output intermediate_output|attention_output output all_encoder_layers
self output intermediate_output|attention_output output all_encoder_layers
nn CellList layers self layers all_encoder_layers
nn CellList layers self layers all_encoder_layers
self reshape input_tensor|self shape prev_output all_encoder_layers
self layers layer_module prev_output|attention_mask layer_output
layer_module prev_output|attention_mask layer_output prev_output
layer_module prev_output|attention_mask layer_output all_encoder_layers
layer_output prev_output all_encoder_layers
self reshape layer_output|self out_shape layer_output all_encoder_layers
all_encoder_layers|(layer_output|) all_encoder_layers all_encoder_layers
all_encoder_layers|(layer_output|) all_encoder_layers all_encoder_layers
self reshape prev_output|self out_shape prev_output all_encoder_layers
all_encoder_layers|(prev_output|) all_encoder_layers all_encoder_layers
copy deepcopy config config token_type_ids_from_dataset self token_type_ids_from_dataset
copy deepcopy config config batch_size self batch_size
copy deepcopy config config seq_length self seq_length
copy deepcopy config config hidden_size self hidden_size
copy deepcopy config config num_hidden_layers self num_hidden_layers
copy deepcopy config config hidden_size self embedding_size
copy deepcopy config config vocab_size vocab_size
copy deepcopy config config initializer_range initializer_range
copy deepcopy config config use_relative_positions use_relative_positions
copy deepcopy config config type_vocab_size token_type_vocab_size
copy deepcopy config config max_position_embeddings max_position_embeddings
copy deepcopy config config num_attention_heads num_attention_heads
copy deepcopy config config intermediate_size intermediate_size
copy deepcopy config config attention_probs_dropout_prob attention_probs_dropout_prob
copy deepcopy config config hidden_dropout_prob hidden_dropout_prob
copy deepcopy config config hidden_act hidden_act
copy deepcopy config config compute_type compute_type
copy deepcopy config config dtype self dtype
lr_init float
lr_end float
lr_max float
warmup_steps int
total_steps int
poly_power int
(float(lr_max)-float(lr_init))|float(warmup_steps) inc_each_step
range i
float lr_init|inc_each_step|float(i) lr
(1 0-(float(i)-float(warmup_steps))|(float(total_steps)-float(warmup_steps))) base
float lr_max-lr_end|(basepoly_power) lr
lr|lr_end lr
lr_each_step append lr
np array lr_each_step astype np float32 learning_rate
global_step current_step
Tensor learning_rate
Tensor damping
lr_init float inc_each_step
lr_init float lr_init|inc_each_step|float(i) lr
lr_init float lr_max-lr_end|(basepoly_power) lr
lr_end float inc_each_step
lr_end float lr_init|inc_each_step|float(i) lr
lr_end float lr_max-lr_end|(basepoly_power) lr
lr_max float inc_each_step
lr_max float lr_init|inc_each_step|float(i) lr
lr_max float lr_max-lr_end|(basepoly_power) lr
float lr_init|inc_each_step|float(i) lr lr
float lr_max-lr_end|(basepoly_power) lr lr
lr|lr_end lr lr
os listdir data_dir files
files file_name
data_files append os path join data_dir|file_name
sorted data_files data_files
ds get_dataset_size ori_dataset_size
print ori_dataset_size
C TypeCast mstype int32 type_cast_op
logger info  format ds get_dataset_size
logger info  format ds get_repeat_count
C TypeCast mstype float32 type_cast_op_float
ds repeat repeat_count ds
ds shuffle buffer_size ds
os listdir data_dir files file_name
hasattr dataset|
dataset __transfer_dataset__ exec_dataset
exec_dataset send epoch_num
differentcontext  loop
-1|sinkthecompletedataseteachepoch  sink_size
DatasetHelper dataset dataset_helper
dataset_helper inputs
network |inputs outputs
Validator check_bool dataset_sink_mode dataset_sink_mode
Validator check_is_int sink_size
ValueError  format sink_size
context get_context
_DatasetIterGE iterclass
_DatasetIterMSLoopSink iterclass
os getenv ms_role
_DatasetIterPSLite iterclass
_DatasetIterMS iterclass
iterclass dataset|sink_size|epoch_num|iter_first_order self iter
_DatasetIterNormal iterclass
iterclass dataset self iter
self iter __iter__
self iter types_shapes
self iter get_sink_size
self iter stop_send
dataset self dataset
sink_size self sink_size
dataset __loop_size__ self sink_size
_exec_datagraph dataset|self sink_size dataset __transfer_dataset__
_send_data dataset|epoch_num
_send_data_no_flag dataset|epoch_num
dataset __transfer_dataset__ stop_send self stop_send
_get_types_and_shapes dataset self dataset_shapes
self op
dataset __loop_size__|iter_first_order loop_size
int sink_size|loop_size|2 sink_count
hasattr self dataset|
self dataset __loop_size__ sink_size
self sink_size sink_size
self dataset get_dataset_size sink_size
super __init__ dataset|sink_size|epoch_num
self get_sink_count dataset|sink_size|iter_first_order self sink_count
_get_device_num device_num
_to_full_shapes self dataset_shapes|device_num self dataset_shapes
op self op
hasattr dataset __transfer_dataset__ exec_dataset
hasattr dataset self dataset
hasattr dataset __loop_size__ self sink_size
hasattr dataset __transfer_dataset__ stop_send self stop_send
hasattr dataset __loop_size__|iter_first_order loop_size
dataset __transfer_dataset__ exec_dataset send epoch_num
-1|sinkthecompletedataseteachepoch  sink_size self sink_size
DatasetHelper dataset dataset_helper inputs
Validator check_is_int sink_size self sink_size
ValueError  format sink_size self sink_size
_DatasetIterGE iterclass dataset|sink_size|epoch_num|iter_first_order self iter
_DatasetIterGE iterclass dataset self iter
_DatasetIterMSLoopSink iterclass dataset|sink_size|epoch_num|iter_first_order self iter
_DatasetIterMSLoopSink iterclass dataset self iter
_DatasetIterPSLite iterclass dataset|sink_size|epoch_num|iter_first_order self iter
_DatasetIterPSLite iterclass dataset self iter
_DatasetIterMS iterclass dataset|sink_size|epoch_num|iter_first_order self iter
_DatasetIterMS iterclass dataset self iter
_DatasetIterNormal iterclass dataset self iter
_send_data dataset __transfer_dataset__ stop_send self stop_send
_send_data dataset __loop_size__|iter_first_order loop_size
_send_data_no_flag dataset __transfer_dataset__ stop_send self stop_send
_send_data_no_flag dataset __loop_size__|iter_first_order loop_size
self op self op
super CrossEntropyCalculation|self __init__
P OneHot self onehot
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
P ReduceSum self reduce_sum
P ReduceMean self reduce_mean
P Reshape self reshape
(-1|) self last_idx
P Neg self neg
P Cast self cast
is_training self is_training
self reshape label_ids|self last_idx label_ids
self onehot label_ids|num_labels|self on_value|self off_value one_hot_labels
self neg self reduce_sum one_hot_labels|logits|self last_idx per_example_loss
self reduce_mean per_example_loss|self last_idx loss
self cast loss|mstype float32 return_value
logits|1 0 return_value
logger error path
os path realpath path path
logger debug path
os path exists path
path real_path
super LossCallBack|self __init__
isinstance per_print_times|int
per_print_times self _per_print_times
time time self step_start_time
run_context original_args cb_params
time time-self step_start_time step_time_span
step_time_span total_time_span
cb_params cur_step_num cur_step_num
step_time_span|(cfg Thor frequency-1) step_time_span
os listdir load_finetune_checkpoint_dir files
len prefix pre_len
files filename
os path splitext filename name_ext
filename find index
os path join load_finetune_checkpoint_dir|filename load_finetune_checkpoint_path
name_ext split name_split
filename num
int num
int num max_num
super BertLearningRate|self __init__
WarmUpLR learning_rate|warmup_steps self warmup_lr
PolynomialDecayLR learning_rate|end_learning_rate|decay_steps|power self decay_lr
Tensor np array [warmup_steps] astype np float32 self warmup_steps
P Greater self greater
Tensor np array astype np float32 self one
self cast self greater self warmup_steps|global_step is_warmup
self warmup_lr global_step warmup_lr
self decay_lr global_step decay_lr
(self one-is_warmup)|decay_lr|is_warmup|warmup_lr lr
logger error path real_path
os path realpath path path real_path
logger debug path real_path
os path exists path real_path
isinstance per_print_times self _per_print_times
isinstance int num
isinstance int num max_num
run_context original_args cb_params cur_step_num cur_step_num
time time-self step_start_time step_time_span total_time_span
time time-self step_start_time step_time_span Thor frequency-1) step_time_span
step_time_span|(cfg Thor frequency-1) step_time_span Thor frequency-1) step_time_span
os listdir load_finetune_checkpoint_dir files filename
files filename find index
files filename num
os path splitext filename name_ext split name_split
C MultitypeFuncGraph momentum_opt
momentum_opt register
F depend success|opt(weight|moment|learning_rate|gradient|momentum) success
P AddN op_add
C MultitypeFuncGraph apply_decay
apply_decay register
op_add (weight|weight_decay|gradient)
super THOR|self __init__ learning_rate|params|weight_decay|loss_scale
isinstance momentum|float
ValueError  format momentum
Parameter Tensor momentum|mstype float32 self momentum
self parameters self params
C HyperMap self hyper_map
P ApplyMomentum self opt
ParameterTuple matrix_A self matrix_A
ParameterTuple matrix_G self matrix_G
P MatMul self matmul
P Transpose self transpose
P Shape self shape
P Reshape self reshape
P Mul self mul
P GatherV2 self gather
num_hidden_layers self num_hidden_layers
P Sqrt self sqrt
P Assign self assign
P Cast self cast
weight_decay|loss_scale self weight_decay
P ExpandDims self expand
P Square self square
P Inv self inv
batch_size self batch_size
damping self damping
Tensor 1|mstype int32 self one
_get_gradients_mean mean
_get_device_num degree
DistributedGradReducerThor self parameters|3|mean|degree self grad_reducer_g
self params params
self moments moments
range em_idx
gradients em_idx g
em_idx matrix_idx
self matrix_A matrix_idx temp_a_ori
self matrix_G matrix_idx temp_g
F depend temp_a_ori|g temp_a_ori
F depend temp_g|g temp_g
self expand temp_a_ori|1 temp_a
self cast temp_a|mstype float16 temp_a
self cast temp_g|mstype float16 temp_g
self cast g|mstype float16 g
self mul temp_a|g g
self matmul g|temp_g g
self cast g|mstype float32 g
self assign self matrix_A matrix_idx fake_A
self assign self matrix_G matrix_idx fake_G
F depend g|fake_A g
F depend g|fake_G g
new_grads|(g|) new_grads
gradients grad_idx beta_grad
gradients gamma_grad
self batch_size normalizer
self cast normalizer|mstype float32 normalizer
self gather self damping|self cov_step|0 damping_step
self cast damping_step|mstype float32 damping_step
self cov_step|self one self cov_step
self sqrt damping_step damping
self square beta_grad beta
self mul beta|1 0|normalizer beta_cov
beta_cov|damping beta_cov
self inv beta_cov beta_inv
self square gamma_grad gamma
self mul gamma|1 0|normalizer gamma_cov
gamma_cov|damping gamma_cov
self inv gamma_cov gamma_inv
self mul beta_inv|beta_grad beta
self mul gamma_inv|gamma_grad gamma
new_grads|(beta|gamma) new_grads
range i
encoder_layers_num|i|5 encoder_begin_idx
range j
encoder_begin_idx|j grad_idx
gradients grad_idx g
j||2 offset_idx
j||2-1 offset_idx
self matrix_A matrix_idx temp_a
F depend temp_a|g temp_a
self matmul temp_g|g g
self matmul g|temp_a g
new_grads|(gradients|) new_grads
encoder_layers_num|self num_hidden_layers|5 pooler_layer_idx
self num_hidden_layers|6|3 matrix_idx
gradients pooler_layer_idx g
gradients pooler_bias
new_grads|(g|pooler_bias) new_grads
encoder_layers_num|self num_hidden_layers|8 mlm_fc_idx
self num_hidden_layers|6|4 matrix_idx
gradients mlm_fc_idx g
gradients mlm_bias
new_grads|(gradients[mlm_fc_idx-1]|) new_grads
new_grads|(g|mlm_bias) new_grads
mlm_fc_idx|2 begin_idx
mlm_fc_idx|4 end_idx
new_grads|gradients new_grads
len gradients lenth
new_grads gradients
self grad_reducer_g gradients gradients
self expand temp_a|1 temp_a
self scale_grad gradients gradients
self get_lr lr
self hyper_map F partial momentum_opt|self opt|lr|self momentum success
C MultitypeFuncGraph momentum_opt register
P AddN op_add (weight|weight_decay|gradient)
C MultitypeFuncGraph apply_decay register
super THOR|self __init__ weight_decay|loss_scale self weight_decay
weight_decay|loss_scale self weight_decay self weight_decay
range em_idx matrix_idx
gradients em_idx g new_grads
gradients em_idx g new_grads
gradients em_idx g new_grads
gradients em_idx g new_grads
gradients em_idx g new_grads
self cast g|mstype float16 g new_grads
self cast g|mstype float16 g new_grads
self cast g|mstype float16 g new_grads
self cast g|mstype float16 g new_grads
self cast g|mstype float16 g new_grads
self mul temp_a|g g new_grads
self mul temp_a|g g new_grads
self mul temp_a|g g new_grads
self mul temp_a|g g new_grads
self mul temp_a|g g new_grads
self matmul g|temp_g g new_grads
self matmul g|temp_g g new_grads
self matmul g|temp_g g new_grads
self matmul g|temp_g g new_grads
self matmul g|temp_g g new_grads
self cast g|mstype float32 g new_grads
self cast g|mstype float32 g new_grads
self cast g|mstype float32 g new_grads
self cast g|mstype float32 g new_grads
self cast g|mstype float32 g new_grads
F depend g|fake_A g new_grads
F depend g|fake_A g new_grads
F depend g|fake_A g new_grads
F depend g|fake_A g new_grads
F depend g|fake_A g new_grads
F depend g|fake_G g new_grads
F depend g|fake_G g new_grads
F depend g|fake_G g new_grads
F depend g|fake_G g new_grads
F depend g|fake_G g new_grads
new_grads|(g|) new_grads new_grads
new_grads|(g|) new_grads new_grads
new_grads|(g|) new_grads new_grads
new_grads|(g|) new_grads new_grads
new_grads|(g|) new_grads new_grads
new_grads|(g|) new_grads new_grads
new_grads|(g|) new_grads new_grads
new_grads|(g|) new_grads gradients
self sqrt damping_step damping beta_cov
self sqrt damping_step damping gamma_cov
self square beta_grad beta new_grads
self mul beta|1 0|normalizer beta_cov beta_cov
beta_cov|damping beta_cov beta_cov
self square gamma_grad gamma new_grads
self mul gamma|1 0|normalizer gamma_cov gamma_cov
gamma_cov|damping gamma_cov gamma_cov
self mul beta_inv|beta_grad beta new_grads
self mul gamma_inv|gamma_grad gamma new_grads
new_grads|(beta|gamma) new_grads new_grads
new_grads|(beta|gamma) new_grads new_grads
new_grads|(beta|gamma) new_grads new_grads
new_grads|(beta|gamma) new_grads new_grads
new_grads|(beta|gamma) new_grads new_grads
new_grads|(beta|gamma) new_grads new_grads
new_grads|(beta|gamma) new_grads gradients
range i encoder_begin_idx
encoder_layers_num|i|5 encoder_begin_idx grad_idx
range j grad_idx
range j offset_idx
range j offset_idx
gradients grad_idx g new_grads
gradients grad_idx g new_grads
gradients grad_idx g new_grads
self matmul temp_g|g g new_grads
self matmul temp_g|g g new_grads
self matmul temp_g|g g new_grads
self matmul g|temp_a g new_grads
self matmul g|temp_a g new_grads
self matmul g|temp_a g new_grads
new_grads|(gradients|) new_grads new_grads
new_grads|(gradients|) new_grads new_grads
new_grads|(gradients|) new_grads new_grads
new_grads|(gradients|) new_grads new_grads
new_grads|(gradients|) new_grads new_grads
new_grads|(gradients|) new_grads gradients
gradients pooler_layer_idx g new_grads
gradients pooler_layer_idx g new_grads
gradients pooler_layer_idx g new_grads
gradients pooler_bias new_grads
new_grads|(g|pooler_bias) new_grads new_grads
new_grads|(g|pooler_bias) new_grads new_grads
new_grads|(g|pooler_bias) new_grads new_grads
new_grads|(g|pooler_bias) new_grads new_grads
new_grads|(g|pooler_bias) new_grads gradients
encoder_layers_num|self num_hidden_layers|8 mlm_fc_idx begin_idx
encoder_layers_num|self num_hidden_layers|8 mlm_fc_idx end_idx
gradients mlm_fc_idx g new_grads
gradients mlm_fc_idx g new_grads
gradients mlm_bias new_grads
new_grads|(gradients[mlm_fc_idx-1]|) new_grads new_grads
new_grads|(gradients[mlm_fc_idx-1]|) new_grads new_grads
new_grads|(gradients[mlm_fc_idx-1]|) new_grads new_grads
new_grads|(gradients[mlm_fc_idx-1]|) new_grads gradients
new_grads|(g|mlm_bias) new_grads new_grads
new_grads|(g|mlm_bias) new_grads new_grads
new_grads|(g|mlm_bias) new_grads gradients
new_grads|gradients new_grads new_grads
new_grads|gradients new_grads gradients
base thebaseversionofBERTmodel
BertConfig bert_net_cfg
cfg Thor batch_size batch_size
mstype float32 dtype
mstype float16 compute_type
super Embedding_Thor|self __init__
vocab_size self vocab_size
use_one_hot_embeddings self use_one_hot_embeddings
P ExpandDims self expand
(-1|) self shape_flat
P GatherV2 self gather
P OneHot self one_hot
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
P MatMul self array_mul
P Reshape self reshape
tuple embedding_shape self em_shape
P Shape self shape
Tensor 1|loss_scale|mstype float16 self loss_scale
Tensor np zeros [embedding_size|embedding_size] astype(np float16) self fake_G
Tensor np ones [vocab_size] astype np float32 self dampingA
Tensor np identity embedding_size self dampingG
Tensor frequency|mstype int32 self freq
damping self damping
P Sqrt self sqrt
P Mul self mul
P Cast self cast
P CusBatchMatMul self vector_matmul
P CusCholeskyTrsm self cholesky
P CusMatrixCombine self matrix_combine
P Inv self inv
P InsertGradientOf self save_gradient self getG
batch_size self batch_size
self batch_size bs
self cast bs|mstype float32 bs
dout out
self mul dout|self loss_scale dout
self mul dout|bs dout
self shape dout shape
self cast shape|mstype float32 normalizer
self cube_matmul dout|dout matrix_G
self mul matrix_G|1 0|normalizer matrix_G
self gather self damping|self cov_step|0 damping_step
self cast damping_step|mstype float32 damping_step
self cov_step|self freq self cov_step
self sqrt damping_step damping
self cast self dampingG|mstype float32 dampingG
matrix_G|damping|dampingG matrix_G
self cholesky matrix_G matrix_G_inv
self vector_matmul matrix_G_inv|matrix_G_inv matrix_G_inv
self matrix_combine matrix_G_inv matrix_G_inv
self cast matrix_G_inv|mstype float16 matrix_G_inv
matrix_G_inv self matrix_G_inv
self reshape input_ids|self shape_flat flat_ids
self one_hot flat_ids|self vocab_size|self on_value|self off_value one_hot_ids
self array_mul one_hot_ids|self embedding_table output_for_reshape
self reduce_sum one_hot_ids|0 matrix_A
self batch_size normalizer
self cast normalizer|mstype float32 normalizer
self mul matrix_A|1 0|normalizer matrix_A
self gather self damping|self cov_step|self axis damping_step
self cast self dampingA|mstype float32 dampingA
matrix_A|damping|dampingA matrix_A
self inv matrix_A matrix_A_inv
self cast matrix_A_inv|mstype float16 matrix_A_inv
matrix_A_inv self matrix_A_inv
self fake_G self matrix_G_inv
self gather self embedding_table|flat_ids|0 output_for_reshape
self getG output_for_reshape output_for_reshape
self reshape output_for_reshape|self em_shape output
super Dense_Thor|self __init__
Validator check_positive_int in_channels self in_channels
Validator check_positive_int out_channels self out_channels
Validator check_bool has_bias self has_bias
isinstance weight_init|Tensor
Parameter initializer weight_init|[out_channels|in_channels] self weight
isinstance bias_init|Tensor
Parameter initializer bias_init|[out_channels] self bias
P BiasAdd self bias_add
get_activation activation self activation
Tensor np zeros [out_channels|out_channels] astype(np float16) self fake_G
P Transpose self transpose
P AssignAdd self assignadd
P Abs self abs
P Log self log
P Exp self exp
Tensor np identity in_channels self dampingA
Tensor np identity out_channels self dampingG
self cast self batch_size|mstype float32 bs
self cube_matmul x|x inputs
self shape x shape
self mul inputs|1 0|normalizer matrix_A
self cholesky matrix_A matrix_A_inv
self vector_matmul matrix_A_inv|matrix_A_inv matrix_A_inv
self matrix_combine matrix_A_inv matrix_A_inv
self matmul x|self weight output
self getG output output
self bias_add output|self bias output
self activation output
Tensor np ones [vocab_size] astype np float32 self dampingA matrix_A
Tensor np identity embedding_size self dampingG matrix_G
self cube_matmul dout|dout matrix_G matrix_G
self mul matrix_G|1 0|normalizer matrix_G matrix_G
self sqrt damping_step damping matrix_G
self sqrt damping_step damping matrix_A
self cast self dampingG|mstype float32 dampingG matrix_G
matrix_G|damping|dampingG matrix_G matrix_G
self cholesky matrix_G matrix_G_inv self matrix_G_inv
self vector_matmul matrix_G_inv|matrix_G_inv matrix_G_inv self matrix_G_inv
self matrix_combine matrix_G_inv matrix_G_inv self matrix_G_inv
self cast matrix_G_inv|mstype float16 matrix_G_inv self matrix_G_inv
self reduce_sum one_hot_ids|0 matrix_A matrix_A
self mul matrix_A|1 0|normalizer matrix_A matrix_A
self cast self dampingA|mstype float32 dampingA matrix_A
matrix_A|damping|dampingA matrix_A matrix_A
self inv matrix_A matrix_A_inv self matrix_A_inv
self cast matrix_A_inv|mstype float16 matrix_A_inv self matrix_A_inv
isinstance Tensor np zeros [out_channels|out_channels] astype(np float16) self fake_G
isinstance Tensor np identity in_channels self dampingA
isinstance Tensor np identity out_channels self dampingG
isinstance Tensor np zeros [out_channels|out_channels] astype(np float16) self fake_G
isinstance Tensor np identity in_channels self dampingA
isinstance Tensor np identity out_channels self dampingG
C MultitypeFuncGraph reduce_opt
AllReduce _all_reduce_G
AllReduce ReduceOp SUM|GlobalComm WORLD_COMM_GROUP _all_reduce_G
_all_reduce_G add_prim_attr group
reduce_opt register
F scalar_cast degree|F dtype grad degree
_all_reduce_G grad grad
P Cast cast_op
mul grad|cast_op F scalar_to_array 1 0|degree|F dtype grad
_all_reduce_G grad
C MultitypeFuncGraph _get_datatype
_get_datatype register
F dtype grad
C MultitypeFuncGraph _cast_datatype
_cast_datatype register
F cast grad|datatype
int os environ device_id
context reset_auto_parallel_context
context set_auto_parallel_context ParallelMode DATA_PARALLEL parallel_mode
TrainingWrapper nn Cell
network self network
ParameterTuple network trainable_params self weights
optimizer self optimizer
sens self sens
context get_auto_parallel_context self parallel_mode
context get_auto_parallel_context mean
mean get_device_num_is_set
context get_auto_parallel_context degree
get_group_size degree
nn DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
construct self|args
self weights weights
self network args loss
P Fill P DType loss sens
self grad self network|weights(args|sens) grads
self grad_reducer grads grads
F depend loss|self optimizer grads
Net network
TrainingWrapper network|optimizer train_cell
Tensor np ones [16|16] astype(np float32) inputs
Tensor np zeros [16|16] astype(np float32) label
train_cell inputs|label grads
C HyperMap self hyper_map
P Mul self mul
get_group_size self degree
degree self degree
mean self mean
_init_optimizer_allreduce group
self hyper_map F partial _get_datatype datatypes
self hyper_map F partial _cast_datatype|mstype float32 grads
self hyper_map F partial reduce_opt|self mul|self degree new_grad
self hyper_map F partial reduce_opt new_grad
self hyper_map F partial _cast_datatype new_grad
C MultitypeFuncGraph reduce_opt register
AllReduce _all_reduce_G add_prim_attr group
AllReduce _all_reduce_G grad grad
AllReduce _all_reduce_G grad
AllReduce ReduceOp SUM|GlobalComm WORLD_COMM_GROUP _all_reduce_G add_prim_attr group
AllReduce ReduceOp SUM|GlobalComm WORLD_COMM_GROUP _all_reduce_G grad grad
AllReduce ReduceOp SUM|GlobalComm WORLD_COMM_GROUP _all_reduce_G grad
F scalar_cast degree|F dtype grad degree self degree
C MultitypeFuncGraph _get_datatype register
C MultitypeFuncGraph _cast_datatype register
context get_auto_parallel_context mean get_device_num_is_set
context get_auto_parallel_context mean self mean
context get_auto_parallel_context degree self degree
get_group_size degree self degree
construct self weights weights
construct self network args loss
construct self grad self network|weights(args|sens) grads
construct self grad_reducer grads grads
construct self hyper_map F partial _get_datatype datatypes
construct self hyper_map F partial _cast_datatype|mstype float32 grads
construct self hyper_map F partial reduce_opt|self mul|self degree new_grad
construct self hyper_map F partial reduce_opt new_grad
construct self hyper_map F partial _cast_datatype new_grad
TrainingWrapper network|optimizer train_cell inputs|label grads
get_group_size self degree self degree
parser parse_args args_opt
context GRAPH_MODE mode|args_opt device_target device_target|args_opt device_id device_id context set_context
context GRAPH_MODE mode|args_opt device_target device_target context set_context
_init_optimizer_allreduce group
D init
args_opt device_num device_num
args_opt device_id%device_num rank
D get_group_size device_num
D get_rank rank
save_ckpt_dir||str(rank) save_ckpt_dir
context reset_auto_parallel_context
os path exists save_ckpt_dir
os makedirs save_ckpt_dir
logger warning
mstype float32 bert_student_net_cfg compute_type
args_opt load_teacher_ckpt_path teacher_ckpt
bert_student_net_cfg student_config
DataType TFRECORD dataset_type
DataType MINDRECORD dataset_type
dataset get_dataset_size dataset_size
print dataset_size
print dataset get_repeat_count
args_opt epoch_size|dataset_size||args_opt data_sink_steps repeat_count
args_opt data_sink_steps time_monitor_steps
args_opt epoch_size repeat_count
dataset_size time_monitor_steps
common_cfg AdamWeightDecay end_learning_rate end_learning_rate
int dataset_sizeargs_opt epoch_size|10 warmup_steps
int dataset_sizeargs_opt epoch_size decay_steps
netwithloss trainable_params params
list filter common_cfg AdamWeightDecay decay_filter|params decay_params
AdamWeightDecay group_params|learning_rate optimizer
common_cfg scale_factor scale_factor
BertTrainWithLossScaleCell netwithloss|optimizer netwithgrads
BertTrainCell netwithloss|optimizer netwithgrads
Model netwithgrads model
parser parse_args args_opt device_num device_num
parser parse_args args_opt device_id%device_num rank
parser parse_args args_opt load_teacher_ckpt_path teacher_ckpt
parser parse_args args_opt epoch_size|dataset_size||args_opt data_sink_steps repeat_count
parser parse_args args_opt data_sink_steps time_monitor_steps
parser parse_args args_opt epoch_size repeat_count
save_ckpt_dir||str(rank) save_ckpt_dir save_ckpt_dir
dataset get_dataset_size dataset_size time_monitor_steps
print dataset_size time_monitor_steps
netwithloss trainable_params params optimizer
AdamWeightDecay group_params|learning_rate optimizer netwithgrads
AdamWeightDecay group_params|learning_rate optimizer netwithgrads
BertConfig tinybert_student_net_cfg
mstype float32 dtype
mstype float16 compute_type
kwargs tinybert_student_net_cfg seq_length
kwargs get False is_training
TinyBertModel tinybert_student_net_cfg|is_training|args
NotImplementedError f
parser parse_args args
task_name self task_name
Task args task_name task
task seq_length td_student_net_cfg seq_length
DEFAULT_BS td_student_net_cfg batch_size
load_checkpoint args ckpt_file param_dict
param_dict items key|value
re sub key new_key
re sub new_key new_key
value new_param_dict new_key
load_param_into_net eval_model|new_param_dict
eval_model set_train False
Tensor np zeros (td_student_net_cfg batch_size|task seq_length) input_ids
Tensor np zeros (td_student_net_cfg batch_size|task seq_length) token_type_id
Tensor np zeros (td_student_net_cfg batch_size|task seq_length) input_mask
Task args task_name task seq_length td_student_net_cfg seq_length
load_checkpoint args ckpt_file param_dict items key|value
param_dict items value new_param_dict new_key
load_param_into_net eval_model set_train False
os getcwd _cur_dir
os path join _cur_dir td_phase1_save_ckpt_dir
os path join _cur_dir td_phase2_save_ckpt_dir
os path exists td_phase1_save_ckpt_dir
os makedirs td_phase1_save_ckpt_dir
os path exists td_phase2_save_ckpt_dir
os makedirs td_phase2_save_ckpt_dir
parser parse_args args
parse_args args_opt
task_name self task_name
Task args_opt task_name task
phase1_cfg cfg
context GRAPH_MODE mode|args_opt device_target device_target|args_opt device_id device_id context set_context
context GRAPH_MODE mode|args_opt device_target device_target context set_context
args_opt load_teacher_ckpt_path load_teacher_checkpoint_path
args_opt load_gd_ckpt_path load_student_checkpoint_path
td_student_net_cfg|student_ckpt student_config
DataType TFRECORD dataset_type
DataType MINDRECORD dataset_type
dataset get_dataset_size dataset_size
print dataset_size
print dataset get_repeat_count
args_opt td_phase1_epoch_size|dataset_size||args_opt data_sink_steps repeat_count
args_opt data_sink_steps time_monitor_steps
args_opt td_phase1_epoch_size repeat_count
dataset_size time_monitor_steps
cfg optimizer_cfg optimizer_cfg
optimizer_cfg AdamWeightDecay end_learning_rate end_learning_rate
int dataset_size|10 warmup_steps
int dataset_sizeargs_opt td_phase1_epoch_size decay_steps
netwithloss trainable_params params
list filter optimizer_cfg AdamWeightDecay decay_filter|params decay_params
AdamWeightDecay group_params|learning_rate optimizer
cfg scale_factor scale_factor
BertEvaluationWithLossScaleCell netwithloss|optimizer netwithgrads
BertEvaluationCell netwithloss|optimizer netwithgrads
Model netwithgrads model
phase2_cfg cfg
ckpt_file load_student_checkpoint_path
train_dataset get_dataset_size dataset_size
print train_dataset get_repeat_count
args_opt td_phase2_epoch_size|train_dataset get_dataset_size||args_opt data_sink_steps repeat_count
args_opt td_phase2_epoch_size repeat_count
int dataset_sizeargs_opt td_phase2_epoch_size|10 warmup_steps
int dataset_sizeargs_opt td_phase2_epoch_size decay_steps
print eval_dataset get_dataset_size
args_opt load_td1_ckpt_path ckpt_file
load_checkpoint ckpt_file param_dict
param_dict items key|value
re sub key new_key
re sub new_key new_key
value new_param_dict new_key
load_param_into_net eval_model|new_param_dict
eval_model set_train False
args_opt eval_data_dir data_dir
print eval_dataset get_batch_size
Accuracy callback
columns_list i
input_data append data i
input_data label_ids
eval_model input_ids|token_type_id|input_mask logits
callback update logits|label_ids
callback acc_num|callback total_num acc
logger warning
mstype float32 td_student_net_cfg compute_type
task seq_length td_teacher_net_cfg seq_length
task seq_length td_student_net_cfg seq_length
os listdir td_phase1_save_ckpt_dir lists
os path splitext lists name_ext
os path join td_phase1_save_ckpt_dir|lists newest_ckpt_file
run_task_distill newest_ckpt_file
parse_args args_opt load_teacher_ckpt_path load_teacher_checkpoint_path
parse_args args_opt load_gd_ckpt_path load_student_checkpoint_path
parse_args args_opt td_phase1_epoch_size|dataset_size||args_opt data_sink_steps repeat_count
parse_args args_opt data_sink_steps time_monitor_steps
parse_args args_opt td_phase1_epoch_size repeat_count
parse_args args_opt td_phase2_epoch_size|train_dataset get_dataset_size||args_opt data_sink_steps repeat_count
parse_args args_opt td_phase2_epoch_size repeat_count
parse_args args_opt load_td1_ckpt_path ckpt_file
parse_args args_opt eval_data_dir data_dir
Task args_opt task_name task seq_length td_teacher_net_cfg seq_length
Task args_opt task_name task seq_length td_student_net_cfg seq_length
phase1_cfg cfg student_config
phase1_cfg cfg optimizer_cfg optimizer_cfg
phase1_cfg cfg scale_factor scale_factor
dataset get_dataset_size dataset_size time_monitor_steps
print dataset_size time_monitor_steps
cfg optimizer_cfg optimizer_cfg AdamWeightDecay end_learning_rate end_learning_rate
netwithloss trainable_params params optimizer
AdamWeightDecay group_params|learning_rate optimizer netwithgrads
AdamWeightDecay group_params|learning_rate optimizer netwithgrads
load_checkpoint ckpt_file param_dict items key|value
param_dict items value new_param_dict new_key
load_param_into_net eval_model set_train False
load_param_into_net eval_model input_ids|token_type_id|input_mask logits
Accuracy callback update logits|label_ids
Accuracy callback acc_num|callback total_num acc
mstype float32 dtype
seq_length self seq_length
vocab_size self vocab_size
hidden_size self hidden_size
num_hidden_layers self num_hidden_layers
num_attention_heads self num_attention_heads
hidden_act self hidden_act
intermediate_size self intermediate_size
hidden_dropout_prob self hidden_dropout_prob
attention_probs_dropout_prob self attention_probs_dropout_prob
max_position_embeddings self max_position_embeddings
type_vocab_size self type_vocab_size
initializer_range self initializer_range
use_relative_positions self use_relative_positions
dtype self dtype
compute_type self compute_type
super EmbeddingLookup|self __init__
use_one_hot_embeddings self use_one_hot_embeddings
P ExpandDims self expand
(-1|) self shape_flat
P GatherV2 self gather
P OneHot self one_hot
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
P MatMul self array_mul
P Reshape self reshape
tuple embedding_shape self shape
self expand input_ids|-1 extended_ids
self reshape extended_ids|self shape_flat flat_ids
self one_hot flat_ids|self vocab_size|self on_value|self off_value one_hot_ids
self array_mul output_for_reshape
self gather self embedding_table|flat_ids|0 output_for_reshape
self reshape output_for_reshape|self shape output
super EmbeddingPostprocessor|self __init__
use_token_type self use_token_type
token_type_vocab_size self token_type_vocab_size
Tensor 0 1|mstype float32 self off_value
nn LayerNorm (embedding_size|) self layernorm
nn Dropout 1-dropout_prob self dropout
P StridedSlice self slice
word_embeddings output
self reshape token_type_ids|self shape_flat flat_ids
self gather self embedding_table|flat_ids|0 token_type_embeddings
self reshape token_type_embeddings|self shape token_type_embeddings
token_type_embeddings output
self shape width
self slice self full_position_embeddings|(0|0) position_embeddings
self reshape position_embeddings|(1|seq|width) position_embeddings
position_embeddings output
self layernorm output output
self dropout output output
super BertOutput|self __init__
P TensorAdd self add
nn LayerNorm (out_channels|) to_float(mstype float32) self layernorm
nn LayerNorm (out_channels|) to_float compute_type self layernorm
P Cast self cast
self dense hidden_status output
self add input_tensor|output output
self cast output|self compute_type output
super RelaPosMatrixGenerator|self __init__
length self _length
Tensor max_relative_position|dtype self _max_relative_position
Tensor -max_relative_position|dtype self _min_relative_position
-length|1 self range_length
P Tile self tile
P Reshape self range_mat
P Sub self sub
P ExpandDims self expanddims
self cast F tuple_to_array F make_range self _length range_vec_row_out
self range_mat range_vec_row_out|(self _length|-1) range_vec_col_out
self tile range_vec_row_out|(self _length|) tile_row_out
self tile range_vec_col_out|(1|self _length) tile_col_out
self range_mat tile_row_out|(self _length|self _length) range_mat_out
self range_mat tile_col_out|(self _length|self _length) transpose_out
self sub range_mat_out|transpose_out distance_mat
distance_mat_clipped|self _max_relative_position final_mat
super RelaPosEmbeddingsGenerator|self __init__
depth self depth
max_relative_position|2|1 self vocab_size
Parameter self embeddings_table
P Shape self shape
P BatchMatMul self matmul
self relative_positions_matrix relative_positions_matrix_out
self reshape relative_positions_matrix_out|(-1|) flat_relative_positions_matrix
self one_hot one_hot_relative_positions_matrix
self matmul one_hot_relative_positions_matrix|self embeddings_table embeddings
self shape relative_positions_matrix_out|(self depth|) my_shape
self reshape embeddings|my_shape embeddings
super SaturateCast|self __init__
mstype dtype_to_nptype dst_type np_type
np finfo np_type min min_type
np finfo np_type max max_type
Tensor [min_type]|dtype self tensor_min_type
Tensor [max_type]|dtype self tensor_max_type
P Minimum self min_op
P Maximum self max_op
dst_type self dst_type
self max_op x|self tensor_min_type out
self min_op out|self tensor_max_type out
self cast out|self dst_type
super BertAttention|self __init__
from_seq_length self from_seq_length
to_seq_length self to_seq_length
size_per_head self size_per_head
has_attention_mask self has_attention_mask
([1 0|math sqrt(float(self size_per_head))]|dtype self scores_mul
(-1|from_tensor_width) self shape_from_2d
(-1|to_tensor_width) self shape_to_2d
TruncatedNormal initializer_range weight
num_attention_heads|size_per_head units
query_act activation
key_act activation
value_act activation
(-1|from_seq_length|num_attention_heads|size_per_head) self shape_from
(-1|to_seq_length|num_attention_heads|size_per_head) self shape_to
P Mul self multiply
P Transpose self transpose
(0|2|1|3) self trans_shape
(2|0|1|3) self trans_shape_relative
(1|2|0|3) self trans_shape_position
Tensor [-10000 0|]|dtype self multiply_data
nn Softmax self softmax
nn Dropout 1-attention_probs_dropout_prob self dropout
P ExpandDims self expand_dims
P DType self get_dtype
(-1|num_attention_heads|size_per_head) self shape_
(-1|from_seq_length|num_attention_heads|size_per_head) self shape_
SaturateCast dst_type self cast_compute_type
 self _generate_relative_positions_embeddings
size_per_head depth
self reshape from_tensor|self shape_from_2d from_tensor_2d
self reshape to_tensor|self shape_to_2d to_tensor_2d
self query_layer from_tensor_2d query_out
self key_layer to_tensor_2d key_out
self value_layer to_tensor_2d value_out
self reshape query_out|self shape_from query_layer
self transpose query_layer|self trans_shape query_layer
self reshape key_out|self shape_to key_layer
self transpose key_layer|self trans_shape key_layer
self matmul_trans_b query_layer|key_layer attention_scores
self _generate_relative_positions_embeddings relations_keys
self cast_compute_type relations_keys relations_keys
self transpose query_layer|self trans_shape_relative query_layer_t
attention_scores|key_position_scores_r_t attention_scores
self multiply self scores_mul|attention_scores attention_scores
self expand_dims attention_mask|1 attention_mask
self multiply multiply_out|self multiply_data adder
self add adder|attention_scores attention_scores
self softmax attention_scores attention_probs
self dropout attention_probs attention_probs
self reshape value_out|self shape_to value_layer
self transpose value_layer|self trans_shape value_layer
self matmul attention_probs|value_layer context_layer
self _generate_relative_positions_embeddings relations_values
self cast_compute_type relations_values relations_values
self transpose attention_probs|self trans_shape_relative attention_probs_t
self reshape attention_probs_r
context_layer|value_position_scores_r_t context_layer
self transpose context_layer|self trans_shape context_layer
self reshape context_layer|self shape_return context_layer
super BertSelfAttention|self __init__
int hidden_size|num_attention_heads self size_per_head
BertAttention self attention
hidden_size from_tensor_width
hidden_size to_tensor_width
seq_length from_seq_length
seq_length to_seq_length
self size_per_head size_per_head
hidden_size out_channels
hidden_dropout_prob dropout_prob
(-1|hidden_size) self shape
self reshape input_tensor|self shape input_tensor
self attention input_tensor|input_tensor|attention_mask attention_scores
self output attention_output|input_tensor output
super BertEncoderCell|self __init__
BertSelfAttention self attention
intermediate_size out_channels
hidden_act activation
self attention hidden_states|attention_mask attention_scores
self intermediate attention_output intermediate_output
self output intermediate_output|attention_output output
mstype float32 compute_type
super BertTransformer|self __init__
return_all_encoders self return_all_encoders
range _
layers append layer
nn CellList layers self layers
(-1|seq_length|hidden_size) self out_shape
self reshape input_tensor|self shape prev_output
(prev_output|) all_encoder_outputs
self layers layer_module
layer_module prev_output|attention_mask encoder_att
layer_output prev_output
(layer_output|) all_encoder_outputs
self reshape layer_output|self out_shape layer_output
(layer_output|) all_encoder_layers
(encoder_att|) all_encoder_atts
self reshape prev_output|self out_shape prev_output
(prev_output|) all_encoder_layers
super CreateAttentionMaskFromInputMask|self __init__
(-1|1|config seq_length) self shape
self cast self reshape input_mask|self shape attention_mask
super BertModel|self __init__
copy deepcopy config config
config seq_length self seq_length
config hidden_size self hidden_size
config num_hidden_layers self num_hidden_layers
config hidden_size self embedding_size
self num_hidden_layers-1 self last_idx
EmbeddingLookup self bert_embedding_lookup
config vocab_size vocab_size
self embedding_size embedding_size
output_embedding_shape embedding_shape
EmbeddingPostprocessor self bert_embedding_postprocessor
config use_relative_positions use_relative_positions
config type_vocab_size token_type_vocab_size
config max_position_embeddings max_position_embeddings
BertTransformer self bert_encoder
self hidden_size hidden_size
self seq_length seq_length
config num_attention_heads num_attention_heads
self num_hidden_layers num_hidden_layers
config intermediate_size intermediate_size
config attention_probs_dropout_prob attention_probs_dropout_prob
config initializer_range initializer_range
config hidden_dropout_prob hidden_dropout_prob
config hidden_act hidden_act
config compute_type compute_type
config dtype self dtype
CreateAttentionMaskFromInputMask config self _create_attention_mask_from_input_mask
self bert_embedding_lookup input_ids embedding_tables
self bert_embedding_postprocessor token_type_ids|word_embeddings embedding_output
self _create_attention_mask_from_input_mask input_mask attention_mask
self cast encoder_output self last_idx sequence_output
P Shape input_ids batch_size
self squeeze_1 sequence_slice first_token
self dense first_token pooled_output
self cast pooled_output|self dtype pooled_output
encoder_layers output
(self cast(output|self dtype)) encoder_outputs
layer_atts output
(self cast(output|self dtype)) attention_outputs
super TinyBertModel|self __init__
EmbeddingLookup self tinybert_embedding_lookup
EmbeddingPostprocessor self tinybert_embedding_postprocessor
BertTransformer self tinybert_encoder
self tinybert_embedding_lookup input_ids embedding_tables
super BertModelCLS|self __init__
BertModel config|is_training|use_one_hot_embeddings self bert
TruncatedNormal config initializer_range self weight_init
P LogSoftmax axis self log_softmax
num_labels self num_labels
phase_type self phase_type
nn ReLU self dropout
self bert input_ids|token_type_id|input_mask att_output
self cast pooled_output|self dtype cls
self dropout cls cls
self dense cls logits
self dense_1 cls logits
self cast logits|self dtype logits
self log_softmax logits log_probs
mstype float32 dtype self dtype
mstype float32 dtype self _max_relative_position
mstype float32 dtype self _min_relative_position
mstype float32 dtype self tensor_min_type
mstype float32 dtype self tensor_max_type
self reshape output_for_reshape|self shape output all_encoder_outputs
self reshape output_for_reshape|self shape output all_encoder_outputs
self reshape output_for_reshape|self shape output all_encoder_layers
self reshape output_for_reshape|self shape output all_encoder_layers
word_embeddings output all_encoder_outputs
word_embeddings output all_encoder_outputs
word_embeddings output all_encoder_layers
word_embeddings output all_encoder_layers
self gather self embedding_table|flat_ids|0 token_type_embeddings output
self reshape token_type_embeddings|self shape token_type_embeddings output
token_type_embeddings output all_encoder_outputs
token_type_embeddings output all_encoder_outputs
token_type_embeddings output all_encoder_layers
token_type_embeddings output all_encoder_layers
self slice self full_position_embeddings|(0|0) position_embeddings output
self reshape position_embeddings|(1|seq|width) position_embeddings output
position_embeddings output all_encoder_outputs
position_embeddings output all_encoder_outputs
position_embeddings output all_encoder_layers
position_embeddings output all_encoder_layers
self layernorm output output all_encoder_outputs
self layernorm output output all_encoder_outputs
self layernorm output output all_encoder_layers
self layernorm output output all_encoder_layers
self dropout output output all_encoder_outputs
self dropout output output all_encoder_outputs
self dropout output output all_encoder_layers
self dropout output output all_encoder_layers
self dense hidden_status output all_encoder_outputs
self dense hidden_status output all_encoder_outputs
self dense hidden_status output all_encoder_layers
self dense hidden_status output all_encoder_layers
self add input_tensor|output output all_encoder_outputs
self add input_tensor|output output all_encoder_outputs
self add input_tensor|output output all_encoder_layers
self add input_tensor|output output all_encoder_layers
self cast output|self compute_type output all_encoder_outputs
self cast output|self compute_type output all_encoder_outputs
self cast output|self compute_type output all_encoder_layers
self cast output|self compute_type output all_encoder_layers
length self _length self shape_from
length self _length self shape_to
length self _length self shape_
length self _length self out_shape
self matmul_trans_b query_layer|key_layer attention_scores attention_scores
attention_scores|key_position_scores_r_t attention_scores attention_scores
self matmul attention_probs|value_layer context_layer context_layer
context_layer|value_position_scores_r_t context_layer context_layer
self output attention_output|input_tensor output all_encoder_outputs
self output attention_output|input_tensor output all_encoder_outputs
self output attention_output|input_tensor output all_encoder_layers
self output attention_output|input_tensor output all_encoder_layers
self output intermediate_output|attention_output output all_encoder_outputs
self output intermediate_output|attention_output output all_encoder_outputs
self output intermediate_output|attention_output output all_encoder_layers
self output intermediate_output|attention_output output all_encoder_layers
self reshape input_tensor|self shape prev_output all_encoder_outputs
self reshape input_tensor|self shape prev_output all_encoder_layers
self layers layer_module prev_output|attention_mask encoder_att
layer_module prev_output|attention_mask encoder_att all_encoder_atts
layer_output prev_output all_encoder_layers
self reshape layer_output|self out_shape layer_output all_encoder_layers
self reshape prev_output|self out_shape prev_output all_encoder_layers
copy deepcopy config config seq_length self seq_length
copy deepcopy config config hidden_size self hidden_size
copy deepcopy config config num_hidden_layers self num_hidden_layers
copy deepcopy config config hidden_size self embedding_size
copy deepcopy config config vocab_size vocab_size
copy deepcopy config config use_relative_positions use_relative_positions
copy deepcopy config config type_vocab_size token_type_vocab_size
copy deepcopy config config max_position_embeddings max_position_embeddings
copy deepcopy config config num_attention_heads num_attention_heads
copy deepcopy config config intermediate_size intermediate_size
copy deepcopy config config attention_probs_dropout_prob attention_probs_dropout_prob
copy deepcopy config config initializer_range initializer_range
copy deepcopy config config hidden_dropout_prob hidden_dropout_prob
copy deepcopy config config hidden_act hidden_act
copy deepcopy config config compute_type compute_type
copy deepcopy config config dtype self dtype
 phase1_cfg
 phase2_cfg
 eval_cfg
BertConfig td_teacher_net_cfg
mstype float32 dtype
mstype float16 compute_type
BertConfig td_student_net_cfg
 common_cfg
BertConfig bert_teacher_net_cfg
mstype float32 dtype
mstype float16 compute_type
BertConfig bert_student_net_cfg
C MultitypeFuncGraph clip_grad
clip_grad register
F dtype grad dt
nn ClipByNorm grad|F cast(F tuple_to_array (clip_value|)) new_grad
C MultitypeFuncGraph grad_scale
P Reciprocal reciprocal
grad_scale register
reciprocal scale
super ClipGradients|self __init__
nn ClipByNorm self clip_by_norm
P Cast self cast
P DType self dtype
grads grad
self dtype grad dt
self clip_by_norm grad|self cast(F tuple_to_array (clip_value|)) t
new_grads|(t|) new_grads
super SoftCrossEntropy|self __init__
P LogSoftmax axis self log_softmax
P Softmax axis self softmax
P ReduceMean self reduce_mean
self log_softmax predicts likelihood
self softmax targets target_prob
self reduce_mean -target_prob|likelihood loss
self cast loss|mstype float32
super BertNetworkWithLoss_gd|self __init__
BertModel teacher_config|False|use_one_hot_embeddings self teacher
load_checkpoint teacher_ckpt param_dict
param_dict items key|value
re sub key new_key
value new_param_dict new_key
load_param_into_net self teacher|new_param_dict
self teacher set_train False
self teacher trainable_params params
params param
TinyBertModel student_config|is_training|use_one_hot_embeddings self bert
teacher_config num_hidden_layers self teacher_layers_num
student_config num_hidden_layers self student_layers_num
int self teacher_layers_num|self student_layers_num self layers_per_block
is_att_fit self is_att_fit
is_rep_fit self is_rep_fit
nn MSELoss self loss_mse
P Select self select
P ZerosLike self zeroslike
teacher_config dtype self dtype
self teacher input_ids|token_type_id|input_mask teacher_att_output
self bert input_ids|token_type_id|input_mask student_att_output
range i
(teacher_att_output|) selected_teacher_att_output
(student_att_output[i]|) selected_student_att_output
selected_student_att_output i student_att
selected_teacher_att_output i teacher_att
self loss_mse student_att|teacher_att att_loss
att_loss total_loss
range self student_layers_num i
(teacher_seq_output[i|self layers_per_block]|) selected_teacher_seq_output
self fit_dense student_seq_output i fit_dense_out
self cast fit_dense_out|self dtype fit_dense_out
(fit_dense_out|) selected_student_seq_output
selected_teacher_seq_output i teacher_rep
selected_student_seq_output i student_rep
self loss_mse student_rep|teacher_rep rep_loss
rep_loss total_loss
self cast total_loss|mstype float32
network self network
self network set_grad
optimizer parameters self weights
optimizer self optimizer
P AllReduce self allreduce
context get_auto_parallel_context self parallel_mode
F identity self grad_reducer
get_group_size self degree
DistributedGradReducer optimizer parameters|False|self degree self grad_reducer
(self parallel_mode) self is_distributed
P NPUAllocFloatStatus self alloc_status
P NPUGetFloatStatus self get_status
P NPUClearFloatStatus self clear_before_grad
Tensor 1|mstype float32 self base
P LessEqual self less_equal
C HyperMap self hyper_map
scale_update_cell self loss_scaling_manager
Parameter Tensor scale_update_cell get_loss_scale|dtype self loss_scale
self weights weights
self loss_scale scaling_sens
sens scaling_sens
self alloc_status init
self clear_before_grad init
self grad_reducer grads grads
self hyper_map F partial grad_scale|scaling_sens|self degree grads
self hyper_map F partial clip_grad|GRADIENT_CLIP_TYPE|GRADIENT_CLIP_VALUE grads
self get_status init
self reduce_sum init|(0|) flag_sum
self allreduce flag_sum flag_reduce
self less_equal self base|flag_reduce cond
self less_equal self base|flag_sum cond
cond overflow
self loss_scaling_manager self loss_scale|cond overflow
self optimizer grads succ
(loss|cond|scaling_sens) ret
F depend ret|succ
sens self sens
context get_auto_parallel_context mean
DistributedGradReducer optimizer parameters|mean|self degree self grad_reducer
F depend loss|succ
super BertNetworkWithLoss_td|self __init__
load_checkpoint student_ckpt param_dict
re sub |key new_key
load_param_into_net self bert|new_param_dict
is_predistill self is_predistill
task_type self task_type
temperature self temperature
student_config dtype self dtype
num_labels self num_labels
SoftCrossEntropy self soft_cross_entropy
self teacher input_ids|token_type_id|input_mask _
self bert input_ids|token_type_id|input_mask _
self zeroslike student_att
self zeroslike teacher_att
self soft_cross_entropy student_logits|self temperature|teacher_logits|self temperature cls_loss
self loss_mse student_logits[len student_logits-1]|label_ids[len(label_ids)-1] cls_loss
cls_loss total_loss
C MultitypeFuncGraph clip_grad register
C MultitypeFuncGraph grad_scale register
P Reciprocal reciprocal scale
self clip_by_norm grad|self cast(F tuple_to_array (clip_value|)) t new_grads
self clip_by_norm grad|self cast(F tuple_to_array (clip_value|)) t selected_teacher_att_output
self clip_by_norm grad|self cast(F tuple_to_array (clip_value|)) t selected_student_seq_output
new_grads|(t|) new_grads new_grads
self reduce_mean -target_prob|likelihood loss ret
load_checkpoint teacher_ckpt param_dict items key|value
param_dict items value new_param_dict new_key
self teacher trainable_params params param
self teacher input_ids|token_type_id|input_mask teacher_att_output selected_teacher_att_output
range i layers_per_block]|) selected_teacher_seq_output
(teacher_att_output|) selected_teacher_att_output i teacher_att
(student_att_output[i]|) selected_student_att_output i student_att
self loss_mse student_att|teacher_att att_loss total_loss
range(self student_layers_num i layers_per_block]|) selected_teacher_seq_output
(teacher_seq_output[i|self layers_per_block]|) selected_teacher_seq_output i teacher_rep
self fit_dense student_seq_output i fit_dense_out selected_student_seq_output
self cast fit_dense_out|self dtype fit_dense_out selected_student_seq_output
(fit_dense_out|) selected_student_seq_output i student_rep
self loss_mse student_rep|teacher_rep rep_loss total_loss
self loss_scale scaling_sens ret
sens scaling_sens ret
self less_equal self base|flag_reduce cond overflow
self less_equal self base|flag_reduce cond ret
self less_equal self base|flag_sum cond overflow
self less_equal self base|flag_sum cond ret
self soft_cross_entropy student_logits|self temperature|teacher_logits|self temperature cls_loss total_loss
self loss_mse student_logits[len student_logits-1]|label_ids[len(label_ids)-1] cls_loss total_loss
os listdir data_dir files
files file_name
data_files append os path join data_dir|file_name
shuffle|num_shards shuffle
ds shuffle ds
C TypeCast mstype int32 type_cast_op
os listdir data_dir files file_name
shuffle|num_shards shuffle shuffle
super ModelSaveCkpt|self __init__
network self network
save_ckpt_step self save_ckpt_step
max_ckpt_num self max_ckpt_num
output_dir self output_dir
run_context original_args cb_params
cb_params cur_step_num|self save_ckpt_step saved_ckpt_num
saved_ckpt_num-self max_ckpt_num oldest_ckpt_index
os path exists path
os remove path
super LossCallBack|self __init__
isinstance per_print_times|int
per_print_times self _per_print_times
super EvalCallBack|self __init__
dataset self dataset
Accuracy callback
columns_list i
input_data append data i
input_data label_ids
self network set_train False
self network input_ids|token_type_id|input_mask logits
callback update logits|label_ids
callback acc_num|callback total_num acc
f write
acc self global_acc
print  format acc
os path exists eval_model_ckpt_file
os remove eval_model_ckpt_file
save_checkpoint self network|eval_model_ckpt_file
super BertLearningRate|self __init__
WarmUpLR learning_rate|warmup_steps self warmup_lr
PolynomialDecayLR learning_rate|end_learning_rate|decay_steps|power self decay_lr
Tensor np array [warmup_steps] astype np float32 self warmup_steps
P Greater self greater
Tensor np array astype np float32 self one
P Cast self cast
self decay_lr global_step decay_lr
self cast self greater self warmup_steps|global_step is_warmup
self warmup_lr global_step warmup_lr
(self one-is_warmup)|decay_lr|is_warmup|warmup_lr lr
decay_lr lr
run_context original_args cb_params cur_step_num|self save_ckpt_step saved_ckpt_num
isinstance per_print_times self _per_print_times
Accuracy callback update logits|label_ids
Accuracy callback acc_num|callback total_num acc
callback acc_num|callback total_num acc self global_acc
PolynomialDecayLR learning_rate|end_learning_rate|decay_steps|power self decay_lr lr
self decay_lr global_step decay_lr lr
labels asnumpy labels
np reshape labels|-1 labels
logits asnumpy logits
np argmax logits|axis logit_id
len labels self total_num
np reshape logit_id|-1 logit_id
np isin logit_id|[2|3|4|5|6|7] pos_eva
np isin labels|[2|3|4|5|6|7] pos_label
np sum pos_eva self TP
np sum pos_eva self FP
np sum () self FN
print self TP|(self TP|self FP)
print self TP|(self TP|self FN)
ckpt_list ckpt
ckpt endswith
os path exists ckpt
FileNotFoundError f
print f
load_checkpoint ckpt ms_ckpt
ms_ckpt param_name
avg_model param_name append ms_ckpt param_name data asnumpy
avg_model name
sum avg_model name avg_model name
parser parse_known_args _
ckpt_list extend args input_files split
os path exists args input_folderandos path isdir args input_folder
os listdir file
ckpt_list append os path join args input_folder|file
average_me_models ckpt_list avg_weights
np savez args output_file|avg_weights
ckpt_list ckpt endswith
load_checkpoint ckpt ms_ckpt param_name
parser parse_known_args _
np savez args output_file|avg_weights
args src_folder source_folder
args output_folder output_folder
args codes codes
os path exists codes
os path exists source_folderornotos path isdir source_folder
os path exists output_folderornotos path isdir output_folder
isinstance args prefix|strorlen args prefix
isinstance args processes|int
os listdir file
file startswith args prefix
file endswith
os path join output_folder|file replace output_path
os path join output_folder|file replace dict_path
available_dict append dict_path
min kernel_size|cpu_count kernel_size
Pool kernel_size pool
args_groups arg
arg args
pool close
pool join
Dictionary load_from_text available_dict vocab
vocab shrink args threshold vocab
vocab persistence args vocab_path
print f
np savez args file startswith args prefix
np savez args file endswith
os listdir file startswith args prefix
os listdir file endswith
Pool kernel_size pool close
Pool kernel_size pool join
args_groups arg args
Dictionary load_from_text available_dict vocab shrink args threshold vocab
Dictionary load_from_text available_dict vocab persistence args vocab_path
file lowerorinfile lower
os listdir file
_is_dataset_file file
_files append os path join folder|file
os path isdir folder
_get_files_from_dir folder _list
_is_dataset_file folder
_list append folder
inferring Default beamsearch
mstype float32 dtype
save_graphs self save_graphs
random_seed self random_seed
get_source_list pre_train_dataset self pre_train_dataset
get_source_list fine_tune_dataset self fine_tune_dataset
get_source_list valid_dataset self valid_dataset
get_source_list test_dataset self test_dataset
isinstance epochs|int
epochs self epochs
dataset_sink_mode self dataset_sink_mode
dataset_sink_step self dataset_sink_step
ckpt_path self ckpt_path
keep_ckpt_max self keep_ckpt_max
save_ckpt_steps self save_ckpt_steps
ckpt_prefix self ckpt_prefix
existed_ckpt self existed_ckpt
batch_size self batch_size
seq_length self seq_length
vocab_size self vocab_size
hidden_size self hidden_size
num_hidden_layers self num_hidden_layers
ngram self ngram
accumulation_steps self accumulation_steps
disable_ngram_loss self disable_ngram_loss
num_attention_heads self num_attention_heads
hidden_act self hidden_act
intermediate_size self intermediate_size
hidden_dropout_prob self hidden_dropout_prob
attention_dropout_prob self attention_dropout_prob
max_position_embeddings self max_position_embeddings
initializer_range self initializer_range
label_smoothing self label_smoothing
beam_width self beam_width
length_penalty_weight self length_penalty_weight
max_decode_length self max_decode_length
input_mask_from_dataset self input_mask_from_dataset
mstype float32 self compute_type
dtype self dtype
loss_scale_mode self loss_scale_mode
scale_window self scale_window
loss_scale_factor self loss_scale_factor
init_loss_scale self init_loss_scale
optimizer self optimizer
lr self lr
lr_scheduler self lr_scheduler
min_lr self min_lr
poly_lr_scheduler_power self poly_lr_scheduler_power
decay_steps self decay_steps
decay_start_step self decay_start_step
warmup_steps self warmup_steps
PARAM_NODES node
json_object key
json_object node][key _params key
cls _params
open json_file|
cls from_dict json load reader
copy deepcopy self __dict__ output
_get_files_from_dir folder _list append folder
mstype float32 dtype self dtype
isinstance epochs self epochs
Callable TOKENIZER
print f
open file_path|
file sen
TOKENIZER sen tokens
len tokens
tokenized_sen append
open tokenized_file|
file writelines tokenized_sen
parser parse_known_args _
args corpus_folder split src_folder
word_tokenize TOKENIZER
jieba cut TOKENIZER
Pool args pool_size pool
src_folder folder
os listdir file
file endswith
os path join folder|file file_path
os path join args output_folder|file replace out_path
pool apply_async create_tokenized_sentences|(file_path|out_path|)
pool close
pool join
Callable TOKENIZER sen tokens
open file writelines tokenized_sen
open file endswith
args corpus_folder split src_folder folder
Pool args pool_size pool apply_async create_tokenized_sentences|(file_path|out_path|)
Pool args pool_size pool close
Pool args pool_size pool join
os listdir file endswith
parser parse_known_args _
pool join
Dictionary load_from_persisted_dict args existed_vocab vocab
args src_folder folder_path
args output_folder output_folder_path
vocab vocabulary
args mask_ratio mask_ratio
args ngram ngram
args max_len max_sen_len
args processes cores
print f
Dictionary load_from_persisted_dict args existed_vocab vocab vocabulary
parser parse_known_args _
Dictionary load_from_persisted_dict args existed_vocab vocab
BiLingualDataLoader train
args train_src src_filepath
args train_ref tgt_filepath
vocab|tgt_dict src_dict
NoiseChannelLanguageModel add_noise_prob language_model
args max_len max_sen_len
args format lower
os path join args output_folder path
BiLingualDataLoader test
args test_src src_filepath
args test_ref tgt_filepath
print f
Dictionary load_from_persisted_dict args existed_vocab vocab src_dict
TransformerConfig from_json_file config config
mstype float32 config compute_type
mstype float32 config dtype
parser parse_known_args _
args vocab endswith
Dictionary load_from_persisted_dict args vocab vocab
Dictionary load_from_text [args vocab] vocab
get_config args config _config
os getenv None device_id
int device_id device_id
context PYNATIVE_MODE mode
args platform device_target
infer _config result
infer_ppl _config result
open args output|
pickle dump result|f|1
get_score result|vocab|metric score
print score
Dictionary load_from_persisted_dict args vocab vocab score
Dictionary load_from_text [args vocab] vocab score
infer _config result score
infer_ppl _config result score
print score
isinstance sink_mode|bool
input_files datafile
print f
de TFRecordDataset ds
shuffle|num_shards shuffle
ds get_dataset_size ori_dataset_size
epoch_count repeat_count
deC TypeCast mstype int32 type_cast_op
ds rename ds
ds repeat repeat_count ds
isinstance de TFRecordDataset ds
de TFRecordDataset ds get_dataset_size ori_dataset_size
de TFRecordDataset ds rename ds
de TFRecordDataset ds repeat repeat_count ds
shuffle|num_shards shuffle shuffle
super EmbeddingLookup|self __init__
embed_dim self embedding_dim
vocab_size self vocab_size
use_one_hot_embeddings self use_one_hot_embeddings
np random normal 0|embed_dim-0 5|size init_weight
Parameter Tensor init_weight self embedding_table
P ExpandDims self expand
P GatherV2 self gather
P OneHot self one_hot
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
P MatMul self array_mul
P Reshape self reshape
P Shape self get_shape
self get_shape input_ids _shape
_shape _batch_size
_shape _max_len
self reshape input_ids|(_batch_size|_max_len|) flat_ids
self one_hot flat_ids|self vocab_size|self on_value|self off_value one_hot_ids
self array_mul output_for_reshape
self gather self embedding_table|flat_ids|0 output_for_reshape
self reshape output_for_reshape|(_batch_size|_max_len|self embedding_dim) output
self get_shape input_ids _shape _batch_size
self get_shape input_ids _shape _max_len
context GRAPH_MODE mode
network self network
tfm_model init_parameters_data
tfm_model trainable_params params
load_infer_weights config weights
params param
param data value
param name name
ValueError f
name weights_name
f write(weights_name|)
isinstance value|Tensor
print name|value asnumpy shape
param set_data Tensor weights weights_name float32
TypeError f
TransformerInferCell tfm_model tfm_infer
Model tfm_infer model
dataset create_dict_iterator batch
source_sentences append batch
target_sentences append batch
Tensor batch|mstype int32 source_ids
Tensor batch|mstype int32 source_mask
time time start_time
model predict source_ids|source_mask entire_probs
predictions append predicted_ids asnumpy
probs append entire_probs asnumpy
range i
inputs i asnumpy tolist
ref i asnumpy tolist
batch_out i tolist
batch_probs i tolist
output append example
config batch_size batch_size
config dataset_sink_mode sink_mode
transformer_infer config|eval_dataset prediction
config TransformerConfig
super TransformerInferPPLCell|self __init__
config batch_size self batch_size
config vocab_size self vocab_size
P OneHot self one_hot
Tensor float|mstype float32 self on_value
Tensor float|mstype float32 self off_value
P ReduceSum self reduce_sum
P Reshape self reshape
P Cast self cast
(config batch_size|config seq_length|) self flat_shape
(config batch_size|config seq_length) self batch_shape
(-1|) self last_idx
self transformer source_ids|source_mask|target_ids|target_mask predicted_log_probs
self reshape label_ids|self flat_shape label_ids
self cast label_mask|mstype float32 label_mask
self one_hot label_ids|self vocab_size|self on_value|self off_value one_hot_labels
self reduce_sum predicted_log_probs|one_hot_labels|self last_idx label_log_probs
self reshape label_log_probs|self batch_shape label_log_probs
label_log_probs|label_mask log_probs
self reduce_sum label_mask|self last_idx lengths
TransformerInferPPLCell config tfm_infer
tfm_infer init_parameters_data
load_checkpoint config existed_ckpt parameter_dict
load_param_into_net tfm_infer|parameter_dict
Tensor batch|mstype int32 target_ids
Tensor batch|mstype int32 target_mask
Tensor batch|mstype int32 label_ids
Tensor batch|mstype int32 label_mask
model predict source_ids|source_mask|target_ids|target_mask|label_ids|label_mask length
log_probs append log_prob asnumpy
lengths append length asnumpy
inputs i tolist
ref i tolist
log_prob i tolist
transformer_infer_ppl config|eval_dataset prediction
tfm_model trainable_params params param
params param data value
params param name name
params param set_data Tensor weights weights_name float32
param name name weights_name
ValueError f write(weights_name|)
isinstance Tensor batch|mstype int32 source_ids
isinstance Tensor batch|mstype int32 source_mask
isinstance Tensor float|mstype float32 self on_value
isinstance Tensor float|mstype float32 self off_value
isinstance Tensor batch|mstype int32 target_ids
isinstance Tensor batch|mstype int32 target_mask
isinstance Tensor batch|mstype int32 label_ids
isinstance Tensor batch|mstype int32 label_mask
TransformerInferCell tfm_model tfm_infer init_parameters_data
Model tfm_infer model predict source_ids|source_mask entire_probs
Model tfm_infer model predict source_ids|source_mask|target_ids|target_mask|label_ids|label_mask length
self cast label_mask|mstype float32 label_mask log_probs
self reduce_sum predicted_log_probs|one_hot_labels|self last_idx label_log_probs log_probs
self reshape label_log_probs|self batch_shape label_log_probs log_probs
label_log_probs|label_mask log_probs log_probs
label_log_probs|label_mask log_probs append log_prob asnumpy
self reduce_sum label_mask|self last_idx lengths append length asnumpy
TransformerInferPPLCell config tfm_infer init_parameters_data
depth||2 depth
np arange length|dtype positions
(np log max_timescale|min_timescale|(depth-1)) log_timescale_increment
min_timescale|np exp inv_timescales
np expand_dims positions|1|np expand_dims inv_timescales|0 scaled_time
super PositionalEmbedding|self __init__
P TensorAdd self add
P ExpandDims self expand_dims
Tensor self position_embedding_table
position_encoding max_position_embeddings|embedding_size
P GatherV2 self gather
P Shape self get_shape
self get_shape word_embeddings input_shape
input_shape input_len
self position_embedding_table position_embeddings
self expand_dims position_embeddings|0 position_embeddings
self add word_embeddings|position_embeddings output
depth||2 depth depth
self get_shape word_embeddings input_shape input_len
super ClipGradients|self __init__
nn ClipByNorm self clip_by_norm
P Cast self cast
P DType self dtype
grads grad
self dtype grad dt
self clip_by_norm grad|self cast(F tuple_to_array (clip_value|)) t
new_grads|(t|) new_grads
self clip_by_norm grad|self cast(F tuple_to_array (clip_value|)) t new_grads
new_grads|(t|) new_grads new_grads
super ResidualConnection|self __init__
P TensorAdd self add
nn Dropout 1-dropout_prob self dropout
self dropout hidden_tensor output
self add output|residual output
s find idx
ValueError f
zip h|r
cut h replace strip h
cut r replace strip r
edited_hyp append(h|)
edited_ref append(r|)
Rouge _rouge
print f
open H_PATH|
f writelines edited_hyp
open R_PATH|
f writelines edited_ref
ValueError f writelines edited_hyp
ValueError f writelines edited_ref
print f writelines edited_hyp
print f writelines edited_ref
ISR inversesquareroot
np linspace 0|lr|warmup_steps lrs
lr|sqrt(warmup_steps) decay_factor
decay_factor|sqrt(step)ifstep lr
lr warmup_end_lr
(warmup_end_lr-warmup_init_lr)|warmup_steps lr_step
lr|warmup_steps0 5 decay_factor
np empty shape lrs
np linspace warmup_init_lr|warmup_end_lr|warmup_steps lrs
warmup_steps _start_step
range step
warmup_init_lr|step|lr_step _lr
lr _lr
decay_factor|step-0 5 _lr
min_lr _lr
_lr lrs step
np zeros shape lrs
step-_start_step _step
ceil _step|decay_steps ratio
decay_steps|ratio _decay_steps
(lr-min_lr)|pow(1-_step|_decay_steps|power)|min_lr lrs step
super BertLearningRate|self __init__
lr_schedules WarmUpLR learning_rate|warmup_steps self warmup_lr
lr_schedules PolynomialDecayLR learning_rate|end_learning_rate|decay_steps|power self decay_lr
Tensor np array [warmup_steps] astype np float32 self warmup_steps
P Greater self greater
Tensor np array astype np float32 self one
P Cast self cast
self cast self greater self warmup_steps|global_step is_warmup
self warmup_lr global_step warmup_lr
self decay_lr global_step decay_lr
(self one-is_warmup)|decay_lr|is_warmup|warmup_lr lr
lr|sqrt(warmup_steps) decay_factor lr
lr|sqrt(warmup_steps) decay_factor 5 _lr
decay_factor|sqrt(step)ifstep lr warmup_end_lr
decay_factor|sqrt(step)ifstep lr 5 decay_factor
decay_factor|sqrt(step)ifstep lr _lr
decay_factor|sqrt(step)ifstep lr _lr
(warmup_end_lr-warmup_init_lr)|warmup_steps lr_step _lr
lr|warmup_steps0 5 decay_factor 5 _lr
range step _lr
range step 5 _lr
range step lrs step
warmup_init_lr|step|lr_step _lr _lr
warmup_init_lr|step|lr_step _lr lrs step
lr _lr lrs step
decay_factor|step-0 5 _lr lrs step
min_lr _lr lrs step
_lr lrs step lrs step
step-_start_step _step lrs step
ceil _step|decay_steps ratio _decay_steps
decay_steps|ratio _decay_steps lrs step
(lr-min_lr)|pow(1-_step|_decay_steps|power)|min_lr lrs step lrs step
Perplexity PPL
isinstance prob|(np ndarray|list)
isinstance prob|np ndarray
np array prob prob
np sum prob|length prob
range i
pow p|1|length ppl
super LossCallBack|self __init__
isinstance per_print_times|int
config self config
per_print_times self _per_print_times
self _get_ms_timestamp self time_stamp_first
run_context original_args cb_params
open file_name|
self _get_ms_timestamp time_stamp_current
cb_params net_outputs is_accu_step
cb_params net_outputs accu_length
str cb_params net_outputs asnumpy
time time t
int round t|1000
isinstance per_print_times self _per_print_times
isinstance int round t|1000
run_context original_args cb_params net_outputs is_accu_step
run_context original_args cb_params net_outputs accu_length
shape fan_in
shape fan_out
shape dim
shape|receptive_field_size fan_in
shape|receptive_field_size fan_out
int fan_in|int fan_out
shape scale_shape
_compute_fans scale_shape fan_out
math sqrt 3 0|scale limit
np random uniform -limit|limit|shape astype(np float32) values
Tensor values
np ones shape astype np float32 ones
Tensor ones
np zeros shape astype np float32 zeros
Tensor zeros
np random normal 0 0|num_units-0 5|shape astype(np float32) norm
Tensor norm
Perplexity PPL
result sample
sample log_prob
sample length
log_probs extend log_prob
length total_length
print f
sample]) t
rouge predictions|targets
get_rouge_score result|vocab score
get_ppl_score result score
result sample log_prob
result sample length
sample length total_length
os path isabs src_path
os path isabs output_path
os path exists os path dirname src_path
os path exists os path dirname output_path
ENCODER split commands
subprocess call commands
LEARN_DICT split commands
super LooseMaskedLanguageModel|self __init__
mask_ratio self mask_ratio
k self _k
mask_all_prob self _threshold
sentence copy encoder_input
np concatenate ([vocabulary bos_index]|sentence) right_shifted_sentence
right_shifted_sentence decoder_input
vocabulary mask_index decoder_input
sentence copy decoder_output
u start|v stop encoder_input[np arange
np array [vocabulary padding_index]|(u-1) padding
np concatenate (padding|decoder_input) decoder_input
np concatenate (padding|decoder_output) decoder_output
min length|fix_length interval_length
min length|round(self mask_ratio|length) interval_length
np random random _magic
np concatenate ([vocabulary bos_index]|sentence) right_shifted_sentence decoder_input
super MaskedLanguageModel|self __init__
mask_ratio self mask_ratio
k self _k
mask_all_prob self _threshold
sentence copy encoder_input
encoder_input shape seq_len
np array [vocabulary mask_index]|_len|dtype decoder_input
encoder_input copy decoder_input
np array [vocabulary mask_index]|(v-u) decoder_input
encoder_input copy decoder_output
vocabulary mask_index encoder_input
u start|v stop encoder_input[np arange
np array [vocabulary padding_index]|u|dtype padding
np concatenate (padding|decoder_input) decoder_input
np concatenate (padding|decoder_output) decoder_output
min length|fix_length interval_length
min length|round(self mask_ratio|length) interval_length
np random random _magic
sentence copy encoder_input shape seq_len
sentence copy encoder_input copy decoder_input
sentence copy encoder_input copy decoder_output
super NoiseChannelLanguageModel|self __init__
add_noise_prob self _noisy_prob
sentence copy encoder_input
target shape tgt_seq_len
enumerate i|_
np random random _prob
mask_symbol_idx encoder_input i
np empty shape decoder_input
target decoder_input
bos_symbol_idx decoder_input
parser parse_args args
np loadtxt os path join args preprocess_path| astype(np float32) embedding_table
cfg embed_size embed_size
cfg num_hiddens num_hiddens
cfg num_layers num_layers
cfg bidirectional bidirectional
cfg num_classes num_classes
Tensor embedding_table weight
load_checkpoint args ckpt_file param_dict
load_param_into_net network|param_dict
Tensor np random uniform 0 0|1e5|size input_arr
parser parse_args args
context GRAPH_MODE mode
convert_to_mindrecord cfg embed_size|args aclimdb_path|args preprocess_path|args glove_path
np loadtxt os path join args preprocess_path| astype(np float32) embedding_table
cfg embed_size embed_size
cfg num_hiddens num_hiddens
cfg num_layers num_layers
cfg bidirectional bidirectional
cfg num_classes num_classes
Tensor embedding_table weight
load_param_into_net network|load_checkpoint args pre_trained
nn Momentum network trainable_params|cfg learning_rate|cfg momentum opt
LossMonitor loss_cb
Model network|loss|opt|{} model
lstm_create_dataset args preprocess_path|cfg batch_size|1 ds_train
TimeMonitor data_size time_cb
[time_cb|ckpoint_cb|loss_cb] callbacks
LossMonitor loss_cb callbacks
TimeMonitor data_size time_cb callbacks
parser parse_args args
context GRAPH_MODE mode
convert_to_mindrecord cfg embed_size|args aclimdb_path|args preprocess_path|args glove_path
np loadtxt os path join args preprocess_path| astype(np float32) embedding_table
cfg embed_size embed_size
cfg num_hiddens num_hiddens
cfg num_layers num_layers
cfg bidirectional bidirectional
cfg num_classes num_classes
Tensor embedding_table weight
nn Momentum network trainable_params|cfg learning_rate|cfg momentum opt
LossMonitor loss_cb
Model network|loss|opt|{} model
load_checkpoint args ckpt_path param_dict
load_param_into_net network|param_dict
model eval ds_eval acc
Model network|loss|opt|{} model eval ds_eval acc
 lstm_cfg
{} self __label_dic
imdb_path self __imdb_path
embed_size self __glove_dim
os path join glove_path self __glove_file
gensim models KeyedVectors load_word2vec_format self __glove_file self __wvmodel
self __segs seg
self __parse_imdb_datas seg
self __parse_features_and_labels seg
self __gen_weight_np seg
self __label_dic items label_name|label_id
os path join self __imdb_path|seg|label_name sentence_dir
os listdir file
f read replace sentence
data_lists append [sentence|label_id]
data_lists self __imdb_datas seg
self __imdb_datas sentence|label
features append sentence
labels append label
features self __features seg
labels self __labels seg
self __updata_features_to_tokenized seg
self __parse_vacab seg
self __encode_features seg
self __padding_features seg
self __features sentence
tokenized_features append tokenized_sentence
tokenized_features self __features seg
self __features seg tokenized_features
set chain |tokenized_features vocab
vocab self __vacab seg
{word} word_to_idx
word_to_idx self __word2idx seg
self __word2idx word_to_idx
self __features tokenized_sentence
tokenized_sentence word
encoded_sentence append word_to_idx get word|0
encoded_features append encoded_sentence
encoded_features self __features seg
self __features feature
feature padded_feature
len padded_feature
padded_feature append pad
padded_features append padded_feature
padded_features self __features seg
np zeros  len self __word2idx seg weight_np
self __word2idx items word|idx
self __wvmodel get_vector word word_vector
word_vector weight_np
weight_np self __weight_np seg
np array self __features seg np int32 features
np array self __labels seg np int32 labels
np array self __weight_np seg weight
tokenized_features append tokenized_sentence word
set chain |tokenized_features vocab self __vacab seg
{word} word_to_idx self __word2idx seg
self __features tokenized_sentence word
self __features feature padded_feature
feature padded_feature append pad
len padded_feature append pad
np zeros  len self __word2idx seg weight_np self __weight_np seg
self __wvmodel get_vector word word_vector weight_np
word_vector weight_np self __weight_np seg
ds config set_seed
os path join data_home data_dir
data_set shuffle buffer_size data_set
data_set repeat count data_set
np savetxt os path join data_home||weight_np
int label
data_list append data_json
get_imdb_data features|labels data
writer add_schema schema_json|
writer add_index
writer write_raw_data data
writer commit
ImdbParser aclimdb_path|glove_path|embed_size parser
parser parse
os path exists preprocess_path
print f
os makedirs preprocess_path
parser get_datas train_weight_np
_convert_to_mindrecord preprocess_path|train_features|train_labels|train_weight_np
parser get_datas _
ImdbParser aclimdb_path|glove_path|embed_size parser parse
ImdbParser aclimdb_path|glove_path|embed_size parser get_datas train_weight_np
ImdbParser aclimdb_path|glove_path|embed_size parser get_datas _
Tensor np zeros (num_layers|num_directions|batch_size|hidden_size) astype(np float32) h
Tensor np zeros (num_layers|num_directions|batch_size|hidden_size) astype(np float32) c
range _
h_list append Tensor np zeros  num_directions|batch_size|hidden_size astype np float32
c_list append Tensor np zeros  num_directions|batch_size|hidden_size astype np float32
tuple h_list c
super StackLSTM|self __init__
num_layers self num_layers
batch_first self batch_first
P Transpose self transpose
[input_size] input_size_list
range num_layers i
input_size_list append hidden_size|num_directions
range i
(input_size_list[i]|hidden_size)|num_directions|hidden_size|4 weight_size
num_directions|hidden_size|4 bias_size
weight_size|bias_size weight_size
np random uniform -stdv|stdv|(weight_size|1|1) astype(np float32) w_np
layers self lstms
ParameterTuple tuple weights self weight
self transpose x|(1|0|2) x
hx c
self lstms i x|h[i]|c[i]|self weight i _
super SentimentNet|self __init__
P Transpose self trans
(1|0|2) self perm
context get_context
num_hiddens hidden_size
stack_lstm_default_state batch_size|num_hiddens|num_layers|bidirectional self c
lstm_default_state batch_size|num_hiddens|num_layers|bidirectional self c
P Concat self concat
nn Dense num_hiddens|4|num_classes self decoder
nn Dense num_hiddens|2|num_classes self decoder
self embedding inputs embeddings
self trans embeddings|self perm embeddings
self encoder embeddings|(self h|self c) _
self concat (output|output) encoding
self decoder encoding outputs
Tensor np zeros (num_layers|num_directions|batch_size|hidden_size) astype(np float32) h weight_size
Tensor np zeros (num_layers|num_directions|batch_size|hidden_size) astype(np float32) h bias_size
[input_size] input_size_list append hidden_size|num_directions
(input_size_list[i]|hidden_size)|num_directions|hidden_size|4 weight_size weight_size
num_directions|hidden_size|4 bias_size weight_size
weight_size|bias_size weight_size weight_size
argparse ArgumentParser parser
parser parse_args
ET parse xml_file tree
tree getroot root
root ch
ch ch01
ch01 ch02
ch02 attrib rect
ch02 text rect
rect_list append rect
rect_list im_label
ch01 text im_label ch01 tag
imgs_labels append im_label
np save imgs_labels
np maximum location|0 start_x
start_x|location end_x
np maximum location|0 start_y
start_y|location end_y
print  format image shape
print start_x|end_x|start_y|end_y
image cropped
Image fromarray np uint8 cropped im
im save output_dir
init_args args
os path exists args dataset_dir
ValueError  format args dataset_dir
os path exists args xml_file
ValueError  format args xml_file
os path exists args output_dir
os makedirs args output_dir
xml_to_dict args xml_file|True ims_labels_dict
len ims_labels_dict num_images
print  format num_images
range i
ims_labels_dict i img_label
img_label image_name
img_label rects
image_name split ext
image_name name
os path join args dataset_dir|image_name fullpath
np asarray Image open fullpath im_array
print  format image_name
enumerate j|rect
rect location
int float location h
int float location w
int float location x
int float location y
rect label
[h|w|x|y] loc
name replace||label||ext output_name
output_name replace output_name
os path join args output_dir|output_name output_file
image_crop_save im_array|loc|output_file
output_name||label ann
annotation_list append ann
args output_annotation ann_file
open ann_file|
annotation_list line
line txt
f write txt
argparse ArgumentParser parser parse_args
ET parse xml_file tree getroot root
tree getroot root ch
root ch ch01
ch ch01 ch02
ch ch01 text im_label ch01 tag
ch01 ch02 attrib rect
ch01 ch02 text rect
ch02 attrib rect location
ch02 attrib rect label
ch02 text rect location
ch02 text rect label
rect_list append rect location
rect_list append rect label
np maximum location|0 start_x end_x
np maximum location|0 start_y end_y
Image fromarray np uint8 cropped im save output_dir
init_args args output_annotation ann_file
xml_to_dict args xml_file|True ims_labels_dict i img_label
ims_labels_dict i img_label image_name
ims_labels_dict i img_label rects
img_label image_name split ext
img_label image_name name
image_name name replace||label||ext output_name
image_name name ann
enumerate rect location
enumerate rect label
int float location h loc
int float location w loc
int float location x loc
int float location y loc
rect label ann
name replace||label||ext output_name replace output_name
name replace||label||ext output_name ann
annotation_list line txt
argparse ArgumentParser parser
parser parse_args
ET parse xml_file tree
tree getroot root
root ch
ch ch01
ch01 ch02
ch02 attrib rect
ch02 text rect
rect_list append rect
rect_list im_label
ch01 text im_label ch01 tag
imgs_labels append im_label
np save imgs_labels
location start_x
start_x|location end_x
location start_y
start_y|location end_y
print  format image shape
print start_x|end_x|start_y|end_y
image cropped
Image fromarray np uint8 cropped im
im save output_dir
init_args args
os path exists args dataset_dir
ValueError  format args dataset_dir
os path exists args xml_file
ValueError  format args xml_file
os path exists args output_dir
os makedirs args output_dir
xml_to_dict args xml_file|True ims_labels_dict
len ims_labels_dict num_images
print  format num_images
range i
ims_labels_dict i img_label
img_label image_name
img_label lex
img_label rects
image_name split ext
os path join args dataset_dir|image_name fullpath
np asarray Image open fullpath im_array
lexicon_list append lex
print  format image_name
enumerate j|rect
rects j rect
rect location
int location h
int location w
int location x
int location y
rect label
[h|w|x|y] loc
name||label||ext output_name
os path join args output_dir|output_name output_file
image_crop_save im_array|loc|output_file
output_name||label||str(i) ann
annotation_list append ann
open lex_file|
lexicon_list line
line txt
f write txt
open ann_file|
annotation_list line
argparse ArgumentParser parser parse_args
ET parse xml_file tree getroot root
tree getroot root ch
root ch ch01
ch ch01 ch02
ch ch01 text im_label ch01 tag
ch01 ch02 attrib rect
ch01 ch02 text rect
ch02 attrib rect location
ch02 attrib rect label
ch02 text rect location
ch02 text rect label
rect_list append rect location
rect_list append rect label
location start_x end_x
location start_y end_y
Image fromarray np uint8 cropped im save output_dir
xml_to_dict args xml_file|True ims_labels_dict i img_label
ims_labels_dict i img_label image_name
ims_labels_dict i img_label lex
ims_labels_dict i img_label rects
img_label image_name split ext
img_label rects j rect
image_name split ext output_name
enumerate rect location
enumerate rect label
rects j rect location
rects j rect label
int location h loc
int location w loc
int location x loc
int location y loc
rect label output_name
rect label ann
name||label||ext output_name ann
lexicon_list line txt
f write txt
parser parse_args args_opt
int os getenv device_id
context set_context device_id device_id
int os environ get device_num
int os environ get rank
get_group_size device_num
get_rank rank
context reset_auto_parallel_context
ParallelMode DATA_PARALLEL parallel_mode
config max_text_length max_text_length
dataset get_dataset_size step_size
config learning_rate lr_init
nn dynamic_lr cosine_decay_lr 0 0|lr_init|config epoch_size|step_size|step_size|config epoch_size lr
max_text_length max_label_length
CRNN config net
nn SGD params opt
WithLossCell net|loss net
TrainOneStepCellWithGradClip net|opt set_train net
Model net model
[LossMonitor|TimeMonitor data_size callbacks
os path join config save_checkpoint_path save_ckpt_path
callbacks append ckpt_cb
config max_text_length max_text_length max_label_length
[LossMonitor|TimeMonitor data_size callbacks append ckpt_cb
argparse ArgumentParser parser
parser parse_args
io loadmat mat_file ann_ori
ann_ori testdata
testdata elem
elem img_name
elem label
img_name||label ann
ann_output append ann
init_args args
mat_to_list args mat_file ann_list
args output_annotation ann_file
open ann_file|
ann_list line
line txt
f write txt
argparse ArgumentParser parser parse_args
io loadmat mat_file ann_ori testdata
ann_ori testdata elem
testdata elem img_name
testdata elem label
elem img_name ann
elem label ann
init_args args output_annotation ann_file
mat_to_list args mat_file ann_list line
ann_list line txt
f write txt
parser parse_args args_opt
int os getenv device_id
context set_context device_id device_id
config max_text_length max_text_length
config input_size input_size
args_opt dataset_path dataset_path
config batch_size batch_size
dataset get_dataset_size step_size
max_text_length max_label_length
CRNN config net
load_checkpoint args_opt checkpoint_path param_dict
load_param_into_net net|param_dict
net set_train False
Model net|loss_fn model
parser parse_args args_opt dataset_path dataset_path
config max_text_length max_text_length max_label_length
CRNN config net set_train False
CRNN config net model
load_param_into_net net set_train False
 config1
super Conv|self __init__
_bn out_channel self bn
nn ReLU self Relu
use_bn self use_bn
self conv x out
self bn out out
self Relu out out
super VGG|self __init__
_bn self bn1
self conv1 x x
self maxpool2d1 x x
self conv2 x x
self conv3 x x
self conv4 x x
self maxpool2d2 x x
self conv5 x x
self conv6 x x
self conv7 x x
input_size int
batch_size int
hidden_size int
super CRNN|self __init__
config batch_size self batch_size
config input_size self input_size
config hidden_size self hidden_size
config class_num self num_classes
P Reshape self reshape
P Cast self cast
(1|self hidden_size)0 5 k
np random uniform -k|k|(self input_size|self hidden_size|4|self hidden_size) w1
np random uniform -k|k|(2|self hidden_size|self hidden_size|4|self hidden_size) w2
np random uniform -k|k|(self input_size|self hidden_size|4|self hidden_size) w1_bw
np random uniform -k|k|(2|self hidden_size|self hidden_size|4|self hidden_size) w2_bw
Tensor np zeros shape self h1
Tensor np zeros shape self h2
Tensor np zeros shape self h1_bw
Tensor np zeros shape self h2_bw
Tensor np zeros shape self c1
Tensor np zeros shape self c2
Tensor np zeros shape self c1_bw
Tensor np zeros shape self c2_bw
np random random (self num_classes|self hidden_size) astype(np float32) self fc_weight
np random random (self num_classes) astype(np float32) self fc_bias
self fc to_float mstype float32
P ExpandDims self expand_dims
P Concat self concat
P Transpose self transpose
VGG self vgg
Tensor np ones (self batch_size) self seq_length
nn Dropout self dropout
nn Dropout self rnn_dropout
config use_dropout self use_dropout
self vgg x x
self cast x|mstype float16 x
self reshape x|(self batch_size|self input_size|-1) x
self transpose x|(2|0|1) x
self reverse_seq1 x|self seq_length bw_x
self rnn1 x|self w1|self b1|None|self h1|self c1 _
self rnn1_bw bw_x|self w1_bw|self b1_bw|None|self h1_bw|self c1_bw _
self reverse_seq2 y1_bw|self seq_length y1_bw
self concat1 (y1|y1_bw) y1_out
self rnn_dropout y1_out y1_out
self rnn2 y1_out|self w2|self b2|None|self h2|self c2 _
self reverse_seq3 y1_out|self seq_length bw_y
self rnn2 bw_y|self w2_bw|self b2_bw|None|self h2_bw|self c2_bw _
self reverse_seq4 y2_bw|self seq_length y2_bw
self concat1 (y2|y2_bw) y2_out
self dropout y2_out y2_out
range i
self fc self squeeze y2 y2_after_fc
self expand_dims y2_after_fc|0 y2_after_fc
(y2_after_fc|) output
self concat output output
self fc self squeeze y2 y2_after_fc output
self expand_dims y2_after_fc|0 y2_after_fc output
img_root_dir str
max_text_length int
device_target str
os path exists img_root_dir
RuntimeError  format img_root_dir
img_root_dir self img_root_dir
os listdir img_root_dir file_list
file_list f
f split label
label split lower label
label self img_names f
self img_list append f
config max_text_length self max_text_length
config blank self blank
config class_num self class_num
len self img_names
self img_list item img_name
Image open os path join self img_root_dir|img_name im
im convert im
im split b
Image merge (b|g|r) im
np array im image
self img_names img_name label_str
label_str c
label append label_dict index c
label extend [int self blank]| self max_text_length-len label
np array label label
os path exists img_root_dir self img_root_dir
RuntimeError  format img_root_dir self img_root_dir
os listdir img_root_dir file_list f
file_list f split label
f split label split lower label
f split label self img_names f
f split label append label_dict index c
f split label extend [int self blank]| self max_text_length-len label
Image open os path join self img_root_dir|img_name im convert im
Image open os path join self img_root_dir|img_name im split b
self img_names img_name label_str c
img_root_dir str
max_text_length int
device_target str
os path exists img_root_dir
RuntimeError  format img_root_dir
img_root_dir self img_root_dir
os path join img_root_dir|label_file self label_file
config self config
open self label_file|
f lines
lines split img_name
lines split lower label
len label
label c
label self img_names img_name
self img_list append img_name
f close
config max_text_length self max_text_length
config blank self blank
config class_num self class_num
len self img_names
self img_list item img_name
Image open os path join self img_root_dir|img_name im
im convert im
im split b
Image merge (b|g|r) im
np array im image
self img_names img_name label_str
label_str c
label append label_dict index c
label extend [int self blank]| self max_text_length-len label
np array label label
os path exists img_root_dir self img_root_dir
RuntimeError  format img_root_dir self img_root_dir
f lines split img_name
f lines split lower label
lines split lower label c
lines split lower label self img_names img_name
lines split lower label append label_dict index c
lines split lower label extend [int self blank]| self max_text_length-len label
len label c
len label self img_names img_name
len label append label_dict index c
len label extend [int self blank]| self max_text_length-len label
Image open os path join self img_root_dir|img_name im convert im
Image open os path join self img_root_dir|img_name im split b
self img_names img_name label_str c
img_root_dir str
max_text_length int
device_target str
os path exists img_root_dir
RuntimeError  format img_root_dir
img_root_dir self img_root_dir
os path join self img_root_dir self imgslist
os path join self img_root_dir self lexicon_file
open self lexicon_file|
f close
open self imgslist|
f line
line strip split label_index
self img_list append img_name
self lexicons[int label_index] self img_names img_name
config max_text_length self max_text_length
config blank self blank
config class_num self class_num
len self img_names
self img_list item img_name
Image open os path join self img_root_dir|img_name im
im convert im
im split b
Image merge (b|g|r) im
np array im image
self img_names img_name label_str
label_str c
label append label_dict index c
label extend [int self blank]| self max_text_length-len label
np array label label
dataset_path int
batch_size int
num_shards int
shard_id int
CaptchaDataset dataset_path|is_training|config dataset
IC03Dataset dataset_path|config|True|3 dataset
IC13Dataset dataset_path|config dataset
SVTDataset dataset_path|config dataset
IIIT5KDataset dataset_path|config dataset
ValueError f
vc Resize (config image_height|config image_width)
[127 5|127 5|127 5] std
vc HWC2CHW
C TypeCast mstype int32
os path exists img_root_dir self img_root_dir
RuntimeError  format img_root_dir self img_root_dir
f line strip split label_index
Image open os path join self img_root_dir|img_name im convert im
Image open os path join self img_root_dir|img_name im split b
self img_names img_name label_str c
super CRNNAccuracy __init__
config self config
config blank self blank
ValueError  format len inputs
self _convert_data inputs y_pred
self _convert_data inputs y
self _ctc_greedy_decoder y_pred str_pred
self _convert_labels y str_label
zip pred|label
print pred|label
Levenshtein distance pred|label edit_distance
print self _total_num
self _correct_num|self _total_num sequence_accurancy
inputs i
label_dict i string
inputs label
self _arr2char label str_temp
str_list append str_temp
y_pred shape _
[seq_len]|batch_size lens
range i
indices idx
self blank last_idx
range j
idx j cur_idx
pred_label append cur_idx
cur_idx last_idx
pred_labels append pred_label
pred_labels i
str_results append self _arr2char i
ValueError  format len inputs i
ValueError  format len inputs label
self _convert_data inputs y_pred shape _
indices idx j cur_idx
idx j cur_idx last_idx
pred_label append cur_idx last_idx
max_sequence_length int
max_label_length int
batch_size int
super CTCLoss|self __init__
range i
range j
labels_indices append [i|j]
P Reshape self reshape
self reshape label|(-1|) labels_values
self ctc_loss logit|self labels_indices|labels_values|self sequence_length _
C MultitypeFuncGraph compute_norm
compute_norm register
nn Norm norm
norm F cast grad|mstype float32 norm
F expand_dims F cast norm|mstype float32 ret
C MultitypeFuncGraph grad_div
grad_div register
P RealDiv div
P Mul mul
div 10 0|val scale
mul grad|scale ret
:(N|   )
network self network
self network set_grad
optimizer parameters self weights
optimizer self optimizer
sens self sens
C HyperMap self hyper_map
P Greater self greater
P Select self select
P DType self dtype
P Cast self cast
Tensor np array astype np float32 self ten
_get_parallel_mode parallel_mode
_get_gradients_mean mean
_get_device_num degree
DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
self weights weights
self network data|label loss
P Fill P DType loss sens
self grad self network|weights(data|label|sens) grads
self hyper_map F partial compute_norm norm
self concat norm norm
self norm norm norm
self greater norm|self cast(self ten|self dtype norm) cond
self select cond|norm|self cast(self ten|self dtype norm) clip_val
self hyper_map F partial grad_div|clip_val grads
self grad_reducer grads grads
F depend loss|self optimizer grads
C MultitypeFuncGraph compute_norm register
nn Norm norm F cast grad|mstype float32 norm
C MultitypeFuncGraph grad_div register
P RealDiv div 10 0|val scale
P Mul mul grad|scale ret
img_root_dir str
max_text_length int
device_target str
os path exists img_root_dir
RuntimeError  format img_root_dir
img_root_dir self img_root_dir
os path join img_root_dir|anno_file anno_file
open anno_file|
f lines
lines split img_name
lines split lower label
len label
label c
label self img_names img_name
self img_list append img_name
config max_text_length self max_text_length
config blank self blank
config class_num self class_num
len self img_names
self img_list item img_name
Image open os path join self img_root_dir|img_name im
im convert im
im split b
Image merge (b|g|r) im
np array im image
self img_names img_name label_str
label_str c
label append label_dict index c
label extend [int self blank]| self max_text_length-len label
np array label label
os path exists img_root_dir self img_root_dir
RuntimeError  format img_root_dir self img_root_dir
f lines split img_name
f lines split lower label
lines split lower label c
lines split lower label self img_names img_name
lines split lower label append label_dict index c
lines split lower label extend [int self blank]| self max_text_length-len label
len label c
len label self img_names img_name
len label append label_dict index c
len label extend [int self blank]| self max_text_length-len label
Image open os path join self img_root_dir|img_name im convert im
Image open os path join self img_root_dir|img_name im split b
self img_names img_name label_str c
img_root_dir str
max_text_length int
device_target str
os path exists img_root_dir
RuntimeError  format img_root_dir
img_root_dir self img_root_dir
os path join img_root_dir|anno_file anno_file
open anno_file|
f lines
lines split img_name
lines split lower label
label self img_names img_name
self img_list append img_name
config max_text_length self max_text_length
config blank self blank
config class_num self class_num
len self img_names
self img_list item img_name
Image open os path join self img_root_dir|img_name im
im convert im
im split b
Image merge (b|g|r) im
np array im image
self img_names img_name label_str
label_str c
label append label_dict index c
label extend [int self blank]| self max_text_length-len label
np array label label
os path exists img_root_dir self img_root_dir
RuntimeError  format img_root_dir self img_root_dir
f lines split img_name
f lines split lower label
lines split lower label self img_names img_name
lines split lower label append label_dict index c
lines split lower label extend [int self blank]| self max_text_length-len label
Image open os path join self img_root_dir|img_name im convert im
Image open os path join self img_root_dir|img_name im split b
self img_names img_name label_str c
mobilenet_v3_large args|kwargs net
mobilenet_v3_small args|kwargs net
NotImplementedError f
parser parse_args args_opt
config_gpu cfg
NotImplementedError f
load_checkpoint args_opt checkpoint_path param_dict
load_param_into_net net|param_dict
[1|3|cfg image_height|cfg image_width] input_shp
Tensor np random uniform -1 0|1 0|size input_array
cfg export_file|file_format file_name
config_gpu cfg image_height|cfg image_width] input_shp
config_gpu cfg export_file|file_format file_name
load_param_into_net net|param_dict
parser parse_args args_opt
ParallelMode DATA_PARALLEL parallel_mode
super CrossEntropyWithLabelSmooth|self __init__
P OneHot self onehot
Tensor 1 0-smooth_factor|mstype float32 self on_value
nn SoftmaxCrossEntropyWithLogits self ce
P ReduceMean False self mean
P Cast self cast
self ce logit|one_hot_label out_loss
self mean out_loss|0 out_loss
Tensor |100 asnumpy lr_init
super Monitor|self __init__
lr_init self lr_init
len lr_init self lr_init_len
time time self epoch_time
run_context original_args cb_params
(time time-self epoch_time)|1000 epoch_mseconds
epoch_mseconds|cb_params batch_num per_step_mseconds
time time self step_time
(time time-self step_time)|1000 step_mseconds
cb_params net_outputs step_loss
isinstance step_loss| tuple|listandisinstance step_loss|Tensor
isinstance step_loss|Tensor
np mean step_loss asnumpy step_loss
self losses append step_loss
(cb_params cur_step_num-1)%cb_params batch_num cur_step_in_epoch
print args_opt
print config_gpu
mobilenet_v3_large num_classes net
CrossEntropyWithLabelSmooth loss
config_gpu epoch_size epoch_size
config_gpu config
args_opt device_target device_target
config_gpu batch_size batch_size
dataset get_dataset_size step_size
load_checkpoint args_opt pre_trained param_dict
FixedLossScaleManager loss_scale
config_gpu lr lr_max
config_gpu warmup_epochs warmup_epochs
epoch_size total_epochs
[Monitor lr_init cb
config_gpu save_checkpoint_path ckpt_save_dir
[ckpt_cb] cb
cb callbacks
parser parse_args args_opt device_target device_target
Tensor |100 asnumpy lr_init self lr_init
run_context original_args cb_params batch_num per_step_mseconds
run_context original_args cb_params net_outputs step_loss
(time time-self epoch_time)|1000 epoch_mseconds batch_num per_step_mseconds
print args_opt device_target device_target
print config_gpu epoch_size epoch_size
print config_gpu config
print config_gpu batch_size batch_size
print config_gpu lr lr_max
print config_gpu warmup_epochs warmup_epochs
print config_gpu save_checkpoint_path ckpt_save_dir
config_gpu epoch_size epoch_size total_epochs
[Monitor lr_init cb callbacks
[ckpt_cb] cb callbacks
parser parse_args args_opt
config_gpu config
load_param_into_net net|param_dict
args_opt device_target device_target
dataset get_dataset_size step_size
load_checkpoint args_opt checkpoint_path param_dict
net set_train False
Model net|loss_fn model
model eval dataset res
parser parse_args args_opt device_target device_target
load_param_into_net net set_train False
Model net|loss_fn model eval dataset res
 config_gpu
global_step int
lr_init float
lr_end float
lr_max float
warmup_epochs int
total_epochs int
steps_per_epoch int
steps_per_epoch|total_epochs total_steps
steps_per_epoch|warmup_epochs warmup_steps
range i
lr_init|(lr_max-lr_init)|i|warmup_steps lr
lr_end| lr
lr_each_step append lr
global_step current_step
np array lr_each_step astype np float32 lr_each_step
lr_each_step learning_rate
steps_per_epoch|warmup_epochs warmup_steps lr
range i lr
np array lr_each_step astype np float32 lr_each_step learning_rate
dataset_path string
do_train bool
repeat_num int
batch_size int
config image_height resize_height
config image_width resize_width
C Decode decode_op
C RandomCropDecodeResize resize_height|scale resize_crop_op
C Resize resize_op
C CenterCrop resize_width center_crop
C HWC2CHW change_swap_op
[resize_crop_op|horizontal_flip_op|rescale_op|normalize_op|change_swap_op] trans
[decode_op|resize_op|center_crop|normalize_op|change_swap_op] trans
C2 TypeCast mstype int32 type_cast_op
ds shuffle buffer_size ds
ds repeat repeat_num ds
C Decode decode_op trans
C RandomCropDecodeResize resize_height|scale resize_crop_op trans
C Resize resize_op trans
C CenterCrop resize_width center_crop trans
C HWC2CHW change_swap_op trans
C HWC2CHW change_swap_op trans
int np ceil x|1 |divisor|divisor
act_func string
super Activation|self __init__
nn ReLU self act
nn ReLU6 self act
nn HSigmoid self act
nn HSwish self act
self act x
super GlobalAvgPooling|self __init__
P ReduceMean keep_dims self mean
self mean x|(2|3) x
super SE|self __init__
_make_divisible num_out||ratio num_mid
Activation self act1
Activation self act2
P Mul self mul
self pool x out
self conv1 out out
self act1 out out
self conv2 out out
self act2 out out
self mul x|out out
Unit 3|3
super Unit|self __init__
num_out out_channels
num_groups group
nn BatchNorm2d num_out self bn
use_act self use_act
self conv x out
self bn out out
self act out out
ResUnit 16|3|1|1
super ResUnit|self __init__
use_se self use_se
(num_out) self first_conv
SE num_mid self se
self expand x out
x out
self se out out
self add x|out out
super MobileNetV3|self __init__
model_cfgs self cfgs
_make_divisible multiplier|self inplanes first_conv_out_channel
first_conv_out_channel out_channels
self features append nn BatchNorm2d first_conv_out_channel
self features append Activation
self cfgs layer_cfg
_make_divisible multiplier|layer_cfg exp_ch
_make_divisible multiplier|layer_cfg out_channel
layer_cfg use_se
layer_cfg act_func
_make_divisible multiplier|model_cfgs output_channel
output_channel out_channels
self features append nn BatchNorm2d output_channel
model_cfgs out_channels
self features append  nn Dropout final_drop
nn SequentialCell self features self features
include_top self include_top
num_classes out_channels
P Squeeze axis self squeeze
P Sigmoid self activation
P Softmax self activation
NotImplementedError f
self _initialize_weights
self features x x
self output x x
self squeeze x x
self activation x x
exp_ch mid_planes
out_channel out_planes
out_planes self inplanes
self init_parameters_data
self cells_and_names _|m
isinstance m|(nn Conv2d)
m kernel_size|m kernel_size|m out_channels n
isinstance m|nn BatchNorm2d
isinstance m|nn Dense
MobileNetV3 model_cfgs model_name
self act x out
self mean x|(2|3) x out
_make_divisible multiplier|self inplanes first_conv_out_channel out_channels
self cfgs layer_cfg use_se
self cfgs layer_cfg act_func
_make_divisible multiplier|layer_cfg exp_ch mid_planes
_make_divisible multiplier|layer_cfg out_channel out_planes
_make_divisible multiplier|model_cfgs output_channel out_channels
out_channel out_planes self inplanes
self cells_and_names m kernel_size|m kernel_size|m out_channels n
ssd_mobilenet_v2 backbone
SSD300 backbone ssd
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
ssd_mobilenet_v1_fpn config net
load_checkpoint args ckpt_file param_dict
net init_parameters_data
load_param_into_net net|param_dict
net set_train False
[args batch_size|3]|config img_shape input_shp
Tensor np random uniform -1 0|1 0|size input_array
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
ssd_mobilenet_v1_fpn config net init_parameters_data
ssd_mobilenet_v1_fpn config net set_train False
load_param_into_net net set_train False
net set_train False
parser parse_args args_opt
get_args args_opt
context GRAPH_MODE mode|args_opt run_platform device_target|args_opt device_id device_id context set_context
args_opt device_num device_num
context reset_auto_parallel_context
[29 all_reduce_fusion_config|58|89] context set_auto_parallel_context
get_rank rank
create_mindrecord args_opt dataset|True mindrecord_file
float args_opt loss_scale loss_scale
dataset get_dataset_size dataset_size
ssd_mobilenet_v2 backbone
SSD300 backbone ssd
ssd_mobilenet_v1_fpn config ssd
ssd to_float dtype float16
SSDWithLossCell ssd|config net
init_net_param net
load_checkpoint config feature_extractor_base_param param_dict
list x
load_param_into_net ssd feature_extractor mobilenet_v1 network|param_dict
CheckpointConfig save_checkpoint_steps ckpt_config
load_checkpoint args_opt pre_trained param_dict
filter_checkpoint_parameter param_dict
load_param_into_net net|param_dict
backbone feature_1 trainable_params param
config lr_init|lr_end lr_init
config warmup_epochs warmup_epochs
args_opt epoch_size total_epochs
TrainingWrapper net|opt|loss_scale|True net
TrainingWrapper net|opt|loss_scale net
[TimeMonitor data_size callback
Model net model
callback|dataset_sink_mode callbacks
parser parse_args args_opt device_num device_num
parser parse_args args_opt epoch_size total_epochs
get_args args_opt device_num device_num
get_args args_opt epoch_size total_epochs
ssd_mobilenet_v2 backbone feature_1 trainable_params param
SSD300 backbone ssd to_float dtype float16
ssd_mobilenet_v1_fpn config ssd to_float dtype float16
[TimeMonitor data_size callback callbacks
ssd_mobilenet_v1_fpn config net
load_param_into_net net|param_dict
load_checkpoint ckpt_path param_dict
net init_parameters_data
net set_train False
batch_size i
ds get_dataset_size|batch_size total
time time start
print total
data img_id
data img_np
data image_shape
net Tensor img_np output
range batch_idx
output asnumpy
int np squeeze img_id batch_idx
round i|total|100 |2 percent
int (time time-start)|1000 cost_time
metrics pred_data|anno_json mAP
print f
parser parse_args
get_eval_args args_opt
os path join config coco_root|config instances_set format(config val_data_type) json_path
os path join config voc_root|config voc_json json_path
context GRAPH_MODE mode|args_opt run_platform device_target|args_opt device_id device_id context set_context
create_mindrecord args_opt dataset|False mindrecord_file
ssd_eval mindrecord_file|args_opt checkpoint_path|json_path
ssd_mobilenet_v1_fpn config net init_parameters_data
ssd_mobilenet_v1_fpn config net set_train False
ssd_mobilenet_v1_fpn config net Tensor img_np output
load_param_into_net net init_parameters_data
load_param_into_net net set_train False
load_param_into_net net Tensor img_np output
net Tensor img_np output asnumpy
global_step int
lr_init float
lr_end float
lr_max float
warmup_epochs float
total_epochs int
steps_per_epoch int
steps_per_epoch|total_epochs total_steps
steps_per_epoch|warmup_epochs warmup_steps
range i
lr_init|(lr_max-lr_init)|i|warmup_steps lr
lr_end| lr
lr_each_step append lr
global_step current_step
np array lr_each_step astype np float32 lr_each_step
lr_each_step learning_rate
steps_per_epoch|warmup_epochs warmup_steps lr
range i lr
np array lr_each_step astype np float32 lr_each_step learning_rate
network trainable_params params
params p
p set_data initializer TruncatedNormal|p data shape|p data dtype
p set_data initialize_mode|p data shape|p data dtype
network parameters_and_names _|param
param name replace param_name
param_name split name_split
param_name replace param_name
param set_data param_dict param_name data
list key
network trainable_params params p
params p set_data initializer TruncatedNormal|p data shape|p data dtype
params p set_data initialize_mode|p data shape|p data dtype
network parameters_and_names param name replace param_name
network parameters_and_names param set_data param_dict param_name data
param name replace param_name split name_split
param name replace param_name replace param_name
config_map using_model config
divisor min_value
max min_value|int(v|divisor|2)||divisor|divisor new_v
divisor new_v
in_channel in_channels
in_channel out_channels
nn SequentialCell [depthwise_conv|_bn in_channel|nn ReLU6|conv]
shared_conv Cell
super ConvBNReLU|self __init__
in_planes in_channels
out_planes out_channels
in_planes out_channels
[conv|_bn(out_planes)] layers
[shared_conv|_bn(out_planes)] layers
nn SequentialCell layers self features
self features x output
ResidualBlock 3|256|1|1
super InvertedResidual|self __init__
int round inp|expand_ratio hidden_dim
stride|groups stride
_bn oup
nn SequentialCell layers self conv
P TensorAdd self add
P Cast self cast
last_relu self last_relu
nn ReLU6 self relu
x identity
self conv x x
self add identity|x x
self relu x x
super FlattenConcat|self __init__
config num_ssd_boxes self num_ssd_boxes
P Transpose self transpose
F shape inputs batch_size
inputs x
self transpose x|(0|2|3|1) x
(F reshape x|(batch_size|-1)) output
self concat output res
F reshape res|(batch_size|self num_ssd_boxes|-1)
super MultiBox|self __init__
config num_classes num_classes
config extras_out_channels out_channels
config num_default num_default
enumerate k|out_channel
nn layer CellList loc_layers self multi_loc_layers
nn layer CellList cls_layers self multi_cls_layers
FlattenConcat config self flatten_concat
range i
 self multi_loc_layers i inputs i loc_outputs
 self multi_cls_layers i inputs i cls_outputs
self flatten_concat loc_outputs|self flatten_concat cls_outputs
loc_cls_shared_addition bool
super WeightSharedMultiBox|self __init__
len config feature_size num_features
config num_addition_layers num_addition_layers
loc_cls_shared_addition self loc_cls_shared_addition
range x
range _
addition_loc_layer_list append nn SequentialCell addition_loc_layer
addition_cls_layer_list append nn SequentialCell addition_cls_layer
nn CellList addition_loc_layer_list self addition_layer_loc
nn CellList addition_cls_layer_list self addition_layer_cls
addition_layer_list append nn SequentialCell addition_layers
nn SequentialCell addition_layer_list self addition_layer
nn SequentialCell loc_layers self loc_layers
nn SequentialCell cls_layers self cls_layers
len inputs num_heads
self addition_layer i inputs i features
(self loc_layers features) loc_outputs
(self cls_layers features) cls_outputs
self addition_layer_loc i inputs i features
self addition_layer_cls i inputs i features
super SSD300|self __init__
backbone self backbone
config extras_in_channels in_channels
config extras_ratio ratios
config extras_strides strides
residual_list append residual
nn layer CellList residual_list self multi_residual
MultiBox config self multi_box
is_training self is_training
P Sigmoid self activation
self backbone x output
(layer_out_13|output) multi_feature
output feature
self multi_residual residual
residual feature feature
(feature|) multi_feature
self multi_box multi_feature pred_label
self activation pred_label pred_label
F cast pred_loc|mstype float32 pred_loc
F cast pred_label|mstype float32 pred_label
SsdMobilenetV1Fpn config|True
super SsdMobilenetV1Fpn|self __init__
WeightSharedMultiBox config self multi_box
mobilenet_v1_fpn config self feature_extractor
self feature_extractor x features
self multi_box features pred_label
super SigmoidFocalClassificationLoss|self __init__
P SigmoidCrossEntropyWithLogits self sigmiod_cross_entropy
P Sigmoid self sigmoid
P Pow self pow
P OneHot self onehot
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
gamma self gamma
alpha self alpha
self onehot label|F shape logits label
self sigmiod_cross_entropy logits|label sigmiod_cross_entropy
self sigmoid logits sigmoid
F cast label|mstype float32 label
label|sigmoid|(1-label)|(1-sigmoid) p_t
self pow 1-p_t|self gamma modulating_factor
label|self alpha|(1-label)|(1-self alpha) alpha_weight_factor
modulating_factor|alpha_weight_factor|sigmiod_cross_entropy focal_loss
super SSDWithLossCell|self __init__
network self network
P Less self less
P Tile self tile
P ReduceSum self reduce_sum
P ReduceMean self reduce_mean
P ExpandDims self expand_dims
SigmoidFocalClassificationLoss config gamma|config alpha self class_loss
nn SmoothL1Loss self loc_loss
self network x pred_label
F cast self less 0|gt_label mask
self reduce_sum F cast num_matched_boxes|mstype float32 num_matched_boxes
self tile self expand_dims mask|-1 mask_loc
self loc_loss pred_loc|gt_loc|mask_loc smooth_l1
self reduce_sum self reduce_mean smooth_l1|-1 loss_loc
self class_loss pred_label|gt_label loss_cls
self reduce_sum loss_cls|(1|2) loss_cls
self reduce_sum (loss_cls|loss_loc)|num_matched_boxes
C MultitypeFuncGraph grad_scale
grad_scale register
P Reciprocal scale
use_global_nrom bool
self network set_grad
ms ParameterTuple network trainable_params self weights
optimizer self optimizer
sens self sens
use_global_norm self use_global_norm
context get_auto_parallel_context self parallel_mode
context get_auto_parallel_context mean
auto_parallel_context get_device_num_is_set
context get_auto_parallel_context degree
get_group_size degree
nn DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
C HyperMap self hyper_map
self weights weights
self network args loss
P Fill P DType loss sens
self grad self network|weights(args|sens) grads
self grad_reducer grads grads
self hyper_map F partial grad_scale|F scalar_to_array(self sens) grads
C clip_by_global_norm grads grads
F depend loss|self optimizer grads
super SSDWithMobileNetV2|self __init__
InvertedResidual block
_make_divisible input_channel|width_mult|round_nearest input_channel
_make_divisible last_channel|max(1 0|width_mult) self last_channel
inverted_residual_setting t|c|n|s
_make_divisible c|width_mult|round_nearest output_channel
int round input_channel|t hidden_dim
output_channel input_channel
nn SequentialCell features self features_1
nn SequentialCell features self features_2
self features_1 x out
self expand_layer_conv_13 out expand_layer_conv_13
self features_2 out out
SsdMobilenetV1Fpn kwargs
SSDWithMobileNetV2 kwargs
self features x output multi_feature
self features x output feature
stride|groups stride stride
(F reshape x|(batch_size|-1)) output multi_feature
(F reshape x|(batch_size|-1)) output feature
residual_list append residual feature feature
self backbone x output multi_feature
self backbone x output feature
output feature multi_feature
self multi_residual residual feature feature
residual feature feature multi_feature
P SigmoidCrossEntropyWithLogits self sigmiod_cross_entropy focal_loss
P Sigmoid self sigmoid p_t
self onehot label|F shape logits label p_t
self onehot label|F shape logits label alpha|(1-label)|(1-self alpha) alpha_weight_factor
self sigmiod_cross_entropy logits|label sigmiod_cross_entropy focal_loss
self sigmoid logits sigmoid p_t
F cast label|mstype float32 label p_t
F cast label|mstype float32 label alpha|(1-label)|(1-self alpha) alpha_weight_factor
self pow 1-p_t|self gamma modulating_factor focal_loss
label|self alpha|(1-label)|(1-self alpha) alpha_weight_factor focal_loss
C MultitypeFuncGraph grad_scale register
_make_divisible c|width_mult|round_nearest output_channel input_channel
output append nn BatchNorm2d out_channel
output append nn get_activation activation
nn SequentialCell output
super MobileNetV1|self __init__
features_only self features_only
conv_bn_relu 3|32|3|2|False
conv_bn_relu 32|32|3|1|True
conv_bn_relu 32|64|1|1|False
conv_bn_relu 64|64|3|2|True
conv_bn_relu 64|128|1|1|False
conv_bn_relu 128|128|3|1|True
conv_bn_relu 128|128|1|1|False
conv_bn_relu 128|128|3|2|True
conv_bn_relu 128|256|1|1|False
conv_bn_relu 256|256|3|1|True
conv_bn_relu 256|256|1|1|False
conv_bn_relu 256|256|3|2|True
conv_bn_relu 256|512|1|1|False
conv_bn_relu 512|512|3|1|True
conv_bn_relu 512|512|1|1|False
conv_bn_relu 512|512|3|2|True
conv_bn_relu 512|1024|1|1|False
conv_bn_relu 1024|1024|3|1|True
conv_bn_relu 1024|1024|1|1|False
nn CellList cnn self network
nn SequentialCell cnn self network
nn Dense 1024|class_num self fc
x output
self network block
block output output
features|(output|) features
self network x output
P ReduceMean output|(2|3) output
self fc output output
super FpnTopDown|self __init__
in_channel_list channel
self lateral_convs_list_ append l_conv
self fpn_convs_ append fpn_conv
nn layer CellList self lateral_convs_list_ self lateral_convs_list
nn layer CellList self fpn_convs_ self fpn_convs_list
len in_channel_list self num_layers
enumerate i|feature
image_features|(self lateral_convs_list i feature) image_features
(image_features|) features
range i
len inputs-i-1 top
top-1 down
F shape inputs down size
P ResizeBilinear (size|size)(features) top_down
top_down|image_features[down] top_down
features|(top_down|) features
len features num_features
extract_features| self fpn_convs_list i features num_features-i-1 extract_features
super BottomUp|self __init__
levels self levels
range x
nn CellList bottom_up_cells self blocks
self blocks block
features|(block(features)) features
super FeatureSelector|self __init__
feature_idxes self feature_idxes
self feature_idxes i
selected|(feature_list[i]|) selected
super MobileNetV1Fpn|self __init__
FeatureSelector [10|22|26] self selector
[10|22|26] self layer_indexs
FpnTopDown [256|512|1024]|256 self fpn
BottomUp 2|256|3|2 self bottom_up
self mobilenet_v1 x features
self selector features features
self fpn features features
self bottom_up features features
MobileNetV1Fpn config
MobileNetV1 class_num
nn SequentialCell output features
conv_bn_relu F shape inputs down size
conv_bn_relu F shape inputs down size
conv_bn_relu F shape inputs down size
conv_bn_relu F shape inputs down size
conv_bn_relu F shape inputs down size
conv_bn_relu F shape inputs down size
conv_bn_relu F shape inputs down size
conv_bn_relu F shape inputs down size
conv_bn_relu F shape inputs down size
conv_bn_relu F shape inputs down size
x output features
self network block output output
block output output features
features|(output|) features features
features|(output|) features lateral_convs_list i feature) image_features
features|(output|) features features
features|(output|) features features
features|(output|) features fpn_convs_list i features num_features-i-1 extract_features
features|(output|) features features
image_features|(self lateral_convs_list i feature) image_features lateral_convs_list i feature) image_features
image_features|(self lateral_convs_list i feature) image_features features
image_features|(self lateral_convs_list i feature) image_features top_down
(image_features|) features features
(image_features|) features features
(image_features|) features fpn_convs_list i features num_features-i-1 extract_features
(image_features|) features features
range i top_down
top-1 down top_down
top-1 down features
P ResizeBilinear (size|size)(features) top_down top_down
P ResizeBilinear (size|size)(features) top_down features
top_down|image_features[down] top_down top_down
top_down|image_features[down] top_down features
features|(top_down|) features features
features|(top_down|) features fpn_convs_list i features num_features-i-1 extract_features
features|(top_down|) features features
extract_features| self fpn_convs_list i features num_features-i-1 extract_features fpn_convs_list i features num_features-i-1 extract_features
features|(block(features)) features features
selected|(feature_list[i]|) selected selected
 config
[(2|3)|(2|3)|(2|3)|(2|3)|(2|3)|(2|3)
config img_shape|np array(config steps) fk
(config max_scale-config min_scale)|(len(config num_default)-1) scale_rate
enumerate idex|feature_size
scales idex sk1
scales sk2
math sqrt sk1|sk2 sk3
sk1|math sqrt|sk1|math sqrt h
[ 0 1|0 1] all_sizes
[ sk1|sk1] all_sizes
config aspect_ratios aspect_ratio
sk1|math sqrt aspect_ratio h
all_sizes append (w|h)
all_sizes append (h|w)
all_sizes append (sk3|sk3)
all_sizes w|h
(j|0 5)|fk cy
self default_boxes append [cy|cx|h|w]
GridAnchorGenerator config img_shape|4|2|[1 0|2 0|0 5] generator
generator generate_multi_levels config steps default_boxes_tlbr
GeneratDefaultBoxes default_boxes_tlbr default_boxes_tlbr
GeneratDefaultBoxes default_boxes default_boxes
np split default_boxes_tlbr|4|axis x2
(x2-x1)|(y2-y1) vol_anchors
config match_threshold matching_threshold
np maximum y1|bbox ymin
np maximum x1|bbox xmin
np minimum y2|bbox ymax
np minimum x2|bbox xmax
np maximum xmax-xmin|0  w
np maximum ymax-ymin|0  h
h|w inter_vol
vol_anchors|(bbox-bbox)|(bbox-bbox)-inter_vol union_vol
inter_vol|union_vol jaccard
np squeeze jaccard
np zeros (config num_ssd_boxes) pre_scores
np zeros (config num_ssd_boxes|4) t_boxes
np zeros (config num_ssd_boxes) t_label
boxes bbox
int bbox label
jaccard_with_anchors bbox scores
np argmax scores idx
(scores) mask
np maximum pre_scores|scores|mask pre_scores
mask|label|(1-mask)|t_label t_label
range i
np nonzero t_label index
np zeros (config num_ssd_boxes|4) bboxes
bboxes index bboxes_t
default_boxes index default_boxes_t
np maximum bboxes_t|0 000001 tmp
np log tmp|config prior_scaling bboxes_t
bboxes_t bboxes index
([len(np nonzero t_label)]|dtype num_match
t_label astype np int32
boxes copy boxes_t
default_boxes copy default_boxes_t
np zeros (len(boxes_t)) bboxes
np clip bboxes|0|1
np minimum box_a|box_b max_yx
np maximum box_a|box_b min_yx
intersect box_a|box_b inter
area_a|area_b-inter union
scales idex sk1 sqrt|sk1|math sqrt h
scales idex sk1 sqrt aspect_ratio h
sk1|math sqrt|sk1|math sqrt h inter_vol
[ 0 1|0 1] all_sizes append (w|h)
[ 0 1|0 1] all_sizes append (h|w)
[ 0 1|0 1] all_sizes append (sk3|sk3)
[ 0 1|0 1] all_sizes w|h
[ sk1|sk1] all_sizes append (w|h)
[ sk1|sk1] all_sizes append (h|w)
[ sk1|sk1] all_sizes append (sk3|sk3)
[ sk1|sk1] all_sizes w|h
sk1|math sqrt aspect_ratio h inter_vol
self default_boxes append h|w inter_vol
GridAnchorGenerator config img_shape|4|2|[1 0|2 0|0 5] generator generate_multi_levels config steps default_boxes_tlbr
GeneratDefaultBoxes default_boxes default_boxes index default_boxes_t
GeneratDefaultBoxes default_boxes default_boxes copy default_boxes_t
(x2-x1)|(y2-y1) vol_anchors union_vol
np maximum xmax-xmin|0  w inter_vol
np maximum ymax-ymin|0  h inter_vol
h|w inter_vol jaccard
vol_anchors|(bbox-bbox)|(bbox-bbox)-inter_vol union_vol jaccard
np zeros (config num_ssd_boxes) t_label t_label
np zeros (config num_ssd_boxes) t_label astype np int32
int bbox label t_label
(scores) mask t_label
mask|label|(1-mask)|t_label t_label t_label
mask|label|(1-mask)|t_label t_label astype np int32
np zeros (config num_ssd_boxes|4) bboxes index bboxes_t
bboxes index bboxes_t bboxes index
np log tmp|config prior_scaling bboxes_t bboxes index
np random rand|(b-a)
os path splitext filename filename
int filename
NotImplementedError %(filename)
image shape _
np random choice [None|0 1|0 3|0 5|0 7|0 9] min_iou
range _
image image_t
_rand 0 3|1 0|width w
_rand 0 3|1 0|height h
_rand|(width-w) left
_rand|(height-h) top
np array rect
jaccard_numpy boxes|rect overlap
overlap drop_mask
drop_mask any
overlap drop_mask min<min_iouandoverlap[drop_mask] max>(min_iou|0 2)
(boxes)|2 0 centers
(rect) m1
(rect) m2
m1|m2|drop_mask mask
mask any
boxes copy boxes_t
cv2 setNumThreads
input_shape input_w
cv2 resize image|(input_w|input_h) image
np expand_dims image|axis image
np concatenate [image|image|image]|axis image
np array (img_h|img_w)|np float32
image_size h
_infer_data image|image_size
box astype np float32 box
random_sample_crop image|box box
cv2 resize image|(w|h) image
_rand flip
ssd_bboxes_encode box num_match
config img_shape image_size
config voc_root voc_root
{name} cls_map
os path join voc_root|sub_dir voc_dir
os path isdir voc_dir
os path isdir os path join voc_dir|
os path join voc_dir image_dir
os path join voc_dir anno_dir
os path join config voc_root|config voc_json json_file
os path split json_file file_dir
os path isdir file_dir
os makedirs file_dir
os listdir anno_file
print anno_file
anno_file endswith
et parse os path join anno_dir|anno_file tree
tree getroot root_node
root_node find text file_name
get_imageId_from_fileName file_name img_id
os path join image_dir|file_name image_path
print image_path
os path isfile image_path
root_node iter obj
obj find text cls_name
obj find bnd_box
int bnd_box find text-1 x_min
int bnd_box find text-1 y_min
int bnd_box find text-1 x_max
int bnd_box find text-1 y_max
labels append [y_min|x_min|y_max|x_max|cls_map[cls_name]]
abs x_max-x_min o_width
abs y_max-y_min o_height
json_dict append ann
bnd_id|1 bnd_id
images append img_id
image_path image_files_dict img_id
np array labels image_anno_dict img_id
root_node find size
int size find text width
int size find text height
json_dict append image
cls_map items cls_name|cid
{} cat
json_dict append cat
open json_file json_fp
json dumps json_dict json_str
json_fp write json_str
json_fp close
config coco_root coco_root
config val_data_type data_type
config train_data_type data_type
config classes train_cls
enumerate i|cls
i train_cls_dict cls
os path join coco_root|config instances_set format data_type anno_json
COCO anno_json coco
coco loadCats coco getCatIds cat_ids
cat_ids cat
coco getImgIds image_ids
image_ids img_id
coco loadImgs img_id image_info
image_info file_name
coco loadAnns anno_ids anno
os path join coco_root|data_type|file_name image_path
anno label
label bbox
classs_dict label class_name
bbox|bbox|bbox x_max
bbox|bbox|bbox y_max
image_path image_path_dict img_id
np array annos image_anno_dict img_id
annos_str anno_str
list map int|anno_str strip split anno
annos append anno
os path isdir image_dir
os path isfile anno_path
open anno_path|
f readlines lines
enumerate img_id|line
line decode strip line_str
str line_str split line_split
line_split file_name
anno_parser line_split image_anno_dict img_id
os path join mindrecord_dir|prefix mindrecord_path
FileWriter mindrecord_path|file_num writer
create_voc_label is_training image_anno_dict
writer add_schema ssd_json|
images img_id
image_path_dict img_id image_path
open image_path|
f read img
np array image_anno_dict[img_id]|dtype annos
np array [img_id]|dtype img_id
{} row
writer write_raw_data [row]
writer commit
config mindrecord_dir mindrecord_dir
create_coco_label is_training image_anno_dict
filter_valid_data config image_dir|config anno_path image_anno_dict
C Decode decode
ds map operations ds
C HWC2CHW change_swap_op
[color_adjust_op|normalize_op|change_swap_op] trans
[normalize_op|change_swap_op] trans
output_columns|column_order output_columns
use_multiprocessing python_multiprocessing
ds repeat repeat_num ds
os path join mindrecord_dir|prefix| mindrecord_file
os path exists mindrecord_file
os path isdir mindrecord_dir
os makedirs mindrecord_dir
os path isdir config coco_root
data_to_mindrecord_byte_image is_training|prefix
print  format mindrecord_dir
os path isdir config voc_root
voc_data_to_mindrecord mindrecord_dir|is_training|prefix
os path isdir config image_dirandos path exists config anno_path
jaccard_numpy boxes|rect overlap drop_mask
jaccard_numpy boxes|rect overlap drop_mask min<min_iouandoverlap[drop_mask] max>(min_iou|0 2)
overlap drop_mask any
overlap drop_mask mask
(rect) m1 mask
(rect) m2 mask
m1|m2|drop_mask mask any
_infer_data i train_cls_dict cls
random_sample_crop image|box box x_max
random_sample_crop image|box box y_max
{name} cls_map items cls_name|cid
os listdir anno_file endswith
print anno_file endswith
et parse os path join anno_dir|anno_file tree getroot root_node
tree getroot root_node find text file_name
tree getroot root_node iter obj
tree getroot root_node find size
os path join image_dir|file_name image_path image_files_dict img_id
os path join image_dir|file_name image_path image_path_dict img_id
print image_path image_files_dict img_id
print image_path image_path_dict img_id
os path isfile image_path image_files_dict img_id
os path isfile image_path image_path_dict img_id
root_node iter obj find text cls_name
root_node iter obj find bnd_box
labels append cls_map items cls_name|cid
bnd_id|1 bnd_id bnd_id
open json_file json_fp write json_str
open json_file json_fp close
enumerate i train_cls_dict cls
COCO anno_json coco loadCats coco getCatIds cat_ids
COCO anno_json coco getImgIds image_ids
COCO anno_json coco loadImgs img_id image_info
COCO anno_json coco loadAnns anno_ids anno
coco loadCats coco getCatIds cat_ids cat
coco getImgIds image_ids img_id
coco loadImgs img_id image_info file_name
coco loadAnns anno_ids anno label
os path join coco_root|data_type|file_name image_path image_path_dict img_id
anno label bbox
label bbox x_max
label bbox y_max
enumerate line decode strip line_str
str line_str split line_split file_name
FileWriter mindrecord_path|file_num writer add_schema ssd_json|
FileWriter mindrecord_path|file_num writer write_raw_data [row]
FileWriter mindrecord_path|file_num writer commit
C HWC2CHW change_swap_op trans
C HWC2CHW change_swap_op trans
output_columns|column_order output_columns output_columns
super GridAnchorGenerator|self __init__
scale self scale
scales_per_octave self scales_per_octave
aspect_ratios self aspect_ratios
image_shape self image_shape
np array list self aspect_ratios astype np float32 aspects
np meshgrid scales|aspects aspect_ratios_grid
scales_grid reshape scales_grid
aspect_ratios_grid reshape aspect_ratios_grid
[self image_shape|step|self image_shape|step] feature_size
feature_size grid_width
np array [self scale|step|self scale|step] astype(np float32) base_size
step|2 0 anchor_offset
np sqrt aspect_ratios_grid ratio_sqrt
scales_grid|ratio_sqrt|base_size heights
scales_grid|ratio_sqrt|base_size widths
np arange grid_height astype np float32 y_centers
y_centers|step|anchor_offset y_centers
np arange grid_width astype np float32 x_centers
x_centers|step|anchor_offset x_centers
np meshgrid x_centers|y_centers y_centers
x_centers shape x_centers_shape
y_centers shape y_centers_shape
np meshgrid widths|x_centers reshape x_centers_grid
np meshgrid heights|y_centers reshape y_centers_grid
x_centers_grid reshape |x_centers_shape|-1 x_centers_grid
y_centers_grid reshape |y_centers_shape|-1 y_centers_grid
widths_grid reshape -1||x_centers_shape widths_grid
heights_grid reshape -1||y_centers_shape heights_grid
bbox_centers reshape [-1|2] bbox_centers
bbox_sizes reshape [-1|2] bbox_sizes
bbox_corners|np array([|self image_shape||self image_shape]) astype(np float32) self bbox_corners
self bbox_centers|np array([|self image_shape||self image_shape]) astype(np float32) self bbox_centers
print self bbox_centers shape
steps step
self generate step bbox_corners
bbox_centers_list append bbox_centers
bbox_corners_list append bbox_corners
np meshgrid scales|aspects aspect_ratios_grid reshape aspect_ratios_grid
[self image_shape|step|self image_shape|step] feature_size grid_width
np array [self scale|step|self scale|step] astype(np float32) base_size heights
np array [self scale|step|self scale|step] astype(np float32) base_size widths
step|2 0 anchor_offset y_centers
step|2 0 anchor_offset x_centers
np sqrt aspect_ratios_grid ratio_sqrt heights
np sqrt aspect_ratios_grid ratio_sqrt widths
np arange grid_height astype np float32 y_centers y_centers
np arange grid_height astype np float32 y_centers shape y_centers_shape
y_centers|step|anchor_offset y_centers y_centers
y_centers|step|anchor_offset y_centers shape y_centers_shape
np arange grid_width astype np float32 x_centers x_centers
np arange grid_width astype np float32 x_centers shape x_centers_shape
x_centers|step|anchor_offset x_centers x_centers
x_centers|step|anchor_offset x_centers shape x_centers_shape
np meshgrid x_centers|y_centers y_centers shape y_centers_shape
np meshgrid widths|x_centers reshape x_centers_grid reshape |x_centers_shape|-1 x_centers_grid
np meshgrid heights|y_centers reshape y_centers_grid reshape |y_centers_shape|-1 y_centers_grid
bbox_corners|np array([|self image_shape||self image_shape]) astype(np float32) self bbox_corners array([|self image_shape||self image_shape]) astype(np float32) self bbox_corners
all_boxes y1
all_boxes x1
all_boxes y2
all_boxes x2
(x2-x1|1)|(y2-y1|1) areas
all_scores argsort order
order i
keep append i
np maximum x1 i]|x1[order xx1
np maximum y1 i]|y1[order yy1
np minimum x2 i]|x2[order xx2
np minimum y2 i]|y2[order yy2
np maximum 0 0|xx2-xx1|1 w
np maximum 0 0|yy2-yy1|1 h
w|h inter
inter|(areas-inter) ovr
np where ovr inds
config num_classes num_classes
config classes val_cls
enumerate i|cls
cls val_cls_dict i
COCO anno_json coco_gt
coco_gt loadCats coco_gt getCatIds cat_ids
cat_ids cat
pred_data sample
sample pred_boxes
sample box_scores
sample img_id
sample w
ssd_bboxes_decode pred_boxes pred_boxes
img_ids append img_id
range c
box_scores class_box_scores
class_box_scores score_mask
class_box_scores score_mask class_box_scores
pred_boxes score_mask]|[h|w|h|w class_boxes
score_mask any
apply_nms class_boxes|class_box_scores|config nms_threshold|config max_boxes nms_index
class_boxes nms_index class_boxes
class_box_scores nms_index class_box_scores
class_boxes tolist final_boxes
class_box_scores tolist final_score
 classs_dict val_cls_dict c final_label
zip loc|label|score
img_id res
[loc|loc|loc-loc|loc-loc] res
score res
label res
predictions append res
json dump predictions|f
coco_gt loadRes coco_dt
img_ids E params imgIds
E evaluate
E accumulate
E summarize
all_boxes y1 areas
all_boxes x1 areas
all_scores argsort order i
np maximum 0 0|xx2-xx1|1 w inter
np maximum 0 0|yy2-yy1|1 h inter
w|h inter ovr
enumerate cls val_cls_dict i
enumerate  classs_dict val_cls_dict c final_label
COCO anno_json coco_gt loadCats coco_gt getCatIds cat_ids
COCO anno_json coco_gt loadRes coco_dt
coco_gt loadCats coco_gt getCatIds cat_ids cat
pred_data sample pred_boxes
pred_data sample box_scores
pred_data sample img_id
pred_data sample w
sample pred_boxes score_mask]|[h|w|h|w class_boxes
sample box_scores class_box_scores
sample img_id res
ssd_bboxes_decode pred_boxes pred_boxes score_mask]|[h|w|h|w class_boxes
img_ids append img_id res
range c res
box_scores class_box_scores score_mask
box_scores class_box_scores score_mask class_box_scores
box_scores class_box_scores nms_index class_box_scores
box_scores class_box_scores tolist final_score
class_box_scores score_mask any
pred_boxes score_mask]|[h|w|h|w class_boxes nms_index class_boxes
pred_boxes score_mask]|[h|w|h|w class_boxes tolist final_boxes
zip score res
zip label res
 config
[|(2|3)|(2|3)|(2|3)|(2|3)|(2|3)
StackedRNN args|kwargs
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
config captcha_width captcha_width
config captcha_height captcha_height
config batch_size batch_size
config hidden_size hidden_size
StackedRNN captcha_height|3|batch_size|hidden_size net
load_checkpoint args ckpt_file param_dict
load_param_into_net net|param_dict
net set_train False
Tensor np zeros [batch_size|3|captcha_height|captcha_width]|np float16 image
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
StackedRNN captcha_height|3|batch_size|hidden_size net set_train False
load_param_into_net net set_train False
net set_train False
parser parse_args args_opt
context GRAPH_MODE mode|args_opt platform device_target context set_context
int os getenv device_id
context set_context device_id device_id
int os environ get device_num
int os environ get rank
get_group_size device_num
get_rank rank
context reset_auto_parallel_context
ParallelMode DATA_PARALLEL parallel_mode
cf max_captcha_digits max_captcha_digits
m ceil cf captcha_height|64|64|3 input_size
dataset get_dataset_size step_size
cf learning_rateifnotargs_opt run_distributeelsecf learning_rate|device_num|lr_scale lr_init
get_lr cf epoch_size|step_size|lr_init lr
max_captcha_digits max_label_length
StackedRNN input_size net
StackedRNNForGPU input_size net
nn SGD params opt
WithLossCell net|loss net
TrainOneStepCellWithGradClip net|opt set_train net
Model net model
[LossMonitor|TimeMonitor data_size callbacks
os path join cf save_checkpoint_path save_ckpt_path
callbacks append ckpt_cb
cf max_captcha_digits max_captcha_digits max_label_length
[LossMonitor|TimeMonitor data_size callbacks append ckpt_cb
ImageCaptcha width captcha
range i
random randint 1|max_digits digits_length
range _
random randint 0|9 integer
str integer digits
captcha write digits|os path join path|filename_head format i|digits|
name str
img_num int
img_width int
img_height int
max_digits int
process_num int
os path dirname os path realpath __file__ cur_script_path
os path join cur_script_path path_data
os path exists path_data
os mkdir path_data
os path join path_data|name path
print  format name|path
os path exists path
shutil rmtree path
os mkdir path
m ceil img_num|process_num img_num_per_thread
i|img_num_per_thread start
start|img_num_per_threadifi end
p start
processes append p
processes p
p join
print  format name|img_num
ImageCaptcha width captcha write digits|os path join path|filename_head format i|digits|
range i start
range i end
print  format p start
print  format p join
m ceil img_num|process_num img_num_per_thread start
m ceil img_num|process_num img_num_per_thread end
i|img_num_per_thread start end
processes append p join
processes p join
print  format name|img_num
parser parse_args args_opt
int os getenv device_id
context set_context device_id device_id
cf max_captcha_digits max_captcha_digits
m ceil cf captcha_height|64|64|3 input_size
cf batch_size batch_size
dataset get_dataset_size step_size
max_captcha_digits max_label_length
StackedRNN input_size net
StackedRNNForGPU input_size net
load_checkpoint args_opt checkpoint_path param_dict
load_param_into_net net|param_dict
net set_train False
Model net|loss_fn model
cf max_captcha_digits max_captcha_digits max_label_length
StackedRNN input_size net set_train False
StackedRNN input_size net model
StackedRNNForGPU input_size net set_train False
StackedRNNForGPU input_size net model
load_param_into_net net set_train False
every10epoch eachstep|whichdecays
epoch_size int
step_size int
lr_init int
lr_init lr
range 1|epoch_size i
range] _
 config
img_root_dir str
max_captcha_digits int
device_target str
os path exists img_root_dir
RuntimeError  format img_root_dir
img_root_dir self img_root_dir
max_captcha_digits self max_captcha_digits
device_target self target
len self img_names
self img_names item img_name
Image open os path join self img_root_dir|img_name im
im split b
Image merge (b|g|r) im
np array im image
os path splitext img_name label_str
label extend [int self blank]| self max_captcha_digits-len label
np array label label
np transpose image|(1|0|2) image
np transpose image|(2|0|1) image
dataset_path str
batch_size int
num_shards int
shard_id int
_CaptchaDataset dataset_path|cf max_captcha_digits|device_target dataset
vc Rescale 1 0|255 0|0 0
[0 1521|0 1347|0 1458] std
vc Resize  m ceil cf captcha_height|16|16|cf captcha_width
c TypeCast mstype float16
c TypeCast mstype int32
os path exists img_root_dir self img_root_dir
RuntimeError  format img_root_dir self img_root_dir
Image open os path join self img_root_dir|img_name im split b
super WarpCTCAccuracy __init__
device_target self device_target
ValueError  format len inputs
self _convert_data inputs y_pred
self _convert_data inputs y
self _get_prediction y_pred pred_lbls
enumerate b_idx|target
self _is_eq pred_lbls b_idx
target tolist target
len target-len(pred_lbl) pred_diff
pred_lbl extend [self blank]|pred_diff
y_pred shape _
[seq_len]|batch_size lens
range i
indices idx
self blank last_idx
range j
idx j cur_idx
pred_lbl append cur_idx
cur_idx last_idx
pred_lbls append pred_lbl
self _convert_data inputs y_pred shape _
self _get_prediction y_pred pred_lbls append pred_lbl
enumerate target tolist target
enumerate idx j cur_idx
indices idx j cur_idx
idx j cur_idx last_idx
pred_lbl append cur_idx last_idx
max_sequence_length int
max_label_length int
batch_size int
super CTCLoss|self __init__
Parameter Tensor np array [max_sequence_length]|batch_size self sequence_length
range i
range j
labels_indices append [i|j]
Parameter Tensor np array labels_indices self labels_indices
P Reshape self reshape
self reshape label|(-1|) labels_values
self ctc_loss logit|self labels_indices|labels_values|self sequence_length _
input_size int
batch_size int
hidden_size int
super StackedRNN|self __init__
input_size self input_size
batch_size self batch_size
hidden_size self hidden_size
num_class self num_class
(1|hidden_size)0 5 k
Parameter np random uniform -k|k|(input_size|hidden_size|4|hidden_size) astype(np float16) self w1
Parameter np random uniform -k|k|(hidden_size|hidden_size|4|hidden_size) astype(np float16) self w2
Parameter np random uniform -k|k|(4|hidden_size) astype(np float16) self b1
Parameter np random uniform -k|k|(4|hidden_size) astype(np float16) self b2
Tensor np zeros shape self h1
Tensor np zeros shape self h2
Tensor np zeros shape self c1
Tensor np zeros shape self c2
Tensor np random random (hidden_size|num_class) astype(np float16) self fc_weight
Tensor np random random self num_class astype np float16 self fc_bias
P Reshape self reshape
P Transpose self transpose
nn MatMul self matmul
self transpose x|(1|0|2|3) x
self reshape x|(-1|self batch_size|self input_size) x
self rnn1 x|self w1|self b1|None|self h1|self c1 _
self rnn2 y1|self w2|self b2|None|self h2|self c2 _
self matmul y2|self fc_weight|self fc_bias output
num_layer int
super StackedRNNForGPU|self __init__
P Cast self cast
Parameter np random uniform -k|k|(weight_shape|1|1) astype(np float32) self weight
Tensor np zeros shape self h
Tensor np zeros shape self c
self weight self lstm weight
np random random (self num_classes|hidden_size) astype(np float32) self fc_weight
np random random self num_classes astype np float32 self fc_bias
self fc to_float mstype float32
P ExpandDims self expand_dims
P Concat self concat
self cast x|mstype float32 x
self transpose x|(3|0|2|1) x
self lstm x|(self h|self c) _
range i
 self expand_dims self fc output i res
self concat res res
C MultitypeFuncGraph compute_norm
compute_norm register
nn Norm norm
norm F cast grad|mstype float32 norm
F expand_dims F cast norm|mstype float32 ret
C MultitypeFuncGraph grad_div
grad_div register
P RealDiv div
P Mul mul
mul grad|10 0 grad
div grad|val ret
:(N|   )
network self network
self network set_grad
optimizer parameters self weights
optimizer self optimizer
sens self sens
C HyperMap self hyper_map
P Greater self greater
P Select self select
P DType self dtype
P Cast self cast
Tensor np array astype np float32 self ten
_get_parallel_mode parallel_mode
_get_gradients_mean mean
_get_device_num degree
DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
self weights weights
self network data|label loss
P Fill P DType loss sens
self grad self network|weights(data|label|sens) grads
self hyper_map F partial compute_norm norm
self concat norm norm
self norm norm norm
self greater norm|self cast(self ten|self dtype norm) cond
self select cond|norm|self cast(self ten|self dtype norm) clip_val
self hyper_map F partial grad_div|clip_val grads
self grad_reducer grads grads
F depend loss|self optimizer grads
C MultitypeFuncGraph compute_norm register
nn Norm norm F cast grad|mstype float32 norm
C MultitypeFuncGraph grad_div register
P RealDiv div grad|val ret
P Mul mul grad|10 0 grad
MobileNetV2Backbone backbone_net
kwargs include_top
kwargs activation
int kwargs num_classes
mobilenet_v2 backbone_net|head_net net
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args platform device_target|args device_id device_id context set_context
set_config args cfg
set_context cfg
define_net cfg|args is_training net
load_ckpt net|args ckpt_file
[args batch_size|3|cfg image_height|cfg image_width] input_shp
Tensor np random uniform -1 0|1 0|size input_array
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
context GRAPH_MODE mode|args platform device_target|args device_id device_id context set_context cfg
load_ckpt net|args ckpt_file
train_parse_args args_opt
os path abspath args_opt dataset_path args_opt dataset_path
set_config args_opt config
time time start
print f
context_device_init config
define_net config|args_opt is_training net
dataset get_dataset_size step_size
extract_features backbone_net|args_opt dataset_path|config step_size
load_ckpt backbone_net|args_opt pretrain_ckpt
load_ckpt net|args_opt pretrain_ckpt
switch_precision net|mstype float16|config
CrossEntropyWithLabelSmooth loss
config epoch_size epoch_size
config lr_init lr_init
config lr_end lr_end
config lr_max lr_max
config warmup_epochs warmup_epochs
epoch_size total_epochs
Model net|loss_fn model
config_ckpoint config|lr|step_size cb
cb callbacks
WithLossCell head_net|loss network
TrainOneStepCell network|opt network
network set_train
args_opt dataset_path features_path
list range step_size idx_list
get_rank rank
os path join config save_checkpoint_path save_ckpt_path
os path isdir save_ckpt_path
os mkdir save_ckpt_path
range epoch
random shuffle idx_list
time time epoch_start
idx_list j
Tensor np load os path join features_path|f feature
Tensor np load os path join features_path|f label
losses append network feature|label asnumpy
(time time-epoch_start)|1000 epoch_mseconds
epoch_mseconds|step_size per_step_mseconds
save_checkpoint net|os path join save_ckpt_path|f
print  format time time-start
train_parse_args args_opt dataset_path features_path
set_config args_opt config epoch_size epoch_size
set_config args_opt config lr_init lr_init
set_config args_opt config lr_end lr_end
set_config args_opt config lr_max lr_max
set_config args_opt config warmup_epochs warmup_epochs
context_device_init config epoch_size epoch_size
context_device_init config lr_init lr_init
context_device_init config lr_end lr_end
context_device_init config lr_max lr_max
context_device_init config warmup_epochs warmup_epochs
define_net config|args_opt is_training net model
dataset get_dataset_size step_size per_step_mseconds
extract_features backbone_net|args_opt dataset_path|config step_size per_step_mseconds
switch_precision net|mstype config epoch_size epoch_size
switch_precision net|mstype config lr_init lr_init
switch_precision net|mstype config lr_end lr_end
switch_precision net|mstype config lr_max lr_max
switch_precision net|mstype config warmup_epochs warmup_epochs
CrossEntropyWithLabelSmooth loss model
config epoch_size epoch_size total_epochs
config_ckpoint config|lr|step_size cb callbacks
WithLossCell head_net|loss network set_train
TrainOneStepCell network|opt network set_train
list range step_size idx_list j
random shuffle idx_list j
(time time-epoch_start)|1000 epoch_mseconds per_step_mseconds
eval_parse_args args_opt
set_config args_opt config
set_context config
define_net config|args_opt is_training net
load_ckpt net|args_opt pretrain_ckpt
switch_precision net|mstype float16|config
dataset get_dataset_size step_size
net set_train False
Model net|loss_fn model
model eval dataset res
define_net config|args_opt is_training net set_train False
define_net config|args_opt is_training net model
Model net|loss_fn model eval dataset res
 config_cpu
 config_gpu
 config_ascend
int os getenv
config keys
super CrossEntropyWithLabelSmooth|self __init__
P OneHot self onehot
Tensor 1 0-smooth_factor|mstype float32 self on_value
nn SoftmaxCrossEntropyWithLogits self ce
P ReduceMean False self mean
P Cast self cast
self ce logit|one_hot_label out_loss
self mean out_loss|0 out_loss
Tensor |100 asnumpy lr_init
super Monitor|self __init__
lr_init self lr_init
len lr_init self lr_init_len
time time self epoch_time
run_context original_args cb_params
(time time-self epoch_time)|1000 epoch_mseconds
epoch_mseconds|cb_params batch_num per_step_mseconds
time time self step_time
(time time-self step_time)|1000 step_mseconds
cb_params net_outputs step_loss
isinstance step_loss| tuple|listandisinstance step_loss|Tensor
isinstance step_loss|Tensor
np mean step_loss asnumpy step_loss
self losses append step_loss
(cb_params cur_step_num-1)%cb_params batch_num cur_step_in_epoch
load_checkpoint pretrain_ckpt_path param_dict
load_param_into_net network|param_dict
network get_parameters param
MobileNetV2Backbone backbone_net
config num_classes num_classes
mobilenet_v2 backbone_net|head_net net
Tensor |100 asnumpy lr_init self lr_init
run_context original_args cb_params batch_num per_step_mseconds
run_context original_args cb_params net_outputs step_loss
(time time-self epoch_time)|1000 epoch_mseconds batch_num per_step_mseconds
load_param_into_net network get_parameters param
global_step int
lr_init float
lr_end float
lr_max float
warmup_epochs int
total_epochs int
steps_per_epoch int
steps_per_epoch|total_epochs total_steps
steps_per_epoch|warmup_epochs warmup_steps
range i
lr_init|(lr_max-lr_init)|i|warmup_steps lr
lr_end| lr
lr_each_step append lr
global_step current_step
np array lr_each_step astype np float32 lr_each_step
lr_each_step learning_rate
steps_per_epoch|warmup_epochs warmup_steps lr
range i lr
np array lr_each_step astype np float32 lr_each_step learning_rate
dataset_path string
do_train bool
config struct
repeat_num int
int os getenv rank_size
int os getenv rank_id
config image_height resize_height
config image_width resize_width
C Decode decode_op
C RandomCropDecodeResize resize_height|scale resize_crop_op
C Resize (256|256) resize_op
C CenterCrop resize_width center_crop
C HWC2CHW change_swap_op
[resize_crop_op|horizontal_flip_op|rescale_op|normalize_op|change_swap_op] trans
[decode_op|resize_op|center_crop|normalize_op|change_swap_op] trans
C2 TypeCast mstype int32 type_cast_op
ds shuffle buffer_size ds
ds repeat repeat_num ds
dataset_path features_folder
os path exists features_folder
os makedirs features_folder
dataset get_dataset_size step_size
Model net model
os path join features_folder|f features_path
os path join features_folder|f label_path
os path exists features_pathornotos path exists label_path
data image
data label
model predict Tensor image features
np save features_path|features asnumpy
np save label_path|label
print f
repeat_num int os getenv rank_size
repeat_num int os getenv rank_id
C Decode decode_op trans
C RandomCropDecodeResize resize_height|scale resize_crop_op trans
C Resize (256|256) resize_op trans
C CenterCrop resize_width center_crop trans
C HWC2CHW change_swap_op trans
C HWC2CHW change_swap_op trans
Model net model predict Tensor image features
divisor min_value
max min_value|int(v|divisor|2)||divisor|divisor new_v
divisor new_v
print f
super GlobalAvgPooling|self __init__
self mean x|(2|3) x
super ConvBNReLU|self __init__
(kernel_size-1)||2 padding
in_planes in_channels
out_planes out_channels
in_planes out_channels
[conv|nn BatchNorm2d out_planes] layers
nn SequentialCell layers self features
self features x output
ResidualBlock 3|256|1|1
super InvertedResidual|self __init__
int round inp|expand_ratio hidden_dim
nn BatchNorm2d oup
nn SequentialCell layers self conv
TensorAdd self add
P Cast self cast
x identity
self conv x x
self add identity|x
super MobileNetV2Backbone|self __init__
InvertedResidual block
inverted_residual_setting self cfgs
_make_divisible input_channel|width_mult|round_nearest input_channel
_make_divisible last_channel|max(1 0|width_mult) self out_channels
self cfgs t|c|n|s
_make_divisible c|width_mult|round_nearest output_channel
range i
output_channel input_channel
nn SequentialCell features self features
self _initialize_weights
self features x x
self init_parameters_data
self cells_and_names _|m
isinstance m|nn Conv2d
m kernel_size|m kernel_size|m out_channels n
isinstance m|nn BatchNorm2d
super MobileNetV2Head|self __init__
nn SequentialCell head self head
P Sigmoid self activation
P Softmax self activation
self head x x
self activation x x
isinstance m|nn Dense
MobileNetV2 backbone|head
super MobileNetV2|self __init__
inverted_residual_setting| inverted_residual_setting
self backbone x x
MobileNetV2Combine backbone|head
backbone self backbone
head self head
self mean x|(2|3) x identity
_make_divisible c|width_mult|round_nearest output_channel input_channel
self cells_and_names m kernel_size|m kernel_size|m out_channels n
nn SequentialCell head self head self head
MobileNetV2 backbone self backbone
MobileNetV2 head self head
inverted_residual_setting| inverted_residual_setting inverted_residual_setting
MobileNetV2Combine backbone self backbone
MobileNetV2Combine head self head
net to_float data_type
net cells_and_names _|cell
isinstance cell|nn Dense
cell to_float mstype float32
ParallelMode DATA_PARALLEL parallel_mode
[Monitor lr_init cb
get_rank rank
config save_checkpoint_path ckpt_save_dir
[ckpt_cb] cb
net cells_and_names cell to_float mstype float32
train_parser parse_args train_args
eval_parser parse_args eval_args
export_parser parse_args export_args
divisor min_value
max min_value|int(v|divisor|2)||divisor|divisor new_v
divisor new_v
cell to_float mstype float32
super GlobalAvgPooling|self __init__
self mean x|(2|3) x
super ConvBNReLU|self __init__
(kernel_size-1)||2 padding
groups group
self conv x x
ResidualBlock 3|256|1|1
super InvertedResidual|self __init__
int round inp|expand_ratio hidden_dim
stride|groups stride
nn SequentialCell layers self conv
P TensorAdd self add
self conv x out
self add out|x out
super mobilenetV2|self __init__
InvertedResidual block
inverted_residual_setting self cfgs
_make_divisible input_channel|width_mult|round_nearest input_channel
_make_divisible last_channel|max(1 0|width_mult) self out_channels
self cfgs t|c|n|s
_make_divisible c|width_mult|round_nearest output_channel
range i
output_channel input_channel
nn SequentialCell features self features
nn Dropout
nn SequentialCell head self head
self _initialize_weights
self features x x
self head x x
self cells_and_names _|m
isinstance m|nn Conv2d
m kernel_size|m kernel_size|m out_channels n
Tensor np random normal 0|np sqrt(2 |n) w
m weight set_data w
isinstance m|nn Conv2dBnAct
m conv kernel_size|m conv kernel_size|m conv out_channels n
m conv weight set_data w
isinstance m|nn BatchNorm2d
isinstance m|nn Dense
m weight set_data Tensor np random normal 0|0 01|m weight data shape astype
isinstance m|nn DenseBnAct
groups group stride
stride|groups stride stride
_make_divisible c|width_mult|round_nearest output_channel input_channel
self cells_and_names m kernel_size|m kernel_size|m out_channels n
self cells_and_names m weight set_data w
self cells_and_names m conv kernel_size|m conv kernel_size|m conv out_channels n
self cells_and_names m conv weight set_data w
self cells_and_names m weight set_data Tensor np random normal 0|0 01|m weight data shape astype
GoogleNet args|kwargs
googlenet args|kwargs
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
cifar_cfg cfg
imagenet_cfg cfg
NotImplementedError f
GoogleNet num_classes net
load_checkpoint args ckpt_file param_dict
load_param_into_net net|param_dict
Tensor np ones [args batch_size|3|cfg image_height|cfg image_width] input_arr
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
load_param_into_net net|param_dict
steps_per_epoch|total_epochs total_steps
[0 3|total_steps|0 6|total_steps|0 8|total_steps] decay_epoch_index
range i
lr_each_step append lr_max
lr_each_step append lr_max|0 1
lr_each_step append lr_max|0 01
lr_each_step append lr_max|0 001
global_step current_step
np array lr_each_step astype np float32 lr_each_step
lr_each_step learning_rate
_cfg lr_gamma gamma
NotImplementedError _cfg lr_scheduler
parser parse_args args_opt
cifar_cfg cfg
imagenet_cfg cfg
cfg device_target device_target
context GRAPH_MODE mode|cfg device_target device_target context set_context
int os environ get device_num
context set_context args_opt device_id device_id
context set_context cfg device_id device_id
context reset_auto_parallel_context
get_rank rank
create_dataset_cifar10 cfg data_path|1 dataset
create_dataset_imagenet cfg data_path|1 dataset
dataset get_dataset_size batch_num
GoogleNet num_classes net
load_checkpoint cfg checkpoint_path param_dict
lr_steps_cifar10 0|lr_max lr
Tensor lr learning_rate
cfg momentum momentum
lr_steps_imagenet cfg|batch_num lr
network trainable_params x
x name parameter_name
parameter_name endswith
no_decay_params append x
decay_params append x
cfg weight_decay weight_decay
CheckpointConfig save_checkpoint_steps config_ck
TimeMonitor data_size time_cb
LossMonitor loss_cb
[time_cb|ckpoint_cb|loss_cb] callbacks
lr_each_step append lr_max lr
np array lr_each_step astype np float32 lr_each_step learning_rate
cifar_cfg cfg device_target device_target
cifar_cfg cfg momentum momentum
cifar_cfg cfg weight_decay weight_decay
imagenet_cfg cfg device_target device_target
imagenet_cfg cfg momentum momentum
imagenet_cfg cfg weight_decay weight_decay
create_dataset_cifar10 cfg data_path|1 dataset get_dataset_size batch_num
create_dataset_imagenet cfg data_path|1 dataset get_dataset_size batch_num
lr_steps_cifar10 0|lr_max lr lr
network trainable_params x name parameter_name
x name parameter_name endswith
TimeMonitor data_size time_cb callbacks
LossMonitor loss_cb callbacks
decay_params append x
parser parse_args args_opt
cifar_cfg cfg
create_dataset_cifar10 cfg data_path|1|False dataset
GoogleNet num_classes net
Model net|loss_fn model
imagenet_cfg cfg
create_dataset_imagenet cfg val_data_path|1|False dataset
cfg device_target device_target
context GRAPH_MODE mode|cfg device_target device_target context set_context
context set_context cfg device_id device_id
load_checkpoint args_opt checkpoint_path param_dict
print  format args_opt checkpoint_path
load_checkpoint cfg checkpoint_path param_dict
print  format cfg checkpoint_path
load_param_into_net net|param_dict
net set_train False
model eval dataset acc
print acc
cifar_cfg cfg device_target device_target
GoogleNet num_classes net model
GoogleNet num_classes net set_train False
Model net|loss_fn model eval dataset acc
imagenet_cfg cfg device_target device_target
load_param_into_net net set_train False
print acc
super Conv2dBlock|self __init__
nn ReLU self relu
self conv x x
self bn x x
self relu x x
super Inception|self __init__
self b1 x branch1
self b2 x branch2
self b3 x branch3
self maxpool x cell
self b4 cell branch4
self concat (branch1|branch2|branch3|branch4)
super GoogleNet|self __init__
Inception 192|64|96|128|16|32|32 self block3a
Inception 256|128|128|192|32|96|64 self block3b
Inception 480|192|96|208|16|48|64 self block4a
Inception 512|160|112|224|24|64|64 self block4b
Inception 512|128|128|256|24|64|64 self block4c
Inception 512|112|144|288|32|64|64 self block4d
Inception 528|256|160|320|32|128|128 self block4e
Inception 832|256|160|320|32|128|128 self block5a
Inception 832|384|192|384|48|128|128 self block5b
include_top self include_top
nn Flatten self flatten
self conv1 x x
self maxpool1 x x
self conv2 x x
self conv3 x x
self maxpool2 x x
self block3a x x
self block3b x x
self maxpool3 x x
self block4a x x
self block4b x x
self block4c x x
self block4d x x
self block4e x x
self maxpool4 x x
self block5a x x
self block5b x x
self mean x|(2|3) x
self flatten x x
self classifier x x
 cifar_cfg
 imagenet_cfg
lr base_lr
int max_epoch|steps_per_epoch total_steps
int warmup_epochs|steps_per_epoch warmup_steps
range i
i||steps_per_epoch last_epoch
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr
eta_min|(base_lr-eta_min)|(1 |math cos(math pi|last_epoch|T_max))|2 lr
lr_each_step append lr
np array lr_each_step astype np float32
range i last_epoch
lr base_lr
int max_epoch|steps_per_epoch total_steps
int warmup_epochs|steps_per_epoch warmup_steps
lr_epochs milestones
milestones milestone
milestone|steps_per_epoch milestones_step
milestones_steps append milestones_step
base_lr lr
Counter milestones_steps milestones_steps_counter
range i
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr
lr|gammamilestones_steps_counter[i] lr
lr_each_step append lr
np array lr_each_step astype np float32
lr_epochs append i
lr base_lr lr
lr_epochs milestones milestone
milestones milestone milestones_step
base_lr lr lr
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr lr
lr|gammamilestones_steps_counter[i] lr lr
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step lr
os path join data_home data_dir
_get_rank_info rank_id
cifar_cfg image_height resize_height
cifar_cfg image_width resize_width
vision RandomCrop (32|32) random_crop_op
vision RandomHorizontalFlip random_horizontal_op
vision Resize (resize_height|resize_width) resize_op
vision Rescale 1 0|255 0|0 0 rescale_op
vision Normalize (0 4914|0 4822|0 4465) normalize_op
vision HWC2CHW changeswap_op
C TypeCast mstype int32 type_cast_op
[random_crop_op|random_horizontal_op] c_trans
[resize_op|rescale_op|normalize_op|changeswap_op] c_trans
data_set repeat repeat_num data_set
dataset_path string
do_train bool
repeat_num int
batch_size int
target str
ds ImageFolderDataset dataset_path|num_parallel_workers data_set
imagenet_cfg image_height image_size
[0 485|255|0 456|255|0 406|255] mean
[0 229|255|0 224|255|0 225|255] std
(0 08|1 0) scale
vision RandomColorAdjust 0 4|0 4|0 4|0 1
mean mean|std std vision Normalize
vision HWC2CHW
vision Decode
vision Resize
vision CenterCrop image_size
[C TypeCast mstype int32] transform_label
int os environ get rank_size
get_group_size rank_size
get_rank rank_id
vision RandomCrop (32|32) random_crop_op c_trans
vision RandomHorizontalFlip random_horizontal_op c_trans
vision Resize (resize_height|resize_width) resize_op c_trans
vision Rescale 1 0|255 0|0 0 rescale_op c_trans
vision Normalize (0 4914|0 4822|0 4465) normalize_op c_trans
vision HWC2CHW changeswap_op c_trans
repeat_num int os environ get rank_size
batch_size int os environ get rank_size
[0 485|255|0 456|255|0 406|255] mean mean|std std vision Normalize
super CrossEntropySmooth|self __init__
P OneHot self onehot
sparse self sparse
Tensor 1 0-smooth_factor|mstype float32 self on_value
Tensor 1 0|smooth_factor|(num_classes-1) self off_value
nn SoftmaxCrossEntropyWithLogits reduction self ce
self onehot label|F shape logit label
self ce logit|label loss
super CrossEntropySmooth|self __init__
Tensor Monitor(lr_init |100) asnumpy
super Monitor|self __init__
lr_init self lr_init
len lr_init self lr_init_len
time time self epoch_time
run_context original_args cb_params
(time time-self epoch_time)|1000 epoch_mseconds
epoch_mseconds|cb_params batch_num per_step_mseconds
time time self step_time
cb_params net_outputs step_loss
isinstance step_loss| tuple|listandisinstance step_loss|Tensor
isinstance step_loss|Tensor
np mean step_loss asnumpy step_loss
self losses append step_loss
parser parse_args args_opt
os getenv isdigit
int context set_context(device_id os getenv)
get_rank rank
get_group_size group_size
ParallelMode DATA_PARALLEL parallel_mode
context set_context args_opt device_id device_id
ShuffleNetV1 model_size net
dataset get_dataset_size batches_per_epoch
load_checkpoint args_opt resume ckpt
load_param_into_net net|ckpt
Tensor lr lr
[Monitor lr_init cb
config ckpt_path save_ckpt_path
ModelCheckpoint directory ckpt_cb
time time start_time
[ckpt_cb] cb
print (time time-start_time)|1000
run_context original_args cb_params batch_num per_step_mseconds
run_context original_args cb_params net_outputs step_loss
(time time-self epoch_time)|1000 epoch_mseconds batch_num per_step_mseconds
isinstance step_loss| tuple|listandisinstance Tensor lr lr
isinstance Tensor lr lr
print (time time-start_time)|1000
parser parse_args args_opt
dataset get_dataset_size step_size
shufflenetv1 model_size net
load_checkpoint args_opt checkpoint_path param_dict
load_param_into_net net|param_dict
net set_train False
Model net|loss_fn model
time time start_time
print log
open filename|
file_object write(log|)
shufflenetv1 model_size net set_train False
shufflenetv1 model_size net model
load_param_into_net net set_train False
 config
lr_init float
lr_max float
total_steps int
warmup_steps int
[0 3|total_steps|0 6|total_steps|0 8|total_steps] decay_epoch_index
range i
lr_init|(lr_max-lr_init)|i|warmup_steps lr
lr_max lr
lr_max|0 1 lr
lr_max|0 01 lr
lr_max|0 001 lr
lr_each_step append lr
steps_per_epoch int
(float(lr_max)-float(lr_init))|float(warmup_steps) inc_each_step
float lr_init|inc_each_step|float(i) lr
math floor (float(i-warmup_steps)|steps_per_epoch)|2 decay_nums
pow 0 94|decay_nums decay_rate
float lr_max|decay_rate lr
lr_end float
total_steps-warmup_steps decay_steps
(float(lr_max)-float(lr_init))|float(warmup_steps) lr_inc
float lr_init|lr_inc|(i|1) lr
(lr_max-lr_end)|cosine_decay|lr_end lr
lr_max-(lr_max-lr_end)|(i-warmup_steps)|(total_steps-warmup_steps) lr
warmup_epochs int
total_epochs int
lr_decay_mode string:learningratedecaymode|includingsteps|steps_decay|cosineorliner default
steps_per_epoch|total_epochs total_steps
steps_per_epoch|warmup_epochs warmup_steps
_generate_steps_lr lr_init|lr_max|total_steps|warmup_steps lr_each_step
_generate_exponential_lr lr_init|lr_max|total_steps|warmup_steps|steps_per_epoch lr_each_step
_generate_cosine_lr lr_init|lr_end|lr_max|total_steps|warmup_steps lr_each_step
_generate_liner_lr lr_init|lr_end|lr_max|total_steps|warmup_steps lr_each_step
np array lr_each_step astype np float32 learning_rate
lr_init float inc_each_step
lr_init float lr_init|inc_each_step|float(i) lr
lr_init float lr_max|decay_rate lr
lr_init float lr_inc
lr_init float lr_init|lr_inc|(i|1) lr
lr_max float inc_each_step
lr_max float lr_init|inc_each_step|float(i) lr
lr_max float lr_max|decay_rate lr
lr_max float lr_inc
lr_max float lr_init|lr_inc|(i|1) lr
range i lr
lr_init|(lr_max-lr_init)|i|warmup_steps lr lr
lr_max lr lr
lr_max|0 1 lr lr
lr_max|0 01 lr lr
lr_max|0 001 lr lr
lr_each_step append lr lr
float lr_init|inc_each_step|float(i) lr lr
float lr_max|decay_rate lr lr
lr_end float lr_inc
lr_end float lr_init|lr_inc|(i|1) lr
float lr_init|lr_inc|(i|1) lr lr
(lr_max-lr_end)|cosine_decay|lr_end lr lr
dataset_path string
do_train bool
repeat_num int
C RandomCropDecodeResize
C Decode
C Resize
C CenterCrop
[0 485|255 mean|0 456|255|0 406|255]|[0 229|255 std|0 224|255|0 225|255] C Normalize
C HWC2CHW
C2 TypeCast mstype int32 type_cast_op
super CrossEntropySmooth|self __init__
P OneHot self onehot
sparse self sparse
Tensor 1 0-smooth_factor|mstype float32 self on_value
Tensor 1 0|smooth_factor|(num_classes-1) self off_value
nn SoftmaxCrossEntropyWithLogits reduction self ce
self onehot label|F shape logit label
self ce logit|label loss
super GroupConv|self __init__
groups self groups
nn CellList self convs
P Cast self cast
range _
kernel_size|stride kernel_size
self op_split x features
range i
outputs|(self convs i cast(features[i]|mstype float32))) outputs
self op_concat outputs out
super ShuffleV1Block|self __init__
stride self stride
ksize||2 pad
group self group
oup-inp outputs
oup outputs
nn ReLU self relu
P TensorAdd self add
P Concat self concat
P Shape self shape
P Transpose self transpose
P Reshape self reshape
nn BatchNorm2d mid_channels
nn ReLU
nn BatchNorm2d outputs
nn SequentialCell branch_main_1 self branch_main_1
nn SequentialCell branch_main_2 self branch_main_2
old_x left
old_x right
old_x out
self branch_main_1 right right
self channel_shuffle right right
self branch_main_2 right right
self relu self add left|right out
self branch_proj left left
self concat (left|right) out
self relu out out
self shape x width
num_channels||self group group_channels
self reshape x|(batchsize|group_channels|self group|height|width) x
self transpose x|(0|2|1|3|4) x
self reshape x|(batchsize|num_channels|height|width) x
super ShuffleNetV1|self __init__
print model_size
[4|8|4] self stage_repeats
model_size self model_size
[-1|12|120|240|480] self stage_out_channels
[-1|24|240|480|960] self stage_out_channels
[-1|24|360|720|1440] self stage_out_channels
[-1|48|480|960|1920] self stage_out_channels
[-1|16|192|384|768] self stage_out_channels
[-1|24|384|768|1536] self stage_out_channels
[-1|24|576|1152|2304] self stage_out_channels
[-1|48|768|1536|3072] self stage_out_channels
self stage_out_channels input_channel
nn SequentialCell self first_conv
nn BatchNorm2d input_channel
range idxstage
self stage_repeats idxstage numrepeat
self stage_out_channels output_channel
group|first_group group
output_channel input_channel
nn SequentialCell features self features
nn AvgPool2d self globalpool
nn Dense self stage_out_channels|n_class self classifier
self first_conv x x
self maxpool x x
self features x x
self globalpool x x
self reshape x|(-1|self stage_out_channels) x
self classifier x x
kernel_size|stride kernel_size kernel_size
outputs|(self convs i cast(features[i]|mstype float32))) outputs convs i cast(features[i]|mstype float32))) outputs
print model_size self model_size
self stage_out_channels output_channel input_channel
group|first_group group group
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
OpenPoseNet net
load_checkpoint args ckpt_file param_dict
load_param_into_net net|param_dict
np ones [args batch_size|3|params] astype(np float32) inputs
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
argparse ArgumentParser parser
parser parse_known_args _
os path join params||args train_ann args jsonpath_train
os path join params|args train_dir args imgpath_train
os path join params args maskpath_train
params args outputs_dir
load_param_into_net net|param_dict
os path join args outputs_dir| format str get_rank args outputs_dir
get_rank args rank
os path join args outputs_dir args outputs_dir
params args max_epoch
params|2 args loss_scale
list map int|params split args lr_steps
params args loss_scale
openpose_loss criterion
OpenPoseNet vggpath network
print params
load_model network|params
BuildTrainNetwork network|criterion train_net
os path exists args jsonpath_trainandos path exists args imgpath_train
os path exists args maskpath_train
params batch_size
args rank rank
args group_size group_size
de_dataset_train get_dataset_size steps_per_epoch
print steps_per_epoch
params lr_type
Adam group_params opt
Adam train_net trainable_params|learning_rate opt
TimeMonitor data_size time_cb
[MyLossMonitor|time_cb|ckpoint_cb] callback_list
[MyLossMonitor|time_cb] callback_list
TrainOneStepWithClipGradientCell train_net|opt|sens train_net
train_net set_train
Model train_net model
Model train_net|optimizer model
ValueError  format params
mindspore common seed set_seed
argparse ArgumentParser parser parse_known_args _
print params batch_size
print params lr_type
load_model params batch_size
load_model params lr_type
BuildTrainNetwork network|criterion train_net train_net
BuildTrainNetwork network|criterion train_net set_train
BuildTrainNetwork network|criterion train_net model
Adam group_params opt train_net
Adam group_params opt model
Adam train_net trainable_params|learning_rate opt train_net
Adam train_net trainable_params|learning_rate opt model
TimeMonitor data_size time_cb callback_list
TimeMonitor data_size time_cb callback_list
TrainOneStepWithClipGradientCell train_net|opt|sens train_net train_net
TrainOneStepWithClipGradientCell train_net|opt|sens train_net set_train
TrainOneStepWithClipGradientCell train_net|opt|sens train_net model
warnings filterwarnings
int os getenv devid
argparse ArgumentParser parser
parser parse_known_args _
NullWriter nullwrite
sys stdout oldstdout
nullwrite sys stdout
LoadAnn ann_file Gt
Gt loadRes res_file Dt
MapEval Gt|Dt|ann_type Eval
Eval evaluate
Eval accumulate
Eval summarize
oldstdout sys stdout
enumerate ind|name
Eval stats ind info_str name
os path exists model_path
load_checkpoint model_path param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net test_net|param_dict_new
img astype x_data
x_data transpose 2|0|1[None] x_data
img_dir_path pathName
os walk root|dirs|files
files file
os path join root|file file_path
filepaths append file_path
dirs d
os path join root|d dir_path
dirpaths append dir_path
orig_img shape _
orig_img_h|orig_img_w aspect
img_size img_h
np round img_size|aspect astype int img_w
img_w%stride surplus
stride-surplus img_w
img_size img_w
np round img_size|aspect astype int img_h
img_h%stride surplus
stride-surplus img_h
enumerate i|heatmap
gaussian_filter heatmap|sigma heatmap
np zeros heatmap shape map_left
np zeros heatmap shape map_right
np zeros heatmap shape map_top
np zeros heatmap shape map_bottom
 peaks_binary
zip np nonzero peaks_binary peaks
range peak_counter|peak_counter|len(peaks_with_score) peaks_id
len peaks_with_score_and_id peak_counter
all_peaks append peaks_with_score_and_id
cand_a joint_a
cand_b joint_b
joint_b-joint_a vector
np linalg norm vector norm
np linspace joint_a|joint_b|num ys
np linspace joint_a|joint_b|num xs
np stack [ys|xs] T round astype integ_points
np hstack [paf[np hsplit integ_points|2]|paf[np hsplit integ_points|2]] paf_in_edge
vector|norm unit_vector
np dot paf_in_edge|unit_vector inner_products
inner_products sum|len(inner_products) integ_value
sum inner_products n_valid_points
candidate_connections append [int joint_a|int joint_b|integ_value_with_dist_prior]
range i
pafs paf_index paf
params_ i limb_point
compute_candidate_connections paf|cand_a|cand_b|img_len|params_ candidate_connections
np zeros (0|3) connections
candidate_connections index_a|index_b|score
np vstack [connections|[index_a|index_b|score]] connections
all_connections append connections
all_connections append np zeros (0|3)
-1|np ones (0|20) subsets
enumerate l|connections
params_ l joint_b
connections ind_a|ind_b|score
int ind_a ind_b
[-1|-1] joint_found_subset_index
enumerate subset_ind|subset
subset_ind joint_found_subset_index joint_found_cnt
subsets joint_found_subset_index found_subset
ind_b found_subset joint_b
candidate_peaks ind_b|3 found_subset
subsets joint_found_subset_index found_subset_1
subsets joint_found_subset_index found_subset_2
found_subset_2|1 found_subset_1
found_subset_2 found_subset_1
score found_subset_1
ind_a found_subset_1 joint_a
candidate_peaks ind_a|3 found_subset_1
ind_b found_subset_1 joint_b
candidate_peaks ind_b|3 found_subset_1
ind_a found_subset_2 joint_a
candidate_peaks ind_a|3 found_subset_2
ind_b found_subset_2 joint_b
candidate_peaks ind_b|3 found_subset_2
-1|np ones row
ind_a row joint_a
ind_b row joint_b
sum candidate_peaks [ind_a|ind_b]|3 row
np vstack [subsets|row] subsets
subsets keep subsets
subsets subset
subset astype joint_index
all_peaks joint_index joint
joint append
joints append joint
joints append [0|0|0]
person_pose_array append np array joints
np array person_pose_array person_pose_array
img copy orig_img
compute_optimal_size orig_img|params input_h
compute_optimal_size orig_img|params map_h
cv2 resize orig_img|(input_w|input_h) resized_image
preprocess resized_image x_data
Tensor x_data|mstype float32 x_data
network x_data logit_heatmap
logit_pafs asnumpy logit_pafs
logit_heatmap asnumpy logit_heatmap
np zeros (logit_pafs shape|map_h|map_w) pafs
cv2 resize logit_pafs i pafs i
cv2 imwrite save_path|pafs[i]|255
np zeros (logit_heatmap shape|map_h|map_w) heatmaps
cv2 resize logit_heatmap i heatmaps i
cv2 imwrite save_path|heatmaps[i]|255
compute_peaks_from_heatmaps heatmaps all_peaks
np empty  0|len JointType|3|np empty
compute_connections pafs|all_peaks|map_w|params all_connections
grouping_key_points all_connections|all_peaks|params subsets
subsets_to_pose_array subsets|all_peaks poses
subsets scores
cv2 cvtColor orig_img|cv2 COLOR_BGR2RGB orig_img
orig_img copy canvas
poses round astype pose
np array limb limb_ind
pose joint2
cv2 line canvas|tuple joint1|tuple joint2|color|2
cv2 circle canvas|(x|y)|3|color|-1
img x_data
x_data astype x_data
x_data transpose 1|2|0 x_data
get_rank args rank
get_group_size args group_size
os path exists args output_path
os mkdir args output_path
OpenPoseNet vgg_with_bn network
network set_train False
load_model network|args model_path
dataset get_dataset_size dataset_size
dataset create_tuple_iterator de_dataset
print dataset_size
dataset_size total
img asnumpy img
int (img_id asnumpy) img_id
detect img|network scores
enumerate index|pose
dict data
pose round astype pose
pose reshape tolist keypoints
img_id data
scores index data
keypoints data
kpt_json append data
draw_person_pose cv2 cvtColor img|cv2 COLOR_BGR2RGB img
os path join args output_path|str(img_id)| save_path
cv2 imwrite save_path|img
open os path join args output_path|result_json|
json dump kpt_json|fid
evaluate_mAP os path join args output_path|result_json res
print res
argparse ArgumentParser parser parse_known_args _
NullWriter nullwrite sys stdout
sys stdout oldstdout sys stdout
LoadAnn ann_file Gt loadRes res_file Dt
MapEval Gt|Dt|ann_type Eval evaluate
MapEval Gt|Dt|ann_type Eval accumulate
MapEval Gt|Dt|ann_type Eval summarize
MapEval Gt|Dt|ann_type Eval stats ind info_str name
enumerate  peaks_binary
load_checkpoint model_path param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
param_dict items  peaks_binary
load_param_into_net  peaks_binary
img astype x_data transpose 2|0|1[None] x_data
img astype x_data astype x_data
img astype x_data transpose 1|2|0 x_data
os walk files file
os walk dirs d
os walk  peaks_binary
enumerate  peaks_binary
gaussian_filter heatmap|sigma heatmap heatmap
joint_b-joint_a vector unit_vector
np linalg norm vector norm unit_vector
np dot paf_in_edge|unit_vector inner_products sum|len(inner_products) integ_value
candidate_connections append [int joint_a|int int ind_a ind_b
candidate_connections append [int joint_a|int int (img_id asnumpy) img_id
compute_candidate_connections paf|cand_a|cand_b|img_len|params_ candidate_connections index_a|index_b|score
np zeros (0|3) connections ind_a|ind_b|score
candidate_connections score found_subset_1
np vstack [connections|[index_a|index_b|score]] connections ind_a|ind_b|score
all_connections append connections ind_a|ind_b|score
-1|np ones (0|20) subsets joint_found_subset_index found_subset
-1|np ones (0|20) subsets joint_found_subset_index found_subset_1
-1|np ones (0|20) subsets joint_found_subset_index found_subset_2
-1|np ones (0|20) subsets keep subsets
-1|np ones (0|20) subsets subset
-1|np ones (0|20) subsets scores
enumerate connections ind_a|ind_b|score
connections ind_b found_subset joint_b
connections score found_subset_1
connections ind_a found_subset_1 joint_a
connections ind_b found_subset_1 joint_b
connections ind_a found_subset_2 joint_a
connections ind_b found_subset_2 joint_b
connections ind_a row joint_a
connections ind_b row joint_b
int ind_a ind_b found_subset joint_b
int ind_a ind_b found_subset_1 joint_b
int ind_a ind_b found_subset_2 joint_b
int ind_a ind_b row joint_b
enumerate subset_ind joint_found_subset_index joint_found_cnt
enumerate subset astype joint_index
subsets joint_found_subset_index found_subset_2 found_subset_1
subsets joint_found_subset_index found_subset_2 found_subset_1
np vstack [subsets|row] subsets keep subsets
np vstack [subsets|row] subsets subset
np vstack [subsets|row] subsets scores
subsets subset astype joint_index
all_peaks joint_index joint append
img copy orig_img copy canvas
preprocess resized_image x_data astype x_data
preprocess resized_image x_data transpose 1|2|0 x_data
Tensor x_data|mstype float32 x_data astype x_data
Tensor x_data|mstype float32 x_data transpose 1|2|0 x_data
network x_data logit_heatmap asnumpy logit_heatmap
grouping_key_points all_connections|all_peaks|params subsets scores
subsets_to_pose_array subsets|all_peaks poses round astype pose
subsets scores index data
cv2 cvtColor orig_img|cv2 COLOR_BGR2RGB orig_img copy canvas
poses round astype pose joint2
poses round astype pose round astype pose
poses round astype pose reshape tolist keypoints
img x_data astype x_data
img x_data transpose 1|2|0 x_data
OpenPoseNet vgg_with_bn network set_train False
dataset get_dataset_size dataset_size total
print dataset_size total
int (img_id asnumpy) img_id data
detect img|network scores index data
enumerate pose round astype pose
enumerate pose reshape tolist keypoints
pose reshape tolist keypoints data
open os path join args json dump kpt_json|fid
json dump json dump kpt_json|fid
super OpenPoseNet|self __init__
Base_model vgg_with_bn self base
Stage_1 self stage_1
Stage_x self stage_2
Stage_x self stage_3
Stage_x self stage_4
Stage_x self stage_5
Stage_x self stage_6
P Shape self shape
P Print self print
load_checkpoint vggpath param_dict
param_dict items key|values
key startswith
values param_dict_new
load_param_into_net self base vgg_base|param_dict_new
self base x feature_map
self stage_1 feature_map h2
pafs append h1
heatmaps append h2
self stage_2 self cat (h1|h2|feature_map) h2
self stage_3 self cat (h1|h2|feature_map) h2
self stage_4 self cat (h1|h2|feature_map) h2
self stage_5 self cat (h1|h2|feature_map) h2
self stage_6 self cat (h1|h2|feature_map) h2
super Vgg|self __init__
self _make_layer cfg|batch_norm self layers
self layers x x
cfg v
v out_channels
[conv2d|nn BatchNorm2d v] layers
[conv2d|nn ReLU] layers
v in_channels
nn SequentialCell layers
super VGG_Base|self __init__
ReLU self relu
self relu self conv1_1 x x
self relu self conv1_2 x x
self max_pooling_2d x x
self relu self conv2_1 x x
self relu self conv2_2 x x
self relu self conv3_1 x x
self relu self conv3_2 x x
self relu self conv3_3 x x
self relu self conv3_4 x x
self relu self conv4_1 x x
self relu self conv4_2 x x
super VGG_Base_MS|self __init__
self relu self Layer1_1 x x
self relu self Layer1_2 x x
self relu self Layer2_1 x x
self relu self Layer2_2 x x
self relu self Layer3_1 x x
self relu self Layer3_2 x x
self relu self Layer3_3 x x
self relu self Layer3_4 x x
self relu self Layer4_1 x x
self relu self Layer4_2 x x
super Base_model|self __init__
Vgg cfgs_zh|batch_norm self vgg_base
self vgg_base x x
self relu self conv4_3_CPM x x
self relu self conv4_4_CPM x x
super Stage_1|self __init__
self relu self conv1_CPM_L1 x h1
self relu self conv2_CPM_L1 h1 h1
self relu self conv3_CPM_L1 h1 h1
self relu self conv4_CPM_L1 h1 h1
self conv5_CPM_L1 h1 h1
self relu self conv1_CPM_L2 x h2
self relu self conv2_CPM_L2 h2 h2
self relu self conv3_CPM_L2 h2 h2
self relu self conv4_CPM_L2 h2 h2
self conv5_CPM_L2 h2 h2
super Stage_x|self __init__
self relu self conv1_L1 x h1
self relu self conv2_L1 h1 h1
self relu self conv3_L1 h1 h1
self relu self conv4_L1 h1 h1
self relu self conv5_L1 h1 h1
self relu self conv6_L1 h1 h1
self conv7_L1 h1 h1
self relu self conv1_L2 x h2
self relu self conv2_L2 h2 h2
self relu self conv3_L2 h2 h2
self relu self conv4_L2 h2 h2
self relu self conv5_L2 h2 h2
self relu self conv6_L2 h2 h2
self conv7_L2 h2 h2
load_checkpoint vggpath param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new
param_dict items v out_channels
param_dict items v in_channels
cfg v out_channels
cfg v in_channels
train_ self train
dir_name self dir_name
mode_ self mode
train_ getCatIds self catIds
sorted train_ getImgIds catIds self imgIds
len self imgIds
np zeros image_ shape mask_all_1
np zeros image_ shape mask_miss_1
annotations_ ann
self train annToMask ann astype mask
mask_all_1 intxn
np bitwise_or mask_miss_1 astype int mask_miss_1
np bitwise_or mask_all_1 astype int mask_all_1
image_|bimsk astype(np int32) mskd
np ones bimsk shape|bimsk clmsk
range index_1
image_|0 7|clmsk-0 7|mskd image_
image_ astype np uint8
self train annToMask ann astype np uint8 mask
(0|0|1) color
(0|1|0) color
(1|0|0) color
np array reshape  x|y|v
cv2 circle image_|(x|y)|3|(255|255|0)|-1
cv2 circle image_|(x|y)|3|(255|0|255)|-1
self imgIds ind img_id_
self train getAnnIds imgIds anno_ids
self train loadAnns anno_ids annotations_
os path join params img_file
cv2 imread img_file image_
argparse ArgumentParser parser
parser parse_args args
[args train_ann|args val_ann|args train_dir|args val_dir] path_list
enumerate index|mode
ReadJson path_list index train
DataLoader train|path_list|mode_ data_loader
os path join params| format mode save_dir
os path exists save_dir
os makedirs save_dir
tqdm i
data_loader get_img_annotation ind img_id
data_loader gen_masks img|annotations mask_miss
data_loader draw_masks_and_keypoints img|annotations ann_img
data_loader dwaw_gen_masks img|mask_miss msk_img
cv2 imshow np hstack (ann_img|msk_img)
cv2 waitKey k
cv2 imwrite np hstack (ann_img|msk_img)
np any mask_miss
mask_miss astype np uint8|255 mask_miss
os path join save_dir| format img_id save_path
cv2 imwrite save_path|mask_miss
train_ self train data_loader
mode_ self mode data_loader
np zeros image_ shape mask_all_1 intxn
image_|0 7|clmsk-0 7|mskd image_ 7|clmsk-0 7|mskd image_
image_|0 7|clmsk-0 7|mskd image_ astype np uint8
argparse ArgumentParser parser parse_args args
[args train_ann|args val_ann|args train_dir|args val_dir] path_list data_loader
ReadJson path_list index train data_loader
DataLoader train|path_list|mode_ data_loader get_img_annotation ind img_id
DataLoader train|path_list|mode_ data_loader gen_masks img|annotations mask_miss
DataLoader train|path_list|mode_ data_loader draw_masks_and_keypoints img|annotations ann_img
DataLoader train|path_list|mode_ data_loader dwaw_gen_masks img|mask_miss msk_img
data_loader gen_masks img|annotations mask_miss astype np uint8|255 mask_miss
np any mask_miss astype np uint8|255 mask_miss
cv2 setNumThreads
train self train
mode self mode
imgpath self imgpath
maskpath self maskpath
insize self insize
train getCatIds catNms self catIds
sorted train getImgIds catIds self imgIds
self clean_imgIds
random sample self imgIds|n_samples self imgIds
print  format mode|len self
len self imgIds
self imgIds copy img_id
self train loadAnns anno_ids annotations_for_img
annotations_for_img annotation
valid_annotations_for_img append annotation
valid_annotations_for_img annotations
self imgIds remove img_id
((np arctan2 paf|paf|np pi)|-2|0 5) hue
np sqrt paf2|paf2 saturation
saturation copy value
np vstack (hue[np newaxis]|saturation[np newaxis]|value[np newaxis]) transpose 1|2|0 hsv_paf
cv2 cvtColor (hsv_paf|255) astype(np uint8) rgb_paf
cv2 addWeighted img|0 6|rgb_paf|0 4|0 img
np zeros (2|)|img shape mix_paf
np zeros mix_paf shape paf_flags
pafs reshape  int pafs shape paf
np broadcast_to paf_flags paf_flags
paf mix_paf
self overlay_paf img|mix_paf img
cv2 applyColorMap (heatmap|255) astype(np uint8) rgb_heatmap
cv2 addWeighted img|0 6|rgb_heatmap|0 4|0 img
poses pose
pose min x1
pose min y1
pose max x2
pose max y2
pose_bboxes append [x1|y1|x2|y2]
np array pose_bboxes pose_bboxes
img shape _
cv2 resize img|shape resized_img
cv2 resize ignore_mask astype np uint8 ignore_mask
self get_pose_bboxes poses joint_bboxes
params|bbox_sizes min min_scale
params|bbox_sizes max max_scale
min max min_scale|params min_scale
min max max_scale|1 max_scale
float (max_scale-min_scale)|random random|min_scale scale
(round(w|scale)) shape
self resize_data img|ignore_mask|poses|shape resized_poses
np random randn|3|params degree
degree|math pi|180 rad
(w|2|h|2) center
cv2 getRotationMatrix2D center|degree|1 R
(w|abs(math cos rad)|h|abs(math sin rad)) bbox
cv2 warpAffine mask astype|255|R|(int(bbox|0 5)) rotate_mask
np ones_like poses tmp_poses
np dot tmp_poses|R T tmp_rotate_poses
poses copy rotate_poses
tmp_rotate_poses rotate_poses
self insize insize
random choice joint_bboxes bbox
bbox|(bbox-bbox)|2 bbox_center
np random rand r_xy
((r_xy-0 5)|2|params) perturb
(bbox_center|perturb|0 5) astype center
np zeros (insize|insize|3) crop_img
np zeros (insize|insize) crop_mask
(center-(insize-1)|2|0 5) astype offset
(center|(insize-1)|2-(w-1|h-1)|0 5) astype offset_
(center-(insize-1)|2|0 5) astype y1
(center|(insize-1)|2|0 5) astype y2
max x1|0 x1
max y1|0 y1
min x2|w-1 x2
min y2|h-1 y2
-offsetifoffset x_from
-offsetifoffset y_from
crop_img astype
np broadcast_to np array 255|dtype img_max
np zeros img shape|dtype img_min
cv2 cvtColor img copy|cv2 COLOR_BGR2HSV astype(np int32) hsv_img
hsv_img astype np uint8 hsv_img
cv2 cvtColor hsv_img|cv2 COLOR_HSV2BGR distorted_img
cv2 flip img|1 flipped_img
cv2 flip mask astype np uint8 flipped_mask
poses copy tmp
tmp poses
swap_joints poses|JointType LeftEye|JointType RightEye
swap_joints poses|JointType LeftEar|JointType RightEar
swap_joints poses|JointType LeftShoulder|JointType RightShoulder
swap_joints poses|JointType LeftElbow|JointType RightElbow
swap_joints poses|JointType LeftHand|JointType RightHand
swap_joints poses|JointType LeftWaist|JointType RightWaist
swap_joints poses|JointType LeftKnee|JointType RightKnee
swap_joints poses|JointType LeftFoot|JointType RightFoot
img copy aug_img
self random_resize_img aug_img|ignore_mask|poses poses
self random_rotate_img aug_img|ignore_mask|poses poses
self random_crop_img aug_img|ignore_mask|poses poses
np random randint
self distort_color aug_img aug_img
self flip_img aug_img|ignore_mask|poses poses
joint y
np tile np arange shape grid_x
np tile np arange shape grid_y
(grid_x-x)2|(grid_y-y)2 grid_distance
np exp -0 5|grid_distance|sigma2 gaussian_heatmap
np zeros (0|)|img shape heatmaps
np zeros img shape sum_heatmap
range joint_index
np zeros img shape heatmap
self generate_gaussian_heatmap img shape|pose[joint_index]|heatmap_sigma jointmap
jointmap[jointmap heatmap]
jointmap[jointmap sum_heatmap]
np vstack (heatmaps|heatmap ((1|)|heatmap shape)) heatmaps
np vstack (heatmaps|bg_heatmap[None]) heatmaps
heatmaps astype
grid_x|0 4375 grid_x
grid_y|0 4375 grid_y
(img shape||8|img shape||8) resize_shape
np zeros (0|)|resize_shape heatmaps
np zeros resize_shape sum_heatmap
np zeros resize_shape heatmap
jointmap index_1
jointmap index_1 heatmap index_1
jointmap index_2
jointmap index_2 sum_heatmap index_2
np array_equal joint_from|joint_to
np zeros (2|)|shape
np linalg norm joint_to-joint_from joint_distance
(joint_to-joint_from)|joint_distance unit_vector
np pi|2 rad
np array [[np cos rad]] rot_matrix
np dot rot_matrix|unit_vector vertical_unit_vector
unit_vector|(grid_x-joint_from)|unit_vector|(grid_y-joint_from) horizontal_inner_product
vertical_unit_vector|(grid_x-joint_from)|vertical_unit_vector| vertical_inner_product
np abs vertical_inner_product vertical_paf_flag
horizontal_paf_flag paf_flag
np stack (paf_flag|paf_flag)| constant_paf
np broadcast_to unit_vector|shape| 2| transpose 2|0|1
np zeros (0|)|img shape pafs
params limb
np zeros (2|)|img shape paf
np zeros paf shape paf_flags
pose limb joint_to
self generate_constant_paf img shape|joint_from|joint_to|paf_sigma limb_paf
np broadcast_to limb_paf_flags paf_flags
limb_paf paf
np vstack (pafs|paf) pafs
pafs astype
(img shape||8|img shape||8|3) resize_shape
np zeros (0|)|resize_shape pafs
np zeros (2|)|resize_shape paf
self generate_constant_paf_fast resize_shape|joint_from|8|joint_to|8|paf_sigma|8 limb_paf
paf_flags index_1
self imgIds ind img_id
os path join self imgpath|self train loadImgs [img_id] img_path
os path join self maskpath| format img_id mask_path
cv2 imread img_path img
cv2 imread mask_path|0 ignore_mask
np zeros img shape|np float32 ignore_mask
ignore_mask astype
np zeros (0|len(JointType)) poses
annotations ann
np array ann reshape -1|3 ann_pose
np zeros (1|len(JointType)) pose
enumerate i|joint_index
ann_pose i pose joint_index
np vstack (poses|pose) poses
np zeros (input_np shape|map_h|map_w) output
range i
cv2 resize input_np i output i
output astype
input_np astype input_np
cv2 resize input_np|(map_h|map_w) output
self augment_data img|ignore_mask|poses poses
self generate_heatmaps_fast resized_img|resized_poses|params resized_heatmaps
self generate_pafs_fast resized_img|resized_poses|params resized_pafs
cv2 morphologyEx ignore_mask astype ignore_mask
self resize_output ignore_mask resized_ignore_mask
img astype x_data
x_data transpose 2|0|1 x_data
self get_img_annotation ind ignore_mask
np array [img_id]
print img_id
self imgIds[np random randint len self] img_id
self get_img_annotation img_id ignore_mask
self parse_annotation annotations poses
self generate_labels img|poses|ignore_mask ignore_mask
self preprocess resized_img resized_img
dataset self dataset
rank self rank
group_size self group_size
len self dataset self dataset_len
int math ceil self dataset_len|1 0|self group_size self num_samplers
self num_samplers|self group_size self total_size
shuffle self shuffle
seed self seed
(self seed|1) self seed
np random seed self seed
np random permutation self dataset_len tolist indices
list range len self dataset_len indices
iter indices
ReadJson jsonpath val
txtdataset val|imgpath|maskpath|params|mode dataset
DistributedSampler dataset|rank|group_size sampler
ds repeat ds
ReadJson jsonpath train
txtdataset train|imgpath|maskpath|params|mode dataset
num_worker num_parallel_workers
multiprocessing python_multiprocessing
group_size num_shards
de_dataset repeat repeat_num de_dataset
print  format mode|len self imgIds copy img_id
print  format mode|len self train loadAnns anno_ids annotations_for_img
print  format mode|len self imgIds remove img_id
print  format mode|len self overlay_paf img|mix_paf img
print  format mode|len self get_pose_bboxes poses joint_bboxes
print  format mode|len self resize_data img|ignore_mask|poses|shape resized_poses
print  format mode|len self insize insize
print  format mode|len self random_resize_img aug_img|ignore_mask|poses poses
print  format mode|len self random_rotate_img aug_img|ignore_mask|poses poses
print  format mode|len self random_crop_img aug_img|ignore_mask|poses poses
print  format mode|len self distort_color aug_img aug_img
print  format mode|len self flip_img aug_img|ignore_mask|poses poses
print  format mode|len self generate_gaussian_heatmap img shape|pose[joint_index]|heatmap_sigma jointmap
print  format mode|len self generate_constant_paf img shape|joint_from|joint_to|paf_sigma limb_paf
print  format mode|len self generate_constant_paf_fast resize_shape|joint_from|8|joint_to|8|paf_sigma|8 limb_paf
print  format mode|len self imgIds ind img_id
print  format mode|len self augment_data img|ignore_mask|poses poses
print  format mode|len self generate_heatmaps_fast resized_img|resized_poses|params resized_heatmaps
print  format mode|len self generate_pafs_fast resized_img|resized_poses|params resized_pafs
print  format mode|len self resize_output ignore_mask resized_ignore_mask
print  format mode|len self get_img_annotation ind ignore_mask
print  format mode|len self imgIds[np random randint len self] img_id
print  format mode|len self get_img_annotation img_id ignore_mask
print  format mode|len self parse_annotation annotations poses
print  format mode|len self generate_labels img|poses|ignore_mask ignore_mask
print  format mode|len self preprocess resized_img resized_img
print  format mode|len self num_samplers|self group_size self total_size
self train loadAnns anno_ids annotations_for_img annotation
valid_annotations_for_img annotations ann
np sqrt paf2|paf2 saturation copy value
cv2 addWeighted img|0 6|rgb_paf|0 4|0 img shape _
cv2 addWeighted img|0 6|rgb_paf|0 4|0 img copy aug_img
cv2 addWeighted img|0 6|rgb_paf|0 4|0 img astype x_data
cv2 addWeighted img|0 6|rgb_paf|0 4|0 img dataset
cv2 addWeighted img|0 6|rgb_paf|0 4|0 img dataset
np zeros mix_paf shape paf_flags index_1
pafs reshape  int pafs shape paf mix_paf
np broadcast_to paf_flags paf_flags index_1
self overlay_paf img|mix_paf img shape _
self overlay_paf img|mix_paf img copy aug_img
self overlay_paf img|mix_paf img astype x_data
self overlay_paf img|mix_paf img dataset
self overlay_paf img|mix_paf img dataset
cv2 addWeighted img|0 6|rgb_heatmap|0 4|0 img shape _
cv2 addWeighted img|0 6|rgb_heatmap|0 4|0 img copy aug_img
cv2 addWeighted img|0 6|rgb_heatmap|0 4|0 img astype x_data
cv2 addWeighted img|0 6|rgb_heatmap|0 4|0 img dataset
cv2 addWeighted img|0 6|rgb_heatmap|0 4|0 img dataset
poses pose min x1
poses pose min y1
poses pose max x2
poses pose max y2
poses pose limb joint_to
cv2 resize ignore_mask astype np uint8 ignore_mask astype
float (max_scale-min_scale)|random random|min_scale scale shape
np random randn|3|params degree pi|180 rad
(w|2|h|2) center 5) astype center
(w|2|h|2) center 5) astype offset_
(w|2|h|2) center 5) astype y2
(w|abs(math cos rad)|h|abs(math sin rad)) bbox bbox_center
np dot tmp_poses|R T tmp_rotate_poses rotate_poses
random choice joint_bboxes bbox bbox_center
bbox|(bbox-bbox)|2 bbox_center 5) astype center
((r_xy-0 5)|2|params) perturb 5) astype center
(bbox_center|perturb|0 5) astype center 5) astype center
(bbox_center|perturb|0 5) astype center 5) astype offset_
(bbox_center|perturb|0 5) astype center 5) astype y2
np zeros (insize|insize|3) crop_img astype
cv2 cvtColor img copy|cv2 COLOR_BGR2HSV astype(np int32) hsv_img astype np uint8 hsv_img
poses copy tmp poses
joint y 4375 grid_y
np tile np arange shape grid_x 4375 grid_x
np tile np arange shape grid_y 4375 grid_y
np zeros (0|)|img shape heatmaps astype
self generate_gaussian_heatmap img shape|pose[joint_index]|heatmap_sigma jointmap index_1
self generate_gaussian_heatmap img shape|pose[joint_index]|heatmap_sigma jointmap index_1 heatmap index_1
self generate_gaussian_heatmap img shape|pose[joint_index]|heatmap_sigma jointmap index_2
self generate_gaussian_heatmap img shape|pose[joint_index]|heatmap_sigma jointmap index_2 sum_heatmap index_2
np vstack (heatmaps|heatmap ((1|)|heatmap shape)) heatmaps astype
np vstack (heatmaps|bg_heatmap[None]) heatmaps astype
grid_x|0 4375 grid_x 4375 grid_x
grid_y|0 4375 grid_y 4375 grid_y
np linalg norm joint_to-joint_from joint_distance unit_vector
(joint_to-joint_from)|joint_distance unit_vector horizontal_inner_product
(joint_to-joint_from)|joint_distance unit_vector vertical_inner_product
np dot rot_matrix|unit_vector vertical_unit_vector vertical_inner_product
np zeros (0|)|img shape pafs astype
np zeros paf shape paf_flags index_1
self generate_constant_paf img shape|joint_from|joint_to|paf_sigma limb_paf paf
np broadcast_to limb_paf_flags paf_flags index_1
np vstack (pafs|paf) pafs astype
cv2 imread img_path img astype x_data
cv2 imread img_path img dataset
cv2 imread img_path img dataset
cv2 imread mask_path|0 ignore_mask astype
np zeros img shape|np float32 ignore_mask astype
np array ann reshape -1|3 ann_pose i pose joint_index
np zeros (input_np shape|map_h|map_w) output astype
range i dataset
range i dataset
cv2 resize input_np i output i dataset
cv2 resize input_np i output i dataset
img astype x_data transpose 2|0|1 x_data
ReadJson jsonpath val dataset
ReadJson jsonpath train dataset
C MultitypeFuncGraph grad_scale
C MultitypeFuncGraph _grad_overflow
P Reciprocal reciprocal
params GRADIENT_CLIP_TYPE
params GRADIENT_CLIP_VALUE
C MultitypeFuncGraph clip_grad
clip_grad register
F dtype grad dt
nn ClipByNorm grad|F cast(F tuple_to_array (clip_value|)) new_grad
super openpose_loss|self __init__
P ExpandDims self expand_dims
P Tile self tile
P Mul self mul
P L2Loss self l2_loss
P Square self square
P ReduceMean self reduceMean
P ReduceSum self reduceSum
P Print self print
P Shape self shape
P ArgMaxWithValue self maxoftensor
self reduceMean (map1-map2)2 mse
self square map1-map2 squareMap
self mul squareMap|mask squareMap_mask
self reduceMean squareMap_mask mse
self tile self expand_dims ignore_mask|1 paf_masks
self tile self expand_dims ignore_mask|1 heatmap_masks
F stop_gradient paf_masks paf_masks
F stop_gradient heatmap_masks heatmap_masks
zip logit_paf_t|logit_heatmap_t
self mean_square_error logit_paf_t|gt_paf|paf_masks pafs_loss_t
self mean_square_error logit_heatmap_t|gt_heatmap|heatmap_masks heatmaps_loss_t
pafs_loss_t|heatmaps_loss_t total_loss
heatmaps_loss append heatmaps_loss_t
pafs_loss append pafs_loss_t
super BuildTrainNetwork|self __init__
network self network
criterion self criterion
self network input_data logit_heatmap
self criterion logit_pafs|logit_heatmap|gt_paf|gt_heatmap|mask _
self network set_grad
optimizer parameters self weights
optimizer self optimizer
C HyperMap self hyper_map
sens self sens
_get_parallel_mode parallel_mode
_get_gradients_mean mean
_get_device_num degree
DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
self weights weights
self network |inputs loss
P Fill P DType loss sens
self grad self network|weights(|inputs|sens) grads
self hyper_map F partial clip_grad|GRADIENT_CLIP_TYPE|GRADIENT_CLIP_VALUE grads
self grad_reducer grads grads
F depend loss|self optimizer grads
C MultitypeFuncGraph clip_grad register
self mean_square_error logit_paf_t|gt_paf|paf_masks pafs_loss_t total_loss
self mean_square_error logit_heatmap_t|gt_heatmap|heatmap_masks heatmaps_loss_t total_loss
super MyLossMonitor|self __init__
per_print_times self _per_print_times
time time self _start_time
run_context original_args cb_params
cb_params net_outputs loss
isinstance loss|(tuple|list)
isinstance loss|Tensorandisinstance loss asnumpy|np ndarray
np mean loss asnumpy loss
(cb_params cur_step_num-1)%cb_params batch_num|1 cur_step_in_epoch
isinstance loss|floatand np isnan lossornp isinf loss
self _loss_list append loss
super MyScaleSensCallback|self __init__
loss_scale_list self loss_scale_list
epoch_list self epoch_list
loss_scale_list self scaling_sens
cb_params cur_epoch_num epoch
enumerate i|_
self loss_scale_list self scaling_sens
Tensor self scaling_sens|dtype scaling_sens_tensor
cb_params train_network set_sense_scale scaling_sens_tensor
print  format self scaling_sens
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step learning_rate
float current_step-warmup_steps|float(decay_steps) base
(1|math cos(base|math pi))|2|base_lr learning_rate
range i
lr append _linear_warmup_learning_rate i|warmup_steps|base_lr|base_lr|warmup_ratio
lr append _a_cosine_learning_rate i|base_lr|warmup_steps|total_steps
np array [lr]|steps_per_epoch|max_epoch_train astype lr_stage
lr_steps step
np array lr_stage astype lr_stage
ValueError  format lr_type
lr_stage copy lr_base
lr_base|4 lr_base
lr_base copy lr_vgg
load_checkpoint model_path param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net test_net|param_dict_new
np zeros astype self loss_list
name self name
enumerate i|loss_tensor
loss_tensor asnumpy self loss_list i
tensor asnumpy self loss
self loss|(self sum|1e-8) avergeLoss
run_context original_args cb_params net_outputs loss
run_context original_args cb_params cur_epoch_num epoch
run_context original_args cb_params train_network set_sense_scale scaling_sens_tensor
float current_step-warmup_steps|float(decay_steps) base lr_base
lr append _linear_warmup_learning_rate lr append _linear_warmup_learning_rate i|warmup_steps|base_lr|base_lr|warmup_ratio
lr append _linear_warmup_learning_rate lr append _a_cosine_learning_rate i|base_lr|warmup_steps|total_steps
lr append _a_cosine_learning_rate lr append _a_cosine_learning_rate i|base_lr|warmup_steps|total_steps
np array [lr]|steps_per_epoch|max_epoch_train astype lr_stage copy lr_base
np array lr_stage astype lr_stage copy lr_base
lr_stage copy lr_base lr_base
lr_stage copy lr_base copy lr_vgg
lr_base|4 lr_base lr_base
lr_base|4 lr_base copy lr_vgg
load_checkpoint model_path param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
enumerate loss_tensor asnumpy self loss_list i
get_network args|kwargs
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
get_network num_classes net
load_checkpoint args ckpt_file param_dict
load_param_into_net net|param_dict
[args batch_size|3|args height|args width] input_shp
Tensor np random uniform -1 0|1 0|size input_array
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
load_param_into_net net|param_dict
super BuildTrainNetwork|self __init__
network self network
criterion self criterion
self network input_data output
self criterion output|label loss
super ProgressMonitor|self __init__
args self args
self args logger info
run_context original_args cb_params
cb_params cur_step_num-1 me_step
me_step||self args steps_per_epoch real_epoch
time time-self me_epoch_start_time time_used
self args per_batch_size|(me_step-self me_epoch_start_step_num)|self args group_size|time_used fps_mean
glob glob os path join self args outputs_dir| ckpts
ckpts ckpt
os path basename ckpt ckpt_fn
ckpt_fn startswith  format self args rank
self ckpt_history append ckpt
me_step self me_epoch_start_step_num
time time self me_epoch_start_time
argparse ArgumentParser parser
parser parse_known_args _
merge_args args|cloud_args args
config image_size args image_size
config num_classes args num_classes
config lr args lr
config lr_scheduler args lr_scheduler
config lr_epochs args lr_epochs
config lr_gamma args lr_gamma
config eta_min args eta_min
config T_max args T_max
config max_epoch args max_epoch
config warmup_epochs args warmup_epochs
config weight_decay args weight_decay
config momentum args momentum
config is_dynamic_loss_scale args is_dynamic_loss_scale
config loss_scale args loss_scale
config label_smooth args label_smooth
config label_smooth_factor args label_smooth_factor
config ckpt_interval args ckpt_interval
config ckpt_save_max args ckpt_save_max
config ckpt_path args ckpt_path
config is_save_on_master args is_save_on_master
config rank args rank
config group_size args group_size
list map int|args lr_epochs split args lr_epochs
list map int|args image_size split args image_size
get_rank args rank
get_group_size args group_size
get_logger args outputs_dir|args rank args logger
vars args args_dict
isinstance cloud_args|dict
cloud_args keys key
cloud_args key val
type args_dict key arg_type
type None
arg_type val val
val args_dict key
parse_args cloud_args args
os getenv isdigit
int context set_context(device_id os getenv)
ParallelMode DATA_PARALLEL parallel_mode
de_dataset get_dataset_size args steps_per_epoch
args logger save_args args
args logger important_info
get_network num_classes network
load_pretrain_model args pretrained|network|args
get_lr args lr
Tensor lr learning_rate
args momentum momentum
args weight_decay weight_decay
CrossEntropy smooth_factor loss
ProgressMonitor args progress_cb
[progress_cb|] callbacks
os path join args outputs_dir save_ckpt_path
save_ckpt_path directory
callbacks append ckpt_cb
run_context original_args cb_params cur_step_num-1 me_step
cb_params cur_step_num-1 me_step args steps_per_epoch real_epoch
cb_params cur_step_num-1 me_step self me_epoch_start_step_num
glob glob os path join self args outputs_dir| ckpts ckpt
os path basename ckpt ckpt_fn startswith  format self args rank
argparse ArgumentParser parser parse_known_args _
merge_args args|cloud_args args logger save_args args
merge_args args|cloud_args args logger important_info
merge_args args|cloud_args args momentum momentum
merge_args args|cloud_args args weight_decay weight_decay
isinstance cloud_args keys key
isinstance cloud_args key val
isinstance args logger save_args args
isinstance args logger important_info
isinstance args momentum momentum
isinstance args weight_decay weight_decay
cloud_args key val args_dict key
type args_dict key arg_type val val
arg_type val val args_dict key
parse_args cloud_args args logger save_args args
parse_args cloud_args args logger important_info
parse_args cloud_args args momentum momentum
parse_args cloud_args args weight_decay weight_decay
load_pretrain_model args args momentum momentum
load_pretrain_model args args weight_decay weight_decay
ProgressMonitor args progress_cb callbacks
[progress_cb|] callbacks append ckpt_cb
os path join args outputs_dir save_ckpt_path directory
super ParameterReduce|self __init__
P Cast self cast
P AllReduce self reduce
self cast F scalar_to_array|mstype float32 one
x|one out
self reduce out ret
argparse ArgumentParser parser
parser parse_known_args _
merge_args args|cloud_args args
config image_size args image_size
config num_classes args num_classes
config rank args rank
config group_size args group_size
list map int|args image_size split args image_size
get_rank args rank
get_group_size args group_size
get_logger args outputs_dir|args rank args logger
zip top5|gt
vars args args_dict
isinstance cloud_args|dict
cloud_args keys key
cloud_args key val
type args_dict key arg_type
type None
arg_type val val
val args_dict key
 [top1_correct]|[top5_correct]|[img_tot] results
model replace model_md5
os path exists tmp_dir
os mkdir tmp_dir
np save top1_correct_npy|top1_correct
np save top5_correct_npy|top5_correct
np save img_tot_npy|img_tot
range other_rank
os path exists top1_correct_npyornotos path exists top5_correct_npy
os path exists img_tot_npy
np load top1_correct_npy top1_correct_all
np load top5_correct_npy top5_correct_all
np load img_tot_npy img_tot_all
 [top1_correct_all]|[top5_correct_all]|[img_tot_all] results
np array results results
parse_args cloud_args args
os getenv isdigit
int context set_context(device_id os getenv)
ParallelMode DATA_PARALLEL parallel_mode
args logger save_args args
args logger important_info
os path isdir args pretrained
list glob glob os path join args pretrained| models
print models
sorted models|key args models
[args pretrained|] args models
args models model
args per_batch_size per_batch_size
get_network num_classes network
load_pretrain_model model|network|args
network to_float mstype float16
auto_mixed_precision network
network set_train False
time time t_end
eval_dataloader data|gt_classes
network Tensor data|mstype float32 output
output asnumpy output
np argmax output top1_output
np argsort output top5_output
np equal top1_output|gt_classes sum t1_correct
t1_correct top1_correct
get_top5_acc top5_output|gt_classes top5_correct
args per_batch_size img_tot
time time-t_end time_used
(img_tot-args per_batch_size)args group_size|time_used fps
args logger info  format fps
get_result args|model|top1_correct|top5_correct|img_tot results
results 0|0 top1_correct
results 1|0 top5_correct
results 2|0 img_tot
self cast F scalar_to_array|mstype float32 one out
argparse ArgumentParser parser parse_known_args _
merge_args args|cloud_args args logger save_args args
merge_args args|cloud_args args logger important_info
merge_args args|cloud_args args models model
merge_args args|cloud_args args per_batch_size per_batch_size
merge_args args|cloud_args args per_batch_size img_tot
merge_args args|cloud_args args logger info  format fps
zip  [top1_correct]|[top5_correct]|[img_tot] results
zip  [top1_correct_all]|[top5_correct_all]|[img_tot_all] results
isinstance cloud_args keys key
isinstance cloud_args key val
isinstance  [top1_correct]|[top5_correct]|[img_tot] results
isinstance  [top1_correct_all]|[top5_correct_all]|[img_tot_all] results
isinstance args logger save_args args
isinstance args logger important_info
isinstance args models model
isinstance args per_batch_size per_batch_size
isinstance args per_batch_size img_tot
isinstance args logger info  format fps
cloud_args keys key args models
cloud_args key val args_dict key
type args_dict key arg_type val val
arg_type val val args_dict key
val args_dict key args models
 [top1_correct]|[top5_correct]|[img_tot] results 0|0 top1_correct
 [top1_correct]|[top5_correct]|[img_tot] results 1|0 top5_correct
 [top1_correct]|[top5_correct]|[img_tot] results 2|0 img_tot
np save  [top1_correct_all]|[top5_correct_all]|[img_tot_all] results
np save  [top1_correct_all]|[top5_correct_all]|[img_tot_all] results
np save  [top1_correct_all]|[top5_correct_all]|[img_tot_all] results
 [top1_correct_all]|[top5_correct_all]|[img_tot_all] results 0|0 top1_correct
 [top1_correct_all]|[top5_correct_all]|[img_tot_all] results 1|0 top5_correct
 [top1_correct_all]|[top5_correct_all]|[img_tot_all] results 2|0 img_tot
np array results results 0|0 top1_correct
np array results results 1|0 top5_correct
np array results results 2|0 img_tot
parse_args cloud_args args logger save_args args
parse_args cloud_args args logger important_info
parse_args cloud_args args models model
parse_args cloud_args args per_batch_size per_batch_size
parse_args cloud_args args per_batch_size img_tot
parse_args cloud_args args logger info  format fps
list glob glob os path join args pretrained| models args models
print models args models
sorted models|key args models args models
get_network num_classes network to_float mstype float16
get_network num_classes network set_train False
get_network num_classes network Tensor data|mstype float32 output
load_pretrain_model network to_float mstype float16
load_pretrain_model network set_train False
load_pretrain_model network Tensor data|mstype float32 output
load_pretrain_model args per_batch_size img_tot
load_pretrain_model args logger info  format fps
auto_mixed_precision network set_train False
auto_mixed_precision network Tensor data|mstype float32 output
network Tensor data|mstype float32 output asnumpy output
np equal top1_output|gt_classes sum t1_correct top1_correct
get_result args|model|top1_correct|top5_correct|img_tot results 0|0 top1_correct
get_result args|model|top1_correct|top5_correct|img_tot results 1|0 top5_correct
get_result args|model|top1_correct|top5_correct|img_tot results 2|0 img_tot
super CrossEntropy|self __init__
P OneHot self onehot
Tensor 1 0-smooth_factor|mstype float32 self on_value
Tensor 1 0|smooth_factor|(num_classes-1) self off_value
nn SoftmaxCrossEntropyWithLogits self ce
P ReduceMean False self mean
self onehot label|F shape logit one_hot_label
self ce logit|one_hot_label loss
self mean loss|0 loss
 config
super ImageClassificationNetwork|self __init__
backbone self backbone
include_top self include_top
head self head
P Sigmoid self activation
P Softmax self activation
NotImplementedError f
self backbone x x
self head x x
self activation x x
backbone_name self backbone_name
backbones __dict__ self backbone_name backbone
backbone get_out_channels out_channels
heads CommonHead num_classes head
super Resnet|self __init__ backbone|head|include_top|activation
default_recurisive_init self
self cells_and_names cell
isinstance cell|nn Conv2d
isinstance cell|nn BatchNorm2d
cell gamma set_data init initializer cell gamma shape
cell beta set_data init initializer cell beta shape
isinstance cell|backbones resnet Bottleneck
cell bn3 gamma set_data init initializer cell bn3 gamma shape
isinstance cell|backbones resnet BasicBlock
cell bn2 gamma set_data init initializer cell bn2 gamma shape
Resnet kwargs
backbones __dict__ self backbone_name backbone get_out_channels out_channels
default_recurisive_init self cells_and_names cell
self cells_and_names cell gamma set_data init initializer cell gamma shape
self cells_and_names cell beta set_data init initializer cell beta shape
self cells_and_names cell bn3 gamma set_data init initializer cell bn3 gamma shape
self cells_and_names cell bn2 gamma set_data init initializer cell bn2 gamma shape
current_step int
warmup_steps int
base_lr float
init_lr float
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step lr
lr float
steps_per_epoch int
warmup_epochs int
max_epoch int
T_max int
eta_min float
lr base_lr
int max_epoch|steps_per_epoch total_steps
int warmup_epochs|steps_per_epoch warmup_steps
range i
i||steps_per_epoch last_epoch
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr
eta_min|(base_lr-eta_min)|(1 |math cos(math pi|last_epoch|T_max))|2 lr
lr_each_step append lr
np array lr_each_step astype np float32
lr_epochs list
gamma float
lr_epochs milestones
milestones milestone
milestone|steps_per_epoch milestones_step
milestones_steps append milestones_step
base_lr lr
Counter milestones_steps milestones_steps_counter
lr|gammamilestones_steps_counter[i] lr
lr_epochs append i
args lr_gamma gamma
NotImplementedError args lr_scheduler
current_step int max_epoch|steps_per_epoch total_steps
current_step int warmup_epochs|steps_per_epoch warmup_steps
warmup_steps int max_epoch|steps_per_epoch total_steps
warmup_steps int warmup_epochs|steps_per_epoch warmup_steps
base_lr float lr_inc
base_lr float init_lr|lr_inc|current_step lr
init_lr float lr_inc
init_lr float init_lr|lr_inc|current_step lr
float init_lr|lr_inc|current_step lr float
float init_lr|lr_inc|current_step lr base_lr
float init_lr|lr_inc|current_step lr lr
steps_per_epoch int max_epoch|steps_per_epoch total_steps
steps_per_epoch int warmup_epochs|steps_per_epoch warmup_steps
warmup_epochs int max_epoch|steps_per_epoch total_steps
warmup_epochs int warmup_epochs|steps_per_epoch warmup_steps
max_epoch int max_epoch|steps_per_epoch total_steps
max_epoch int warmup_epochs|steps_per_epoch warmup_steps
T_max int max_epoch|steps_per_epoch total_steps
T_max int warmup_epochs|steps_per_epoch warmup_steps
lr base_lr lr
range i last_epoch
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr lr
eta_min|(base_lr-eta_min)|(1 |math cos(math pi|last_epoch|T_max))|2 lr lr
lr_each_step append lr lr
lr_epochs milestones milestone
milestones milestone milestones_step
base_lr lr lr
lr|gammamilestones_steps_counter[i] lr lr
super LOGGER|self __init__ logger_name
logging StreamHandler sys stdout console
console setLevel logging INFO
logging Formatter formatter
console setFormatter formatter
self addHandler console
rank self rank
os path exists log_dir
datetime now strftime| format rank log_name
os path join log_dir|log_name self log_fn
logging FileHandler self log_fn fh
fh setLevel logging INFO
fh setFormatter formatter
self addHandler fh
self isEnabledFor logging INFO
self _log logging INFO|msg|args|kwargs
self info
vars args args_dict
args_dict keys key
self info key|args_dict[key]
|line_width important_msg
|2 important_msg
self info important_msg|args|kwargs
LOGGER rank logger
logger setup_logging_file path|rank
logging StreamHandler sys stdout console setLevel logging INFO
logging StreamHandler sys stdout console setFormatter formatter
logging FileHandler self log_fn fh setLevel logging INFO
logging FileHandler self log_fn fh setFormatter formatter
vars args args_dict keys key
LOGGER rank logger setup_logging_file path|rank
op self _op
validator check_type_name to_type|[mstype float16|mstype float32]|None
to_type self to_type
F cast self _op x|self to_type
network name_cells cells
network to_float mstype float16
cells name
cells name subcell
network insert_child_to_cell name|OutputTo subcell|mstype float32
isinstance subcell|(nn BatchNorm2d|nn BatchNorm1d)
network insert_child_to_cell name|OutputTo subcell to_float mstype float32|mstype float16
auto_mixed_precision subcell
isinstance network|nn SequentialCell
list network cells network cell_list
network name_cells cells name
network name_cells cells name subcell
network trainable_params x
x name parameter_name
parameter_name endswith
no_decay_params append x
decay_params append x
network trainable_params x name parameter_name
x name parameter_name endswith
math sqrt
isinstance param|boolandisinstance param|intorisinstance param|float
param negative_slope
ValueError  format param
math sqrt 2 0|(1|negative_slope2)
ValueError  format nonlinearity
arr reshape arr
num arr
isinstance num|np ndarray
len arr shape dim
arr shape n_in
arr shape n_out
mode lower mode
ValueError  format mode|valid_modes
_calculate_in_and_out array fan_out
super KaimingInit|self __init__
mode self mode
_calculate_gain nonlinearity|a self gain
mathcal{U}(-\text{bound}|\text{bound})
 text{bound}
np empty 3|5 w
_select_fan arr|self mode fan
math sqrt|self gain|math sqrt fan bound
np random uniform -bound|bound|arr shape data
_assignment arr|data
mathcal{N}(0|\text{std}^2)
 text{std}
self gain|math sqrt fan std
np random normal 0|std|arr shape data
custom_cell cells_and_names _|cell
isinstance cell|nn Conv2d
_calculate_in_and_out cell weight _
isinstance cell|nn Dense
isinstance cell|(nn BatchNorm2d|nn BatchNorm1d)
os path isfile ckpt_file
load_checkpoint ckpt_file param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
args logger info  format ckpt_file
isinstance param|boolandisinstance param|intorisinstance param negative_slope
isinstance param|boolandisinstance param|intorisinstance  text{bound}
isinstance param|boolandisinstance param|intorisinstance  text{std}
math sqrt 2  text{bound}
math sqrt 2  text{std}
num arr shape n_in
num arr shape n_out
ValueError  format mode self mode
ValueError  format  text{bound}
ValueError  format  text{std}
_assignment  text{std}
load_checkpoint ckpt_file param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
super GlobalAvgPooling|self __init__
P ReduceMean False self mean
self mean x|(2|3) x
super SEBlock|self __init__
GlobalAvgPooling self avg_pool
nn Dense channel|channel||reduction self fc1
P ReLU self relu
nn Dense channel||reduction|channel self fc2
P Sigmoid self sigmoid
P Reshape self reshape
P Shape self shape
P Sum self sum
P Cast self cast
self shape x c
self avg_pool x y
self reshape y|(b|c) y
self fc1 y y
self relu y y
self fc2 y y
self sigmoid y y
self reshape y|(b|c|1|1) y
super GroupConv|self __init__
groups self groups
nn CellList self convs
range _
kernel_size|stride kernel_size
self op_split x features
range i
outputs|(self convs i cast(features[i]|mstype float32))) outputs
self op_concat outputs out
kernel_size|stride kernel_size kernel_size
outputs|(self convs i cast(features[i]|mstype float32))) outputs convs i cast(features[i]|mstype float32))) outputs
dataset self dataset
rank self rank
group_size self group_size
len self dataset self dataset_length
int math ceil self dataset_length|1 0|self group_size self num_samples
self num_samples|self group_size self total_size
shuffle self shuffle
seed self seed
(self seed|1) self seed
np random seed self seed
np random permutation self dataset_length tolist indices
list range len self dataset_length indices
iter indices
super TxtDataset|self __init__
open txt_name fin
line strip split label
self imgs append os path join root|img_name
self labels append int label
fin close
Image open self imgs index img
len self imgs
 Union int|sequence
[0 485|255|0 456|255|0 406|255] mean
[0 229|255|0 224|255|0 225|255] std
(0 08|1 0) scale
mean mean|std std V_C Normalize
V_C HWC2CHW
V_C Decode
V_C Resize (256|256)
V_C CenterCrop image_size
transform transform_img
[C TypeCast mstype int32] transform_label
target_transform transform_label
shuffle|sampler shuffle
TxtDataset root|data_dir dataset
DistributedSampler dataset|rank|group_size|shuffle sampler
de GeneratorDataset dataset||sampler de_dataset
de_dataset project columns de_dataset
de_dataset batch per_batch_size|drop_remainder de_dataset
de_dataset repeat max_epoch de_dataset
open txt_name fin close
self imgs append os path join  Union int|sequence
 Union  Union int|sequence
[0 485|255|0 456|255|0 406|255] mean mean|std std V_C Normalize
shuffle|sampler shuffle shuffle
shuffle|sampler shuffle sampler
TxtDataset root|data_dir dataset sampler
de GeneratorDataset dataset||sampler de_dataset project columns de_dataset
de GeneratorDataset dataset||sampler de_dataset batch per_batch_size|drop_remainder de_dataset
de GeneratorDataset dataset||sampler de_dataset repeat max_epoch de_dataset
super CommonHead|self __init__
GlobalAvgPooling self avgpool
self avgpool x x
self fc x x
super CommonHead|self __init__
DownSample 32|64|2
super _DownSample|self __init__
nn BatchNorm2d out_channels self bn
self conv x out
self bn out out
super BasicBlock|self __init__
conv3x3 in_channels|out_channels|stride self conv1
nn BatchNorm2d out_channels self bn1
P ReLU self relu
nn BatchNorm2d out_channels self bn2
use_se self use_se
SEBlock out_channels self se
down_sample self down_sample
TensorAdd self add
x identity
self conv1 x out
self bn1 out out
self relu out out
self conv2 out out
self bn2 out out
self se out out
self down_sample x identity
self add out|identity out
super Bottleneck|self __init__
int out_channels|(base_width|64 0)|groups width
groups self groups
nn BatchNorm2d width self bn1
nn CellList self conv3x3s
nn BatchNorm2d width self bn2
nn BatchNorm2d out_channels|self expansion self bn3
SEBlock out_channels|self expansion self se
P Cast self cast
self conv3 out out
self bn3 out out
super ResNet|self __init__
width_per_group self base_width
nn BatchNorm2d self in_channels self bn
self _make_layer block|64|layers|use_se self layer1
self conv x x
self bn x x
self relu x x
self maxpool x x
self layer1 x x
self layer2 x x
self layer3 x x
self layer4 x x
self base_width base_width
self groups groups
out_channels|block expansion self in_channels
range _
nn SequentialCell layers
self conv x out self conv1
self bn out out self conv1
DenseNet121 args|kwargs
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
DenseNet121 config num_classes network
load_checkpoint args ckpt_file param_dict
param_dict items key|value
key startswith
value param_dict_new key
load_param_into_net network|param_dict_new
network set_train False
Tensor np zeros shape input_data
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
DenseNet121 config num_classes network set_train False
load_checkpoint args ckpt_file param_dict items key|value
param_dict items key startswith
param_dict items value param_dict_new key
load_param_into_net network set_train False
int os getenv devid
network set_train False
super BuildTrainNetwork|self __init__
network self network
criterion self criterion
self network input_data output
self criterion output|label loss
super ProgressMonitor|self __init__
args self args
self args logger info
run_context original_args cb_params
cb_params cur_step_num-1 me_step
me_step||self args steps_per_epoch real_epoch
time time-self me_epoch_start_time time_used
self args per_batch_size|(me_step-self me_epoch_start_step_num)|self args group_size|time_used fps_mean
glob glob os path join self args outputs_dir| ckpts
ckpts ckpt
os path basename ckpt ckpt_fn
ckpt_fn startswith  format self args rank
self ckpt_history append ckpt
me_step self me_epoch_start_step_num
time time self me_epoch_start_time
argparse ArgumentParser parser
parser parse_known_args _
merge_args args|cloud_args args
config image_size args image_size
config num_classes args num_classes
config lr args lr
config lr_scheduler args lr_scheduler
config lr_epochs args lr_epochs
config lr_gamma args lr_gamma
config eta_min args eta_min
config T_max args T_max
config max_epoch args max_epoch
config warmup_epochs args warmup_epochs
config weight_decay args weight_decay
config momentum args momentum
config is_dynamic_loss_scale args is_dynamic_loss_scale
config loss_scale args loss_scale
config label_smooth args label_smooth
config label_smooth_factor args label_smooth_factor
config ckpt_interval args ckpt_interval
config ckpt_path args ckpt_path
config is_save_on_master args is_save_on_master
config rank args rank
config group_size args group_size
config log_interval args log_interval
config per_batch_size args per_batch_size
list map int|args lr_epochs split args lr_epochs
list map int|args image_size split args image_size
vars args args_dict
isinstance cloud_args|dict
cloud_args keys key
cloud_args key val
type args_dict key arg_type
type None
arg_type val val
val args_dict key
parse_args cloud_args args
get_rank args rank
get_group_size args group_size
get_logger args outputs_dir|args rank args logger
de_dataset get_dataset_size args steps_per_epoch
args logger save_args args
args logger important_info
DenseNet121 args num_classes network
os path isfile args pretrained
load_checkpoint args pretrained param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
args logger info  format args pretrained
args warmup_epochs warmup_epochs
NotImplementedError args lr_scheduler
lr_scheduler get_lr lr_schedule
Tensor lr_schedule learning_rate
args momentum momentum
args weight_decay weight_decay
BuildTrainNetwork network|criterion train_net
ParallelMode DATA_PARALLEL parallel_mode
ParallelMode STAND_ALONE parallel_mode
ProgressMonitor args progress_cb
[progress_cb|] callbacks
args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num
args outputs_dir directory
callbacks append ckpt_cb
run_context original_args cb_params cur_step_num-1 me_step
cb_params cur_step_num-1 me_step args steps_per_epoch real_epoch
cb_params cur_step_num-1 me_step self me_epoch_start_step_num
glob glob os path join self args outputs_dir| ckpts ckpt
os path basename ckpt ckpt_fn startswith  format self args rank
argparse ArgumentParser parser parse_known_args _
merge_args args|cloud_args args logger save_args args
merge_args args|cloud_args args logger important_info
merge_args args|cloud_args args logger info  format args pretrained
merge_args args|cloud_args args warmup_epochs warmup_epochs
merge_args args|cloud_args args momentum momentum
merge_args args|cloud_args args weight_decay weight_decay
merge_args args|cloud_args args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num
merge_args args|cloud_args args outputs_dir directory
config lr_scheduler args lr_scheduler get_lr lr_schedule
isinstance cloud_args keys key
isinstance cloud_args key val
isinstance args logger save_args args
isinstance args logger important_info
isinstance args logger info  format args pretrained
isinstance args warmup_epochs warmup_epochs
isinstance args momentum momentum
isinstance args weight_decay weight_decay
isinstance args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num
isinstance args outputs_dir directory
cloud_args keys key startswith
cloud_args key val args_dict key
type args_dict key arg_type val val
arg_type val val args_dict key
val args_dict key startswith
parse_args cloud_args args logger save_args args
parse_args cloud_args args logger important_info
parse_args cloud_args args logger info  format args pretrained
parse_args cloud_args args warmup_epochs warmup_epochs
parse_args cloud_args args momentum momentum
parse_args cloud_args args weight_decay weight_decay
parse_args cloud_args args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num
parse_args cloud_args args outputs_dir directory
load_checkpoint args pretrained param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
NotImplementedError args lr_scheduler get_lr lr_schedule
ProgressMonitor args progress_cb callbacks
[progress_cb|] callbacks append ckpt_cb
int os getenv devid
super ParameterReduce|self __init__
P Cast self cast
P AllReduce self reduce
self cast F scalar_to_array|mstype float32 one
x|one out
self reduce out ret
argparse ArgumentParser parser
parser parse_known_args _
merge_args args|cloud_args args
config per_batch_size args per_batch_size
list map int|args image_size split args image_size
zip top5|gt
vars args args_dict
isinstance cloud_args|dict
cloud_args keys key
cloud_args key val
type args_dict key arg_type
type None
arg_type val val
val args_dict key
parse_args cloud_args args
get_rank args rank
get_group_size args group_size
get_logger args outputs_dir|args rank args logger
args logger save_args args
args logger important_info
os path isdir args pretrained
list glob glob os path join args pretrained| models
sorted models|key args models
[args pretrained|] args models
args models model
args per_batch_size per_batch_size
de_dataset create_tuple_iterator eval_dataloader
DenseNet121 args num_classes network
load_checkpoint model param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
args logger info  format model
network set_train False
eval_dataloader data|gt_classes
network Tensor data|mstype float32 output
output asnumpy output
gt_classes asnumpy gt_classes
np argmax output top1_output
np argsort output top5_output
np equal top1_output|gt_classes sum t1_correct
t1_correct top1_correct
get_top5_acc top5_output|gt_classes top5_correct
args per_batch_size img_tot
 [top1_correct]|[top5_correct]|[img_tot] results
model replace model_md5
os path exists tmp_dir
os mkdir tmp_dir
np save top1_correct_npy|top1_correct
np save top5_correct_npy|top5_correct
np save img_tot_npy|img_tot
range other_rank
os path exists top1_correct_npyornotos path exists top5_correct_npy
os path exists img_tot_npy
np load top1_correct_npy top1_correct_all
np load top5_correct_npy top5_correct_all
np load img_tot_npy img_tot_all
 [top1_correct_all]|[top5_correct_all]|[img_tot_all] results
np array results results
results 0|0 top1_correct
results 1|0 top5_correct
results 2|0 img_tot
self cast F scalar_to_array|mstype float32 one out
argparse ArgumentParser parser parse_known_args _
merge_args args|cloud_args args logger save_args args
merge_args args|cloud_args args logger important_info
merge_args args|cloud_args args models model
merge_args args|cloud_args args per_batch_size per_batch_size
merge_args args|cloud_args args logger info  format model
merge_args args|cloud_args args per_batch_size img_tot
zip  [top1_correct]|[top5_correct]|[img_tot] results
zip  [top1_correct_all]|[top5_correct_all]|[img_tot_all] results
isinstance cloud_args keys key
isinstance cloud_args key val
isinstance args logger save_args args
isinstance args logger important_info
isinstance args models model
isinstance args per_batch_size per_batch_size
isinstance args logger info  format model
isinstance args per_batch_size img_tot
isinstance  [top1_correct]|[top5_correct]|[img_tot] results
isinstance  [top1_correct_all]|[top5_correct_all]|[img_tot_all] results
cloud_args keys key args models
cloud_args keys key startswith
cloud_args key val args_dict key
type args_dict key arg_type val val
arg_type val val args_dict key
val args_dict key args models
val args_dict key startswith
parse_args cloud_args args logger save_args args
parse_args cloud_args args logger important_info
parse_args cloud_args args models model
parse_args cloud_args args per_batch_size per_batch_size
parse_args cloud_args args logger info  format model
parse_args cloud_args args per_batch_size img_tot
list glob glob os path join args pretrained| models args models
sorted models|key args models args models
args models model replace model_md5
de_dataset create_tuple_iterator eval_dataloader data|gt_classes
DenseNet121 args num_classes network set_train False
DenseNet121 args num_classes network Tensor data|mstype float32 output
load_checkpoint model param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
param_dict items  [top1_correct]|[top5_correct]|[img_tot] results
param_dict items  [top1_correct_all]|[top5_correct_all]|[img_tot_all] results
load_param_into_net network set_train False
load_param_into_net network Tensor data|mstype float32 output
load_param_into_net  [top1_correct]|[top5_correct]|[img_tot] results
load_param_into_net  [top1_correct_all]|[top5_correct_all]|[img_tot_all] results
args logger info  format model replace model_md5
eval_dataloader gt_classes asnumpy gt_classes
eval_dataloader  [top1_correct]|[top5_correct]|[img_tot] results
eval_dataloader  [top1_correct_all]|[top5_correct_all]|[img_tot_all] results
network Tensor data|mstype float32 output asnumpy output
np equal top1_output|gt_classes sum t1_correct top1_correct
 [top1_correct]|[top5_correct]|[img_tot] results 0|0 top1_correct
 [top1_correct]|[top5_correct]|[img_tot] results 1|0 top5_correct
 [top1_correct]|[top5_correct]|[img_tot] results 2|0 img_tot
np save  [top1_correct_all]|[top5_correct_all]|[img_tot_all] results
np save  [top1_correct_all]|[top5_correct_all]|[img_tot_all] results
np save  [top1_correct_all]|[top5_correct_all]|[img_tot_all] results
 [top1_correct_all]|[top5_correct_all]|[img_tot_all] results 0|0 top1_correct
 [top1_correct_all]|[top5_correct_all]|[img_tot_all] results 1|0 top5_correct
 [top1_correct_all]|[top5_correct_all]|[img_tot_all] results 2|0 img_tot
np array results results 0|0 top1_correct
np array results results 1|0 top5_correct
np array results results 2|0 img_tot
super CrossEntropy|self __init__
P OneHot self onehot
Tensor 1 0-smooth_factor|mstype float32 self on_value
Tensor 1 0|smooth_factor|(num_classes-1) self off_value
nn SoftmaxCrossEntropyWithLogits self ce
P ReduceMean False self mean
self ce logit|one_hot_label loss
self mean loss|0 loss
 config
warmup_init_lr self warmup_init_lr
lr self base_lr
int warmup_epochs|steps_per_epoch self warmup_steps
super _LinearWarmUp|self __init__ warmup_init_lr
(float(self base_lr)-float(self warmup_init_lr))|float(self warmup_steps) lr_inc
float self warmup_init_lr|lr_inc|current_step lr
steps_per_epoch self steps_per_epoch
int max_epoch|steps_per_epoch self total_steps
scheduler get_lr lr
_LinearWarmUp lr|warmup_epochs|steps_per_epoch self warmup
super LambdaLR|self __init__ lr|max_epoch|steps_per_epoch
self warmup get_warmup_steps warmup_steps
range i
self warmup get_lr i|1 lr
i||self steps_per_epoch cur_ep
lr_each_step append lr
np array lr_each_step astype np float32
super MultiplicativeLR|self __init__ lr|max_epoch|steps_per_epoch
self base_lr current_lr
current_lr lr
epoch_size self epoch_size
gamma self gamma
super StepLR|self __init__ lr|max_epoch|steps_per_epoch
self base_lr|self gamma(cur_ep||self epoch_size) lr
Counter milestones self milestones
super MultiStepLR|self __init__ lr|max_epoch|steps_per_epoch
current_lr|self gamma current_lr
super ExponentialLR|self __init__ lr|max_epoch|steps_per_epoch
left 1-\cos\left \frac{T_{max}}\pi\right\right
(2k|1)T_{max}  T_{cur}
T_max self T_max
eta_min self eta_min
super CosineAnnealingLR|self __init__ lr|max_epoch|steps_per_epoch
self eta_min| current_lr
max_lr self max_lr
float step_size_up step_size_up
step_size_up|step_size_down self total_size
step_size_up|self total_size self step_ratio
mode self mode
self _triangular_scale_fn self scale_fn
self _triangular2_scale_fn self scale_fn
self _exp_range_scale_fn self scale_fn
scale_fn self scale_fn
scale_mode self scale_mode
super CyclicLR|self __init__ lr|max_epoch|steps_per_epoch
math floor 1|i|self total_size cycle
x|self step_ratio scale_factor
(x-1)|(self step_ratio-1) scale_factor
(self max_lr-self base_lr)|scale_factor base_height
self base_lr|base_height|self scale_fn cycle lr
self base_lr|base_height|self scale_fn i lr
T_{i} T_{cur}
ValueError  format T_0
isinstance T_mult|int
T_0 self T_0
T_0 self T_i
T_mult self T_mult
super CosineAnnealingWarmRestarts|self __init__ lr|max_epoch|steps_per_epoch
self T_cur-self T_i self T_cur
self T_i|self T_mult self T_i
self eta_min|(self base_lr-self eta_min)| lr
lr|div_factor max_lr
lr|final_div_factor min_lr
super OneCycleLR|self __init__ lr|max_epoch|steps_per_epoch
float pct_start|self total_steps-1 self step_size_up
float self total_steps-self step_size_up-1 self step_size_down
isinstance pct_start|float
ValueError  format pct_start
ValueError  format anneal_strategy
self _annealing_cos self anneal_func
self _annealing_linear self anneal_func
lr|div_factor self max_lr
lr|final_div_factor self min_lr
math cos math pi|pct|1 cos_out
self anneal_func self base_lr|self max_lr|i|self step_size_up lr
i-self step_size_up down_step_num
self anneal_func self max_lr|self min_lr|down_step_num|self step_size_down lr
float self warmup_init_lr|lr_inc|current_step lr gamma current_lr
float self warmup_init_lr|lr_inc|current_step lr max_lr
float self warmup_init_lr|lr_inc|current_step lr min_lr
float self warmup_init_lr|lr_inc|current_step lr self max_lr
float self warmup_init_lr|lr_inc|current_step lr self min_lr
scheduler get_lr lr gamma current_lr
scheduler get_lr lr max_lr
scheduler get_lr lr min_lr
scheduler get_lr lr self max_lr
scheduler get_lr lr self min_lr
range i steps_per_epoch cur_ep
self warmup get_lr i|1 lr gamma current_lr
self warmup get_lr i|1 lr max_lr
self warmup get_lr i|1 lr min_lr
self warmup get_lr i|1 lr self max_lr
self warmup get_lr i|1 lr self min_lr
lr_each_step append lr gamma current_lr
lr_each_step append lr max_lr
lr_each_step append lr min_lr
lr_each_step append lr self max_lr
lr_each_step append lr self min_lr
self base_lr current_lr lr
self base_lr current_lr gamma current_lr
current_lr lr gamma current_lr
current_lr lr max_lr
current_lr lr min_lr
current_lr lr self max_lr
current_lr lr self min_lr
self base_lr|self gamma(cur_ep||self epoch_size) lr gamma current_lr
self base_lr|self gamma(cur_ep||self epoch_size) lr max_lr
self base_lr|self gamma(cur_ep||self epoch_size) lr min_lr
self base_lr|self gamma(cur_ep||self epoch_size) lr self max_lr
self base_lr|self gamma(cur_ep||self epoch_size) lr self min_lr
current_lr|self gamma current_lr gamma current_lr
float step_size_up step_size_up self total_size
float step_size_up step_size_up total_size self step_ratio
self _triangular_scale_fn self scale_fn self scale_fn
self _triangular2_scale_fn self scale_fn self scale_fn
self _exp_range_scale_fn self scale_fn self scale_fn
self base_lr|base_height|self scale_fn cycle lr max_lr
self base_lr|base_height|self scale_fn cycle lr min_lr
self base_lr|base_height|self scale_fn cycle lr self max_lr
self base_lr|base_height|self scale_fn cycle lr self min_lr
self base_lr|base_height|self scale_fn i lr max_lr
self base_lr|base_height|self scale_fn i lr min_lr
self base_lr|base_height|self scale_fn i lr self max_lr
self base_lr|base_height|self scale_fn i lr self min_lr
ValueError  format T_0 self T_0
ValueError  format T_0 self T_i
isinstance T_mult self T_mult
self eta_min|(self base_lr-self eta_min)| lr max_lr
self eta_min|(self base_lr-self eta_min)| lr min_lr
self eta_min|(self base_lr-self eta_min)| lr self max_lr
self eta_min|(self base_lr-self eta_min)| lr self min_lr
super GlobalAvgPooling|self __init__
P ReduceMean True self mean
P Shape self shape
P Reshape self reshape
self mean x|(2|3) x
self shape x _
self reshape x|(b|c) x
super CommonHead|self __init__
GlobalAvgPooling self avgpool
self avgpool x x
self fc x x
super _DenseLayer|self __init__
nn BatchNorm2d num_input_features self norm1
nn ReLU self relu1
conv1x1 num_input_features|bn_size|growth_rate self conv1
nn BatchNorm2d bn_size|growth_rate self norm2
nn ReLU self relu2
conv3x3 bn_size|growth_rate|growth_rate self conv2
nn Dropout keep_prob self dropout
self conv1 self relu1 self norm1 features bottleneck
self conv2 self relu2 self norm2 bottleneck new_features
self dropout new_features new_features
super _DenseBlock|self __init__
nn CellList self cell_list
range i
_DenseLayer layer
self cell_list append layer
init_features features
self cell_list layer
layer features new_features
self concate (features|new_features) features
super _Transition|self __init__
nn SequentialCell  self features
self features x x
super Densenet|self __init__
OrderedDict layers
nn BatchNorm2d num_init_features layers
nn ReLU layers
num_init_features num_features
enumerate i|num_layers
_DenseBlock block
num_features num_input_features
block layers
num_features|num_layers|growth_rate num_features
trans layers
num_features||2 num_features
nn BatchNorm2d num_features layers
nn SequentialCell layers self features
num_features self out_channels
super DenseNet121|self __init__
_densenet121 self backbone
self backbone get_out_channels out_channels
include_top self include_top
CommonHead num_classes|out_channels self head
default_recurisive_init self
self cells_and_names _|cell
isinstance cell|nn Conv2d
isinstance cell|nn BatchNorm2d
cell gamma set_data init initializer cell gamma shape
cell beta set_data init initializer cell beta shape
isinstance cell|nn Dense
cell bias set_data init initializer cell bias shape
self backbone x x
self head x x
_DenseLayer layer features new_features
self cell_list append layer features new_features
init_features features num_features
init_features features num_features
self cell_list layer features new_features
self concate (features|new_features) features num_features
self concate (features|new_features) features num_features
nn SequentialCell  self features num_features
nn SequentialCell  self features num_features
OrderedDict layers num_features
nn BatchNorm2d num_init_features layers num_features
nn ReLU layers num_features
num_init_features num_features num_input_features
num_init_features num_features num_features
num_init_features num_features num_features
num_init_features num_features self out_channels
_DenseBlock block layers
block layers num_features
num_features|num_layers|growth_rate num_features num_features
num_features|num_layers|growth_rate num_features num_features
num_features|num_layers|growth_rate num_features self out_channels
num_features||2 num_features num_features
num_features||2 num_features self out_channels
default_recurisive_init self cells_and_names _|cell
default_recurisive_init self backbone x x
default_recurisive_init self head x x
self cells_and_names cell gamma set_data init initializer cell gamma shape
self cells_and_names cell beta set_data init initializer cell beta shape
self cells_and_names cell bias set_data init initializer cell bias shape
super TxtDataset|self __init__
open txt_name fin
line strip split label
self imgs append os path join root|img_name
self labels append int label
fin close
Image open self imgs index img
len self imgs
 Union int|sequence
[0 485|255|0 456|255|0 406|255] mean
[0 229|255|0 224|255|0 225|255] std
(0 08|1 0) scale
mean mean|std std vision_C Normalize
vision_C HWC2CHW
vision_C Decode
vision_C Resize (256|256)
vision_C CenterCrop image_size
transform transform_img
normal_C TypeCast mstype int32
target_transform transform_label
shuffle|sampler shuffle
TxtDataset root|data_dir dataset
DistributedSampler dataset|rank|group_size|shuffle sampler
de GeneratorDataset dataset||sampler de_dataset
de_dataset project columns de_dataset
de_dataset batch per_batch_size|drop_remainder de_dataset
de_dataset repeat de_dataset
open txt_name fin close
self imgs append os path join  Union int|sequence
 Union  Union int|sequence
[0 485|255|0 456|255|0 406|255] mean mean|std std vision_C Normalize
shuffle|sampler shuffle shuffle
shuffle|sampler shuffle sampler
TxtDataset root|data_dir dataset sampler
de GeneratorDataset dataset||sampler de_dataset project columns de_dataset
de GeneratorDataset dataset||sampler de_dataset batch per_batch_size|drop_remainder de_dataset
de GeneratorDataset dataset||sampler de_dataset repeat de_dataset
dataset self dataset
rank self rank
group_size self group_size
len self dataset self dataset_length
int math ceil self dataset_length|1 0|self group_size self num_samples
self num_samples|self group_size self total_size
shuffle self shuffle
seed self seed
(self seed|1) self seed
np random seed self seed
np random permutation self dataset_length tolist indices
list range len self dataset_length indices
iter indices
super LOGGER|self __init__ logger_name
logging StreamHandler sys stdout console
console setLevel logging INFO
logging Formatter formatter
console setFormatter formatter
self addHandler console
rank self rank
os path exists log_dir
datetime now strftime| format rank log_name
os path join log_dir|log_name self log_fn
logging FileHandler self log_fn fh
fh setLevel logging INFO
fh setFormatter formatter
self addHandler fh
self isEnabledFor logging INFO
self _log logging INFO|msg|args|kwargs
self info
vars args args_dict
args_dict keys key
self info key|args_dict[key]
|line_width important_msg
|2 important_msg
self info important_msg|args|kwargs
LOGGER rank logger
logger setup_logging_file path|rank
logging StreamHandler sys stdout console setLevel logging INFO
logging StreamHandler sys stdout console setFormatter formatter
logging FileHandler self log_fn fh setLevel logging INFO
logging FileHandler self log_fn fh setFormatter formatter
vars args args_dict keys key
LOGGER rank logger setup_logging_file path|rank
math sqrt
isinstance param|boolandisinstance param|intorisinstance param|float
param negative_slope
ValueError  format param
math sqrt 2 0|(1|negative_slope2)
ValueError  format nonlinearity
arr reshape arr
num arr
isinstance num|np ndarray
len arr shape dim
arr shape n_in
arr shape n_out
mode lower mode
ValueError  format mode|valid_modes
_calculate_in_and_out array fan_out
super KaimingInit|self __init__
mode self mode
_calculate_gain nonlinearity|a self gain
mathcal{U}(-\text{bound}|\text{bound})
 text{bound}
np empty 3|5 w
_select_fan arr|self mode fan
math sqrt|self gain|math sqrt fan bound
np random uniform -bound|bound|arr shape data
_assignment arr|data
mathcal{N}(0|\text{std}^2)
 text{std}
self gain|math sqrt fan std
np random normal 0|std|arr shape data
custom_cell cells_and_names _|cell
isinstance cell|nn Conv2d
cell weight set_data(init initializer(KaimingUniform math sqrt)) a
_calculate_in_and_out cell weight asnumpy _
cell bias set_data Tensor np random uniform -bound|bound|cell bias shape|cell bias dtype
isinstance cell|nn Dense
isinstance cell|(nn BatchNorm2d|nn BatchNorm1d)
isinstance param|boolandisinstance param|intorisinstance param negative_slope
isinstance param|boolandisinstance param|intorisinstance  text{bound}
isinstance param|boolandisinstance param|intorisinstance  text{std}
math sqrt 2  text{bound}
math sqrt 2  text{std}
num arr shape n_in
num arr shape n_out
ValueError  format mode self mode
ValueError  format  text{bound}
ValueError  format  text{std}
_assignment  text{std}
custom_cell cells_and_names cell weight set_data(init initializer(KaimingUniform math sqrt)) a
custom_cell cells_and_names cell bias set_data Tensor np random uniform -bound|bound|cell bias shape|cell bias dtype
network trainable_params x
x name parameter_name
parameter_name endswith
no_decay_params append x
decay_params append x
network trainable_params x name parameter_name
x name parameter_name endswith
decay_params append x
cfg batch_size
cfg max_epoch
cfg momentum
cfg weight_decay
cfg initial_lr
cfg gamma
cfg training_dataset
(cfg) stepvalues
print ds_train get_dataset_size
math ceil ds_train get_dataset_size steps_per_epoch
MultiBoxLoss num_classes|cfg multibox_loss
resnet50 backbone
backbone set_train True
cfg pretrained_res50
load_checkpoint pretrained_res50 param_dict_res50
load_param_into_net backbone|param_dict_res50
print  format pretrained_res50
net set_train True
cfg pretrain_model_path
load_checkpoint pretrain_model_path param_dict_retinaface
load_param_into_net net|param_dict_retinaface
print  format cfg
RetinaFaceWithLossCell net|multibox_loss|cfg net
mindspore nn Momentum net trainable_params|lr|momentum opt
TrainingWrapper net|opt net
Model net model
TimeMonitor data_size time_cb
[LossMonitor|time_cb|ckpoint_cb] callback_list
cfg_res50 config
mindspore common seed set_seed config
print config
train config cfg
resnet50 backbone set_train True
TimeMonitor data_size time_cb callback_list
time time self start_time
time time-self start_time self diff
cfg self nms_thresh
cfg self conf_thresh
cfg self iou_thresh
cfg self var
cfg self save_prefix
cfg self gt_dir
a shape A
b shape B
np minimum max_xy
np maximum min_xy
np maximum (max_xy-min_xy|1) inter
np broadcast_to area_a
np broadcast_to area_b
area_a|area_b-inter union
boxes x1
boxes y1
boxes x2
boxes y2
boxes scores
(x2-x1|1)|(y2-y1|1) areas
scores argsort order
order i
reserved_boxes append i
np maximum x1 i]|x1[order max_x1
np maximum y1 i]|y1[order max_y1
np minimum x2 i]|x2[order min_x2
np minimum y2 i]|y2[order min_y2
np maximum 0 0|min_x2-max_x1|1 intersect_w
np maximum 0 0|min_y2-max_y1|1 intersect_h
intersect_w|intersect_h intersect_area
intersect_area|(areas-intersect_area) ovr
np where ovr indexs
datetime datetime now strftime t
os path isdir self save_prefix
os makedirs self save_prefix
self save_prefix self file_path
open self file_path f
json dump self results|f
RuntimeError  format str e
f close
image_path split img_name
decode_bbox np squeeze boxes asnumpy|0 boxes
boxes|scale|resize boxes
np squeeze confs asnumpy|0 scores
np where scores inds
boxes inds boxes
scores inds scores
boxes order boxes
scores order scores
self _nms dets|self nms_thresh keep
self results keys
loadmat os path join self gt_dir| gt
loadmat os path join self gt_dir| hard
loadmat os path join self gt_dir| medium
loadmat os path join self gt_dir| easy
gt faceboxes
gt events
gt files
hard hard_gt_list
medium medium_gt_list
easy easy_gt_list
self results event
self results keys name
np array self results event][name np float bbox
max max_score|np max bbox max_score
min min_score|np min bbox min_score
max_score-min_score length
bbox tolist self results event][name
predict copy _predict
gt copy _gt
np zeros _predict shape image_p_right
np zeros _gt shape image_gt_right
np ones _predict shape proposal
self _iou _predict ious
range i
ious gt_ious
gt_ious max|gt_ious argmax max_index
-1 image_gt_right max_index
-1 proposal i
len right_index image_p_right i
np zeros (section_num|2) image_pr
range section
np where predict over_score_index
over_score_index index
self _norm_pre_score
self _get_gt_boxes easy_gt_list
[easy_gt_list|medium_gt_list|hard_gt_list] set_gts
{0} ap_key_dict
range _set
set_gts _set gt_list
np zeros (section_num|2) pr_curve
enumerate i|_
str event_list i event
file_list i image_list
self results event event_predict_dict
gt_list i event_gt_index_list
facebox_list i event_gt_box_list
enumerate j|_
np array event_predict_dict[str image_list j] np float predict
event_gt_box_list j gt_boxes
event_gt_index_list j keep_index
len keep_index count_gt
np zeros gt_boxes shape keep
self iou_thresh iou_thresh
image_pr pr_curve
pr_curve precision
pr_curve|count_gt recall
np concatenate (np array|precision|np array) precision
np concatenate (np array|recall|np array) recall
range precision shape i
np where recall index
np sum (recall) ap
print ap_key_dict _set format ap
cfg_res50 cfg
resnet50 backbone
backbone set_train False
network set_train False
load_checkpoint cfg param_dict
print  format cfg
network init_parameters_data
load_param_into_net network|param_dict
cfg testset_folder
cfg testset_label_path
open testset_label_path|
f readlines _test_dataset
_test_dataset im_path
test_dataset append im_path
len test_dataset num_images
{} timers
test_dataset img_name
os path join testset_folder|img_name image_path
cv2 imread image_path|cv2 IMREAD_COLOR _img
_img shape h_max
_img shape w_max
(int(h_max|32)|1)|32 h_max
(int(w_max|32)|1)|32 w_max
 [16|32]|[64|128]|[256|512] min_sizes
[8|16|32] steps
DetectionEngine cfg detection
enumerate i|img_name
cv2 imread image_path|cv2 IMREAD_COLOR img_raw
np float32 img_raw img
np empty (h_max|w_max|3) image_t
(104 0|117 0|123 0) image_t
img image_t
image_t img
np min img shape im_size_min
np max img shape im_size_max
float target_size|float(im_size_min) resize
np round resize|im_size_max
float max_size|float(im_size_max) resize
cv2 resize img|None|None|fx img
np empty (max_size|max_size|3) image_t
np array [img shape|img shape|img shape|img shape]|dtype scale
img transpose 2|0|1 img
np expand_dims img|0 img
Tensor img img
timers start
network img _
timers end
detection detect boxes|confs|resize|scale|img_name|priors
detection write_result predict_result_path
print  format predict_result_path
detection get_eval_result
np maximum (max_xy-min_xy|1) inter intersect_area
np broadcast_to area_a union
np broadcast_to area_b union
boxes x1 areas
boxes y1 areas
boxes scores argsort order
boxes scores inds scores
boxes scores order scores
scores argsort order i
order i intersect_area
reserved_boxes append i intersect_area
np maximum 0 0|min_x2-max_x1|1 intersect_w intersect_area
np maximum 0 0|min_y2-max_y1|1 intersect_h intersect_area
intersect_w|intersect_h intersect_area ovr
datetime datetime now strftime t set_gts
open self file_path f close
open self file_path f readlines _test_dataset
json dump self f close
json dump self f readlines _test_dataset
json dump self  [16|32]|[64|128]|[256|512] min_sizes
RuntimeError  format str e boxes
RuntimeError  format str e recall
decode_bbox np squeeze boxes asnumpy|0 boxes boxes
decode_bbox np squeeze boxes asnumpy|0 boxes inds boxes
decode_bbox np squeeze boxes asnumpy|0 boxes order boxes
boxes|scale|resize boxes boxes
boxes|scale|resize boxes inds boxes
boxes|scale|resize boxes order boxes
np squeeze confs asnumpy|0 scores inds scores
np squeeze confs asnumpy|0 scores order scores
loadmat os path join self gt_dir| gt faceboxes
loadmat os path join self gt_dir| gt events
loadmat os path join self gt_dir| gt files
loadmat os path join self gt_dir| gt copy _gt
loadmat os path join self gt_dir| hard hard_gt_list
loadmat os path join self gt_dir| hard set_gts
loadmat os path join self gt_dir| medium medium_gt_list
loadmat os path join self gt_dir| medium set_gts
loadmat os path join self gt_dir| easy easy_gt_list
hard hard_gt_list set_gts
medium medium_gt_list set_gts
easy easy_gt_list set_gts
np array self results event][name np float bbox tolist self results event][name
self _iou _predict ious gt_ious
ious gt_ious max|gt_ious argmax max_index
np zeros (section_num|2) image_pr pr_curve
np where predict over_score_index index
self _get_gt_boxes easy_gt_list set_gts
[easy_gt_list|medium_gt_list|hard_gt_list] set_gts _set gt_list
set_gts _set gt_list i event_gt_index_list
np zeros (section_num|2) pr_curve precision
np zeros (section_num|2) pr_curve recall
enumerate  [16|32]|[64|128]|[256|512] min_sizes
gt_list i event_gt_index_list j keep_index
facebox_list i event_gt_box_list j gt_boxes
enumerate  [16|32]|[64|128]|[256|512] min_sizes
len keep_index count_gt recall
image_pr pr_curve precision
image_pr pr_curve recall
cfg_res50 cfg testset_folder
cfg_res50 cfg testset_label_path
resnet50 backbone set_train False
print  format cfg testset_folder
print  format cfg testset_label_path
load_param_into_net  [16|32]|[64|128]|[256|512] min_sizes
load_param_into_net network img _
open  [16|32]|[64|128]|[256|512] min_sizes
f readlines _test_dataset im_path
{} timers start
{} timers end
cv2 imread image_path|cv2 IMREAD_COLOR _img shape h_max
cv2 imread image_path|cv2 IMREAD_COLOR _img shape w_max
_img shape h_max h_max
_img shape w_max w_max
(int(h_max|32)|1)|32 h_max h_max
(int(w_max|32)|1)|32 w_max w_max
DetectionEngine cfg detection detect boxes|confs|resize|scale|img_name|priors
DetectionEngine cfg detection write_result predict_result_path
DetectionEngine cfg detection get_eval_result
enumerate img image_t
enumerate img transpose 2|0|1 img
np float32 img_raw img image_t
np float32 img_raw img transpose 2|0|1 img
np empty (h_max|w_max|3) image_t img
(104 0|117 0|123 0) image_t img
img image_t img
image_t img transpose 2|0|1 img
cv2 resize img|None|None|fx img transpose 2|0|1 img
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step learning_rate
float current_step-warmup_steps|float(decay_steps) base
(1|math cos(base|math pi))|2|base_lr learning_rate
range i
lr append _linear_warmup_learning_rate i|warmup_steps|base_lr|base_lr|warmup_ratio
lr append _a_cosine_learning_rate i|base_lr|warmup_steps|total_steps
range 1|total_epochs epoch
range _
initial_lr|(gamma) lr
initial_lr lr
lr_each_step append lr
lr append _linear_warmup_learning_rate lr append _linear_warmup_learning_rate i|warmup_steps|base_lr|base_lr|warmup_ratio
lr append _linear_warmup_learning_rate lr append _a_cosine_learning_rate i|base_lr|warmup_steps|total_steps
lr append _a_cosine_learning_rate lr append _a_cosine_learning_rate i|base_lr|warmup_steps|total_steps
initial_lr|(gamma) lr lr
open label_path f
f readlines lines
lines line
line rstrip line
copy deepcopy labels c_labels
self labels_list append c_labels
labels clear
line path
label_path replace|path path
os path exists path
self images_list append path
line split line
labels append label
self labels_list append labels
len self images_list
isinstance img_path|str
cv2 imread img_path img
cv2 imread img_path tostring decode img
annotation labels
np zeros (0|15) anns
enumerate _|label
np zeros (1|15) ann
label ann
label|label ann
np array anns astype np float32 target
WiderFace data_dir dataset
get_rank rank_id
get_group_size device_num
num_worker num_parallel_workers
device_num num_shards
preproc cfg aug
bbox_encode cfg encode
read_dataset image|annot a
aug i|a a
encode i|a out
union_data operations
multiprocessing python_multiprocessing
de_dataset repeat repeat_num de_dataset
open label_path f readlines lines
f readlines lines line
lines line rstrip line
lines line path
lines line split line
labels append label ann
labels append label ann
enumerate label ann
get_group_size device_num num_shards
preproc cfg aug i|a a
bbox_encode cfg encode i|a out
super SoftmaxCrossEntropyWithLogits|self __init__
P LogSoftmax self log_softmax
P Neg self neg
P OneHot self one_hot
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
P ReduceSum self reduce_sum
self log_softmax logits prob
self one_hot labels|F shape logits labels
self neg self reduce_sum prob|labels|1
super MultiBoxLoss|self __init__
num_classes self num_classes
num_boxes self num_boxes
neg_pre_positive self neg_pre_positive
P NotEqual self notequal
P Less self less
P Tile self tile
P ReduceMean self reduce_mean
P ExpandDims self expand_dims
P SmoothL1Loss self smooth_l1_loss
SoftmaxCrossEntropyWithLogits self cross_entropy
P Maximum self maximum
P Minimum self minimum
P TopK True self sort_descend
P TopK True self sort
P GatherNd self gather
P ReduceMax self max
P Log self log
P Exp self exp
Tensor np reshape np arange batch_size|num_boxes self idx
F cast self less 0 0|F cast(conf_t|mstype float32) mask_pos1
self maximum self reduce_sum mask_pos1 N1
self tile self expand_dims mask_pos1|-1 mask_pos_idx1
self reduce_sum self smooth_l1_loss landm_data|landm_t|mask_pos_idx1 loss_landm
loss_landm|N1 loss_landm
F cast self notequal 0|conf_t mask_pos
F cast mask_pos|mstype int32 conf_t
self maximum self reduce_sum mask_pos N
self tile self expand_dims mask_pos|-1 mask_pos_idx
self reduce_sum self smooth_l1_loss loc_data|loc_t|mask_pos_idx loss_l
loss_l|N loss_l
F shape conf_t conf_t_shape
F reshape conf_t|(-1|) conf_t
self concat (self idx|F reshape conf_t|(-1|1)) indices
F reshape conf_data|(-1|self num_classes) batch_conf
self max batch_conf x_max
self log self reduce_sum2 self exp batch_conf-x_max loss_c
loss_c-F reshape(self gather batch_conf|indices) loss_c
F reshape loss_c|conf_t_shape loss_c
F reshape self reduce_sum mask_pos|1 num_matched_boxes
F cast loss_c|(1-mask_pos) neg_masked_cross_entropy
self sort_descend neg_masked_cross_entropy|self num_boxes loss_idx
self sort F cast loss_idx|mstype float32 relative_position
F cast relative_position|mstype float32 relative_position
F cast relative_position|mstype int32 relative_position
self minimum num_matched_boxes|self neg_pre_positive|self num_boxes-1 num_neg_boxes
self tile self expand_dims num_neg_boxes|-1 tile_num_neg_boxes
F cast self less relative_position|tile_num_neg_boxes top_k_neg_mask
self cross_entropy batch_conf|conf_t cross_entropy
F reshape cross_entropy|conf_t_shape cross_entropy
self reduce_sum cross_entropy|self minimum mask_pos|top_k_neg_mask|1 loss_c
loss_c|N loss_c
self maximum self reduce_sum mask_pos1 N1 loss_landm
self reduce_sum self smooth_l1_loss landm_data|landm_t|mask_pos_idx1 loss_landm loss_landm
loss_landm|N1 loss_landm loss_landm
self maximum self reduce_sum mask_pos N loss_l
self maximum self reduce_sum mask_pos N loss_c
self reduce_sum self smooth_l1_loss loc_data|loc_t|mask_pos_idx loss_l loss_l
loss_l|N loss_l loss_l
self log self reduce_sum2 self exp batch_conf-x_max loss_c loss_c
loss_c-F reshape(self gather batch_conf|indices) loss_c loss_c
F reshape loss_c|conf_t_shape loss_c loss_c
self reduce_sum cross_entropy|self minimum mask_pos|top_k_neg_mask|1 loss_c loss_c
loss_c|N loss_c loss_c
[math ceil image_sizes|step|math ceil image_sizes|step
enumerate k|f
product i|j
min_sizes min_size
min_size|image_sizes s_kx
min_size|image_sizes s_ky
(j|0 5)|steps[k]|image_sizes cx
(i|0 5)|steps[k]|image_sizes cy
[cx|cy|s_kx|s_ky] anchors
np asarray anchors reshape [-1|4] astype(np float32) output
np clip output|0|1 output
a shape A
b shape B
np minimum max_xy
np maximum min_xy
np maximum (max_xy-min_xy) inter
compute_intersect a|b inter
np broadcast_to area_a
np broadcast_to area_b
area_a|area_b-inter union
compute_overlaps boxes|center_point_2_box(priors) overlaps
best_prior_idx best_prior_idx_filter
np zeros (priors shape|4) loc
np zeros (priors shape|) conf
np zeros (priors shape|10) landm
best_truth_idx squeeze best_truth_idx
best_truth_overlap squeeze best_truth_overlap
best_prior_idx squeeze best_prior_idx
best_prior_idx_filter squeeze best_prior_idx_filter
range j
j best_truth_idx best_prior_idx j
boxes best_truth_idx matches
(matches) offset_cxcy
(matches) wh
np log wh|var wh
labels best_truth_idx conf
landms best_truth_idx matches_landm
np reshape matches_landm|[-1|5|2] matched
np broadcast_to np expand_dims priors|1 priors
matched offset_cxcy
np reshape offset_cxcy|[-1|10] landm
np int32 dtype
cfg self match_thresh
cfg self variances
targets boxes
targets labels
targets landms
self priors priors
match self match_thresh|boxes|priors|self variances|labels|landms landm_t
 boxes
[math ceil |math ceil  boxes
enumerate  boxes
product j best_truth_idx best_prior_idx j
product  boxes
min_sizes min_size s_kx
min_sizes min_size s_ky
min_size|image_sizes s_kx anchors
min_size|image_sizes s_ky anchors
(j|0 5)|steps[k]|image_sizes cx anchors
(i|0 5)|steps[k]|image_sizes cy anchors
np broadcast_to area_a union
np broadcast_to area_b union
best_prior_idx best_prior_idx_filter squeeze best_prior_idx_filter
range j best_truth_idx best_prior_idx j
np reshape matches_landm|[-1|5|2] matched offset_cxcy
np random randn |shape astype(np float32)|factor init_value
Tensor init_value
(out_channel|in_channel|3|3) weight_shape
_weight_variable weight_shape weight
(out_channel|in_channel|1|1) weight_shape
(out_channel|in_channel|7|7) weight_shape
nn BatchNorm2d channel
(out_channel|in_channel) weight_shape
super ResidualBlock|self __init__
out_channel||self expansion channel
_bn channel self bn1
_conv3x3 channel|channel|stride self conv2
_bn channel self bn2
_bn_last out_channel self bn3
nn ReLU self relu
P TensorAdd self add
x identity
self conv1 x out
self bn1 out out
self relu out out
self conv2 out out
self bn2 out out
self conv3 out out
self bn3 out out
self down_sample_layer identity identity
self add out|identity out
super ResNet|self __init__
_bn self bn1
P ReLU self relu
P Pad ((0|0)) self pad
in_channels in_channel
out_channels out_channel
nn Flatten self flatten
_fc out_channels|num_classes self end_point
block in_channel|out_channel|stride resnet_block
layers append resnet_block
range _
nn SequentialCell layers
self conv1 x x
self bn1 x x
self relu x x
self pad x x
self maxpool x c1
self layer1 c1 c2
self layer2 c2 c3
self layer3 c3 c4
self layer4 c4 c5
self mean c5|(2|3) out
self flatten out out
self end_point out out
len arr_shape dim
arr_shape n_in
arr_shape n_out
math sqrt
isinstance a|boolandisinstance a|intorisinstance a|float
a negative_slope
ValueError  format a
math sqrt 2 0|(1|negative_slope2)
ValueError  format nonlinearity
_calculate_in_and_out arr_shape _
calculate_gain nonlinearity|a gain
gain|math sqrt fan_in std
math sqrt|std bound
np random uniform -bound|bound|arr_shape astype(np float32) weight
np random uniform -bound_bias|bound_bias|arr_shape astype(np float32) bias
Tensor bias bias
Tensor weight
(out_planes|in_planes|kernel_size|kernel_size) weight_shape
Init_KaimingUniform weight_shape|a _
super ConvBNReLU|self
norm_layer out_planes
nn LeakyReLU leaky alpha
super ConvBN|self
super SSH|self __init__
nn BatchNorm2d norm_layer
self conv3X3 x conv3X3
self conv5X5_1 x conv5X5_1
self conv5X5_2 conv5X5_1 conv5X5
self conv7X7_2 conv5X5_1 conv7X7_2
self conv7X7_3 conv7X7_2 conv7X7
self cat (conv3X3|conv5X5|conv7X7) out
super FPN|self __init__
self output1 input1 output1
self output2 input2 output2
self output3 input3 output3
P ResizeNearestNeighbor [P Shape output2] up3
up3|output2 output2
self merge2 output2 output2
P ResizeNearestNeighbor [P Shape output1] up2
up2|output1 output1
self merge1 output1 output1
super ClassHead|self __init__
num_anchors self num_anchors
(self num_anchors|2|inchannels|1|1) weight_shape
P Transpose self permute
P Reshape self reshape
self conv1x1 x out
self permute out|(0|2|3|1) out
self reshape out| P Shape out|-1|2
super BboxHead|self __init__
(num_anchors|4|inchannels|1|1) weight_shape
self reshape out| P Shape out|-1|4
super LandmarkHead|self __init__
(num_anchors|10|inchannels|1|1) weight_shape
self reshape out| P Shape out|-1|10
super RetinaFace|self __init__
phase self phase
backbone self base
FPN self fpn
SSH 256|256 self ssh1
SSH 256|256 self ssh2
SSH 256|256 self ssh3
nn CellList classhead
range i
classhead append ClassHead inchannels i i
nn CellList bboxhead
bboxhead append BboxHead inchannels i i
nn CellList landmarkhead
landmarkhead append LandmarkHead inchannels i i
self base inputs f3
self fpn f1|f2|f3 f3
self ssh1 f1 f1
self ssh2 f2 f2
self ssh3 f3 f3
[f1|f2|f3] features
enumerate i|feature
bbox|(self BboxHead i feature) bbox
self cat bbox bbox_regressions
cls|(self ClassHead i feature) cls
self cat cls classifications
landm|(self LandmarkHead i feature) landm
self cat landm ldm_regressions
(bbox_regressions|classifications|ldm_regressions) output
(bbox_regressions|P Softmax classifications) output
super RetinaFaceWithLossCell|self __init__
network self network
config self loc_weight
config self class_weight
config self landm_weight
multibox_loss self multibox_loss
self network img pre_landm
self multibox_loss pred_loc|loc_t|pre_conf|conf_t|pre_landm|landm_t loss_landm
mindspore ParameterTuple network trainable_params self weights
optimizer self optimizer
sens self sens
context get_auto_parallel_context self parallel_mode
[mindspore context ParallelMode DATA_PARALLEL|mindspore context ParallelMode HYBRID_PARALLEL] class_list
context get_auto_parallel_context mean
auto_parallel_context get_device_num_is_set
context get_auto_parallel_context degree
get_group_size degree
nn DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
self weights weights
self network args loss
P Fill P DType loss sens
self grad self network|weights(args|sens) grads
self grad_reducer grads grads
F depend loss|self optimizer grads
(out_channel|in_channel|3|3) weight_shape _
(out_channel|in_channel|1|1) weight_shape _
(out_channel|in_channel|7|7) weight_shape _
nn BatchNorm2d channel weight_shape
nn BatchNorm2d channel expansion channel
nn BatchNorm2d channel self conv2
nn BatchNorm2d channel resnet_block
(out_channel|in_channel) weight_shape _
out_channel||self expansion channel expansion channel
out_channel||self expansion channel self conv2
out_channel||self expansion channel resnet_block
self conv1 x out resnet_block
self conv1 x out output2
self conv1 x out output1
self bn1 out out resnet_block
self bn1 out out output2
self bn1 out out output1
self relu out out resnet_block
self relu out out output2
self relu out out output1
self conv2 out out resnet_block
self conv2 out out output2
self conv2 out out output1
self bn2 out out resnet_block
self bn2 out out output2
self bn2 out out output1
self conv3 out out resnet_block
self conv3 out out output2
self conv3 out out output1
self bn3 out out resnet_block
self bn3 out out output2
self bn3 out out output1
self add out|identity out resnet_block
self add out|identity out output2
self add out|identity out output1
in_channels in_channel resnet_block
out_channels out_channel resnet_block
self conv1 x x BboxHead i feature) bbox
self bn1 x x BboxHead i feature) bbox
self relu x x BboxHead i feature) bbox
self pad x x BboxHead i feature) bbox
self mean c5|(2|3) out output2
self mean c5|(2|3) out output1
self flatten out out output2
self flatten out out output1
self end_point out out output2
self end_point out out output1
isinstance a|boolandisinstance a|intorisinstance a negative_slope
ValueError  format a _
calculate_gain nonlinearity|a gain sqrt fan_in std
(out_planes|in_planes|kernel_size|kernel_size) weight_shape _
super self conv3X3 x conv3X3
super self conv5X5_1 x conv5X5_1
super self conv5X5_2 conv5X5_1 conv5X5
super self conv7X7_2 conv5X5_1 conv7X7_2
super self conv7X7_3 conv7X7_2 conv7X7
super self cat (conv3X3|conv5X5|conv7X7) out
super self output1 input1 output1
super self output2 input2 output2
super self output3 input3 output3
super self merge2 output2 output2
super self merge1 output1 output1
super self conv1x1 x out
super self permute out|(0|2|3|1) out
super self reshape out| P Shape out|-1|2
super self reshape out| P Shape out|-1|4
super self reshape out| P Shape out|-1|10
super self base inputs f3
super self fpn f1|f2|f3 f3
super self ssh1 f1 f1
super self ssh2 f2 f2
super self ssh3 f3 f3
super self cat bbox bbox_regressions
super self cat cls classifications
super self cat landm ldm_regressions
super self network img pre_landm
super self multibox_loss pred_loc|loc_t|pre_conf|conf_t|pre_landm|landm_t loss_landm
super self weights weights
super self network args loss
super self grad self network|weights(args|sens) grads
super self grad_reducer grads grads
super self conv3X3 x conv3X3
super self conv5X5_1 x conv5X5_1
super self conv5X5_2 conv5X5_1 conv5X5
super self conv7X7_2 conv5X5_1 conv7X7_2
super self conv7X7_3 conv7X7_2 conv7X7
super self cat (conv3X3|conv5X5|conv7X7) out
super self output1 input1 output1
super self output2 input2 output2
super self output3 input3 output3
super self merge2 output2 output2
super self merge1 output1 output1
super self conv1x1 x out
super self permute out|(0|2|3|1) out
super self reshape out| P Shape out|-1|2
super self reshape out| P Shape out|-1|4
super self reshape out| P Shape out|-1|10
super self base inputs f3
super self fpn f1|f2|f3 f3
super self ssh1 f1 f1
super self ssh2 f2 f2
super self ssh3 f3 f3
super self cat bbox bbox_regressions
super self cat cls classifications
super self cat landm ldm_regressions
super self network img pre_landm
super self multibox_loss pred_loc|loc_t|pre_conf|conf_t|pre_landm|landm_t loss_landm
super self weights weights
super self network args loss
super self grad self network|weights(args|sens) grads
super self grad_reducer grads grads
self cat (conv3X3|conv5X5|conv7X7) out output2
self cat (conv3X3|conv5X5|conv7X7) out output1
self output1 input1 output1 output1
self output2 input2 output2 output2
P ResizeNearestNeighbor [P Shape output2] up3 output2
up3|output2 output2 output2
P ResizeNearestNeighbor [P Shape output1] up2 output1
up2|output1 output1 output1
nn CellList classhead append ClassHead inchannels i i
nn CellList bboxhead append BboxHead inchannels i i
nn CellList landmarkhead append LandmarkHead inchannels i i
self base inputs f3 features
self fpn f1|f2|f3 f3 features
self ssh1 f1 f1 features
self ssh2 f2 f2 features
self ssh3 f3 f3 features
bbox|(self BboxHead i feature) bbox BboxHead i feature) bbox
self cat bbox bbox_regressions output
self cat bbox bbox_regressions Softmax classifications) output
cls|(self ClassHead i feature) cls ClassHead i feature) cls
self cat cls classifications output
landm|(self LandmarkHead i feature) landm LandmarkHead i feature) landm
self cat landm ldm_regressions output
np random rand|(b-a)
np maximum bbox_a tl
np minimum bbox_a br
np maximum area_a|1
bbox_iof box|crop_box iof
[ 0|0|image_w|image_h] candidates
range _
_rand 0 3|1 0 scale
int scale|min(image_w|image_h) nh
nh nw
int _rand 0|image_w-nw dx
int _rand 0|image_h-nh dy
np array (dx|dy|dx|nw|dy|nh) crop_box
_is_iof_satisfied_constraint boxes|crop_box[np newaxis]
candidates append (dx|dy|nw|nh)
len candidates
candidates pop np random randint 1|len(candidates) candidate
candidates pop np random randint 0|len(candidates) candidate
candidate nh
copy deepcopy boxes boxes_t
copy deepcopy landms landms_t
copy deepcopy labels labels_t
landms_t reshape [-1|5|2] landms_t
float input_w|float(nw) scale
float input_w|float(max(nh|nw)) scale
landms_t copy landms_t_1
landms_t_1 landms_t
landms_t copy landms_t_4
landms_t_4 landms_t
boxes_t mask1 boxes_t
landms_t mask1 landms_t
labels_t mask1 labels_t
boxes_t mask2 boxes_t
landms_t mask2 landms_t
labels_t mask2 labels_t
input_w boxes_t
input_h boxes_t
boxes_t box_w
boxes_t box_h
np logical_and box_w mask3
boxes_t mask3 boxes_t
landms_t mask3 landms_t
labels_t mask3 labels_t
landms_t reshape [-1|10] landms_t
np expand_dims labels_t|1 labels_t
np hstack (boxes_t|landms_t|labels_t) targets_t
sizes nw
random randint 0|4
ValueError %interp
image astype float|a|b c_image
c_image image
copy deepcopy image image
_rand -32|32 b
_rand 0 5|1 5 a
cv2 cvtColor image|cv2 COLOR_BGR2HSV image
image astype int|random randint -18|18 h_img
h_img image
cv2 cvtColor image|cv2 COLOR_HSV2BGR image
random uniform -32|32 b
random uniform 0 5|1 5 a
image astype int|random randint -18|18 tmp
tmp image
image_dim self image_input_size
copy deepcopy target _target
_target boxes
_target landms
_target labels
self _data_aug image|boxes|labels|landms|self image_input_size aug_target
image shape _
image_input_size|image_input_size input_w
_rand flip
max nw|nh l
np empty (l|l|3) t_image
(104|117|123) t_image
image t_image
t_image image
cv2 resize image|(input_w|input_h) image
image astype np float32 image
image transpose 2|0|1 image
[ 0|0|image_w|image_h] candidates append (dx|dy|nw|nh)
[ 0|0|image_w|image_h] candidates pop np random randint 1|len(candidates) candidate
[ 0|0|image_w|image_h] candidates pop np random randint 0|len(candidates) candidate
int scale|min(image_w|image_h) nh nw
len candidates pop np random randint 1|len(candidates) candidate
len candidates pop np random randint 0|len(candidates) candidate
candidates pop np random randint 1|len(candidates) candidate nh
candidates pop np random randint 0|len(candidates) candidate nh
copy deepcopy boxes boxes_t mask1 boxes_t
copy deepcopy boxes boxes_t mask2 boxes_t
copy deepcopy boxes boxes_t box_w
copy deepcopy boxes boxes_t box_h
copy deepcopy boxes boxes_t mask3 boxes_t
copy deepcopy landms landms_t reshape [-1|5|2] landms_t
copy deepcopy landms landms_t copy landms_t_1
copy deepcopy landms landms_t copy landms_t_4
copy deepcopy landms landms_t mask1 landms_t
copy deepcopy landms landms_t mask2 landms_t
copy deepcopy landms landms_t mask3 landms_t
copy deepcopy landms landms_t reshape [-1|10] landms_t
copy deepcopy labels labels_t mask1 labels_t
copy deepcopy labels labels_t mask2 labels_t
copy deepcopy labels labels_t mask3 labels_t
landms_t copy landms_t_1 landms_t
landms_t_1 landms_t copy landms_t_4
landms_t_1 landms_t mask1 landms_t
landms_t_1 landms_t mask2 landms_t
landms_t_1 landms_t mask3 landms_t
landms_t_1 landms_t reshape [-1|10] landms_t
landms_t copy landms_t_4 landms_t
landms_t_4 landms_t mask1 landms_t
landms_t_4 landms_t mask2 landms_t
landms_t_4 landms_t mask3 landms_t
landms_t_4 landms_t reshape [-1|10] landms_t
input_w boxes_t box_w
input_w boxes_t box_h
input_w boxes_t mask3 boxes_t
input_h boxes_t box_w
input_h boxes_t box_h
input_h boxes_t mask3 boxes_t
image astype float|a|b c_image image
c_image image astype int|random randint -18|18 h_img
c_image image astype int|random randint -18|18 tmp
c_image image shape _
c_image image input_w
c_image image t_image
c_image image astype np float32 image
c_image image transpose 2|0|1 image
copy deepcopy image image astype int|random randint -18|18 h_img
copy deepcopy image image astype int|random randint -18|18 tmp
copy deepcopy image image shape _
copy deepcopy image image input_w
copy deepcopy image image t_image
copy deepcopy image image astype np float32 image
copy deepcopy image image transpose 2|0|1 image
cv2 cvtColor image|cv2 COLOR_BGR2HSV image astype int|random randint -18|18 h_img
cv2 cvtColor image|cv2 COLOR_BGR2HSV image astype int|random randint -18|18 tmp
cv2 cvtColor image|cv2 COLOR_BGR2HSV image shape _
cv2 cvtColor image|cv2 COLOR_BGR2HSV image input_w
cv2 cvtColor image|cv2 COLOR_BGR2HSV image t_image
cv2 cvtColor image|cv2 COLOR_BGR2HSV image astype np float32 image
cv2 cvtColor image|cv2 COLOR_BGR2HSV image transpose 2|0|1 image
image astype int|random randint -18|18 h_img image
h_img image astype int|random randint -18|18 tmp
h_img image shape _
h_img image input_w
h_img image t_image
h_img image astype np float32 image
h_img image transpose 2|0|1 image
cv2 cvtColor image|cv2 COLOR_HSV2BGR image astype int|random randint -18|18 tmp
cv2 cvtColor image|cv2 COLOR_HSV2BGR image shape _
cv2 cvtColor image|cv2 COLOR_HSV2BGR image input_w
cv2 cvtColor image|cv2 COLOR_HSV2BGR image t_image
cv2 cvtColor image|cv2 COLOR_HSV2BGR image astype np float32 image
cv2 cvtColor image|cv2 COLOR_HSV2BGR image transpose 2|0|1 image
image astype int|random randint -18|18 tmp image
tmp image shape _
tmp image input_w
tmp image t_image
tmp image astype np float32 image
tmp image transpose 2|0|1 image
image_dim self image_input_size input_w
copy deepcopy target _target boxes
copy deepcopy target _target landms
copy deepcopy target _target labels
np empty (l|l|3) t_image image
(104|117|123) t_image image
image t_image image
t_image image astype np float32 image
t_image image transpose 2|0|1 image
cv2 resize image|(input_w|input_h) image astype np float32 image
cv2 resize image|(input_w|input_h) image transpose 2|0|1 image
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
load_checkpoint args ckpt_file param_dict
load_param_into_net network|param_dict
ConfigYOLOV3DarkNet53 config
network set_train False
[args batch_size|3]|config test_img_shape shape
Tensor np zeros shape input_data
Tensor tuple config test_img_shape input_shape
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
load_param_into_net network set_train False
network set_train False
super BuildTrainNetwork|self __init__
network self network
criterion self criterion
self network input_data output
self criterion output|label loss
argparse ArgumentParser parser
parser parse_known_args _
args max_epoch args T_max
list map int|args lr_epochs split args lr_epochs
os path join args data_dir args data_root
os path join args data_dir args annFile
[int args training_shape] training_shape
parse_args args
int os getenv devid
get_rank args rank
get_group_size args group_size
get_logger args outputs_dir|args rank args logger
args logger save_args args
AverageMeter loss_meter
context reset_auto_parallel_context
ParallelMode STAND_ALONE parallel_mode
ParallelMode DATA_PARALLEL parallel_mode
get_group_size degree
default_recurisive_init network
load_yolov3_params args|network
YoloWithLossCell network network
args logger info
ConfigYOLOV3DarkNet53 config
args label_smooth config label_smooth
args label_smooth_factor config label_smooth_factor
[conver_training_shape args] config multi_scale
args resize_rate config resize_rate
args per_batch_size|max_epoch batch_size
int data_size|args per_batch_size|args group_size args steps_per_epoch
args steps_per_epoch args ckpt_interval
get_lr args lr
Tensor lr learning_rate
args momentum momentum
args weight_decay weight_decay
keep_loss_fp32 network
TrainingWrapper network|opt|sens network
network set_train
args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num
os path join args outputs_dir save_ckpt_path
save_ckpt_path directory
_InternalCallbackParam cb_params
network cb_params train_network
ckpt_max_num cb_params epoch_num
RunContext cb_params run_context
ckpt_cb begin run_context
-1 old_progress
time time t_end
enumerate i|data
data images
images shape input_shape
args logger info  format i|input_shape
Tensor from_numpy images images
Tensor from_numpy data batch_y_true_0
Tensor from_numpy data batch_y_true_1
Tensor from_numpy data batch_y_true_2
Tensor from_numpy data batch_gt_box0
Tensor from_numpy data batch_gt_box1
Tensor from_numpy data batch_gt_box2
Tensor tuple input_shape input_shape
loss_meter update loss asnumpy
i|1 cb_params cur_step_num
i|2 cb_params batch_num
ckpt_cb step_end run_context
time time-t_end time_used
int i|args steps_per_epoch epoch
args per_batch_size|(i-old_progress)args group_size|time_used fps
loss_meter reset
i old_progress
profiler analyse
argparse ArgumentParser parser parse_known_args _
parse_args args logger save_args args
parse_args args logger info
parse_args args label_smooth config label_smooth
parse_args args label_smooth_factor config label_smooth_factor
parse_args args resize_rate config resize_rate
parse_args args per_batch_size|max_epoch batch_size
parse_args args steps_per_epoch args ckpt_interval
parse_args args momentum momentum
parse_args args weight_decay weight_decay
parse_args args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num
parse_args args logger info  format i|input_shape
parse_args args per_batch_size|(i-old_progress)args group_size|time_used fps
AverageMeter loss_meter update loss asnumpy
AverageMeter loss_meter reset
default_recurisive_init network network
default_recurisive_init network set_train
default_recurisive_init network cb_params train_network
load_yolov3_params args logger info
load_yolov3_params args label_smooth config label_smooth
load_yolov3_params args label_smooth_factor config label_smooth_factor
load_yolov3_params args resize_rate config resize_rate
load_yolov3_params args per_batch_size|max_epoch batch_size
load_yolov3_params args steps_per_epoch args ckpt_interval
load_yolov3_params args momentum momentum
load_yolov3_params args weight_decay weight_decay
load_yolov3_params network set_train
load_yolov3_params args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num
load_yolov3_params network cb_params train_network
load_yolov3_params args logger info  format i|input_shape
load_yolov3_params args per_batch_size|(i-old_progress)args group_size|time_used fps
YoloWithLossCell network network network
YoloWithLossCell network network set_train
YoloWithLossCell network network cb_params train_network
keep_loss_fp32 network network
keep_loss_fp32 network set_train
keep_loss_fp32 network cb_params train_network
TrainingWrapper network|opt|sens network network
TrainingWrapper network|opt|sens network set_train
TrainingWrapper network|opt|sens network cb_params train_network
args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num cb_params epoch_num
os path join args outputs_dir save_ckpt_path directory
enumerate data images
enumerate i old_progress
data images shape input_shape
args logger info  format i old_progress
content self content
args ignore_threshold self ignore_threshold
len self labels self num_classes
args outputs_dir self save_prefix
args annFile self annFile
COCO self annFile self _coco
list sorted self _coco imgs keys self _img_ids
args nms_thresh self nms_thresh
self _coco getCatIds self coco_catIds
self results img_id
self results clsi
self results img_id][clsi dets
np array dets dets
self _nms dets|self nms_thresh keep_index
int clsi
list dets i astype float
self det_boxes extend keep_box
predicts x1
predicts y1
x1|predicts x2
y1|predicts y2
predicts scores
(x2-x1|1)|(y2-y1|1) areas
scores argsort order
order i
reserved_boxes append i
np maximum x1 i]|x1[order max_x1
np maximum y1 i]|y1[order max_y1
np minimum x2 i]|x2[order min_x2
np minimum y2 i]|y2[order min_y2
np maximum 0 0|min_x2-max_x1|1 intersect_w
np maximum 0 0|min_y2-max_y1|1 intersect_h
intersect_w|intersect_h intersect_area
intersect_area|(areas-intersect_area) ovr
np where ovr indexs
datetime datetime now strftime t
self save_prefix self file_path
open self file_path f
json dump self det_boxes|f
RuntimeError  format str e
f close
COCO self annFile cocoGt
cocoGt loadRes self file_path cocoDt
COCOeval cocoGt|cocoDt cocoEval
cocoEval evaluate
cocoEval accumulate
Redirct rdct
sys stdout stdout
rdct sys stdout
cocoEval summarize
stdout sys stdout
len outputs outputs_num
range batch_id
range out_id
outputs out_id out_item
out_item out_item_single
out_item_single shape dimensions
dimensions d
image_shape batch_id ori_h
int image_id batch_id img_id
out_item_single    |0 x
out_item_single    |1 y
out_item_single    |2 w
out_item_single    |3 h
out_item_single conf
out_item_single cls_emb
np expand_dims np argmax cls_emb|axis cls_argmax
x reshape x
y reshape y
w reshape w
h reshape h
cls_emb reshape -1|80 cls_emb
conf reshape conf
cls_argmax reshape cls_argmax
x-w|2  x_top_left
y-h|2  y_top_left
np random random cls_emb shape flag
range i
cls_argmax i c
cls_emb flag confidence
zip x_lefti|y_lefti|wi|hi|confi|clsi
defaultdict list self results img_id
max 0|x_lefti x_lefti
max 0|y_lefti y_lefti
min wi|ori_w wi
min hi|ori_h hi
self coco_catIds clsi coco_clsi
self results img_id coco_clsi append [x_lefti|y_lefti|wi|hi|confi]
argparse ArgumentParser parser
parser parse_known_args _
os path join args data_dir args data_root
os path join args data_dir args annFile
[int args testing_shape] testing_shape
time time start_time
parse_args args
get_logger args outputs_dir|rank_id args logger
context reset_auto_parallel_context
ParallelMode STAND_ALONE parallel_mode
args logger info
args logger info args pretrained
os path isfile args pretrained
load_checkpoint args pretrained param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
args logger info  format args pretrained
FileNotFoundError  format args pretrained
args data_root data_root
args annFile ann_file
ConfigYOLOV3DarkNet53 config
conver_testing_shape args config test_img_shape
args logger info  format config test_img_shape
args logger info  format data_size
network set_train False
DetectionEngine args detection
Tensor tuple config test_img_shape input_shape
data image
data image_shape
data image_id
network image|input_shape prediction
prediction output_small
output_big asnumpy output_big
output_me asnumpy output_me
output_small asnumpy output_small
image_id asnumpy image_id
image_shape asnumpy image_shape
detection detect [output_small|output_me|output_big]|args per_batch_size|image_shape|image_id
args logger info  format iargs per_batch_size|data_size|100
detection do_nms_for_results
detection write_result result_file_path
args logger info  format result_file_path
detection get_eval_result eval_result
time time-start_time cost_time
args logger info  format cost_time|3600 
predicts x1 x2
predicts x1 areas
predicts y1 y2
predicts y1 areas
predicts scores argsort order
scores argsort order i
order i intersect_area
reserved_boxes append i intersect_area
np maximum 0 0|min_x2-max_x1|1 intersect_w intersect_area
np maximum 0 0|min_y2-max_y1|1 intersect_h intersect_area
intersect_w|intersect_h intersect_area ovr
open self file_path f close
json dump self f close
COCO self annFile cocoGt loadRes self file_path cocoDt
COCOeval cocoGt|cocoDt cocoEval evaluate
COCOeval cocoGt|cocoDt cocoEval accumulate
COCOeval cocoGt|cocoDt cocoEval summarize
Redirct rdct sys stdout
sys stdout stdout sys stdout
rdct sys stdout sys stdout
outputs out_id out_item out_item_single
out_item out_item_single shape dimensions
out_item out_item_single    |0 x
out_item out_item_single    |1 y
out_item out_item_single    |2 w
out_item out_item_single    |3 h
out_item out_item_single conf
out_item out_item_single cls_emb
out_item_single shape dimensions d
out_item_single    |0 x reshape x
out_item_single    |1 y reshape y
out_item_single    |2 w reshape w
out_item_single    |2 w  x_top_left
out_item_single    |3 h reshape h
out_item_single    |3 h  y_top_left
out_item_single conf reshape conf
out_item_single cls_emb reshape -1|80 cls_emb
out_item_single cls_emb flag confidence
np expand_dims np argmax cls_emb|axis cls_argmax reshape cls_argmax
np expand_dims np argmax cls_emb|axis cls_argmax i c
argparse ArgumentParser parser parse_known_args _
parse_args args logger info
parse_args args logger info args pretrained
parse_args args logger info  format args pretrained
parse_args args data_root data_root
parse_args args annFile ann_file
parse_args args logger info  format config test_img_shape
parse_args args logger info  format data_size
parse_args args logger info  format iargs per_batch_size|data_size|100
parse_args args logger info  format result_file_path
parse_args args logger info  format cost_time|3600 
load_checkpoint args pretrained param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
load_param_into_net network set_train False
load_param_into_net network image|input_shape prediction
DetectionEngine args detection detect [output_small|output_me|output_big]|args per_batch_size|image_shape|image_id
DetectionEngine args detection do_nms_for_results
DetectionEngine args detection write_result result_file_path
DetectionEngine args detection get_eval_result eval_result
data image_shape asnumpy image_shape
data image_id asnumpy image_id
network image|input_shape prediction output_small
prediction output_small asnumpy output_small
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step lr
lr base_lr
int max_epoch|steps_per_epoch total_steps
int warmup_epochs|steps_per_epoch warmup_steps
lr_epochs milestones
milestones milestone
milestone|steps_per_epoch milestones_step
milestones_steps append milestones_step
base_lr lr
Counter milestones_steps milestones_steps_counter
range i
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr
lr|gammamilestones_steps_counter[i] lr
lr_each_step append lr
np array lr_each_step astype np float32
lr_epochs append i
i||steps_per_epoch last_epoch
eta_min|(base_lr-eta_min)|(1 |math cos(math pi|last_epoch|T_max))|2 lr
int max_epoch|1|3 T_max_V2
lr last_lr
last_epoch last_epoch_V1
last_lr base_lr
last_epoch-last_epoch_V1 last_epoch
eta_min|(base_lr-eta_min)|(1 |math cos(math pi|last_epoch|T_max_V2))|2 lr
start_sample_epoch|step_sample|tobe_sampled_epoch end_sampled_epoch
max_epoch|tobe_sampled_epoch max_sampled_epoch
max_sampled_epoch T_max
int max_sampled_epoch|steps_per_epoch total_sampled_steps
range start_sample_epoch|end_sampled_epoch|step_sample
args lr_gamma gamma
NotImplementedError args lr_scheduler
float init_lr|lr_inc|current_step lr base_lr
float init_lr|lr_inc|current_step lr lr
float init_lr|lr_inc|current_step lr last_lr
lr base_lr lr
lr_epochs milestones milestone
milestones milestone milestones_step
base_lr lr lr
base_lr lr last_lr
range i last_epoch
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr lr
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr last_lr
lr|gammamilestones_steps_counter[i] lr lr
lr|gammamilestones_steps_counter[i] lr last_lr
lr_each_step append lr last_lr
lr_epochs append i last_epoch
i||steps_per_epoch last_epoch last_epoch_V1
eta_min|(base_lr-eta_min)|(1 |math cos(math pi|last_epoch|T_max))|2 lr last_lr
lr last_lr base_lr
max_epoch|tobe_sampled_epoch max_sampled_epoch T_max
np random rand|(b-a)
Union IOU
width orheight
np maximum bbox_a tl
np minimum bbox_a br
isinstance img|Image Image
np array img img
img|255  img
np array [0 485|0 456|0 406] mean
np array [0 229|0 224|0 225] std
(img-mean)|std img
autowillreturnAreaanyway Default:
sizes nw
random randint 0|4
ValueError %interp
np array anchors anchors
anchors shape||3 num_layers
 [6|7|8]|[3|4|5]|[0|1|2] anchor_mask
(true_boxes)||2  boxes_xy
true_boxes boxes_wh
boxes_xy|input_shape true_boxes
boxes_wh|input_shape true_boxes
[input_shape||32|input_shape||16|input_shape||8] grid_shapes
np expand_dims anchors|0 anchors
anchors|2  anchors_max
-anchors_max anchors_min
boxes_wh    |0 valid_mask
boxes_wh valid_mask wh
np expand_dims wh|-2 wh
wh|2  boxes_max
-boxes_max boxes_min
np maximum boxes_min|anchors_min intersect_min
np minimum boxes_max|anchors_max intersect_max
np maximum intersect_max-intersect_min|0  intersect_wh
intersect_wh    |0]|intersect_wh[   |1 intersect_area
wh    |0]|wh[   |1 box_area
anchors    |0]|anchors[   |1 anchor_area
intersect_area|(box_area|anchor_area-intersect_area) iou
np argmax iou|axis best_anchor
enumerate t|n
range l
np floor true_boxes t|0]|grid_shapes[l i
np floor true_boxes t|1]|grid_shapes[l j
anchor_mask l n k
true_boxes t|4 c
label_smooth_factor|(num_classes-1) sigma
sigma y_true
np zeros shape pad_gt_box0
np zeros shape pad_gt_box1
np zeros shape pad_gt_box2
np reshape y_true mask0
np reshape y_true gt_box0
gt_box0 pad_gt_box0
np reshape y_true mask1
np reshape y_true gt_box1
gt_box1 pad_gt_box1
np reshape y_true mask2
np reshape y_true gt_box2
gt_box2 pad_gt_box2
isinstance image|Image Image
Image fromarray image image
image size ori_h
np array [ori_w|ori_h]|np int32 ori_image_shape
image_size w
image resize (w|h) image
np expand_dims image_data|axis image_data
np concatenate [image_data|image_data|image_data]|axis image_data
image_data astype np float32 image_data
_rand -hue|hue hue
_rand 1|satif_rand sat
_rand 1|valif_rand val
cv2 setNumThreads
cv2 cvtColor img|cv2 COLOR_RGB2HSV_FULL x
x|255  x
x astype np uint8 x
cv2 cvtColor x|cv2 COLOR_HSV2RGB_FULL image_data
img transpose Image FLIP_LEFT_RIGHT
np expand_dims img|axis img
np concatenate [img|img|img]|axis img
bbox_iou box|crop_box iou
[ 0|0|input_w|input_h] candidates
constraints constraint
constraint max_iou
-np infifmin_iouisNoneelsemin_iou min_iou
range _
float input_w|float(input_h)|_rand(1-jitter|1|jitter)|_rand(1-jitter|1|jitter) new_ar
_rand 0 25|2 scale
int scale|input_h nh
int nh|new_ar nw
int scale|input_w nw
int nw|new_ar nh
int _rand 0|input_w-nw dx
int _rand 0|input_h-nh dy
copy deepcopy box t_box
np array (0|0|input_w|input_h) crop_box
_is_iou_satisfied_constraint min_iou|max_iou|t_box|crop_box[np newaxis]
candidates append (dx|dy|nw|nh)
len candidates
candidates pop np random randint 1|len(candidates) candidate
candidates pop np random randint 0|len(candidates) candidate
candidate nh
input_w t_box
input_h t_box
t_box box_w
t_box box_h
t_box[np logical_and box_w] t_box
t_box box_data
image size image_h
image_input_size input_w
np random shuffle box
len box
_rand flip
np zeros (max_boxes|5) box_data
image resize (nw|nh) image
Image new (input_w|input_h) new_image
new_image paste image|(dx|dy)
new_image image
filp_pil_image image image
np array image image
convert_gray_to_color image image
color_distortion image|hue|sat|val|device_num image_data
config anchor_scales config_anchors
config max_box max_boxes
config num_classes num_classes
config jitter jitter
config hue hue
config saturation sat
config value val
input_size|max_boxes image_input_size
config test_img_shape input_size
_reshape_data image|image_size ori_image_shape
config self config
config resize_rate self resize_rate
config dataset_size self dataset_size
int 1e6 self seed_num
self generate_seed_list seed_num self seed_list
int np ceil self dataset_size|self resize_rate self resize_count_num
device_num self device_num
config anchor_scales self anchor_scales
config num_classes self num_classes
config max_box self max_box
config label_smooth self label_smooth
config label_smooth_factor self label_smooth_factor
random seed init_seed
random randint seed_range|seed_range seed
seed_list append seed
batchInfo get_epoch_num epoch_num
int batchInfo get_batch_num|self resize_rate size_idx
self seed_list seed_key
self size_dict get seed_key|None
random seed seed_key
random choice self config multi_scale new_size
new_size self size_dict seed_key
seed_key seed
self size_dict seed input_size
zip img|anno
preprocess_fn img|anno|self config|input_size|self device_num anno
ret_imgs append img transpose 2|0|1 copy
 gt_box3
self num_classes|max_boxes num_classes
bbox1 append bbox_true_1
bbox2 append bbox_true_2
bbox3 append bbox_true_3
gt1 append gt_box1
gt2 append gt_box2
gt3 append gt_box3
ret_annos append
np array ret_imgs|np array ret_annos|np array bbox1|np array bbox2|np array bbox3
np array gt1|np array gt2|np array gt3
annos anno
config num_classes|max_boxes num_classes
bbox_true_1 batch_bbox_true_1
bbox_true_2 batch_bbox_true_2
bbox_true_3 batch_bbox_true_3
gt_box1 batch_gt_box1
gt_box2 batch_gt_box2
gt_box3 batch_gt_box3
i|1 i
range index
batch_bbox_true_1 append None
batch_bbox_true_2 append None
batch_bbox_true_3 append None
batch_gt_box1 append None
batch_gt_box2 append None
batch_gt_box3 append None
annos step_anno
t start
threads append t
threads t
t join
np array batch_bbox_true_1|np array batch_bbox_true_2|np array batch_bbox_true_3
np array batch_gt_box1|np array batch_gt_box2|np array batch_gt_box3
batch_bbox_true_1 append bbox_true_1
batch_bbox_true_2 append bbox_true_2
batch_bbox_true_3 append bbox_true_3
batch_gt_box1 append gt_box1
batch_gt_box2 append gt_box2
batch_gt_box3 append gt_box3
np random  [6|7|8]|[3|4|5]|[0|1|2] anchor_mask
np random  gt_box3
isinstance img|Image Image fromarray image image
isinstance img|Image Image new (input_w|input_h) new_image
np array img img  img
np array img img transpose Image FLIP_LEFT_RIGHT
img|255  img  img
img|255  img transpose Image FLIP_LEFT_RIGHT
np array [0 229|0 224|0 225] std img
(img-mean)|std img transpose Image FLIP_LEFT_RIGHT
random randint  [6|7|8]|[3|4|5]|[0|1|2] anchor_mask
random randint  gt_box3
np array anchors anchors shape||3 num_layers
np array anchors anchors  anchors_max
np array anchors anchors    |0]|anchors[   |1 anchor_area
 [6|7|8]|[3|4|5]|[0|1|2] anchor_mask l n k
(true_boxes)||2  boxes_xy true_boxes
true_boxes boxes_wh true_boxes
true_boxes boxes_wh    |0 valid_mask
true_boxes boxes_wh valid_mask wh
boxes_xy|input_shape true_boxes t|4 c
boxes_wh|input_shape true_boxes t|4 c
np expand_dims anchors|0 anchors  anchors_max
np expand_dims anchors|0 anchors    |0]|anchors[   |1 anchor_area
boxes_wh valid_mask wh  boxes_max
boxes_wh valid_mask wh    |0]|wh[   |1 box_area
np expand_dims wh|-2 wh  boxes_max
np expand_dims wh|-2 wh    |0]|wh[   |1 box_area
np maximum intersect_max-intersect_min|0  intersect_wh    |0]|intersect_wh[   |1 intersect_area
intersect_wh    |0]|intersect_wh[   |1 intersect_area iou
wh    |0]|wh[   |1 box_area iou
anchors    |0]|anchors[   |1 anchor_area iou
enumerate  gt_box3
enumerate t start
enumerate t join
np floor true_boxes t|0]|grid_shapes[l i ori_image_shape
np floor true_boxes t|0]|grid_shapes[l i i
label_smooth_factor|(num_classes-1) sigma y_true
np reshape y_true gt_box0 pad_gt_box0
np reshape y_true gt_box1 pad_gt_box1
np reshape y_true gt_box1 batch_gt_box1
np reshape y_true gt_box2 pad_gt_box2
np reshape y_true gt_box2 batch_gt_box2
isinstance image|Image Image fromarray image image
isinstance image|Image Image new (input_w|input_h) new_image
Image fromarray image image size ori_h
Image fromarray image image resize (w|h) image
Image fromarray image image size image_h
Image fromarray image image resize (nw|nh) image
Image fromarray image image ori_image_shape
np expand_dims image_data|axis image_data astype np float32 image_data
np concatenate [image_data|image_data|image_data]|axis image_data astype np float32 image_data
cv2 cvtColor img|cv2 COLOR_RGB2HSV_FULL x  x
cv2 cvtColor img|cv2 COLOR_RGB2HSV_FULL x astype np uint8 x
x|255  x  x
x|255  x astype np uint8 x
[ 0|0|input_w|input_h] candidates append (dx|dy|nw|nh)
[ 0|0|input_w|input_h] candidates pop np random randint 1|len(candidates) candidate
[ 0|0|input_w|input_h] candidates pop np random randint 0|len(candidates) candidate
constraints constraint max_iou
copy deepcopy box t_box box_w
copy deepcopy box t_box box_h
copy deepcopy box t_box box_data
candidates append  gt_box3
len candidates pop np random randint 1|len(candidates) candidate
len candidates pop np random randint 0|len(candidates) candidate
candidates pop np random randint 1|len(candidates) candidate nh
candidates pop np random randint 0|len(candidates) candidate nh
input_w t_box box_w
input_w t_box box_h
input_w t_box box_data
input_h t_box box_w
input_h t_box box_h
input_h t_box box_data
t_box[np logical_and box_w] t_box box_data
Image new (input_w|input_h) new_image paste image|(dx|dy)
Image new (input_w|input_h) new_image image
new_image paste  gt_box3
new_image image ori_image_shape
filp_pil_image image image ori_image_shape
np array image image ori_image_shape
convert_gray_to_color image image ori_image_shape
config max_box max_boxes image_input_size
self generate_seed_list seed_num self seed_list append seed
self seed_list seed_key seed
self size_dict get seed_key seed
self size_dict get  gt_box3
random seed seed_key seed
random choice self config multi_scale new_size self size_dict seed_key
new_size self size_dict seed_key seed
zip  gt_box3
 gt_box3 batch_gt_box3
bbox1 append bbox_true_1 batch_bbox_true_1
bbox2 append bbox_true_2 batch_bbox_true_2
bbox3 append bbox_true_3 batch_bbox_true_3
gt1 append gt_box1 batch_gt_box1
gt2 append gt_box2 batch_gt_box2
gt3 append gt_box3 batch_gt_box3
bbox_true_1 batch_bbox_true_1 append None
bbox_true_1 batch_bbox_true_1 append bbox_true_1
bbox_true_2 batch_bbox_true_2 append None
bbox_true_2 batch_bbox_true_2 append bbox_true_2
bbox_true_3 batch_bbox_true_3 append None
bbox_true_3 batch_bbox_true_3 append bbox_true_3
gt_box1 batch_gt_box1 append None
gt_box1 batch_gt_box1 append gt_box1
gt_box2 batch_gt_box2 append None
gt_box2 batch_gt_box2 append gt_box2
gt_box3 batch_gt_box3 append None
gt_box3 batch_gt_box3 append gt_box3
i|1 i i
threads append t join
threads t join
np array batch_bbox_true_1|np array batch_bbox_true_2|np array batch_bbox_true_3 append bbox_true_3
np array batch_gt_box1|np array batch_gt_box2|np array batch_gt_box3 append gt_box3
np array batch_gt_box1|np array batch_gt_box2|np array batch_gt_box3
[32|64|128|256|512] backbone_input_shape
[64|128|256|512|1024] backbone_shape
[1|2|8|8|4] backbone_layers
[416|416] test_img_shape
name self name
fmt self fmt
self reset
tb_writer self tb_writer
val self val
val|n self sum
n self count
self sum|self count self avg
self tb_writer add_scalar self name|self val|self cur_step
fmtstr format self __dict__
load_checkpoint ckpt_path param_dict
net init_parameters_data
load_param_into_net net|param_dict
net parameters_and_names _|param
param_not_load append param name
print len param_not_load
param_not_load param_name
print param_name
x name parameter_name
parameter_name endswith
network trainable_params x
no_decay_params append x
decay_params append x
len shape
int shape shape
self shape_record key
self shape_record key rate
logger info  format key|rate|100
network cells_and_names _|cell
isinstance cell|(YoloLossBlock|)
cell to_float mstype float32
load_param_into_net net parameters_and_names _|param
print len param_not_load param_name
x name parameter_name endswith
network cells_and_names cell to_float mstype float32
isinstance cell to_float mstype float32
super LOGGER|self __init__ logger_name
rank self rank
logging StreamHandler sys stdout console
console setLevel logging INFO
logging Formatter formatter
console setFormatter formatter
self addHandler console
os path exists log_dir
datetime now strftime| format rank log_name
os path join log_dir|log_name self log_fn
logging FileHandler self log_fn fh
fh setLevel logging INFO
fh setFormatter formatter
self addHandler fh
self isEnabledFor logging INFO
self _log logging INFO|msg|args|kwargs
self info
vars args args_dict
args_dict keys key
self info key|args_dict[key]
|line_width important_msg
|2 important_msg
self info important_msg|args|kwargs
LOGGER rank logger
logger setup_logging_file path|rank
logging StreamHandler sys stdout console setLevel logging INFO
logging StreamHandler sys stdout console setFormatter formatter
logging FileHandler self log_fn fh setLevel logging INFO
logging FileHandler self log_fn fh setFormatter formatter
vars args args_dict keys key
LOGGER rank logger setup_logging_file path|rank
ResidualBlock 3|208
super ResidualBlock|self __init__
out_channels||2 out_chls
P TensorAdd self add
x identity
self conv1 x out
self conv2 out out
self add out|identity out
tensor|(f1|f2|f3|f4|f5)
super DarkNet|self __init__
out_channels self outchannel
detect self detect
out_channels in_channel
_make_layer ConvBlock|1|128|256
block in_channel|out_channel darkblk
layers append darkblk
range _
block out_channel|out_channel darkblk
nn SequentialCell layers
self conv0 x c1
self conv1 c1 c2
self layer1 c2 c3
self conv2 c3 c4
self layer2 c4 c5
self conv3 c5 c6
self layer3 c6 c7
self conv4 c7 c8
self layer4 c8 c9
self conv5 c9 c10
self layer5 c10 c11
math sqrt
isinstance param|boolandisinstance param|intorisinstance param|float
param negative_slope
ValueError  format param
math sqrt 2 0|(1|negative_slope2)
ValueError  format nonlinearity
arr reshape arr
num arr
isinstance num|np ndarray
mode lower mode
ValueError  format mode|valid_modes
_calculate_fan_in_and_fan_out array fan_out
mathcal{U}(-\text{bound}|\text{bound})
 text{bound}
np empty 3|5 w
_calculate_correct_fan arr|mode fan
calculate_gain nonlinearity|a gain
gain|math sqrt fan std
math sqrt|std bound
np random uniform -bound|bound|arr shape
len arr shape dimensions
arr shape num_input_fmaps
arr shape num_output_fmaps
num_input_fmaps|receptive_field_size fan_in
num_output_fmaps|receptive_field_size fan_out
super KaimingUniform|self __init__
a self a
mode self mode
nonlinearity self nonlinearity
kaiming_uniform_ arr|self a|self mode|self nonlinearity tmp
_assignment arr|tmp
custom_cell cells_and_names _|cell
isinstance cell|nn Conv2d
_calculate_fan_in_and_fan_out cell weight _
isinstance cell|nn Dense
isinstance cell|(nn BatchNorm2d|nn BatchNorm1d)
load_backbone network|args pretrained_backbone|args network
args logger info  format args pretrained_backbone
args logger info
load_checkpoint args resume_yolov3 param_dict
param_dict items key|values
key startswith
values param_dict_new key
args logger info  format key
load_param_into_net network|param_dict_new
args logger info  format args resume_yolov3
isinstance param|boolandisinstance param|intorisinstance param negative_slope
isinstance param|boolandisinstance param|intorisinstance  text{bound}
math sqrt 2  text{bound}
ValueError  format nonlinearity self nonlinearity
num arr shape num_input_fmaps
num arr shape num_output_fmaps
ValueError  format  text{bound}
ValueError  format mode self mode
calculate_gain nonlinearity|a gain sqrt fan std
arr shape num_input_fmaps fan_in
arr shape num_output_fmaps fan_out
load_checkpoint args resume_yolov3 param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
super XYLoss|self __init__
P SigmoidCrossEntropyWithLogits self cross_entropy
P ReduceSum self reduce_sum
object_mask|box_loss_scale|self cross_entropy predict_xy|true_xy xy_loss
self reduce_sum xy_loss xy_loss
super WHLoss|self __init__
P Square self square
object_mask|box_loss_scale|0 5|P Square true_wh-predict_wh wh_loss
self reduce_sum wh_loss wh_loss
super ConfidenceLoss|self __init__
self cross_entropy predict_confidence|object_mask confidence_loss
object_mask|confidence_loss|(1-object_mask)|confidence_loss|ignore_mask confidence_loss
self reduce_sum confidence_loss confidence_loss
super ClassLoss|self __init__
object_mask|self cross_entropy predict_class|class_probs class_loss
self reduce_sum class_loss class_loss
self cross_entropy predict_confidence|object_mask confidence_loss confidence_loss
object_mask|confidence_loss|(1-object_mask)|confidence_loss|ignore_mask confidence_loss confidence_loss
annifv v
_has_only_empty_bbox anno
COCO ann_file self coco
root self root
list sorted self coco imgs keys self img_ids
filter_crowd_anno self filter_crowd_anno
is_training self is_training
self img_ids img_id
self coco loadAnns ann_ids anno
has_valid_annotation anno
img_ids append img_id
img_ids self img_ids
enumerate i|v
self cat_ids_to_continuous_ids items k|v
self coco coco
self img_ids index img_id
coco loadImgs img_id img_path
Image open os path join self root|img_path convert img
coco getAnnIds imgIds ann_ids
coco loadAnns ann_ids target
boxes target
classes target
target bboxes
target labels
zip bbox|label
self _convetTopDown bbox bbox
tmp extend bbox
tmp append int label
out_target append tmp
len self img_ids
bbox x_min
bbox y_min
bbox w
bbox h
cv2 setNumThreads
DistributedSampler len yolo_dataset distributed_sampler
CV HWC2CHW hwc_to_chw
len yolo_dataset config dataset_size
multiprocessing cpu_count cores
int cores|device_num num_parallel_workers
MultiScaleTrans config|device_num multi_scale_trans
min 32|num_parallel_workers num_parallel_workers
de GeneratorDataset yolo_dataset|column_names ds
ds repeat max_epoch ds
len yolo_dataset
COCO ann_file self coco loadImgs img_id img_path
COCO ann_file self coco getAnnIds imgIds ann_ids
COCO ann_file self coco loadAnns ann_ids target
list sorted self coco imgs keys self img_ids append img_id
list sorted self coco imgs keys self img_ids self img_ids
self coco coco loadImgs img_id img_path
self coco coco getAnnIds imgIds ann_ids
self coco coco loadAnns ann_ids target
coco loadAnns ann_ids target bboxes
coco loadAnns ann_ids target labels
boxes target bboxes
boxes target labels
classes target bboxes
classes target labels
zip bbox x_min
zip bbox y_min
zip bbox w
zip bbox h
self _convetTopDown bbox bbox x_min
self _convetTopDown bbox bbox y_min
self _convetTopDown bbox bbox w
self _convetTopDown bbox bbox h
tmp extend bbox x_min
tmp extend bbox y_min
tmp extend bbox w
tmp extend bbox h
de GeneratorDataset yolo_dataset|column_names ds repeat max_epoch ds
ksize kernel_size
momentum|eps momentum
tensor|(f1|f2|f3)
YoloBlock 1024|512|255
super YoloBlock|self __init__
out_chls|2 out_chls_2
self conv0 x c1
self conv1 c1 c2
self conv2 c2 c3
self conv3 c3 c4
self conv4 c4 c5
self conv5 c5 c6
self conv6 c6 out
darknet53 backbone
super YOLOv3|self __init__
out_channel self out_channel
backbone self backbone
YoloBlock backbone_shape|out_chls self backblock0
backbone_shape out_chls
P Shape x img_hight
P Shape x img_width
self backbone x feature_map3
self backblock0 feature_map3 big_object_output
self conv1 con1 con1
P ResizeNearestNeighbor (img_hight||16|img_width||16)(con1) ups1
self concat (ups1|feature_map2) con1
self backblock1 con1 medium_object_output
self conv2 con2 con2
P ResizeNearestNeighbor (img_hight||8|img_width||8)(con2) ups2
self concat (ups2|feature_map1) con3
self backblock2 con3 small_object_output
super DetectionBlock|self __init__
config self config
(0|1|2) idx
(3|4|5) idx
(6|7|8) idx
Tensor  self config anchor_scales i self anchors
nn Sigmoid self sigmoid
P Reshape self reshape
P Tile self tile
P Concat axis self concat
is_training self conf_training
P Shape x num_batch
P Shape x grid_size
P Transpose prediction|(0|3|4|1|2) prediction
range grid_size range_x
range grid_size range_y
P Cast F tuple_to_array range_x grid_x
P Cast F tuple_to_array range_y grid_y
self tile self reshape grid_x|(1|1|-1|1|1) grid_x
self tile self reshape grid_y|(1|-1|1|1|1) grid_y
self concat (grid_x|grid_y) grid
prediction box_xy
prediction box_wh
prediction box_confidence
prediction box_probs
(self sigmoid box_xy|grid)|P Cast(F tuple_to_array (grid_size|grid_size)) box_xy
P Exp box_wh|self anchors|input_shape box_wh
self sigmoid box_confidence box_confidence
self sigmoid box_probs box_probs
self concat (box_xy|box_wh|box_confidence|box_probs)
super Iou|self __init__
P Minimum self min
P Maximum self max
box1 box1_xy
box1 box1_wh
box1_xy-box1_wh|F scalar_to_array box1_mins
box1_xy|box1_wh|F scalar_to_array box1_maxs
box2 box2_xy
box2 box2_wh
box2_xy-box2_wh|F scalar_to_array box2_mins
box2_xy|box2_wh|F scalar_to_array box2_maxs
self max box1_mins|box2_mins intersect_mins
self min box1_maxs|box2_maxs intersect_maxs
self max intersect_maxs-intersect_mins|F scalar_to_array intersect_wh
P Squeeze intersect_wh| intersect_area
P Squeeze intersect_wh
P Squeeze box1_wh box1_area
P Squeeze box2_wh box2_area
intersect_area|(box1_area|box2_area-intersect_area) iou
super YoloLossBlock|self __init__
Tensor self config ignore_threshold|ms float32 self ignore_threshold
Iou self iou
XYLoss self xy_loss
WHLoss self wh_loss
ConfidenceLoss self confidenceLoss
ClassLoss self classLoss
y_true object_mask
y_true class_probs
P Shape prediction grid_shape
P Cast F tuple_to_array grid_shape grid_shape
self concat (pred_xy|pred_wh) pred_boxes
y_true|grid_shape-grid true_xy
y_true true_wh
P Log true_wh|self anchors|input_shape true_wh
P Shape gt_box gt_shape
P Reshape gt_box|(gt_shape|1|1|1|gt_shape|gt_shape) gt_box
self iou P ExpandDims pred_boxes|-2 iou
self reduce_max iou|-1 best_iou
best_iou ignore_mask
P Cast ignore_mask|ms float32 ignore_mask
P ExpandDims ignore_mask|-1 ignore_mask
F stop_gradient ignore_mask ignore_mask
self xy_loss object_mask|box_loss_scale|prediction|true_xy xy_loss
self wh_loss object_mask|box_loss_scale|prediction|true_wh wh_loss
self confidenceLoss object_mask|prediction|ignore_mask confidence_loss
self classLoss object_mask|prediction|class_probs class_loss
xy_loss|wh_loss|confidence_loss|class_loss loss
P Shape prediction batch_size
YOLOV3DarkNet53 True
super YOLOV3DarkNet53|self __init__
ConfigYOLOV3DarkNet53 self config
self config backbone_shape backbone_shape
DetectionBlock is_training self detect_1
DetectionBlock is_training self detect_2
DetectionBlock is_training self detect_3
self feature_map x small_object_output
self detect_1 big_object_output|input_shape output_big
self detect_2 medium_object_output|input_shape output_me
self detect_3 small_object_output|input_shape output_small
super YoloWithLossCell|self __init__
network self yolo_network
YoloLossBlock self config self loss_big
YoloLossBlock self config self loss_me
YoloLossBlock self config self loss_small
self yolo_network x|input_shape yolo_out
self loss_big |yolo_out|y_true_0|gt_0|input_shape loss_l
self loss_me |yolo_out|y_true_1|gt_1|input_shape loss_m
self loss_small |yolo_out|y_true_2|gt_2|input_shape loss_s
network self network
self network set_grad
optimizer parameters self weights
optimizer self optimizer
sens self sens
context get_auto_parallel_context self parallel_mode
context get_auto_parallel_context mean
auto_parallel_context get_device_num_is_set
context get_auto_parallel_context degree
get_group_size degree
nn DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
self weights weights
self network args loss
P Fill P DType loss sens
self grad self network|weights(args|sens) grads
self grad_reducer grads grads
F depend loss|self optimizer grads
momentum|eps momentum momentum
self conv6 c6 out self backblock0
darknet53 backbone self backbone
P Transpose prediction|(0|3|4|1|2) prediction box_xy
P Transpose prediction|(0|3|4|1|2) prediction box_wh
P Transpose prediction|(0|3|4|1|2) prediction box_confidence
P Transpose prediction|(0|3|4|1|2) prediction box_probs
self concat (grid_x|grid_y) grid true_xy
box1 box1_xy scalar_to_array box1_maxs
box1 box1_wh scalar_to_array box1_mins
box1 box1_wh scalar_to_array box1_maxs
box2 box2_xy scalar_to_array box2_maxs
box2 box2_wh scalar_to_array box2_mins
box2 box2_wh scalar_to_array box2_maxs
P Squeeze intersect_wh| intersect_area iou
P Squeeze box1_wh box1_area iou
P Squeeze box2_wh box2_area iou
XYLoss self xy_loss loss
WHLoss self wh_loss loss
P Shape prediction grid_shape true_xy
P Cast F tuple_to_array grid_shape grid_shape true_xy
self reduce_max iou|-1 best_iou ignore_mask
self xy_loss object_mask|box_loss_scale|prediction|true_xy xy_loss loss
self wh_loss object_mask|box_loss_scale|prediction|true_wh wh_loss loss
self confidenceLoss object_mask|prediction|ignore_mask confidence_loss loss
self classLoss object_mask|prediction|class_probs class_loss loss
xy_loss|wh_loss|confidence_loss|class_loss loss loss
os path isfile weights_file
open weights_file|
np float32 dtype
network get_parameters params
build_network params
load_weight weights_file weights
range i
params i weight
params mean
params var
params gamma
params beta
weights reshape beta shape beta_data
beta size index
weights reshape gamma shape gamma_data
gamma size index
weights reshape mean shape mean_data
mean size index
weights reshape var shape var_data
var size index
weights reshape weight shape weight_data
weight size index
param_list append {:Tensor mean_data}
param_list append {:Tensor var_data}
param_list append {:Tensor gamma_data}
param_list append {:Tensor beta_data}
save_checkpoint param_list|output_file
parser parse_args args_opt
convert args_opt input_file|args_opt output_file
network get_parameters params i weight
network get_parameters params mean
network get_parameters params var
network get_parameters params gamma
network get_parameters params beta
build_network params i weight
build_network params mean
build_network params var
build_network params gamma
build_network params beta
load_weight weights_file weights reshape beta shape beta_data
load_weight weights_file weights reshape gamma shape gamma_data
load_weight weights_file weights reshape mean shape mean_data
load_weight weights_file weights reshape var shape var_data
load_weight weights_file weights reshape weight shape weight_data
params i weight size index
params mean size index
params var size index
params gamma size index
params beta size index
convert args_opt input_file|args_opt output_file
dataset_size self dataset_size
num_replicas self num_replicas
rank self rank
int math ceil dataset_size|1 0|self num_replicas self num_samples
self num_samples|self num_replicas self total_size
shuffle self shuffle
np random RandomState seed indices
indices tolist indices
list range self dataset_size indices
iter indices
np random RandomState seed indices tolist indices
parser parse_args args_opt
iter indices
super MyTimeMonitor|self __init__
batch_size self batch_size
sink_size self size
time time self step_time
run_context original_args cb_params
cb_params net_outputs loss
isinstance loss|(tuple|list)
isinstance loss|Tensorandisinstance loss asnumpy|np ndarray
np mean loss asnumpy loss
(cb_params cur_step_num-1)%cb_params batch_num|1 cur_step_in_epoch
isinstance loss|floatand np isnan lossornp isinf loss
(time time-self step_time)|1000 step_mseconds
self batch_size|step_mseconds|1000|self size fps
[0 485|255|0 456|255|0 406|255] mean
[0 229|255|0 224|255|0 225|255] std
C Normalize mean normalize_op
C NormalizePad mean normalize_op
(0 08|1 0) scale
C Decode
C Resize
C CenterCrop image_size
trans append C HWC2CHW
ds repeat repeat_num ds
steps_per_epoch|total_epochs total_steps
steps_per_epoch|warmup_epochs warmup_steps
range i
lr_init|(lr_max-lr_init)|i|warmup_steps lr_
lr_max-(lr_max-lr_end)|(i-warmup_steps)|(total_steps-warmup_steps) lr_
lr_each_step append lr_
np array lr_each_step astype np float32 lr_each_step
int args_opt epoch_size epoch_size
int args_opt batch_size total_batch
int args_opt print_per_steps print_per_steps
str args_opt dtype lower compute_type
str args_opt ckpt_path ckpt_save_dir
bool args_opt save_ckpt save_ckpt
context GRAPH_MODE mode
context PYNATIVE_MODE mode
get_group_size device_num
dataset get_dataset_size step_size
print step_size
net cells_and_names _|cell
isinstance cell|nn Conv2d
isinstance cell|nn Dense
Tensor lr lr
net trainable_params param
decayed_params append param
no_decayed_params append param
Model net|loss_fn model
MyTimeMonitor total_batch|print_per_steps time_cb
[time_cb] cb
[ckpt_cb] cb
cb|sink_size callbacks
cb callbacks
str args_opt ckpt_path ckpt_dir
load_checkpoint ckpt_dir param_dict
load_param_into_net net|param_dict
net set_train False
model eval dataset res
run_context original_args cb_params net_outputs loss
cb_params net_outputs loss model
np mean loss asnumpy loss model
isinstance loss|floatand np isnan lossornp isinf loss model
steps_per_epoch|warmup_epochs warmup_steps lr_
range i lr_
Model net|loss_fn model eval dataset res
[time_cb] cb callbacks
[time_cb] cb callbacks
[ckpt_cb] cb callbacks
[ckpt_cb] cb callbacks
load_param_into_net net set_train False
resnet50 args|kwargs
resnet101 args|kwargs
se_resnet50 args|kwargs
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
NotImplementedError f
resnet config class_num net
load_checkpoint args ckpt_file param_dict
load_param_into_net net|param_dict
Tensor np zeros [args batch_size|3|args height|args width]|np float32 input_arr
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
parser parse_args args_opt
load_param_into_net net|param_dict
args_opt device_target target
config save_checkpoint_path ckpt_save_dir
int os getenv device_id
[85 all_reduce_fusion_config|160] context set_auto_parallel_context
[180 all_reduce_fusion_config|313] context set_auto_parallel_context
dataset get_dataset_size step_size
resnet class_num net
net set_param_ps
load_checkpoint args_opt pre_trained param_dict
net cells_and_names _|cell
isinstance cell|nn Conv2d
isinstance cell|nn Dense
config warmup_epochs|total_epochs warmup_epochs
Tensor lr lr
net trainable_params param
decayed_params append param
no_decayed_params append param
Momentum group_params|lr|config momentum|loss_scale opt
Model net|loss_fn model
TimeMonitor data_size time_cb
LossMonitor loss_cb
[time_cb|loss_cb] cb
[ckpt_cb] cb
config train_epoch_size config epoch_size
parser parse_args args_opt device_target target
load_param_into_net net set_param_ps
load_param_into_net net cells_and_names _|cell
load_param_into_net net trainable_params param
resnet class_num net set_param_ps
resnet class_num net cells_and_names _|cell
resnet class_num net trainable_params param
resnet class_num net model
Tensor lr lr momentum|loss_scale opt
TimeMonitor data_size time_cb cb
LossMonitor loss_cb cb
[time_cb|loss_cb] cb cb
parser parse_args args_opt
no_decayed_params append param
args_opt device_target target
int os getenv device_id
context set_context device_id device_id
dataset get_dataset_size step_size
resnet class_num net
load_checkpoint args_opt checkpoint_path param_dict
load_param_into_net net|param_dict
net set_train False
Model net|loss_fn model
model eval dataset res
parser parse_args args_opt device_target target
resnet class_num net set_train False
resnet class_num net model
load_param_into_net net set_train False
Model net|loss_fn model eval dataset res
 config1
 config2
 config3
 config4
lr_init float
lr_max float
total_steps int
warmup_steps int
[0 3|total_steps|0 6|total_steps|0 8|total_steps] decay_epoch_index
range i
lr_init|(lr_max-lr_init)|i|warmup_steps lr
lr_max lr
lr_max|0 1 lr
lr_max|0 01 lr
lr_max|0 001 lr
lr_each_step append lr
lr_end float
(float(lr_max)-float(lr_init))|float(warmup_steps) inc_each_step
float lr_init|inc_each_step|float(i) lr
(1 0-(float(i)-float(warmup_steps))|(float(total_steps)-float(warmup_steps))) base
float lr_max|base|base lr
total_steps-warmup_steps decay_steps
(float(lr_max)-float(lr_init))|float(warmup_steps) lr_inc
float lr_init|lr_inc|(i|1) lr
(total_steps-i)|decay_steps linear_decay
linear_decay|cosine_decay|0 00001 decayed
lr_max|decayed lr
lr_max-(lr_max-lr_end)|(i-warmup_steps)|(total_steps-warmup_steps) lr
warmup_epochs int
total_epochs int
steps_per_epoch int
lr_decay_mode string:learningratedecaymode|includingsteps|poly|cosineorliner default
steps_per_epoch|total_epochs total_steps
steps_per_epoch|warmup_epochs warmup_steps
_generate_steps_lr lr_init|lr_max|total_steps|warmup_steps lr_each_step
_generate_poly_lr lr_init|lr_end|lr_max|total_steps|warmup_steps lr_each_step
_generate_cosine_lr lr_init|lr_end|lr_max|total_steps|warmup_steps lr_each_step
_generate_liner_lr lr_init|lr_end|lr_max|total_steps|warmup_steps lr_each_step
np array lr_each_step astype np float32 lr_each_step
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step lr
lr float
max_epoch int
global_step int
lr base_lr
int max_epoch|steps_per_epoch total_steps
int warmup_epochs|steps_per_epoch warmup_steps
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr
base_lr|decayed lr
lr_each_step learning_rate
lr_init float inc_each_step
lr_init float lr_init|inc_each_step|float(i) lr
lr_init float lr_max|base|base lr
lr_init float lr_inc
lr_init float lr_init|lr_inc|(i|1) lr
lr_init float lr_inc
lr_init float init_lr|lr_inc|current_step lr
lr_max float inc_each_step
lr_max float lr_init|inc_each_step|float(i) lr
lr_max float lr_max|base|base lr
lr_max float lr_inc
lr_max float lr_init|lr_inc|(i|1) lr
lr_max float lr_inc
lr_max float init_lr|lr_inc|current_step lr
total_steps int max_epoch|steps_per_epoch total_steps
total_steps int warmup_epochs|steps_per_epoch warmup_steps
warmup_steps int max_epoch|steps_per_epoch total_steps
warmup_steps int warmup_epochs|steps_per_epoch warmup_steps
range i lr
lr_init|(lr_max-lr_init)|i|warmup_steps lr float
lr_init|(lr_max-lr_init)|i|warmup_steps lr base_lr
lr_init|(lr_max-lr_init)|i|warmup_steps lr lr
lr_max lr float
lr_max lr base_lr
lr_max lr lr
lr_max|0 1 lr float
lr_max|0 1 lr base_lr
lr_max|0 1 lr lr
lr_max|0 01 lr float
lr_max|0 01 lr base_lr
lr_max|0 01 lr lr
lr_max|0 001 lr float
lr_max|0 001 lr base_lr
lr_max|0 001 lr lr
lr_each_step append lr float
lr_each_step append lr base_lr
lr_each_step append lr lr
lr_end float inc_each_step
lr_end float lr_init|inc_each_step|float(i) lr
lr_end float lr_max|base|base lr
lr_end float lr_inc
lr_end float lr_init|lr_inc|(i|1) lr
lr_end float lr_inc
lr_end float init_lr|lr_inc|current_step lr
float lr_init|inc_each_step|float(i) lr float
float lr_init|inc_each_step|float(i) lr base_lr
float lr_init|inc_each_step|float(i) lr lr
float lr_max|base|base lr float
float lr_max|base|base lr base_lr
float lr_max|base|base lr lr
total_steps-warmup_steps decay_steps linear_decay
float lr_init|lr_inc|(i|1) lr float
float lr_init|lr_inc|(i|1) lr base_lr
float lr_init|lr_inc|(i|1) lr lr
(total_steps-i)|decay_steps linear_decay 00001 decayed
linear_decay|cosine_decay|0 00001 decayed lr
linear_decay|cosine_decay|0 00001 decayed lr
lr_max|decayed lr float
lr_max|decayed lr base_lr
lr_max|decayed lr lr
lr_max-(lr_max-lr_end)|(i-warmup_steps)|(total_steps-warmup_steps) lr float
lr_max-(lr_max-lr_end)|(i-warmup_steps)|(total_steps-warmup_steps) lr base_lr
lr_max-(lr_max-lr_end)|(i-warmup_steps)|(total_steps-warmup_steps) lr lr
warmup_epochs int max_epoch|steps_per_epoch total_steps
warmup_epochs int warmup_epochs|steps_per_epoch warmup_steps
total_epochs int max_epoch|steps_per_epoch total_steps
total_epochs int warmup_epochs|steps_per_epoch warmup_steps
steps_per_epoch int max_epoch|steps_per_epoch total_steps
steps_per_epoch int warmup_epochs|steps_per_epoch warmup_steps
_generate_steps_lr lr_init|lr_max|total_steps|warmup_steps lr_each_step learning_rate
_generate_poly_lr lr_init|lr_end|lr_max|total_steps|warmup_steps lr_each_step learning_rate
_generate_cosine_lr lr_init|lr_end|lr_max|total_steps|warmup_steps lr_each_step learning_rate
_generate_liner_lr lr_init|lr_end|lr_max|total_steps|warmup_steps lr_each_step learning_rate
np array lr_each_step astype np float32 lr_each_step learning_rate
float init_lr|lr_inc|current_step lr float
float init_lr|lr_inc|current_step lr base_lr
float init_lr|lr_inc|current_step lr lr
max_epoch int max_epoch|steps_per_epoch total_steps
max_epoch int warmup_epochs|steps_per_epoch warmup_steps
global_step int max_epoch|steps_per_epoch total_steps
global_step int warmup_epochs|steps_per_epoch warmup_steps
lr base_lr lr
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr lr
base_lr|decayed lr lr
dataset_path string
do_train bool
repeat_num int
batch_size int
target str
distribute bool
_get_rank_info rank_id
get_rank rank_id
get_group_size device_num
C RandomCrop (32|32)|(4|4|4|4)
C Resize (224|224)
C Rescale 1 0|255 0|0 0
C Normalize [0 4914|0 4822|0 4465]|[0 2023|0 1994|0 2010]
C HWC2CHW
C2 TypeCast mstype int32 type_cast_op
ds repeat repeat_num ds
[0 485|255|0 456|255|0 406|255] mean
[0 229|255|0 224|255|0 225|255] std
(0 08|1 0) scale
mean mean|std std C Normalize
C Decode
C Resize
C CenterCrop image_size
[0 475|255|0 451|255|0 392|255] mean
[0 275|255|0 267|255|0 278|255] std
C RandomHorizontalFlip rank_id|(rank_id|1)
[123 68|116 78|103 94] mean
[1 0|1 0|1 0] std
C CenterCrop
int os environ get rank_size
get_group_size rank_size
repeat_num int os environ get rank_size
batch_size int os environ get rank_size
[0 485|255|0 456|255|0 406|255] mean mean|std std C Normalize
in_channel|kernel_size|kernel_size fan_in
(scale0 5)| 87962566103423978 stddev
truncnorm -2|2|loc weight
np reshape weight|(out_channel|in_channel|kernel_size|kernel_size) weight
mstype float32 dtype
np random randn |shape astype(np float32)|factor init_value
Tensor init_value
(out_channel|in_channel|3|3) weight_shape
_weight_variable weight_shape weight
(out_channel|in_channel|1|1) weight_shape
(out_channel|in_channel|7|7) weight_shape
Tensor np reshape weight|(out_channel|in_channel) weight
(out_channel|in_channel) weight_shape
se_block bool
super ResidualBlock|self __init__
stride self stride
use_se self use_se
se_block self se_block
out_channel||self expansion channel
_bn channel self bn1
_conv3x3 channel|channel|stride self conv2
_bn channel self bn2
_bn_last out_channel self bn3
_fc out_channel|int(out_channel|4) self se_dense_0
_fc int out_channel|4 self se_dense_1
nn Sigmoid self se_sigmoid
P Mul self se_mul
nn ReLU self relu
P TensorAdd self add
x identity
self conv1 x out
self bn1 out out
self relu out out
self e2 out out
self conv2 out out
self bn2 out out
self conv3 out out
self bn3 out out
out out_se
self se_global_pool out|(2|3) out
self se_dense_0 out out
self se_dense_1 out out
self se_sigmoid out out
F reshape out|F shape out|(1|1) out
self se_mul out|out_se out
self down_sample_layer identity identity
self add out|identity out
super ResNet|self __init__
_bn self bn1_0
_bn self bn1_1
_bn self bn1
P ReLU self relu
in_channels in_channel
out_channels out_channel
strides stride
self use_se use_se
nn Flatten self flatten
_fc out_channels|num_classes|use_se self end_point
_make_layer ResidualBlock|3|128|256|2
block in_channel|out_channel|stride resnet_block
layers append resnet_block
range 1|layer_num _
range _
nn SequentialCell layers
self conv1_0 x x
self bn1_0 x x
self relu x x
self conv1_1 x x
self bn1_1 x x
self conv1_2 x x
self conv1 x x
self bn1 x x
self maxpool x c1
self layer1 c1 c2
self layer2 c2 c3
self layer3 c3 c4
self layer4 c4 c5
self mean c5|(2|3) out
self flatten out out
self end_point out out
resnet50 net
se-resnet50 net
resnet101 net
out_channel||self expansion channel expansion channel
out_channel||self expansion channel self conv2
out_channel||self expansion channel resnet_block
self conv1 x out out_se
self conv1 x out resnet_block
self bn1 out out out_se
self bn1 out out resnet_block
self relu out out out_se
self relu out out resnet_block
self e2 out out out_se
self e2 out out resnet_block
self conv2 out out out_se
self conv2 out out resnet_block
self bn2 out out out_se
self bn2 out out resnet_block
self conv3 out out out_se
self conv3 out out resnet_block
self bn3 out out out_se
self bn3 out out resnet_block
self se_global_pool out|(2|3) out resnet_block
self se_dense_0 out out resnet_block
self se_dense_1 out out resnet_block
self se_sigmoid out out resnet_block
F reshape out|F shape out|(1|1) out resnet_block
self se_mul out|out_se out resnet_block
self add out|identity out resnet_block
in_channels in_channel resnet_block
out_channels out_channel resnet_block
strides stride resnet_block
self use_se use_se self end_point
super CrossEntropySmooth|self __init__
P OneHot self onehot
sparse self sparse
Tensor 1 0-smooth_factor|mstype float32 self on_value
Tensor 1 0|smooth_factor|(num_classes-1) self off_value
nn SoftmaxCrossEntropyWithLogits reduction self ce
self onehot label|F shape logit label
self ce logit|label loss
in_channel|kernel_size|kernel_size fan_in
(scale0 5)| 87962566103423978 stddev
truncnorm -2|2|loc weight
np reshape weight|(out_channel|kernel_size|kernel_size|in_channel) weight
mstype float32 dtype
np random randn |shape astype(np float32)|factor init_value
Tensor init_value
(out_channel|3|3|in_channel) weight_shape
_trans_shape weight_shape|format_ weight_shape
_weight_variable weight_shape weight
(out_channel|1|1|in_channel) weight_shape
(out_channel|7|7|in_channel) weight_shape
(out_channel|in_channel) weight_shape
super ResidualBlock|self __init__
stride self stride
out_channel||self expansion channel
_bn channel self bn1
_conv3x3 channel|channel|stride self conv2
_bn channel self bn2
_bn_last out_channel self bn3
nn ReLU self relu
nn SequentialCell [_conv1x1 in_channel|out_channel|stride] self down_sample_layer
P TensorAdd self add
x identity
self conv1 x out
self bn1 out out
self relu out out
self conv2 out out
self bn2 out out
self conv3 out out
self bn3 out out
self down_sample_layer identity identity
self add out|identity out
super ResNet|self __init__
_bn self bn1
P ReLU self relu
in_channels in_channel
out_channels out_channel
P AvgPool 7|1|data_format self avg_pool
nn Flatten self flatten
_fc out_channels|num_classes self end_point
_make_layer ResidualBlock|3|128|256|2
block in_channel|out_channel|stride resnet_block
layers append resnet_block
range _
nn SequentialCell layers
self conv1 x x
self bn1 x x
self relu x x
self maxpool x c1
self layer1 c1 c2
self layer2 c2 c3
self layer3 c3 c4
self layer4 c4 c5
self avg_pool c5 out
self flatten out out
self end_point out out
resnet50 net
out_channel||self expansion channel expansion channel
out_channel||self expansion channel self conv2
out_channel||self expansion channel resnet_block
self conv1 x out resnet_block
self bn1 out out resnet_block
self relu out out resnet_block
self conv2 out out resnet_block
self bn2 out out resnet_block
self conv3 out out resnet_block
self bn3 out out resnet_block
self add out|identity out resnet_block
in_channels in_channel resnet_block
out_channels out_channel resnet_block
LeNet5 args|kwargs
lenet args|kwargs
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
LeNet5 cfg num_classes network
load_checkpoint args ckpt_file param_dict
load_param_into_net network|param_dict
Tensor np ones [args batch_size|1|cfg image_height|cfg image_width] inputs
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
files  ckpt
parser parse_args args
context GRAPH_MODE mode|args device_target device_target context set_context
create_dataset os path join args data_path| ds_train
LeNet5 cfg num_classes network
nn Momentum network trainable_params|cfg lr|cfg momentum net_opt
TimeMonitor data_size time_cb
Model network|net_loss|net_opt|metrics model
[time_cb|ckpoint_cb|LossMonitor] callbacks
LeNet5 cfg num_classes network model
nn Momentum network trainable_params|cfg lr|cfg momentum net_opt model
TimeMonitor data_size time_cb callbacks
parser parse_args args
context GRAPH_MODE mode|args device_target device_target context set_context
LeNet5 cfg num_classes network
cfg epoch_size repeat_size
nn Momentum network trainable_params|cfg lr|cfg momentum net_opt
Model network|net_loss|net_opt|metrics model
load_checkpoint args ckpt_path param_dict
load_param_into_net network|param_dict
model eval ds_eval acc
LeNet5 cfg num_classes network model
nn Momentum network trainable_params|cfg lr|cfg momentum net_opt model
Model network|net_loss|net_opt|metrics model eval ds_eval acc
 mnist_cfg
ds MnistDataset data_path mnist_ds
-1|0 1307|0 3081 shift_nml
CV Resize (resize_height|resize_width) resize_op
CV Rescale rescale_nml|shift_nml rescale_nml_op
CV Rescale rescale|shift rescale_op
CV HWC2CHW hwc2chw_op
C TypeCast mstype int32 type_cast_op
mnist_ds shuffle buffer_size mnist_ds
mnist_ds repeat repeat_size mnist_ds
ds MnistDataset data_path mnist_ds shuffle buffer_size mnist_ds
ds MnistDataset data_path mnist_ds repeat repeat_size mnist_ds
super LeNet5|self __init__
nn ReLU self relu
include_top self include_top
nn Flatten self flatten
nn Dense 16|5|5|120|weight_init self fc1
nn Dense 120|84|weight_init self fc2
nn Dense 84|num_class|weight_init self fc3
self conv1 x x
self relu x x
self max_pool2d x x
self conv2 x x
self flatten x x
self relu self fc1 x x
self relu self fc2 x x
self fc3 x x
Mask_Rcnn_Mobilenetv1 config config
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
args batch_size config test_batch_size
Mask_Rcnn_Mobilenetv1 config net
net set_train False
Tensor np zeros [args batch_size|3|config img_height|config img_width]|np float16 img_data
Tensor np zeros [args batch_size|4]|np float16 img_metas
Tensor np zeros [args batch_size|config num_gts|4]|np float16 gt_bboxes
Tensor np zeros [args batch_size|config num_gts]|np int32 gt_labels
Tensor np zeros [args batch_size|config num_gts]|np bool gt_num
Tensor np zeros [args batch_size|1|1|1]|np bool gt_mask
[img_data|img_metas|gt_bboxes|gt_labels|gt_num|gt_mask] input_data
args file_name|file_format file_name
parser parse_args args batch_size config test_batch_size
parser parse_args args file_name|file_format file_name
Mask_Rcnn_Mobilenetv1 config net set_train False
Tensor np zeros [args batch_size|3|config img_height|config img_width]|np float16 img_data input_data
Tensor np zeros [args batch_size|4]|np float16 img_metas input_data
Tensor np zeros [args batch_size|config num_gts|4]|np float16 gt_bboxes input_data
Tensor np zeros [args batch_size|config num_gts]|np int32 gt_labels input_data
Tensor np zeros [args batch_size|config num_gts]|np bool gt_num input_data
Tensor np zeros [args batch_size|1|1|1]|np bool gt_mask input_data
net set_train False
parser parse_args args_opt
args_opt rank_id rank
args_opt device_num device_num
config mindrecord_dir mindrecord_dir
os path join mindrecord_dir|prefix| mindrecord_file
os path isdir mindrecord_dir
os makedirs mindrecord_dir
os path isdir config coco_root
data_to_mindrecord_byte_image True|prefix
print  format mindrecord_dir
os path isdir config IMAGE_DIRandos path exists config ANNO_PATH
os path exists(mindrecord_file|)
time sleep
float config loss_scale loss_scale
dataset get_dataset_size dataset_size
print dataset_size
Mask_Rcnn_Mobilenetv1 config net
net set_train net
args_opt pre_trained load_path
load_checkpoint load_path param_dict
list item
(item startswith)
param_dict pop item
load_param_into_net net|param_dict
LossNet loss
WithLossCell net|loss net_with_loss
TrainOneStepCell net_with_loss|net|opt|sens net
TimeMonitor data_size time_cb
LossCallBack rank_id loss_cb
[time_cb|loss_cb] cb
os path join config save_checkpoint_path save_checkpoint_path
[ckpoint_cb] cb
Model net model
cb callbacks
parser parse_args args_opt rank_id rank
parser parse_args args_opt device_num device_num
parser parse_args args_opt pre_trained load_path
Mask_Rcnn_Mobilenetv1 config net set_train net
Mask_Rcnn_Mobilenetv1 config net net
load_checkpoint load_path param_dict pop item
LossNet loss net
LossNet loss cb
WithLossCell net|loss net_with_loss net
TrainOneStepCell net_with_loss|net|opt|sens net net
TimeMonitor data_size time_cb cb
LossCallBack rank_id loss_cb cb
[time_cb|loss_cb] cb cb
[time_cb|loss_cb] cb callbacks
[ckpoint_cb] cb callbacks
load_param_into_net net|param_dict
parser parse_args args_opt
Mask_Rcnn_Mobilenetv1 config net
load_checkpoint ckpt_path param_dict
net set_train False
ds get_dataset_size total
COCO ann_file dataset_coco
print total
data img_data
data img_metas
data gt_bboxes
data gt_labels
data gt_num
data gt_mask
time time start
time time end
print  format eval_iter|end-start
output all_bbox
output all_label
output all_mask
output all_mask_fb
range j
np squeeze all_bbox asnumpy all_bbox_squee
np squeeze all_label asnumpy all_label_squee
np squeeze all_mask asnumpy all_mask_squee
np squeeze all_mask_fb asnumpy all_mask_fb_squee
all_bbox_squee all_bboxes_tmp_mask
all_label_squee all_mask_squee all_labels_tmp_mask
all_mask_fb_squee all_mask_fb_tmp_mask
np argsort -all_bboxes_tmp_mask inds
all_bboxes_tmp_mask inds all_bboxes_tmp_mask
all_labels_tmp_mask inds all_labels_tmp_mask
all_mask_fb_tmp_mask inds all_mask_fb_tmp_mask
bbox2result_1image all_bboxes_tmp_mask|all_labels_tmp_mask|config num_classes bbox_results
outputs append (bbox_results|segm_results)
eval_iter|1 eval_iter
results2json dataset_coco|outputs result_files
config mindrecord_dir mindrecord_dir
os path join mindrecord_dir|prefix mindrecord_file
os path exists mindrecord_file
os path isdir mindrecord_dir
os makedirs mindrecord_dir
os path isdir config coco_root
print  format mindrecord_dir
os path isdir config IMAGE_DIRandos path exists config ANNO_PATH
MaskRcnn_eval mindrecord_file|args_opt checkpoint_path|args_opt ann_file
load_param_into_net net set_train False
Mask_Rcnn_Mobilenetv1 config net set_train False
np squeeze all_bbox asnumpy all_bbox_squee all_bboxes_tmp_mask
np squeeze all_label asnumpy all_label_squee all_mask_squee all_labels_tmp_mask
np squeeze all_mask_fb asnumpy all_mask_fb_squee all_mask_fb_tmp_mask
all_bbox_squee all_bboxes_tmp_mask inds all_bboxes_tmp_mask
all_label_squee all_mask_squee all_labels_tmp_mask inds all_labels_tmp_mask
all_mask_fb_squee all_mask_fb_tmp_mask inds all_mask_fb_tmp_mask
eval_iter|1 eval_iter eval_iter
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step learning_rate
float current_step-warmup_steps|float(decay_steps) base
(1|math cos(base|math pi))|2|base_lr learning_rate
config base_lr base_lr
(config base_step||rank_size)|rank_size base_step
int base_step|config total_epoch total_steps
int config warmup_step warmup_steps
range i
lr append linear_warmup_learning_rate i|warmup_steps|base_lr|base_lr|config warmup_ratio
lr append a_cosine_learning_rate i|base_lr|warmup_steps|total_steps
lr learning_rate
lr append a_cosine_learning_rate lr append a_cosine_learning_rate i|base_lr|warmup_steps|total_steps
lr append a_cosine_learning_rate lr learning_rate
 config
[(192|320)|(96|160)|(48|80)|(24|40)|(12|20)
np array _init_value
json load open result_files anns
mmcv is_str coco
COCO coco coco
isinstance coco|COCO
result_types res_type
result_files res_type result_file
result_file endswith
coco loadRes result_file coco_dets
coco getImgIds gt_img_ids
coco_dets getImgIds det_img_ids
COCOeval coco|coco_dets|iou_type cocoEval
list max_dets cocoEval params maxDets
dict res_dict
tgt_ids id_i
[id_i] cocoEval params imgIds
cocoEval evaluate
cocoEval accumulate
cocoEval summarize
res_dict update({coco imgs id_i stats})
tgt_ids cocoEval params imgIds
bbox tolist _bbox
list ndarray
[np zeros (0|5)] result
dataset getImgIds img_ids
dataset get_dataset_size|2 dataset_len
range idx
img_ids idx img_id
results idx bboxes
range i
dict data
img_id data
xyxy2xywh bboxes i data
float bboxes i data
json_results append data
dataset getCatIds cat_ids
len img_ids dataset_len
results idx result
enumerate label|result_label
result_label bboxes
cat_ids label data
results idx seg
enumerate label|det_label
det_label bboxes
bbox_json_results append data
seg label segms
seg label mask_score
float mask_score i data
segms i data
segm_json_results append data
dict result_files
isinstance results|list
det2json dataset|results json_results
mmcv dump json_results|result_files
isinstance results|tuple
segm2json dataset|results json_results
isinstance results|np ndarray
proposal2json dataset|results json_results
mask_pred astype np float32 mask_pred
[for_inrange num_classes-1] cls_segms
det_bboxes bboxes
det_labels|1 labels
img_meta astype np int32 ori_shape
img_meta astype np int32 scale_factor
ori_shape img_w
np round ori_shape|scale_factor astype(np int32) img_h
np round ori_shape|scale_factor astype(np int32) img_w
(bboxes|1 0) astype(np int32) bbox
labels i label
max bbox-bbox|1|1 w
max bbox-bbox|1|1 h
min w|img_w-bbox w
min h|img_h-bbox h
max w|1 w
max h|1 h
mask_pred mask_pred_
np zeros (img_h|img_w) im_mask
mmcv imresize mask_pred_|(w|h) bbox_mask
(bbox_mask) bbox_mask
bbox_mask im_mask
maskUtils encode rle
1] append rle
mmcv is_str coco loadRes result_file coco_dets
mmcv is_str coco getImgIds gt_img_ids
COCO coco coco loadRes result_file coco_dets
COCO coco coco getImgIds gt_img_ids
isinstance coco loadRes result_file coco_dets
isinstance coco getImgIds gt_img_ids
result_files res_type result_file endswith
coco loadRes result_file coco_dets getImgIds det_img_ids
COCOeval coco|coco_dets|iou_type cocoEval evaluate
COCOeval coco|coco_dets|iou_type cocoEval accumulate
COCOeval coco|coco_dets|iou_type cocoEval summarize
dict res_dict update({coco imgs id_i stats})
dataset getImgIds img_ids idx img_id
img_ids idx img_id data
results idx bboxes 0) astype(np int32) bbox
dataset getCatIds cat_ids label data
enumerate result_label bboxes
result_label bboxes 0) astype(np int32) bbox
results idx seg label segms
results idx seg label mask_score
enumerate det_label bboxes
det_label bboxes 0) astype(np int32) bbox
seg label segms i data
det_bboxes bboxes 0) astype(np int32) bbox
det_labels|1 labels labels
det_labels|1 labels i label
img_meta astype np int32 ori_shape img_w
mmcv imresize mask_pred_|(w|h) bbox_mask im_mask
(bbox_mask) bbox_mask im_mask
super RpnRegClsBlock|self __init__
nn ReLU self relu
self relu self rpn_conv x x
self rpn_cls x x1
self rpn_reg x x2
super RPN|self __init__
config cfg_rpn
cfg_rpn num_bboxes self num_bboxes
(0|) self slice_index
cfg_rpn feature_shapes shape
 self slice_index index self slice_index
(shape|shape|num_anchors|batch_size|) self feature_anchor_shape
num_anchors self num_anchors
batch_size self batch_size
cfg_rpn test_batch_size self test_batch_size
Tensor np ones (1|1) astype(np float16) self real_ratio
P Transpose self transpose
P Reshape self reshape
P Fill self fill
Tensor np ones (1|) astype(np float16) self placeh1
(0|2|3|1) self trans_shape
(-1|4) self reshape_shape_reg
(-1|) self reshape_shape_cls
Tensor np array cfg_rpn rpn_loss_reg_weight astype np float16 self rpn_loss_reg_weight
Tensor np array cfg_rpn rpn_loss_cls_weight astype np float16 self rpn_loss_cls_weight
Tensor np array cfg_rpn num_expected_neg|self batch_size astype(np float16) self num_expected_total
BboxAssignSample cfg_rpn|self batch_size|self num_bboxes|False self get_targets
P CheckValid self CheckValid
P ReduceSum self sum_loss
P SigmoidCrossEntropyWithLogits self loss_cls
P Squeeze self squeeze
P Cast self cast
P Tile self tile
P ZerosLike self zeros_like
Tensor np zeros (1|) astype(np float16) self loss
Tensor np zeros (1|) astype(np float16) self clsloss
Tensor np zeros (1|) astype(np float16) self regloss
(feat_channels|in_channels|3|3) shp_weight_conv
(feat_channels|) shp_bias_conv
initializer shape weight_conv
initializer 0|shape bias_conv
(num_anchors|cls_out_channels|feat_channels|1|1) shp_weight_cls
(num_anchors|cls_out_channels|) shp_bias_cls
initializer shape weight_cls
initializer 0|shape bias_cls
(num_anchors|4|feat_channels|1|1) shp_weight_reg
(num_anchors|4|) shp_bias_reg
initializer shape weight_reg
initializer 0|shape bias_reg
range i
rpn_layer rpn_conv weight rpn_layer i
rpn_layer rpn_cls weight rpn_layer i
rpn_layer rpn_reg weight rpn_layer i
rpn_layer rpn_conv bias rpn_layer i
rpn_layer rpn_cls bias rpn_layer i
rpn_layer rpn_reg bias rpn_layer i
self rpn_convs_list i inputs i x2
rpn_cls_score_total|(x1|) rpn_cls_score_total
rpn_bbox_pred_total|(x2|) rpn_bbox_pred_total
self transpose x1|self trans_shape x1
self reshape x1|self reshape_shape_cls x1
self transpose x2|self trans_shape x2
self reshape x2|self reshape_shape_reg x2
rpn_cls_score|(x1|) rpn_cls_score
rpn_bbox_pred|(x2|) rpn_bbox_pred
self loss loss
self clsloss clsloss
self regloss regloss
range j
multi_level_flags|(res|) multi_level_flags
anchor_list_tuple|(anchor_list[j]|) anchor_list_tuple
self concat multi_level_flags valid_flag_list
self concat anchor_list_tuple anchor_using_list
self squeeze gt_bboxes gt_bboxes_i
self squeeze gt_labels gt_labels_i
self squeeze gt_valids gt_valids_i
self cast bbox_weight|mstype float16 bbox_weight
self cast label|mstype float16 label
self cast label_weight|mstype float16 label_weight
self slice_index j begin
self slice_index end
(bbox_target|) bbox_targets
(bbox_weight|) bbox_weights
(label|) labels
(label_weight|) label_weights
(bbox_targets|) bbox_target_using
(bbox_weights|) bbox_weight_using
(labels|) label_using
(label_weights|) label_weight_using
self concat bbox_target_using bbox_target_with_batchsize
self concat bbox_weight_using bbox_weight_with_batchsize
self concat label_using label_with_batchsize
self concat label_weight_using label_weight_with_batchsize
F stop_gradient bbox_target_with_batchsize bbox_target_
F stop_gradient bbox_weight_with_batchsize bbox_weight_
F stop_gradient label_with_batchsize label_
F stop_gradient label_weight_with_batchsize label_weight_
rpn_cls_score i cls_score_i
rpn_bbox_pred i reg_score_i
self loss_cls cls_score_i|label_ loss_cls
loss_cls|label_weight_ loss_cls_item
self sum_loss loss_cls_item|(0|)|self num_expected_total loss_cls_item
self loss_bbox reg_score_i|bbox_target_ loss_reg
self tile self reshape bbox_weight_| self feature_anchor_shape i bbox_weight_
loss_reg|bbox_weight_ loss_reg
self sum_loss loss_reg|(1|) loss_reg_item
self sum_loss loss_reg_item|(0|)|self num_expected_total loss_reg_item
self rpn_loss_cls_weight|loss_cls_item|self rpn_loss_reg_weight|loss_reg_item loss_total
loss_total loss
(loss_total|loss_cls_item|loss_reg_item) loss_print
loss_cls_item clsloss
loss_reg_item regloss
(loss|rpn_cls_score_total|rpn_bbox_pred_total|clsloss|regloss|loss_print) output
(self placeh1|rpn_cls_score_total|rpn_bbox_pred_total|self placeh1|self placeh1|self placeh1) output
self rpn_cls x x1 rpn_cls_score_total
self rpn_cls x x1 rpn_cls_score
self rpn_reg x x2 rpn_bbox_pred_total
self rpn_reg x x2 rpn_bbox_pred
config cfg_rpn num_bboxes self num_bboxes
config cfg_rpn feature_shapes shape
config cfg_rpn test_batch_size self test_batch_size
cfg_rpn feature_shapes shape self feature_anchor_shape
cfg_rpn feature_shapes shape bias_conv
cfg_rpn feature_shapes shape bias_cls
cfg_rpn feature_shapes shape bias_reg
P SigmoidCrossEntropyWithLogits self loss_cls loss_cls_item
P SigmoidCrossEntropyWithLogits self loss_cls loss_print
Tensor np zeros (1|) astype(np float16) self loss loss_print
Tensor np zeros (1|) astype(np float16) self loss output
Tensor np zeros (1|) astype(np float16) self clsloss output
Tensor np zeros (1|) astype(np float16) self regloss output
self rpn_convs_list i inputs i x2 rpn_bbox_pred_total
self rpn_convs_list i inputs i x2 rpn_bbox_pred
rpn_cls_score_total|(x1|) rpn_cls_score_total rpn_cls_score_total
rpn_cls_score_total|(x1|) rpn_cls_score_total output
rpn_bbox_pred_total|(x2|) rpn_bbox_pred_total rpn_bbox_pred_total
rpn_bbox_pred_total|(x2|) rpn_bbox_pred_total output
self transpose x1|self trans_shape x1 rpn_cls_score
self reshape x1|self reshape_shape_cls x1 rpn_cls_score
self transpose x2|self trans_shape x2 rpn_bbox_pred
self reshape x2|self reshape_shape_reg x2 rpn_bbox_pred
rpn_cls_score|(x1|) rpn_cls_score rpn_cls_score
rpn_cls_score|(x1|) rpn_cls_score i cls_score_i
rpn_cls_score|(x1|) rpn_cls_score output
rpn_bbox_pred|(x2|) rpn_bbox_pred rpn_bbox_pred
rpn_bbox_pred|(x2|) rpn_bbox_pred i reg_score_i
rpn_bbox_pred|(x2|) rpn_bbox_pred output
self loss loss loss_print
self loss loss output
self clsloss clsloss output
self regloss regloss output
multi_level_flags|(res|) multi_level_flags multi_level_flags
anchor_list_tuple|(anchor_list[j]|) anchor_list_tuple anchor_list_tuple
self cast bbox_weight|mstype float16 bbox_weight bbox_weights
self cast bbox_weight|mstype float16 bbox_weight loss_reg
self cast label|mstype float16 label labels
self cast label|mstype float16 label loss_cls_item
self cast label_weight|mstype float16 label_weight label_weights
self cast label_weight|mstype float16 label_weight loss_cls_item
(bbox_target|) bbox_targets bbox_target_using
(bbox_weight|) bbox_weights bbox_weight_using
(label|) labels label_using
(label_weight|) label_weights label_weight_using
F stop_gradient bbox_weight_with_batchsize bbox_weight_ loss_reg
F stop_gradient label_with_batchsize label_ loss_cls_item
F stop_gradient label_weight_with_batchsize label_weight_ loss_cls_item
self loss_cls cls_score_i|label_ loss_cls loss_cls_item
self loss_cls cls_score_i|label_ loss_cls loss_print
loss_cls|label_weight_ loss_cls_item loss_print
loss_cls|label_weight_ loss_cls_item clsloss
self sum_loss loss_cls_item|(0|)|self num_expected_total loss_cls_item loss_print
self sum_loss loss_cls_item|(0|)|self num_expected_total loss_cls_item clsloss
self loss_bbox reg_score_i|bbox_target_ loss_reg loss_reg
self loss_bbox reg_score_i|bbox_target_ loss_reg loss_print
self tile self reshape bbox_weight_| self feature_anchor_shape i bbox_weight_ loss_reg
loss_reg|bbox_weight_ loss_reg loss_reg
loss_reg|bbox_weight_ loss_reg loss_print
self sum_loss loss_reg|(1|) loss_reg_item loss_print
self sum_loss loss_reg|(1|) loss_reg_item regloss
self sum_loss loss_reg_item|(0|)|self num_expected_total loss_reg_item loss_print
self sum_loss loss_reg_item|(0|)|self num_expected_total loss_reg_item regloss
self rpn_loss_cls_weight|loss_cls_item|self rpn_loss_reg_weight|loss_reg_item loss_total loss
self rpn_loss_cls_weight|loss_cls_item|self rpn_loss_reg_weight|loss_reg_item loss_total loss_print
loss_total loss loss_print
loss_total loss output
(loss_total|loss_cls_item|loss_reg_item) loss_print output
loss_cls_item clsloss output
loss_reg_item regloss output
super ROIAlign|self __init__
(out_size_h|out_size_w) self out_size
float spatial_scale self spatial_scale
int sample_num self sample_num
self align_op features|rois
self __class__ __name__ format_str
super SingleRoIExtractor|self __init__
config cfg
batch_size self train_batch_size
out_channels self out_channels
featmap_strides self featmap_strides
len self featmap_strides self num_levels
roi_layer self out_size
mask self mask
roi_layer self sample_num
self build_roi_layers self featmap_strides self roi_layers
L CellList self roi_layers self roi_layers
P Sqrt self sqrt
P Log self log
finest_scale self finest_scale_
C clip_by_value self clamp
P Cast self cast
P Equal self equal
P Select self select
training self training_local
self train_batch_size|self batch_size self batch_size
Tensor np array np ones (self batch_size|1) self ones
np array np ones (self batch_size|1) finest_scale
Tensor finest_scale self finest_scale
Tensor np array np ones (self batch_size|1) self epslion
Tensor np array np zeros (self batch_size|1) self zeros
Tensor np array np ones (self batch_size|1) self max_levels
Tensor np array np ones (self batch_size|1) self twos
len self featmap_strides
self log value|self log self twos
featmap_strides s
self sample_num sample_num
roi_layers append layer_cls
self sqrt rois|self ones| scale
self sqrt rois|self ones
self log2 scale|self finest_scale|self epslion target_lvls
P Floor target_lvls target_lvls
self cast target_lvls|mstype int32 target_lvls
self clamp target_lvls|self zeros|self max_levels target_lvls
(feat1|feat2|feat3|feat4) feats
self res_ res
self _c_map_roi_levels rois target_lvls
range i
self equal target_lvls|P ScalarToArray i mask
P Reshape mask|(-1|1|1|1) mask
self roi_layers i feats i roi_feats_t
self select mask|roi_feats_t|res res
(out_size_h|out_size_w) self out_size self out_size
self build_roi_layers self featmap_strides self roi_layers append layer_cls
L CellList self roi_layers self roi_layers append layer_cls
len self featmap_strides s
BboxAssignSampleForRcnn config|2|1024|True
super BboxAssignSampleForRcnn|self __init__
config cfg
batch_size self batch_size
cfg neg_iou_thr_stage2 self neg_iou_thr
cfg pos_iou_thr_stage2 self pos_iou_thr
cfg min_pos_iou_stage2 self min_pos_iou
cfg num_gts self num_gts
num_bboxes self num_bboxes
cfg num_expected_pos_stage2 self num_expected_pos
cfg num_expected_neg_stage2 self num_expected_neg
cfg num_expected_total_stage2 self num_expected_total
add_gt_as_proposals self add_gt_as_proposals
Tensor np arange 1|self num_gts|1 astype(np int32) self label_inds
P ReduceSum self sum_inds
P IOU self iou
P GreaterEqual self greaterequal
P Greater self greater
P Select self select
P GatherNd self gatherND
P Squeeze self squeeze
P Cast self cast
P LogicalAnd self logicaland
P Less self less
P RandomChoiceWithMask self num_expected_pos self random_choice_with_mask_pos
P RandomChoiceWithMask self num_expected_neg self random_choice_with_mask_neg
P Reshape self reshape
P Equal self equal
P BoundingBoxEncode means self bounding_box_encode
P LogicalNot self logicalnot
P Tile self tile
Tensor np array -1|np ones((self num_gts|4)) self check_gt_one
Tensor np array -2|np ones((self num_bboxes|4)) self check_anchor_two
Tensor np array -1|np ones num_bboxes self assigned_gt_inds
Tensor np array np zeros num_bboxes self assigned_gt_zeros
Tensor np array np ones num_bboxes self assigned_gt_ones
Tensor np array -1|np ones num_bboxes self assigned_gt_ignores
Tensor np array np ones self num_expected_pos self assigned_pos_ones
Tensor np array -1|np ones(self num_gts) self gt_ignores
Tensor np arange self num_expected_pos astype np float16 self range_pos_size
Tensor np array np ones self num_expected_neg-self num_expected_pos self check_neg_mask
Tensor np zeros (self num_expected_neg|4) self bboxs_neg_mask
Tensor np array np zeros self num_expected_neg self labels_neg_mask
(self num_expected_pos|1) self reshape_shape_pos
(self num_expected_neg|1) self reshape_shape_neg
Tensor 0 0|dtype self scalar_zero
Tensor self neg_iou_thr|dtype self scalar_neg_iou_thr
Tensor self pos_iou_thr|dtype self scalar_pos_iou_thr
Tensor self min_pos_iou|dtype self scalar_min_pos_iou
P ExpandDims self expand_dims
P Concat axis self concat_last_axis
P Round self round
Tensor [cfg img_height|cfg img_width|cfg img_height|cfg img_width]|dtype self image_h_w
(cfg mask_shape|cfg mask_shape) self mask_shape
P Squeeze axis self squeeze_mask_last
self iou bboxes|gt_bboxes_i overlaps
self max_gt overlaps max_overlaps_w_gt
self max_anchor overlaps max_overlaps_w_ac
self select neg_sample_iou_mask|self assigned_gt_zeros|self assigned_gt_inds assigned_gt_inds2
self greaterequal max_overlaps_w_gt|self scalar_pos_iou_thr pos_sample_iou_mask
range j
max_overlaps_w_ac max_overlaps_w_ac_j
overlaps overlaps_w_ac_j
self greaterequal max_overlaps_w_ac_j|self scalar_min_pos_iou temp1
self squeeze self equal overlaps_w_ac_j|max_overlaps_w_ac_j temp2
self logicaland temp1|temp2 pos_mask_j
self select pos_mask_j|(j|1)|self assigned_gt_ones|assigned_gt_inds3 assigned_gt_inds3
self select valid_mask|assigned_gt_inds3|self assigned_gt_ignores assigned_gt_inds5
self concat (gt_bboxes_i|bboxes) bboxes
self select gt_valids|self label_inds|self gt_ignores label_inds_valid
label_inds_valid|self add_gt_as_proposals_valid label_inds_valid
self concat (label_inds_valid|assigned_gt_inds5) assigned_gt_inds5
self random_choice_with_mask_pos self greater assigned_gt_inds5|0 valid_pos_index
self cast self greater assigned_gt_inds5|0 pos_check_valid
self sum_inds pos_check_valid|-1 pos_check_valid
self less self range_pos_size|pos_check_valid valid_pos_index
pos_index|self reshape(self cast(valid_pos_index|mstype int32)) pos_index
self sum_inds self cast self logicalnot valid_pos_index num_pos
self cast valid_pos_index|mstype int32 valid_pos_index
self reshape pos_index|self reshape_shape_pos pos_index
self reshape valid_pos_index|self reshape_shape_pos valid_pos_index
pos_index|valid_pos_index pos_index
self gatherND assigned_gt_inds5|pos_index-self assigned_pos_ones pos_assigned_gt_index
self reshape pos_assigned_gt_index|self reshape_shape_pos pos_assigned_gt_index
pos_assigned_gt_index|valid_pos_index pos_assigned_gt_index
self gatherND gt_labels_i|pos_assigned_gt_index pos_gt_labels
self random_choice_with_mask_neg self equal assigned_gt_inds5|0 valid_neg_index
self less self range_pos_size|num_pos unvalid_pos_index
self logicaland self concat (self check_neg_mask|unvalid_pos_index) valid_neg_index
self reshape neg_index|self reshape_shape_neg neg_index
self cast valid_neg_index|mstype int32 valid_neg_index
self reshape valid_neg_index|self reshape_shape_neg valid_neg_index
neg_index|valid_neg_index neg_index
self gatherND bboxes|pos_index pos_bboxes_
self gatherND bboxes|neg_index neg_bboxes_
self gatherND gt_bboxes_i|pos_assigned_gt_index pos_gt_bboxes_
self bounding_box_encode pos_bboxes_|pos_gt_bboxes_ pos_bbox_targets_
self gatherND gt_masks_i|pos_assigned_gt_index roi_pos_masks_fb
self cast roi_pos_masks_fb|mstype float32 pos_masks_fb
self split pos_bboxes_ y2
self concat_last_axis (y1|x1|y2|x2) boxes
boxes|self image_h_w boxes
self range box_ids
self expand_dims pos_masks_fb|-1 pos_masks_fb
self cast boxes|mstype float32 boxes
self crop_and_resize pos_masks_fb|boxes|box_ids|self mask_shape pos_masks_fb
self squeeze_mask_last pos_masks_fb pos_masks_fb
self round pos_masks_fb pos_masks_fb
self cast pos_masks_fb|mstype float16 pos_masks_fb
self concat (pos_bboxes_|neg_bboxes_) total_bboxes
self concat (pos_bbox_targets_|self bboxs_neg_mask) total_deltas
self concat (pos_gt_labels|self labels_neg_mask) total_labels
self concat (valid_pos_index|valid_neg_index) total_mask
BboxAssignSampleForRcnn config cfg
config cfg neg_iou_thr_stage2 self neg_iou_thr
config cfg pos_iou_thr_stage2 self pos_iou_thr
config cfg min_pos_iou_stage2 self min_pos_iou
config cfg num_gts self num_gts
config cfg num_expected_pos_stage2 self num_expected_pos
config cfg num_expected_neg_stage2 self num_expected_neg
config cfg num_expected_total_stage2 self num_expected_total
self iou bboxes|gt_bboxes_i overlaps overlaps_w_ac_j
self max_anchor overlaps max_overlaps_w_ac max_overlaps_w_ac_j
self select gt_valids|self label_inds|self gt_ignores label_inds_valid add_gt_as_proposals_valid label_inds_valid
label_inds_valid|self add_gt_as_proposals_valid label_inds_valid add_gt_as_proposals_valid label_inds_valid
self random_choice_with_mask_pos self greater assigned_gt_inds5|0 valid_pos_index pos_index
self random_choice_with_mask_pos self greater assigned_gt_inds5|0 valid_pos_index pos_assigned_gt_index
self less self range_pos_size|pos_check_valid valid_pos_index pos_index
self less self range_pos_size|pos_check_valid valid_pos_index pos_assigned_gt_index
pos_index|self reshape(self cast(valid_pos_index|mstype int32)) pos_index reshape(self cast(valid_pos_index|mstype int32)) pos_index
pos_index|self reshape(self cast(valid_pos_index|mstype int32)) pos_index pos_index
self cast valid_pos_index|mstype int32 valid_pos_index pos_index
self cast valid_pos_index|mstype int32 valid_pos_index pos_assigned_gt_index
self reshape pos_index|self reshape_shape_pos pos_index pos_index
self reshape valid_pos_index|self reshape_shape_pos valid_pos_index pos_index
self reshape valid_pos_index|self reshape_shape_pos valid_pos_index pos_assigned_gt_index
pos_index|valid_pos_index pos_index pos_index
self gatherND assigned_gt_inds5|pos_index-self assigned_pos_ones pos_assigned_gt_index pos_assigned_gt_index
self reshape pos_assigned_gt_index|self reshape_shape_pos pos_assigned_gt_index pos_assigned_gt_index
pos_assigned_gt_index|valid_pos_index pos_assigned_gt_index pos_assigned_gt_index
self random_choice_with_mask_neg self equal assigned_gt_inds5|0 valid_neg_index neg_index
self logicaland self concat (self check_neg_mask|unvalid_pos_index) valid_neg_index neg_index
self reshape neg_index|self reshape_shape_neg neg_index neg_index
self cast valid_neg_index|mstype int32 valid_neg_index neg_index
self reshape valid_neg_index|self reshape_shape_neg valid_neg_index neg_index
neg_index|valid_neg_index neg_index neg_index
self concat_last_axis (y1|x1|y2|x2) boxes image_h_w boxes
boxes|self image_h_w boxes image_h_w boxes
mobilenetv1 backbone
Mask_Rcnn_Mobilenetv1 net
super Mask_Rcnn_Mobilenetv1|self __init__
config batch_size self train_batch_size
config num_classes self num_classes
config anchor_scales self anchor_scales
config anchor_ratios self anchor_ratios
config anchor_strides self anchor_strides
tuple config rcnn_target_means self target_means
tuple config rcnn_target_stds self target_stds
list self anchor_base_sizes
self anchor_base_sizes anchor_base
len self anchor_ratios|len(self anchor_scales) self num_anchors
config feature_shapes featmap_sizes
self get_anchors featmap_sizes self anchor_list
Tensor np ones (self train_batch_size|config num_gts) astype(np uint8) self gt_labels_stage1
self proposal_generator set_train_local config|True
self proposal_generator_test set_train_local config|False
self roi_align set_train_local config|True
self roi_align_mask set_train_local config|True
self roi_align_test set_train_local config|False
self roi_align_mask_test set_train_local config|False
RcnnCls config|self train_batch_size|self num_classes self rcnn_cls
RcnnMask config|self train_batch_size|self num_classes self rcnn_mask
P Squeeze self squeeze
P Cast self cast
P Reshape self reshape
P Select self select
P Greater self greater
P Transpose self transpose
config test_batch_size self test_batch_size
P Tile self tile
P GatherNd self gather
config rpn_max_num self rpn_max_num
Tensor np zeros (self rpn_max_num|3) astype(np float16) self zeros_for_nms
np ones (self rpn_max_num|1) astype(np bool) self ones_mask
np zeros (self rpn_max_num|1) astype(np bool) self zeros_mask
Tensor np ones (self rpn_max_num|1) astype(np float16)|config test_score_thr self test_score_thresh
Tensor np ones (self rpn_max_num|1) astype(np float16)|0 self test_score_zeros
Tensor np ones (self rpn_max_num|4) astype(np float16)|-1 self test_box_zeros
Tensor np ones (self rpn_max_num|1) astype(np float16)|config test_iou_thr self test_iou_thr
config test_max_per_img self test_max_per_img
P NMSWithMask config test_iou_thr self nms_test
P LogicalAnd self logicand
P OnesLike self oneslike
self test_batch_size|self rpn_max_num self test_num_proposal
min self num_classes-2|55 self concat_start
(self num_classes-1) self concat_end
Tensor np concatenate roi_align_index self roi_align_index_tensor
Tensor np concatenate roi_align_index_test self roi_align_index_test_tensor
Tensor np concatenate roi_align_index_pos self roi_align_index_tensor_pos
Tensor np array config rcnn_loss_cls_weight astype np float16 self rcnn_loss_cls_weight
Tensor np array config rcnn_loss_reg_weight astype np float16 self rcnn_loss_reg_weight
Tensor np array config rcnn_loss_mask_fb_weight astype np float16 self rcnn_loss_mask_fb_weight
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
P OneHot self onehot
P ReduceSum self reducesum
P Sigmoid self sigmoid
P ExpandDims self expand_dims
Tensor np zeros (self rpn_max_num|28|28) astype(np float16) self test_mask_fb_zeros
Tensor 1 0|mstype float16 self value
self backbone img_data x
self fpn_ncek x x
self proposal_generator cls_score|bbox_pred|self anchor_list proposal_mask
self proposal_generator_test cls_score|bbox_pred|self anchor_list proposal_mask
self cast gt_labels|mstype int32 gt_labels
self cast gt_valids|mstype int32 gt_valids
range i
self squeeze gt_bboxes gt_bboxes_i
self squeeze gt_labels gt_labels_i
self cast gt_labels_i|mstype uint8 gt_labels_i
self squeeze gt_valids gt_valids_i
self cast gt_valids_i|mstype bool_ gt_valids_i
self squeeze gt_masks gt_masks_i
self cast gt_masks_i|mstype bool_ gt_masks_i
 pos_mask
(bboxes|) bboxes_tuple
(deltas|) deltas_tuple
(labels|) labels_tuple
(mask|) mask_tuple
(pos_bboxes|) pos_bboxes_tuple
(pos_mask_fb|) pos_mask_fb_tuple
(pos_labels|) pos_labels_tuple
(pos_mask|) pos_mask_tuple
self concat deltas_tuple bbox_targets
self concat labels_tuple rcnn_labels
F stop_gradient bbox_targets bbox_targets
F stop_gradient rcnn_labels rcnn_labels
self cast rcnn_labels|mstype int32 rcnn_labels
self concat pos_mask_fb_tuple rcnn_pos_masks_fb
F stop_gradient rcnn_pos_masks_fb rcnn_pos_masks_fb
self concat pos_labels_tuple rcnn_pos_labels
F stop_gradient rcnn_pos_labels rcnn_pos_labels
self cast rcnn_pos_labels|mstype int32 rcnn_pos_labels
proposal_mask mask_tuple
proposal_mask bbox_targets
proposal_mask rcnn_labels
proposal_mask rcnn_pos_masks_fb
proposal_mask rcnn_pos_labels
proposal p_i
(p_i|) bboxes_tuple
self concat bboxes_tuple bboxes_all
self concat pos_bboxes_tuple pos_bboxes_all
bboxes_tuple bboxes_all
pos_bboxes_tuple pos_bboxes_all
self concat_1 (self roi_align_index_tensor|bboxes_all) rois
self concat_1 (self roi_align_index_tensor_pos|pos_bboxes_all) pos_rois
self cast pos_rois|mstype float32 pos_rois
F stop_gradient pos_rois pos_rois
self concat_1 (self roi_align_index_test_tensor|bboxes_all) rois
self cast rois|mstype float32 rois
F stop_gradient rois rois
self cast x|mstype float32
self cast roi_feats|mstype float16 roi_feats
self concat mask_tuple rcnn_masks
F stop_gradient rcnn_masks rcnn_masks
self squeeze self cast rcnn_masks|mstype bool_ rcnn_mask_squeeze
self concat pos_mask_tuple rcnn_pos_masks
F stop_gradient rcnn_pos_masks rcnn_pos_masks
self squeeze self cast rcnn_pos_masks|mstype bool_ rcnn_pos_mask_squeeze
self cast roi_feats_mask|mstype float16 roi_feats_mask
self rcnn_loss_cls_weight|rcnn_cls_loss|self rcnn_loss_reg_weight|rcnn_reg_loss| rcnn_loss
(rpn_loss|rcnn_loss|rpn_cls_loss|rpn_reg_loss|rcnn_cls_loss|rcnn_reg_loss|rcnn_mask_fb_loss) output
self rcnn_mask_test x|bboxes_all|rcnn_cls_loss|rcnn_reg_loss mask_fb_pred_all
self softmax cls_logits|self value scores
self sigmoid mask_fb_pred_all mask_fb_logits
i|4 k
self squeeze reg_logits reg_logits_i
self decode rois|reg_logits_i out_boxes_i
(out_boxes_i|) boxes_all
self split img_metas img_metas_all
self split scores scores_all
self split self cast mask_logits|mstype int32 mask_all
self split mask_fb_logits mask_fb_all
self split_shape self squeeze img_metas_all i scale
scale scale_h
scale scale_w
range j
self split boxes_all j boxes_tmp
boxes_tmp i out_boxes_h
boxes_tmp i out_boxes_w
(self select(self bbox_mask|out_boxes_w|out_boxes_h)) boxes_tuple
(boxes_tuple|) boxes_all_with_batchsize
self multiclass_nms boxes_all_with_batchsize|scores_all|mask_all|mask_fb_all output
boxes_all i bboxes
scores_all i scores
self cast mask_all i masks
mask_fb_all i masks_fb
self split_fb_mask masks_fb _mask_fb_all
range self num_classes j
j|1 k
scores _cls_scores
self squeeze bboxes k _bboxes
self reshape masks|(self rpn_max_num|1) _mask_o
self squeeze _mask_fb_all k _masks_fb
self greater _cls_scores|self test_score_thresh cls_mask
self logicand _mask_o|cls_mask _mask
self cast self tile self cast _mask|mstype int32 _reg_mask
self select _reg_mask|_bboxes|self test_box_zeros _bboxes
self expand_dims _mask|-1 _fb_mask
self cast self tile self cast _fb_mask|mstype int32 _mask_fb_mask
self select _mask_fb_mask|_masks_fb|self test_mask_fb_zeros _masks_fb
self select _mask|_cls_scores|self test_score_zeros _cls_scores
self squeeze _cls_scores __cls_scores
self test_topk __cls_scores|self rpn_max_num topk_inds
self reshape topk_inds|(self rpn_max_num|1) topk_inds
self reshape scores_sorted|(self rpn_max_num|1) scores_sorted
self gather _bboxes|topk_inds _bboxes_sorted
self gather _masks_fb|topk_inds _mask_fb_sorted
self gather _mask|topk_inds _mask_sorted
self tile scores_sorted|(1|4) scores_sorted
self concat_1 (_bboxes_sorted|scores_sorted) cls_dets
P Slice cls_dets|(0|0) cls_dets
self nms_test cls_dets _mask_nms
self reshape _index|(self rpn_max_num|1) _index
self reshape _mask_nms|(self rpn_max_num|1) _mask_nms
self gather _mask_sorted|_index _mask_n
self logicand _mask_n|_mask_nms _mask_n
self gather _mask_fb_sorted|_index _mask_fb
self oneslike _index|j cls_labels
(cls_dets|) res_boxes_tuple
(cls_labels|) res_labels_tuple
(_mask_n|) res_masks_tuple
(_mask_fb|) res_masks_fb_tuple
self concat res_boxes_tuple res_boxes_start
self concat res_labels_tuple res_labels_start
self concat res_masks_tuple res_masks_start
self concat res_masks_fb_tuple res_masks_fb_start
self concat res_boxes_tuple res_boxes_end
self concat res_labels_tuple res_labels_end
self concat res_masks_tuple res_masks_end
self concat res_masks_fb_tuple res_masks_fb_end
self concat (res_boxes_start|res_boxes_end) res_boxes
self concat (res_labels_start|res_labels_end) res_labels
self concat (res_masks_start|res_masks_end) res_masks
self concat (res_masks_fb_start|res_masks_fb_end) res_masks_fb
(self num_classes-1)|self rpn_max_num reshape_size
self reshape res_boxes|(1|reshape_size|5) res_boxes
self reshape res_labels|(1|reshape_size|1) res_labels
self reshape res_masks|(1|reshape_size|1) res_masks
self reshape res_masks_fb|(1|reshape_size|28|28) res_masks_fb
(res_boxes|) all_bboxes
(res_labels|) all_labels
(res_masks|) all_masks
(res_masks_fb|) all_masks_fb
self concat all_bboxes all_bboxes
self concat all_labels all_labels
self concat all_masks all_masks
self concat all_masks_fb all_masks_fb
len featmap_sizes num_levels
self anchor_generators i anchors
(Tensor(anchors astype(np float16))) multi_level_anchors
self softmax cls_pred|self value cls_scores
self split cls_scores cls_scores_all
self reshape reg_pred|(-1|self num_classes|4) reg_pred
self split reg_pred reg_pred_all
self split rois rois_all
self argmax_with_value cls_scores_all i _
self expand_dims cls_score_max_index|-1 cls_score_max_index
self tile cls_score_max_index|(1|1|4) cls_score_max_index
reg_pred_all i reg_pred_max
self reducesum reg_pred_max|1 reg_pred_max
self decode rois_all i out_boxes_i
(out_boxes_i|) boxes_tuple
self concat boxes_tuple boxes_all
self concat_1 (self roi_align_index_test_tensor|boxes_all) boxes_rois
self cast boxes_rois|mstype float32 boxes_rois
self cast roi_feats_mask_test|mstype float16 roi_feats_mask_test
self rcnn_mask roi_feats_mask_test mask_fb_pred_all
self proposal_generator set_train_local config test_batch_size self test_batch_size
self proposal_generator set_train_local config rpn_max_num self rpn_max_num
self proposal_generator set_train_local config test_max_per_img self test_max_per_img
self proposal_generator set_train_local  pos_mask
self proposal_generator_test set_train_local config test_batch_size self test_batch_size
self proposal_generator_test set_train_local config rpn_max_num self rpn_max_num
self proposal_generator_test set_train_local config test_max_per_img self test_max_per_img
self proposal_generator_test set_train_local  pos_mask
self proposal_generator_test set_train_local F stop_gradient bbox_targets bbox_targets
self proposal_generator_test set_train_local F stop_gradient rcnn_labels rcnn_labels
self proposal_generator_test set_train_local F stop_gradient rcnn_pos_masks_fb rcnn_pos_masks_fb
self proposal_generator_test set_train_local F stop_gradient rcnn_pos_labels rcnn_pos_labels
self proposal_generator_test set_train_local F stop_gradient pos_rois pos_rois
self proposal_generator_test set_train_local F stop_gradient rois rois
self proposal_generator_test set_train_local F stop_gradient rcnn_masks rcnn_masks
self proposal_generator_test set_train_local F stop_gradient rcnn_pos_masks rcnn_pos_masks
self roi_align set_train_local config test_batch_size self test_batch_size
self roi_align set_train_local config rpn_max_num self rpn_max_num
self roi_align set_train_local config test_max_per_img self test_max_per_img
self roi_align set_train_local  pos_mask
self roi_align_mask set_train_local config test_batch_size self test_batch_size
self roi_align_mask set_train_local config rpn_max_num self rpn_max_num
self roi_align_mask set_train_local config test_max_per_img self test_max_per_img
self roi_align_mask set_train_local  pos_mask
self roi_align_test set_train_local config test_batch_size self test_batch_size
self roi_align_test set_train_local config rpn_max_num self rpn_max_num
self roi_align_test set_train_local config test_max_per_img self test_max_per_img
self roi_align_test set_train_local  pos_mask
self roi_align_test set_train_local F stop_gradient bbox_targets bbox_targets
self roi_align_test set_train_local F stop_gradient rcnn_labels rcnn_labels
self roi_align_test set_train_local F stop_gradient rcnn_pos_masks_fb rcnn_pos_masks_fb
self roi_align_test set_train_local F stop_gradient rcnn_pos_labels rcnn_pos_labels
self roi_align_test set_train_local F stop_gradient pos_rois pos_rois
self roi_align_test set_train_local F stop_gradient rois rois
self roi_align_test set_train_local F stop_gradient rcnn_masks rcnn_masks
self roi_align_test set_train_local F stop_gradient rcnn_pos_masks rcnn_pos_masks
self roi_align_mask_test set_train_local config test_batch_size self test_batch_size
self roi_align_mask_test set_train_local config rpn_max_num self rpn_max_num
self roi_align_mask_test set_train_local config test_max_per_img self test_max_per_img
self roi_align_mask_test set_train_local  pos_mask
self roi_align_mask_test set_train_local F stop_gradient bbox_targets bbox_targets
self roi_align_mask_test set_train_local F stop_gradient rcnn_labels rcnn_labels
self roi_align_mask_test set_train_local F stop_gradient rcnn_pos_masks_fb rcnn_pos_masks_fb
self roi_align_mask_test set_train_local F stop_gradient rcnn_pos_labels rcnn_pos_labels
self roi_align_mask_test set_train_local F stop_gradient pos_rois pos_rois
self roi_align_mask_test set_train_local F stop_gradient rois rois
self roi_align_mask_test set_train_local F stop_gradient rcnn_masks rcnn_masks
self roi_align_mask_test set_train_local F stop_gradient rcnn_pos_masks rcnn_pos_masks
RcnnCls config|self train_batch_size|self num_classes self rcnn_cls output
RcnnMask config|self train_batch_size|self num_classes self rcnn_mask output
self proposal_generator cls_score|bbox_pred|self anchor_list proposal_mask mask_tuple
self proposal_generator cls_score|bbox_pred|self anchor_list proposal_mask bbox_targets
self proposal_generator cls_score|bbox_pred|self anchor_list proposal_mask rcnn_labels
self proposal_generator cls_score|bbox_pred|self anchor_list proposal_mask rcnn_pos_masks_fb
self proposal_generator cls_score|bbox_pred|self anchor_list proposal_mask rcnn_pos_labels
self proposal_generator_test cls_score|bbox_pred|self anchor_list proposal_mask mask_tuple
self proposal_generator_test cls_score|bbox_pred|self anchor_list proposal_mask bbox_targets
self proposal_generator_test cls_score|bbox_pred|self anchor_list proposal_mask rcnn_labels
self proposal_generator_test cls_score|bbox_pred|self anchor_list proposal_mask rcnn_pos_masks_fb
self proposal_generator_test cls_score|bbox_pred|self anchor_list proposal_mask rcnn_pos_labels
range i bboxes_tuple
range i k
range i boxes_all
range i boxes_tuple
 pos_mask pos_mask_tuple
(bboxes|) bboxes_tuple bboxes_all
(pos_bboxes|) pos_bboxes_tuple pos_bboxes_all
proposal p_i bboxes_tuple
(p_i|) bboxes_tuple bboxes_all
self rcnn_loss_cls_weight|rcnn_cls_loss|self rcnn_loss_reg_weight|rcnn_reg_loss| rcnn_loss output
self softmax cls_logits|self value scores _cls_scores
self decode rois|reg_logits_i out_boxes_i boxes_all
self decode rois|reg_logits_i out_boxes_i boxes_tuple
(out_boxes_i|) boxes_all i bboxes
self split scores scores_all i scores
self split mask_fb_logits mask_fb_all i masks_fb
self split_shape self squeeze img_metas_all i scale scale_h
self split_shape self squeeze img_metas_all i scale scale_w
range j k
self split boxes_all j boxes_tmp i out_boxes_h
self split boxes_all j boxes_tmp i out_boxes_w
(self select(self bbox_mask|out_boxes_w|out_boxes_h)) boxes_tuple boxes_all_with_batchsize
scores_all i scores _cls_scores
self cast mask_all i masks all_masks
mask_fb_all i masks_fb all_masks_fb
range self num_classes j k
self squeeze _mask_fb_all k _masks_fb all_masks_fb
self select _mask_fb_mask|_masks_fb|self test_mask_fb_zeros _masks_fb all_masks_fb
self concat_1 (_bboxes_sorted|scores_sorted) cls_dets res_boxes_tuple
P Slice cls_dets|(0|0) cls_dets res_boxes_tuple
self gather _mask_sorted|_index _mask_n res_masks_tuple
self logicand _mask_n|_mask_nms _mask_n res_masks_tuple
self gather _mask_fb_sorted|_index _mask_fb res_masks_fb_tuple
self oneslike _index|j cls_labels res_labels_tuple
self concat (res_boxes_start|res_boxes_end) res_boxes all_bboxes
self concat (res_labels_start|res_labels_end) res_labels all_labels
self concat (res_masks_start|res_masks_end) res_masks all_masks
self concat (res_masks_fb_start|res_masks_fb_end) res_masks_fb all_masks_fb
self reshape res_boxes|(1|reshape_size|5) res_boxes all_bboxes
self reshape res_labels|(1|reshape_size|1) res_labels all_labels
self reshape res_masks|(1|reshape_size|1) res_masks all_masks
self reshape res_masks_fb|(1|reshape_size|28|28) res_masks_fb all_masks_fb
self split reg_pred reg_pred_all i reg_pred_max
self decode rois_all i out_boxes_i boxes_tuple
tensor|(proposal|mask)
( 0| 0| 0| 0) target_means
(1 0|1 0|1 0|1 0) target_stds
super Proposal|self __init__
config cfg
batch_size self batch_size
num_classes self num_classes
target_means self target_means
target_stds self target_stds
use_sigmoid_cls self use_sigmoid_cls
num_classes-1 self cls_out_channels
P Sigmoid self activation
(-1|1) self reshape_shape
num_classes self cls_out_channels
(-1|2) self reshape_shape
cfg rpn_proposal_nms_pre self num_pre
cfg rpn_proposal_min_bbox_size self min_box_size
cfg rpn_proposal_nms_thr self nms_thr
cfg rpn_proposal_nms_post self nms_post
cfg rpn_proposal_nms_across_levels self nms_across_levels
cfg rpn_proposal_max_num self max_num
cfg fpn_num_outs self num_levels
P Squeeze self squeeze
P Reshape self reshape
P Cast self cast
cfg feature_shapes self feature_shapes
(1|2|0) self transpose_shape
self target_means| means
P NMSWithMask self nms_thr self nms
P Minimum self min
P GatherNd self gatherND
P Slice self slice
P Select self select
P Greater self greater
P Transpose self transpose
P Tile self tile
Tensor 10 0|mstype float16 self multi_10
training self training_local
cfg rpn_nms_pre self num_pre
cfg rpn_min_bbox_min_size self min_box_size
cfg rpn_nms_thr self nms_thr
cfg rpn_nms_post self nms_post
cfg rpn_nms_across_levels self nms_across_levels
cfg rpn_max_num self max_num
self feature_shapes shp
min self num_pre|(shp|shp|3) k_num
k_num total_max_topk_input
(k_num|) self topK_stage1
((k_num|1)) self topK_shape
(self max_num|1) self topK_shape_stage2
-65536 0 self min_float_num
Tensor self min_float_num|np ones(total_max_topk_input|np float16) self topK_mask
range img_id
range i
self squeeze rpn_cls_score_total rpn_cls_score_i
self squeeze rpn_bbox_pred_total rpn_bbox_pred_i
cls_score_list|(rpn_cls_score_i|) cls_score_list
bbox_pred_list|(rpn_bbox_pred_i|) bbox_pred_list
self get_bboxes_single cls_score_list|bbox_pred_list|anchor_list masks
(proposals|) proposals_tuple
(masks|) masks_tuple
range idx
self transpose cls_scores idx rpn_cls_score
self transpose bbox_preds idx rpn_bbox_pred
mlvl_anchors idx anchors
self reshape rpn_cls_score|self reshape_shape rpn_cls_score
self activation rpn_cls_score rpn_cls_score
self cast self squeeze rpn_cls_score rpn_cls_score_process
self cast self reshape rpn_bbox_pred|(-1|4) rpn_bbox_pred_process
self topKv2 rpn_cls_score_process|self topK_stage1 idx topk_inds
self reshape topk_inds|self topK_shape idx topk_inds
self gatherND rpn_bbox_pred_process|topk_inds bboxes_sorted
self cast self gatherND anchors|topk_inds anchors_sorted
self decode anchors_sorted|bboxes_sorted proposals_decode
self concat_axis1  proposals_decode|self reshape scores_sorted|self topK_shape idx proposals_decode
self nms proposals_decode mask_valid
mlvl_proposals|(proposals|) mlvl_proposals
mlvl_mask|(mask_valid|) mlvl_mask
self concat_axis0 mlvl_proposals proposals
self concat_axis0 mlvl_mask masks
self split proposals scores
self squeeze scores scores
self cast self topK_mask|mstype float16 topk_mask
self select masks|scores|topk_mask scores_using
self topKv2 scores_using|self max_num topk_inds
self reshape topk_inds|self topK_shape_stage2 topk_inds
self gatherND proposals|topk_inds proposals
self gatherND masks|topk_inds masks
( 0| 0| 0| 0) target_means self target_means
(1 0|1 0|1 0|1 0) target_stds self target_stds
config cfg rpn_proposal_nms_pre self num_pre
config cfg rpn_proposal_min_bbox_size self min_box_size
config cfg rpn_proposal_nms_thr self nms_thr
config cfg rpn_proposal_nms_post self nms_post
config cfg rpn_proposal_nms_across_levels self nms_across_levels
config cfg rpn_proposal_max_num self max_num
config cfg fpn_num_outs self num_levels
config cfg feature_shapes self feature_shapes
config cfg rpn_nms_pre self num_pre
config cfg rpn_min_bbox_min_size self min_box_size
config cfg rpn_nms_thr self nms_thr
config cfg rpn_nms_post self nms_post
config cfg rpn_nms_across_levels self nms_across_levels
config cfg rpn_max_num self max_num
P Minimum self min self num_pre|(shp|shp|3) k_num
min self num_pre|(shp|shp|3) k_num total_max_topk_input
min self num_pre|(shp|shp|3) k_num self topK_stage1
min self num_pre|(shp|shp|3) k_num self topK_shape
range i cls_score_list
range i bbox_pred_list
self squeeze rpn_cls_score_total rpn_cls_score_i cls_score_list
self squeeze rpn_bbox_pred_total rpn_bbox_pred_i bbox_pred_list
cls_score_list|(rpn_cls_score_i|) cls_score_list cls_score_list
bbox_pred_list|(rpn_bbox_pred_i|) bbox_pred_list bbox_pred_list
self get_bboxes_single cls_score_list|bbox_pred_list|anchor_list masks masks_tuple
self nms proposals_decode mask_valid mlvl_mask
mlvl_proposals|(proposals|) mlvl_proposals mlvl_proposals
mlvl_mask|(mask_valid|) mlvl_mask mlvl_mask
super DenseNoTranpose|self __init__
P BiasAdd self bias_add
self bias_add self matmul x|self weight output
super FpnCls|self __init__
input_channels|pool_size|pool_size representation_size
(output_channels|representation_size) shape_0
initializer shape weights_0
(output_channels|output_channels) shape_1
initializer shape weights_1
DenseNoTranpose representation_size|output_channels|weights_0 self shared_fc_0
DenseNoTranpose output_channels|output_channels|weights_1 self shared_fc_1
DenseNoTranpose output_channels|num_classes|cls_weight self cls_scores
DenseNoTranpose output_channels|num_classes|4|reg_weight self reg_scores
P ReLU self relu
P Flatten self flatten
self flatten x x
self relu self shared_fc_0 x x
self relu self shared_fc_1 x x
self cls_scores x cls_scores
self reg_scores x reg_scores
(0 |0 |0 |0 ) target_means
(0 1|0 1|0 2|0 2) target_stds
super RcnnCls|self __init__
config cfg
Tensor np array cfg rcnn_loss_cls_weight astype np float16 self rcnn_loss_cls_weight
Tensor np array cfg rcnn_loss_reg_weight astype np float16 self rcnn_loss_reg_weight
cfg rcnn_fc_out_channels self rcnn_fc_out_channels
target_means self target_means
target_stds self target_stds
num_classes self num_classes
cfg rcnn_in_channels self in_channels
batch_size self train_batch_size
cfg test_batch_size self test_batch_size
FpnCls self in_channels|self rcnn_fc_out_channels|self num_classes|cfg roi_layer self fpn_cls
P LogicalAnd self logicaland
P SoftmaxCrossEntropyWithLogits self loss_cls
P SigmoidCrossEntropyWithLogits self loss_mask
P Reshape self reshape
P OneHot self onehot
P Greater self greater
P Cast self cast
P ReduceSum self sum_loss
P Tile self tile
P ExpandDims self expandims
P GatherNd self gather
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
Tensor 1 0|mstype float16 self value
(cfg num_expected_pos_stage2|cfg num_expected_neg_stage2)|batch_size self num_bboxes
np ones (self num_bboxes|self num_classes) rmv_first
np zeros (self num_bboxes|) rmv_first
Tensor rmv_first astype np float16 self rmv_first_tensor
cfg rpn_max_num|cfg test_batch_size self num_bboxes_test
self fpn_cls featuremap x_reg
self cast self logicaland self greater labels|0 bbox_weights
self cast self onehot labels|self num_classes|self on_value|self off_value labels
self tile self expandims bbox_targets|1 bbox_targets
(loss_cls|loss_reg) out
(x_cls|x_reg) out
self loss_cls cls_score|labels _
self cast weights|mstype float16 weights
loss_cls|weights loss_cls
self sum_loss loss_cls|(0|)|self sum_loss weights|(0|) loss_cls
bbox_weights|self rmv_first_tensor bbox_weights
self reshape bbox_pred|(self num_bboxes|-1|4) pos_bbox_pred
self loss_bbox pos_bbox_pred|bbox_targets loss_reg
self sum_loss loss_reg|(2|) loss_reg
loss_reg|bbox_weights loss_reg
loss_reg|self sum_loss weights|(0|) loss_reg
self sum_loss loss_reg|(0|1) loss_reg
self bias_add self matmul x|self weight output shape_1
input_channels|pool_size|pool_size representation_size shape_0
self flatten x x out
self relu self shared_fc_0 x x out
self relu self shared_fc_1 x x out
(0 |0 |0 |0 ) target_means self target_means
(0 1|0 1|0 2|0 2) target_stds self target_stds
config cfg rcnn_fc_out_channels self rcnn_fc_out_channels
config cfg rcnn_in_channels self in_channels
config cfg test_batch_size self test_batch_size
config cfg rpn_max_num|cfg test_batch_size self num_bboxes_test
P SoftmaxCrossEntropyWithLogits self loss_cls out
P SoftmaxCrossEntropyWithLogits self loss_cls loss_cls
self fpn_cls featuremap x_reg out
self cast self logicaland self greater labels|0 bbox_weights rmv_first_tensor bbox_weights
self cast self logicaland self greater labels|0 bbox_weights loss_reg
self cast weights|mstype float16 weights loss_cls
self cast weights|mstype float16 weights rmv_first_tensor bbox_weights
loss_cls|weights loss_cls loss_cls
bbox_weights|self rmv_first_tensor bbox_weights rmv_first_tensor bbox_weights
bbox_weights|self rmv_first_tensor bbox_weights loss_reg
self loss_bbox pos_bbox_pred|bbox_targets loss_reg loss_reg
self loss_bbox pos_bbox_pred|bbox_targets loss_reg sum_loss weights|(0|) loss_reg
self sum_loss loss_reg|(2|) loss_reg loss_reg
self sum_loss loss_reg|(2|) loss_reg sum_loss weights|(0|) loss_reg
loss_reg|bbox_weights loss_reg loss_reg
loss_reg|bbox_weights loss_reg sum_loss weights|(0|) loss_reg
loss_reg|self sum_loss weights|(0|) loss_reg sum_loss weights|(0|) loss_reg
output append nn BatchNorm2d out_channel
output append nn get_activation activation
nn SequentialCell output
super MobileNetV1|self __init__
features_only self features_only
conv_bn_relu 3|32|3|2|False
conv_bn_relu 32|32|3|1|True
conv_bn_relu 32|64|1|1|False
conv_bn_relu 64|64|3|2|True
conv_bn_relu 64|128|1|1|False
conv_bn_relu 128|128|3|1|True
conv_bn_relu 128|128|1|1|False
conv_bn_relu 128|128|3|2|True
conv_bn_relu 128|256|1|1|False
conv_bn_relu 256|256|3|1|True
conv_bn_relu 256|256|1|1|False
conv_bn_relu 256|256|3|2|True
conv_bn_relu 256|512|1|1|False
conv_bn_relu 512|512|3|1|True
conv_bn_relu 512|512|1|1|False
conv_bn_relu 512|512|3|2|True
conv_bn_relu 512|1024|1|1|False
conv_bn_relu 1024|1024|3|1|True
conv_bn_relu 1024|1024|1|1|False
nn CellList cnn self network
nn SequentialCell cnn self network
nn Dense 1024|class_num self fc
x output
self network block
block output output
features|(output|) features
self network x output
P ReduceMean output|(2|3) output
self fc output output
super FeatureSelector|self __init__
feature_idxes self feature_idxes
self feature_idxes i
selected|(feature_list[i]|) selected
super MobileNetV1_FeatureSelector|self __init__
MobileNetV1 class_num self mobilenet_v1
FeatureSelector [6|10|22|26] self selector
self mobilenet_v1 x features
self selector features features
nn SequentialCell output features
x output features
self network block output output
block output output features
features|(output|) features features
selected|(feature_list[i]|) selected selected
base_size self base_size
np array scales self scales
np array ratios self ratios
scale_major self scale_major
ctr self ctr
self gen_base_anchors self base_anchors
self base_size w
self base_size h
self ctr y_ctr
np sqrt self ratios h_ratios
(w|w_ratios) reshape ws
(h|h_ratios) reshape hs
(w|self scales) reshape ws
(h|self scales) reshape hs
np stack base_anchors
np repeat y|len(x) yy
self base_anchors base_anchors
featmap_size feat_w
np arange 0|feat_w|stride shift_x
np arange 0|feat_h|stride shift_y
self _meshgrid shift_x|shift_y shift_yy
np stack [shift_xx|shift_yy|shift_xx|shift_yy]|axis shifts
shifts astype base_anchors dtype shifts
base_anchors all_anchors
all_anchors reshape -1|4 all_anchors
self gen_base_anchors self base_anchors all_anchors
self base_size w reshape ws
self base_size w scales) reshape ws
self base_size h reshape hs
self base_size h scales) reshape hs
np sqrt self ratios h_ratios reshape hs
np stack base_anchors all_anchors
self base_anchors base_anchors all_anchors
np stack [shift_xx|shift_yy|shift_xx|shift_yy]|axis shifts astype base_anchors dtype shifts
base_anchors all_anchors reshape -1|4 all_anchors
Tensor np array np zeros shape astype np float32 astype np float16
(out_channels|in_channels|kernel_size|kernel_size) shape
initializer shape weights
(out_channels|) shape_bias
bias_init_zeros shape_bias biass
kernel_size|stride kernel_size
FeatPyramidNeck [100|200|300]|50|4 neck
neck input_data x
super FeatPyramidNeck|self __init__
num_outs self num_outs
in_channels self in_channels
len self in_channels self fpn_layer
len in_channels
enumerate _|channel
self lateral_convs_list_ append l_conv
self fpn_convs_ append fpn_conv
nn layer CellList self lateral_convs_list_ self lateral_convs_list
nn layer CellList self fpn_convs_ self fpn_convs_list
P ResizeBilinear (48|80) self interpolate1
P ResizeBilinear (96|160) self interpolate2
P ResizeBilinear (192|320) self interpolate3
P Cast self cast
range i
 self lateral_convs_list i inputs i x
(x|) y
y|(x|self cast(self interpolate1(y[self fpn_layer-4]))) y
y|(x|self cast(self interpolate2(y[self fpn_layer-3]))) y
y|(x|self cast(self interpolate3(y[self fpn_layer-2]))) y
range self fpn_layer i
z|(y[i]|) z
outs| self fpn_convs_list i z i outs
range self num_outs i
outs|(self maxpool outs) outs
kernel_size|stride kernel_size kernel_size
FeatPyramidNeck [100|200|300]|50|4 neck input_data x
neck input_data x y
neck input_data x cast(self interpolate1(y[self fpn_layer-4]))) y
neck input_data x cast(self interpolate2(y[self fpn_layer-3]))) y
neck input_data x cast(self interpolate3(y[self fpn_layer-2]))) y
 self lateral_convs_list i inputs i x y
(self lateral_convs_list i inputs i x cast(self interpolate1(y[self fpn_layer-4]))) y
(self lateral_convs_list i inputs i x cast(self interpolate2(y[self fpn_layer-3]))) y
(self lateral_convs_list i inputs i x cast(self interpolate3(y[self fpn_layer-2]))) y
(x|) y cast(self interpolate1(y[self fpn_layer-4]))) y
(x|) y cast(self interpolate2(y[self fpn_layer-3]))) y
(x|) y cast(self interpolate3(y[self fpn_layer-2]))) y
y|(x|self cast(self interpolate1(y[self fpn_layer-4]))) y cast(self interpolate1(y[self fpn_layer-4]))) y
y|(x|self cast(self interpolate1(y[self fpn_layer-4]))) y cast(self interpolate2(y[self fpn_layer-3]))) y
y|(x|self cast(self interpolate1(y[self fpn_layer-4]))) y cast(self interpolate3(y[self fpn_layer-2]))) y
y|(x|self cast(self interpolate2(y[self fpn_layer-3]))) y cast(self interpolate2(y[self fpn_layer-3]))) y
y|(x|self cast(self interpolate2(y[self fpn_layer-3]))) y cast(self interpolate3(y[self fpn_layer-2]))) y
y|(x|self cast(self interpolate3(y[self fpn_layer-2]))) y cast(self interpolate3(y[self fpn_layer-2]))) y
z|(y[i]|) z z
outs| self fpn_convs_list i z i outs fpn_convs_list i z i outs
outs|(self fpn_convs_list i z i outs maxpool outs) outs
outs|(self maxpool outs) outs maxpool outs) outs
BboxAssignSample config|2|1024|True
super BboxAssignSample|self __init__
config cfg
batch_size self batch_size
Tensor cfg neg_iou_thr|mstype float16 self neg_iou_thr
Tensor cfg pos_iou_thr|mstype float16 self pos_iou_thr
Tensor cfg min_pos_iou|mstype float16 self min_pos_iou
Tensor 0 0|mstype float16 self zero_thr
num_bboxes self num_bboxes
cfg num_gts self num_gts
cfg num_expected_pos self num_expected_pos
cfg num_expected_neg self num_expected_neg
add_gt_as_proposals self add_gt_as_proposals
Tensor np arange 1|self num_gts|1 self label_inds
P ReduceSum self sum_inds
P IOU self iou
P GreaterEqual self greaterequal
P Greater self greater
P Select self select
P GatherNd self gatherND
P Squeeze self squeeze
P Cast self cast
P LogicalAnd self logicaland
P Less self less
P RandomChoiceWithMask self num_expected_pos self random_choice_with_mask_pos
P RandomChoiceWithMask self num_expected_neg self random_choice_with_mask_neg
P Reshape self reshape
P Equal self equal
P BoundingBoxEncode means self bounding_box_encode
P ScatterNdUpdate self scatterNdUpdate
P ScatterNd self scatterNd
P LogicalNot self logicalnot
P Tile self tile
P ZerosLike self zeros_like
Tensor np array -1|np ones num_bboxes self assigned_gt_inds
Tensor np array np zeros num_bboxes self assigned_gt_zeros
Tensor np array np ones num_bboxes self assigned_gt_ones
Tensor np array -1|np ones num_bboxes self assigned_gt_ignores
Tensor np array np ones self num_expected_pos self assigned_pos_ones
Tensor np array np ones self num_expected_neg-self num_expected_pos self check_neg_mask
Tensor np arange self num_expected_pos astype np float16 self range_pos_size
Tensor np array -1|np ones((self num_gts|4)) self check_gt_one
Tensor np array -2|np ones((self num_bboxes|4)) self check_anchor_two
self iou bboxes|gt_bboxes_i overlaps
self max_gt overlaps max_overlaps_w_gt
self max_anchor overlaps max_overlaps_w_ac
self select neg_sample_iou_mask|self assigned_gt_zeros|self assigned_gt_inds assigned_gt_inds2
self greaterequal max_overlaps_w_gt|self pos_iou_thr pos_sample_iou_mask
assigned_gt_inds3 assigned_gt_inds4
range j
max_overlaps_w_ac max_overlaps_w_ac_j
self squeeze overlaps overlaps_w_gt_j
self select pos_mask_j|self assigned_gt_ones|j|assigned_gt_inds4 assigned_gt_inds4
self select valid_mask|assigned_gt_inds4|self assigned_gt_ignores assigned_gt_inds5
self random_choice_with_mask_pos self greater assigned_gt_inds5|0 valid_pos_index
self cast self greater assigned_gt_inds5|0 pos_check_valid
self sum_inds pos_check_valid|-1 pos_check_valid
self less self range_pos_size|pos_check_valid valid_pos_index
pos_index|self reshape(self cast(valid_pos_index|mstype int32)) pos_index
self gatherND assigned_gt_inds5|pos_index-self assigned_pos_ones pos_assigned_gt_index
pos_assigned_gt_index|self cast(valid_pos_index|mstype int32) pos_assigned_gt_index
self reshape pos_assigned_gt_index|(self num_expected_pos|1) pos_assigned_gt_index
self random_choice_with_mask_neg self equal assigned_gt_inds5|0 valid_neg_index
self cast self logicalnot valid_pos_index num_pos
self sum_inds num_pos|-1 num_pos
self less self range_pos_size|num_pos unvalid_pos_index
self logicaland self concat (self check_neg_mask|unvalid_pos_index) valid_neg_index
self gatherND bboxes|pos_index pos_bboxes_
self gatherND gt_bboxes_i|pos_assigned_gt_index pos_gt_bboxes_
self gatherND gt_labels_i|pos_assigned_gt_index pos_gt_labels
self bounding_box_encode pos_bboxes_|pos_gt_bboxes_ pos_bbox_targets_
self cast valid_pos_index|mstype int32 valid_pos_index
self cast valid_neg_index|mstype int32 valid_neg_index
self scatterNd pos_index|pos_bbox_targets_|(self num_bboxes|4) bbox_targets_total
self scatterNd pos_index|valid_pos_index|(self num_bboxes|) bbox_weights_total
self scatterNd pos_index|pos_gt_labels|(self num_bboxes|) labels_total
self concat (pos_index|neg_index) total_index
self concat (valid_pos_index|valid_neg_index) total_valid_index
self scatterNd total_index|total_valid_index|(self num_bboxes|) label_weights_total
self cast bbox_weights_total|mstype bool_
self cast label_weights_total|mstype bool_
BboxAssignSample config cfg
config cfg num_gts self num_gts
config cfg num_expected_pos self num_expected_pos
config cfg num_expected_neg self num_expected_neg
self max_anchor overlaps max_overlaps_w_ac max_overlaps_w_ac_j
pos_index|self reshape(self cast(valid_pos_index|mstype int32)) pos_index reshape(self cast(valid_pos_index|mstype int32)) pos_index
self gatherND assigned_gt_inds5|pos_index-self assigned_pos_ones pos_assigned_gt_index cast(valid_pos_index|mstype int32) pos_assigned_gt_index
pos_assigned_gt_index|self cast(valid_pos_index|mstype int32) pos_assigned_gt_index cast(valid_pos_index|mstype int32) pos_assigned_gt_index
(out_channels|in_channels|kernel_size|kernel_size) shape
initializer shape weights
(out_channels|) shape_bias
Tensor np array np zeros shape_bias astype np float16 bias
kernel_size|stride kernel_size
super FpnMask|self __init__
P ReLU self mask_relu1
P ReLU self mask_relu2
P ReLU self mask_relu3
P ReLU self mask_relu4
P ReLU self mask_relu5
self mask_conv1 x x
self mask_relu1 x x
self mask_conv2 x x
self mask_relu2 x x
self mask_conv3 x x
self mask_relu3 x x
self mask_conv4 x x
self mask_relu4 x x
self mask_deconv5 x x
self mask_relu5 x x
self mask_conv6 x x
(0 |0 |0 |0 ) target_means
(0 1|0 1|0 2|0 2) target_stds
super RcnnMask|self __init__
config cfg
Tensor np array cfg rcnn_loss_mask_fb_weight astype np float16 self rcnn_loss_mask_fb_weight
cfg rcnn_mask_out_channels self rcnn_mask_out_channels
target_means self target_means
target_stds self target_stds
num_classes self num_classes
cfg rcnn_in_channels self in_channels
FpnMask self in_channels|self rcnn_mask_out_channels|self num_classes self fpn_mask
P LogicalAnd self logicaland
P SigmoidCrossEntropyWithLogits self loss_mask
P OneHot self onehot
P Greater self greater
P Cast self cast
P ReduceSum self sum_loss
P Tile self tile
P ExpandDims self expandims
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
cfg num_expected_pos_stage2|batch_size self num_bboxes
np ones (self num_bboxes|self num_classes) rmv_first
np zeros (self num_bboxes|) rmv_first
Tensor rmv_first astype np float16 self rmv_first_tensor
P ReduceMean self mean_loss
self fpn_mask mask_featuremap x_mask_fb
self cast self logicaland self greater labels|0 bbox_weights
self tile self expandims mask_fb_targets|1 mask_fb_targets
self loss x_mask_fb|bbox_weights|mask|mask_fb_targets loss_mask_fb
loss_mask_fb out
x_mask_fb out
self cast weights|mstype float16 weights
bbox_weights|self rmv_first_tensor bbox_weights
self cast masks_fb_targets|mstype float16 masks_fb_targets
self loss_mask masks_fb_pred|masks_fb_targets loss_mask_fb
self mean_loss loss_mask_fb|(2|3) loss_mask_fb
loss_mask_fb|bbox_weights loss_mask_fb
loss_mask_fb|self sum_loss weights|(0|) loss_mask_fb
self sum_loss loss_mask_fb|(0|1) loss_mask_fb
initializer shape weights rmv_first_tensor bbox_weights
kernel_size|stride kernel_size kernel_size
(0 |0 |0 |0 ) target_means self target_means
(0 1|0 1|0 2|0 2) target_stds self target_stds
config cfg rcnn_mask_out_channels self rcnn_mask_out_channels
config cfg rcnn_in_channels self in_channels
config cfg num_expected_pos_stage2|batch_size self num_bboxes
self fpn_mask mask_featuremap x_mask_fb out
self cast self logicaland self greater labels|0 bbox_weights rmv_first_tensor bbox_weights
self cast self logicaland self greater labels|0 bbox_weights loss_mask_fb
self loss x_mask_fb|bbox_weights|mask|mask_fb_targets loss_mask_fb out
self loss x_mask_fb|bbox_weights|mask|mask_fb_targets loss_mask_fb loss_mask_fb
self loss x_mask_fb|bbox_weights|mask|mask_fb_targets loss_mask_fb sum_loss weights|(0|) loss_mask_fb
self cast weights|mstype float16 weights rmv_first_tensor bbox_weights
bbox_weights|self rmv_first_tensor bbox_weights rmv_first_tensor bbox_weights
bbox_weights|self rmv_first_tensor bbox_weights loss_mask_fb
self loss_mask masks_fb_pred|masks_fb_targets loss_mask_fb loss_mask_fb
self loss_mask masks_fb_pred|masks_fb_targets loss_mask_fb sum_loss weights|(0|) loss_mask_fb
self mean_loss loss_mask_fb|(2|3) loss_mask_fb loss_mask_fb
self mean_loss loss_mask_fb|(2|3) loss_mask_fb sum_loss weights|(0|) loss_mask_fb
loss_mask_fb|bbox_weights loss_mask_fb loss_mask_fb
loss_mask_fb|bbox_weights loss_mask_fb sum_loss weights|(0|) loss_mask_fb
loss_mask_fb|self sum_loss weights|(0|) loss_mask_fb sum_loss weights|(0|) loss_mask_fb
bboxes1 ndarray:shape n|4
bboxes2 ndarray:shape k|4
ious ndarray:shape n|k
bboxes1 astype np float32 bboxes1
bboxes2 astype np float32 bboxes2
bboxes1 shape rows
bboxes2 shape cols
np zeros (rows|cols) ious
bboxes2|bboxes1 bboxes2
np zeros (cols|rows) ious
(bboxes1|1) area1
(bboxes2|1) area2
range i
np maximum bboxes1 x_start
np maximum bboxes1 y_start
np minimum bboxes1 x_end
np minimum bboxes1 y_end
np maximum x_end-x_start|1|0|np maximum overlap
area1 i union
overlap|union ious
ious T ious
(0 5|1 5) contrast_range
(0 5|1 5) saturation_range
brightness_delta self brightness_delta
contrast_range self contrast_upper
saturation_range self saturation_upper
hue_delta self hue_delta
img astype img
random randint
delta img
random randint mode
mmcv bgr2hsv img img
mmcv hsv2bgr img img
img    |random permutation img
mean self mean
ratio_range self max_ratio
img shape c
random uniform self min_ratio|self max_ratio ratio
int random uniform 0|w|ratio-w left
int random uniform 0|h|ratio-h top
img expand_img
expand_img img
np tile (left|top) boxes
mask shape mask_w
np zeros (mask_count|int(mask_h|ratio)) expand_mask
mask expand_mask
expand_mask mask
scale_factor|scale_factor2 scale_factor
gt_bboxes|scale_factor gt_bboxes
 gt_mask_data
gt_mask mask
config img_height-img_data shape pad_h
config img_width-img_data shape pad_w
np zeros (config img_height|config img_width|3) astype(img_data dtype) pad_img_data
img_data pad_img_data
gt_mask_data shape mask_w
np zeros (mask_count|config img_height|config img_width) astype(gt_mask_data dtype) pad_mask
gt_mask_data pad_mask
(config img_height|config img_width|1 0) img_shape
np asarray img_shape|dtype img_shape
np append img_shape|(scale_factor|scale_factor) img_shape
img img_data
mmcv imresize h_scale
np array scale_factor
np append img_shape|(h_scale|w_scale) img_shape
mmcv impad img|(config img_height|config img_width) img_data
img_data astype np float32 img_data
mmcv imnormalize img|[123 675|116 28|103 53]|[58 395|57 12|57 375]|True img_data
mmcv imflip img_data img_data
gt_bboxes copy flipped
img_data shape _
np array gt_mask_data
img transpose 2|0|1 copy img_data
img_data astype np float16 img_data
img_shape astype np float16 img_shape
gt_bboxes astype np float16 gt_bboxes
gt_label astype np int32 gt_label
gt_num astype np bool gt_num
gt_mask astype np bool gt_mask_data
PhotoMetricDistortion random_photo
random_photo img|gt_bboxes|gt_label gt_label
Expand expand
expand img|gt_bboxes|gt_label|gt_mask gt_mask
config max_instance_count pad_max_number
 gt_iscrowd_new_revert
image_bgr|image_shape|gt_box_new|gt_label_new|gt_iscrowd_new_revert|gt_mask_new input_data
rescale_column_test |input_data input_data
resize_column_test |input_data input_data
imnormalize_column |input_data input_data
pad_to_max |input_data|instance_count input_data
transpose_column |input_data output_data
image copy image_bgr
image_bgr shape image_shape
box shape instance_count
box gt_box
box gt_label
box gt_iscrowd
mask copy gt_mask
mask_shape w
gt_mask reshape n|h|w gt_mask
_infer_data image_bgr|image_shape|gt_box|gt_label|gt_iscrowd|gt_mask|instance_count
(np random rand) flip
(np random rand) expand
image_bgr|image_shape|gt_box|gt_label|gt_iscrowd|gt_mask input_data
expand_column |input_data input_data
rescale_column |input_data input_data
resize_column |input_data input_data
flip_column |input_data input_data
_data_aug image|box|mask|mask_shape|is_training
ann segm
isinstance segm|list
maskHelper frPyObjects segm|height|width rles
maskHelper merge rles rle
maskHelper frPyObjects segm|height|width rle
ann rle
maskHelper decode rle m
config coco_root coco_root
config val_data_type data_type
config train_data_type data_type
config coco_classes train_cls
enumerate i|cls
i train_cls_dict cls
os path join coco_root|config instance_set format data_type anno_json
COCO anno_json coco
coco loadCats coco getCatIds cat_ids
cat_ids cat
coco getImgIds image_ids
len image_ids images_num
enumerate ind|img_id
coco loadImgs img_id image_info
image_info file_name
os path join coco_root|data_type|file_name image_path
os path isfile image_path
print  format ind|1|images_num|image_path
coco loadAnns anno_ids anno
coco imgs img_id image_height
coco imgs img_id image_width
image_files append image_path
np array [0|0|0|0|0|1] image_anno_dict image_path
np zeros [1|1|1]|dtype masks image_path
np array [1|1|1]|dtype masks_shape image_path
anno label
label bbox
classs_dict label class_name
annToMask label|image_height|image_width m
m max
np ones [image_height|image_width]|dtype m
instance_masks append m
bbox|bbox|bbox x2
bbox|bbox|bbox y2
annos append
print class_name
np array annos image_anno_dict image_path
np array instance_masks tobytes masks image_path
np array instance_masks shape|dtype masks_shape image_path
print file_name
np zeros [1|image_height|image_width]|dtype masks image_path
np array [1|image_height|image_width]|dtype masks_shape image_path
config mindrecord_dir mindrecord_dir
os path join mindrecord_dir|prefix mindrecord_path
FileWriter mindrecord_path|file_num writer
create_coco_label is_training masks_shape
writer add_schema maskrcnn_json|
len image_files image_files_num
enumerate ind|image_name
open image_name|
f read img
np array image_anno_dict[image_name]|dtype annos
masks image_name mask
masks_shape image_name mask_shape
{} row
print  format ind|1|image_files_num
writer write_raw_data [row]
writer commit
cv2 setNumThreads
de config set_prefetch_size
device_num|shard_id num_shards
C Decode decode
ds map operations ds
bboxes1 ndarray:shape  gt_mask_data
bboxes1 ndarray:shape  gt_iscrowd_new_revert
bboxes2 ndarray:shape  gt_mask_data
bboxes2 ndarray:shape  gt_iscrowd_new_revert
ious ndarray:shape  gt_mask_data
ious ndarray:shape  gt_iscrowd_new_revert
np zeros (rows|cols) ious T ious
bboxes2|bboxes1 bboxes2 bboxes2
bboxes2|bboxes1 bboxes2 area2
np zeros (cols|rows) ious T ious
(bboxes1|1) area1 i union
range i input_data
range i input_data
range i train_cls_dict cls
np maximum x_end-x_start|1|0|np maximum overlap ious
area1 i union ious
overlap|union ious T ious
(0 5|1 5) contrast_range self contrast_upper
(0 5|1 5) saturation_range self saturation_upper
delta img    |random permutation img
delta img shape c
delta img expand_img
delta img img_data
delta img transpose 2|0|1 copy img_data
mmcv bgr2hsv img img    |random permutation img
mmcv bgr2hsv img img shape c
mmcv bgr2hsv img img expand_img
mmcv bgr2hsv img img img_data
mmcv bgr2hsv img img transpose 2|0|1 copy img_data
mmcv hsv2bgr img img    |random permutation img
mmcv hsv2bgr img img shape c
mmcv hsv2bgr img img expand_img
mmcv hsv2bgr img img img_data
mmcv hsv2bgr img img transpose 2|0|1 copy img_data
img expand_img img
expand_img img img_data
expand_img img transpose 2|0|1 copy img_data
np tile (left|top) boxes gt_bboxes
np zeros (mask_count|int(mask_h|ratio)) expand_mask mask
mask expand_mask mask
expand_mask mask copy gt_mask
scale_factor|scale_factor2 scale_factor scale_factor
scale_factor|scale_factor2 scale_factor gt_bboxes
gt_bboxes|scale_factor gt_bboxes gt_bboxes
gt_bboxes|scale_factor gt_bboxes copy flipped
gt_bboxes|scale_factor gt_bboxes astype np float16 gt_bboxes
 gt_mask_data shape mask_w
 gt_mask_data pad_mask
gt_mask mask copy gt_mask
(config img_height|config img_width|1 0) img_shape astype np float16 img_shape
np asarray img_shape|dtype img_shape astype np float16 img_shape
np append img_shape|(scale_factor|scale_factor) img_shape astype np float16 img_shape
img img_data astype np float32 img_data
img img_data shape _
img img_data astype np float16 img_data
np append img_shape|(h_scale|w_scale) img_shape astype np float16 img_shape
mmcv impad img|(config img_height|config img_width) img_data astype np float32 img_data
mmcv impad img|(config img_height|config img_width) img_data shape _
mmcv impad img|(config img_height|config img_width) img_data astype np float16 img_data
mmcv imnormalize img|[123 675|116 28|103 53]|[58 395|57 12|57 375]|True img_data shape _
mmcv imnormalize img|[123 675|116 28|103 53]|[58 395|57 12|57 375]|True img_data astype np float16 img_data
mmcv imflip img_data img_data shape _
mmcv imflip img_data img_data astype np float16 img_data
img transpose 2|0|1 copy img_data astype np float16 img_data
PhotoMetricDistortion random_photo img|gt_bboxes|gt_label gt_label
random_photo img|gt_bboxes|gt_label gt_label input_data
random_photo img|gt_bboxes|gt_label gt_label input_data
Expand expand img|gt_bboxes|gt_label|gt_mask gt_mask
expand img|gt_bboxes|gt_label|gt_mask gt_mask input_data
expand img|gt_bboxes|gt_label|gt_mask gt_mask reshape n|h|w gt_mask
expand img|gt_bboxes|gt_label|gt_mask gt_mask input_data
 gt_iscrowd_new_revert input_data
image copy image_bgr shape image_shape
image copy image_bgr input_data
image_bgr shape image_shape input_data
box gt_box input_data
box gt_label input_data
box gt_iscrowd input_data
mask copy gt_mask reshape n|h|w gt_mask
mask copy gt_mask input_data
_infer_data image_bgr|image_shape|gt_box|gt_label|gt_iscrowd|gt_mask input_data
_infer_data i train_cls_dict cls
_infer_data label bbox
_data_aug i train_cls_dict cls
_data_aug m max
isinstance m max
maskHelper decode rle m max
maskHelper decode rle m num_shards
enumerate i train_cls_dict cls
COCO anno_json coco loadCats coco getCatIds cat_ids
COCO anno_json coco getImgIds image_ids
COCO anno_json coco loadImgs img_id image_info
COCO anno_json coco loadAnns anno_ids anno
COCO anno_json coco imgs img_id image_height
COCO anno_json coco imgs img_id image_width
coco loadCats coco getCatIds cat_ids cat
coco loadImgs img_id image_info file_name
print  format m max
coco loadAnns anno_ids anno label
anno label bbox
label bbox x2
label bbox y2
annToMask label|image_height|image_width m max
annToMask label|image_height|image_width m num_shards
np ones [image_height|image_width]|dtype m num_shards
instance_masks append m num_shards
FileWriter mindrecord_path|file_num writer add_schema maskrcnn_json|
FileWriter mindrecord_path|file_num writer write_raw_data [row]
FileWriter mindrecord_path|file_num writer commit
create_coco_label is_training masks_shape image_name mask_shape
C MultitypeFuncGraph clip_grad
clip_grad register
F dtype grad dt
nn ClipByNorm grad|F cast(F tuple_to_array (clip_value|)) new_grad
F cast new_grad|dt
super LossCallBack|self __init__
isinstance per_print_times|int
per_print_times self _per_print_times
rank_id self rank_id
time time time_stamp_first
run_context original_args cb_params
cb_params net_outputs asnumpy rpn_loss
cb_params net_outputs asnumpy rcnn_loss
cb_params net_outputs asnumpy rpn_cls_loss
cb_params net_outputs asnumpy rpn_reg_loss
cb_params net_outputs asnumpy rcnn_cls_loss
cb_params net_outputs asnumpy rcnn_reg_loss
cb_params net_outputs asnumpy rcnn_mask_loss
float rpn_loss self rpn_loss_sum
float rcnn_loss self rcnn_loss_sum
float rpn_cls_loss self rpn_cls_loss_sum
float rpn_reg_loss self rpn_reg_loss_sum
float rcnn_cls_loss self rcnn_cls_loss_sum
float rcnn_reg_loss self rcnn_reg_loss_sum
float rcnn_mask_loss self rcnn_mask_loss_sum
(cb_params cur_step_num-1)%cb_params batch_num|1 cur_step_in_epoch
time time time_stamp_current
self rpn_loss_sum|self count rpn_loss
self rcnn_loss_sum|self count rcnn_loss
self rpn_cls_loss_sum|self count rpn_cls_loss
self rpn_reg_loss_sum|self count rpn_reg_loss
self rcnn_cls_loss_sum|self count rcnn_cls_loss
self rcnn_reg_loss_sum|self count rcnn_reg_loss
self rcnn_mask_loss_sum|self count rcnn_mask_loss
rpn_loss|rcnn_loss total_loss
open loss_file
loss_file write
loss_file close
backbone self _backbone
loss_fn self _loss_fn
self _loss_fn loss1|loss2|loss3|loss4|loss5|loss6|loss7
network self network
self network set_grad
network_backbone self backbone
ParameterTuple network trainable_params self weights
optimizer self optimizer
Tensor (np ones (1|)|sens) astype(np float16) self sens
reduce_flag self reduce_flag
C HyperMap self hyper_map
DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
self weights weights
self grad self network|weights(x|img_shape|gt_bboxe|gt_label|gt_num|gt_mask|self sens) grads
self grad_reducer grads grads
self hyper_map F partial clip_grad|GRADIENT_CLIP_TYPE|GRADIENT_CLIP_VALUE grads
F depend loss1|self optimizer grads
C MultitypeFuncGraph clip_grad register
isinstance per_print_times self _per_print_times
run_context original_args cb_params net_outputs asnumpy rpn_loss
run_context original_args cb_params net_outputs asnumpy rcnn_loss
run_context original_args cb_params net_outputs asnumpy rpn_cls_loss
run_context original_args cb_params net_outputs asnumpy rpn_reg_loss
run_context original_args cb_params net_outputs asnumpy rcnn_cls_loss
run_context original_args cb_params net_outputs asnumpy rcnn_reg_loss
run_context original_args cb_params net_outputs asnumpy rcnn_mask_loss
cb_params net_outputs asnumpy rpn_loss total_loss
cb_params net_outputs asnumpy rcnn_loss total_loss
self rpn_loss_sum|self count rpn_loss total_loss
self rcnn_loss_sum|self count rcnn_loss total_loss
open loss_file write
open loss_file close
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
F depend loss1|self optimizer grads
cfg drop drop_rate
cfg drop_connect drop_connect_rate
cfg gp global_pool
cfg bn_tf bn_tf
load_checkpoint args ckpt_file ckpt
load_param_into_net net|ckpt
net set_train False
Tensor np ones [cfg batch_size|3|args height|args width]|np float32 image
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
load_param_into_net net set_train False
mindspore common set_seed cfg random_seed
random seed cfg random_seed
np random seed cfg random_seed
steps_per_epoch|total_epochs total_steps
steps_per_epoch|global_epoch global_steps
range i
math floor i|steps_per_epoch steps
warmup_lr_init|steps|self_warmup_delta warmup_lr
math floor steps|decay_steps decay_nums
math pow self_decay_rate|decay_nums decay_rate
base_lr|decay_rate decay_lr
cond|warmup_lr|(1-cond)|decay_lr lr
lr_each_step append lr
np array lr_each_step astype np float32 lr_each_step
os path join path||paths outdir
os path exists outdir
os makedirs outdir
outdir||str(count) outdir_inc
os path exists outdir_inc
count|1 count
outdir_inc outdir
argparse ArgumentParser parser
parser parse_known_args _
context set_context context GRAPH_MODE mode
context reset_auto_parallel_context
get_rank rank_id
get_group_size rank_size
cfg drop drop_rate
cfg drop_connect drop_connect_rate
cfg gp global_pool
cfg bn_tf bn_tf
args data_path train_data_url
create_dataset train_dataset
train_dataset get_dataset_size batches_per_epoch
LossMonitor per_print_times loss_cb
LabelSmoothingCrossEntropy smooth_factor loss
TimeMonitor data_size time_cb
FixedLossScaleManager loss_scale_manager
[time_cb|loss_cb] callbacks
CheckpointConfig config_ck
ModelCheckpoint ckpoint_cb
[ckpoint_cb] callbacks
cfg decay_epochs|decay_rate decay_steps
cfg warmup_epochs|warmup_lr_init warmup_steps
cfg weight_decay weight_decay
cfg loss_scale loss_scale
cfg momentum|epsilon momentum
load_checkpoint args resume ckpt
load_param_into_net net|ckpt
cfg amp_level amp_level
cfg epochs-cfg resume_start_epoch real_epoch
math floor i|steps_per_epoch steps warmup_lr
warmup_lr_init|steps|self_warmup_delta warmup_lr lr
math pow self_decay_rate|decay_nums decay_rate decay_lr
base_lr|decay_rate decay_lr lr
cond|warmup_lr|(1-cond)|decay_lr lr lr
os path join path||paths outdir outdir_inc
os path exists outdir outdir_inc
os makedirs outdir outdir_inc
outdir||str(count) outdir_inc outdir
os path exists outdir_inc outdir
count|1 count count
argparse ArgumentParser parser parse_known_args _
create_dataset train_dataset get_dataset_size batches_per_epoch
LossMonitor per_print_times loss_cb callbacks
LabelSmoothingCrossEntropy smooth_factor loss callbacks
TimeMonitor data_size time_cb callbacks
parser parse_args args_opt
load_param_into_net net|ckpt
context GRAPH_MODE mode|args_opt platform device_target context set_context
cfg drop drop_rate
cfg drop_connect drop_connect_rate
cfg gp global_pool
cfg bn_tf bn_tf
load_checkpoint args_opt checkpoint ckpt
net set_train False
args_opt data_path val_data_url
LabelSmoothingCrossEntropy smooth_factor loss
nn Top1CategoricalAccuracy
model eval dataset metrics
print metrics
parser parse_args args_opt data_path val_data_url
load_param_into_net net set_train False
 efficientnet_b0_config_gpu
(128|128|128) _FILL
(Image BILINEAR|Image BICUBIC) _RANDOM_INTERPOLATION
kwargs pop Image BILINEAR interpolation
isinstance interpolation|(list|tuple)
random choice interpolation
kwargs pop
_interpolation kwargs kwargs
_check_args_tf kwargs
img transform img size|Image AFFINE|(1|factor|0|0|1|0)|kwargs
img transform img size|Image AFFINE|(1|0|0|factor|1|0)|kwargs
pct|img size pixels
img transform img size|Image AFFINE|(1|0|pixels|0|1|0)|kwargs
img transform img size|Image AFFINE|(1|0|0|0|1|pixels)|kwargs
kwargs kwargs_new
kwargs_new pop
Image BICUBIC kwargs_new
img rotate degrees|kwargs_new
img size h
(0|0) post_trans
(w|2 0|h|2 0) rotn_center
-math radians degrees angle
round math cos angle|15
round math sin angle|15
round -math sin angle|15
transform matrix
rotn_center matrix
img transform img size|Image AFFINE|matrix|kwargs_new
kwargs resample
ImageOps autocontrast img
ImageOps invert img
ImageOps equalize img
ImageOps solarize img|thresh
range i
lut append min 255|i|add
lut append i
lut|lut|lut lut
img point lut
ImageOps posterize img|bits_to_keep
ImageEnhance Contrast img enhance factor
ImageEnhance Color img enhance factor
ImageEnhance Brightness img enhance factor
ImageEnhance Sharpness img enhance factor
(level|_MAX_LEVEL)|30  level
_randomly_negate level level
((level|_MAX_LEVEL)|1 8|0 1|)
(level|_MAX_LEVEL)|0 3 level
hparams translate_const
(level|_MAX_LEVEL)|float(translate_const) level
(level|_MAX_LEVEL)|0 45 level
 int (level|_MAX_LEVEL)|4|4|
 int (level|_MAX_LEVEL)|4|
 int (level|_MAX_LEVEL)|256|
 int (level|_MAX_LEVEL)|110|
 int (level|_MAX_LEVEL)|10|10|
((level|_MAX_LEVEL)|0 4|)
(level|_MAX_LEVEL)|0 5 level
int 0 1|v horizontal_tiles
int 0 1|v vertical_tiles
int math floor w|float(horizontal_tiles) width_of_square
int math floor h|float(vertical_tiles) height_of_square
w-(width_of_square|(horizontal_tiles-1)) width_of_last_square
h-(height_of_square|(vertical_tiles-1)) height_of_last_square
range vertical_tile
range horizontal_tile
last_column append (horizontal_tiles-1)|horizontal_tiles|i
range (horizontal_tiles|vertical_tiles)-horizontal_tiles|horizontal_tiles|vertical_tiles last_row
dimensions x1|y1|x2|y2
polygons append [x1|y1|x1|y2|x2|y2|x2|y1]
range  vertical_tiles i
polygon_indices append
polygon_indices a|b|c|d
v dx
v dy
polygons a y4
polygons b y4
polygons c y4
polygons d y4
enumerate idx|i
generated_mesh append [dimensions[idx]|polygons[idx]]
PIL Image BICUBIC resample
image_zoomed size h_zoomed
math floor  float h_zoomed|2- float h|2
math floor  float w_zoomed|2| float w|2
int w|v w_occlusion
int h|v h_occlusion
PIL Image fromarray np uint8 np random rand w_occlusion|h_occlusion|255 rectangle
PIL Image fromarray np uint8 np random rand w_occlusion|h_occlusion|len(img getbands)|255 rectangle
random randint 0|w-w_occlusion random_position_x
random randint 0|h-h_occlusion random_position_y
img paste rectangle|(random_position_x|random_position_y)
h x2
w y2
[ y1|x1] original_plane
max w|h max_skew_amount
int math ceil max_skew_amount|v max_skew_amount
max_skew_amount skew_amount
zip p1|p2
matrix append [p1|p1|1|0|0|0|-p2|p1|-p2|p1]
matrix append [0|0|0|p1|p1|1|-p2|p1|-p2|p1]
np matrix matrix|dtype A
np array original_plane reshape B
np dot np linalg pinv A perspective_skew_coefficients_matrix
np array perspective_skew_coefficients_matrix reshape perspective_skew_coefficients_matrix
img filter PIL ImageFilter GaussianBlur v
_RAND_CHOICE_WEIGHTS_0 rand_weights
_MAX_LEVEL magnitude
config_str split config
config c
re split c cs
len cs
cs val
hparams setdefault float val
int val magnitude
int val num_layers
int val weight_idx
rand_augment_ops magnitude ra_ops
RandAugment ra_ops|num_layers|choice_weights final_result
NAME_TO_OP name self aug_fn
LEVEL_TO_ARG name self level_fn
prob self prob
magnitude self magnitude
hparams copy self hparams
dict self kwargs
self hparams get self magnitude_std
self magnitude magnitude
random gauss magnitude|self magnitude_std magnitude
self level_fn magnitude|self hparamsifself level_fnisnotNoneelsetuple level_args
self aug_fn img||level_args|self kwargs
ops self ops
num_layers self num_layers
choice_weights self choice_weights
np random choice ops
ops op
op img img
isinstance  int (level|_MAX_LEVEL)|4|4|
isinstance  int (level|_MAX_LEVEL)|4|
isinstance  int (level|_MAX_LEVEL)|256|
isinstance  int (level|_MAX_LEVEL)|110|
isinstance  int (level|_MAX_LEVEL)|10|10|
_interpolation kwargs kwargs kwargs_new
_interpolation kwargs kwargs resample
_check_args_tf kwargs kwargs_new
_check_args_tf kwargs resample
img transform img size|Image kwargs kwargs_new
img transform img size|Image kwargs resample
img transform img size|Image  int (level|_MAX_LEVEL)|4|4|
img transform img size|Image  int (level|_MAX_LEVEL)|4|
img transform img size|Image  int (level|_MAX_LEVEL)|256|
img transform img size|Image  int (level|_MAX_LEVEL)|110|
img transform img size|Image  int (level|_MAX_LEVEL)|10|10|
img transform img size|Image kwargs kwargs_new
img transform img size|Image kwargs resample
img transform img size|Image  int (level|_MAX_LEVEL)|4|4|
img transform img size|Image  int (level|_MAX_LEVEL)|4|
img transform img size|Image  int (level|_MAX_LEVEL)|256|
img transform img size|Image  int (level|_MAX_LEVEL)|110|
img transform img size|Image  int (level|_MAX_LEVEL)|10|10|
img transform img size|Image kwargs kwargs_new
img transform img size|Image kwargs resample
img transform img size|Image  int (level|_MAX_LEVEL)|4|4|
img transform img size|Image  int (level|_MAX_LEVEL)|4|
img transform img size|Image  int (level|_MAX_LEVEL)|256|
img transform img size|Image  int (level|_MAX_LEVEL)|110|
img transform img size|Image  int (level|_MAX_LEVEL)|10|10|
img transform img size|Image kwargs kwargs_new
img transform img size|Image kwargs resample
img transform img size|Image  int (level|_MAX_LEVEL)|4|4|
img transform img size|Image  int (level|_MAX_LEVEL)|4|
img transform img size|Image  int (level|_MAX_LEVEL)|256|
img transform img size|Image  int (level|_MAX_LEVEL)|110|
img transform img size|Image  int (level|_MAX_LEVEL)|10|10|
kwargs kwargs_new pop
img rotate kwargs resample
img rotate  int (level|_MAX_LEVEL)|4|4|
img rotate  int (level|_MAX_LEVEL)|4|
img rotate  int (level|_MAX_LEVEL)|256|
img rotate  int (level|_MAX_LEVEL)|110|
img rotate  int (level|_MAX_LEVEL)|10|10|
img size h x2
(w|2 0|h|2 0) rotn_center matrix
round math cos  int (level|_MAX_LEVEL)|4|4|
round math cos  int (level|_MAX_LEVEL)|4|
round math cos  int (level|_MAX_LEVEL)|256|
round math cos  int (level|_MAX_LEVEL)|110|
round math cos  int (level|_MAX_LEVEL)|10|10|
round math sin  int (level|_MAX_LEVEL)|4|4|
round math sin  int (level|_MAX_LEVEL)|4|
round math sin  int (level|_MAX_LEVEL)|256|
round math sin  int (level|_MAX_LEVEL)|110|
round math sin  int (level|_MAX_LEVEL)|10|10|
round -math sin  int (level|_MAX_LEVEL)|4|4|
round -math sin  int (level|_MAX_LEVEL)|4|
round -math sin  int (level|_MAX_LEVEL)|256|
round -math sin  int (level|_MAX_LEVEL)|110|
round -math sin  int (level|_MAX_LEVEL)|10|10|
transform matrix append [p1|p1|1|0|0|0|-p2|p1|-p2|p1]
transform matrix append [0|0|0|p1|p1|1|-p2|p1|-p2|p1]
rotn_center matrix append [p1|p1|1|0|0|0|-p2|p1|-p2|p1]
rotn_center matrix append [0|0|0|p1|p1|1|-p2|p1|-p2|p1]
img transform img size|Image kwargs resample
img transform img size|Image  int (level|_MAX_LEVEL)|4|4|
img transform img size|Image  int (level|_MAX_LEVEL)|4|
img transform img size|Image  int (level|_MAX_LEVEL)|256|
img transform img size|Image  int (level|_MAX_LEVEL)|110|
img transform img size|Image  int (level|_MAX_LEVEL)|10|10|
img transform img size|Image matrix append [p1|p1|1|0|0|0|-p2|p1|-p2|p1]
img transform img size|Image matrix append [0|0|0|p1|p1|1|-p2|p1|-p2|p1]
ImageOps autocontrast img point lut
ImageOps autocontrast img paste rectangle|(random_position_x|random_position_y)
ImageOps autocontrast img filter PIL ImageFilter GaussianBlur v
ImageOps invert img point lut
ImageOps invert img paste rectangle|(random_position_x|random_position_y)
ImageOps invert img filter PIL ImageFilter GaussianBlur v
ImageOps equalize img point lut
ImageOps equalize img paste rectangle|(random_position_x|random_position_y)
ImageOps equalize img filter PIL ImageFilter GaussianBlur v
ImageOps solarize img point lut
ImageOps solarize  int (level|_MAX_LEVEL)|4|4|
ImageOps solarize  int (level|_MAX_LEVEL)|4|
ImageOps solarize  int (level|_MAX_LEVEL)|256|
ImageOps solarize  int (level|_MAX_LEVEL)|110|
ImageOps solarize  int (level|_MAX_LEVEL)|10|10|
ImageOps solarize img paste rectangle|(random_position_x|random_position_y)
ImageOps solarize img filter PIL ImageFilter GaussianBlur v
lut append min  int (level|_MAX_LEVEL)|4|4|
lut append min  int (level|_MAX_LEVEL)|4|
lut append min  int (level|_MAX_LEVEL)|256|
lut append min  int (level|_MAX_LEVEL)|110|
lut append min  int (level|_MAX_LEVEL)|10|10|
lut|lut|lut lut lut
ImageOps posterize  int (level|_MAX_LEVEL)|4|4|
ImageOps posterize  int (level|_MAX_LEVEL)|4|
ImageOps posterize  int (level|_MAX_LEVEL)|256|
ImageOps posterize  int (level|_MAX_LEVEL)|110|
ImageOps posterize  int (level|_MAX_LEVEL)|10|10|
ImageOps posterize img paste rectangle|(random_position_x|random_position_y)
ImageOps posterize img filter PIL ImageFilter GaussianBlur v
(level|_MAX_LEVEL)|30  level  level
(level|_MAX_LEVEL)|30  level 8|0 1|)
(level|_MAX_LEVEL)|30  level 3 level
(level|_MAX_LEVEL)|30  level level
(level|_MAX_LEVEL)|30  level 45 level
(level|_MAX_LEVEL)|30  level 4|)
(level|_MAX_LEVEL)|30  level 5 level
_randomly_negate level level 8|0 1|)
_randomly_negate level level 3 level
_randomly_negate level level level
_randomly_negate level level 45 level
_randomly_negate level level 4|)
_randomly_negate level level 5 level
((level|_MAX_LEVEL)|1 8|0  int (level|_MAX_LEVEL)|4|4|
((level|_MAX_LEVEL)|1 8|0  int (level|_MAX_LEVEL)|4|
((level|_MAX_LEVEL)|1 8|0  int (level|_MAX_LEVEL)|256|
((level|_MAX_LEVEL)|1 8|0  int (level|_MAX_LEVEL)|110|
((level|_MAX_LEVEL)|1 8|0  int (level|_MAX_LEVEL)|10|10|
(level|_MAX_LEVEL)|0 3 level 3 level
(level|_MAX_LEVEL)|0 3 level level
(level|_MAX_LEVEL)|0 3 level 45 level
(level|_MAX_LEVEL)|0 3 level 4|)
(level|_MAX_LEVEL)|0 3 level 5 level
(level|_MAX_LEVEL)|float(translate_const) level level
(level|_MAX_LEVEL)|float(translate_const) level 45 level
(level|_MAX_LEVEL)|float(translate_const) level 4|)
(level|_MAX_LEVEL)|float(translate_const) level 5 level
(level|_MAX_LEVEL)|0 45 level 45 level
(level|_MAX_LEVEL)|0 45 level 4|)
(level|_MAX_LEVEL)|0 45 level 5 level
 int  int (level|_MAX_LEVEL)|4|4|
 int  int (level|_MAX_LEVEL)|4|
 int  int (level|_MAX_LEVEL)|256|
 int  int (level|_MAX_LEVEL)|110|
 int  int (level|_MAX_LEVEL)|10|10|
 int _MAX_LEVEL magnitude
 int  int (level|_MAX_LEVEL)|4|
 int  int (level|_MAX_LEVEL)|256|
 int  int (level|_MAX_LEVEL)|110|
 int  int (level|_MAX_LEVEL)|10|10|
 int _MAX_LEVEL magnitude
 int  int (level|_MAX_LEVEL)|256|
 int  int (level|_MAX_LEVEL)|110|
 int  int (level|_MAX_LEVEL)|10|10|
 int _MAX_LEVEL magnitude
 int  int (level|_MAX_LEVEL)|110|
 int  int (level|_MAX_LEVEL)|10|10|
 int _MAX_LEVEL magnitude
 int  int (level|_MAX_LEVEL)|10|10|
 int _MAX_LEVEL magnitude
(level|_MAX_LEVEL)|0 5 level 5 level
int math floor w|float(horizontal_tiles) width_of_square width_of_last_square
int math floor h|float(vertical_tiles) height_of_square height_of_last_square
last_column append h x2
math floor  float h_zoomed|2- float h x2
math floor  float w_zoomed|2| float w y2
img paste random gauss magnitude|self magnitude_std magnitude
max w|h max_skew_amount skew_amount
int math ceil max_skew_amount|v max_skew_amount skew_amount
_MAX_LEVEL magnitude self magnitude
config_str split config c
config c final_result
re split c cs val
len cs val
int val magnitude self magnitude
int val num_layers final_result
int val num_layers self num_layers
rand_augment_ops magnitude ra_ops final_result
np random choice ops op
ops op img img
P ReLU relu
P Sigmoid sigmoid
(0 485|0 456|0 406) IMAGENET_DEFAULT_MEAN
(0 229|0 224|0 225) IMAGENET_DEFAULT_STD
(0 5|0 5|0 5) IMAGENET_INCEPTION_MEAN
(0 5|0 5|0 5) IMAGENET_INCEPTION_STD
(124|255|117|255|104|255) IMAGENET_DPN_MEAN
tuple [1|( 0167|255)]|3 IMAGENET_DPN_STD
dict momentum _BN_ARGS_PT
dict momentum _BN_ARGS_TF
self aug_fn img||level_args|self kwargs
isinstance shape|(tuple|list)
shape|shape|shape n
Normal math sqrt 2 0|n
shape n
Uniform init_range
_initialize_weight_goog shape weight_init_value
padding|pad_mode padding
kwargs pop None bn_momentum
bn_momentum bn_args
kwargs pop None bn_eps
bn_eps bn_args
max new_channels
int channels|divisor|2
divisor new_channels
ss isdigit
int ss
ss split k
isinstance block_str|str
block_str split ops
ops block_type
ops op
op startswith
op key
op v
value options key
re split op splits
splits value
int options num_repeat
dict block_args
_parse_ksize options dw_kernel_size
int options out_chs
float options exp_ratio
int options stride
_parse_ksize options exp_kernel_size
int options kernel_size
eachstage  othermodelsthatmayhavemultipleblockargdefinitions
sum repeats num_repeat
max 1|round(num_repeat|depth_multiplier) num_repeat_scaled
int math ceil num_repeat|depth_multiplier num_repeat_scaled
repeats r
max 1|round((r|num_repeat|num_repeat_scaled)) rs
repeats_scaled append rs
zip ba|rep
range] _
enumerate _|block_strings
isinstance block_strings|list
block_strings block_str
_decode_block_str block_str rep
stack_args append ba
repeats append rep
arch_args append _scale_stage_depth stack_args|repeats|depth_multiplier|depth_trunc
P Cast x|ms float32 x
x|3 0 y
clip_by_value y|0 0|6 0 y
y|6 0 y
super BlockBuilder|self __init__
channel_multiplier self channel_multiplier
channel_divisor self channel_divisor
channel_min self channel_min
pad_type self pad_type
act_fn self act_fn
se_gate_fn self se_gate_fn
se_reduce_mid self se_reduce_mid
bn_args self bn_args
drop_connect_rate self drop_connect_rate
verbose self verbose
self _make_layer builder_in_channels|builder_block_args self layer
_round_channels chs|self channel_multiplier|self channel_divisor|self channel_min
ba pop bt
self in_chs ba
self bn_args ba
self pad_type ba
self drop_connect_rate|self block_idx|self block_count ba
self se_gate_fn ba
self se_reduce_mid ba
logging info self block_idx|str ba
InvertedResidual ba block
DepthwiseSeparableConv ba block
ba self in_chs
enumerate i|ba
logging info i
self _make_block ba block
blocks append block
nn SequentialCell blocks
configuration s
logging info len block_args
in_chs self in_chs
enumerate stack_idx|stack
logging info stack_idx
isinstance stack|list
self _make_stack stack stack
blocks append stack
self layer x
super DepthWiseConv|self __init__
context get_context platform
[1|kernel_size|in_planes] weight_shape
_initialize_weight_goog shape weight_init
Parameter initializer self weight
P DepthwiseConv2dNative self depthwise_conv
self depthwise_conv x|self weight x
super DropConnect|self __init__
P Shape self shape
P DType self dtype
P Dropout keep_prob self dropout
self shape x shape
self dtype x dtype
P Fill dtype|(shape|1|1|1) ones_tensor
self dropout ones_tensor mask_
x|mask_ x
DropConnect drop_connect_rate inputs
super SqueezeExcite|self __init__
gate_fn self gate_fn
self avg_global_pool x|(2|3) x_se
self conv_reduce x_se x_se
self act_fn x_se x_se
self conv_expand x_se x_se
self gate_fn x_se x_se
P ExpandDims x_se|2 x_se
P ExpandDims x_se|3 x_se
x|x_se x
super DepthwiseSeparableConv|self __init__
pw_act self has_pw_act
DepthWiseConv in_chs|dw_kernel_size|stride self conv_dw
_fused_bn in_chs|bn_args self bn1
_conv1x1 in_chs|out_chs self conv_pw
_fused_bn out_chs|bn_args self bn2
x identity
self conv_dw x x
self bn1 x x
self act_fn x x
self se x x
self conv_pw x x
self bn2 x x
drop_connect x|self training|self drop_connect_rate x
x|identity x
super InvertedResidual|self __init__
int in_chs|exp_ratio mid_chs
_conv in_chs|mid_chs|exp_kernel_size self conv_pw
_fused_bn mid_chs|bn_args self bn1
shuffle_type self shuffle_type
isinstance exp_kernel_size|list
DepthWiseConv mid_chs|dw_kernel_size|stride self conv_dw
_fused_bn mid_chs|bn_args self bn2
_conv mid_chs|out_chs|pw_kernel_size self conv_pwl
_fused_bn out_chs|bn_args self bn3
self conv_pwl x x
self bn3 x x
super GenEfficientNet|self __init__
num_classes self num_classes
drop_rate self drop_rate
num_features self num_features
_round_channels stem_size|channel_multiplier|channel_divisor|channel_min stem_size
_fused_bn stem_size|bn_args self bn1
stem_size in_chans
self blocks in_chs in_chs
_conv1x1 in_chs|self num_features self conv_head
_dense self num_features|self num_classes self classifier
P Reshape self reshape
self conv_stem x x
self blocks x x
self global_pool x|(2|3) x
self conv_head x x
self reshape self shape x x
self reshape x|(self shape x) x
self drop_out x x
self classifier x
_round_channels 1280|channel_multiplier|8|None num_features
GenEfficientNet model
_decode_arch_def arch_def|depth_multiplier
_resolve_bn_args kwargs bn_args
hard_swish act_fn
default_cfgs default_cfg
_gen_efficientnet model
default_cfg model default_cfg
self aug_fn img||level_args|self kwargs pop None bn_momentum
self aug_fn img||level_args|self kwargs pop None bn_eps
isinstance shape n
padding|pad_mode padding padding
kwargs pop None bn_momentum bn_args
bn_momentum bn_args self bn_args
kwargs pop None bn_eps bn_args
bn_eps bn_args self bn_args
int divisor new_channels
int ss split k
ss split k weight_shape
isinstance block_str split ops
block_str split ops block_type
block_str split ops op
ops op startswith
ops op key
ops op v
re split op splits value
int options kernel_size weight_shape
zip ba pop bt
zip ba self in_chs
enumerate block_strings block_str
isinstance block_strings block_str
stack_args append ba pop bt
stack_args append ba self in_chs
P Cast x|ms float32 x 0 y
P Cast x|ms float32 x x
P Cast x|ms float32 x x
P Cast x|ms float32 x identity
P Cast x|ms float32 x x
x|3 0 y 0 y
clip_by_value y|0 0|6 0 y 0 y
y|6 0 y 0 y
self in_chs ba self in_chs
self bn_args ba self in_chs
self pad_type ba self in_chs
self drop_connect_rate|self block_idx|self block_count ba self in_chs
self se_gate_fn ba self in_chs
self se_reduce_mid ba self in_chs
logging info self block_idx|str ba self in_chs
ba self in_chs self in_chs
logging info i weight_shape
logging info i x
nn SequentialCell blocks append stack
enumerate x identity
self layer x x
self layer x x
self layer x identity
self layer x x
self depthwise_conv x|self weight x x
self depthwise_conv x|self weight x x
self depthwise_conv x|self weight x identity
self depthwise_conv x|self weight x x
self dropout ones_tensor mask_ x
x|mask_ x x
x|mask_ x x
x|mask_ x identity
x|mask_ x x
self avg_global_pool x|(2|3) x_se x
self conv_reduce x_se x_se x
self act_fn x_se x_se x
self conv_expand x_se x_se x
self gate_fn x_se x_se x
P ExpandDims x_se|2 x_se x
P ExpandDims x_se|3 x_se x
x|x_se x x
x|x_se x identity
x|x_se x x
x identity x
self conv_dw x x x
self bn1 x x x
self act_fn x x x
self se x x x
self conv_pw x x x
self bn2 x x x
drop_connect x|self training|self drop_connect_rate x x
x|identity x x
_round_channels stem_size|channel_multiplier|channel_divisor|channel_min stem_size in_chans
default_cfgs default_cfg model default_cfg
ds config set_seed cfg random_seed
(0 485|0 456|0 406) IMAGENET_DEFAULT_MEAN
(0 229|0 224|0 225) IMAGENET_DEFAULT_STD
(224|224) img_size
(0 08|1 0) scale
(3 |4 |4 |3 ) ratio
os path exists train_data_url
str2MsInter inter_str interpolation
C Decode c_decode_op
C2 TypeCast mstype int32 type_cast_op
C RandomHorizontalFlip random_horizontal_flip_op
RandAugment efficient_rand_augment
[c_decode_op|random_resize_crop_op|random_horizontal_flip_op] image_ops
workers num_parallel_workers
rank_size num_shards
image_ops operations
type_cast_op operations
efficient_rand_augment per_batch_map
os path exists val_data_url
str2MsInter inter_method interpolation
isinstance img_size|tuple
int math floor img_size|crop_pct scale_size
tuple [int x|crop_pctforxinimg_size] scale_size
C Decode decode_op
C Resize size resize_op
C Rescale rescale|shift rescale_op
C Normalize IMAGENET_DEFAULT_MEAN|IMAGENET_DEFAULT_STD normalize_op
C HWC2CHW changeswap_op
[decode_op|resize_op|center_crop|rescale_op|normalize_op|changeswap_op] ctrans
dataset map input_columns dataset
C Decode c_decode_op image_ops
C2 TypeCast mstype int32 type_cast_op operations
C RandomHorizontalFlip random_horizontal_flip_op image_ops
RandAugment efficient_rand_augment per_batch_map
[c_decode_op|random_resize_crop_op|random_horizontal_flip_op] image_ops operations
isinstance tuple [int x|crop_pctforxinimg_size] scale_size
C Decode decode_op ctrans
C Resize size resize_op ctrans
C Rescale rescale|shift rescale_op ctrans
C Normalize IMAGENET_DEFAULT_MEAN|IMAGENET_DEFAULT_STD normalize_op ctrans
C HWC2CHW changeswap_op ctrans
super LabelSmoothingCrossEntropy|self __init__
P OneHot self onehot
Tensor 1 0-smooth_factor|mstype float32 self on_value
Tensor 1 0|smooth_factor|(num_classes-1) self off_value
nn SoftmaxCrossEntropyWithLogits self ce
P ReduceMean False self mean
self onehot label|F shape logits one_hot_label
self ce logits|one_hot_label loss_logit
self mean loss_logit|0 loss_logit
(0 485|0 456|0 406) IMAGENET_DEFAULT_MEAN
(0 229|0 224|0 225) IMAGENET_DEFAULT_STD
config_str self config_str
hparams self hparams
P ToPIL py_to_pil_op
P ToTensor to_tensor
P Normalize IMAGENET_DEFAULT_MEAN|IMAGENET_DEFAULT_STD normalize_op
transform_utils rand_augment_transform self config_str|self hparams rand_augment_ops
enumerate i|image
py_to_pil_op image img_pil
rand_augment_ops img_pil img_pil
to_tensor img_pil img_array
normalize_op img_array img_array
ret_imgs append img_array
ret_labels append labels i
np array ret_imgs|np array ret_labels
P ToPIL py_to_pil_op image img_pil
P ToTensor to_tensor img_pil img_array
P Normalize IMAGENET_DEFAULT_MEAN|IMAGENET_DEFAULT_STD normalize_op img_array img_array
transform_utils rand_augment_transform self config_str|self hparams rand_augment_ops img_pil img_pil
parser parse_args args
context GRAPH_MODE mode|args device_target device_target context set_context
LeNet5Fusion cfg num_classes network
[True|False] per_channel
quantizer quantize network network
load_checkpoint args ckpt_path param_dict
load_param_into_net network|param_dict
Tensor np ones [1|1|cfg image_height|cfg image_width] inputs
files  ckpt
parser parse_args args
context GRAPH_MODE mode|args device_target device_target context set_context
create_dataset os path join args data_path| ds_train
ds_train get_dataset_size step_size
LeNet5Fusion cfg num_classes network
load_checkpoint args ckpt_path param_dict
load_nonquant_param_into_quant_net network|param_dict
[True|False] per_channel
quantizer quantize network network
nn Momentum network trainable_params|cfg lr|cfg momentum net_opt
Model network|net_loss|net_opt|metrics model
create_dataset os path join args data_path| ds_train get_dataset_size step_size
LeNet5Fusion cfg num_classes network model
quantizer quantize network network model
nn Momentum network trainable_params|cfg lr|cfg momentum net_opt model
parser parse_args args
context GRAPH_MODE mode|args device_target device_target context set_context
create_dataset os path join args data_path| ds_eval
LeNet5Fusion cfg num_classes network
[True|False] per_channel
quantizer quantize network network
nn Momentum network trainable_params|cfg lr|cfg momentum net_opt
Model network|net_loss|net_opt|metrics model
load_checkpoint args ckpt_path param_dict
load_param_into_net network|param_dict not_load_param
load_nonquant_param_into_quant_net network|param_dict
LeNet5Fusion cfg num_classes network model
quantizer quantize network network model
nn Momentum network trainable_params|cfg lr|cfg momentum net_opt model
 mnist_cfg
super LeNet5|self __init__
num_class self num_class
nn Flatten self flatten
self conv1 x x
self relu x x
self max_pool2d x x
self conv2 x x
self flatten x x
self fc1 x x
self fc2 x x
self fc3 x x
Tensor |100 asnumpy lr_init
super LossMonitor|self __init__
isinstance per_print_times|int
per_print_times self _per_print_times
lr_init self lr_init
time time self epoch_time
run_context original_args cb_params
(time time-self epoch_time)|1000 epoch_mseconds
epoch_mseconds|cb_params batch_num per_step_mseconds
print |60
time time self step_time
(time time-self step_time)|1000 step_mseconds
cb_params net_outputs step_loss
isinstance step_loss| tuple|listandisinstance step_loss|Tensor
isinstance step_loss|Tensor
np mean step_loss asnumpy step_loss
self losses append step_loss
int (cb_params cur_step_num-1)%cb_params batch_num|1 cur_step_in_epoch
isinstance step_loss|floatand np isnan step_lossornp isinf step_loss
int cb_params batch_num
np mean self losses
Tensor |100 asnumpy lr_init self lr_init
isinstance per_print_times self _per_print_times
isinstance int (cb_params cur_step_num-1)%cb_params batch_num|1 cur_step_in_epoch
isinstance int cb_params batch_num
run_context original_args cb_params batch_num per_step_mseconds
run_context original_args cb_params net_outputs step_loss
(time time-self epoch_time)|1000 epoch_mseconds batch_num per_step_mseconds
super LeNet5|self __init__
num_class self num_class
nn DenseBnAct 84|self num_class self fc3
nn Flatten self flatten
self conv1 x x
self max_pool2d x x
self conv2 x x
self flatten x x
self fc1 x x
self fc2 x x
self fc3 x x
ds MnistDataset data_path mnist_ds
-1|0 1307|0 3081 shift_nml
CV Resize (resize_height|resize_width) resize_op
CV Rescale rescale_nml|shift_nml rescale_nml_op
CV Rescale rescale|shift rescale_op
CV HWC2CHW hwc2chw_op
C TypeCast mstype int32 type_cast_op
mnist_ds shuffle buffer_size mnist_ds
mnist_ds repeat repeat_size mnist_ds
ds MnistDataset data_path mnist_ds shuffle buffer_size mnist_ds
ds MnistDataset data_path mnist_ds repeat repeat_size mnist_ds
parser parse_args args_opt
config_quant args_opt device_target cfg
mobilenetV2 num_classes network
[True|False] per_channel
quantizer quantize network network
load_checkpoint args_opt checkpoint_path param_dict
load_param_into_net network|param_dict
Tensor np ones [1|3|cfg image_height|cfg image_width] inputs
load_param_into_net network|param_dict
parser parse_args args_opt
int os getenv device_id
int os getenv rank_id
int os getenv rank_size
rank_size run_distribute
ParallelMode DATA_PARALLEL parallel_mode
config_ascend_quant config
print  format args_opt
print  format config
print  format rank_id|device_id|rank_size
config epoch_size epoch_size
mobilenetV2 num_classes network
CrossEntropyWithLabelSmooth smooth_factor loss
args_opt device_target device_target
dataset get_dataset_size step_size
load_checkpoint args_opt pre_trained param_dict
load_nonquant_param_into_quant_net network|param_dict
[True|False] per_channel
[True|False] symmetric
quantizer quantize network network
config lr lr_max
config warmup_epochs warmup_epochs
epoch_size|config start_epoch total_epochs
Model network|loss_fn model
[Monitor lr_init callback
config save_checkpoint_path directory
[ckpt_cb] callback
callback callbacks
config_gpu_quant config
[False|False] symmetric
config save_checkpoint_path ckpt_save_dir
parser parse_args args_opt device_target device_target
int os getenv rank_size run_distribute
config_ascend_quant config epoch_size epoch_size
config_ascend_quant config lr lr_max
config_ascend_quant config warmup_epochs warmup_epochs
config_ascend_quant config start_epoch total_epochs
config_ascend_quant config save_checkpoint_path directory
config_ascend_quant config save_checkpoint_path ckpt_save_dir
print  format args_opt device_target device_target
print  format config epoch_size epoch_size
print  format config lr lr_max
print  format config warmup_epochs warmup_epochs
print  format config start_epoch total_epochs
print  format config save_checkpoint_path directory
print  format config save_checkpoint_path ckpt_save_dir
config epoch_size epoch_size start_epoch total_epochs
mobilenetV2 num_classes network model
CrossEntropyWithLabelSmooth smooth_factor loss model
quantizer quantize network network model
[Monitor lr_init callback callbacks
[ckpt_cb] callback callbacks
config_gpu_quant config save_checkpoint_path ckpt_save_dir
parser parse_args args_opt
int os getenv device_id
config_ascend_quant config_device_target
[True|False] symmetric_list
config_gpu_quant config_device_target
[False|False] symmetric_list
ValueError  format args_opt device_target
mobilenetV2 num_classes network
[True|False] per_channel
quantizer quantize network network
config_device_target config
args_opt device_target device_target
dataset get_dataset_size step_size
load_checkpoint args_opt checkpoint_path param_dict
load_param_into_net network|param_dict not_load_param
network set_train False
Model network|loss_fn model
model eval dataset res
parser parse_args args_opt device_target device_target
config_ascend_quant config_device_target config
config_gpu_quant config_device_target config
mobilenetV2 num_classes network set_train False
mobilenetV2 num_classes network model
quantizer quantize network network set_train False
quantizer quantize network network model
Model network|loss_fn model eval dataset res
 config_ascend_quant
 config_gpu_quant
ValueError  format device_target
 configs
device_target config
ValueError  format device_target config
global_step int
lr_init float
lr_end float
lr_max float
warmup_epochs int
total_epochs int
steps_per_epoch int
steps_per_epoch|total_epochs total_steps
steps_per_epoch|warmup_epochs warmup_steps
range i
lr_init|(lr_max-lr_init)|i|warmup_steps lr
lr_end| lr
lr_each_step append lr
global_step current_step
np array lr_each_step astype np float32 lr_each_step
lr_each_step learning_rate
steps_per_epoch|warmup_epochs warmup_steps lr
range i lr
np array lr_each_step astype np float32 lr_each_step learning_rate
dataset_path string
do_train bool
repeat_num int
batch_size int
int os getenv rank_size
int os getenv rank_id
partial de MindDataset|dataset_path|columns_list load_func
partial de ImageFolderDataset|dataset_path load_func
ds shuffle buffer_size ds
C Decode decode_op
C RandomCropDecodeResize resize_height|scale resize_crop_decode_op
C Resize resize_op
C CenterCrop resize_height center_crop
C HWC2CHW change_swap_op
[resize_crop_decode_op|horizontal_flip_op|normalize_op|change_swap_op] trans
[decode_op|resize_op|center_crop|normalize_op|change_swap_op] trans
C2 TypeCast mstype int32 type_cast_op
ds repeat repeat_num ds
P Decode decode_op
P RandomResizedCrop resize_height|scale resize_crop_op
P Resize resize_op
P CenterCrop resize_height center_crop
P ToTensor to_tensor
P Normalize mean normalize_op
[decode_op|resize_crop_op|horizontal_flip_op|to_tensor|normalize_op] trans
[decode_op|resize_op|center_crop|to_tensor|normalize_op] trans
P2 Compose trans compose
repeat_num int os getenv rank_size
repeat_num int os getenv rank_id
batch_size int os getenv rank_size
batch_size int os getenv rank_id
C Decode decode_op trans
C Decode decode_op trans
C Decode decode_op trans
C Decode decode_op trans
C RandomCropDecodeResize resize_height|scale resize_crop_decode_op trans
C Resize resize_op trans
C Resize resize_op trans
C CenterCrop resize_height center_crop trans
C CenterCrop resize_height center_crop trans
C HWC2CHW change_swap_op trans
C HWC2CHW change_swap_op trans
P Decode decode_op trans
P Decode decode_op trans
P RandomResizedCrop resize_height|scale resize_crop_op trans
P Resize resize_op trans
P CenterCrop resize_height center_crop trans
P ToTensor to_tensor trans
P ToTensor to_tensor trans
P Normalize mean normalize_op trans
P Normalize mean normalize_op trans
batch_size int
parser parse_known_args unknown
unknown args training_script_args
print __file__
parse_args args
print args
args visible_devices split visible_devices
os path isfile args training_script
print  format visible_devices
print  format args server_id
open readlines hccn_configs
hccn_configs hccn_item
hccn_item strip hccn_item
hccn_item startswith
hccn_item split device_ip
device_id split device_id
device_ip device_ips device_id
print  format device_id|device_ip
platform processor arch
{0x002}[arch] hccn_table
range instance_id
visible_devices instance_id device_id
device_ips device_id device_ip
str device_id usable_dev
str instance_id instance
args server_id instance
instance_list append instance
str args nproc_per_node
visible_devices instance_id eth_id
hccn_table append  format eth_id
str args nproc_per_node hccn_table
os getcwd table_path
os path exists table_path
os mkdir table_path
open table_fn|
sys stdout flush
os environ copy env
str args nproc_per_node env
os getcwd cur_path
range rank_id
os chdir cur_path
visible_devices rank_id device_id
os path join cur_path| format rank_id device_dir
str rank_id env
str device_id env
table_fn env
os path exists device_dir
shutil rmtree device_dir
os mkdir device_dir
os chdir device_dir
[sys executable|] cmd
cmd append args training_script
cmd extend args training_script_args
open log_file
subprocess Popen cmd|stdout process
processes append process
cmds append cmd
log_files append log_file
zip process|cmd|log_file
process wait
process returncode|cmd cmd subprocess CalledProcessError
log_file close
parser parse_known_args unknown args training_script_args
parse_args args visible_devices split visible_devices
parse_args args server_id instance
print args visible_devices split visible_devices
print args server_id instance
args visible_devices split visible_devices instance_id device_id
args visible_devices split visible_devices instance_id eth_id
args visible_devices split visible_devices rank_id device_id
print  format visible_devices instance_id device_id
print  format visible_devices instance_id eth_id
print  format visible_devices rank_id device_id
open readlines hccn_configs hccn_item
hccn_configs hccn_item strip hccn_item
hccn_configs hccn_item startswith
hccn_configs hccn_item split device_ip
hccn_item split device_ip device_ips device_id
{0x002}[arch] hccn_table append  format eth_id
open table_fn env
[sys executable|] cmd append args training_script
[sys executable|] cmd extend args training_script_args
open log_file close
subprocess Popen cmd|stdout process wait
subprocess Popen cmd|stdout process returncode|cmd cmd subprocess CalledProcessError
processes append process wait
processes append process returncode|cmd cmd subprocess CalledProcessError
log_files append log_file close
zip process wait
zip process returncode|cmd cmd subprocess CalledProcessError
zip log_file close
divisor min_value
max min_value|int(v|divisor|2)||divisor|divisor new_v
divisor new_v
log_file close
super GlobalAvgPooling|self __init__
self mean x|(2|3) x
super ConvBNReLU|self __init__
(kernel_size-1)||2 padding
groups group
self conv x x
ResidualBlock 3|256|1|1
super InvertedResidual|self __init__
int round inp|expand_ratio hidden_dim
stride|groups stride
nn SequentialCell layers self conv
P TensorAdd self add
self conv x out
self add out|x out
super mobilenetV2|self __init__
InvertedResidual block
inverted_residual_setting self cfgs
_make_divisible input_channel|width_mult|round_nearest input_channel
_make_divisible last_channel|max(1 0|width_mult) self out_channels
self cfgs t|c|n|s
_make_divisible c|width_mult|round_nearest output_channel
range i
output_channel input_channel
nn SequentialCell features self features
nn Dropout
nn SequentialCell head self head
self init_parameters_data
self _initialize_weights
self features x x
self head x x
self cells_and_names _|m
isinstance m|nn Conv2d
m kernel_size|m kernel_size|m out_channels n
Tensor np random normal 0|np sqrt(2 |n) w
m weight set_data w
isinstance m|nn Conv2dBnAct
m conv kernel_size|m conv kernel_size|m conv out_channels n
m conv weight set_data w
isinstance m|nn BatchNorm2d
isinstance m|nn Dense
m weight set_data Tensor np random normal 0|0 01|m weight data shape astype
isinstance m|nn DenseBnAct
groups group stride
stride|groups stride stride
_make_divisible c|width_mult|round_nearest output_channel input_channel
self cells_and_names m kernel_size|m kernel_size|m out_channels n
self cells_and_names m weight set_data w
self cells_and_names m conv kernel_size|m conv kernel_size|m conv out_channels n
self cells_and_names m conv weight set_data w
self cells_and_names m weight set_data Tensor np random normal 0|0 01|m weight data shape astype
Tensor |100 asnumpy lr_init
super Monitor|self __init__
lr_init self lr_init
len lr_init self lr_init_len
time time self epoch_time
run_context original_args cb_params
(time time-self epoch_time)|1000 epoch_mseconds
epoch_mseconds|cb_params batch_num per_step_mseconds
time time self step_time
(time time-self step_time)|1000 step_mseconds
cb_params net_outputs step_loss
isinstance step_loss| tuple|listandisinstance step_loss|Tensor
isinstance step_loss|Tensor
np mean step_loss asnumpy step_loss
self losses append step_loss
(cb_params cur_step_num-1)%cb_params batch_num cur_step_in_epoch
super CrossEntropyWithLabelSmooth|self __init__
P OneHot self onehot
Tensor 1 0-smooth_factor|mstype float32 self on_value
nn SoftmaxCrossEntropyWithLogits self ce
P ReduceMean False self mean
P Cast self cast
self ce logit|one_hot_label out_loss
self mean out_loss|0 out_loss
Tensor |100 asnumpy lr_init self lr_init
run_context original_args cb_params batch_num per_step_mseconds
run_context original_args cb_params net_outputs step_loss
(time time-self epoch_time)|1000 epoch_mseconds batch_num per_step_mseconds
isinstance step_loss| tuple|listandisinstance Tensor 1 0-smooth_factor|mstype float32 self on_value
isinstance Tensor 1 0-smooth_factor|mstype float32 self on_value
Mask_Rcnn_Resnet50 config config
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
Mask_Rcnn_Resnet50 config net
load_checkpoint args ckpt_file param_dict
load_param_into_net net|param_dict
net set_train False
config test_batch_size bs
Tensor np zeros [args batch_size|3|config img_height|config img_width]|np float16 img
Tensor np zeros [args batch_size|4]|np float16 img_metas
Tensor np zeros [args batch_size|config num_gts|4]|np float16 gt_bboxes
Tensor np zeros [args batch_size|config num_gts]|np int32 gt_labels
Tensor np zeros [args batch_size|config num_gts]|np bool gt_num
Tensor np zeros [args batch_size|config num_gts]|np bool gt_mask
[img|img_metas|gt_bboxes|gt_labels|gt_num|gt_mask] input_data
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
Mask_Rcnn_Resnet50 config net set_train False
load_param_into_net net set_train False
Tensor np zeros [args batch_size|3|config img_height|config img_width]|np float16 img input_data
Tensor np zeros [args batch_size|4]|np float16 img_metas input_data
Tensor np zeros [args batch_size|config num_gts|4]|np float16 gt_bboxes input_data
Tensor np zeros [args batch_size|config num_gts]|np int32 gt_labels input_data
Tensor np zeros [args batch_size|config num_gts]|np bool gt_num input_data
Tensor np zeros [args batch_size|config num_gts]|np bool gt_mask input_data
net set_train False
parser parse_args args_opt
args_opt rank_id rank
args_opt device_num device_num
config mindrecord_dir mindrecord_dir
os path join mindrecord_dir|prefix| mindrecord_file
os path isdir mindrecord_dir
os makedirs mindrecord_dir
os path isdir config coco_root
data_to_mindrecord_byte_image True|prefix
print  format mindrecord_dir
os path isdir config IMAGE_DIRandos path exists config ANNO_PATH
os path exists(mindrecord_file|)
time sleep
float config loss_scale loss_scale
dataset get_dataset_size dataset_size
print dataset_size
Mask_Rcnn_Resnet50 config net
net set_train net
args_opt pre_trained load_path
load_checkpoint load_path param_dict
list item
(item startswith)
param_dict pop item
load_param_into_net net|param_dict
LossNet loss
WithLossCell net|loss net_with_loss
TrainOneStepCell net_with_loss|net|opt|sens net
TimeMonitor data_size time_cb
LossCallBack rank_id loss_cb
[time_cb|loss_cb] cb
os path join config save_checkpoint_path save_checkpoint_path
[ckpoint_cb] cb
Model net model
cb callbacks
parser parse_args args_opt rank_id rank
parser parse_args args_opt device_num device_num
parser parse_args args_opt pre_trained load_path
Mask_Rcnn_Resnet50 config net set_train net
Mask_Rcnn_Resnet50 config net net
load_checkpoint load_path param_dict pop item
LossNet loss net
LossNet loss cb
WithLossCell net|loss net_with_loss net
TrainOneStepCell net_with_loss|net|opt|sens net net
TimeMonitor data_size time_cb cb
LossCallBack rank_id loss_cb cb
[time_cb|loss_cb] cb cb
[time_cb|loss_cb] cb callbacks
[ckpoint_cb] cb callbacks
load_param_into_net net|param_dict
parser parse_args args_opt
Mask_Rcnn_Resnet50 config net
load_checkpoint ckpt_path param_dict
net set_train False
ds get_dataset_size total
COCO ann_file dataset_coco
print total
eval_iter|1 eval_iter
data img_data
data img_metas
data gt_bboxes
data gt_labels
data gt_num
data gt_mask
time time start
time time end
print  format eval_iter|end-start
output all_bbox
output all_label
output all_mask
output all_mask_fb
range j
np squeeze all_bbox asnumpy all_bbox_squee
np squeeze all_label asnumpy all_label_squee
np squeeze all_mask asnumpy all_mask_squee
np squeeze all_mask_fb asnumpy all_mask_fb_squee
all_bbox_squee all_bboxes_tmp_mask
all_label_squee all_mask_squee all_labels_tmp_mask
all_mask_fb_squee all_mask_fb_tmp_mask
np argsort -all_bboxes_tmp_mask inds
all_bboxes_tmp_mask inds all_bboxes_tmp_mask
all_labels_tmp_mask inds all_labels_tmp_mask
all_mask_fb_tmp_mask inds all_mask_fb_tmp_mask
bbox2result_1image all_bboxes_tmp_mask|all_labels_tmp_mask|config num_classes bbox_results
outputs append (bbox_results|segm_results)
results2json dataset_coco|outputs result_files
config mindrecord_dir mindrecord_dir
os path join mindrecord_dir|prefix mindrecord_file
os path exists mindrecord_file
os path isdir mindrecord_dir
os makedirs mindrecord_dir
os path isdir config coco_root
print  format mindrecord_dir
os path isdir config IMAGE_DIRandos path exists config ANNO_PATH
MaskRcnn_eval mindrecord_file|args_opt checkpoint_path|args_opt ann_file
load_param_into_net net set_train False
Mask_Rcnn_Resnet50 config net set_train False
eval_iter|1 eval_iter eval_iter
np squeeze all_bbox asnumpy all_bbox_squee all_bboxes_tmp_mask
np squeeze all_label asnumpy all_label_squee all_mask_squee all_labels_tmp_mask
np squeeze all_mask_fb asnumpy all_mask_fb_squee all_mask_fb_tmp_mask
all_bbox_squee all_bboxes_tmp_mask inds all_bboxes_tmp_mask
all_label_squee all_mask_squee all_labels_tmp_mask inds all_labels_tmp_mask
all_mask_fb_squee all_mask_fb_tmp_mask inds all_mask_fb_tmp_mask
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step learning_rate
float current_step-warmup_steps|float(decay_steps) base
(1|math cos(base|math pi))|2|base_lr learning_rate
config base_lr base_lr
(config base_step||rank_size)|rank_size base_step
int base_step|config total_epoch total_steps
int config warmup_step warmup_steps
range i
lr append linear_warmup_learning_rate i|warmup_steps|base_lr|base_lr|config warmup_ratio
lr append a_cosine_learning_rate i|base_lr|warmup_steps|total_steps
lr learning_rate
lr append a_cosine_learning_rate lr append a_cosine_learning_rate i|base_lr|warmup_steps|total_steps
lr append a_cosine_learning_rate lr learning_rate
 config
[(192|320)|(96|160)|(48|80)|(24|40)|(12|20)
np array _init_value
json load open result_files anns
mmcv is_str coco
COCO coco coco
isinstance coco|COCO
result_types res_type
result_files res_type result_file
result_file endswith
coco loadRes result_file coco_dets
coco getImgIds gt_img_ids
coco_dets getImgIds det_img_ids
COCOeval coco|coco_dets|iou_type cocoEval
list max_dets cocoEval params maxDets
dict res_dict
tgt_ids id_i
[id_i] cocoEval params imgIds
cocoEval evaluate
cocoEval accumulate
cocoEval summarize
res_dict update({coco imgs id_i stats})
tgt_ids cocoEval params imgIds
bbox tolist _bbox
list ndarray
[np zeros (0|5)] result
dataset getImgIds img_ids
dataset get_dataset_size|2 dataset_len
range idx
img_ids idx img_id
results idx bboxes
range i
dict data
img_id data
xyxy2xywh bboxes i data
float bboxes i data
json_results append data
dataset getCatIds cat_ids
len img_ids dataset_len
results idx result
enumerate label|result_label
result_label bboxes
cat_ids label data
results idx seg
enumerate label|det_label
det_label bboxes
bbox_json_results append data
seg label segms
seg label mask_score
float mask_score i data
segms i data
segm_json_results append data
dict result_files
isinstance results|list
det2json dataset|results json_results
mmcv dump json_results|result_files
isinstance results|tuple
segm2json dataset|results json_results
isinstance results|np ndarray
proposal2json dataset|results json_results
mask_pred astype np float32 mask_pred
[for_inrange num_classes-1] cls_segms
det_bboxes bboxes
det_labels|1 labels
img_meta astype np int32 ori_shape
img_meta astype np int32 scale_factor
ori_shape img_w
np round ori_shape|scale_factor astype(np int32) img_h
np round ori_shape|scale_factor astype(np int32) img_w
(bboxes|1 0) astype(np int32) bbox
labels i label
max bbox-bbox|1|1 w
max bbox-bbox|1|1 h
min w|img_w-bbox w
min h|img_h-bbox h
max w|1 w
max h|1 h
mask_pred mask_pred_
np zeros (img_h|img_w) im_mask
mmcv imresize mask_pred_|(w|h) bbox_mask
(bbox_mask) bbox_mask
bbox_mask im_mask
maskUtils encode rle
1] append rle
mmcv is_str coco loadRes result_file coco_dets
mmcv is_str coco getImgIds gt_img_ids
COCO coco coco loadRes result_file coco_dets
COCO coco coco getImgIds gt_img_ids
isinstance coco loadRes result_file coco_dets
isinstance coco getImgIds gt_img_ids
result_files res_type result_file endswith
coco loadRes result_file coco_dets getImgIds det_img_ids
COCOeval coco|coco_dets|iou_type cocoEval evaluate
COCOeval coco|coco_dets|iou_type cocoEval accumulate
COCOeval coco|coco_dets|iou_type cocoEval summarize
dict res_dict update({coco imgs id_i stats})
dataset getImgIds img_ids idx img_id
img_ids idx img_id data
results idx bboxes 0) astype(np int32) bbox
dataset getCatIds cat_ids label data
enumerate result_label bboxes
result_label bboxes 0) astype(np int32) bbox
results idx seg label segms
results idx seg label mask_score
enumerate det_label bboxes
det_label bboxes 0) astype(np int32) bbox
seg label segms i data
det_bboxes bboxes 0) astype(np int32) bbox
det_labels|1 labels labels
det_labels|1 labels i label
img_meta astype np int32 ori_shape img_w
mmcv imresize mask_pred_|(w|h) bbox_mask im_mask
(bbox_mask) bbox_mask im_mask
super RpnRegClsBlock|self __init__
nn ReLU self relu
self relu self rpn_conv x x
self rpn_cls x x1
self rpn_reg x x2
super RPN|self __init__
config cfg_rpn
cfg_rpn num_bboxes self num_bboxes
(0|) self slice_index
cfg_rpn feature_shapes shape
 self slice_index index self slice_index
(shape|shape|num_anchors|batch_size|) self feature_anchor_shape
num_anchors self num_anchors
batch_size self batch_size
cfg_rpn test_batch_size self test_batch_size
Tensor np ones (1|1) astype(np float16) self real_ratio
P Transpose self transpose
P Reshape self reshape
P Fill self fill
Tensor np ones (1|) astype(np float16) self placeh1
(0|2|3|1) self trans_shape
(-1|4) self reshape_shape_reg
(-1|) self reshape_shape_cls
Tensor np array cfg_rpn rpn_loss_reg_weight astype np float16 self rpn_loss_reg_weight
Tensor np array cfg_rpn rpn_loss_cls_weight astype np float16 self rpn_loss_cls_weight
Tensor np array cfg_rpn num_expected_neg|self batch_size astype(np float16) self num_expected_total
BboxAssignSample cfg_rpn|self batch_size|self num_bboxes|False self get_targets
P CheckValid self CheckValid
P ReduceSum self sum_loss
P SigmoidCrossEntropyWithLogits self loss_cls
P Squeeze self squeeze
P Cast self cast
P Tile self tile
P ZerosLike self zeros_like
Tensor np zeros (1|) astype(np float16) self loss
Tensor np zeros (1|) astype(np float16) self clsloss
Tensor np zeros (1|) astype(np float16) self regloss
(feat_channels|in_channels|3|3) shp_weight_conv
(feat_channels|) shp_bias_conv
initializer shape weight_conv
initializer 0|shape bias_conv
(num_anchors|cls_out_channels|feat_channels|1|1) shp_weight_cls
(num_anchors|cls_out_channels|) shp_bias_cls
initializer shape weight_cls
initializer 0|shape bias_cls
(num_anchors|4|feat_channels|1|1) shp_weight_reg
(num_anchors|4|) shp_bias_reg
initializer shape weight_reg
initializer 0|shape bias_reg
range i
rpn_layer rpn_conv weight rpn_layer i
rpn_layer rpn_cls weight rpn_layer i
rpn_layer rpn_reg weight rpn_layer i
rpn_layer rpn_conv bias rpn_layer i
rpn_layer rpn_cls bias rpn_layer i
rpn_layer rpn_reg bias rpn_layer i
self rpn_convs_list i inputs i x2
rpn_cls_score_total|(x1|) rpn_cls_score_total
rpn_bbox_pred_total|(x2|) rpn_bbox_pred_total
self transpose x1|self trans_shape x1
self reshape x1|self reshape_shape_cls x1
self transpose x2|self trans_shape x2
self reshape x2|self reshape_shape_reg x2
rpn_cls_score|(x1|) rpn_cls_score
rpn_bbox_pred|(x2|) rpn_bbox_pred
self loss loss
self clsloss clsloss
self regloss regloss
range j
multi_level_flags|(res|) multi_level_flags
anchor_list_tuple|(anchor_list[j]|) anchor_list_tuple
self concat multi_level_flags valid_flag_list
self concat anchor_list_tuple anchor_using_list
self squeeze gt_bboxes gt_bboxes_i
self squeeze gt_labels gt_labels_i
self squeeze gt_valids gt_valids_i
self cast bbox_weight|mstype float16 bbox_weight
self cast label|mstype float16 label
self cast label_weight|mstype float16 label_weight
self slice_index j begin
self slice_index end
(bbox_target|) bbox_targets
(bbox_weight|) bbox_weights
(label|) labels
(label_weight|) label_weights
(bbox_targets|) bbox_target_using
(bbox_weights|) bbox_weight_using
(labels|) label_using
(label_weights|) label_weight_using
self concat bbox_target_using bbox_target_with_batchsize
self concat bbox_weight_using bbox_weight_with_batchsize
self concat label_using label_with_batchsize
self concat label_weight_using label_weight_with_batchsize
F stop_gradient bbox_target_with_batchsize bbox_target_
F stop_gradient bbox_weight_with_batchsize bbox_weight_
F stop_gradient label_with_batchsize label_
F stop_gradient label_weight_with_batchsize label_weight_
rpn_cls_score i cls_score_i
rpn_bbox_pred i reg_score_i
self loss_cls cls_score_i|label_ loss_cls
loss_cls|label_weight_ loss_cls_item
self sum_loss loss_cls_item|(0|)|self num_expected_total loss_cls_item
self loss_bbox reg_score_i|bbox_target_ loss_reg
self tile self reshape bbox_weight_| self feature_anchor_shape i bbox_weight_
loss_reg|bbox_weight_ loss_reg
self sum_loss loss_reg|(1|) loss_reg_item
self sum_loss loss_reg_item|(0|)|self num_expected_total loss_reg_item
self rpn_loss_cls_weight|loss_cls_item|self rpn_loss_reg_weight|loss_reg_item loss_total
loss_total loss
(loss_total|loss_cls_item|loss_reg_item) loss_print
loss_cls_item clsloss
loss_reg_item regloss
(loss|rpn_cls_score_total|rpn_bbox_pred_total|clsloss|regloss|loss_print) output
(self placeh1|rpn_cls_score_total|rpn_bbox_pred_total|self placeh1|self placeh1|self placeh1) output
self rpn_cls x x1 rpn_cls_score_total
self rpn_cls x x1 rpn_cls_score
self rpn_reg x x2 rpn_bbox_pred_total
self rpn_reg x x2 rpn_bbox_pred
config cfg_rpn num_bboxes self num_bboxes
config cfg_rpn feature_shapes shape
config cfg_rpn test_batch_size self test_batch_size
cfg_rpn feature_shapes shape self feature_anchor_shape
cfg_rpn feature_shapes shape bias_conv
cfg_rpn feature_shapes shape bias_cls
cfg_rpn feature_shapes shape bias_reg
P SigmoidCrossEntropyWithLogits self loss_cls loss_cls_item
P SigmoidCrossEntropyWithLogits self loss_cls loss_print
Tensor np zeros (1|) astype(np float16) self loss loss_print
Tensor np zeros (1|) astype(np float16) self loss output
Tensor np zeros (1|) astype(np float16) self clsloss output
Tensor np zeros (1|) astype(np float16) self regloss output
self rpn_convs_list i inputs i x2 rpn_bbox_pred_total
self rpn_convs_list i inputs i x2 rpn_bbox_pred
rpn_cls_score_total|(x1|) rpn_cls_score_total rpn_cls_score_total
rpn_cls_score_total|(x1|) rpn_cls_score_total output
rpn_bbox_pred_total|(x2|) rpn_bbox_pred_total rpn_bbox_pred_total
rpn_bbox_pred_total|(x2|) rpn_bbox_pred_total output
self transpose x1|self trans_shape x1 rpn_cls_score
self reshape x1|self reshape_shape_cls x1 rpn_cls_score
self transpose x2|self trans_shape x2 rpn_bbox_pred
self reshape x2|self reshape_shape_reg x2 rpn_bbox_pred
rpn_cls_score|(x1|) rpn_cls_score rpn_cls_score
rpn_cls_score|(x1|) rpn_cls_score i cls_score_i
rpn_cls_score|(x1|) rpn_cls_score output
rpn_bbox_pred|(x2|) rpn_bbox_pred rpn_bbox_pred
rpn_bbox_pred|(x2|) rpn_bbox_pred i reg_score_i
rpn_bbox_pred|(x2|) rpn_bbox_pred output
self loss loss loss_print
self loss loss output
self clsloss clsloss output
self regloss regloss output
multi_level_flags|(res|) multi_level_flags multi_level_flags
anchor_list_tuple|(anchor_list[j]|) anchor_list_tuple anchor_list_tuple
self cast bbox_weight|mstype float16 bbox_weight bbox_weights
self cast bbox_weight|mstype float16 bbox_weight loss_reg
self cast label|mstype float16 label labels
self cast label|mstype float16 label loss_cls_item
self cast label_weight|mstype float16 label_weight label_weights
self cast label_weight|mstype float16 label_weight loss_cls_item
(bbox_target|) bbox_targets bbox_target_using
(bbox_weight|) bbox_weights bbox_weight_using
(label|) labels label_using
(label_weight|) label_weights label_weight_using
F stop_gradient bbox_weight_with_batchsize bbox_weight_ loss_reg
F stop_gradient label_with_batchsize label_ loss_cls_item
F stop_gradient label_weight_with_batchsize label_weight_ loss_cls_item
self loss_cls cls_score_i|label_ loss_cls loss_cls_item
self loss_cls cls_score_i|label_ loss_cls loss_print
loss_cls|label_weight_ loss_cls_item loss_print
loss_cls|label_weight_ loss_cls_item clsloss
self sum_loss loss_cls_item|(0|)|self num_expected_total loss_cls_item loss_print
self sum_loss loss_cls_item|(0|)|self num_expected_total loss_cls_item clsloss
self loss_bbox reg_score_i|bbox_target_ loss_reg loss_reg
self loss_bbox reg_score_i|bbox_target_ loss_reg loss_print
self tile self reshape bbox_weight_| self feature_anchor_shape i bbox_weight_ loss_reg
loss_reg|bbox_weight_ loss_reg loss_reg
loss_reg|bbox_weight_ loss_reg loss_print
self sum_loss loss_reg|(1|) loss_reg_item loss_print
self sum_loss loss_reg|(1|) loss_reg_item regloss
self sum_loss loss_reg_item|(0|)|self num_expected_total loss_reg_item loss_print
self sum_loss loss_reg_item|(0|)|self num_expected_total loss_reg_item regloss
self rpn_loss_cls_weight|loss_cls_item|self rpn_loss_reg_weight|loss_reg_item loss_total loss
self rpn_loss_cls_weight|loss_cls_item|self rpn_loss_reg_weight|loss_reg_item loss_total loss_print
loss_total loss loss_print
loss_total loss output
(loss_total|loss_cls_item|loss_reg_item) loss_print output
loss_cls_item clsloss output
loss_reg_item regloss output
super ROIAlign|self __init__
(out_size_h|out_size_w) self out_size
float spatial_scale self spatial_scale
int sample_num self sample_num
self align_op features|rois
self __class__ __name__ format_str
super SingleRoIExtractor|self __init__
config cfg
batch_size self train_batch_size
out_channels self out_channels
featmap_strides self featmap_strides
len self featmap_strides self num_levels
roi_layer self out_size
mask self mask
roi_layer self sample_num
self build_roi_layers self featmap_strides self roi_layers
L CellList self roi_layers self roi_layers
P Sqrt self sqrt
P Log self log
finest_scale self finest_scale_
C clip_by_value self clamp
P Cast self cast
P Equal self equal
P Select self select
training self training_local
self train_batch_size|self batch_size self batch_size
Tensor np array np ones (self batch_size|1) self ones
np array np ones (self batch_size|1) finest_scale
Tensor finest_scale self finest_scale
Tensor np array np ones (self batch_size|1) self epslion
Tensor np array np zeros (self batch_size|1) self zeros
Tensor np array np ones (self batch_size|1) self max_levels
Tensor np array np ones (self batch_size|1) self twos
len self featmap_strides
self log value|self log self twos
featmap_strides s
self sample_num sample_num
roi_layers append layer_cls
self sqrt rois|self ones| scale
self sqrt rois|self ones
self log2 scale|self finest_scale|self epslion target_lvls
P Floor target_lvls target_lvls
self cast target_lvls|mstype int32 target_lvls
self clamp target_lvls|self zeros|self max_levels target_lvls
(feat1|feat2|feat3|feat4) feats
self res_ res
self _c_map_roi_levels rois target_lvls
range i
self equal target_lvls|P ScalarToArray i mask
P Reshape mask|(-1|1|1|1) mask
self roi_layers i feats i roi_feats_t
self select mask|roi_feats_t|res res
(out_size_h|out_size_w) self out_size self out_size
self build_roi_layers self featmap_strides self roi_layers append layer_cls
L CellList self roi_layers self roi_layers append layer_cls
len self featmap_strides s
BboxAssignSampleForRcnn config|2|1024|True
super BboxAssignSampleForRcnn|self __init__
config cfg
batch_size self batch_size
cfg neg_iou_thr_stage2 self neg_iou_thr
cfg pos_iou_thr_stage2 self pos_iou_thr
cfg min_pos_iou_stage2 self min_pos_iou
cfg num_gts self num_gts
num_bboxes self num_bboxes
cfg num_expected_pos_stage2 self num_expected_pos
cfg num_expected_neg_stage2 self num_expected_neg
cfg num_expected_total_stage2 self num_expected_total
add_gt_as_proposals self add_gt_as_proposals
Tensor np arange 1|self num_gts|1 astype(np int32) self label_inds
P ReduceSum self sum_inds
P IOU self iou
P GreaterEqual self greaterequal
P Greater self greater
P Select self select
P GatherNd self gatherND
P Squeeze self squeeze
P Cast self cast
P LogicalAnd self logicaland
P Less self less
P RandomChoiceWithMask self num_expected_pos self random_choice_with_mask_pos
P RandomChoiceWithMask self num_expected_neg self random_choice_with_mask_neg
P Reshape self reshape
P Equal self equal
P BoundingBoxEncode means self bounding_box_encode
P LogicalNot self logicalnot
P Tile self tile
Tensor np array -1|np ones((self num_gts|4)) self check_gt_one
Tensor np array -2|np ones((self num_bboxes|4)) self check_anchor_two
Tensor np array -1|np ones num_bboxes self assigned_gt_inds
Tensor np array np zeros num_bboxes self assigned_gt_zeros
Tensor np array np ones num_bboxes self assigned_gt_ones
Tensor np array -1|np ones num_bboxes self assigned_gt_ignores
Tensor np array np ones self num_expected_pos self assigned_pos_ones
Tensor np array -1|np ones(self num_gts) self gt_ignores
Tensor np arange self num_expected_pos astype np float16 self range_pos_size
Tensor np array np ones self num_expected_neg-self num_expected_pos self check_neg_mask
Tensor np zeros (self num_expected_neg|4) self bboxs_neg_mask
Tensor np array np zeros self num_expected_neg self labels_neg_mask
(self num_expected_pos|1) self reshape_shape_pos
(self num_expected_neg|1) self reshape_shape_neg
Tensor 0 0|dtype self scalar_zero
Tensor self neg_iou_thr|dtype self scalar_neg_iou_thr
Tensor self pos_iou_thr|dtype self scalar_pos_iou_thr
Tensor self min_pos_iou|dtype self scalar_min_pos_iou
P ExpandDims self expand_dims
P Concat axis self concat_last_axis
P Round self round
Tensor [cfg img_height|cfg img_width|cfg img_height|cfg img_width]|dtype self image_h_w
(cfg mask_shape|cfg mask_shape) self mask_shape
P Squeeze axis self squeeze_mask_last
self iou bboxes|gt_bboxes_i overlaps
self max_gt overlaps max_overlaps_w_gt
self max_anchor overlaps max_overlaps_w_ac
self select neg_sample_iou_mask|self assigned_gt_zeros|self assigned_gt_inds assigned_gt_inds2
self greaterequal max_overlaps_w_gt|self scalar_pos_iou_thr pos_sample_iou_mask
range j
max_overlaps_w_ac max_overlaps_w_ac_j
overlaps overlaps_w_ac_j
self greaterequal max_overlaps_w_ac_j|self scalar_min_pos_iou temp1
self squeeze self equal overlaps_w_ac_j|max_overlaps_w_ac_j temp2
self logicaland temp1|temp2 pos_mask_j
self select pos_mask_j|(j|1)|self assigned_gt_ones|assigned_gt_inds3 assigned_gt_inds3
self select valid_mask|assigned_gt_inds3|self assigned_gt_ignores assigned_gt_inds5
self concat (gt_bboxes_i|bboxes) bboxes
self select gt_valids|self label_inds|self gt_ignores label_inds_valid
label_inds_valid|self add_gt_as_proposals_valid label_inds_valid
self concat (label_inds_valid|assigned_gt_inds5) assigned_gt_inds5
self random_choice_with_mask_pos self greater assigned_gt_inds5|0 valid_pos_index
self cast self greater assigned_gt_inds5|0 pos_check_valid
self sum_inds pos_check_valid|-1 pos_check_valid
self less self range_pos_size|pos_check_valid valid_pos_index
pos_index|self reshape(self cast(valid_pos_index|mstype int32)) pos_index
self sum_inds self cast self logicalnot valid_pos_index num_pos
self cast valid_pos_index|mstype int32 valid_pos_index
self reshape pos_index|self reshape_shape_pos pos_index
self reshape valid_pos_index|self reshape_shape_pos valid_pos_index
pos_index|valid_pos_index pos_index
self gatherND assigned_gt_inds5|pos_index-self assigned_pos_ones pos_assigned_gt_index
self reshape pos_assigned_gt_index|self reshape_shape_pos pos_assigned_gt_index
pos_assigned_gt_index|valid_pos_index pos_assigned_gt_index
self gatherND gt_labels_i|pos_assigned_gt_index pos_gt_labels
self random_choice_with_mask_neg self equal assigned_gt_inds5|0 valid_neg_index
self less self range_pos_size|num_pos unvalid_pos_index
self logicaland self concat (self check_neg_mask|unvalid_pos_index) valid_neg_index
self reshape neg_index|self reshape_shape_neg neg_index
self cast valid_neg_index|mstype int32 valid_neg_index
self reshape valid_neg_index|self reshape_shape_neg valid_neg_index
neg_index|valid_neg_index neg_index
self gatherND bboxes|pos_index pos_bboxes_
self gatherND bboxes|neg_index neg_bboxes_
self gatherND gt_bboxes_i|pos_assigned_gt_index pos_gt_bboxes_
self bounding_box_encode pos_bboxes_|pos_gt_bboxes_ pos_bbox_targets_
self gatherND gt_masks_i|pos_assigned_gt_index roi_pos_masks_fb
self cast roi_pos_masks_fb|mstype float32 pos_masks_fb
self split pos_bboxes_ y2
self concat_last_axis (y1|x1|y2|x2) boxes
boxes|self image_h_w boxes
self range box_ids
self expand_dims pos_masks_fb|-1 pos_masks_fb
self cast boxes|mstype float32 boxes
self crop_and_resize pos_masks_fb|boxes|box_ids|self mask_shape pos_masks_fb
self squeeze_mask_last pos_masks_fb pos_masks_fb
self round pos_masks_fb pos_masks_fb
self cast pos_masks_fb|mstype float16 pos_masks_fb
self concat (pos_bboxes_|neg_bboxes_) total_bboxes
self concat (pos_bbox_targets_|self bboxs_neg_mask) total_deltas
self concat (pos_gt_labels|self labels_neg_mask) total_labels
self concat (valid_pos_index|valid_neg_index) total_mask
BboxAssignSampleForRcnn config cfg
config cfg neg_iou_thr_stage2 self neg_iou_thr
config cfg pos_iou_thr_stage2 self pos_iou_thr
config cfg min_pos_iou_stage2 self min_pos_iou
config cfg num_gts self num_gts
config cfg num_expected_pos_stage2 self num_expected_pos
config cfg num_expected_neg_stage2 self num_expected_neg
config cfg num_expected_total_stage2 self num_expected_total
self iou bboxes|gt_bboxes_i overlaps overlaps_w_ac_j
self max_anchor overlaps max_overlaps_w_ac max_overlaps_w_ac_j
self select gt_valids|self label_inds|self gt_ignores label_inds_valid add_gt_as_proposals_valid label_inds_valid
label_inds_valid|self add_gt_as_proposals_valid label_inds_valid add_gt_as_proposals_valid label_inds_valid
self random_choice_with_mask_pos self greater assigned_gt_inds5|0 valid_pos_index pos_index
self random_choice_with_mask_pos self greater assigned_gt_inds5|0 valid_pos_index pos_assigned_gt_index
self less self range_pos_size|pos_check_valid valid_pos_index pos_index
self less self range_pos_size|pos_check_valid valid_pos_index pos_assigned_gt_index
pos_index|self reshape(self cast(valid_pos_index|mstype int32)) pos_index reshape(self cast(valid_pos_index|mstype int32)) pos_index
pos_index|self reshape(self cast(valid_pos_index|mstype int32)) pos_index pos_index
self cast valid_pos_index|mstype int32 valid_pos_index pos_index
self cast valid_pos_index|mstype int32 valid_pos_index pos_assigned_gt_index
self reshape pos_index|self reshape_shape_pos pos_index pos_index
self reshape valid_pos_index|self reshape_shape_pos valid_pos_index pos_index
self reshape valid_pos_index|self reshape_shape_pos valid_pos_index pos_assigned_gt_index
pos_index|valid_pos_index pos_index pos_index
self gatherND assigned_gt_inds5|pos_index-self assigned_pos_ones pos_assigned_gt_index pos_assigned_gt_index
self reshape pos_assigned_gt_index|self reshape_shape_pos pos_assigned_gt_index pos_assigned_gt_index
pos_assigned_gt_index|valid_pos_index pos_assigned_gt_index pos_assigned_gt_index
self random_choice_with_mask_neg self equal assigned_gt_inds5|0 valid_neg_index neg_index
self logicaland self concat (self check_neg_mask|unvalid_pos_index) valid_neg_index neg_index
self reshape neg_index|self reshape_shape_neg neg_index neg_index
self cast valid_neg_index|mstype int32 valid_neg_index neg_index
self reshape valid_neg_index|self reshape_shape_neg valid_neg_index neg_index
neg_index|valid_neg_index neg_index neg_index
self concat_last_axis (y1|x1|y2|x2) boxes image_h_w boxes
boxes|self image_h_w boxes image_h_w boxes
tensor|(proposal|mask)
( 0| 0| 0| 0) target_means
(1 0|1 0|1 0|1 0) target_stds
super Proposal|self __init__
config cfg
batch_size self batch_size
num_classes self num_classes
target_means self target_means
target_stds self target_stds
use_sigmoid_cls self use_sigmoid_cls
num_classes-1 self cls_out_channels
P Sigmoid self activation
(-1|1) self reshape_shape
num_classes self cls_out_channels
(-1|2) self reshape_shape
cfg rpn_proposal_nms_pre self num_pre
cfg rpn_proposal_min_bbox_size self min_box_size
cfg rpn_proposal_nms_thr self nms_thr
cfg rpn_proposal_nms_post self nms_post
cfg rpn_proposal_nms_across_levels self nms_across_levels
cfg rpn_proposal_max_num self max_num
cfg fpn_num_outs self num_levels
P Squeeze self squeeze
P Reshape self reshape
P Cast self cast
cfg feature_shapes self feature_shapes
(1|2|0) self transpose_shape
self target_means| means
P NMSWithMask self nms_thr self nms
P Minimum self min
P GatherNd self gatherND
P Slice self slice
P Select self select
P Greater self greater
P Transpose self transpose
P Tile self tile
Tensor 10 0|mstype float16 self multi_10
training self training_local
cfg rpn_nms_pre self num_pre
cfg rpn_min_bbox_min_size self min_box_size
cfg rpn_nms_thr self nms_thr
cfg rpn_nms_post self nms_post
cfg rpn_nms_across_levels self nms_across_levels
cfg rpn_max_num self max_num
self feature_shapes shp
min self num_pre|(shp|shp|3) k_num
k_num total_max_topk_input
(k_num|) self topK_stage1
((k_num|1)) self topK_shape
(self max_num|1) self topK_shape_stage2
-65536 0 self min_float_num
Tensor self min_float_num|np ones(total_max_topk_input|np float16) self topK_mask
range img_id
range i
self squeeze rpn_cls_score_total rpn_cls_score_i
self squeeze rpn_bbox_pred_total rpn_bbox_pred_i
cls_score_list|(rpn_cls_score_i|) cls_score_list
bbox_pred_list|(rpn_bbox_pred_i|) bbox_pred_list
self get_bboxes_single cls_score_list|bbox_pred_list|anchor_list masks
(proposals|) proposals_tuple
(masks|) masks_tuple
range idx
self transpose cls_scores idx rpn_cls_score
self transpose bbox_preds idx rpn_bbox_pred
mlvl_anchors idx anchors
self reshape rpn_cls_score|self reshape_shape rpn_cls_score
self activation rpn_cls_score rpn_cls_score
self cast self squeeze rpn_cls_score rpn_cls_score_process
self cast self reshape rpn_bbox_pred|(-1|4) rpn_bbox_pred_process
self topKv2 rpn_cls_score_process|self topK_stage1 idx topk_inds
self reshape topk_inds|self topK_shape idx topk_inds
self gatherND rpn_bbox_pred_process|topk_inds bboxes_sorted
self cast self gatherND anchors|topk_inds anchors_sorted
self decode anchors_sorted|bboxes_sorted proposals_decode
self concat_axis1  proposals_decode|self reshape scores_sorted|self topK_shape idx proposals_decode
self nms proposals_decode mask_valid
mlvl_proposals|(proposals|) mlvl_proposals
mlvl_mask|(mask_valid|) mlvl_mask
self concat_axis0 mlvl_proposals proposals
self concat_axis0 mlvl_mask masks
self split proposals scores
self squeeze scores scores
self cast self topK_mask|mstype float16 topk_mask
self select masks|scores|topk_mask scores_using
self topKv2 scores_using|self max_num topk_inds
self reshape topk_inds|self topK_shape_stage2 topk_inds
self gatherND proposals|topk_inds proposals
self gatherND masks|topk_inds masks
( 0| 0| 0| 0) target_means self target_means
(1 0|1 0|1 0|1 0) target_stds self target_stds
config cfg rpn_proposal_nms_pre self num_pre
config cfg rpn_proposal_min_bbox_size self min_box_size
config cfg rpn_proposal_nms_thr self nms_thr
config cfg rpn_proposal_nms_post self nms_post
config cfg rpn_proposal_nms_across_levels self nms_across_levels
config cfg rpn_proposal_max_num self max_num
config cfg fpn_num_outs self num_levels
config cfg feature_shapes self feature_shapes
config cfg rpn_nms_pre self num_pre
config cfg rpn_min_bbox_min_size self min_box_size
config cfg rpn_nms_thr self nms_thr
config cfg rpn_nms_post self nms_post
config cfg rpn_nms_across_levels self nms_across_levels
config cfg rpn_max_num self max_num
P Minimum self min self num_pre|(shp|shp|3) k_num
min self num_pre|(shp|shp|3) k_num total_max_topk_input
min self num_pre|(shp|shp|3) k_num self topK_stage1
min self num_pre|(shp|shp|3) k_num self topK_shape
range i cls_score_list
range i bbox_pred_list
self squeeze rpn_cls_score_total rpn_cls_score_i cls_score_list
self squeeze rpn_bbox_pred_total rpn_bbox_pred_i bbox_pred_list
cls_score_list|(rpn_cls_score_i|) cls_score_list cls_score_list
bbox_pred_list|(rpn_bbox_pred_i|) bbox_pred_list bbox_pred_list
self get_bboxes_single cls_score_list|bbox_pred_list|anchor_list masks masks_tuple
self nms proposals_decode mask_valid mlvl_mask
mlvl_proposals|(proposals|) mlvl_proposals mlvl_proposals
mlvl_mask|(mask_valid|) mlvl_mask mlvl_mask
super DenseNoTranpose|self __init__
Parameter initializer weight_init|[input_channels|output_channels]|mstype float16 self weight
Parameter initializer [output_channels]|mstype float16 to_tensor self bias
P BiasAdd self bias_add
self bias_add self matmul x|self weight output
super FpnCls|self __init__
input_channels|pool_size|pool_size representation_size
(output_channels|representation_size) shape_0
initializer shape weights_0
(output_channels|output_channels) shape_1
initializer shape weights_1
DenseNoTranpose representation_size|output_channels|weights_0 self shared_fc_0
DenseNoTranpose output_channels|output_channels|weights_1 self shared_fc_1
DenseNoTranpose output_channels|num_classes|cls_weight self cls_scores
DenseNoTranpose output_channels|num_classes|4|reg_weight self reg_scores
P ReLU self relu
P Flatten self flatten
self flatten x x
self relu self shared_fc_0 x x
self relu self shared_fc_1 x x
self cls_scores x cls_scores
self reg_scores x reg_scores
(0 |0 |0 |0 ) target_means
(0 1|0 1|0 2|0 2) target_stds
super RcnnCls|self __init__
config cfg
Tensor np array cfg rcnn_loss_cls_weight astype np float16 self rcnn_loss_cls_weight
Tensor np array cfg rcnn_loss_reg_weight astype np float16 self rcnn_loss_reg_weight
cfg rcnn_fc_out_channels self rcnn_fc_out_channels
target_means self target_means
target_stds self target_stds
num_classes self num_classes
cfg rcnn_in_channels self in_channels
batch_size self train_batch_size
cfg test_batch_size self test_batch_size
FpnCls self in_channels|self rcnn_fc_out_channels|self num_classes|cfg roi_layer self fpn_cls
P LogicalAnd self logicaland
P SoftmaxCrossEntropyWithLogits self loss_cls
P SigmoidCrossEntropyWithLogits self loss_mask
P Reshape self reshape
P OneHot self onehot
P Greater self greater
P Cast self cast
P ReduceSum self sum_loss
P Tile self tile
P ExpandDims self expandims
P GatherNd self gather
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
Tensor 1 0|mstype float16 self value
(cfg num_expected_pos_stage2|cfg num_expected_neg_stage2)|batch_size self num_bboxes
np ones (self num_bboxes|self num_classes) rmv_first
np zeros (self num_bboxes|) rmv_first
Tensor rmv_first astype np float16 self rmv_first_tensor
cfg rpn_max_num|cfg test_batch_size self num_bboxes_test
self fpn_cls featuremap x_reg
self cast self logicaland self greater labels|0 bbox_weights
self cast self onehot labels|self num_classes|self on_value|self off_value labels
self tile self expandims bbox_targets|1 bbox_targets
(loss_cls|loss_reg) out
(x_cls|x_reg) out
self loss_cls cls_score|labels _
self cast weights|mstype float16 weights
loss_cls|weights loss_cls
self sum_loss loss_cls|(0|)|self sum_loss weights|(0|) loss_cls
bbox_weights|self rmv_first_tensor bbox_weights
self reshape bbox_pred|(self num_bboxes|-1|4) pos_bbox_pred
self loss_bbox pos_bbox_pred|bbox_targets loss_reg
self sum_loss loss_reg|(2|) loss_reg
loss_reg|bbox_weights loss_reg
loss_reg|self sum_loss weights|(0|) loss_reg
self sum_loss loss_reg|(0|1) loss_reg
Parameter initializer weight_init|[input_channels|output_channels]|mstype float16 self weight loss_cls
self bias_add self matmul x|self weight output shape_1
input_channels|pool_size|pool_size representation_size shape_0
self flatten x x out
self relu self shared_fc_0 x x out
self relu self shared_fc_1 x x out
(0 |0 |0 |0 ) target_means self target_means
(0 1|0 1|0 2|0 2) target_stds self target_stds
config cfg rcnn_fc_out_channels self rcnn_fc_out_channels
config cfg rcnn_in_channels self in_channels
config cfg test_batch_size self test_batch_size
config cfg rpn_max_num|cfg test_batch_size self num_bboxes_test
P SoftmaxCrossEntropyWithLogits self loss_cls out
P SoftmaxCrossEntropyWithLogits self loss_cls loss_cls
self fpn_cls featuremap x_reg out
self cast self logicaland self greater labels|0 bbox_weights rmv_first_tensor bbox_weights
self cast self logicaland self greater labels|0 bbox_weights loss_reg
self cast weights|mstype float16 weights loss_cls
self cast weights|mstype float16 weights rmv_first_tensor bbox_weights
loss_cls|weights loss_cls loss_cls
bbox_weights|self rmv_first_tensor bbox_weights rmv_first_tensor bbox_weights
bbox_weights|self rmv_first_tensor bbox_weights loss_reg
self loss_bbox pos_bbox_pred|bbox_targets loss_reg loss_reg
self loss_bbox pos_bbox_pred|bbox_targets loss_reg sum_loss weights|(0|) loss_reg
self sum_loss loss_reg|(2|) loss_reg loss_reg
self sum_loss loss_reg|(2|) loss_reg sum_loss weights|(0|) loss_reg
loss_reg|bbox_weights loss_reg loss_reg
loss_reg|bbox_weights loss_reg sum_loss weights|(0|) loss_reg
loss_reg|self sum_loss weights|(0|) loss_reg sum_loss weights|(0|) loss_reg
resnet50 backbone
Mask_Rcnn_Resnet50 net
super Mask_Rcnn_Resnet50|self __init__
config batch_size self train_batch_size
config num_classes self num_classes
config anchor_scales self anchor_scales
config anchor_ratios self anchor_ratios
config anchor_strides self anchor_strides
tuple config rcnn_target_means self target_means
tuple config rcnn_target_stds self target_stds
list self anchor_base_sizes
self anchor_base_sizes anchor_base
len self anchor_ratios|len(self anchor_scales) self num_anchors
config feature_shapes featmap_sizes
self get_anchors featmap_sizes self anchor_list
Tensor np ones (self train_batch_size|config num_gts) astype(np uint8) self gt_labels_stage1
self proposal_generator set_train_local config|True
self proposal_generator_test set_train_local config|False
self roi_align set_train_local config|True
self roi_align_mask set_train_local config|True
self roi_align_test set_train_local config|False
self roi_align_mask_test set_train_local config|False
RcnnCls config|self train_batch_size|self num_classes self rcnn_cls
RcnnMask config|self train_batch_size|self num_classes self rcnn_mask
P Squeeze self squeeze
P Cast self cast
P Reshape self reshape
P Select self select
P Greater self greater
P Transpose self transpose
config test_batch_size self test_batch_size
P Tile self tile
P GatherNd self gather
config rpn_max_num self rpn_max_num
Tensor np zeros (self rpn_max_num|3) astype(np float16) self zeros_for_nms
np ones (self rpn_max_num|1) astype(np bool) self ones_mask
np zeros (self rpn_max_num|1) astype(np bool) self zeros_mask
Tensor np ones (self rpn_max_num|1) astype(np float16)|config test_score_thr self test_score_thresh
Tensor np ones (self rpn_max_num|1) astype(np float16)|0 self test_score_zeros
Tensor np ones (self rpn_max_num|4) astype(np float16)|-1 self test_box_zeros
Tensor np ones (self rpn_max_num|1) astype(np float16)|config test_iou_thr self test_iou_thr
config test_max_per_img self test_max_per_img
P NMSWithMask config test_iou_thr self nms_test
P LogicalAnd self logicand
P OnesLike self oneslike
self test_batch_size|self rpn_max_num self test_num_proposal
min self num_classes-2|55 self concat_start
(self num_classes-1) self concat_end
Tensor np concatenate roi_align_index self roi_align_index_tensor
Tensor np concatenate roi_align_index_test self roi_align_index_test_tensor
Tensor np concatenate roi_align_index_pos self roi_align_index_tensor_pos
Tensor np array config rcnn_loss_cls_weight astype np float16 self rcnn_loss_cls_weight
Tensor np array config rcnn_loss_reg_weight astype np float16 self rcnn_loss_reg_weight
Tensor np array config rcnn_loss_mask_fb_weight astype np float16 self rcnn_loss_mask_fb_weight
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
P OneHot self onehot
P ReduceSum self reducesum
P Sigmoid self sigmoid
P ExpandDims self expand_dims
Tensor np zeros (self rpn_max_num|28|28) astype(np float16) self test_mask_fb_zeros
Tensor 1 0|mstype float16 self value
self backbone img_data x
self fpn_ncek x x
self proposal_generator cls_score|bbox_pred|self anchor_list proposal_mask
self proposal_generator_test cls_score|bbox_pred|self anchor_list proposal_mask
self cast gt_labels|mstype int32 gt_labels
self cast gt_valids|mstype int32 gt_valids
range i
self squeeze gt_bboxes gt_bboxes_i
self squeeze gt_labels gt_labels_i
self cast gt_labels_i|mstype uint8 gt_labels_i
self squeeze gt_valids gt_valids_i
self cast gt_valids_i|mstype bool_ gt_valids_i
self squeeze gt_masks gt_masks_i
self cast gt_masks_i|mstype bool_ gt_masks_i
 pos_mask
(bboxes|) bboxes_tuple
(deltas|) deltas_tuple
(labels|) labels_tuple
(mask|) mask_tuple
(pos_bboxes|) pos_bboxes_tuple
(pos_mask_fb|) pos_mask_fb_tuple
(pos_labels|) pos_labels_tuple
(pos_mask|) pos_mask_tuple
self concat deltas_tuple bbox_targets
self concat labels_tuple rcnn_labels
F stop_gradient bbox_targets bbox_targets
F stop_gradient rcnn_labels rcnn_labels
self cast rcnn_labels|mstype int32 rcnn_labels
self concat pos_mask_fb_tuple rcnn_pos_masks_fb
F stop_gradient rcnn_pos_masks_fb rcnn_pos_masks_fb
self concat pos_labels_tuple rcnn_pos_labels
F stop_gradient rcnn_pos_labels rcnn_pos_labels
self cast rcnn_pos_labels|mstype int32 rcnn_pos_labels
proposal_mask mask_tuple
proposal_mask bbox_targets
proposal_mask rcnn_labels
proposal_mask rcnn_pos_masks_fb
proposal_mask rcnn_pos_labels
proposal p_i
(p_i|) bboxes_tuple
self concat bboxes_tuple bboxes_all
self concat pos_bboxes_tuple pos_bboxes_all
bboxes_tuple bboxes_all
pos_bboxes_tuple pos_bboxes_all
self concat_1 (self roi_align_index_tensor|bboxes_all) rois
self concat_1 (self roi_align_index_tensor_pos|pos_bboxes_all) pos_rois
self cast pos_rois|mstype float32 pos_rois
F stop_gradient pos_rois pos_rois
self concat_1 (self roi_align_index_test_tensor|bboxes_all) rois
self cast rois|mstype float32 rois
F stop_gradient rois rois
self cast x|mstype float32
self cast roi_feats|mstype float16 roi_feats
self concat mask_tuple rcnn_masks
F stop_gradient rcnn_masks rcnn_masks
self squeeze self cast rcnn_masks|mstype bool_ rcnn_mask_squeeze
self concat pos_mask_tuple rcnn_pos_masks
F stop_gradient rcnn_pos_masks rcnn_pos_masks
self squeeze self cast rcnn_pos_masks|mstype bool_ rcnn_pos_mask_squeeze
self cast roi_feats_mask|mstype float16 roi_feats_mask
self rcnn_loss_cls_weight|rcnn_cls_loss|self rcnn_loss_reg_weight|rcnn_reg_loss| rcnn_loss
(rpn_loss|rcnn_loss|rpn_cls_loss|rpn_reg_loss|rcnn_cls_loss|rcnn_reg_loss|rcnn_mask_fb_loss) output
self rcnn_mask_test x|bboxes_all|rcnn_cls_loss|rcnn_reg_loss mask_fb_pred_all
self softmax cls_logits|self value scores
self sigmoid mask_fb_pred_all mask_fb_logits
i|4 k
self squeeze reg_logits reg_logits_i
self decode rois|reg_logits_i out_boxes_i
(out_boxes_i|) boxes_all
self split img_metas img_metas_all
self split scores scores_all
self split self cast mask_logits|mstype int32 mask_all
self split mask_fb_logits mask_fb_all
self split_shape self squeeze img_metas_all i scale
scale scale_h
scale scale_w
range j
self split boxes_all j boxes_tmp
boxes_tmp i out_boxes_h
boxes_tmp i out_boxes_w
(self select(self bbox_mask|out_boxes_w|out_boxes_h)) boxes_tuple
(boxes_tuple|) boxes_all_with_batchsize
self multiclass_nms boxes_all_with_batchsize|scores_all|mask_all|mask_fb_all output
boxes_all i bboxes
scores_all i scores
self cast mask_all i masks
mask_fb_all i masks_fb
self split_fb_mask masks_fb _mask_fb_all
range self num_classes j
j|1 k
scores _cls_scores
self squeeze bboxes k _bboxes
self reshape masks|(self rpn_max_num|1) _mask_o
self squeeze _mask_fb_all k _masks_fb
self greater _cls_scores|self test_score_thresh cls_mask
self logicand _mask_o|cls_mask _mask
self cast self tile self cast _mask|mstype int32 _reg_mask
self select _reg_mask|_bboxes|self test_box_zeros _bboxes
self expand_dims _mask|-1 _fb_mask
self cast self tile self cast _fb_mask|mstype int32 _mask_fb_mask
self select _mask_fb_mask|_masks_fb|self test_mask_fb_zeros _masks_fb
self select _mask|_cls_scores|self test_score_zeros _cls_scores
self squeeze _cls_scores __cls_scores
self test_topk __cls_scores|self rpn_max_num topk_inds
self reshape topk_inds|(self rpn_max_num|1) topk_inds
self reshape scores_sorted|(self rpn_max_num|1) scores_sorted
self gather _bboxes|topk_inds _bboxes_sorted
self gather _masks_fb|topk_inds _mask_fb_sorted
self gather _mask|topk_inds _mask_sorted
self tile scores_sorted|(1|4) scores_sorted
self concat_1 (_bboxes_sorted|scores_sorted) cls_dets
P Slice cls_dets|(0|0) cls_dets
self nms_test cls_dets _mask_nms
self reshape _index|(self rpn_max_num|1) _index
self reshape _mask_nms|(self rpn_max_num|1) _mask_nms
self gather _mask_sorted|_index _mask_n
self logicand _mask_n|_mask_nms _mask_n
self gather _mask_fb_sorted|_index _mask_fb
self oneslike _index|j cls_labels
(cls_dets|) res_boxes_tuple
(cls_labels|) res_labels_tuple
(_mask_n|) res_masks_tuple
(_mask_fb|) res_masks_fb_tuple
self concat res_boxes_tuple res_boxes_start
self concat res_labels_tuple res_labels_start
self concat res_masks_tuple res_masks_start
self concat res_masks_fb_tuple res_masks_fb_start
self concat res_boxes_tuple res_boxes_end
self concat res_labels_tuple res_labels_end
self concat res_masks_tuple res_masks_end
self concat res_masks_fb_tuple res_masks_fb_end
self concat (res_boxes_start|res_boxes_end) res_boxes
self concat (res_labels_start|res_labels_end) res_labels
self concat (res_masks_start|res_masks_end) res_masks
self concat (res_masks_fb_start|res_masks_fb_end) res_masks_fb
(self num_classes-1)|self rpn_max_num reshape_size
self reshape res_boxes|(1|reshape_size|5) res_boxes
self reshape res_labels|(1|reshape_size|1) res_labels
self reshape res_masks|(1|reshape_size|1) res_masks
self reshape res_masks_fb|(1|reshape_size|28|28) res_masks_fb
(res_boxes|) all_bboxes
(res_labels|) all_labels
(res_masks|) all_masks
(res_masks_fb|) all_masks_fb
self concat all_bboxes all_bboxes
self concat all_labels all_labels
self concat all_masks all_masks
self concat all_masks_fb all_masks_fb
len featmap_sizes num_levels
self anchor_generators i anchors
(Tensor(anchors astype(np float16))) multi_level_anchors
self softmax cls_pred|self value cls_scores
self split cls_scores cls_scores_all
self reshape reg_pred|(-1|self num_classes|4) reg_pred
self split reg_pred reg_pred_all
self split rois rois_all
self argmax_with_value cls_scores_all i _
self expand_dims cls_score_max_index|-1 cls_score_max_index
self tile cls_score_max_index|(1|1|4) cls_score_max_index
reg_pred_all i reg_pred_max
self reducesum reg_pred_max|1 reg_pred_max
self decode rois_all i out_boxes_i
(out_boxes_i|) boxes_tuple
self concat boxes_tuple boxes_all
self concat_1 (self roi_align_index_test_tensor|boxes_all) boxes_rois
self cast boxes_rois|mstype float32 boxes_rois
self cast roi_feats_mask_test|mstype float16 roi_feats_mask_test
self rcnn_mask roi_feats_mask_test mask_fb_pred_all
self proposal_generator set_train_local config test_batch_size self test_batch_size
self proposal_generator set_train_local config rpn_max_num self rpn_max_num
self proposal_generator set_train_local config test_max_per_img self test_max_per_img
self proposal_generator set_train_local  pos_mask
self proposal_generator_test set_train_local config test_batch_size self test_batch_size
self proposal_generator_test set_train_local config rpn_max_num self rpn_max_num
self proposal_generator_test set_train_local config test_max_per_img self test_max_per_img
self proposal_generator_test set_train_local  pos_mask
self proposal_generator_test set_train_local F stop_gradient bbox_targets bbox_targets
self proposal_generator_test set_train_local F stop_gradient rcnn_labels rcnn_labels
self proposal_generator_test set_train_local F stop_gradient rcnn_pos_masks_fb rcnn_pos_masks_fb
self proposal_generator_test set_train_local F stop_gradient rcnn_pos_labels rcnn_pos_labels
self proposal_generator_test set_train_local F stop_gradient pos_rois pos_rois
self proposal_generator_test set_train_local F stop_gradient rois rois
self proposal_generator_test set_train_local F stop_gradient rcnn_masks rcnn_masks
self proposal_generator_test set_train_local F stop_gradient rcnn_pos_masks rcnn_pos_masks
self roi_align set_train_local config test_batch_size self test_batch_size
self roi_align set_train_local config rpn_max_num self rpn_max_num
self roi_align set_train_local config test_max_per_img self test_max_per_img
self roi_align set_train_local  pos_mask
self roi_align_mask set_train_local config test_batch_size self test_batch_size
self roi_align_mask set_train_local config rpn_max_num self rpn_max_num
self roi_align_mask set_train_local config test_max_per_img self test_max_per_img
self roi_align_mask set_train_local  pos_mask
self roi_align_test set_train_local config test_batch_size self test_batch_size
self roi_align_test set_train_local config rpn_max_num self rpn_max_num
self roi_align_test set_train_local config test_max_per_img self test_max_per_img
self roi_align_test set_train_local  pos_mask
self roi_align_test set_train_local F stop_gradient bbox_targets bbox_targets
self roi_align_test set_train_local F stop_gradient rcnn_labels rcnn_labels
self roi_align_test set_train_local F stop_gradient rcnn_pos_masks_fb rcnn_pos_masks_fb
self roi_align_test set_train_local F stop_gradient rcnn_pos_labels rcnn_pos_labels
self roi_align_test set_train_local F stop_gradient pos_rois pos_rois
self roi_align_test set_train_local F stop_gradient rois rois
self roi_align_test set_train_local F stop_gradient rcnn_masks rcnn_masks
self roi_align_test set_train_local F stop_gradient rcnn_pos_masks rcnn_pos_masks
self roi_align_mask_test set_train_local config test_batch_size self test_batch_size
self roi_align_mask_test set_train_local config rpn_max_num self rpn_max_num
self roi_align_mask_test set_train_local config test_max_per_img self test_max_per_img
self roi_align_mask_test set_train_local  pos_mask
self roi_align_mask_test set_train_local F stop_gradient bbox_targets bbox_targets
self roi_align_mask_test set_train_local F stop_gradient rcnn_labels rcnn_labels
self roi_align_mask_test set_train_local F stop_gradient rcnn_pos_masks_fb rcnn_pos_masks_fb
self roi_align_mask_test set_train_local F stop_gradient rcnn_pos_labels rcnn_pos_labels
self roi_align_mask_test set_train_local F stop_gradient pos_rois pos_rois
self roi_align_mask_test set_train_local F stop_gradient rois rois
self roi_align_mask_test set_train_local F stop_gradient rcnn_masks rcnn_masks
self roi_align_mask_test set_train_local F stop_gradient rcnn_pos_masks rcnn_pos_masks
RcnnCls config|self train_batch_size|self num_classes self rcnn_cls output
RcnnMask config|self train_batch_size|self num_classes self rcnn_mask output
self proposal_generator cls_score|bbox_pred|self anchor_list proposal_mask mask_tuple
self proposal_generator cls_score|bbox_pred|self anchor_list proposal_mask bbox_targets
self proposal_generator cls_score|bbox_pred|self anchor_list proposal_mask rcnn_labels
self proposal_generator cls_score|bbox_pred|self anchor_list proposal_mask rcnn_pos_masks_fb
self proposal_generator cls_score|bbox_pred|self anchor_list proposal_mask rcnn_pos_labels
self proposal_generator_test cls_score|bbox_pred|self anchor_list proposal_mask mask_tuple
self proposal_generator_test cls_score|bbox_pred|self anchor_list proposal_mask bbox_targets
self proposal_generator_test cls_score|bbox_pred|self anchor_list proposal_mask rcnn_labels
self proposal_generator_test cls_score|bbox_pred|self anchor_list proposal_mask rcnn_pos_masks_fb
self proposal_generator_test cls_score|bbox_pred|self anchor_list proposal_mask rcnn_pos_labels
range i bboxes_tuple
range i k
range i boxes_all
range i boxes_tuple
 pos_mask pos_mask_tuple
(bboxes|) bboxes_tuple bboxes_all
(pos_bboxes|) pos_bboxes_tuple pos_bboxes_all
proposal p_i bboxes_tuple
(p_i|) bboxes_tuple bboxes_all
self rcnn_loss_cls_weight|rcnn_cls_loss|self rcnn_loss_reg_weight|rcnn_reg_loss| rcnn_loss output
self softmax cls_logits|self value scores _cls_scores
self decode rois|reg_logits_i out_boxes_i boxes_all
self decode rois|reg_logits_i out_boxes_i boxes_tuple
(out_boxes_i|) boxes_all i bboxes
self split scores scores_all i scores
self split mask_fb_logits mask_fb_all i masks_fb
self split_shape self squeeze img_metas_all i scale scale_h
self split_shape self squeeze img_metas_all i scale scale_w
range j k
self split boxes_all j boxes_tmp i out_boxes_h
self split boxes_all j boxes_tmp i out_boxes_w
(self select(self bbox_mask|out_boxes_w|out_boxes_h)) boxes_tuple boxes_all_with_batchsize
scores_all i scores _cls_scores
self cast mask_all i masks all_masks
mask_fb_all i masks_fb all_masks_fb
range self num_classes j k
self squeeze _mask_fb_all k _masks_fb all_masks_fb
self select _mask_fb_mask|_masks_fb|self test_mask_fb_zeros _masks_fb all_masks_fb
self concat_1 (_bboxes_sorted|scores_sorted) cls_dets res_boxes_tuple
P Slice cls_dets|(0|0) cls_dets res_boxes_tuple
self gather _mask_sorted|_index _mask_n res_masks_tuple
self logicand _mask_n|_mask_nms _mask_n res_masks_tuple
self gather _mask_fb_sorted|_index _mask_fb res_masks_fb_tuple
self oneslike _index|j cls_labels res_labels_tuple
self concat (res_boxes_start|res_boxes_end) res_boxes all_bboxes
self concat (res_labels_start|res_labels_end) res_labels all_labels
self concat (res_masks_start|res_masks_end) res_masks all_masks
self concat (res_masks_fb_start|res_masks_fb_end) res_masks_fb all_masks_fb
self reshape res_boxes|(1|reshape_size|5) res_boxes all_bboxes
self reshape res_labels|(1|reshape_size|1) res_labels all_labels
self reshape res_masks|(1|reshape_size|1) res_masks all_masks
self reshape res_masks_fb|(1|reshape_size|28|28) res_masks_fb all_masks_fb
self split reg_pred reg_pred_all i reg_pred_max
self decode rois_all i out_boxes_i boxes_tuple
base_size self base_size
np array scales self scales
np array ratios self ratios
scale_major self scale_major
ctr self ctr
self gen_base_anchors self base_anchors
self base_size w
self base_size h
self ctr y_ctr
np sqrt self ratios h_ratios
(w|w_ratios) reshape ws
(h|h_ratios) reshape hs
(w|self scales) reshape ws
(h|self scales) reshape hs
np stack base_anchors
np repeat y|len(x) yy
self base_anchors base_anchors
featmap_size feat_w
np arange 0|feat_w|stride shift_x
np arange 0|feat_h|stride shift_y
self _meshgrid shift_x|shift_y shift_yy
np stack [shift_xx|shift_yy|shift_xx|shift_yy]|axis shifts
shifts astype base_anchors dtype shifts
base_anchors all_anchors
all_anchors reshape -1|4 all_anchors
self gen_base_anchors self base_anchors all_anchors
self base_size w reshape ws
self base_size w scales) reshape ws
self base_size h reshape hs
self base_size h scales) reshape hs
np sqrt self ratios h_ratios reshape hs
np stack base_anchors all_anchors
self base_anchors base_anchors all_anchors
np stack [shift_xx|shift_yy|shift_xx|shift_yy]|axis shifts astype base_anchors dtype shifts
base_anchors all_anchors reshape -1|4 all_anchors
Tensor np array np zeros shape astype np float32 astype np float16
(out_channels|in_channels|kernel_size|kernel_size) shape
initializer shape weights
(out_channels|) shape_bias
bias_init_zeros shape_bias biass
kernel_size|stride kernel_size
FeatPyramidNeck [100|200|300]|50|4 neck
neck input_data x
super FeatPyramidNeck|self __init__
num_outs self num_outs
in_channels self in_channels
len self in_channels self fpn_layer
len in_channels
enumerate _|channel
self lateral_convs_list_ append l_conv
self fpn_convs_ append fpn_conv
nn layer CellList self lateral_convs_list_ self lateral_convs_list
nn layer CellList self fpn_convs_ self fpn_convs_list
P ResizeBilinear (48|80) self interpolate1
P ResizeBilinear (96|160) self interpolate2
P ResizeBilinear (192|320) self interpolate3
P Cast self cast
range i
 self lateral_convs_list i inputs i x
(x|) y
y|(x|self cast(self interpolate1(y[self fpn_layer-4]))) y
y|(x|self cast(self interpolate2(y[self fpn_layer-3]))) y
y|(x|self cast(self interpolate3(y[self fpn_layer-2]))) y
range self fpn_layer i
z|(y[i]|) z
outs| self fpn_convs_list i z i outs
range self num_outs i
outs|(self maxpool outs) outs
kernel_size|stride kernel_size kernel_size
FeatPyramidNeck [100|200|300]|50|4 neck input_data x
neck input_data x y
neck input_data x cast(self interpolate1(y[self fpn_layer-4]))) y
neck input_data x cast(self interpolate2(y[self fpn_layer-3]))) y
neck input_data x cast(self interpolate3(y[self fpn_layer-2]))) y
 self lateral_convs_list i inputs i x y
(self lateral_convs_list i inputs i x cast(self interpolate1(y[self fpn_layer-4]))) y
(self lateral_convs_list i inputs i x cast(self interpolate2(y[self fpn_layer-3]))) y
(self lateral_convs_list i inputs i x cast(self interpolate3(y[self fpn_layer-2]))) y
(x|) y cast(self interpolate1(y[self fpn_layer-4]))) y
(x|) y cast(self interpolate2(y[self fpn_layer-3]))) y
(x|) y cast(self interpolate3(y[self fpn_layer-2]))) y
y|(x|self cast(self interpolate1(y[self fpn_layer-4]))) y cast(self interpolate1(y[self fpn_layer-4]))) y
y|(x|self cast(self interpolate1(y[self fpn_layer-4]))) y cast(self interpolate2(y[self fpn_layer-3]))) y
y|(x|self cast(self interpolate1(y[self fpn_layer-4]))) y cast(self interpolate3(y[self fpn_layer-2]))) y
y|(x|self cast(self interpolate2(y[self fpn_layer-3]))) y cast(self interpolate2(y[self fpn_layer-3]))) y
y|(x|self cast(self interpolate2(y[self fpn_layer-3]))) y cast(self interpolate3(y[self fpn_layer-2]))) y
y|(x|self cast(self interpolate3(y[self fpn_layer-2]))) y cast(self interpolate3(y[self fpn_layer-2]))) y
z|(y[i]|) z z
outs| self fpn_convs_list i z i outs fpn_convs_list i z i outs
outs|(self fpn_convs_list i z i outs maxpool outs) outs
outs|(self maxpool outs) outs maxpool outs) outs
BboxAssignSample config|2|1024|True
super BboxAssignSample|self __init__
config cfg
batch_size self batch_size
Tensor cfg neg_iou_thr|mstype float16 self neg_iou_thr
Tensor cfg pos_iou_thr|mstype float16 self pos_iou_thr
Tensor cfg min_pos_iou|mstype float16 self min_pos_iou
Tensor 0 0|mstype float16 self zero_thr
num_bboxes self num_bboxes
cfg num_gts self num_gts
cfg num_expected_pos self num_expected_pos
cfg num_expected_neg self num_expected_neg
add_gt_as_proposals self add_gt_as_proposals
Tensor np arange 1|self num_gts|1 self label_inds
P ReduceSum self sum_inds
P IOU self iou
P GreaterEqual self greaterequal
P Greater self greater
P Select self select
P GatherNd self gatherND
P Squeeze self squeeze
P Cast self cast
P LogicalAnd self logicaland
P Less self less
P RandomChoiceWithMask self num_expected_pos self random_choice_with_mask_pos
P RandomChoiceWithMask self num_expected_neg self random_choice_with_mask_neg
P Reshape self reshape
P Equal self equal
P BoundingBoxEncode means self bounding_box_encode
P ScatterNdUpdate self scatterNdUpdate
P ScatterNd self scatterNd
P LogicalNot self logicalnot
P Tile self tile
P ZerosLike self zeros_like
Tensor np array -1|np ones num_bboxes self assigned_gt_inds
Tensor np array np zeros num_bboxes self assigned_gt_zeros
Tensor np array np ones num_bboxes self assigned_gt_ones
Tensor np array -1|np ones num_bboxes self assigned_gt_ignores
Tensor np array np ones self num_expected_pos self assigned_pos_ones
Tensor np array np ones self num_expected_neg-self num_expected_pos self check_neg_mask
Tensor np arange self num_expected_pos astype np float16 self range_pos_size
Tensor np array -1|np ones((self num_gts|4)) self check_gt_one
Tensor np array -2|np ones((self num_bboxes|4)) self check_anchor_two
self iou bboxes|gt_bboxes_i overlaps
self max_gt overlaps max_overlaps_w_gt
self max_anchor overlaps max_overlaps_w_ac
self select neg_sample_iou_mask|self assigned_gt_zeros|self assigned_gt_inds assigned_gt_inds2
self greaterequal max_overlaps_w_gt|self pos_iou_thr pos_sample_iou_mask
assigned_gt_inds3 assigned_gt_inds4
range j
max_overlaps_w_ac max_overlaps_w_ac_j
self squeeze overlaps overlaps_w_gt_j
self select pos_mask_j|self assigned_gt_ones|j|assigned_gt_inds4 assigned_gt_inds4
self select valid_mask|assigned_gt_inds4|self assigned_gt_ignores assigned_gt_inds5
self random_choice_with_mask_pos self greater assigned_gt_inds5|0 valid_pos_index
self cast self greater assigned_gt_inds5|0 pos_check_valid
self sum_inds pos_check_valid|-1 pos_check_valid
self less self range_pos_size|pos_check_valid valid_pos_index
pos_index|self reshape(self cast(valid_pos_index|mstype int32)) pos_index
self gatherND assigned_gt_inds5|pos_index-self assigned_pos_ones pos_assigned_gt_index
pos_assigned_gt_index|self cast(valid_pos_index|mstype int32) pos_assigned_gt_index
self reshape pos_assigned_gt_index|(self num_expected_pos|1) pos_assigned_gt_index
self random_choice_with_mask_neg self equal assigned_gt_inds5|0 valid_neg_index
self cast self logicalnot valid_pos_index num_pos
self sum_inds num_pos|-1 num_pos
self less self range_pos_size|num_pos unvalid_pos_index
self logicaland self concat (self check_neg_mask|unvalid_pos_index) valid_neg_index
self gatherND bboxes|pos_index pos_bboxes_
self gatherND gt_bboxes_i|pos_assigned_gt_index pos_gt_bboxes_
self gatherND gt_labels_i|pos_assigned_gt_index pos_gt_labels
self bounding_box_encode pos_bboxes_|pos_gt_bboxes_ pos_bbox_targets_
self cast valid_pos_index|mstype int32 valid_pos_index
self cast valid_neg_index|mstype int32 valid_neg_index
self scatterNd pos_index|pos_bbox_targets_|(self num_bboxes|4) bbox_targets_total
self scatterNd pos_index|valid_pos_index|(self num_bboxes|) bbox_weights_total
self scatterNd pos_index|pos_gt_labels|(self num_bboxes|) labels_total
self concat (pos_index|neg_index) total_index
self concat (valid_pos_index|valid_neg_index) total_valid_index
self scatterNd total_index|total_valid_index|(self num_bboxes|) label_weights_total
self cast bbox_weights_total|mstype bool_
self cast label_weights_total|mstype bool_
BboxAssignSample config cfg
config cfg num_gts self num_gts
config cfg num_expected_pos self num_expected_pos
config cfg num_expected_neg self num_expected_neg
self max_anchor overlaps max_overlaps_w_ac max_overlaps_w_ac_j
pos_index|self reshape(self cast(valid_pos_index|mstype int32)) pos_index reshape(self cast(valid_pos_index|mstype int32)) pos_index
self gatherND assigned_gt_inds5|pos_index-self assigned_pos_ones pos_assigned_gt_index cast(valid_pos_index|mstype int32) pos_assigned_gt_index
pos_assigned_gt_index|self cast(valid_pos_index|mstype int32) pos_assigned_gt_index cast(valid_pos_index|mstype int32) pos_assigned_gt_index
Tensor np array np ones shape astype np float32|0 01 astype np float16
(out_channels|in_channels|kernel_size|kernel_size) shape
weight_init_ones shape weights
kernel_size|stride kernel_size
Tensor np array np ones out_chls astype np float16 gamma_init
Tensor np array np ones out_chls|0 astype(np float16) beta_init
Tensor np array np ones out_chls|0 astype(np float16) moving_mean_init
Tensor np array np ones out_chls astype np float16 moving_var_init
beta_init|moving_mean_init beta_init
super ResNetFea|self __init__
_BatchNorm2dInit 64|affine self bn1
P ReLU self relu
weights_update self weights_update
in_channels in_channel
out_channels out_channel
bn_training training
layers append resblk
range _
nn SequentialCell layers
self conv1 x x
self bn1 x x
self relu x x
self maxpool x c1
self layer1 c1 c2
c2 identity
F stop_gradient c2 identity
self layer2 identity c3
self layer3 c3 c4
self layer4 c4 c5
super ResidualBlockUsing|self __init__
weights_update self affine
out_channels||self expansion out_chls
_BatchNorm2dInit out_chls|momentum self bn1
_BatchNorm2dInit out_chls|momentum self bn2
_BatchNorm2dInit out_channels|momentum self bn3
self bn1 set_train self bn1
self bn2 set_train self bn2
self bn3 set_train self bn3
down_sample self downsample
self bn_down_sample set_train self bn_down_sample
P TensorAdd self add
x identity
self conv1 x out
self bn1 out out
self relu out out
self conv2 out out
self bn2 out out
self conv3 out out
self bn3 out out
self conv_down_sample identity identity
self bn_down_sample identity identity
self add out|identity out
kernel_size|stride kernel_size kernel_size
Tensor np array np ones out_chls|0 astype(np float16) beta_init beta_init
Tensor np array np ones out_chls|0 astype(np float16) moving_mean_init beta_init
beta_init|moving_mean_init beta_init beta_init
self conv1 x x identity
self bn1 x x identity
self relu x x identity
self layer1 c1 c2 identity
out_channels||self expansion out_chls self bn1
out_channels||self expansion out_chls self bn2
(out_channels|in_channels|kernel_size|kernel_size) shape
initializer shape weights
(out_channels|) shape_bias
Tensor np array np zeros shape_bias astype np float16 bias
kernel_size|stride kernel_size
super FpnMask|self __init__
P ReLU self mask_relu1
P ReLU self mask_relu2
P ReLU self mask_relu3
P ReLU self mask_relu4
P ReLU self mask_relu5
self mask_conv1 x x
self mask_relu1 x x
self mask_conv2 x x
self mask_relu2 x x
self mask_conv3 x x
self mask_relu3 x x
self mask_conv4 x x
self mask_relu4 x x
self mask_deconv5 x x
self mask_relu5 x x
self mask_conv6 x x
(0 |0 |0 |0 ) target_means
(0 1|0 1|0 2|0 2) target_stds
super RcnnMask|self __init__
config cfg
Tensor np array cfg rcnn_loss_mask_fb_weight astype np float16 self rcnn_loss_mask_fb_weight
cfg rcnn_mask_out_channels self rcnn_mask_out_channels
target_means self target_means
target_stds self target_stds
num_classes self num_classes
cfg rcnn_in_channels self in_channels
FpnMask self in_channels|self rcnn_mask_out_channels|self num_classes self fpn_mask
P LogicalAnd self logicaland
P SigmoidCrossEntropyWithLogits self loss_mask
P OneHot self onehot
P Greater self greater
P Cast self cast
P ReduceSum self sum_loss
P Tile self tile
P ExpandDims self expandims
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
cfg num_expected_pos_stage2|batch_size self num_bboxes
np ones (self num_bboxes|self num_classes) rmv_first
np zeros (self num_bboxes|) rmv_first
Tensor rmv_first astype np float16 self rmv_first_tensor
P ReduceMean self mean_loss
self fpn_mask mask_featuremap x_mask_fb
self cast self logicaland self greater labels|0 bbox_weights
self tile self expandims mask_fb_targets|1 mask_fb_targets
self loss x_mask_fb|bbox_weights|mask|mask_fb_targets loss_mask_fb
loss_mask_fb out
x_mask_fb out
self cast weights|mstype float16 weights
bbox_weights|self rmv_first_tensor bbox_weights
self cast masks_fb_targets|mstype float16 masks_fb_targets
self loss_mask masks_fb_pred|masks_fb_targets loss_mask_fb
self mean_loss loss_mask_fb|(2|3) loss_mask_fb
loss_mask_fb|bbox_weights loss_mask_fb
loss_mask_fb|self sum_loss weights|(0|) loss_mask_fb
self sum_loss loss_mask_fb|(0|1) loss_mask_fb
initializer shape weights rmv_first_tensor bbox_weights
kernel_size|stride kernel_size kernel_size
(0 |0 |0 |0 ) target_means self target_means
(0 1|0 1|0 2|0 2) target_stds self target_stds
config cfg rcnn_mask_out_channels self rcnn_mask_out_channels
config cfg rcnn_in_channels self in_channels
config cfg num_expected_pos_stage2|batch_size self num_bboxes
self fpn_mask mask_featuremap x_mask_fb out
self cast self logicaland self greater labels|0 bbox_weights rmv_first_tensor bbox_weights
self cast self logicaland self greater labels|0 bbox_weights loss_mask_fb
self loss x_mask_fb|bbox_weights|mask|mask_fb_targets loss_mask_fb out
self loss x_mask_fb|bbox_weights|mask|mask_fb_targets loss_mask_fb loss_mask_fb
self loss x_mask_fb|bbox_weights|mask|mask_fb_targets loss_mask_fb sum_loss weights|(0|) loss_mask_fb
self cast weights|mstype float16 weights rmv_first_tensor bbox_weights
bbox_weights|self rmv_first_tensor bbox_weights rmv_first_tensor bbox_weights
bbox_weights|self rmv_first_tensor bbox_weights loss_mask_fb
self loss_mask masks_fb_pred|masks_fb_targets loss_mask_fb loss_mask_fb
self loss_mask masks_fb_pred|masks_fb_targets loss_mask_fb sum_loss weights|(0|) loss_mask_fb
self mean_loss loss_mask_fb|(2|3) loss_mask_fb loss_mask_fb
self mean_loss loss_mask_fb|(2|3) loss_mask_fb sum_loss weights|(0|) loss_mask_fb
loss_mask_fb|bbox_weights loss_mask_fb loss_mask_fb
loss_mask_fb|bbox_weights loss_mask_fb sum_loss weights|(0|) loss_mask_fb
loss_mask_fb|self sum_loss weights|(0|) loss_mask_fb sum_loss weights|(0|) loss_mask_fb
bboxes1 ndarray:shape n|4
bboxes2 ndarray:shape k|4
ious ndarray:shape n|k
bboxes1 astype np float32 bboxes1
bboxes2 astype np float32 bboxes2
bboxes1 shape rows
bboxes2 shape cols
np zeros (rows|cols) ious
bboxes2|bboxes1 bboxes2
np zeros (cols|rows) ious
(bboxes1|1) area1
(bboxes2|1) area2
range i
np maximum bboxes1 x_start
np maximum bboxes1 y_start
np minimum bboxes1 x_end
np minimum bboxes1 y_end
np maximum x_end-x_start|1|0|np maximum overlap
area1 i union
overlap|union ious
ious T ious
(0 5|1 5) contrast_range
(0 5|1 5) saturation_range
brightness_delta self brightness_delta
contrast_range self contrast_upper
saturation_range self saturation_upper
hue_delta self hue_delta
img astype img
random randint
delta img
random randint mode
mmcv bgr2hsv img img
mmcv hsv2bgr img img
img    |random permutation img
mean self mean
ratio_range self max_ratio
img shape c
random uniform self min_ratio|self max_ratio ratio
int random uniform 0|w|ratio-w left
int random uniform 0|h|ratio-h top
img expand_img
expand_img img
np tile (left|top) boxes
mask shape mask_w
np zeros (mask_count|int(mask_h|ratio)) expand_mask
mask expand_mask
expand_mask mask
scale_factor|scale_factor2 scale_factor
gt_bboxes|scale_factor gt_bboxes
 gt_mask_data
gt_mask mask
config img_height-img_data shape pad_h
config img_width-img_data shape pad_w
np zeros (config img_height|config img_width|3) astype(img_data dtype) pad_img_data
img_data pad_img_data
gt_mask_data shape mask_w
np zeros (mask_count|config img_height|config img_width) astype(gt_mask_data dtype) pad_mask
gt_mask_data pad_mask
(config img_height|config img_width|1 0) img_shape
np asarray img_shape|dtype img_shape
np append img_shape|(scale_factor|scale_factor) img_shape
img img_data
mmcv imresize h_scale
np array scale_factor
np append img_shape|(h_scale|w_scale) img_shape
mmcv impad img|(config img_height|config img_width) img_data
img_data astype np float32 img_data
mmcv imnormalize img|[123 675|116 28|103 53]|[58 395|57 12|57 375]|True img_data
mmcv imflip img_data img_data
gt_bboxes copy flipped
img_data shape _
np array gt_mask_data
img transpose 2|0|1 copy img_data
img_data astype np float16 img_data
img_shape astype np float16 img_shape
gt_bboxes astype np float16 gt_bboxes
gt_label astype np int32 gt_label
gt_num astype np bool gt_num
gt_mask astype np bool gt_mask_data
PhotoMetricDistortion random_photo
random_photo img|gt_bboxes|gt_label gt_label
Expand expand
expand img|gt_bboxes|gt_label|gt_mask gt_mask
config max_instance_count pad_max_number
 gt_iscrowd_new_revert
image_bgr|image_shape|gt_box_new|gt_label_new|gt_iscrowd_new_revert|gt_mask_new input_data
rescale_column_test |input_data input_data
resize_column_test |input_data input_data
imnormalize_column |input_data input_data
pad_to_max |input_data|instance_count input_data
transpose_column |input_data output_data
image copy image_bgr
image_bgr shape image_shape
box shape instance_count
box gt_box
box gt_label
box gt_iscrowd
mask copy gt_mask
mask_shape w
gt_mask reshape n|h|w gt_mask
_infer_data image_bgr|image_shape|gt_box|gt_label|gt_iscrowd|gt_mask|instance_count
(np random rand) flip
(np random rand) expand
image_bgr|image_shape|gt_box|gt_label|gt_iscrowd|gt_mask input_data
expand_column |input_data input_data
rescale_column |input_data input_data
resize_column |input_data input_data
flip_column |input_data input_data
_data_aug image|box|mask|mask_shape|is_training
ann segm
isinstance segm|list
maskHelper frPyObjects segm|height|width rles
maskHelper merge rles rle
maskHelper frPyObjects segm|height|width rle
ann rle
maskHelper decode rle m
config coco_root coco_root
config val_data_type data_type
config train_data_type data_type
config coco_classes train_cls
enumerate i|cls
i train_cls_dict cls
os path join coco_root|config instance_set format data_type anno_json
COCO anno_json coco
coco loadCats coco getCatIds cat_ids
cat_ids cat
coco getImgIds image_ids
len image_ids images_num
enumerate ind|img_id
coco loadImgs img_id image_info
image_info file_name
os path join coco_root|data_type|file_name image_path
os path isfile image_path
print  format ind|1|images_num|image_path
coco loadAnns anno_ids anno
coco imgs img_id image_height
coco imgs img_id image_width
image_files append image_path
np array [0|0|0|0|0|1] image_anno_dict image_path
np zeros [1|1|1]|dtype masks image_path
np array [1|1|1]|dtype masks_shape image_path
anno label
label bbox
classs_dict label class_name
annToMask label|image_height|image_width m
m max
np ones [image_height|image_width]|dtype m
instance_masks append m
bbox|bbox|bbox x2
bbox|bbox|bbox y2
annos append
print class_name
np array annos image_anno_dict image_path
np array instance_masks tobytes masks image_path
np array instance_masks shape|dtype masks_shape image_path
print file_name
np zeros [1|image_height|image_width]|dtype masks image_path
np array [1|image_height|image_width]|dtype masks_shape image_path
config mindrecord_dir mindrecord_dir
os path join mindrecord_dir|prefix mindrecord_path
FileWriter mindrecord_path|file_num writer
create_coco_label is_training masks_shape
writer add_schema maskrcnn_json|
len image_files image_files_num
enumerate ind|image_name
open image_name|
f read img
np array image_anno_dict[image_name]|dtype annos
masks image_name mask
masks_shape image_name mask_shape
{} row
print  format ind|1|image_files_num
writer write_raw_data [row]
writer commit
cv2 setNumThreads
de config set_prefetch_size
device_num|shard_id num_shards
C Decode decode
ds map operations ds
bboxes1 ndarray:shape  gt_mask_data
bboxes1 ndarray:shape  gt_iscrowd_new_revert
bboxes2 ndarray:shape  gt_mask_data
bboxes2 ndarray:shape  gt_iscrowd_new_revert
ious ndarray:shape  gt_mask_data
ious ndarray:shape  gt_iscrowd_new_revert
np zeros (rows|cols) ious T ious
bboxes2|bboxes1 bboxes2 bboxes2
bboxes2|bboxes1 bboxes2 area2
np zeros (cols|rows) ious T ious
(bboxes1|1) area1 i union
range i input_data
range i input_data
range i train_cls_dict cls
np maximum x_end-x_start|1|0|np maximum overlap ious
area1 i union ious
overlap|union ious T ious
(0 5|1 5) contrast_range self contrast_upper
(0 5|1 5) saturation_range self saturation_upper
delta img    |random permutation img
delta img shape c
delta img expand_img
delta img img_data
delta img transpose 2|0|1 copy img_data
mmcv bgr2hsv img img    |random permutation img
mmcv bgr2hsv img img shape c
mmcv bgr2hsv img img expand_img
mmcv bgr2hsv img img img_data
mmcv bgr2hsv img img transpose 2|0|1 copy img_data
mmcv hsv2bgr img img    |random permutation img
mmcv hsv2bgr img img shape c
mmcv hsv2bgr img img expand_img
mmcv hsv2bgr img img img_data
mmcv hsv2bgr img img transpose 2|0|1 copy img_data
img expand_img img
expand_img img img_data
expand_img img transpose 2|0|1 copy img_data
np tile (left|top) boxes gt_bboxes
np zeros (mask_count|int(mask_h|ratio)) expand_mask mask
mask expand_mask mask
expand_mask mask copy gt_mask
scale_factor|scale_factor2 scale_factor scale_factor
scale_factor|scale_factor2 scale_factor gt_bboxes
gt_bboxes|scale_factor gt_bboxes gt_bboxes
gt_bboxes|scale_factor gt_bboxes copy flipped
gt_bboxes|scale_factor gt_bboxes astype np float16 gt_bboxes
 gt_mask_data shape mask_w
 gt_mask_data pad_mask
gt_mask mask copy gt_mask
(config img_height|config img_width|1 0) img_shape astype np float16 img_shape
np asarray img_shape|dtype img_shape astype np float16 img_shape
np append img_shape|(scale_factor|scale_factor) img_shape astype np float16 img_shape
img img_data astype np float32 img_data
img img_data shape _
img img_data astype np float16 img_data
np append img_shape|(h_scale|w_scale) img_shape astype np float16 img_shape
mmcv impad img|(config img_height|config img_width) img_data astype np float32 img_data
mmcv impad img|(config img_height|config img_width) img_data shape _
mmcv impad img|(config img_height|config img_width) img_data astype np float16 img_data
mmcv imnormalize img|[123 675|116 28|103 53]|[58 395|57 12|57 375]|True img_data shape _
mmcv imnormalize img|[123 675|116 28|103 53]|[58 395|57 12|57 375]|True img_data astype np float16 img_data
mmcv imflip img_data img_data shape _
mmcv imflip img_data img_data astype np float16 img_data
img transpose 2|0|1 copy img_data astype np float16 img_data
PhotoMetricDistortion random_photo img|gt_bboxes|gt_label gt_label
random_photo img|gt_bboxes|gt_label gt_label input_data
random_photo img|gt_bboxes|gt_label gt_label input_data
Expand expand img|gt_bboxes|gt_label|gt_mask gt_mask
expand img|gt_bboxes|gt_label|gt_mask gt_mask input_data
expand img|gt_bboxes|gt_label|gt_mask gt_mask reshape n|h|w gt_mask
expand img|gt_bboxes|gt_label|gt_mask gt_mask input_data
 gt_iscrowd_new_revert input_data
image copy image_bgr shape image_shape
image copy image_bgr input_data
image_bgr shape image_shape input_data
box gt_box input_data
box gt_label input_data
box gt_iscrowd input_data
mask copy gt_mask reshape n|h|w gt_mask
mask copy gt_mask input_data
_infer_data image_bgr|image_shape|gt_box|gt_label|gt_iscrowd|gt_mask input_data
_infer_data i train_cls_dict cls
_infer_data label bbox
_data_aug i train_cls_dict cls
_data_aug m max
isinstance m max
maskHelper decode rle m max
maskHelper decode rle m num_shards
enumerate i train_cls_dict cls
COCO anno_json coco loadCats coco getCatIds cat_ids
COCO anno_json coco getImgIds image_ids
COCO anno_json coco loadImgs img_id image_info
COCO anno_json coco loadAnns anno_ids anno
COCO anno_json coco imgs img_id image_height
COCO anno_json coco imgs img_id image_width
coco loadCats coco getCatIds cat_ids cat
coco loadImgs img_id image_info file_name
print  format m max
coco loadAnns anno_ids anno label
anno label bbox
label bbox x2
label bbox y2
annToMask label|image_height|image_width m max
annToMask label|image_height|image_width m num_shards
np ones [image_height|image_width]|dtype m num_shards
instance_masks append m num_shards
FileWriter mindrecord_path|file_num writer add_schema maskrcnn_json|
FileWriter mindrecord_path|file_num writer write_raw_data [row]
FileWriter mindrecord_path|file_num writer commit
create_coco_label is_training masks_shape image_name mask_shape
super LossCallBack|self __init__
isinstance per_print_times|int
per_print_times self _per_print_times
rank_id self rank_id
time time time_stamp_first
run_context original_args cb_params
cb_params net_outputs asnumpy rpn_loss
cb_params net_outputs asnumpy rcnn_loss
cb_params net_outputs asnumpy rpn_cls_loss
cb_params net_outputs asnumpy rpn_reg_loss
cb_params net_outputs asnumpy rcnn_cls_loss
cb_params net_outputs asnumpy rcnn_reg_loss
cb_params net_outputs asnumpy rcnn_mask_loss
float rpn_loss self rpn_loss_sum
float rcnn_loss self rcnn_loss_sum
float rpn_cls_loss self rpn_cls_loss_sum
float rpn_reg_loss self rpn_reg_loss_sum
float rcnn_cls_loss self rcnn_cls_loss_sum
float rcnn_reg_loss self rcnn_reg_loss_sum
float rcnn_mask_loss self rcnn_mask_loss_sum
(cb_params cur_step_num-1)%cb_params batch_num|1 cur_step_in_epoch
time time time_stamp_current
self rpn_loss_sum|self count rpn_loss
self rcnn_loss_sum|self count rcnn_loss
self rpn_cls_loss_sum|self count rpn_cls_loss
self rpn_reg_loss_sum|self count rpn_reg_loss
self rcnn_cls_loss_sum|self count rcnn_cls_loss
self rcnn_reg_loss_sum|self count rcnn_reg_loss
self rcnn_mask_loss_sum|self count rcnn_mask_loss
rpn_loss|rcnn_loss total_loss
open loss_file
loss_file write
loss_file close
backbone self _backbone
loss_fn self _loss_fn
self _loss_fn loss1|loss2|loss3|loss4|loss5|loss6|loss7
network self network
self network set_grad
network_backbone self backbone
ParameterTuple network trainable_params self weights
optimizer self optimizer
Tensor (np ones (1|)|sens) astype(np float16) self sens
reduce_flag self reduce_flag
C HyperMap self hyper_map
DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
self weights weights
self grad self network|weights(x|img_shape|gt_bboxe|gt_label|gt_num|gt_mask|self sens) grads
self grad_reducer grads grads
F depend loss1|self optimizer grads
isinstance per_print_times self _per_print_times
run_context original_args cb_params net_outputs asnumpy rpn_loss
run_context original_args cb_params net_outputs asnumpy rcnn_loss
run_context original_args cb_params net_outputs asnumpy rpn_cls_loss
run_context original_args cb_params net_outputs asnumpy rpn_reg_loss
run_context original_args cb_params net_outputs asnumpy rcnn_cls_loss
run_context original_args cb_params net_outputs asnumpy rcnn_reg_loss
run_context original_args cb_params net_outputs asnumpy rcnn_mask_loss
cb_params net_outputs asnumpy rpn_loss total_loss
cb_params net_outputs asnumpy rcnn_loss total_loss
self rpn_loss_sum|self count rpn_loss total_loss
self rcnn_loss_sum|self count rcnn_loss total_loss
open loss_file write
open loss_file close
UNet args|kwargs unet
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
UNet n_channels net
load_checkpoint args ckpt_file param_dict
load_param_into_net net|param_dict
Tensor np ones [args batch_size|cfg|args height|args width] astype(np float32) input_data
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
int os getenv device_id
mindspore set_seed
get_group_size group_size
ParallelMode DATA_PARALLEL parallel_mode
group_size device_num
UNet n_channels net
load_checkpoint cfg param_dict
load_param_into_net net|param_dict
CrossEntropyWithLogits criterion
create_dataset data_dir|epochs|batch_size|True|cross_valid_ind|run_distribute _
train_dataset get_dataset_size train_data_size
print train_data_size
mindspore train loss_scale_manager FixedLossScaleManager cfg|False loss_scale_manager
parser parse_args
get_args args
print args
cfg_unet epoch_size
cfg_unet cross_valid_ind
epoch_size epochs
cfg_unet batch_size
cfg_unet lr
args run_distribute run_distribute
get_group_size group_size device_num
get_args args run_distribute run_distribute
print args run_distribute run_distribute
cfg_unet epoch_size epochs
int os getenv device_id
super CrossEntropyWithLogits|self __init__
F Transpose self transpose_fn
F Reshape self reshape_fn
nn SoftmaxCrossEntropyWithLogits self softmax_cross_entropy_loss
F Cast self cast
self transpose_fn logits|(0|2|3|1) logits
self cast logits|mindspore float32 logits
self transpose_fn label|(0|2|3|1) label
self get_loss loss
super dice_coeff|self __init__
self clear
ValueError  format len inputs
self _convert_data inputs y_pred
self _convert_data inputs y
y shape self _samples_num
y_pred transpose 0|2|3|1 y_pred
y transpose 0|2|3|1 y
np dot y_pred flatten|y flatten inter
np dot y_pred flatten|y_pred flatten|np dot(y flatten|y flatten) union
print single_dice_coeff
single_dice_coeff self _dice_coeff_sum
float self _samples_num
UNet n_channels net
load_checkpoint ckpt_path param_dict
load_param_into_net net|param_dict
CrossEntropyWithLogits criterion
create_dataset data_dir|1|1|False|cross_valid_ind|False valid_dataset
Model net|loss_fn model
parser parse_args
get_args args
print args
args ckpt_path ckpt_path
cfg_unet cross_valid_ind
self get_loss loss model
self _convert_data inputs y_pred transpose 0|2|3|1 y_pred
self _convert_data inputs y shape self _samples_num
self _convert_data inputs y transpose 0|2|3|1 y
print single_dice_coeff self _dice_coeff_sum
UNet n_channels net model
get_args args ckpt_path ckpt_path
print args ckpt_path ckpt_path
ImageSequence Iterator] p
np random seed
np arange 0|length|1|dtype indices
np random shuffle indices
deque indices indices
indices rotate fold|round (1 0-ratio)|length
np array indices indices
indices train_indices
indices val_indices
(mask) mask
mask transpose 2|0|1 astype(np float32) mask
np random random h_flip
np flipud img img
np flipud mask mask
np random random v_flip
np fliplr img img
np fliplr mask mask
int np random uniform|0 3|572 left
int (1-np random uniform|0 3)|572 right
int np random uniform|0 3|572 top
int (1-np random uniform|0 3)|572 bottom
np random uniform -0 2|0 2 brightness
np float32 img|brightness|np ones(img shape) img
np clip img|-1 0|1 0 img
_load_multipage_tiff os path join data_dir| images
_load_multipage_tiff os path join data_dir| masks
_get_val_train_indices len images val_indices
images train_indices train_images
masks train_indices train_masks
images val_indices val_images
masks val_indices val_masks
{} train_image_data
{} train_mask_data
{} valid_image_data
{} valid_mask_data
get_rank rank_id
get_group_size rank_size
rank_size num_shards
c_vision Resize size c_resize_op
c_vision Rescale 1 0|127 5|-1 c_rescale_image
c_vision Rescale 1 0|255 0|0 c_rescale_mask
[c_rescale_image|c_resize_op|c_pad] c_trans_normalize_img
[c_rescale_mask|c_resize_op|c_pad] c_trans_normalize_mask
ds zip (train_image_ds|train_mask_ds) train_ds
train_ds project columns train_ds
train_data_augmentation augment_process
train_ds map input_columns train_ds
data_post_process post_process
train_ds shuffle repeat|24 train_ds
ds zip (valid_image_ds|valid_mask_ds) valid_ds
valid_ds project columns valid_ds
valid_ds map input_columns valid_ds
ImageSequence Iterator] p c_trans_normalize_img
ImageSequence Iterator] p c_trans_normalize_mask
np arange(0|length|1|dtype indices rotate fold|round (1 0-ratio)|length
np arange 0|length|1|dtype indices train_indices
np arange 0|length|1|dtype indices val_indices
np random shuffle indices rotate fold|round (1 0-ratio)|length
np random shuffle indices train_indices
np random shuffle indices val_indices
deque indices indices rotate fold|round (1 0-ratio)|length
deque indices indices train_indices
deque indices indices val_indices
np array indices indices train_indices
np array indices indices val_indices
(mask) mask transpose 2|0|1 astype(np float32) mask
(mask) mask c_trans_normalize_mask
np flipud mask mask c_trans_normalize_mask
np fliplr mask mask c_trans_normalize_mask
_load_multipage_tiff os path join data_dir| images train_indices train_images
_load_multipage_tiff os path join data_dir| images val_indices val_images
_load_multipage_tiff os path join data_dir| masks train_indices train_masks
_load_multipage_tiff os path join data_dir| masks val_indices val_masks
get_group_size rank_size num_shards
c_vision Resize size c_resize_op c_trans_normalize_img
c_vision Resize size c_resize_op c_trans_normalize_mask
c_vision Rescale 1 0|127 5|-1 c_rescale_image c_trans_normalize_img
c_vision Rescale 1 0|255 0|0 c_rescale_mask c_trans_normalize_mask
ds zip (train_image_ds|train_mask_ds) train_ds project(columns train_ds
ds zip (train_image_ds|train_mask_ds) train_ds map(input_columns train_ds
ds zip (train_image_ds|train_mask_ds) train_ds shuffle repeat|24 train_ds
ds zip (valid_image_ds|valid_mask_ds) valid_ds project(columns valid_ds
ds zip (valid_image_ds|valid_mask_ds) valid_ds map(input_columns valid_ds
super __init__
TruncatedNormal init_value_0
TruncatedNormal init_value_1
out_channels mid_channels
nn SequentialCell self double_conv
nn ReLU
self double_conv x
nn SequentialCell self maxpool_conv
self maxpool_conv x
CentralCrop central_fraction self center_crop
F Print self print_fn
DoubleConv in_channels|out_channels|in_channels||2 self conv
nn ReLU self relu
self up x1 x1
self relu x1 x1
self center_crop x2 x2
self concat (x1|x2) x
self conv x
super OutConv|self __init__
TruncatedNormal init_value
self conv x x
super UNet|self __init__
n_channels self n_channels
n_classes self n_classes
DoubleConv n_channels|64 self inc
Down 64|128 self down1
Down 128|256 self down2
Down 256|512 self down3
Down 512|1024 self down4
Up1 1024|512 self up1
Up2 512|256 self up2
Up3 256|128 self up3
Up4 128|64 self up4
OutConv 64|n_classes self outc
self inc x x1
self down1 x1 x2
self down2 x2 x3
self down3 x3 x4
self down4 x4 x5
self up1 x5|x4 x
self up2 x|x3 x
self up3 x|x2 x
self up4 x|x1 x
self outc x logits
super CrossEntropyWithLogits|self __init__
F Transpose self transpose_fn
F Reshape self reshape_fn
nn SoftmaxCrossEntropyWithLogits self softmax_cross_entropy_loss
F Cast self cast
self transpose_fn logits|(0|2|3|1) logits
self cast logits|mindspore float32 logits
self transpose_fn label|(0|2|3|1) label
self reduce_mean loss
self get_loss loss
super StepLossTimeMonitor|self __init__
isinstance per_print_times|int
per_print_times self _per_print_times
batch_size self batch_size
time time self step_time
time time-self step_time step_seconds
self batch_size|1 0|step_seconds step_fps
run_context original_args cb_params
cb_params net_outputs loss
isinstance loss|(tuple|list)
isinstance loss|Tensorandisinstance loss asnumpy|np ndarray
np mean loss asnumpy loss
(cb_params cur_step_num-1)%cb_params batch_num|1 cur_step_in_epoch
isinstance loss|floatand np isnan lossornp isinf loss
isinstance per_print_times self _per_print_times
run_context original_args cb_params net_outputs loss
parser parse_args args
context GRAPH_MODE mode|args device_target device_target context set_context
args device_target target
context set_context args device_id device_id
mobilenet class_num network
load_checkpoint args ckpt_file|net param_dict
network set_train False
Tensor np zeros [config batch_size|3|args height|args width] astype(np float32) input_data
args file_name|file_format file_name
parser parse_args args device_target target
parser parse_args args file_name|file_format file_name
mobilenet class_num network set_train False
parser parse_args args_opt
network set_train False
args_opt device_target target
config save_checkpoint_path ckpt_save_dir
int os getenv device_id
dataset get_dataset_size step_size
mobilenet class_num net
net set_param_ps
load_checkpoint args_opt pre_trained param_dict
load_param_into_net net|param_dict
net cells_and_names _|cell
isinstance cell|nn Conv2d
isinstance cell|nn Dense
config warmup_epochs|total_epochs warmup_epochs
Tensor lr lr
net trainable_params param
decayed_params append param
no_decayed_params append param
Momentum group_params|lr|config momentum|loss_scale opt
TimeMonitor data_size time_cb
LossMonitor loss_cb
[time_cb|loss_cb] cb
[ckpt_cb] cb
parser parse_args args_opt device_target target
mobilenet class_num net set_param_ps
mobilenet class_num net cells_and_names _|cell
mobilenet class_num net trainable_params param
load_param_into_net net cells_and_names _|cell
load_param_into_net net trainable_params param
Tensor lr lr momentum|loss_scale opt
TimeMonitor data_size time_cb cb
LossMonitor loss_cb cb
[time_cb|loss_cb] cb cb
parser parse_args args_opt
no_decayed_params append param
args_opt device_target target
int os getenv device_id
context set_context device_id device_id
dataset get_dataset_size step_size
mobilenet class_num net
load_checkpoint args_opt checkpoint_path param_dict
load_param_into_net net|param_dict
net set_train False
Model net|loss_fn model
model eval dataset res
parser parse_args args_opt device_target target
mobilenet class_num net set_train False
mobilenet class_num net model
load_param_into_net net set_train False
Model net|loss_fn model eval dataset res
 config1
 config2
lr_init float
lr_max float
total_steps int
warmup_steps int
[0 3|total_steps|0 6|total_steps|0 8|total_steps] decay_epoch_index
range i
lr_init|(lr_max-lr_init)|i|warmup_steps lr
lr_max lr
lr_max|0 1 lr
lr_max|0 01 lr
lr_max|0 001 lr
lr_each_step append lr
lr_end float
(float(lr_max)-float(lr_init))|float(warmup_steps) inc_each_step
float lr_init|inc_each_step|float(i) lr
(1 0-(float(i)-float(warmup_steps))|(float(total_steps)-float(warmup_steps))) base
float lr_max|base|base lr
total_steps-warmup_steps decay_steps
(float(lr_max)-float(lr_init))|float(warmup_steps) lr_inc
float lr_init|lr_inc|(i|1) lr
(total_steps-i)|decay_steps linear_decay
linear_decay|cosine_decay|0 00001 decayed
lr_max|decayed lr
lr_max-(lr_max-lr_end)|(i-warmup_steps)|(total_steps-warmup_steps) lr
warmup_epochs int
total_epochs int
steps_per_epoch int
lr_decay_mode string:learningratedecaymode|includingsteps|poly|cosineorliner default
steps_per_epoch|total_epochs total_steps
steps_per_epoch|warmup_epochs warmup_steps
_generate_steps_lr lr_init|lr_max|total_steps|warmup_steps lr_each_step
_generate_poly_lr lr_init|lr_end|lr_max|total_steps|warmup_steps lr_each_step
_generate_cosine_lr lr_init|lr_end|lr_max|total_steps|warmup_steps lr_each_step
_generate_liner_lr lr_init|lr_end|lr_max|total_steps|warmup_steps lr_each_step
np array lr_each_step astype np float32 lr_each_step
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step lr
lr float
max_epoch int
global_step int
lr base_lr
int max_epoch|steps_per_epoch total_steps
int warmup_epochs|steps_per_epoch warmup_steps
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr
base_lr|decayed lr
lr_each_step learning_rate
lr_init float inc_each_step
lr_init float lr_init|inc_each_step|float(i) lr
lr_init float lr_max|base|base lr
lr_init float lr_inc
lr_init float lr_init|lr_inc|(i|1) lr
lr_init float lr_inc
lr_init float init_lr|lr_inc|current_step lr
lr_max float inc_each_step
lr_max float lr_init|inc_each_step|float(i) lr
lr_max float lr_max|base|base lr
lr_max float lr_inc
lr_max float lr_init|lr_inc|(i|1) lr
lr_max float lr_inc
lr_max float init_lr|lr_inc|current_step lr
total_steps int max_epoch|steps_per_epoch total_steps
total_steps int warmup_epochs|steps_per_epoch warmup_steps
warmup_steps int max_epoch|steps_per_epoch total_steps
warmup_steps int warmup_epochs|steps_per_epoch warmup_steps
range i lr
lr_init|(lr_max-lr_init)|i|warmup_steps lr float
lr_init|(lr_max-lr_init)|i|warmup_steps lr base_lr
lr_init|(lr_max-lr_init)|i|warmup_steps lr lr
lr_max lr float
lr_max lr base_lr
lr_max lr lr
lr_max|0 1 lr float
lr_max|0 1 lr base_lr
lr_max|0 1 lr lr
lr_max|0 01 lr float
lr_max|0 01 lr base_lr
lr_max|0 01 lr lr
lr_max|0 001 lr float
lr_max|0 001 lr base_lr
lr_max|0 001 lr lr
lr_each_step append lr float
lr_each_step append lr base_lr
lr_each_step append lr lr
lr_end float inc_each_step
lr_end float lr_init|inc_each_step|float(i) lr
lr_end float lr_max|base|base lr
lr_end float lr_inc
lr_end float lr_init|lr_inc|(i|1) lr
lr_end float lr_inc
lr_end float init_lr|lr_inc|current_step lr
float lr_init|inc_each_step|float(i) lr float
float lr_init|inc_each_step|float(i) lr base_lr
float lr_init|inc_each_step|float(i) lr lr
float lr_max|base|base lr float
float lr_max|base|base lr base_lr
float lr_max|base|base lr lr
total_steps-warmup_steps decay_steps linear_decay
float lr_init|lr_inc|(i|1) lr float
float lr_init|lr_inc|(i|1) lr base_lr
float lr_init|lr_inc|(i|1) lr lr
(total_steps-i)|decay_steps linear_decay 00001 decayed
linear_decay|cosine_decay|0 00001 decayed lr
linear_decay|cosine_decay|0 00001 decayed lr
lr_max|decayed lr float
lr_max|decayed lr base_lr
lr_max|decayed lr lr
lr_max-(lr_max-lr_end)|(i-warmup_steps)|(total_steps-warmup_steps) lr float
lr_max-(lr_max-lr_end)|(i-warmup_steps)|(total_steps-warmup_steps) lr base_lr
lr_max-(lr_max-lr_end)|(i-warmup_steps)|(total_steps-warmup_steps) lr lr
warmup_epochs int max_epoch|steps_per_epoch total_steps
warmup_epochs int warmup_epochs|steps_per_epoch warmup_steps
total_epochs int max_epoch|steps_per_epoch total_steps
total_epochs int warmup_epochs|steps_per_epoch warmup_steps
steps_per_epoch int max_epoch|steps_per_epoch total_steps
steps_per_epoch int warmup_epochs|steps_per_epoch warmup_steps
_generate_steps_lr lr_init|lr_max|total_steps|warmup_steps lr_each_step learning_rate
_generate_poly_lr lr_init|lr_end|lr_max|total_steps|warmup_steps lr_each_step learning_rate
_generate_cosine_lr lr_init|lr_end|lr_max|total_steps|warmup_steps lr_each_step learning_rate
_generate_liner_lr lr_init|lr_end|lr_max|total_steps|warmup_steps lr_each_step learning_rate
np array lr_each_step astype np float32 lr_each_step learning_rate
float init_lr|lr_inc|current_step lr float
float init_lr|lr_inc|current_step lr base_lr
float init_lr|lr_inc|current_step lr lr
max_epoch int max_epoch|steps_per_epoch total_steps
max_epoch int warmup_epochs|steps_per_epoch warmup_steps
global_step int max_epoch|steps_per_epoch total_steps
global_step int warmup_epochs|steps_per_epoch warmup_steps
lr base_lr lr
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr lr
base_lr|decayed lr lr
dataset_path string
do_train bool
repeat_num int
batch_size int
target str
_get_rank_info rank_id
get_rank rank_id
get_group_size device_num
C RandomCrop (32|32)|(4|4|4|4)
C Resize (224|224)
C Rescale 1 0|255 0|0 0
C Normalize [0 4914|0 4822|0 4465]|[0 2023|0 1994|0 2010]
C HWC2CHW
C2 TypeCast mstype int32 type_cast_op
ds repeat repeat_num ds
[0 485|255|0 456|255|0 406|255] mean
[0 229|255|0 224|255|0 225|255] std
(0 08|1 0) scale
mean mean|std std C Normalize
C Decode
C Resize
C CenterCrop image_size
int os environ get rank_size
get_group_size rank_size
repeat_num int os environ get rank_size
batch_size int os environ get rank_size
[0 485|255|0 456|255|0 406|255] mean mean|std std C Normalize
output append nn BatchNorm2d out_channel
output append nn get_activation activation
nn SequentialCell output
super MobileNetV1|self __init__
features_only self features_only
conv_bn_relu 3|32|3|2|False
conv_bn_relu 32|32|3|1|True
conv_bn_relu 32|64|1|1|False
conv_bn_relu 64|64|3|2|True
conv_bn_relu 64|128|1|1|False
conv_bn_relu 128|128|3|1|True
conv_bn_relu 128|128|1|1|False
conv_bn_relu 128|128|3|2|True
conv_bn_relu 128|256|1|1|False
conv_bn_relu 256|256|3|1|True
conv_bn_relu 256|256|1|1|False
conv_bn_relu 256|256|3|2|True
conv_bn_relu 256|512|1|1|False
conv_bn_relu 512|512|3|1|True
conv_bn_relu 512|512|1|1|False
conv_bn_relu 512|512|3|2|True
conv_bn_relu 512|1024|1|1|False
conv_bn_relu 1024|1024|3|1|True
conv_bn_relu 1024|1024|1|1|False
nn CellList cnn self network
nn SequentialCell cnn self network
nn Dense 1024|class_num self fc
x output
self network block
block output output
features|(output|) features
self network x output
P ReduceMean output|(2|3) output
self fc output output
MobileNetV1 class_num
nn SequentialCell output features
x output features
self network block output output
block output output features
features|(output|) features features
super CrossEntropySmooth|self __init__
P OneHot self onehot
sparse self sparse
Tensor 1 0-smooth_factor|mstype float32 self on_value
Tensor 1 0|smooth_factor|(num_classes-1) self off_value
nn SoftmaxCrossEntropyWithLogits reduction self ce
self onehot label|F shape logit label
self ce logit|label loss
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
squeezenet num_classes net
load_checkpoint args ckpt_file param_dict
load_param_into_net net|param_dict
Tensor np zeros [args batch_size|3|args height|args width]|np float32 input_data
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
parser parse_args args_opt
load_param_into_net net|param_dict
args_opt device_target target
config save_checkpoint_path ckpt_save_dir
int os getenv device_id
args_opt device_num device_num
ParallelMode DATA_PARALLEL parallel_mode
get_group_size device_num
config save_checkpoint_path||str ckpt_save_dir
config batch_size batch_size
dataset get_dataset_size step_size
squeezenet num_classes net
load_checkpoint args_opt pre_trained param_dict
config lr_end lr_end
config lr_max lr_max
config epoch_size total_epochs
config warmup_epochs warmup_epochs
config pretrain_epoch_size pretrain_epochs
step_size steps_per_epoch
Tensor lr lr
config label_smooth_factor smooth_factor
loss loss_fn
opt optimizer
loss_scale loss_scale_manager
Model net|loss_fn model
TimeMonitor data_size time_cb
LossMonitor loss_cb
[time_cb|loss_cb] cb
CheckpointConfig config_ck
config save_checkpoint_epochs|step_size save_checkpoint_steps
ckpt_save_dir directory
[ckpt_cb] cb
parser parse_args args_opt device_target target
parser parse_args args_opt device_num device_num
config save_checkpoint_path ckpt_save_dir directory
config save_checkpoint_path||str ckpt_save_dir directory
dataset get_dataset_size step_size steps_per_epoch
squeezenet num_classes net model
loss loss_fn model
TimeMonitor data_size time_cb cb
LossMonitor loss_cb cb
[time_cb|loss_cb] cb cb
parser parse_args args_opt
load_param_into_net net|param_dict
args_opt device_target target
int os getenv device_id
target device_target
config batch_size batch_size
dataset get_dataset_size step_size
squeezenet num_classes net
load_checkpoint args_opt checkpoint_path param_dict
net set_train False
config label_smooth_factor smooth_factor
loss loss_fn
model eval dataset res
parser parse_args args_opt device_target target
load_param_into_net net set_train False
args_opt device_target target device_target
squeezenet num_classes net set_train False
 config1
 config2
 config3
 config4
super Fire|self __init__
inplanes self inplanes
nn ReLU self squeeze_activation
nn ReLU self expand1x1_activation
nn ReLU self expand3x3_activation
self squeeze_activation self squeeze x x
SqueezeNet net
super SqueezeNet|self __init__
 self features
nn ReLU
Fire 96|16|64|64
Fire 128|16|64|64
Fire 128|32|128|128
Fire 256|32|128|128
Fire 256|48|192|192
Fire 384|48|192|192
Fire 384|64|256|256
Fire 512|64|256|256
nn ReLU self relu
nn Flatten self flatten
self custom_init_weight
self cells_and_names _|cell
isinstance cell|nn Conv2d
self features x x
self dropout x x
self final_conv x x
self relu x x
self mean x|(2|3) x
self flatten x x
SqueezeNet_Residual net
super SqueezeNet_Residual|self __init__
Fire 96|16|64|64 self fire2
Fire 128|16|64|64 self fire3
Fire 128|32|128|128 self fire4
Fire 256|32|128|128 self fire5
Fire 256|48|192|192 self fire6
Fire 384|48|192|192 self fire7
Fire 384|64|256|256 self fire8
Fire 512|64|256|256 self fire9
P TensorAdd self add
self conv1 x x
self max_pool2d x x
self fire2 x x
self add x|self fire3 x x
self fire4 x x
self add x|self fire5 x x
self fire6 x x
self add x|self fire7 x x
self fire8 x x
self add x|self fire9 x x
self conv10 x x
lr_init float
lr_end float
lr_max float
total_epochs int
warmup_epochs int
pretrain_epochs int
steps_per_epoch int
lr_decay_mode string
steps_per_epoch|total_epochs total_steps
steps_per_epoch|warmup_epochs warmup_steps
steps_per_epoch|pretrain_epochs pretrain_steps
total_steps-warmup_steps decay_steps
range i
lr_max lr
lr_max|0 1 lr
lr_max|0 01 lr
lr_max|0 001 lr
lr_each_step append lr
linear_warmup_lr i|warmup_steps|lr_max|lr_init lr
(1 0-(i-warmup_steps)|decay_steps) base
lr_max|base|base lr
(total_steps-i)|decay_steps linear_decay
linear_decay|cosine_decay|0 00001 decayed
lr_max|decayed lr
np array lr_each_step astype np float32 lr_each_step
lr_each_step learning_rate
(base_lr-init_lr)|warmup_steps lr_inc
init_lr|lr_inc|current_step lr
steps_per_epoch|warmup_epochs warmup_steps lr_inc
total_steps-warmup_steps decay_steps linear_decay
lr_max lr lr
lr_max|0 1 lr lr
lr_max|0 01 lr lr
lr_max|0 001 lr lr
lr_each_step append lr lr
linear_warmup_lr i|warmup_steps|lr_max|lr_init lr lr
(1 0-(i-warmup_steps)|decay_steps) base lr
lr_max|base|base lr lr
(total_steps-i)|decay_steps linear_decay 00001 decayed
linear_decay|cosine_decay|0 00001 decayed lr
lr_max|decayed lr lr
np array lr_each_step astype np float32 lr_each_step learning_rate
(base_lr-init_lr)|warmup_steps lr_inc lr
init_lr|lr_inc|current_step lr lr
dataset_path string
do_train bool
repeat_num int
batch_size int
target str
_get_rank_info rank_id
get_rank rank_id
get_group_size device_num
device_num num_shards
C RandomCrop (32|32)|(4|4|4|4)
C Resize (227|227)
C Rescale 1 0|255 0|0 0
C Normalize [0 4914|0 4822|0 4465]|[0 2023|0 1994|0 2010]
C CutOut
C HWC2CHW
C2 TypeCast mstype int32 type_cast_op
ds repeat repeat_num ds
[0 485|255|0 456|255|0 406|255] mean
[0 229|255|0 224|255|0 225|255] std
(0 08|1 0) scale
mean mean|std std C Normalize
C Decode
C Resize (256|256)
C CenterCrop image_size
int os environ get rank_size
get_group_size rank_size
repeat_num int os environ get rank_size
batch_size int os environ get rank_size
get_group_size device_num num_shards
[0 485|255|0 456|255|0 406|255] mean mean|std std C Normalize
super CrossEntropySmooth|self __init__
P OneHot self onehot
sparse self sparse
Tensor 1 0-smooth_factor|mstype float32 self on_value
Tensor 1 0|smooth_factor|(num_classes-1) self off_value
nn SoftmaxCrossEntropyWithLogits reduction self ce
self onehot label|F shape logit label
self ce logit|label loss
NotImplementedError f
int os getenv devid
argparse ArgumentParser parser
parser parse_known_args _
os path join args data_dir args data_root
args_engine ignore_threshold self ignore_threshold
len self labels self num_classes
args_engine outputs_dir self save_prefix
args_engine nms_thresh self nms_thresh
self results img_id
self results clsi
self results img_id][clsi dets
np array dets dets
int clsi
list dets i astype float
self det_boxes extend keep_box
dets x1
dets y1
x1|dets x2
y1|dets y2
dets scores
(x2-x1|1)|(y2-y1|1) areas
scores argsort order
order i
keep append i
np maximum x1 i]|x1[order xx1
np maximum y1 i]|y1[order yy1
np minimum x2 i]|x2[order xx2
np minimum y2 i]|y2[order yy2
np maximum 0 0|xx2-xx1|1 w
np maximum 0 0|yy2-yy1|1 h
w|h inter
inter|(areas-inter) ovr
np where ovr inds
(x1)|2 center_x1
(x1)|2 center_x2
(y1)|2 center_y1
(y1)|2 center_y2
(center_x2-center_x1)2|(center_y2-center_y1)2 inter_diag
np maximum x2 i]|x2[order out_max_x
np maximum y2 i]|y2[order out_max_y
np minimum x1 i]|x1[order out_min_x
np minimum y1 i]|y1[order out_min_y
(out_max_x-out_min_x)2|(out_max_y-out_min_y)2 outer_diag
ovr-inter_diag|outer_diag diou
np clip diou|-1|1 diou
np where diou inds
datetime datetime now strftime t
self save_prefix self file_path
open self file_path f
json dump self det_boxes|f
RuntimeError  format str e
f close
len outputs outputs_num
range batch_id
range out_id
outputs out_id out_item
out_item out_item_single
out_item_single shape dimensions
dimensions d
image_shape batch_id ori_h
int image_id batch_id img_id
out_item_single    |0 x
out_item_single    |1 y
out_item_single    |2 w
out_item_single    |3 h
out_item_single conf
out_item_single cls_emb
np expand_dims np argmax cls_emb|axis cls_argmax
x reshape x
y reshape y
w reshape w
h reshape h
cls_emb reshape -1|80 cls_emb
conf reshape conf
cls_argmax reshape cls_argmax
x-w|2  x_top_left
y-h|2  y_top_left
np random random cls_emb shape flag
range i
cls_argmax i c
cls_emb flag confidence
zip x_lefti|y_lefti|wi|hi|confi|clsi
defaultdict list self results img_id
max 0|x_lefti x_lefti
max 0|y_lefti y_lefti
min wi|ori_w wi
min hi|ori_h hi
self coco_catids clsi coco_clsi
self results img_id coco_clsi append [x_lefti|y_lefti|wi|hi|confi]
[int args_test testing_shape] testing_shape
get_rank args rank
get_group_size args group_size
get_logger args outputs_dir|args rank args logger
context reset_auto_parallel_context
ParallelMode DATA_PARALLEL parallel_mode
ParallelMode STAND_ALONE parallel_mode
args logger info
args logger info args pretrained
os path isfile args pretrained
load_checkpoint args pretrained param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
args logger info  format args pretrained
FileNotFoundError  format args pretrained
args data_root data_root
ConfigYOLOV4CspDarkNet53 config
conver_testing_shape args config test_img_shape
os path join args data_dir data_txt
args logger info  format config test_img_shape
args logger info  format data_size
network set_train False
DetectionEngine args detection
Tensor tuple config test_img_shape input_shape
enumerate i|data
Tensor data image
Tensor data image_shape
Tensor data image_id
network image|input_shape prediction
prediction output_small
output_big asnumpy output_big
output_me asnumpy output_me
output_small asnumpy output_small
image_id asnumpy image_id
image_shape asnumpy image_shape
detection detect [output_small|output_me|output_big]|args per_batch_size|image_shape|image_id
args logger info  format iargs per_batch_size|data_size|100
detection do_nms_for_results
detection write_result result_file_path
args logger info  format result_file_path
argparse ArgumentParser parser parse_known_args _
self results img_id][clsi dets x1
self results img_id][clsi dets y1
self results img_id][clsi dets x2
self results img_id][clsi dets y2
self results img_id][clsi dets scores
np array dets dets x1
np array dets dets y1
np array dets dets x2
np array dets dets y2
np array dets dets scores
dets x1 x2
dets x1 areas
dets y1 y2
dets y1 areas
dets scores argsort order
scores argsort order i
np maximum 0 0|xx2-xx1|1 w inter
np maximum 0 0|xx2-xx1|1 w reshape w
np maximum 0 0|xx2-xx1|1 w  x_top_left
np maximum 0 0|yy2-yy1|1 h inter
np maximum 0 0|yy2-yy1|1 h reshape h
np maximum 0 0|yy2-yy1|1 h  y_top_left
w|h inter ovr
(center_x2-center_x1)2|(center_y2-center_y1)2 inter_diag diou
(out_max_x-out_min_x)2|(out_max_y-out_min_y)2 outer_diag diou
open self file_path f close
json dump self f close
outputs out_id out_item out_item_single
out_item out_item_single shape dimensions
out_item out_item_single    |0 x
out_item out_item_single    |1 y
out_item out_item_single    |2 w
out_item out_item_single    |3 h
out_item out_item_single conf
out_item out_item_single cls_emb
out_item_single shape dimensions d
out_item_single    |0 x reshape x
out_item_single    |1 y reshape y
out_item_single    |2 w reshape w
out_item_single    |2 w  x_top_left
out_item_single    |3 h reshape h
out_item_single    |3 h  y_top_left
out_item_single conf reshape conf
out_item_single cls_emb reshape -1|80 cls_emb
out_item_single cls_emb flag confidence
np expand_dims np argmax cls_emb|axis cls_argmax reshape cls_argmax
np expand_dims np argmax cls_emb|axis cls_argmax i c
load_checkpoint args pretrained param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
load_param_into_net network set_train False
load_param_into_net network image|input_shape prediction
DetectionEngine args detection detect [output_small|output_me|output_big]|args per_batch_size|image_shape|image_id
DetectionEngine args detection do_nms_for_results
DetectionEngine args detection write_result result_file_path
Tensor data image_shape asnumpy image_shape
Tensor data image_id asnumpy image_id
network image|input_shape prediction output_small
prediction output_small asnumpy output_small
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
args testing_shape ts_shape
load_checkpoint args ckpt_file param_dict
load_param_into_net network|param_dict
Tensor tuple [ts_shape|ts_shape] input_shape
Tensor np zeros [args batch_size|3|ts_shape|ts_shape] input_data
args file_name|file_format file_name
parser parse_args args testing_shape ts_shape
parser parse_args args file_name|file_format file_name
load_param_into_net network|param_dict
argparse ArgumentParser parser
parser parse_known_args _
args max_epoch args t_max
list map int|args lr_epochs split args lr_epochs
os path join args data_dir args data_root
os path join args data_dir args annFile
int os getenv device_id
get_rank args rank
get_group_size args group_size
get_logger args outputs_dir|args rank args logger
args logger save_args args
[int args_training_shape] training_shape
super BuildTrainNetwork|self __init__
network_ self network
criterion self criterion
self network input_data output
self criterion output|label loss_
AverageMeter loss_meter
context reset_auto_parallel_context
ParallelMode STAND_ALONE parallel_mode
ParallelMode DATA_PARALLEL parallel_mode
get_group_size degree
default_recurisive_init network
load_yolov4_params args|network
YoloWithLossCell network network
args logger info
ConfigYOLOV4CspDarkNet53 config
args label_smooth config label_smooth
args label_smooth_factor config label_smooth_factor
[convert_training_shape args training_shape] config multi_scale
args resize_rate config resize_rate
args per_batch_size|max_epoch batch_size
int data_size|args per_batch_size|args group_size args steps_per_epoch
args steps_per_epoch args ckpt_interval
get_lr args lr
Tensor lr learning_rate
args momentum momentum
args weight_decay weight_decay
keep_loss_fp32 network
TrainingWrapper network|opt network
network set_train
args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num
os path join args outputs_dir save_ckpt_path
save_ckpt_path directory
_InternalCallbackParam cb_params
network cb_params train_network
ckpt_max_num cb_params epoch_num
RunContext cb_params run_context
ckpt_cb begin run_context
-1 old_progress
time time t_end
enumerate i|data
data images
images shape input_shape
args logger info  format i|input_shape
Tensor from_numpy images images
Tensor from_numpy data batch_y_true_0
Tensor from_numpy data batch_y_true_1
Tensor from_numpy data batch_y_true_2
Tensor from_numpy data batch_gt_box0
Tensor from_numpy data batch_gt_box1
Tensor from_numpy data batch_gt_box2
Tensor tuple input_shape input_shape
loss_meter update loss asnumpy
i|1 cb_params cur_step_num
i|2 cb_params batch_num
ckpt_cb step_end run_context
time time-t_end time_used
int i|args steps_per_epoch epoch
args per_batch_size|(i-old_progress)args group_size|time_used fps
loss_meter reset
i old_progress
profiler analyse
load_param_into_net network set_train
load_param_into_net network cb_params train_network
argparse ArgumentParser parser parse_known_args _
network_ self network set_train
network_ self network cb_params train_network
AverageMeter loss_meter update loss asnumpy
AverageMeter loss_meter reset
default_recurisive_init network set_train
default_recurisive_init network cb_params train_network
load_yolov4_params args logger info
load_yolov4_params args label_smooth config label_smooth
load_yolov4_params args label_smooth_factor config label_smooth_factor
load_yolov4_params args resize_rate config resize_rate
load_yolov4_params args per_batch_size|max_epoch batch_size
load_yolov4_params args steps_per_epoch args ckpt_interval
load_yolov4_params args momentum momentum
load_yolov4_params args weight_decay weight_decay
load_yolov4_params network set_train
load_yolov4_params args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num
load_yolov4_params network cb_params train_network
load_yolov4_params args logger info  format i|input_shape
load_yolov4_params args per_batch_size|(i-old_progress)args group_size|time_used fps
YoloWithLossCell network network set_train
YoloWithLossCell network network cb_params train_network
keep_loss_fp32 network set_train
keep_loss_fp32 network cb_params train_network
TrainingWrapper network|opt network set_train
TrainingWrapper network|opt network cb_params train_network
args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num cb_params epoch_num
os path join args outputs_dir save_ckpt_path directory
enumerate data images
enumerate i old_progress
data images shape input_shape
args logger info  format i old_progress
argparse ArgumentParser parser
parser parse_known_args _
os path join args data_dir args data_root
os path join args data_dir args ann_file
content self content
args_detection ignore_threshold self ignore_threshold
len self labels self num_classes
args_detection outputs_dir self save_prefix
args_detection ann_file self ann_file
COCO self ann_file self _coco
list sorted self _coco imgs keys self _img_ids
args_detection nms_thresh self nms_thresh
self _coco getCatIds self coco_catids
self results img_id
self results clsi
self results img_id][clsi dets
np array dets dets
int clsi
list dets i astype float
self det_boxes extend keep_box
predicts x1
predicts y1
x1|predicts x2
y1|predicts y2
predicts scores
(x2-x1|1)|(y2-y1|1) areas
scores argsort order
order i
reserved_boxes append i
np maximum x1 i]|x1[order max_x1
np maximum y1 i]|y1[order max_y1
np minimum x2 i]|x2[order min_x2
np minimum y2 i]|y2[order min_y2
np maximum 0 0|min_x2-max_x1|1 intersect_w
np maximum 0 0|min_y2-max_y1|1 intersect_h
intersect_w|intersect_h intersect_area
intersect_area|(areas-intersect_area) ovr
np where ovr indexs
dets x1
dets y1
x1|dets x2
y1|dets y2
dets scores
keep append i
np maximum x1 i]|x1[order xx1
np maximum y1 i]|y1[order yy1
np minimum x2 i]|x2[order xx2
np minimum y2 i]|y2[order yy2
np maximum 0 0|xx2-xx1|1 w
np maximum 0 0|yy2-yy1|1 h
w|h inter
inter|(areas-inter) ovr
(x1)|2 center_x1
(x1)|2 center_x2
(y1)|2 center_y1
(y1)|2 center_y2
(center_x2-center_x1)2|(center_y2-center_y1)2 inter_diag
np maximum x2 i]|x2[order out_max_x
np maximum y2 i]|y2[order out_max_y
np minimum x1 i]|x1[order out_min_x
np minimum y1 i]|y1[order out_min_y
(out_max_x-out_min_x)2|(out_max_y-out_min_y)2 outer_diag
ovr-inter_diag|outer_diag diou
np clip diou|-1|1 diou
np where diou inds
datetime datetime now strftime t
self save_prefix self file_path
open self file_path f
json dump self det_boxes|f
RuntimeError  format str e
f close
COCO self ann_file coco_gt
coco_gt loadRes self file_path coco_dt
COCOeval coco_gt|coco_dt coco_eval
coco_eval evaluate
coco_eval accumulate
Redirct rdct
sys stdout stdout
rdct sys stdout
coco_eval summarize
stdout sys stdout
len outputs outputs_num
range batch_id
range out_id
outputs out_id out_item
out_item out_item_single
out_item_single shape dimensions
dimensions d
image_shape batch_id ori_h
int image_id batch_id img_id
out_item_single    |0 x
out_item_single    |1 y
out_item_single    |2 w
out_item_single    |3 h
out_item_single conf
out_item_single cls_emb
np expand_dims np argmax cls_emb|axis cls_argmax
x reshape x
y reshape y
w reshape w
h reshape h
cls_emb reshape -1|self num_classes cls_emb
conf reshape conf
cls_argmax reshape cls_argmax
x-w|2  x_top_left
y-h|2  y_top_left
np random random cls_emb shape flag
range i
cls_argmax i c
cls_emb flag confidence
zip x_lefti|y_lefti|wi|hi|confi|clsi
defaultdict list self results img_id
max 0|x_lefti x_lefti
max 0|y_lefti y_lefti
min wi|ori_w wi
min hi|ori_h hi
self coco_catids clsi coco_clsi
self results img_id coco_clsi append [x_lefti|y_lefti|wi|hi|confi]
[int args_testing_shape] testing_shape
time time start_time
context GRAPH_MODE mode|args device_target device_target|device_id device_id context set_context
get_logger args outputs_dir|rank_id args logger
context reset_auto_parallel_context
ParallelMode STAND_ALONE parallel_mode
args logger info
args logger info args pretrained
os path isfile args pretrained
load_checkpoint args pretrained param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
args logger info  format args pretrained
FileNotFoundError  format args pretrained
args data_root data_root
args ann_file ann_file
ConfigYOLOV4CspDarkNet53 config
convert_testing_shape args testing_shape config test_img_shape
args logger info  format config test_img_shape
args logger info  format data_size
network set_train False
DetectionEngine args detection
Tensor tuple config test_img_shape input_shape
data image
data image_shape_
data image_id_
network image|input_shape prediction
prediction output_small
output_big asnumpy output_big
output_me asnumpy output_me
output_small asnumpy output_small
image_id_ asnumpy image_id_
image_shape_ asnumpy image_shape_
detection detect [output_small|output_me|output_big]|args per_batch_size|image_shape_|image_id_
args logger info  format indexargs per_batch_size|data_size|100
detection do_nms_for_results
detection write_result result_file_path
args logger info  format result_file_path
detection get_eval_result eval_result
time time-start_time cost_time
args logger info  format cost_time|3600 
argparse ArgumentParser parser parse_known_args _
self results img_id][clsi dets x1
self results img_id][clsi dets y1
self results img_id][clsi dets x2
self results img_id][clsi dets y2
self results img_id][clsi dets scores
np array dets dets x1
np array dets dets y1
np array dets dets x2
np array dets dets y2
np array dets dets scores
predicts x1 x2
predicts x1 areas
predicts x1 x2
predicts y1 y2
predicts y1 areas
predicts y1 y2
predicts scores argsort order
scores argsort order i
order i intersect_area
reserved_boxes append i intersect_area
np maximum 0 0|min_x2-max_x1|1 intersect_w intersect_area
np maximum 0 0|min_y2-max_y1|1 intersect_h intersect_area
intersect_w|intersect_h intersect_area ovr
dets x1 x2
dets y1 y2
np maximum 0 0|xx2-xx1|1 w inter
np maximum 0 0|xx2-xx1|1 w reshape w
np maximum 0 0|xx2-xx1|1 w  x_top_left
np maximum 0 0|yy2-yy1|1 h inter
np maximum 0 0|yy2-yy1|1 h reshape h
np maximum 0 0|yy2-yy1|1 h  y_top_left
w|h inter ovr
(center_x2-center_x1)2|(center_y2-center_y1)2 inter_diag diou
(out_max_x-out_min_x)2|(out_max_y-out_min_y)2 outer_diag diou
open self file_path f close
json dump self f close
COCO self ann_file coco_gt loadRes self file_path coco_dt
COCOeval coco_gt|coco_dt coco_eval evaluate
COCOeval coco_gt|coco_dt coco_eval accumulate
COCOeval coco_gt|coco_dt coco_eval summarize
Redirct rdct sys stdout
sys stdout stdout sys stdout
rdct sys stdout sys stdout
outputs out_id out_item out_item_single
out_item out_item_single shape dimensions
out_item out_item_single    |0 x
out_item out_item_single    |1 y
out_item out_item_single    |2 w
out_item out_item_single    |3 h
out_item out_item_single conf
out_item out_item_single cls_emb
out_item_single shape dimensions d
out_item_single    |0 x reshape x
out_item_single    |1 y reshape y
out_item_single    |2 w reshape w
out_item_single    |2 w  x_top_left
out_item_single    |3 h reshape h
out_item_single    |3 h  y_top_left
out_item_single conf reshape conf
out_item_single cls_emb reshape -1|self num_classes cls_emb
out_item_single cls_emb flag confidence
np expand_dims np argmax cls_emb|axis cls_argmax reshape cls_argmax
np expand_dims np argmax cls_emb|axis cls_argmax i c
load_checkpoint args pretrained param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
load_param_into_net network set_train False
load_param_into_net network image|input_shape prediction
DetectionEngine args detection detect [output_small|output_me|output_big]|args per_batch_size|image_shape_|image_id_
DetectionEngine args detection do_nms_for_results
DetectionEngine args detection write_result result_file_path
DetectionEngine args detection get_eval_result eval_result
data image_shape_ asnumpy image_shape_
data image_id_ asnumpy image_id_
network image|input_shape prediction output_small
prediction output_small asnumpy output_small
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step lr
lr base_lr
int max_epoch|steps_per_epoch total_steps
int warmup_epochs|steps_per_epoch warmup_steps
lr_epochs milestones
milestones milestone
milestone|steps_per_epoch milestones_step
milestones_steps append milestones_step
base_lr lr
Counter milestones_steps milestones_steps_counter
range i
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr
lr|gammamilestones_steps_counter[i] lr
lr_each_step append lr
np array lr_each_step astype np float32
lr_epochs append i
i||steps_per_epoch last_epoch
eta_min|(base_lr-eta_min)|(1 |math cos(math pi|last_epoch|t_max))|2 lr
int max_epoch|1|3 t_max_v2
lr last_lr
last_epoch last_epoch_v1
last_lr base_lr
last_epoch-last_epoch_v1 last_epoch
eta_min|(base_lr-eta_min)|(1 |math cos(math pi|last_epoch|t_max_v2))|2 lr
start_sample_epoch|step_sample|tobe_sampled_epoch end_sampled_epoch
max_epoch|tobe_sampled_epoch max_sampled_epoch
max_sampled_epoch t_max
int max_sampled_epoch|steps_per_epoch total_sampled_steps
range start_sample_epoch|end_sampled_epoch|step_sample
args lr_gamma gamma
NotImplementedError args lr_scheduler
float init_lr|lr_inc|current_step lr base_lr
float init_lr|lr_inc|current_step lr lr
float init_lr|lr_inc|current_step lr last_lr
lr base_lr lr
lr_epochs milestones milestone
milestones milestone milestones_step
base_lr lr lr
base_lr lr last_lr
range i last_epoch
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr lr
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr last_lr
lr|gammamilestones_steps_counter[i] lr lr
lr|gammamilestones_steps_counter[i] lr last_lr
lr_each_step append lr last_lr
lr_epochs append i last_epoch
i||steps_per_epoch last_epoch last_epoch_v1
eta_min|(base_lr-eta_min)|(1 |math cos(math pi|last_epoch|t_max))|2 lr last_lr
lr last_lr base_lr
max_epoch|tobe_sampled_epoch max_sampled_epoch t_max
np random rand|(b-a)
Union IOU
width orheight
np maximum bbox_a tl
np minimum bbox_a br
isinstance img|Image Image
np array img img
img|255  img
np array [0 485|0 456|0 406] mean
np array [0 229|0 224|0 225] std
(img-mean)|std img
autowillreturnAreaanyway Default:
sizes nw
random randint 0|4
ValueError %interp
np array anchors anchors
anchors shape||3 num_layers
 [6|7|8]|[3|4|5]|[0|1|2] anchor_mask
(true_boxes)||2  boxes_xy
true_boxes boxes_wh
boxes_xy|input_shape true_boxes
boxes_wh|input_shape true_boxes
[input_shape||32|input_shape||16|input_shape||8] grid_shapes
np expand_dims anchors|0 anchors
anchors|2  anchors_max
-anchors_max anchors_min
boxes_wh    |0 valid_mask
boxes_wh valid_mask wh
np expand_dims wh|-2 wh
wh|2  boxes_max
-boxes_max boxes_min
np maximum boxes_min|anchors_min intersect_min
np minimum boxes_max|anchors_max intersect_max
np maximum intersect_max-intersect_min|0  intersect_wh
intersect_wh    |0]|intersect_wh[   |1 intersect_area
wh    |0]|wh[   |1 box_area
anchors    |0]|anchors[   |1 anchor_area
intersect_area|(box_area|anchor_area-intersect_area) iou
np argmax iou|axis best_anchor
enumerate t|n
range l
np floor true_boxes t|0]|grid_shapes[l i
np floor true_boxes t|1]|grid_shapes[l j
anchor_mask l n k
true_boxes t|4 c
label_smooth_factor|(num_classes-1) sigma
sigma y_true
(iou) threshold_anchor
range t
range n
np zeros shape pad_gt_box0
np zeros shape pad_gt_box1
np zeros shape pad_gt_box2
np reshape y_true mask0
np reshape y_true gt_box0
gt_box0 pad_gt_box0
np reshape y_true mask1
np reshape y_true gt_box1
gt_box1 pad_gt_box1
np reshape y_true mask2
np reshape y_true gt_box2
gt_box2 pad_gt_box2
isinstance image|Image Image
Image fromarray image image
image size ori_h
np array [ori_w|ori_h]|np int32 ori_image_shape
image_size w
image resize (w|h) image
np expand_dims image_data|axis image_data
np concatenate [image_data|image_data|image_data]|axis image_data
image_data astype np float32 image_data
_rand -hue|hue hue
_rand 1|satif_rand sat
_rand 1|valif_rand val
cv2 setNumThreads
cv2 cvtColor img|cv2 COLOR_RGB2HSV_FULL x
x|255  x
x astype np uint8 x
cv2 cvtColor x|cv2 COLOR_HSV2RGB_FULL image_data
img transpose Image FLIP_LEFT_RIGHT
np expand_dims img|axis img
np concatenate [img|img|img]|axis img
bbox_iou box|crop_box iou
[ 0|0|input_w|input_h] candidates
constraints constraint
constraint max_iou
-np infifmin_iouisNoneelsemin_iou min_iou
range _
float input_w|float(input_h)|_rand(1-jitter|1|jitter)|_rand(1-jitter|1|jitter) new_ar
_rand 0 25|2 scale
int scale|input_h nh
int nh|new_ar nw
int scale|input_w nw
int nw|new_ar nh
int _rand 0|input_w-nw dx
int _rand 0|input_h-nh dy
copy deepcopy box t_box
np array (0|0|input_w|input_h) crop_box
_is_iou_satisfied_constraint min_iou|max_iou|t_box|crop_box[np newaxis]
candidates append (dx|dy|nw|nh)
len candidates
candidates pop np random randint 1|len(candidates) candidate
candidates pop np random randint 0|len(candidates) candidate
candidate nh
input_w t_box
input_h t_box
t_box box_w
t_box box_h
t_box[np logical_and box_w] t_box
t_box box_data
image size image_h
image_input_size input_w
np random shuffle box
len box
_rand flip
np zeros (max_boxes|5) box_data
image resize (nw|nh) image
Image new (input_w|input_h) new_image
new_image paste image|(dx|dy)
new_image image
filp_pil_image image image
np array image image
convert_gray_to_color image image
color_distortion image|hue|sat|val|device_num image_data
config max_box max_boxes
config jitter jitter
config hue hue
config saturation sat
config value val
config test_img_shape input_size
_reshape_data image|image_size ori_image_shape
config self config
config resize_rate self resize_rate
config dataset_size self dataset_size
int 1e6 self seed_num
self generate_seed_list seed_num self seed_list
int np ceil self dataset_size|self resize_rate self resize_count_num
device_num self device_num
config anchor_scales self anchor_scales
config num_classes self num_classes
config max_box self max_box
config label_smooth self label_smooth
config label_smooth_factor self label_smooth_factor
random seed init_seed
random randint seed_range|seed_range seed
seed_list append seed
batch_info get_epoch_num epoch_num
int batch_info get_batch_num|self resize_rate size_idx
self seed_list seed_key
self size_dict get seed_key|None
random seed seed_key
random choice self config multi_scale new_size
new_size self size_dict seed_key
seed_key seed
self size_dict seed input_size
zip img|anno
preprocess_fn img|anno|self config|input_size|self device_num anno
ret_imgs append img transpose 2|0|1 copy
 gt_box3
self num_classes|max_boxes num_classes
bbox1 append bbox_true_1
bbox2 append bbox_true_2
bbox3 append bbox_true_3
gt1 append gt_box1
gt2 append gt_box2
gt3 append gt_box3
ret_annos append
np array ret_imgs|np array ret_annos|np array bbox1|np array bbox2|np array bbox3
np array gt1|np array gt2|np array gt3
annos anno
config num_classes|max_boxes num_classes
bbox_true_1 batch_bbox_true_1
bbox_true_2 batch_bbox_true_2
bbox_true_3 batch_bbox_true_3
gt_box1 batch_gt_box1
gt_box2 batch_gt_box2
gt_box3 batch_gt_box3
i|1 i
range index
batch_bbox_true_1 append None
batch_bbox_true_2 append None
batch_bbox_true_3 append None
batch_gt_box1 append None
batch_gt_box2 append None
batch_gt_box3 append None
annos step_anno
t start
threads append t
threads t
t join
np array batch_bbox_true_1|np array batch_bbox_true_2|np array batch_bbox_true_3
np array batch_gt_box1|np array batch_gt_box2|np array batch_gt_box3
batch_bbox_true_1 append bbox_true_1
batch_bbox_true_2 append bbox_true_2
batch_bbox_true_3 append bbox_true_3
batch_gt_box1 append gt_box1
batch_gt_box2 append gt_box2
batch_gt_box3 append gt_box3
np random  [6|7|8]|[3|4|5]|[0|1|2] anchor_mask
np random  gt_box3
isinstance img|Image Image fromarray image image
isinstance img|Image Image new (input_w|input_h) new_image
np array img img  img
np array img img transpose Image FLIP_LEFT_RIGHT
img|255  img  img
img|255  img transpose Image FLIP_LEFT_RIGHT
np array [0 229|0 224|0 225] std img
(img-mean)|std img transpose Image FLIP_LEFT_RIGHT
random randint  [6|7|8]|[3|4|5]|[0|1|2] anchor_mask
random randint  gt_box3
np array anchors anchors shape||3 num_layers
np array anchors anchors  anchors_max
np array anchors anchors    |0]|anchors[   |1 anchor_area
 [6|7|8]|[3|4|5]|[0|1|2] anchor_mask l n k
(true_boxes)||2  boxes_xy true_boxes
true_boxes boxes_wh true_boxes
true_boxes boxes_wh    |0 valid_mask
true_boxes boxes_wh valid_mask wh
boxes_xy|input_shape true_boxes t|4 c
boxes_wh|input_shape true_boxes t|4 c
np expand_dims anchors|0 anchors  anchors_max
np expand_dims anchors|0 anchors    |0]|anchors[   |1 anchor_area
boxes_wh valid_mask wh  boxes_max
boxes_wh valid_mask wh    |0]|wh[   |1 box_area
np expand_dims wh|-2 wh  boxes_max
np expand_dims wh|-2 wh    |0]|wh[   |1 box_area
np maximum intersect_max-intersect_min|0  intersect_wh    |0]|intersect_wh[   |1 intersect_area
intersect_wh    |0]|intersect_wh[   |1 intersect_area iou
wh    |0]|wh[   |1 box_area iou
anchors    |0]|anchors[   |1 anchor_area iou
enumerate  gt_box3
enumerate t start
enumerate t join
np floor true_boxes t|0]|grid_shapes[l i ori_image_shape
np floor true_boxes t|0]|grid_shapes[l i i
label_smooth_factor|(num_classes-1) sigma y_true
range t start
range t join
np reshape y_true gt_box0 pad_gt_box0
np reshape y_true gt_box1 pad_gt_box1
np reshape y_true gt_box1 batch_gt_box1
np reshape y_true gt_box2 pad_gt_box2
np reshape y_true gt_box2 batch_gt_box2
isinstance image|Image Image fromarray image image
isinstance image|Image Image new (input_w|input_h) new_image
Image fromarray image image size ori_h
Image fromarray image image resize (w|h) image
Image fromarray image image size image_h
Image fromarray image image resize (nw|nh) image
Image fromarray image image ori_image_shape
np expand_dims image_data|axis image_data astype np float32 image_data
np concatenate [image_data|image_data|image_data]|axis image_data astype np float32 image_data
cv2 cvtColor img|cv2 COLOR_RGB2HSV_FULL x  x
cv2 cvtColor img|cv2 COLOR_RGB2HSV_FULL x astype np uint8 x
x|255  x  x
x|255  x astype np uint8 x
[ 0|0|input_w|input_h] candidates append (dx|dy|nw|nh)
[ 0|0|input_w|input_h] candidates pop np random randint 1|len(candidates) candidate
[ 0|0|input_w|input_h] candidates pop np random randint 0|len(candidates) candidate
constraints constraint max_iou
copy deepcopy box t_box box_w
copy deepcopy box t_box box_h
copy deepcopy box t_box box_data
candidates append  gt_box3
len candidates pop np random randint 1|len(candidates) candidate
len candidates pop np random randint 0|len(candidates) candidate
candidates pop np random randint 1|len(candidates) candidate nh
candidates pop np random randint 0|len(candidates) candidate nh
input_w t_box box_w
input_w t_box box_h
input_w t_box box_data
input_h t_box box_w
input_h t_box box_h
input_h t_box box_data
t_box[np logical_and box_w] t_box box_data
Image new (input_w|input_h) new_image paste image|(dx|dy)
Image new (input_w|input_h) new_image image
new_image paste  gt_box3
new_image image ori_image_shape
filp_pil_image image image ori_image_shape
np array image image ori_image_shape
convert_gray_to_color image image ori_image_shape
self generate_seed_list seed_num self seed_list append seed
self seed_list seed_key seed
self size_dict get seed_key seed
self size_dict get  gt_box3
random seed seed_key seed
random choice self config multi_scale new_size self size_dict seed_key
new_size self size_dict seed_key seed
zip  gt_box3
 gt_box3 batch_gt_box3
bbox1 append bbox_true_1 batch_bbox_true_1
bbox2 append bbox_true_2 batch_bbox_true_2
bbox3 append bbox_true_3 batch_bbox_true_3
gt1 append gt_box1 batch_gt_box1
gt2 append gt_box2 batch_gt_box2
gt3 append gt_box3 batch_gt_box3
bbox_true_1 batch_bbox_true_1 append None
bbox_true_1 batch_bbox_true_1 append bbox_true_1
bbox_true_2 batch_bbox_true_2 append None
bbox_true_2 batch_bbox_true_2 append bbox_true_2
bbox_true_3 batch_bbox_true_3 append None
bbox_true_3 batch_bbox_true_3 append bbox_true_3
gt_box1 batch_gt_box1 append None
gt_box1 batch_gt_box1 append gt_box1
gt_box2 batch_gt_box2 append None
gt_box2 batch_gt_box2 append gt_box2
gt_box3 batch_gt_box3 append None
gt_box3 batch_gt_box3 append gt_box3
i|1 i i
threads append t join
threads t join
np array batch_bbox_true_1|np array batch_bbox_true_2|np array batch_bbox_true_3 append bbox_true_3
np array batch_gt_box1|np array batch_gt_box2|np array batch_gt_box3 append gt_box3
np array batch_gt_box1|np array batch_gt_box2|np array batch_gt_box3
[32|64|128|256|512] backbone_input_shape
[64|128|256|512|1024] backbone_shape
[1|2|8|8|4] backbone_layers
[608|608] test_img_shape
name self name
fmt self fmt
self reset
tb_writer self tb_writer
val self val
val|n self sum
n self count
self sum|self count self avg
self tb_writer add_scalar self name|self val|self cur_step
fmtstr format self __dict__
load_checkpoint ckpt_path param_dict
net init_parameters_data
net cells_and_names name|cell
name startswith yolo_backbone_prefix
name replace yolo_backbone_prefix|darknet_backbone_prefix name
isinstance cell|(nn Conv2d|nn Dense)
cell weight set_data param_dict darknet_weight data
find_param append darknet_weight
not_found_param append darknet_weight
cell bias set_data param_dict darknet_bias data
find_param append darknet_bias
not_found_param append darknet_bias
isinstance cell|(nn BatchNorm2d|nn BatchNorm1d)
cell moving_mean set_data param_dict darknet_moving_mean data
find_param append darknet_moving_mean
not_found_param append darknet_moving_mean
cell moving_variance set_data param_dict darknet_moving_variance data
find_param append darknet_moving_variance
not_found_param append darknet_moving_variance
cell gamma set_data param_dict darknet_gamma data
find_param append darknet_gamma
not_found_param append darknet_gamma
cell beta set_data param_dict darknet_beta data
find_param append darknet_beta
not_found_param append darknet_beta
args logger info find_param
args logger info not_found_param
x name parameter_name
parameter_name endswith
network trainable_params x
no_decay_params append x
decay_params append x
len shape
int shape shape
self shape_record key
self shape_record key rate
logger info  format key|rate|100
network cells_and_names _|cell
isinstance cell|(YoloLossBlock|)
cell to_float mstype float32
net cells_and_names name startswith yolo_backbone_prefix
net cells_and_names name replace yolo_backbone_prefix|darknet_backbone_prefix name
net cells_and_names cell weight set_data param_dict darknet_weight data
net cells_and_names cell bias set_data param_dict darknet_bias data
net cells_and_names cell moving_mean set_data param_dict darknet_moving_mean data
net cells_and_names cell moving_variance set_data param_dict darknet_moving_variance data
net cells_and_names cell gamma set_data param_dict darknet_gamma data
net cells_and_names cell beta set_data param_dict darknet_beta data
net cells_and_names cell to_float mstype float32
x name parameter_name endswith
network cells_and_names cell to_float mstype float32
isinstance cell to_float mstype float32
super LOGGER|self __init__ logger_name
rank self rank
logging StreamHandler sys stdout console
console setLevel logging INFO
logging Formatter formatter
console setFormatter formatter
self addHandler console
os path exists log_dir
datetime now strftime| format rank log_name
os path join log_dir|log_name self log_fn
logging FileHandler self log_fn fh
fh setLevel logging INFO
fh setFormatter formatter
self addHandler fh
self isEnabledFor logging INFO
self _log logging INFO|msg|args|kwargs
self info
vars args args_dict
args_dict keys key
self info key|args_dict[key]
|line_width important_msg
|2 important_msg
self info important_msg|args|kwargs
LOGGER rank logger
logger setup_logging_file path|rank
logging StreamHandler sys stdout console setLevel logging INFO
logging StreamHandler sys stdout console setFormatter formatter
logging FileHandler self log_fn fh setLevel logging INFO
logging FileHandler self log_fn fh setFormatter formatter
vars args args_dict keys key
LOGGER rank logger setup_logging_file path|rank
math sqrt
isinstance param|boolandisinstance param|intorisinstance param|float
param negative_slope
ValueError  format param
math sqrt 2 0|(1|negative_slope2)
ValueError  format nonlinearity
arr reshape arr
num arr
isinstance num|np ndarray
mode lower mode
ValueError  format mode|valid_modes
_calculate_fan_in_and_fan_out array fan_out
mathcal{U}(-\text{bound}|\text{bound})
 text{bound}
np empty 3|5 w
_calculate_correct_fan arr|mode fan
calculate_gain nonlinearity|a gain
gain|math sqrt fan std
math sqrt|std bound
np random uniform -bound|bound|arr shape
len arr shape dimensions
arr shape num_input_fmaps
arr shape num_output_fmaps
num_input_fmaps|receptive_field_size fan_in
num_output_fmaps|receptive_field_size fan_out
super KaimingUniform|self __init__
a self a
mode self mode
nonlinearity self nonlinearity
kaiming_uniform_ arr|self a|self mode|self nonlinearity tmp
_assignment arr|tmp
custom_cell cells_and_names _|cell
isinstance cell|nn Conv2d
_calculate_fan_in_and_fan_out cell weight _
isinstance cell|nn Dense
isinstance cell|(nn BatchNorm2d|nn BatchNorm1d)
load_backbone network|args pretrained_backbone|args network
args logger info  format args pretrained_backbone
args logger info
load_checkpoint args resume_yolov4 param_dict
param_dict items key|values
key startswith
values param_dict_new key
args logger info  format key
load_param_into_net network|param_dict_new
args logger info  format args resume_yolov4
isinstance param|boolandisinstance param|intorisinstance param negative_slope
isinstance param|boolandisinstance param|intorisinstance  text{bound}
math sqrt 2  text{bound}
ValueError  format nonlinearity self nonlinearity
num arr shape num_input_fmaps
num arr shape num_output_fmaps
ValueError  format  text{bound}
ValueError  format mode self mode
calculate_gain nonlinearity|a gain sqrt fan std
arr shape num_input_fmaps fan_in
arr shape num_output_fmaps fan_out
load_checkpoint args resume_yolov4 param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
super XYLoss|self __init__
P SigmoidCrossEntropyWithLogits self cross_entropy
P ReduceSum self reduce_sum
object_mask|box_loss_scale|self cross_entropy predict_xy|true_xy xy_loss
self reduce_sum xy_loss xy_loss
super WHLoss|self __init__
P Square self square
object_mask|box_loss_scale|0 5|P Square true_wh-predict_wh wh_loss
self reduce_sum wh_loss wh_loss
super ConfidenceLoss|self __init__
self cross_entropy predict_confidence|object_mask confidence_loss
object_mask|confidence_loss|(1-object_mask)|confidence_loss|ignore_mask confidence_loss
self reduce_sum confidence_loss confidence_loss
super ClassLoss|self __init__
object_mask|self cross_entropy predict_class|class_probs class_loss
self reduce_sum class_loss class_loss
self cross_entropy predict_confidence|object_mask confidence_loss confidence_loss
object_mask|confidence_loss|(1-object_mask)|confidence_loss|ignore_mask confidence_loss confidence_loss
super Mish|self __init__
P Mul self mul
P Tanh self tanh
P Softplus self softplus
self softplus input_x res1
self tanh res1 tanh
self mul input_x|tanh output
ResidualBlock 3|208
super ResidualBlock|self __init__
out_channels out_chls
P TensorAdd self add
x identity
self conv1 x out
self conv2 out out
self add out|identity out
tensor|(f1|f2|f3|f4|f5)
DarkNet ResidualBlock
super CspDarkNet53|self __init__
detect self detect
_make_layer ConvBlock|1|128|256
block in_channel|out_channel darkblk
layers append darkblk
range _
block out_channel|out_channel darkblk
nn SequentialCell layers
self conv0 x c1
self conv1 c1 c2
self conv2 c2 c3
self conv3 c3 c4
self conv4 c4 c5
self add c3|c5 c6
self conv5 c6 c7
self conv6 c2 c8
self concat (c7|c8) c9
self conv7 c9 c10
self conv8 c10 c11
self conv9 c11 c12
self layer2 c12 c13
self conv10 c13 c14
self conv11 c11 c15
self concat (c14|c15) c16
self conv12 c16 c17
self conv13 c17 c18
self conv14 c18 c19
self layer3 c19 c20
self conv15 c20 c21
self conv16 c18 c22
self concat (c21|c22) c23
self conv17 c23 c24
self conv18 c24 c25
self conv19 c25 c26
self layer4 c26 c27
self conv20 c27 c28
self conv21 c25 c29
self concat (c28|c29) c30
self conv22 c30 c31
self conv23 c31 c32
self conv24 c32 c33
self layer5 c33 c34
self conv25 c34 c35
self conv26 c32 c36
self concat (c35|c36) c37
self conv27 c37 c38
annifv v
_has_only_empty_bbox anno
COCO ann_file self coco
root self root
list sorted self coco imgs keys self img_ids
filter_crowd_anno self filter_crowd_anno
is_training self is_training
self img_ids img_id
self coco loadAnns ann_ids anno
has_valid_annotation anno
img_ids append img_id
img_ids self img_ids
enumerate i|v
self cat_ids_to_continuous_ids items k|v
self coco coco
self img_ids index img_id
coco loadImgs img_id img_path
Image open os path join self root|img_path convert img
coco getAnnIds imgIds ann_ids
coco loadAnns ann_ids target
boxes target
classes target
target bboxes
target labels
zip bbox|label
self _conve_top_down bbox bbox
tmp extend bbox
tmp append int label
out_target append tmp
len self img_ids
bbox x_min
bbox y_min
bbox w
bbox h
cv2 setNumThreads
DistributedSampler len yolo_dataset distributed_sampler
CV HWC2CHW hwc_to_chw
len yolo_dataset config dataset_size
multiprocessing cpu_count cores
int cores|device_num num_parallel_workers
MultiScaleTrans config|device_num multi_scale_trans
min 32|num_parallel_workers num_parallel_workers
de GeneratorDataset yolo_dataset|column_names ds
ds repeat max_epoch ds
len yolo_dataset
open data_txt|
f line
image_list append os path basename line strip
image_list self img_path
self img_path img_path
self img_path index img_id
Image open os path join self root|img_path[index] convert img
int img_id
len self img_path
COCOYoloDatasetv2 root yolo_dataset
COCO ann_file self coco loadImgs img_id img_path
COCO ann_file self coco getAnnIds imgIds ann_ids
COCO ann_file self coco loadAnns ann_ids target
list sorted self coco imgs keys self img_ids append img_id
list sorted self coco imgs keys self img_ids self img_ids
self coco coco loadImgs img_id img_path
self coco coco getAnnIds imgIds ann_ids
self coco coco loadAnns ann_ids target
coco loadAnns ann_ids target bboxes
coco loadAnns ann_ids target labels
boxes target bboxes
boxes target labels
classes target bboxes
classes target labels
zip bbox x_min
zip bbox y_min
zip bbox w
zip bbox h
self _conve_top_down bbox bbox x_min
self _conve_top_down bbox bbox y_min
self _conve_top_down bbox bbox w
self _conve_top_down bbox bbox h
tmp extend bbox x_min
tmp extend bbox y_min
tmp extend bbox w
tmp extend bbox h
de GeneratorDataset yolo_dataset|column_names ds repeat max_epoch ds
ksize kernel_size
momentum|eps momentum
tensor|(f1|f2|f3)
YoloBlock 1024|512|255
super YoloBlock|self __init__
out_chls|2 out_chls_2
self conv0 x c1
self conv1 c1 c2
self conv2 c2 c3
self conv3 c3 c4
self conv4 c4 c5
self conv5 c5 c6
self conv6 c6 out
CspDarkNet53 backbone
[64|128|256|512|1024] backbone_shape
super YOLOv4|self __init__
out_channel self out_channel
backbone self backbone
YoloBlock backbone_shape|out_chls self backblock0
YoloBlock backbone_shape|out_chls self backblock1
YoloBlock backbone_shape|out_chls self backblock2
YoloBlock backbone_shape|out_chls self backblock3
P Shape x img_hight
P Shape x img_width
self backbone x feature_map3
self conv1 feature_map3 con1
self conv2 con1 con2
self conv3 con2 con3
self maxpool1 con3 m1
self maxpool2 con3 m2
self maxpool3 con3 m3
self concat (m3|m2|m1|con3) spp
self conv4 spp con4
self conv5 con4 con5
self conv6 con5 con6
self conv7 con6 con7
P ResizeNearestNeighbor (img_hight|16|img_width|16)(con7) ups1
self conv8 feature_map2 con8
self concat (ups1|con8) con9
self backblock0 con9 _
self conv9 con10 con11
P ResizeNearestNeighbor (img_hight|8|img_width|8)(con11) ups2
self conv10 feature_map1 con12
self concat (ups2|con12) con13
self backblock1 con13 small_object_output
self conv11 con14 con15
self concat (con15|con10) con16
self backblock2 con16 medium_object_output
self conv12 con17 con18
self concat (con18|con6) con19
self backblock3 con19 big_object_output
super DetectionBlock|self __init__
config self config
(0|1|2) idx
(3|4|5) idx
(6|7|8) idx
Tensor  self config anchor_scales i self anchors
nn Sigmoid self sigmoid
P Reshape self reshape
P Tile self tile
P Concat axis self concat
is_training self conf_training
P Shape x num_batch
P Shape x grid_size
P Transpose prediction|(0|3|4|1|2) prediction
range grid_size range_x
range grid_size range_y
P Cast F tuple_to_array range_x grid_x
P Cast F tuple_to_array range_y grid_y
self tile self reshape grid_x|(1|1|-1|1|1) grid_x
self tile self reshape grid_y|(1|-1|1|1|1) grid_y
self concat (grid_x|grid_y) grid
prediction box_xy
prediction box_wh
prediction box_confidence
prediction box_probs
(self scale_x_y|self sigmoid box_xy-self offset_x_y|grid)| box_xy
P Cast F tuple_to_array (grid_size|grid_size)|ms float32
P Exp box_wh|self anchors|input_shape box_wh
self sigmoid box_confidence box_confidence
self sigmoid box_probs box_probs
self concat (box_xy|box_wh|box_confidence|box_probs)
super Iou|self __init__
P Minimum self min
P Maximum self max
box1 box1_xy
box1 box1_wh
box1_xy-box1_wh|F scalar_to_array box1_mins
box1_xy|box1_wh|F scalar_to_array box1_maxs
box2 box2_xy
box2 box2_wh
box2_xy-box2_wh|F scalar_to_array box2_mins
box2_xy|box2_wh|F scalar_to_array box2_maxs
self max box1_mins|box2_mins intersect_mins
self min box1_maxs|box2_maxs intersect_maxs
self max intersect_maxs-intersect_mins|F scalar_to_array intersect_wh
P Squeeze intersect_wh| intersect_area
P Squeeze intersect_wh
P Squeeze box1_wh box1_area
P Squeeze box2_wh box2_area
intersect_area|(box1_area|box2_area-intersect_area) iou
super YoloLossBlock|self __init__
Tensor self config ignore_threshold|ms float32 self ignore_threshold
Iou self iou
XYLoss self xy_loss
WHLoss self wh_loss
ConfidenceLoss self confidence_loss
ClassLoss self class_loss
P ReduceSum self reduce_sum
Giou self giou
 sigmoid xy|grid
 exp wh|anchors
y_true object_mask
y_true class_probs
y_true true_boxes
P Shape prediction grid_shape
P Cast F tuple_to_array grid_shape grid_shape
self concat (pred_xy|pred_wh) pred_boxes
y_true true_wh
P Log true_wh|self anchors|input_shape true_wh
P Shape gt_box gt_shape
P Reshape gt_box|(gt_shape|1|1|1|gt_shape|gt_shape) gt_box
self iou P ExpandDims pred_boxes|-2 iou
self reduce_max iou|-1 best_iou
best_iou ignore_mask
P Cast ignore_mask|ms float32 ignore_mask
P ExpandDims ignore_mask|-1 ignore_mask
F stop_gradient ignore_mask ignore_mask
self confidence_loss object_mask|prediction|ignore_mask confidence_loss
self class_loss object_mask|prediction|class_probs class_loss
P Reshape object_mask|(-1|1) object_mask_me
P Reshape box_loss_scale|(-1|1) box_loss_scale_me
xywh2x1y1x2y2 pred_boxes pred_boxes_me
P Reshape pred_boxes_me|(-1|4) pred_boxes_me
xywh2x1y1x2y2 true_boxes true_boxes_me
P Reshape true_boxes_me|(-1|4) true_boxes_me
self giou pred_boxes_me|true_boxes_me ciou
object_mask_me|box_loss_scale_me|(1-ciou) ciou_loss
self reduce_sum ciou_loss ciou_loss_me
ciou_loss_me|10|confidence_loss|class_loss loss
P Shape prediction batch_size
YOLOV4CspDarkNet53 True
super YOLOV4CspDarkNet53|self __init__
ConfigYOLOV4CspDarkNet53 self config
self config backbone_shape backbone_shape
DetectionBlock is_training self detect_1
DetectionBlock is_training self detect_2
DetectionBlock is_training self detect_3
self feature_map x small_object_output
self detect_1 big_object_output|input_shape output_big
self detect_2 medium_object_output|input_shape output_me
self detect_3 small_object_output|input_shape output_small
super YoloWithLossCell|self __init__
network self yolo_network
YoloLossBlock self config self loss_big
YoloLossBlock self config self loss_me
YoloLossBlock self config self loss_small
self yolo_network x|input_shape yolo_out
self loss_big |yolo_out|y_true_0|gt_0|input_shape loss_l
self loss_me |yolo_out|y_true_1|gt_1|input_shape loss_m
self loss_small |yolo_out|y_true_2|gt_2|input_shape loss_s
network self network
self network set_grad
optimizer parameters self weights
optimizer self optimizer
sens self sens
context get_auto_parallel_context self parallel_mode
context get_auto_parallel_context mean
auto_parallel_context get_device_num_is_set
context get_auto_parallel_context degree
get_group_size degree
nn DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
self weights weights
self network args loss
P Fill P DType loss sens
self grad self network|weights(args|sens) grads
self grad_reducer grads grads
F depend loss|self optimizer grads
super Giou|self __init__
P Cast self cast
P ReduceMean self mean
P RealDiv self div
(box_p) box_p_area
(box_gt) box_gt_area
self max box_p x_1
self min box_p x_2
self max box_p y_1
self min box_p y_2
(y_2-y_1)|(x_2-x_1) intersection
self min box_p xc_1
self max box_p xc_2
self min box_p yc_1
self max box_p yc_2
(xc_2-xc_1)|(yc_2-yc_1) c_area
box_p_area|box_gt_area-intersection union
union|self eps union
c_area|self eps c_area
self div self cast intersection|ms float32 iou
c_area-union res_mid0
self div self cast res_mid0|ms float32 res_mid1
iou-res_mid1 giou
C clip_by_value giou|-1 0|1 0 giou
box_xywh|2 boxes_x1
box_xywh|2 boxes_y1
box_xywh|2 boxes_x2
box_xywh|2 boxes_y2
P Concat (boxes_x1|boxes_y1|boxes_x2|boxes_y2) boxes_x1y1x2y2
momentum|eps momentum momentum
YoloBlock  sigmoid xy|grid
YoloBlock  exp wh|anchors
self conv6 c6 out self backblock0
self conv6 c6 out self backblock1
self conv6 c6 out self backblock2
self conv6 c6 out self backblock3
CspDarkNet53 backbone self backbone
[64|128|256|512|1024] backbone_shape self backblock0
[64|128|256|512|1024] backbone_shape self backblock1
[64|128|256|512|1024] backbone_shape self backblock2
[64|128|256|512|1024] backbone_shape self backblock3
P Transpose prediction|(0|3|4|1|2) prediction box_xy
P Transpose prediction|(0|3|4|1|2) prediction box_wh
P Transpose prediction|(0|3|4|1|2) prediction box_confidence
P Transpose prediction|(0|3|4|1|2) prediction box_probs
self concat  sigmoid xy|grid
self concat  exp wh|anchors
box1 box1_xy scalar_to_array box1_maxs
box1 box1_wh scalar_to_array box1_mins
box1 box1_wh scalar_to_array box1_maxs
box2 box2_xy scalar_to_array box2_maxs
box2 box2_wh scalar_to_array box2_mins
box2 box2_wh scalar_to_array box2_maxs
P Squeeze intersect_wh| intersect_area iou
P Squeeze box1_wh box1_area iou
P Squeeze box2_wh box2_area iou
ConfidenceLoss self confidence_loss loss
ClassLoss self class_loss loss
 sigmoid  sigmoid xy|grid
 sigmoid  exp wh|anchors
 exp  exp wh|anchors
self reduce_max iou|-1 best_iou ignore_mask
self confidence_loss object_mask|prediction|ignore_mask confidence_loss loss
self class_loss object_mask|prediction|class_probs class_loss loss
P Reshape object_mask|(-1|1) object_mask_me ciou_loss
P Reshape box_loss_scale|(-1|1) box_loss_scale_me ciou_loss
self reduce_sum ciou_loss ciou_loss_me loss
ciou_loss_me|10|confidence_loss|class_loss loss loss
(box_p) box_p_area union
(box_gt) box_gt_area union
(xc_2-xc_1)|(yc_2-yc_1) c_area eps c_area
box_p_area|box_gt_area-intersection union eps union
union|self eps union eps union
c_area|self eps c_area eps c_area
super Giou|self __init__
dataset_size self dataset_size
num_replicas self num_replicas
rank self rank
int math ceil dataset_size|1 0|self num_replicas self num_samples
self num_samples|self num_replicas self total_size
shuffle self shuffle
np random RandomState seed indices
indices tolist indices
list range self dataset_size indices
iter indices
np random RandomState seed indices tolist indices
yolov3_resnet18 ConfigYOLOV3ResNet18 yolov3_resnet18_net
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
ConfigYOLOV3ResNet18 config
yolov3_resnet18 config network
load_checkpoint args ckpt_file param_dict
load_param_into_net network|param_dict
network set_train False
[args batch_size|3]|config img_shape shape
Tensor np zeros shape input_data
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
yolov3_resnet18 config network set_train False
load_param_into_net network set_train False
files  ckpt
|data|Mindrecord_train mindrecord_dir
range i
lr_each_step append learning_rate|(decay_rate(i||decay_step))
lr_each_step append learning_rate|(decay_rate(i|decay_step))
np array lr_each_step astype np float32 lr_each_step
network trainable_params params
params p
isinstance p data|Tensor
p set_data initializer init_value|p data shape|p data dtype
parser parse_args args_opt
args_opt device_num device_num
context reset_auto_parallel_context
args_opt device_id%device_num rank
os path isdir args_opt mindrecord_dir
os makedirs args_opt mindrecord_dir
os path join args_opt mindrecord_dir|prefix| mindrecord_file
os path exists mindrecord_file
os path isdir args_opt image_dirandos path exists args_opt anno_path
print  format args_opt mindrecord_dir
float args_opt loss_scale loss_scale
dataset get_dataset_size dataset_size
yolov3_resnet18 ConfigYOLOV3ResNet18 net
YoloWithLossCell net|ConfigYOLOV3ResNet18 net
init_net_param net|
CheckpointConfig save_checkpoint_steps ckpt_config
load_checkpoint args_opt pre_trained param_dict
load_param_into_net net|param_dict
total_epoch_size|dataset_size global_step
TrainingWrapper net|opt|loss_scale net
[TimeMonitor data_size callback
Model net model
callback|dataset_sink_mode callbacks
network trainable_params params p
params p set_data initializer init_value|p data shape|p data dtype
parser parse_args args_opt device_num device_num
parser parse_args args_opt device_id%device_num rank
dataset get_dataset_size dataset_size global_step
[TimeMonitor data_size callback callbacks
ConfigYOLOV3ResNet18 config
yolov3_resnet18 config net
YoloWithEval net|config eval_net
load_param_into_net net|param_dict
load_checkpoint ckpt_path param_dict
eval_net set_train False
ds get_dataset_size total
time time start
print total
data img_np
data image_shape
data annotation
eval_net Tensor img_np output
range batch_idx
output asnumpy
round i|total|100|2 percent
metrics pred_data recalls
range i
print  format i|precisions[i]|100|recalls[i]|100
parser parse_args args_opt
os path isdir args_opt mindrecord_dir
os makedirs args_opt mindrecord_dir
os path join args_opt mindrecord_dir|yolo_prefix| mindrecord_file
os path exists mindrecord_file
os path isdir args_opt image_dirandos path exists args_opt anno_path
yolo_prefix prefix
print  format args_opt mindrecord_dir
yolo_eval mindrecord_file|args_opt ckpt_path
YoloWithEval net|config eval_net set_train False
YoloWithEval net|config eval_net Tensor img_np output
eval_net Tensor img_np output asnumpy
yolo_eval mindrecord_file|args_opt ckpt_path
super _conv2d|self __init__
self conv x x
ksize kernel_size
super BasicBlock|self __init__
_conv2d in_channels|out_channels|3|stride self conv1
_fused_bn out_channels|momentum self bn1
_conv2d out_channels|out_channels|3 self conv2
_fused_bn out_channels|momentum self bn2
P ReLU self relu
(in_channels) self downsample
_conv2d in_channels|out_channels|1|stride self down_sample_layer
P TensorAdd self add
x identity
self conv1 x x
self bn1 x x
self relu x x
self conv2 x x
self bn2 x x
self down_sample_layer identity identity
self add x|identity out
self relu out out
super ResNet|self __init__
_fused_bn self bn1
in_channels in_channel
out_channels out_channel
num_classes self num_classes
weight_variable weight_init
P Squeeze axis self squeeze
_make_layer BasicBlock|3|128|256|2
block in_channel|out_channel|stride resblk
layers append resblk
range 1|layer_num _
nn SequentialCell layers
self maxpool x c1
self layer1 c1 c2
self layer2 c2 c3
self layer3 c3 c4
self layer4 c4 c5
c5 out
self reduce_mean c5|(2|3) out
self squeeze out out
self end_point out out
tensor|(f1|f2|f3)
YoloBlock 1024|512|255
super YoloBlock|self __init__
out_chls|2 out_chls_2
self conv0 x c1
self conv1 c1 c2
self conv2 c2 c3
self conv3 c3 c4
self conv4 c4 c5
self conv5 c5 c6
self conv6 c6 out
resnet18  backbone
[64|128|256|512|1024] backbone_shape
darknet53 backbone
super YOLOv3|self __init__
out_channel self out_channel
backbone self net
YoloBlock backbone_shape|out_chls self backblock0
P ResizeNearestNeighbor (feature_shape||16|feature_shape||16) self upsample1
backbone_shape out_chls
P ResizeNearestNeighbor (feature_shape||8|feature_shape||8) self upsample2
self net x feature_map3
self backblock0 feature_map3 big_object_output
self conv1 con1 con1
self upsample1 con1 ups1
self concat (ups1|feature_map2) con1
self backblock1 con1 medium_object_output
self conv2 con2 con2
self upsample2 con2 ups2
self concat (ups2|feature_map1) con3
self backblock2 con3 small_object_output
super DetectionBlock|self __init__
config self config
(0|1|2) idx
(3|4|5) idx
(6|7|8) idx
Tensor  self config anchor_scales i self anchors
nn Sigmoid self sigmoid
P Reshape self reshape
P Tile self tile
P Concat axis self concat
Tensor tuple config img_shape self input_shape
P Shape x num_batch
P Shape x grid_size
P Transpose prediction|(0|3|4|1|2) prediction
range grid_size range_x
range grid_size range_y
P Cast F tuple_to_array range_x grid_x
P Cast F tuple_to_array range_y grid_y
self tile self reshape grid_x|(1|1|-1|1|1) grid_x
self tile self reshape grid_y|(1|-1|1|1|1) grid_y
self concat (grid_x|grid_y) grid
prediction box_xy
prediction box_wh
prediction box_confidence
prediction box_probs
(self sigmoid box_xy|grid)|P Cast(F tuple_to_array (grid_size|grid_size)) box_xy
P Exp box_wh|self anchors|self input_shape box_wh
self sigmoid box_confidence box_confidence
self sigmoid box_probs box_probs
super Iou|self __init__
P Minimum self min
P Maximum self max
box1 box1_xy
box1 box1_wh
box1_xy-box1_wh|F scalar_to_array box1_mins
box1_xy|box1_wh|F scalar_to_array box1_maxs
box2 box2_xy
box2 box2_wh
box2_xy-box2_wh|F scalar_to_array box2_mins
box2_xy|box2_wh|F scalar_to_array box2_maxs
self max box1_mins|box2_mins intersect_mins
self min box1_maxs|box2_maxs intersect_maxs
self max intersect_maxs-intersect_mins|F scalar_to_array intersect_wh
P Squeeze intersect_wh| intersect_area
P Squeeze intersect_wh
P Squeeze box1_wh box1_area
P Squeeze box2_wh box2_area
intersect_area|(box1_area|box2_area-intersect_area) iou
YoloLossBlock ConfigYOLOV3ResNet18
super YoloLossBlock|self __init__
Tensor self config ignore_threshold|ms float32 self ignore_threshold
Iou self iou
P SigmoidCrossEntropyWithLogits self cross_entropy
P ReduceSum self reduce_sum
y_true object_mask
y_true class_probs
P Shape prediction grid_shape
P Cast F tuple_to_array grid_shape grid_shape
self concat (pred_xy|pred_wh) pred_boxes
y_true|grid_shape-grid true_xy
y_true true_wh
P Fill P DType true_wh|P Shape true_wh|1 0
P Log true_wh|self anchors|self input_shape true_wh
P Shape gt_box gt_shape
P Reshape gt_box|(gt_shape|1|1|1|gt_shape|gt_shape) gt_box
self iou P ExpandDims pred_boxes|-2 iou
self reduce_max iou|-1 best_iou
best_iou ignore_mask
P Cast ignore_mask|ms float32 ignore_mask
P ExpandDims ignore_mask|-1 ignore_mask
F stop_gradient ignore_mask ignore_mask
object_mask|box_loss_scale|self cross_entropy prediction|true_xy xy_loss
object_mask|box_loss_scale|0 5|P Square true_wh-prediction wh_loss
self cross_entropy prediction|object_mask confidence_loss
object_mask|confidence_loss|(1-object_mask)|confidence_loss|ignore_mask confidence_loss
object_mask|self cross_entropy prediction|class_probs class_loss
self reduce_sum xy_loss xy_loss
self reduce_sum wh_loss wh_loss
self reduce_sum confidence_loss confidence_loss
self reduce_sum class_loss class_loss
xy_loss|wh_loss|confidence_loss|class_loss loss
P Shape prediction
yolov3_resnet18 80|[1|3|416|416]
super yolov3_resnet18|self __init__
self config backbone_shape backbone_shape
DetectionBlock self config self detect_1
DetectionBlock self config self detect_2
DetectionBlock self config self detect_3
self feature_map x small_object_output
self detect_1 big_object_output output_big
self detect_2 medium_object_output output_me
self detect_3 small_object_output output_small
super YoloWithLossCell|self __init__
network self yolo_network
YoloLossBlock self config self loss_big
YoloLossBlock self config self loss_me
YoloLossBlock self config self loss_small
self yolo_network x yolo_out
self loss_big yolo_out|yolo_out|yolo_out|yolo_out|y_true_0|gt_0 loss_l
self loss_me yolo_out|yolo_out|yolo_out|yolo_out|y_true_1|gt_1 loss_m
self loss_small yolo_out|yolo_out|yolo_out|yolo_out|y_true_2|gt_2 loss_s
network self network
self network set_grad
ms ParameterTuple network trainable_params self weights
optimizer self optimizer
sens self sens
context get_auto_parallel_context self parallel_mode
context get_auto_parallel_context mean
auto_parallel_context get_device_num_is_set
context get_auto_parallel_context degree
get_group_size degree
nn DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
self weights weights
self network args loss
P Fill P DType loss sens
self grad self network|weights(args|sens) grads
self grad_reducer grads grads
F depend loss|self optimizer grads
super YoloBoxScores|self __init__
Tensor np array config img_shape self input_shape
config num_classes self num_classes
F shape box_xy batch_size
box_xy x
box_xy y
P Concat (y|x) box_yx
box_wh w
box_wh h
P Concat (h|w) box_hw
P Round image_shape|P ReduceMin(self input_shape|image_shape) new_shape
(self input_shape-new_shape)|2 0|self input_shape offset
self input_shape|new_shape scale
(box_yx-offset)|scale box_yx
box_hw|scale box_hw
box_yx-box_hw|2 0 box_min
box_yx|box_hw|2 0 box_max
P Tile image_shape|(1|2) image_scale
boxes|image_scale boxes
F reshape boxes|(batch_size|-1|4) boxes
box_confidence|box_probs boxes_scores
F reshape boxes_scores|(batch_size|-1|self num_classes) boxes_scores
super YoloWithEval|self __init__
YoloBoxScores config self box_score_0
YoloBoxScores config self box_score_1
YoloBoxScores config self box_score_2
self yolo_network x yolo_output
self box_score_0 |yolo_output|image_shape boxes_scores_0
self box_score_1 |yolo_output|image_shape boxes_scores_1
self box_score_2 |yolo_output|image_shape boxes_scores_2
P Concat (boxes_0|boxes_1|boxes_2) boxes
P Concat (boxes_scores_0|boxes_scores_1|boxes_scores_2) boxes_scores
self conv x x identity
self conv x x 0 box_max
self conv1 x x 0 box_max
self bn1 x x 0 box_max
self relu x x 0 box_max
self conv2 x x 0 box_max
self bn2 x x 0 box_max
self add x|identity out resblk
self add x|identity out self backblock0
self relu out out resblk
self relu out out self backblock0
in_channels in_channel resblk
out_channels out_channel resblk
out_channels out_channel self out_channel
self layer4 c4 c5 out
c5 out self backblock0
self reduce_mean c5|(2|3) out self backblock0
self squeeze out out self backblock0
self end_point out out self backblock0
self conv6 c6 out self backblock0
resnet18  backbone self net
[64|128|256|512|1024] backbone_shape self backblock0
[64|128|256|512|1024] backbone_shape out_chls
darknet53 backbone self net
P Transpose prediction|(0|3|4|1|2) prediction box_xy
P Transpose prediction|(0|3|4|1|2) prediction box_wh
P Transpose prediction|(0|3|4|1|2) prediction box_confidence
P Transpose prediction|(0|3|4|1|2) prediction box_probs
self concat (grid_x|grid_y) grid true_xy
prediction box_xy x
prediction box_xy y
prediction box_wh w
prediction box_wh h
prediction box_confidence boxes_scores
prediction box_probs boxes_scores
(self sigmoid box_xy|grid)|P Cast(F tuple_to_array (grid_size|grid_size)) box_xy x
(self sigmoid box_xy|grid)|P Cast(F tuple_to_array (grid_size|grid_size)) box_xy y
P Exp box_wh|self anchors|self input_shape box_wh w
P Exp box_wh|self anchors|self input_shape box_wh h
self sigmoid box_confidence box_confidence boxes_scores
self sigmoid box_probs box_probs boxes_scores
box1 box1_xy scalar_to_array box1_maxs
box1 box1_wh scalar_to_array box1_mins
box1 box1_wh scalar_to_array box1_maxs
box2 box2_xy scalar_to_array box2_maxs
box2 box2_wh scalar_to_array box2_mins
box2 box2_wh scalar_to_array box2_maxs
P Squeeze intersect_wh| intersect_area iou
P Squeeze box1_wh box1_area iou
P Squeeze box2_wh box2_area iou
y_true object_mask cross_entropy prediction|true_xy xy_loss
y_true object_mask 5|P Square true_wh-prediction wh_loss
y_true object_mask confidence_loss
y_true object_mask cross_entropy prediction|class_probs class_loss
P Shape prediction grid_shape true_xy
P Cast F tuple_to_array grid_shape grid_shape true_xy
P Fill P DType true_wh|P Shape true_wh|1 0 5|P Square true_wh-prediction wh_loss
self reduce_max iou|-1 best_iou ignore_mask
best_iou ignore_mask confidence_loss
P Cast ignore_mask|ms float32 ignore_mask confidence_loss
P ExpandDims ignore_mask|-1 ignore_mask confidence_loss
F stop_gradient ignore_mask ignore_mask confidence_loss
object_mask|box_loss_scale|self cross_entropy prediction|true_xy xy_loss loss
object_mask|box_loss_scale|0 5|P Square true_wh-prediction wh_loss loss
self cross_entropy prediction|object_mask confidence_loss confidence_loss
self cross_entropy prediction|object_mask confidence_loss loss
object_mask|confidence_loss|(1-object_mask)|confidence_loss|ignore_mask confidence_loss confidence_loss
object_mask|confidence_loss|(1-object_mask)|confidence_loss|ignore_mask confidence_loss loss
object_mask|self cross_entropy prediction|class_probs class_loss loss
self reduce_sum xy_loss xy_loss loss
self reduce_sum wh_loss wh_loss loss
self reduce_sum confidence_loss confidence_loss loss
self reduce_sum class_loss class_loss loss
xy_loss|wh_loss|confidence_loss|class_loss loss loss
box_xy x 0 box_max
P Concat (y|x) box_yx 0 box_max
box_wh w box_hw
box_wh w 0 box_min
box_wh w 0 box_max
P Concat (h|w) box_hw box_hw
P Concat (h|w) box_hw 0 box_min
P Concat (h|w) box_hw 0 box_max
self input_shape|new_shape scale box_yx
self input_shape|new_shape scale box_hw
(box_yx-offset)|scale box_yx 0 box_max
box_hw|scale box_hw box_hw
box_hw|scale box_hw 0 box_min
box_hw|scale box_hw 0 box_max
P Tile image_shape|(1|2) image_scale boxes
boxes|image_scale boxes boxes
[352|640] img_shape
[32|3|352|640] feature_shape
[64|64|128|256] backbone_input_shape
[64|128|256|512] backbone_shape
[2|2|2|2] backbone_layers
[1|2|2|2] backbone_stride
int len anchor_scales|3|(num_classes|5) out_channel
[10|13|16|30|33|23|30|61|62|45|59|119|116|90|156|198|163|326] config_anchors
np array [float xforxinconfig_anchors] reshape -1|2 anchors
ConfigYOLOV3ResNet18 num_classes num_classes
np random rand|(b-a)
anchors shape||3 num_layers
 [6|7|8]|[3|4|5]|[0|1|2] anchor_mask
(true_boxes)||2  boxes_xy
true_boxes boxes_wh
boxes_xy|input_shape true_boxes
boxes_wh|input_shape true_boxes
[input_shape||32|input_shape||16|input_shape||8] grid_shapes
np expand_dims anchors|0 anchors
anchors|2  anchors_max
-anchors_max anchors_min
boxes_wh valid_mask wh
np expand_dims wh|-2 wh
wh|2  boxes_max
-boxes_max boxes_min
np maximum boxes_min|anchors_min intersect_min
np minimum boxes_max|anchors_max intersect_max
np maximum intersect_max-intersect_min|0  intersect_wh
intersect_wh    |0]|intersect_wh[   |1 intersect_area
wh    |0]|wh[   |1 box_area
anchors    |0]|anchors[   |1 anchor_area
intersect_area|(box_area|anchor_area-intersect_area) iou
np argmax iou|axis best_anchor
enumerate t|n
range l
np floor true_boxes t|0]|grid_shapes[l i
np floor true_boxes t|1]|grid_shapes[l j
anchor_mask l n k
true_boxes t|4 c
np zeros shape pad_gt_box0
np zeros shape pad_gt_box1
np zeros shape pad_gt_box2
np reshape y_true mask0
np reshape y_true gt_box0
gt_box0 pad_gt_box0
np reshape y_true mask1
np reshape y_true gt_box1
gt_box1 pad_gt_box1
np reshape y_true mask2
np reshape y_true gt_box2
gt_box2 pad_gt_box2
img_data size h
input_shape input_w
min float input_w|float(w) scale
int w|scale nw
int h|scale nh
img_data resize (nw|nh) img_data
np zeros (input_h|input_w|3) new_image
new_image fill
np array img_data img_data
np expand_dims img_data|axis img_data
np concatenate [img_data|img_data|img_data]|axis img_data
int (input_h-nh)|2 dh
int (input_w-nw)|2 dw
img_data new_image
np transpose new_image|(2|0|1) new_image
np expand_dims new_image|0 new_image
np array [h|w]|np float32
isinstance image|Image Image
Image fromarray image image
image size ih
np array [ih|iw]|np int32 ori_image_shape
image_size w
_infer_data image|image_size|box
_rand flip
np zeros (max_boxes|5) box_data
float w|float(h)|_rand(1-jitter|1|jitter)| new_ar
_rand 1-jitter|1|jitter
_rand 0 25|2 scale
int scale|h nh
int nh|new_ar nw
int scale|w nw
int nw|new_ar nh
int _rand 0|w-nw dx
int _rand 0|h-nh dy
box copy t_box
np random shuffle t_box
w t_box
h t_box
t_box box_w
t_box box_h
t_box[np logical_and box_w] t_box
t_box box
box box_data
image resize (nw|nh) image
Image new (w|h) new_image
new_image paste image|(dx|dy)
new_image image
image transpose Image FLIP_LEFT_RIGHT image
_rand gray
image convert image
np array image image
np expand_dims image|axis image
np concatenate [image|image|image]|axis image
_rand -hue|hue hue
_rand 1|satif_rand sat
_rand 1|valif_rand val
image|255  image_data
rgb_to_hsv image_data x
hsv_to_rgb x image_data
image_data astype np float32 image_data
 gt_box3
_preprocess_true_boxes box_data|anchors|image_size
_data_aug image|box|is_training gt_box3
_data_aug image|box|is_training anno
annos_str anno_str
list map int|anno_str strip split anno
annos append anno
os path isdir image_dir
os path isfile anno_path
open anno_path|
f readlines lines
lines line
line decode strip line_str
str line_str split line_split
line_split file_name
os path isfile os path join image_dir|file_name
anno_parser line_split image_anno_dict file_name
image_files append file_name
os path join mindrecord_dir|prefix mindrecord_path
FileWriter mindrecord_path|file_num writer
filter_valid_data image_dir|anno_path image_anno_dict
writer add_schema yolo_json|
image_files image_name
os path join image_dir|image_name image_path
open image_path|
f read img
np array image_anno_dict image_name annos
{} row
writer write_raw_data [row]
writer commit
C Decode decode
ds map operations ds
C HWC2CHW hwc_to_chw
ds repeat repeat_num ds
np array [float xforxinconfig_anchors] reshape -1|2 anchors shape||3 num_layers
np array [float xforxinconfig_anchors] reshape -1|2 anchors  anchors_max
np array [float xforxinconfig_anchors] reshape -1|2 anchors    |0]|anchors[   |1 anchor_area
np random  [6|7|8]|[3|4|5]|[0|1|2] anchor_mask
np random  gt_box3
 [6|7|8]|[3|4|5]|[0|1|2] anchor_mask l n k
(true_boxes)||2  boxes_xy true_boxes
true_boxes boxes_wh true_boxes
true_boxes boxes_wh valid_mask wh
boxes_xy|input_shape true_boxes t|4 c
boxes_wh|input_shape true_boxes t|4 c
np expand_dims anchors|0 anchors  anchors_max
np expand_dims anchors|0 anchors    |0]|anchors[   |1 anchor_area
boxes_wh valid_mask wh  boxes_max
boxes_wh valid_mask wh    |0]|wh[   |1 box_area
np expand_dims wh|-2 wh  boxes_max
np expand_dims wh|-2 wh    |0]|wh[   |1 box_area
np maximum intersect_max-intersect_min|0  intersect_wh    |0]|intersect_wh[   |1 intersect_area
intersect_wh    |0]|intersect_wh[   |1 intersect_area iou
wh    |0]|wh[   |1 box_area iou
anchors    |0]|anchors[   |1 anchor_area iou
enumerate  gt_box3
np reshape y_true gt_box0 pad_gt_box0
np reshape y_true gt_box1 pad_gt_box1
np reshape y_true gt_box2 pad_gt_box2
img_data size h t_box
np zeros (input_h|input_w|3) new_image fill
np zeros (input_h|input_w|3) new_image paste image|(dx|dy)
np zeros (input_h|input_w|3) new_image image
np array img_data img_data new_image
np expand_dims img_data|axis img_data new_image
np concatenate [img_data|img_data|img_data]|axis img_data new_image
img_data new_image paste image|(dx|dy)
img_data new_image image
np transpose new_image|(2|0|1) new_image paste image|(dx|dy)
np transpose new_image|(2|0|1) new_image image
np expand_dims new_image|0 new_image paste image|(dx|dy)
np expand_dims new_image|0 new_image image
isinstance image|Image Image fromarray image image
isinstance image|Image Image new (w|h) new_image
Image fromarray image image size ih
Image fromarray image image resize (nw|nh) image
Image fromarray image image transpose Image FLIP_LEFT_RIGHT image
Image fromarray image image convert image
Image fromarray image image  image_data
image_size w t_box
_infer_data box copy t_box
_infer_data box box_data
_infer_data image resize (nw|nh) image
_infer_data image transpose Image FLIP_LEFT_RIGHT image
_infer_data image convert image
_infer_data  gt_box3
_rand  gt_box3
box copy t_box box_w
box copy t_box box_h
box copy t_box box
np random shuffle t_box box_w
np random shuffle t_box box_h
np random shuffle t_box box
w t_box box_w
w t_box box_h
w t_box box
h t_box box_w
h t_box box_h
h t_box box
t_box[np logical_and box_w] t_box box
t_box box box_data
Image new (w|h) new_image paste image|(dx|dy)
Image new (w|h) new_image image
new_image paste image transpose Image FLIP_LEFT_RIGHT image
new_image paste image convert image
new_image paste  gt_box3
new_image image transpose Image FLIP_LEFT_RIGHT image
new_image image convert image
new_image image  image_data
np array image image  image_data
np expand_dims image|axis image  image_data
np concatenate [image|image|image]|axis image  image_data
image|255  image_data astype np float32 image_data
hsv_to_rgb x image_data astype np float32 image_data
f readlines lines line
lines line decode strip line_str
str line_str split line_split file_name
os path isfile os path join f read img
FileWriter mindrecord_path|file_num writer add_schema yolo_json|
FileWriter mindrecord_path|file_num writer write_raw_data [row]
FileWriter mindrecord_path|file_num writer commit
bbox_pred x1
bbox_pred y1
bbox_pred-bbox_pred width1
bbox_pred-bbox_pred height1
bbox_ground x2
bbox_ground y2
bbox_ground-bbox_ground width2
bbox_ground-bbox_ground height2
max x1|width1|x2|width2 endx
min x1|x2 startx
width1|width2-(endx-startx) width
max y1|height1|y2|height2 endy
min y1|y2 starty
height1|height2-(endy-starty) height
width|height area
width1|height1 area1
width2|height2 area2
area|1 |(area1|area2-area) iou
all_boxes x1
all_boxes y1
all_boxes x2
all_boxes y2
(x2-x1|1)|(y2-y1|1) areas
all_scores argsort order
order i
keep append i
np maximum x1 i]|x1[order xx1
np maximum y1 i]|y1[order yy1
np minimum x2 i]|x2[order xx2
np minimum y2 i]|y2[order yy2
np maximum 0 0|xx2-xx1|1 w
np maximum 0 0|yy2-yy1|1 h
w|h inter
inter|(areas-inter) ovr
np where ovr inds
ConfigYOLOV3ResNet18 config
config num_classes num_classes
[1e-6for_inrange(num_classes)] count_corrects
[1e-6for_inrange(num_classes)] count_grounds
[1e-6for_inrange(num_classes)] count_preds
enumerate i|sample
sample gt_anno
sample box_scores
sample boxes
box_scores mask
config nms_max_num max_boxes
range c
np reshape boxes class_boxes
np reshape box_scores class_box_scores
apply_nms class_boxes|class_box_scores|config nms_threshold|max_boxes nms_index
class_boxes nms_index class_boxes
class_box_scores nms_index class_box_scores
np ones_like class_box_scores||c classes
boxes_ append class_boxes
scores_ append class_box_scores
classes_ append classes
[1e-6for_inrange(num_classes)] count_correct
[1e-6for_inrange(num_classes)] count_ground
[1e-6for_inrange(num_classes)] count_pred
gt_anno anno
enumerate box_index|box
[box|box|box|box] bbox_pred
anno class_ground
calc_iou bbox_pred|anno iou
np array  count_corrects ix]|count_preds[ix precision
np array  count_corrects ix]|count_grounds[ix recall
bbox_pred x1 areas
bbox_pred y1 areas
bbox_pred-bbox_pred width1 width
bbox_pred-bbox_pred width1 area1
bbox_pred-bbox_pred height1 height
bbox_pred-bbox_pred height1 area1
bbox_ground-bbox_ground width2 width
bbox_ground-bbox_ground width2 area2
bbox_ground-bbox_ground height2 height
bbox_ground-bbox_ground height2 area2
width1|width2-(endx-startx) width width
width1|width2-(endx-startx) width area
height1|height2-(endy-starty) height height
height1|height2-(endy-starty) height area
height1|height2-(endy-starty) height area1
height1|height2-(endy-starty) height area2
width|height area |(area1|area2-area) iou
all_boxes x1 areas
all_boxes y1 areas
all_scores argsort order i
np maximum 0 0|xx2-xx1|1 w inter
np maximum 0 0|yy2-yy1|1 h inter
w|h inter ovr
ConfigYOLOV3ResNet18 config num_classes num_classes
ConfigYOLOV3ResNet18 config nms_max_num max_boxes
enumerate sample gt_anno
enumerate sample box_scores
enumerate sample boxes
sample gt_anno anno
sample box_scores mask
np reshape boxes class_boxes nms_index class_boxes
np reshape box_scores class_box_scores nms_index class_box_scores
gt_anno anno class_ground
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
classes_ append classes
ShuffleNetV2 n_class net
load_checkpoint args ckpt_file ckpt
load_param_into_net net|ckpt
net set_train False
Tensor np ones [args batch_size|3|args height|args width] input_data
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
ShuffleNetV2 n_class net set_train False
load_param_into_net net set_train False
set_seed cfg random_seed
parser parse_args args_opt
os getenv isdigit
int context set_context(device_id os getenv)
get_rank cfg rank
get_group_size cfg group_size
ParallelMode DATA_PARALLEL parallel_mode
create_dataset args_opt dataset_path|True|cfg rank|cfg group_size dataset
dataset get_dataset_size batches_per_epoch
print batches_per_epoch
ShuffleNetV2 n_class net
Tensor lr lr
net trainable_params param
decayed_params append param
no_decayed_params append param
nn Top1CategoricalAccuracy
load_checkpoint args_opt resume ckpt
load_param_into_net net|ckpt
Model net|loss_fn model
LossMonitor per_print_times loss_cb
TimeMonitor data_size time_cb
[loss_cb|time_cb] callbacks
CheckpointConfig save_checkpoint_steps config_ck
os path join cfg ckpt_path save_ckpt_path
ModelCheckpoint prefix ckpoint_cb
callbacks append ckpoint_cb
create_dataset args_opt dataset_path|True|cfg rank|cfg group_size dataset get_dataset_size batches_per_epoch
ShuffleNetV2 n_class net trainable_params param
ShuffleNetV2 n_class net model
LossMonitor per_print_times loss_cb callbacks
TimeMonitor data_size time_cb callbacks
[loss_cb|time_cb] callbacks append ckpoint_cb
parser parse_args args_opt
callbacks append ckpoint_cb
ShuffleNetV2 n_class net
load_checkpoint args_opt checkpoint ckpt
load_param_into_net net|ckpt
net set_train False
create_dataset args_opt dataset_path|False|0|1 dataset
nn Top1CategoricalAccuracy
model eval dataset metrics
print metrics
ShuffleNetV2 n_class net set_train False
load_param_into_net net set_train False
super ShuffleV2Block|self __init__
stride self stride
mid_channels self mid_channels
ksize self ksize
ksize||2 pad
pad self pad
inp self inp
oup-inp outputs
nn ReLU
nn SequentialCell branch_main self branch_main
nn SequentialCell branch_proj self branch_proj
self channel_shuffle old_x x
P Concat  x_proj|self branch_main x
old_x x_proj
old_x x
P Concat  self branch_proj x_proj|self branch_main x
P Shape x width
P Reshape x|(batchsize|num_channels||2|2|height|width|) x
P Transpose x|(1|0|2|) x
P Reshape x|(2|-1|num_channels||2|height|width|) x
super ShuffleNetV2|self __init__
print model_size
[4|8|4] self stage_repeats
model_size self model_size
[-1|24|48|96|192|1024] self stage_out_channels
[-1|24|116|232|464|1024] self stage_out_channels
[-1|24|176|352|704|1024] self stage_out_channels
[-1|24|244|488|976|2048] self stage_out_channels
self stage_out_channels input_channel
 self first_conv
range idxstage
self stage_repeats idxstage numrepeat
self stage_out_channels output_channel
range i
output_channel input_channel
nn SequentialCell [|self features] self features
 self conv_last
self _initialize_weights
self first_conv x x
self maxpool x x
self features x x
self conv_last x x
self globalpool x x
self dropout x x
P Reshape x|(-1|self stage_out_channels|) x
self classifier x x
self cells_and_names name|m
isinstance m|nn Conv2d
isinstance m|nn Dense
m weight set_data Tensor np random normal 0|0 01|m weight data shape astype
ksize||2 pad self pad
print model_size self model_size
self stage_out_channels output_channel input_channel
self cells_and_names m weight set_data Tensor np random normal 0|0 01|m weight data shape astype
 config_gpu
lr_init float
total_epochs int
steps_per_epoch int
steps_per_epoch|total_epochs total_steps
steps_per_epoch|num_epoch_per_decay decay_steps
range i
i|decay_steps p
math floor p p
lr_each_step append lr_init|math pow lr_decay_rate|p
np array lr_each_step astype np float32 learning_rate
lr_init-lr_init|(i)|(total_steps) lr
lr_each_step append lr
steps_per_epoch|num_epoch_per_decay decay_steps p
range i p
np ascontiguousarray img img
dataset_path string
do_train bool
repeat_num int
C RandomCropDecodeResize
C Decode
C Resize
C CenterCrop
C Rescale 1 0|255 0|0 0
C HWC2CHW
C2 TypeCast mstype float32
C2 TypeCast mstype int32 type_cast_op
super CrossEntropySmooth|self __init__
P OneHot self onehot
sparse self sparse
Tensor 1 0-smooth_factor|mstype float32 self on_value
Tensor 1 0|smooth_factor|(num_classes-1) self off_value
nn SoftmaxCrossEntropyWithLogits reduction self ce
self onehot label|F shape logit label
self ce logit|label loss
VGG16 args|kwargs
vgg16 args|kwargs
NotImplementedError f
parser parse_args args
cfg num_classes args num_classes
cfg pad_mode args pad_mode
cfg padding args padding
cfg has_bias args has_bias
cfg initialize_mode args initialize_mode
cfg batch_norm args batch_norm
cfg has_dropout args has_dropout
list map int|cfg image_size split args image_size
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
vgg16 num_classes net
net set_train False
Tensor np zeros [cfg batch_size|3|args image_size|args image_size] input_data
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
vgg16 num_classes net set_train False
net set_train False
argparse ArgumentParser parser
parser parse_args args_opt
merge_args args_opt|cloud_args args_opt
cfg label_smooth args_opt label_smooth
cfg label_smooth_factor args_opt label_smooth_factor
cfg lr_scheduler args_opt lr_scheduler
cfg loss_scale args_opt loss_scale
cfg max_epoch args_opt max_epoch
cfg warmup_epochs args_opt warmup_epochs
cfg lr args_opt lr
cfg lr_init args_opt lr_init
cfg lr_max args_opt lr_max
cfg momentum args_opt momentum
cfg weight_decay args_opt weight_decay
cfg batch_size args_opt per_batch_size
cfg num_classes args_opt num_classes
cfg buffer_size args_opt buffer_size
cfg keep_checkpoint_max args_opt ckpt_save_max
cfg pad_mode args_opt pad_mode
cfg padding args_opt padding
cfg has_bias args_opt has_bias
cfg batch_norm args_opt batch_norm
cfg initialize_mode args_opt initialize_mode
cfg has_dropout args_opt has_dropout
list map int|cfg lr_epochs split args_opt lr_epochs
list map int|cfg image_size split args_opt image_size
vars args_opt args_dict
isinstance cloud_args|dict
cloud_args keys key_arg
cloud_args key_arg val
type args_dict key_arg arg_type
arg_type val val
val args_dict key_arg
parse_args args
context GRAPH_MODE mode|args device_target device_target context set_context
int os environ get device_num
context set_context args device_id device_id
get_rank args rank
get_group_size args group_size
args group_size device_num
context reset_auto_parallel_context
get_logger args outputs_dir|args rank args logger
vgg_create_dataset args data_path|args image_size|args per_batch_size|args rank|args group_size dataset
dataset get_dataset_size batch_num
dataset get_dataset_size args steps_per_epoch
args logger save_args args
args logger important_info
vgg16 args num_classes|args network
load_param_into_net network|load_checkpoint args pre_trained
args lr_gamma gamma
NotImplementedError args lr_scheduler
Tensor lr learning_rate
args momentum momentum
args weight_decay weight_decay
CrossEntropy smooth_factor loss
TimeMonitor data_size time_cb
LossMonitor per_print_times loss_cb
[time_cb|loss_cb] callbacks
os path join args outputs_dir save_ckpt_path
save_ckpt_path directory
callbacks append ckpt_cb
argparse ArgumentParser parser parse_args args_opt
isinstance cloud_args keys key_arg
isinstance cloud_args key_arg val
isinstance args group_size device_num
isinstance args logger save_args args
isinstance args logger important_info
isinstance args lr_gamma gamma
isinstance args momentum momentum
isinstance args weight_decay weight_decay
cloud_args key_arg val args_dict key_arg
type args_dict key_arg arg_type val val
arg_type val val args_dict key_arg
parse_args args group_size device_num
parse_args args logger save_args args
parse_args args logger important_info
parse_args args lr_gamma gamma
parse_args args momentum momentum
parse_args args weight_decay weight_decay
vgg_create_dataset args data_path|args image_size|args per_batch_size|args rank|args group_size dataset get_dataset_size batch_num
vgg_create_dataset args data_path|args image_size|args per_batch_size|args rank|args group_size dataset get_dataset_size args steps_per_epoch
CrossEntropy smooth_factor loss callbacks
TimeMonitor data_size time_cb callbacks
LossMonitor per_print_times loss_cb callbacks
[time_cb|loss_cb] callbacks append ckpt_cb
os path join args outputs_dir save_ckpt_path directory
super ParameterReduce|self __init__
P Cast self cast
P AllReduce self reduce
self cast F scalar_to_array|mstype float32 one
x|one out
self reduce out ret
argparse ArgumentParser parser
parser parse_args args_opt
merge_args args_opt|cloud_args args_opt
cfg image_size args_opt image_size
cfg num_classes args_opt num_classes
cfg batch_size args_opt per_batch_size
cfg momentum args_opt momentum
cfg weight_decay args_opt weight_decay
cfg buffer_size args_opt buffer_size
cfg pad_mode args_opt pad_mode
cfg padding args_opt padding
cfg has_bias args_opt has_bias
cfg batch_norm args_opt batch_norm
cfg initialize_mode args_opt initialize_mode
cfg has_dropout args_opt has_dropout
list map int|args_opt image_size split args_opt image_size
zip top5|gt
vars args args_dict
isinstance cloud_args|dict
cloud_args keys key
cloud_args key val
type args_dict key arg_type
type None
arg_type val val
val args_dict key
parse_args cloud_args args
int context set_context(device_id os getenv)
get_logger args outputs_dir|args rank args logger
args logger save_args args
vgg16 num_classes net
Model net|loss_fn model
load_checkpoint args pre_trained param_dict
load_param_into_net net|param_dict
net set_train False
model eval dataset res
print res
args logger important_info
os path isdir args pre_trained
list glob glob os path join args pre_trained| models
print models
sorted models|key args models
[args pre_trained|] args models
args models model
load_param_into_net network|load_checkpoint model
network set_train False
time time t_end
eval_dataloader data|gt_classes
network Tensor data|mstype float32 output
output asnumpy output
np argmax output top1_output
np argsort output top5_output
np equal top1_output|gt_classes sum t1_correct
t1_correct top1_correct
get_top5_acc top5_output|gt_classes top5_correct
args per_batch_size img_tot
time time-t_end time_used
(img_tot-args per_batch_size)args group_size|time_used fps
args logger info  format fps
 [top1_correct]|[top5_correct]|[img_tot] results
np array results results
results 0|0 top1_correct
results 1|0 top5_correct
results 2|0 img_tot
self cast F scalar_to_array|mstype float32 one out
argparse ArgumentParser parser parse_args args_opt
zip  [top1_correct]|[top5_correct]|[img_tot] results
isinstance cloud_args keys key
isinstance cloud_args key val
isinstance args logger save_args args
isinstance args logger important_info
isinstance args models model
isinstance args per_batch_size img_tot
isinstance args logger info  format fps
isinstance  [top1_correct]|[top5_correct]|[img_tot] results
cloud_args keys key args models
cloud_args key val args_dict key
type args_dict key arg_type val val
arg_type val val args_dict key
val args_dict key args models
parse_args cloud_args args logger save_args args
parse_args cloud_args args logger important_info
parse_args cloud_args args models model
parse_args cloud_args args per_batch_size img_tot
parse_args cloud_args args logger info  format fps
vgg16 num_classes net model
vgg16 num_classes net set_train False
Model net|loss_fn model eval dataset res
load_param_into_net net set_train False
load_param_into_net  [top1_correct]|[top5_correct]|[img_tot] results
list glob glob os path join args pre_trained| models args models
print models args models
sorted models|key args models args models
eval_dataloader  [top1_correct]|[top5_correct]|[img_tot] results
network Tensor data|mstype float32 output asnumpy output
np equal top1_output|gt_classes sum t1_correct top1_correct
 [top1_correct]|[top5_correct]|[img_tot] results 0|0 top1_correct
 [top1_correct]|[top5_correct]|[img_tot] results 1|0 top5_correct
 [top1_correct]|[top5_correct]|[img_tot] results 2|0 img_tot
np array results results 0|0 top1_correct
np array results results 1|0 top5_correct
np array results results 2|0 img_tot
super CrossEntropy|self __init__
P OneHot self onehot
Tensor 1 0-smooth_factor|mstype float32 self on_value
Tensor 1 0|smooth_factor|(num_classes-1) self off_value
nn SoftmaxCrossEntropyWithLogits self ce
P ReduceMean False self mean
self onehot label|F shape logit one_hot_label
self ce logit|one_hot_label loss
self mean loss|0 loss
base v
(v|in_channels|3|3) weight_shape
initializer shape weight
v out_channels
args padding padding
args pad_mode pad_mode
args has_bias has_bias
[conv2d|nn BatchNorm2d v] layers
[conv2d|nn ReLU] layers
v in_channels
nn SequentialCell layers
include_top bool
super Vgg|self __init__
batch_size _
_make_layer base|args|batch_norm self layers
include_top self include_top
nn Flatten self flatten
 self classifier
nn Dense 512|7|7|4096
nn ReLU
nn Dropout dropout_ratio
nn Dense 4096|4096
default_recurisive_init self
self custom_init_weight
self layers x x
self flatten x x
self classifier x x
self cells_and_names _|cell
isinstance cell|nn Conv2d
isinstance cell|nn Dense
args namespace
phase str
cifar_cfg args
Vgg cfg|num_classes net
base v weight_shape
base v out_channels
base v in_channels
default_recurisive_init self custom_init_weight
default_recurisive_init self layers x x
default_recurisive_init self flatten x x
default_recurisive_init self classifier x x
default_recurisive_init self cells_and_names _|cell
 cifar_cfg
 imagenet_cfg
lr base_lr
int max_epoch|steps_per_epoch total_steps
int warmup_epochs|steps_per_epoch warmup_steps
range i
i||steps_per_epoch last_epoch
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr
eta_min|(base_lr-eta_min)|(1 |math cos(math pi|last_epoch|T_max))|2 lr
lr_each_step append lr
np array lr_each_step astype np float32
range i last_epoch
super LOGGER|self __init__ logger_name
logging StreamHandler sys stdout console
console setLevel logging INFO
logging Formatter formatter
console setFormatter formatter
self addHandler console
rank self rank
os path exists log_dir
datetime now strftime| format rank log_name
os path join log_dir|log_name self log_fn
logging FileHandler self log_fn fh
fh setLevel logging INFO
fh setFormatter formatter
self addHandler fh
self isEnabledFor logging INFO
self _log logging INFO|msg|args|kwargs
self info
vars args args_dict
args_dict keys key
self info key|args_dict[key]
|line_width important_msg
|2 important_msg
self info important_msg|args|kwargs
LOGGER rank logger
logger setup_logging_file path|rank
logging StreamHandler sys stdout console setLevel logging INFO
logging StreamHandler sys stdout console setFormatter formatter
logging FileHandler self log_fn fh setLevel logging INFO
logging FileHandler self log_fn fh setFormatter formatter
vars args args_dict keys key
LOGGER rank logger setup_logging_file path|rank
network trainable_params x
x name parameter_name
parameter_name endswith
no_decay_params append x
decay_params append x
network trainable_params x name parameter_name
x name parameter_name endswith
math sqrt
isinstance param|boolandisinstance param|intorisinstance param|float
param negative_slope
ValueError  format param
math sqrt 2 0|(1|negative_slope2)
ValueError  format nonlinearity
arr reshape arr
num arr
isinstance num|np ndarray
len arr shape dim
arr shape n_in
arr shape n_out
mode lower mode
ValueError  format mode|valid_modes
_calculate_in_and_out array fan_out
super KaimingInit|self __init__
mode self mode
_calculate_gain nonlinearity|a self gain
mathcal{U}(-\text{bound}|\text{bound})
 text{bound}
np empty 3|5 w
_select_fan arr|self mode fan
math sqrt|self gain|math sqrt fan bound
np random uniform -bound|bound|arr shape data
_assignment arr|data
mathcal{N}(0|\text{std}^2)
 text{std}
self gain|math sqrt fan std
np random normal 0|std|arr shape data
custom_cell cells_and_names _|cell
isinstance cell|nn Conv2d
_calculate_in_and_out cell weight _
isinstance cell|nn Dense
isinstance cell|(nn BatchNorm2d|nn BatchNorm1d)
isinstance param|boolandisinstance param|intorisinstance param negative_slope
isinstance param|boolandisinstance param|intorisinstance  text{bound}
isinstance param|boolandisinstance param|intorisinstance  text{std}
math sqrt 2  text{bound}
math sqrt 2  text{std}
num arr shape n_in
num arr shape n_out
ValueError  format mode self mode
ValueError  format  text{bound}
ValueError  format  text{std}
_assignment  text{std}
dataset self dataset
rank self rank
group_size self group_size
len self dataset self dataset_length
int math ceil self dataset_length|1 0|self group_size self num_samples
self num_samples|self group_size self total_size
shuffle self shuffle
seed self seed
(self seed|1) self seed
np random seed self seed
np random permutation self dataset_length tolist indices
list range len self dataset_length indices
iter indices
os path join data_home data_dir
de Cifar10Dataset data_dir|num_shards data_set
vision RandomCrop (32|32) random_crop_op
vision RandomHorizontalFlip random_horizontal_op
vision Resize image_size resize_op
vision Rescale rescale|shift rescale_op
vision Normalize (0 4465|0 4822|0 4914) normalize_op
vision HWC2CHW changeswap_op
C TypeCast mstype int32 type_cast_op
[random_crop_op|random_horizontal_op] c_trans
data_set repeat repeat_num data_set
 Union int|sequence
[0 485|255|0 456|255|0 406|255] mean
[0 229|255|0 224|255|0 225|255] std
(0 08|1 0) scale
mean mean|std std vision Normalize
vision HWC2CHW
vision Decode
vision Resize (256|256)
vision CenterCrop image_size
transform transform_img
[C TypeCast mstype int32] transform_label
target_transform transform_label
shuffle|sampler shuffle
TxtDataset root|data_dir dataset
DistributedSampler dataset|rank|group_size|shuffle sampler
de GeneratorDataset dataset||sampler de_dataset
de_dataset project columns de_dataset
de_dataset batch per_batch_size|drop_remainder de_dataset
de_dataset repeat repeat_num de_dataset
super TxtDataset|self __init__
open txt_name fin
line strip split label
self imgs append os path join root|img_name
self labels append int label
fin close
Image open self imgs index img
len self imgs
de Cifar10Dataset data_dir|num_shards data_set repeat repeat_num data_set
vision RandomCrop (32|32) random_crop_op c_trans
vision RandomHorizontalFlip random_horizontal_op c_trans
 Union  Union int|sequence
[0 485|255|0 456|255|0 406|255] mean mean|std std vision Normalize
shuffle|sampler shuffle shuffle
shuffle|sampler shuffle sampler
TxtDataset root|data_dir dataset sampler
de GeneratorDataset dataset||sampler de_dataset project columns de_dataset
de GeneratorDataset dataset||sampler de_dataset batch per_batch_size|drop_remainder de_dataset
de GeneratorDataset dataset||sampler de_dataset repeat repeat_num de_dataset
open txt_name fin close
steps_per_epoch|total_epochs total_steps
steps_per_epoch|warmup_epochs warmup_steps
(float(lr_max)-float(lr_init))|float(warmup_steps) inc_each_step
range i
float lr_init|inc_each_step|float(i) lr_value
(1 0-(float(i)-float(warmup_steps))|(float(total_steps)-float(warmup_steps))) base
float lr_max|base|base lr_value
lr_each_step append lr_value
global_step current_step
np array lr_each_step astype np float32 lr_each_step
lr_each_step learning_rate
lr base_lr
int max_epoch|steps_per_epoch total_steps
int warmup_epochs|steps_per_epoch warmup_steps
lr_epochs milestones
milestones milestone
milestone|steps_per_epoch milestones_step
milestones_steps append milestones_step
base_lr lr
Counter milestones_steps milestones_steps_counter
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr
lr|gammamilestones_steps_counter[i] lr
lr_each_step append lr
np array lr_each_step astype np float32
lr_epochs append i
np array lr_each_step astype np float32 lr_each_step learning_rate
np array lr_each_step astype np float32 lr_each_step append lr
lr base_lr lr
lr_epochs milestones milestone
milestones milestone milestones_step
base_lr lr lr
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr lr
lr|gammamilestones_steps_counter[i] lr lr
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step lr
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
Inceptionv4 classes net
load_checkpoint args ckpt_file param_dict
load_param_into_net net|param_dict
Tensor np ones [config batch_size|3|args width|args height] input_arr
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
load_param_into_net net|param_dict
config lr_init lr_init
config lr_end lr_end
config lr_max lr_max
steps_per_epoch int
total_epochs int
lr_init float
lr_end float
lr_max float
warmup_steps int
steps_per_epoch|total_epochs total_steps
steps_per_epoch|warmup_epochs warmup_steps
total_steps-warmup_steps decay_steps
range i
(float(lr_max)-float(lr_init))|float(warmup_steps) lr_inc
float lr_init|lr_inc|(i|1) lr
(lr_max-lr_end)|cosine_decay|lr_end lr
lr_each_step append lr
np array lr_each_step astype np float32 learning_rate
steps_per_epoch|(config start_epoch-1) current_step
print  format config epoch_size|config batch_size|config num_classes
context set_context args device_id device_id
get_rank rank
ParallelMode DATA_PARALLEL parallel_mode
train_dataset get_dataset_size train_step_size
Inceptionv4 classes net
Tensor generate_cosine_lr steps_per_epoch lr
net trainable_params param
decayed_params append param
no_decayed_params append param
param set_data initializer XavierUniform|param data shape|param data dtype
print lr
print train_step_size
load_checkpoint args resume ckpt
load_param_into_net net|ckpt
TimeMonitor data_size performance_cb
LossMonitor per_print_times loss_cb
config save_checkpoint_epochs|train_step_size ckp_save_step
CheckpointConfig save_checkpoint_steps config_ck
[performance_cb|loss_cb] callbacks
callbacks append ckpoint_cb
arg_parser parse_args args_opt
parse_args args
load_param_into_net net trainable_params param
load_param_into_net param set_data initializer XavierUniform|param data shape|param data dtype
config lr_init lr_init float
config lr_end lr_end float
config lr_end lr_end lr
config lr_max lr_max float
lr_init float lr_inc
lr_init float lr_init|lr_inc|(i|1) lr
lr_end float lr_inc
lr_end float lr_init|lr_inc|(i|1) lr
lr_max float lr_inc
lr_max float lr_init|lr_inc|(i|1) lr
float lr_init|lr_inc|(i|1) lr lr
(lr_max-lr_end)|cosine_decay|lr_end lr lr
Inceptionv4 classes net trainable_params param
net trainable_params param set_data initializer XavierUniform|param data shape|param data dtype
decayed_params append param set_data initializer XavierUniform|param data shape|param data dtype
no_decayed_params append param set_data initializer XavierUniform|param data shape|param data dtype
TimeMonitor data_size performance_cb callbacks
LossMonitor per_print_times loss_cb callbacks
[performance_cb|loss_cb] callbacks append ckpoint_cb
parser parse_args args_opt
parse_args args
int os getenv device_id
context set_context device_id device_id
context GRAPH_MODE mode|args platform device_target context set_context
Inceptionv4 classes net
load_checkpoint args checkpoint_path ckpt
load_param_into_net net|ckpt
net set_train False
nn Top1CategoricalAccuracy
model eval dataset metrics
print metrics
Inceptionv4 classes net set_train False
load_param_into_net net set_train False
super EvaluateCallBack|self __init__
model self model
per_print_time self per_print_time
eval_dataset self eval_dataset
run_context original_args cb_params
 config_ascend
super Avgpool|self __init__
nn AvgPool2d kernel_size self avg_pool
self avg_pool x x
super Conv2d|self __init__
padding|weight_init padding
self conv x x
super Stem|self __init__
Conv2d self conv2d_1a_3x3
Conv2d self conv2d_2a_3x3
Conv2d self conv2d_2b_3x3
Conv2d self mixed_3a_branch_1
 self mixed_4a_branch_0
 self mixed_4a_branch_1
Conv2d self mixed_5a_branch_0
P Concat self concat0
P Concat self concat1
P Concat self concat2
self conv2d_1a_3x3 x x
self conv2d_2a_3x3 x x
self conv2d_2b_3x3 x x
self mixed_3a_branch_0 x x0
self mixed_3a_branch_1 x x1
self concat0 (x0|x1) x
self mixed_4a_branch_0 x x0
self mixed_4a_branch_1 x x1
self concat1 (x0|x1) x
self mixed_5a_branch_0 x x0
self mixed_5a_branch_1 x x1
self concat2 (x0|x1) x
super InceptionA|self __init__
Conv2d self branch_0
 self branch_1
 self branch_2
 self branch_3
P Concat self concat
self branch_0 x x0
self branch_1 x x1
self branch_2 x x2
self branch_3 x x3
self concat (x0|x1|x2|x3) x4
super InceptionB|self __init__
super ReductionA|self __init__
self concat (x0|x1|x2) x3
super ReductionB|self __init__
 self branch_0
super InceptionC|self __init__
Conv2d self branch_1_1
Conv2d self branch_1_2
Conv2d self branch_2_1
Conv2d self branch_2_2
self branch_1_1 x1 x1_1
self branch_1_2 x1 x1_2
self concat0 (x1_1|x1_2) x1
self branch_2_1 x2 x2_1
self branch_2_2 x2 x2_2
self concat1 (x2_1|x2_2) x2
self concat2 (x0|x1|x2|x3)
super Inceptionv4|self __init__
blocks append Stem in_channels
range _
blocks append InceptionA
blocks append ReductionA 384|k|l|m|n
blocks append InceptionB
blocks append ReductionB
blocks append InceptionC
nn SequentialCell blocks self features
nn DenseBnAct self softmax
nn Dropout self dropout
self features x x
self avgpool x|(2|3) x
self bn0 x x
self dropout x x
self softmax x x
padding|weight_init padding padding
int os getenv device_id
int os getenv device_num
bool do_train do_shuffle
de ImageFolderDataset dataset_path|num_parallel_workers ds
(0 08|1 0) scale
C Decode
C Resize image_length
C CenterCrop image_length
C Rescale 1 0|255 0|0 0
[0 485 mean|0 456|0 406]|[0 229 std|0 224|0 225] C Normalize
C HWC2CHW
C2 TypeCast mstype int32 type_cast_op
ds repeat repeat_num ds
de ImageFolderDataset dataset_path|num_parallel_workers ds repeat repeat_num ds
InceptionV3 args|kwargs
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
load_checkpoint args ckpt_file param_dict
load_param_into_net net|param_dict
Tensor np random uniform 0 0|1 0|size input_arr
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
load_param_into_net net|param_dict
parser parse_args args_opt
os getenv isdigit
int context set_context(device_id os getenv)
get_rank cfg rank
get_group_size cfg group_size
ParallelMode DATA_PARALLEL parallel_mode
create_dataset args_opt dataset_path|True|cfg rank|cfg group_size dataset
dataset get_dataset_size batches_per_epoch
InceptionV3 num_classes net
CrossEntropy smooth_factor loss
Tensor lr lr
net trainable_params param
decayed_params append param
no_decayed_params append param
param set_data initializer XavierUniform|param data shape|param data dtype
nn Top1CategoricalAccuracy
load_checkpoint args_opt resume ckpt
load_param_into_net net|ckpt
Model net|loss_fn model
LossMonitor per_print_times loss_cb
TimeMonitor data_size time_cb
[loss_cb|time_cb] callbacks
CheckpointConfig save_checkpoint_steps config_ck
os path join cfg ckpt_path save_ckpt_path
ModelCheckpoint prefix ckpoint_cb
callbacks append ckpoint_cb
load_param_into_net net trainable_params param
load_param_into_net param set_data initializer XavierUniform|param data shape|param data dtype
create_dataset args_opt dataset_path|True|cfg rank|cfg group_size dataset get_dataset_size batches_per_epoch
InceptionV3 num_classes net trainable_params param
InceptionV3 num_classes net model
CrossEntropy smooth_factor loss model
net trainable_params param set_data initializer XavierUniform|param data shape|param data dtype
decayed_params append param set_data initializer XavierUniform|param data shape|param data dtype
no_decayed_params append param set_data initializer XavierUniform|param data shape|param data dtype
LossMonitor per_print_times loss_cb callbacks
TimeMonitor data_size time_cb callbacks
[loss_cb|time_cb] callbacks append ckpoint_cb
parser parse_args args_opt
int os getenv device_id
context set_context device_id device_id
context GRAPH_MODE mode|args_opt platform device_target context set_context
load_checkpoint args_opt checkpoint ckpt
load_param_into_net net|ckpt
net set_train False
create_dataset args_opt dataset_path|False|0|1 dataset
nn Top1CategoricalAccuracy
model eval dataset metrics
print metrics
load_param_into_net net set_train False
 config_gpu
 config_ascend
lr_init float
lr_max float
total_steps int
warmup_steps int
[0 3|total_steps|0 6|total_steps|0 8|total_steps] decay_epoch_index
range i
lr_init|(lr_max-lr_init)|i|warmup_steps lr
lr_max lr
lr_max|0 1 lr
lr_max|0 01 lr
lr_max|0 001 lr
lr_each_step append lr
np array lr_each_step astype np float32 lr_each_step
steps_per_epoch int
(float(lr_max)-float(lr_init))|float(warmup_steps) inc_each_step
float lr_init|inc_each_step|float(i) lr
math floor (float(i-warmup_steps)|steps_per_epoch)|2 decay_nums
pow 0 94|decay_nums decay_rate
float lr_max|decay_rate lr
lr_end float
total_steps-warmup_steps decay_steps
(float(lr_max)-float(lr_init))|float(warmup_steps) lr_inc
float lr_init|lr_inc|(i|1) lr
(lr_max-lr_end)|cosine_decay|lr_end lr
lr_max-(lr_max-lr_end)|(i-warmup_steps)|(total_steps-warmup_steps) lr
warmup_epochs int
total_epochs int
lr_decay_mode string:learningratedecaymode|includingsteps|steps_decay|cosineorliner default
steps_per_epoch|total_epochs total_steps
steps_per_epoch|warmup_epochs warmup_steps
_generate_steps_lr lr_init|lr_max|total_steps|warmup_steps|global_step lr_each_step
_generate_exponential_lr lr_init|lr_max|total_steps|warmup_steps|steps_per_epoch lr_each_step
_generate_cosine_lr lr_init|lr_end|lr_max|total_steps|warmup_steps|global_step lr_each_step
_generate_liner_lr lr_init|lr_end|lr_max|total_steps|warmup_steps lr_each_step
np array lr_each_step astype np float32 learning_rate
lr_init float inc_each_step
lr_init float lr_init|inc_each_step|float(i) lr
lr_init float lr_max|decay_rate lr
lr_init float lr_inc
lr_init float lr_init|lr_inc|(i|1) lr
lr_max float inc_each_step
lr_max float lr_init|inc_each_step|float(i) lr
lr_max float lr_max|decay_rate lr
lr_max float lr_inc
lr_max float lr_init|lr_inc|(i|1) lr
range i lr
lr_init|(lr_max-lr_init)|i|warmup_steps lr lr
lr_max lr lr
lr_max|0 1 lr lr
lr_max|0 01 lr lr
lr_max|0 001 lr lr
lr_each_step append lr lr
float lr_init|inc_each_step|float(i) lr lr
float lr_max|decay_rate lr lr
lr_end float lr_inc
lr_end float lr_init|lr_inc|(i|1) lr
float lr_init|lr_inc|(i|1) lr lr
(lr_max-lr_end)|cosine_decay|lr_end lr lr
dataset_path string
do_train bool
repeat_num int
(0 08|1 0) scale
C Decode
C Resize
C CenterCrop
C Rescale 1 0|255 0|0 0
[0 485 mean|0 456|0 406]|[0 229 std|0 224|0 225] C Normalize
C HWC2CHW
C2 TypeCast mstype int32 type_cast_op
ds repeat repeat_num ds
super CrossEntropy|self __init__
factor self factor
P OneHot self onehot
Tensor 1 0-smooth_factor|mstype float32 self on_value
Tensor 1 0|smooth_factor|(num_classes-1) self off_value
nn SoftmaxCrossEntropyWithLogits self ce
P ReduceMean False self mean
logits aux
self onehot label|F shape logit one_hot_label
self ce logit|one_hot_label loss_logit
self mean loss_logit|0 loss_logit
self onehot label|F shape aux one_hot_label_aux
self ce aux|one_hot_label_aux loss_aux
self mean loss_aux|0 loss_aux
super CrossEntropy_Val|self __init__
self onehot label|F shape logits one_hot_label
self ce logits|one_hot_label loss_logit
super BasicConv2d|self __init__
nn ReLU self relu
self conv x x
self bn x x
self relu x x
super Inception_A|self __init__
 self branch1
 self branch2
 self branch_pool
self branch0 x x0
self branch1 x x1
self branch2 x x2
self branch_pool x branch_pool
self concat (x0|x1|x2|branch_pool) out
super Inception_B|self __init__
self concat (x0|x1|branch_pool) out
super Inception_C|self __init__
(1|7) kernel_size
(7|1) kernel_size
super Inception_D|self __init__
 self branch0
super Inception_E|self __init__
BasicConv2d 384|384|kernel_size self branch1_a
BasicConv2d 384|384|kernel_size self branch1_b
BasicConv2d 384|384|kernel_size self branch2_a
BasicConv2d 384|384|kernel_size self branch2_b
self concat (self branch1_a x1) x1
self concat (self branch2_a x2) x2
super Logits|self __init__
nn Dropout keep_prob self dropout
P Flatten self flatten
nn Dense 2048|num_classes self fc
self avg_pool x x
self dropout x x
self flatten x x
self fc x x
super AuxLogits|self __init__
nn Dense in_channels|num_classes self fc
self conv2d_0 x x
self conv2d_1 x x
super InceptionV3|self __init__
is_training self is_training
Inception_B 288|has_bias self Mixed_6a
Inception_D 768|has_bias self Mixed_7a
Inception_E 1280|has_bias self Mixed_7b
Inception_E 2048|has_bias self Mixed_7c
AuxLogits 768|num_classes self aux_logits
include_top self include_top
Logits num_classes|dropout_keep_prob self logits
self Conv2d_1a x x
self Conv2d_2a x x
self Conv2d_2b x x
self maxpool1 x x
self Conv2d_3b x x
self Conv2d_4a x x
self maxpool2 x x
self Mixed_5b x x
self Mixed_5c x x
self Mixed_5d x x
self Mixed_6a x x
self Mixed_6b x x
self Mixed_6c x x
self Mixed_6d x x
self Mixed_6e x x
self aux_logits x aux_logits
self Mixed_7a x x
self Mixed_7b x x
self Mixed_7c x x
self logits x logits
(1|7) kernel_size self branch1_a
(1|7) kernel_size self branch1_b
(1|7) kernel_size self branch2_a
(1|7) kernel_size self branch2_b
(7|1) kernel_size self branch1_a
(7|1) kernel_size self branch1_b
(7|1) kernel_size self branch2_a
(7|1) kernel_size self branch2_b
ConfigYOLOV3DarkNet53 config
[True|False] per_channel
quantizer quantize yolov3_darknet53_quant yolov3_darknet53_quant
NotImplementedError f
parser parse_args args
ConfigYOLOV3DarkNet53 config
quantizer quantize network network
load_checkpoint args ckpt_file param_dict
load_param_into_net network|param_dict
network set_train False
[args batch_size|3]|config test_img_shape shape
Tensor np zeros shape input_data
Tensor tuple config test_img_shape input_shape
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
quantizer quantize network network set_train False
load_param_into_net network set_train False
network set_train False
int os getenv devid
argparse ArgumentParser parser
parser parse_known_args _
args max_epoch args T_max
list map int|args lr_epochs split args lr_epochs
os path join args data_dir args data_root
os path join args data_dir args annFile
get_rank args rank
get_group_size args group_size
get_logger args outputs_dir|args rank args logger
[int args training_shape] training_shape
parse_args args
args logger save_args args
AverageMeter loss_meter
context reset_auto_parallel_context
ParallelMode STAND_ALONE parallel_mode
ParallelMode DATA_PARALLEL parallel_mode
get_group_size degree
default_recurisive_init network
load_yolov3_quant_params args|network
ConfigYOLOV3DarkNet53 config
[True|False] per_channel
[True|False] symmetric
quantizer quantize network network
YoloWithLossCell network network
args logger info
args label_smooth config label_smooth
args label_smooth_factor config label_smooth_factor
[conver_training_shape args] config multi_scale
args resize_rate config resize_rate
args per_batch_size|max_epoch batch_size
int data_size|args per_batch_size|args group_size args steps_per_epoch
args steps_per_epoch args ckpt_interval
get_lr args lr
Tensor lr learning_rate
args momentum momentum
args weight_decay weight_decay
TrainingWrapper network|opt network
network set_train
args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num
os path join args outputs_dir save_ckpt_path
save_ckpt_path directory
_InternalCallbackParam cb_params
network cb_params train_network
ckpt_max_num cb_params epoch_num
RunContext cb_params run_context
ckpt_cb begin run_context
-1 old_progress
time time t_end
ShapeRecord shape_record
enumerate i|data
data images
images shape input_shape
args logger info  format i|input_shape
shape_record set input_shape
Tensor from_numpy images images
data annos
 batch_gt_box2
batch_preprocess_true_box annos|config|input_shape
batch_preprocess_true_box_single annos|config|input_shape
Tensor from_numpy batch_y_true_0 batch_y_true_0
Tensor from_numpy batch_y_true_1 batch_y_true_1
Tensor from_numpy batch_y_true_2 batch_y_true_2
Tensor from_numpy batch_gt_box0 batch_gt_box0
Tensor from_numpy batch_gt_box1 batch_gt_box1
Tensor from_numpy batch_gt_box2 batch_gt_box2
Tensor tuple input_shape input_shape
loss_meter update loss asnumpy
i|1 cb_params cur_step_num
i|2 cb_params batch_num
ckpt_cb step_end run_context
time time-t_end time_used
int i|args steps_per_epoch epoch
args per_batch_size|(i-old_progress)args group_size|time_used fps
loss_meter reset
i old_progress
profiler analyse
network set_train False per_channel
network set_train False symmetric
argparse ArgumentParser parser parse_known_args _
parse_args args logger save_args args
parse_args args logger info
parse_args args label_smooth config label_smooth
parse_args args label_smooth_factor config label_smooth_factor
parse_args args resize_rate config resize_rate
parse_args args per_batch_size|max_epoch batch_size
parse_args args steps_per_epoch args ckpt_interval
parse_args args momentum momentum
parse_args args weight_decay weight_decay
parse_args args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num
parse_args args logger info  format i|input_shape
parse_args args per_batch_size|(i-old_progress)args group_size|time_used fps
AverageMeter loss_meter update loss asnumpy
AverageMeter loss_meter reset
default_recurisive_init network set_train
default_recurisive_init network cb_params train_network
load_yolov3_quant_params args logger info
load_yolov3_quant_params args label_smooth config label_smooth
load_yolov3_quant_params args label_smooth_factor config label_smooth_factor
load_yolov3_quant_params args resize_rate config resize_rate
load_yolov3_quant_params args per_batch_size|max_epoch batch_size
load_yolov3_quant_params args steps_per_epoch args ckpt_interval
load_yolov3_quant_params args momentum momentum
load_yolov3_quant_params args weight_decay weight_decay
load_yolov3_quant_params network set_train
load_yolov3_quant_params args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num
load_yolov3_quant_params network cb_params train_network
load_yolov3_quant_params args logger info  format i|input_shape
load_yolov3_quant_params  batch_gt_box2
load_yolov3_quant_params args per_batch_size|(i-old_progress)args group_size|time_used fps
quantizer quantize network network set_train
quantizer quantize network network cb_params train_network
YoloWithLossCell network network set_train
YoloWithLossCell network network cb_params train_network
TrainingWrapper network|opt network set_train
TrainingWrapper network|opt network cb_params train_network
args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num cb_params epoch_num
os path join args outputs_dir save_ckpt_path directory
ShapeRecord shape_record set input_shape
enumerate data images
enumerate data annos
enumerate  batch_gt_box2
enumerate i old_progress
data images shape input_shape
args logger info  format  batch_gt_box2
args logger info  format i old_progress
batch_preprocess_true_box i old_progress
batch_preprocess_true_box_single i old_progress
int os getenv devid
content self content
args ignore_threshold self ignore_threshold
len self labels self num_classes
args outputs_dir self save_prefix
args annFile self annFile
COCO self annFile self _coco
list sorted self _coco imgs keys self _img_ids
args nms_thresh self nms_thresh
self _coco getCatIds self coco_catIds
self results img_id
self results clsi
self results img_id][clsi dets
np array dets dets
self _nms dets|self nms_thresh keep_index
int clsi
list dets i astype float
self det_boxes extend keep_box
dets x1
dets y1
x1|dets x2
y1|dets y2
dets scores
(x2-x1|1)|(y2-y1|1) areas
scores argsort order
order i
keep append i
np maximum x1 i]|x1[order xx1
np maximum y1 i]|y1[order yy1
np minimum x2 i]|x2[order xx2
np minimum y2 i]|y2[order yy2
np maximum 0 0|xx2-xx1|1 w
np maximum 0 0|yy2-yy1|1 h
w|h inter
inter|(areas-inter) ovr
np where ovr inds
datetime datetime now strftime t
self save_prefix self file_path
open self file_path f
json dump self det_boxes|f
RuntimeError  format str e
f close
COCO self annFile cocoGt
cocoGt loadRes self file_path cocoDt
COCOeval cocoGt|cocoDt cocoEval
cocoEval evaluate
cocoEval accumulate
Redirct rdct
sys stdout stdout
rdct sys stdout
cocoEval summarize
stdout sys stdout
len outputs outputs_num
range batch_id
range out_id
outputs out_id out_item
out_item out_item_single
out_item_single shape dimensions
dimensions d
image_shape batch_id ori_h
int image_id batch_id img_id
out_item_single    |0 x
out_item_single    |1 y
out_item_single    |2 w
out_item_single    |3 h
out_item_single conf
out_item_single cls_emb
np expand_dims np argmax cls_emb|axis cls_argmax
x reshape x
y reshape y
w reshape w
h reshape h
cls_emb reshape -1|80 cls_emb
conf reshape conf
cls_argmax reshape cls_argmax
x-w|2  x_top_left
y-h|2  y_top_left
np random random cls_emb shape flag
range i
cls_argmax i c
cls_emb flag confidence
zip x_lefti|y_lefti|wi|hi|confi|clsi
defaultdict list self results img_id
max 0|x_lefti x_lefti
max 0|y_lefti y_lefti
min wi|ori_w wi
min hi|ori_h hi
self coco_catIds clsi coco_clsi
self results img_id coco_clsi append [x_lefti|y_lefti|wi|hi|confi]
argparse ArgumentParser parser
parser parse_known_args _
os path join args data_dir args data_root
os path join args data_dir args annFile
[int args testing_shape] testing_shape
time time start_time
parse_args args
int os environ get rank_id
get_logger args outputs_dir|rank_id args logger
context reset_auto_parallel_context
ParallelMode STAND_ALONE parallel_mode
args logger info
ConfigYOLOV3DarkNet53 config
conver_testing_shape args config test_img_shape
[True|False] per_channel
quantizer quantize network network
args logger info args pretrained
os path isfile args pretrained
load_checkpoint args pretrained param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
args logger info  format args pretrained
FileNotFoundError  format args pretrained
args data_root data_root
args annFile ann_file
args logger info  format config test_img_shape
args logger info  format data_size
network set_train False
DetectionEngine args detection
Tensor tuple config test_img_shape input_shape
data image
data image_shape
data image_id
network image|input_shape prediction
prediction output_small
output_big asnumpy output_big
output_me asnumpy output_me
output_small asnumpy output_small
image_id asnumpy image_id
image_shape asnumpy image_shape
detection detect [output_small|output_me|output_big]|args per_batch_size|image_shape|image_id
args logger info  format iargs per_batch_size|data_size|100
detection do_nms_for_results
detection write_result result_file_path
args logger info  format result_file_path
detection get_eval_result eval_result
time time-start_time cost_time
args logger info  format cost_time|3600 
self results img_id][clsi dets x1
self results img_id][clsi dets y1
self results img_id][clsi dets x2
self results img_id][clsi dets y2
self results img_id][clsi dets scores
np array dets dets x1
np array dets dets y1
np array dets dets x2
np array dets dets y2
np array dets dets scores
dets x1 x2
dets x1 areas
dets y1 y2
dets y1 areas
dets scores argsort order
scores argsort order i
np maximum 0 0|xx2-xx1|1 w inter
np maximum 0 0|xx2-xx1|1 w reshape w
np maximum 0 0|xx2-xx1|1 w  x_top_left
np maximum 0 0|yy2-yy1|1 h inter
np maximum 0 0|yy2-yy1|1 h reshape h
np maximum 0 0|yy2-yy1|1 h  y_top_left
w|h inter ovr
open self file_path f close
json dump self f close
RuntimeError  format str e per_channel
COCO self annFile cocoGt loadRes self file_path cocoDt
COCOeval cocoGt|cocoDt cocoEval evaluate
COCOeval cocoGt|cocoDt cocoEval accumulate
COCOeval cocoGt|cocoDt cocoEval summarize
Redirct rdct sys stdout
sys stdout stdout sys stdout
rdct sys stdout sys stdout
outputs out_id out_item out_item_single
out_item out_item_single shape dimensions
out_item out_item_single    |0 x
out_item out_item_single    |1 y
out_item out_item_single    |2 w
out_item out_item_single    |3 h
out_item out_item_single conf
out_item out_item_single cls_emb
out_item_single shape dimensions d
out_item_single    |0 x reshape x
out_item_single    |1 y reshape y
out_item_single    |2 w reshape w
out_item_single    |2 w  x_top_left
out_item_single    |3 h reshape h
out_item_single    |3 h  y_top_left
out_item_single conf reshape conf
out_item_single cls_emb reshape -1|80 cls_emb
out_item_single cls_emb flag confidence
np expand_dims np argmax cls_emb|axis cls_argmax reshape cls_argmax
np expand_dims np argmax cls_emb|axis cls_argmax i c
argparse ArgumentParser parser parse_known_args _
parse_args args logger info
parse_args args logger info args pretrained
parse_args args logger info  format args pretrained
parse_args args data_root data_root
parse_args args annFile ann_file
parse_args args logger info  format config test_img_shape
parse_args args logger info  format data_size
parse_args args logger info  format iargs per_batch_size|data_size|100
parse_args args logger info  format result_file_path
parse_args args logger info  format cost_time|3600 
quantizer quantize network network set_train False
quantizer quantize network network image|input_shape prediction
load_checkpoint args pretrained param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
load_param_into_net network set_train False
load_param_into_net network image|input_shape prediction
DetectionEngine args detection detect [output_small|output_me|output_big]|args per_batch_size|image_shape|image_id
DetectionEngine args detection do_nms_for_results
DetectionEngine args detection write_result result_file_path
DetectionEngine args detection get_eval_result eval_result
data image_shape asnumpy image_shape
data image_id asnumpy image_id
network image|input_shape prediction output_small
prediction output_small asnumpy output_small
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step lr
lr base_lr
int max_epoch|steps_per_epoch total_steps
int warmup_epochs|steps_per_epoch warmup_steps
lr_epochs milestones
milestones milestone
milestone|steps_per_epoch milestones_step
milestones_steps append milestones_step
base_lr lr
Counter milestones_steps milestones_steps_counter
range i
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr
lr|gammamilestones_steps_counter[i] lr
lr_each_step append lr
np array lr_each_step astype np float32
lr_epochs append i
i||steps_per_epoch last_epoch
eta_min|(base_lr-eta_min)|(1 |math cos(math pi|last_epoch|T_max))|2 lr
int max_epoch|1|3 T_max_V2
lr last_lr
last_epoch last_epoch_V1
last_lr base_lr
last_epoch-last_epoch_V1 last_epoch
eta_min|(base_lr-eta_min)|(1 |math cos(math pi|last_epoch|T_max_V2))|2 lr
start_sample_epoch|step_sample|tobe_sampled_epoch end_sampled_epoch
max_epoch|tobe_sampled_epoch max_sampled_epoch
max_sampled_epoch T_max
int max_sampled_epoch|steps_per_epoch total_sampled_steps
range start_sample_epoch|end_sampled_epoch|step_sample
args lr_gamma gamma
NotImplementedError args lr_scheduler
float init_lr|lr_inc|current_step lr base_lr
float init_lr|lr_inc|current_step lr lr
float init_lr|lr_inc|current_step lr last_lr
lr base_lr lr
lr_epochs milestones milestone
milestones milestone milestones_step
base_lr lr lr
base_lr lr last_lr
range i last_epoch
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr lr
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr last_lr
lr|gammamilestones_steps_counter[i] lr lr
lr|gammamilestones_steps_counter[i] lr last_lr
lr_each_step append lr last_lr
lr_epochs append i last_epoch
i||steps_per_epoch last_epoch last_epoch_V1
eta_min|(base_lr-eta_min)|(1 |math cos(math pi|last_epoch|T_max))|2 lr last_lr
lr last_lr base_lr
max_epoch|tobe_sampled_epoch max_sampled_epoch T_max
np random rand|(b-a)
Union IOU
width orheight
np maximum bbox_a tl
np minimum bbox_a br
isinstance img|Image Image
np array img img
img|255  img
np array [0 485|0 456|0 406] mean
np array [0 229|0 224|0 225] std
(img-mean)|std img
sizes nw
random randint 0|4
ValueError %interp
np array anchors anchors
anchors shape||3 num_layers
 [6|7|8]|[3|4|5]|[0|1|2] anchor_mask
(true_boxes)||2  boxes_xy
true_boxes boxes_wh
boxes_xy|input_shape true_boxes
boxes_wh|input_shape true_boxes
[input_shape||32|input_shape||16|input_shape||8] grid_shapes
np expand_dims anchors|0 anchors
anchors|2  anchors_max
-anchors_max anchors_min
boxes_wh    |0 valid_mask
boxes_wh valid_mask wh
np expand_dims wh|-2 wh
wh|2  boxes_max
-boxes_max boxes_min
np maximum boxes_min|anchors_min intersect_min
np minimum boxes_max|anchors_max intersect_max
np maximum intersect_max-intersect_min|0  intersect_wh
intersect_wh    |0]|intersect_wh[   |1 intersect_area
wh    |0]|wh[   |1 box_area
anchors    |0]|anchors[   |1 anchor_area
intersect_area|(box_area|anchor_area-intersect_area) iou
np argmax iou|axis best_anchor
enumerate t|n
range l
np floor true_boxes t|0]|grid_shapes[l i
np floor true_boxes t|1]|grid_shapes[l j
anchor_mask l n k
true_boxes t|4 c
label_smooth_factor|(num_classes-1) sigma
sigma y_true
np zeros shape pad_gt_box0
np zeros shape pad_gt_box1
np zeros shape pad_gt_box2
np reshape y_true mask0
np reshape y_true gt_box0
gt_box0 pad_gt_box0
np reshape y_true mask1
np reshape y_true gt_box1
gt_box1 pad_gt_box1
np reshape y_true mask2
np reshape y_true gt_box2
gt_box2 pad_gt_box2
isinstance image|Image Image
Image fromarray image image
image size ori_h
np array [ori_w|ori_h]|np int32 ori_image_shape
image_size w
image resize (w|h) image
np expand_dims image_data|axis image_data
np concatenate [image_data|image_data|image_data]|axis image_data
image_data astype np float32 image_data
_rand -hue|hue hue
_rand 1|satif_rand sat
_rand 1|valif_rand val
cv2 setNumThreads
cv2 cvtColor img|cv2 COLOR_RGB2HSV_FULL x
x|255  x
x astype np uint8 x
cv2 cvtColor x|cv2 COLOR_HSV2RGB_FULL image_data
img transpose Image FLIP_LEFT_RIGHT
np expand_dims img|axis img
np concatenate [img|img|img]|axis img
bbox_iou box|crop_box iou
[ 0|0|input_w|input_h] candidates
constraints constraint
constraint max_iou
-np infifmin_iouisNoneelsemin_iou min_iou
range _
float input_w|float(input_h)|_rand(1-jitter|1|jitter)|_rand(1-jitter|1|jitter) new_ar
_rand 0 25|2 scale
int scale|input_h nh
int nh|new_ar nw
int scale|input_w nw
int nw|new_ar nh
int _rand 0|input_w-nw dx
int _rand 0|input_h-nh dy
copy deepcopy box t_box
np array (0|0|input_w|input_h) crop_box
_is_iou_satisfied_constraint min_iou|max_iou|t_box|crop_box[np newaxis]
candidates append (dx|dy|nw|nh)
len candidates
candidates pop np random randint 1|len(candidates) candidate
candidates pop np random randint 0|len(candidates) candidate
candidate nh
input_w t_box
input_h t_box
t_box box_w
t_box box_h
t_box[np logical_and box_w] t_box
t_box box_data
image size image_h
image_input_size input_w
np random shuffle box
len box
_rand flip
np zeros (max_boxes|5) box_data
image resize (nw|nh) image
Image new (input_w|input_h) new_image
new_image paste image|(dx|dy)
new_image image
filp_pil_image image image
np array image image
convert_gray_to_color image image
color_distortion image|hue|sat|val|device_num image_data
config anchor_scales config_anchors
config max_box max_boxes
config num_classes num_classes
config jitter jitter
config hue hue
config saturation sat
config value val
input_size|max_boxes image_input_size
config test_img_shape input_size
_reshape_data image|image_size ori_image_shape
config self config
config resize_rate self resize_rate
config dataset_size self dataset_size
int 1e6 self seed_num
self generate_seed_list seed_num self seed_list
int np ceil self dataset_size|self resize_rate self resize_count_num
device_num self device_num
random seed init_seed
random randint seed_range|seed_range seed
seed_list append seed
batchInfo get_epoch_num epoch_num
int batchInfo get_batch_num|self resize_rate size_idx
self seed_list seed_key
self size_dict get seed_key|None
random seed seed_key
random choice self config multi_scale new_size
new_size self size_dict seed_key
seed_key seed
self size_dict seed input_size
zip img|anno
preprocess_fn img|anno|self config|input_size|self device_num anno
ret_imgs append img transpose 2|0|1 copy
ret_annos append anno
np array ret_imgs|np array ret_annos
annos anno
 gt_box3
config num_classes|max_boxes num_classes
bbox_true_1 batch_bbox_true_1
bbox_true_2 batch_bbox_true_2
bbox_true_3 batch_bbox_true_3
gt_box1 batch_gt_box1
gt_box2 batch_gt_box2
gt_box3 batch_gt_box3
i|1 i
range index
batch_bbox_true_1 append None
batch_bbox_true_2 append None
batch_bbox_true_3 append None
batch_gt_box1 append None
batch_gt_box2 append None
batch_gt_box3 append None
annos step_anno
t start
threads append t
threads t
t join
np array batch_bbox_true_1|np array batch_bbox_true_2|np array batch_bbox_true_3
np array batch_gt_box1|np array batch_gt_box2|np array batch_gt_box3
batch_bbox_true_1 append bbox_true_1
batch_bbox_true_2 append bbox_true_2
batch_bbox_true_3 append bbox_true_3
batch_gt_box1 append gt_box1
batch_gt_box2 append gt_box2
batch_gt_box3 append gt_box3
np random  [6|7|8]|[3|4|5]|[0|1|2] anchor_mask
np random  gt_box3
isinstance img|Image Image fromarray image image
isinstance img|Image Image new (input_w|input_h) new_image
np array img img  img
np array img img transpose Image FLIP_LEFT_RIGHT
img|255  img  img
img|255  img transpose Image FLIP_LEFT_RIGHT
np array [0 229|0 224|0 225] std img
(img-mean)|std img transpose Image FLIP_LEFT_RIGHT
random randint  [6|7|8]|[3|4|5]|[0|1|2] anchor_mask
random randint  gt_box3
np array anchors anchors shape||3 num_layers
np array anchors anchors  anchors_max
np array anchors anchors    |0]|anchors[   |1 anchor_area
 [6|7|8]|[3|4|5]|[0|1|2] anchor_mask l n k
(true_boxes)||2  boxes_xy true_boxes
true_boxes boxes_wh true_boxes
true_boxes boxes_wh    |0 valid_mask
true_boxes boxes_wh valid_mask wh
boxes_xy|input_shape true_boxes t|4 c
boxes_wh|input_shape true_boxes t|4 c
np expand_dims anchors|0 anchors  anchors_max
np expand_dims anchors|0 anchors    |0]|anchors[   |1 anchor_area
boxes_wh valid_mask wh  boxes_max
boxes_wh valid_mask wh    |0]|wh[   |1 box_area
np expand_dims wh|-2 wh  boxes_max
np expand_dims wh|-2 wh    |0]|wh[   |1 box_area
np maximum intersect_max-intersect_min|0  intersect_wh    |0]|intersect_wh[   |1 intersect_area
intersect_wh    |0]|intersect_wh[   |1 intersect_area iou
wh    |0]|wh[   |1 box_area iou
anchors    |0]|anchors[   |1 anchor_area iou
enumerate  gt_box3
enumerate t start
enumerate t join
np floor true_boxes t|0]|grid_shapes[l i ori_image_shape
np floor true_boxes t|0]|grid_shapes[l i i
label_smooth_factor|(num_classes-1) sigma y_true
np reshape y_true gt_box0 pad_gt_box0
np reshape y_true gt_box1 pad_gt_box1
np reshape y_true gt_box1 batch_gt_box1
np reshape y_true gt_box2 pad_gt_box2
np reshape y_true gt_box2 batch_gt_box2
isinstance image|Image Image fromarray image image
isinstance image|Image Image new (input_w|input_h) new_image
Image fromarray image image size ori_h
Image fromarray image image resize (w|h) image
Image fromarray image image size image_h
Image fromarray image image resize (nw|nh) image
Image fromarray image image ori_image_shape
np expand_dims image_data|axis image_data astype np float32 image_data
np concatenate [image_data|image_data|image_data]|axis image_data astype np float32 image_data
cv2 cvtColor img|cv2 COLOR_RGB2HSV_FULL x  x
cv2 cvtColor img|cv2 COLOR_RGB2HSV_FULL x astype np uint8 x
x|255  x  x
x|255  x astype np uint8 x
[ 0|0|input_w|input_h] candidates append (dx|dy|nw|nh)
[ 0|0|input_w|input_h] candidates pop np random randint 1|len(candidates) candidate
[ 0|0|input_w|input_h] candidates pop np random randint 0|len(candidates) candidate
constraints constraint max_iou
copy deepcopy box t_box box_w
copy deepcopy box t_box box_h
copy deepcopy box t_box box_data
candidates append  gt_box3
len candidates pop np random randint 1|len(candidates) candidate
len candidates pop np random randint 0|len(candidates) candidate
candidates pop np random randint 1|len(candidates) candidate nh
candidates pop np random randint 0|len(candidates) candidate nh
input_w t_box box_w
input_w t_box box_h
input_w t_box box_data
input_h t_box box_w
input_h t_box box_h
input_h t_box box_data
t_box[np logical_and box_w] t_box box_data
Image new (input_w|input_h) new_image paste image|(dx|dy)
Image new (input_w|input_h) new_image image
new_image paste  gt_box3
new_image image ori_image_shape
filp_pil_image image image ori_image_shape
np array image image ori_image_shape
convert_gray_to_color image image ori_image_shape
config max_box max_boxes image_input_size
self generate_seed_list seed_num self seed_list append seed
self seed_list seed_key seed
self size_dict get seed_key seed
self size_dict get  gt_box3
random seed seed_key seed
random choice self config multi_scale new_size self size_dict seed_key
new_size self size_dict seed_key seed
zip  gt_box3
 gt_box3 batch_gt_box3
bbox_true_1 batch_bbox_true_1 append None
bbox_true_1 batch_bbox_true_1 append bbox_true_1
bbox_true_2 batch_bbox_true_2 append None
bbox_true_2 batch_bbox_true_2 append bbox_true_2
bbox_true_3 batch_bbox_true_3 append None
bbox_true_3 batch_bbox_true_3 append bbox_true_3
gt_box1 batch_gt_box1 append None
gt_box1 batch_gt_box1 append gt_box1
gt_box2 batch_gt_box2 append None
gt_box2 batch_gt_box2 append gt_box2
gt_box3 batch_gt_box3 append None
gt_box3 batch_gt_box3 append gt_box3
i|1 i i
threads append t join
threads t join
np array batch_bbox_true_1|np array batch_bbox_true_2|np array batch_bbox_true_3 append bbox_true_3
np array batch_gt_box1|np array batch_gt_box2|np array batch_gt_box3 append gt_box3
np array batch_gt_box1|np array batch_gt_box2|np array batch_gt_box3
[32|64|128|256|512] backbone_input_shape
[64|128|256|512|1024] backbone_shape
[1|2|8|8|4] backbone_layers
[416|416] test_img_shape
name self name
fmt self fmt
self reset
tb_writer self tb_writer
val self val
val|n self sum
n self count
self sum|self count self avg
self tb_writer add_scalar self name|self val|self cur_step
fmtstr format self __dict__
load_checkpoint ckpt_path param_dict
net cells_and_names name|cell
name startswith yolo_backbone_prefix
name replace yolo_backbone_prefix|darknet_backbone_prefix name
isinstance cell|(nn Conv2d|nn Dense)
cell weight set_data param_dict darknet_weight data
find_param append darknet_weight
not_found_param append darknet_weight
cell bias set_data param_dict darknet_bias data
find_param append darknet_bias
not_found_param append darknet_bias
isinstance cell|(nn BatchNorm2d|nn BatchNorm1d)
cell moving_mean set_data param_dict darknet_moving_mean data
find_param append darknet_moving_mean
not_found_param append darknet_moving_mean
cell moving_variance set_data param_dict darknet_moving_variance data
find_param append darknet_moving_variance
not_found_param append darknet_moving_variance
cell gamma set_data param_dict darknet_gamma data
find_param append darknet_gamma
not_found_param append darknet_gamma
cell beta set_data param_dict darknet_beta data
find_param append darknet_beta
not_found_param append darknet_beta
args logger info find_param
args logger info not_found_param
x name parameter_name
parameter_name endswith
network trainable_params x
no_decay_params append x
decay_params append x
len shape
int shape shape
self shape_record key
self shape_record key rate
logger info  format key|rate|100
net cells_and_names name startswith yolo_backbone_prefix
net cells_and_names name replace yolo_backbone_prefix|darknet_backbone_prefix name
net cells_and_names cell weight set_data param_dict darknet_weight data
net cells_and_names cell bias set_data param_dict darknet_bias data
net cells_and_names cell moving_mean set_data param_dict darknet_moving_mean data
net cells_and_names cell moving_variance set_data param_dict darknet_moving_variance data
net cells_and_names cell gamma set_data param_dict darknet_gamma data
net cells_and_names cell beta set_data param_dict darknet_beta data
x name parameter_name endswith
super LOGGER|self __init__ logger_name
rank self rank
logging StreamHandler sys stdout console
console setLevel logging INFO
logging Formatter formatter
console setFormatter formatter
self addHandler console
os path exists log_dir
datetime now strftime| format rank log_name
os path join log_dir|log_name self log_fn
logging FileHandler self log_fn fh
fh setLevel logging INFO
fh setFormatter formatter
self addHandler fh
self isEnabledFor logging INFO
self _log logging INFO|msg|args|kwargs
self info
vars args args_dict
args_dict keys key
self info key|args_dict[key]
|line_width important_msg
|2 important_msg
self info important_msg|args|kwargs
LOGGER rank logger
logger setup_logging_file path|rank
logging StreamHandler sys stdout console setLevel logging INFO
logging StreamHandler sys stdout console setFormatter formatter
logging FileHandler self log_fn fh setLevel logging INFO
logging FileHandler self log_fn fh setFormatter formatter
vars args args_dict keys key
LOGGER rank logger setup_logging_file path|rank
ResidualBlock 3|208
super ResidualBlock|self __init__
out_channels||2 out_chls
P TensorAdd self add
x identity
self conv1 x out
self conv2 out out
self add out|identity out
tensor|(f1|f2|f3|f4|f5)
super DarkNet|self __init__
out_channels self outchannel
detect self detect
out_channels in_channel
_make_layer ConvBlock|1|128|256
block in_channel|out_channel darkblk
layers append darkblk
range _
block out_channel|out_channel darkblk
nn SequentialCell layers
self conv0 x c1
self conv1 c1 c2
self layer1 c2 c3
self conv2 c3 c4
self layer2 c4 c5
self conv3 c5 c6
self layer3 c6 c7
self conv4 c7 c8
self layer4 c8 c9
self conv5 c9 c10
self layer5 c10 c11
math sqrt
isinstance param|boolandisinstance param|intorisinstance param|float
param negative_slope
ValueError  format param
math sqrt 2 0|(1|negative_slope2)
ValueError  format nonlinearity
arr reshape arr
num arr
isinstance num|np ndarray
mode lower mode
ValueError  format mode|valid_modes
_calculate_fan_in_and_fan_out array fan_out
mathcal{U}(-\text{bound}|\text{bound})
 text{bound}
np empty 3|5 w
_calculate_correct_fan arr|mode fan
calculate_gain nonlinearity|a gain
gain|math sqrt fan std
math sqrt|std bound
np random uniform -bound|bound|arr shape
len arr shape dimensions
arr shape num_input_fmaps
arr shape num_output_fmaps
arr size receptive_field_size
num_input_fmaps|receptive_field_size fan_in
num_output_fmaps|receptive_field_size fan_out
super KaimingUniform|self __init__
a self a
mode self mode
nonlinearity self nonlinearity
kaiming_uniform_ arr|self a|self mode|self nonlinearity tmp
_assignment arr|tmp
custom_cell cells_and_names _|cell
isinstance cell|nn Conv2d
_calculate_fan_in_and_fan_out cell weight data asnumpy _
isinstance cell|nn Dense
isinstance cell|(nn BatchNorm2d|nn BatchNorm1d)
load_checkpoint args resume_yolov3 param_dict
param_dict items key|values
key startswith
key key_new
key_new endswith
key_new replace key_new
values param_dict_new key_new
args logger info  format key_new
values param_dict_new key
args logger info  format key
args logger info
network parameters_and_names _|param
load_param_into_net network|param_dict_new
args logger info  format args resume_yolov3
isinstance param|boolandisinstance param|intorisinstance param negative_slope
isinstance param|boolandisinstance param|intorisinstance  text{bound}
math sqrt 2  text{bound}
ValueError  format nonlinearity self nonlinearity
num arr shape num_input_fmaps
num arr shape num_output_fmaps
num arr size receptive_field_size
ValueError  format  text{bound}
ValueError  format mode self mode
calculate_gain nonlinearity|a gain sqrt fan std
arr shape num_input_fmaps fan_in
arr shape num_output_fmaps fan_out
arr size receptive_field_size fan_in
arr size receptive_field_size fan_out
load_checkpoint args resume_yolov3 param_dict items key|values
param_dict items key startswith
param_dict items key key_new
param_dict items values param_dict_new key_new
param_dict items values param_dict_new key
key key_new endswith
key key_new replace key_new
super XYLoss|self __init__
P SigmoidCrossEntropyWithLogits self cross_entropy
P ReduceSum self reduce_sum
object_mask|box_loss_scale|self cross_entropy predict_xy|true_xy xy_loss
self reduce_sum xy_loss xy_loss
super WHLoss|self __init__
P Square self square
object_mask|box_loss_scale|0 5|P Square true_wh-predict_wh wh_loss
self reduce_sum wh_loss wh_loss
super ConfidenceLoss|self __init__
self cross_entropy predict_confidence|object_mask confidence_loss
object_mask|confidence_loss|(1-object_mask)|confidence_loss|ignore_mask confidence_loss
self reduce_sum confidence_loss confidence_loss
super ClassLoss|self __init__
object_mask|self cross_entropy predict_class|class_probs class_loss
self reduce_sum class_loss class_loss
self cross_entropy predict_confidence|object_mask confidence_loss confidence_loss
object_mask|confidence_loss|(1-object_mask)|confidence_loss|ignore_mask confidence_loss confidence_loss
annifv v
_has_only_empty_bbox anno
COCO ann_file self coco
root self root
list sorted self coco imgs keys self img_ids
filter_crowd_anno self filter_crowd_anno
is_training self is_training
self img_ids img_id
self coco loadAnns ann_ids anno
has_valid_annotation anno
img_ids append img_id
img_ids self img_ids
enumerate i|v
self cat_ids_to_continuous_ids items k|v
self coco coco
self img_ids index img_id
coco loadImgs img_id img_path
Image open os path join self root|img_path convert img
coco getAnnIds imgIds ann_ids
coco loadAnns ann_ids target
boxes target
classes target
target bboxes
target labels
zip bbox|label
self _convetTopDown bbox bbox
tmp extend bbox
tmp append int label
out_target append tmp
len self img_ids
bbox x_min
bbox y_min
bbox w
bbox h
cv2 setNumThreads
DistributedSampler len yolo_dataset distributed_sampler
CV HWC2CHW hwc_to_chw
len yolo_dataset config dataset_size
int 64|device_num num_parallel_workers1
int 16|device_num num_parallel_workers2
MultiScaleTrans config|device_num multi_scale_trans
num_parallel_workers1 num_parallel_workers
de GeneratorDataset yolo_dataset|column_names ds
ds repeat max_epoch ds
len yolo_dataset
COCO ann_file self coco loadImgs img_id img_path
COCO ann_file self coco getAnnIds imgIds ann_ids
COCO ann_file self coco loadAnns ann_ids target
list sorted self coco imgs keys self img_ids append img_id
list sorted self coco imgs keys self img_ids self img_ids
self coco coco loadImgs img_id img_path
self coco coco getAnnIds imgIds ann_ids
self coco coco loadAnns ann_ids target
coco loadAnns ann_ids target bboxes
coco loadAnns ann_ids target labels
boxes target bboxes
boxes target labels
classes target bboxes
classes target labels
zip bbox x_min
zip bbox y_min
zip bbox w
zip bbox h
self _convetTopDown bbox bbox x_min
self _convetTopDown bbox bbox y_min
self _convetTopDown bbox bbox w
self _convetTopDown bbox bbox h
tmp extend bbox x_min
tmp extend bbox y_min
tmp extend bbox w
tmp extend bbox h
int 64|device_num num_parallel_workers1 num_parallel_workers
de GeneratorDataset yolo_dataset|column_names ds repeat max_epoch ds
tensor|(f1|f2|f3)
YoloBlock 1024|512|255
super YoloBlock|self __init__
out_chls|2 out_chls_2
self conv0 x c1
self conv1 c1 c2
self conv2 c2 c3
self conv3 c3 c4
self conv4 c4 c5
self conv5 c5 c6
self conv6 c6 out
darknet53 backbone
super YOLOv3|self __init__
out_channel self out_channel
backbone self backbone
YoloBlock backbone_shape|out_chls self backblock0
backbone_shape out_chls
P Shape x img_hight
P Shape x img_width
self backbone x feature_map3
self backblock0 feature_map3 big_object_output
self conv1 con1 con1
P ResizeNearestNeighbor (img_hight|16|img_width|16)(con1) ups1
self concat (ups1|feature_map2) con1
self backblock1 con1 medium_object_output
self conv2 con2 con2
P ResizeNearestNeighbor (img_hight|8|img_width|8)(con2) ups2
self concat (ups2|feature_map1) con3
self backblock2 con3 small_object_output
super DetectionBlock|self __init__
config self config
(0|1|2) idx
(3|4|5) idx
(6|7|8) idx
Tensor  self config anchor_scales i self anchors
nn Sigmoid self sigmoid
P Reshape self reshape
P Tile self tile
P Concat axis self concat
is_training self conf_training
P Shape x num_batch
P Shape x grid_size
P Transpose prediction|(0|3|4|1|2) prediction
range grid_size range_x
range grid_size range_y
P Cast F tuple_to_array range_x grid_x
P Cast F tuple_to_array range_y grid_y
self tile self reshape grid_x|(1|1|-1|1|1) grid_x
self tile self reshape grid_y|(1|-1|1|1|1) grid_y
self concat (grid_x|grid_y) grid
prediction box_xy
prediction box_wh
prediction box_confidence
prediction box_probs
(self sigmoid box_xy|grid)|P Cast(F tuple_to_array (grid_size|grid_size)) box_xy
P Exp box_wh|self anchors|input_shape box_wh
self sigmoid box_confidence box_confidence
self sigmoid box_probs box_probs
self concat (box_xy|box_wh|box_confidence|box_probs)
super Iou|self __init__
P Minimum self min
P Maximum self max
box1 box1_xy
box1 box1_wh
box1_xy-box1_wh|F scalar_to_array box1_mins
box1_xy|box1_wh|F scalar_to_array box1_maxs
box2 box2_xy
box2 box2_wh
box2_xy-box2_wh|F scalar_to_array box2_mins
box2_xy|box2_wh|F scalar_to_array box2_maxs
self max box1_mins|box2_mins intersect_mins
self min box1_maxs|box2_maxs intersect_maxs
self max intersect_maxs-intersect_mins|F scalar_to_array intersect_wh
P Squeeze intersect_wh| intersect_area
P Squeeze intersect_wh
P Squeeze box1_wh box1_area
P Squeeze box2_wh box2_area
intersect_area|(box1_area|box2_area-intersect_area) iou
super YoloLossBlock|self __init__
Tensor self config ignore_threshold|ms float32 self ignore_threshold
Iou self iou
XYLoss self xy_loss
WHLoss self wh_loss
ConfidenceLoss self confidenceLoss
ClassLoss self classLoss
y_true object_mask
y_true class_probs
P Shape prediction grid_shape
P Cast F tuple_to_array grid_shape grid_shape
self concat (pred_xy|pred_wh) pred_boxes
y_true|grid_shape-grid true_xy
y_true true_wh
P Log true_wh|self anchors|input_shape true_wh
P Shape gt_box gt_shape
P Reshape gt_box|(gt_shape|1|1|1|gt_shape|gt_shape) gt_box
self iou P ExpandDims pred_boxes|-2 iou
self reduce_max iou|-1 best_iou
best_iou ignore_mask
P Cast ignore_mask|ms float32 ignore_mask
P ExpandDims ignore_mask|-1 ignore_mask
F stop_gradient ignore_mask ignore_mask
self xy_loss object_mask|box_loss_scale|prediction|true_xy xy_loss
self wh_loss object_mask|box_loss_scale|prediction|true_wh wh_loss
self confidenceLoss object_mask|prediction|ignore_mask confidence_loss
self classLoss object_mask|prediction|class_probs class_loss
xy_loss|wh_loss|confidence_loss|class_loss loss
P Shape prediction batch_size
YOLOV3DarkNet53 True
super YOLOV3DarkNet53|self __init__
ConfigYOLOV3DarkNet53 self config
self config backbone_shape backbone_shape
DetectionBlock is_training self detect_1
DetectionBlock is_training self detect_2
DetectionBlock is_training self detect_3
self feature_map x small_object_output
self detect_1 big_object_output|input_shape output_big
self detect_2 medium_object_output|input_shape output_me
self detect_3 small_object_output|input_shape output_small
super YoloWithLossCell|self __init__
network self yolo_network
YoloLossBlock self config self loss_big
YoloLossBlock self config self loss_me
YoloLossBlock self config self loss_small
self yolo_network x|input_shape yolo_out
self loss_big |yolo_out|y_true_0|gt_0|input_shape loss_l
self loss_me |yolo_out|y_true_1|gt_1|input_shape loss_m
self loss_small |yolo_out|y_true_2|gt_2|input_shape loss_s
network self network
self network set_grad
optimizer parameters self weights
optimizer self optimizer
sens self sens
context get_auto_parallel_context self parallel_mode
context get_auto_parallel_context mean
auto_parallel_context get_device_num_is_set
context get_auto_parallel_context degree
get_group_size degree
nn DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
self weights weights
self network args loss
P Fill P DType loss sens
self grad self network|weights(args|sens) grads
self grad_reducer grads grads
F depend loss|self optimizer grads
self conv6 c6 out self backblock0
darknet53 backbone self backbone
P Transpose prediction|(0|3|4|1|2) prediction box_xy
P Transpose prediction|(0|3|4|1|2) prediction box_wh
P Transpose prediction|(0|3|4|1|2) prediction box_confidence
P Transpose prediction|(0|3|4|1|2) prediction box_probs
self concat (grid_x|grid_y) grid true_xy
box1 box1_xy scalar_to_array box1_maxs
box1 box1_wh scalar_to_array box1_mins
box1 box1_wh scalar_to_array box1_maxs
box2 box2_xy scalar_to_array box2_maxs
box2 box2_wh scalar_to_array box2_mins
box2 box2_wh scalar_to_array box2_maxs
P Squeeze intersect_wh| intersect_area iou
P Squeeze box1_wh box1_area iou
P Squeeze box2_wh box2_area iou
XYLoss self xy_loss loss
WHLoss self wh_loss loss
P Shape prediction grid_shape true_xy
P Cast F tuple_to_array grid_shape grid_shape true_xy
self reduce_max iou|-1 best_iou ignore_mask
self xy_loss object_mask|box_loss_scale|prediction|true_xy xy_loss loss
self wh_loss object_mask|box_loss_scale|prediction|true_wh wh_loss loss
self confidenceLoss object_mask|prediction|ignore_mask confidence_loss loss
self classLoss object_mask|prediction|class_probs class_loss loss
xy_loss|wh_loss|confidence_loss|class_loss loss loss
F depend loss|self optimizer grads
dataset_size self dataset_size
num_replicas self num_replicas
rank self rank
int math ceil dataset_size|1 0|self num_replicas self num_samples
self num_samples|self num_replicas self total_size
shuffle self shuffle
np random RandomState seed indices
indices tolist indices
list range self dataset_size indices
iter indices
np random RandomState seed indices tolist indices
split self split
config self config
config max_objs self max_objs
self config img_dir self img_dir
self config annot_path self annot_path
coco COCO self annot_path self coco
self coco getImgIds image_ids
image_ids img_id
self coco getAnnIds imgIds idxs
self images append img_id
image_ids self images
len self images self num_samples
print  format split|self num_samples
self images index img_id
self coco loadImgs ids file_name
os path join self img_dir|file_name img_path
self coco getAnnIds imgIds ann_ids
self coco loadAnns ids anns
len anns num_objs
self max_objs num_objs
np random choice anns|num_objs anns
anns ann
tmp extend ann
target append tmp
cv2 imread img_path img
self coco getImgIds image_ids img_id
self coco getImgIds image_ids self images
self coco loadAnns ids anns ann
np random choice anns|num_objs anns ann
np array |dtype bbox
np random RandomState data_rng
np array [0 2141788|0 01817699|0 00341571]|dtype eig_val
 eig_vec
np array [0 40789654|0 44719302|0 47026115]|dtype mean
np array [0 28863828|0 27408164|0 27809835]|dtype std
len target num_objs
target each
each ann
anns append ann
cv2 setNumThreads
anchor_crop_image_sampling image|anns anns
img shape|img shape width
np array [img shape|2 |img shape|2 ]|dtype c
max img shape|img shape|1 0 s
s|np random choice(np arange(0 6|1 0|0 05)) s
s|np random choice([0 1|0 2|0 25]) border
get_border border|img shape w_border
get_border border|img shape h_border
np random randint low c
config scale sf
config shift cf
s|np clip(np random randn|cf|-2|cf|2|cf) c
s|np clip(np random randn|sf|1|1-sf|1|sf) s
np random random
config rotate rf
np clip np random randn|rf|-rf|2|rf|2 rot
width-c-1 c
get_affine_transform c|s|rot|[config input_res|config input_res] trans_input
cv2 warpAffine img|trans_input|(config input_res|config input_res) inp
(inp astype(np float32)|255 ) inp
color_aug data_rng|inp|eig_val|eig_vec
(inp-mean)|std inp
inp transpose 2|0|1 inp
config output_res output_res
config num_joints num_joints
config max_objs max_objs
get_affine_transform c|s|rot|[output_res|output_res] trans_output_rot
get_affine_transform c|s|0|[output_res|output_res] trans_output
np zeros (config num_classes|output_res|output_res) hm
np zeros (num_joints|output_res|output_res) hm_hp
np zeros (output_res|output_res|2) wh
np zeros (output_res|output_res|2) reg
np zeros (output_res|output_res) ind
np zeros (max_objs) reg_mask
np zeros (output_res|output_res|2) wight_mask
np zeros (output_res|output_res|num_joints|2) kps
np zeros (output_res|output_res|num_joints|2) kps_mask
np zeros (max_objs|num_joints|2) hp_offset
np zeros (max_objs|num_joints) hp_ind
np zeros (max_objs|num_joints) hp_mask
draw_umich_gaussian draw_gaussian
range k
anns k ann
coco_box_to_bbox ann bbox
np array ann|np float32 reshape num_joints|3 pts
config flip_idx e
pts e] copy|pts[e pts e
affine_transform bbox|trans_output bbox
np clip bbox|0|output_res-1 bbox
bbox-bbox|bbox-bbox w
gaussian_radius (math ceil h) radius
max 0|int(radius) radius
np array |dtype ct
ct astype np int32 ct_int
np log 1 |w|4 wh
ct-ct_int|ct-ct_int reg
pts sum num_kpts
gaussian_radius (math ceil h) hp_radius
max 0|int(hp_radius) hp_radius
range j
pts astype np int32 pt_int
pt_int|output_res|pt_int hp_ind
draw_gaussian hm_hp j
 kps_mask
draw_gaussian hm cls_id
np array |dtype bbox w
np array [0 28863828|0 27408164|0 27809835]|dtype std inp
target each ann
anchor_crop_image_sampling image|anns anns k ann
np array [img shape|2 |img shape|2 ]|dtype c reg
max img shape|img shape|1 0 s random choice(np arange(0 6|1 0|0 05)) s
max img shape|img shape|1 0 s random choice([0 1|0 2|0 25]) border
max img shape|img shape|1 0 s clip(np random randn|cf|-2|cf|2|cf) c
max img shape|img shape|1 0 s clip(np random randn|sf|1|1-sf|1|sf) s
max img shape|img shape|1 0 s inp
max img shape|img shape|1 0 s hp_ind
s|np random choice(np arange(0 6|1 0|0 05)) s random choice(np arange(0 6|1 0|0 05)) s
s|np random choice(np arange(0 6|1 0|0 05)) s random choice([0 1|0 2|0 25]) border
s|np random choice(np arange(0 6|1 0|0 05)) s clip(np random randn|cf|-2|cf|2|cf) c
s|np random choice(np arange(0 6|1 0|0 05)) s clip(np random randn|sf|1|1-sf|1|sf) s
s|np random choice(np arange(0 6|1 0|0 05)) s inp
s|np random choice(np arange(0 6|1 0|0 05)) s hp_ind
np random randint low c reg
s|np clip(np random randn|cf|-2|cf|2|cf) c reg
s|np clip(np random randn|sf|1|1-sf|1|sf) s clip(np random randn|sf|1|1-sf|1|sf) s
s|np clip(np random randn|sf|1|1-sf|1|sf) s inp
s|np clip(np random randn|sf|1|1-sf|1|sf) s hp_ind
width-c-1 c reg
cv2 warpAffine img|trans_input|(config input_res|config input_res) inp transpose 2|0|1 inp
(inp astype(np float32)|255 ) inp transpose 2|0|1 inp
color_aug inp transpose 2|0|1 inp
color_aug np zeros (config num_classes|output_res|output_res) hm
color_aug np zeros (num_joints|output_res|output_res) hm_hp
color_aug np zeros (output_res|output_res|2) wh
color_aug np zeros (output_res|output_res|2) reg
color_aug np zeros (output_res|output_res) ind
color_aug np zeros (max_objs) reg_mask
color_aug np zeros (output_res|output_res|2) wight_mask
color_aug np zeros (output_res|output_res|num_joints|2) kps
color_aug np zeros (output_res|output_res|num_joints|2) kps_mask
color_aug np zeros (max_objs|num_joints|2) hp_offset
color_aug np zeros (max_objs|num_joints) hp_ind
color_aug np zeros (max_objs|num_joints) hp_mask
color_aug np array ann|np float32 reshape num_joints|3 pts
color_aug np clip bbox|0|output_res-1 bbox
color_aug np array |dtype ct
color_aug np log 1 |w|4 wh
color_aug  kps_mask
(inp-mean)|std inp transpose 2|0|1 inp
config output_res output_res hp_ind
draw_umich_gaussian draw_gaussian hm_hp j
draw_umich_gaussian draw_gaussian hm cls_id
coco_box_to_bbox ann bbox w
np array ann|np float32 reshape num_joints|3 pts e] copy|pts[e pts e
np array ann|np float32 reshape num_joints|3 pts sum num_kpts
np array ann|np float32 reshape num_joints|3 pts astype np int32 pt_int
affine_transform bbox|trans_output bbox w
np clip bbox|0|output_res-1 bbox w
np array |dtype ct astype np int32 ct_int
np array |dtype ct reg
ct astype np int32 ct_int reg
pts astype np int32 pt_int hp_ind
a-b direct
np float32 dtype
np sin rot_rad cs
[0|0] src_result
src_point|cs-src_point|sn src_result
src_point|sn|src_point|cs src_result
np array [0|0]|dtype shift
isinstance scale|np ndarrayandnotisinstance scale|list
np array [scale|scale]|dtype scale
scale scale_tmp
scale_tmp src_w
output_size dst_w
output_size dst_h
np pi|rot|180 rot_rad
get_dir [0|src_w|-0 5]|rot_rad src_dir
np array [0|dst_w|-0 5]|np float32 dst_dir
np zeros (3|2) src
np zeros (3|2) dst
center|scale_tmp|shift src
center|src_dir|scale_tmp|shift src
cv2 getAffineTransform np float32 dst trans
cv2 getAffineTransform np float32 src trans
np array [pt|pt|1 ]|dtype new_pt
np dot t|new_pt new_pt
cv2 cvtColor image|cv2 COLOR_BGR2GRAY
data_rng normal scale alpha
np dot eigvec|eigval|alpha image
image2 image1
blend_ alpha|image|gs
blend_ alpha|image|gs_mean
[brightness_|contrast_|saturation_] functions
random shuffle functions
grayscale image gs
gs mean gs_mean
functions f
f data_rng|image|gs|gs_mean|0 4
lighting_ data_rng|image|0 1|eig_val|eig_vec
det_size width
(height|width) b1
width|height|(1-min_overlap)|(1|min_overlap) c1
np sqrt b12-4|a1|c1 sq1
(b1|sq1)|2 r1
(1-min_overlap)|width|height c2
np sqrt b22-4|a2|c2 sq2
(b2|sq2)|2 r2
-2|min_overlap|(height|width) b3
(min_overlap-1)|width|height c3
np sqrt b32-4|a3|c3 sq3
(b3|sq3)|2 r3
min r1|r2|r3
[ ss-1 |2 forssinshape] n
np ogrid x
np exp -(x|x|y|y)|(2|sigma|sigma) h
gaussian2d (diameter|diameter) gaussian
int center y
heatmap shape width
min x|radius right
min y|radius bottom
heatmap masked_heatmap
gaussian masked_gaussian
min masked_gaussian shape>0andmin masked_heatmap shape
masked_heatmap out
np sin rot_rad cs src_result
np sin rot_rad cs src_result
np array [0|0]|dtype shift src
np array [0|0]|dtype shift src
isinstance scale|np ndarrayandnotisinstance scale scale_tmp
np array [scale|scale]|dtype scale scale_tmp
np array [scale|scale]|dtype scale src
np array [scale|scale]|dtype scale src
scale scale_tmp src_w
scale scale_tmp src
scale scale_tmp src
get_dir [0|src_w|-0 5]|rot_rad src_dir src
np zeros (3|2) src src
center|scale_tmp|shift src src
center|src_dir|scale_tmp|shift src src
blend_ gs mean gs_mean
blend_ gs mean gs_mean
[brightness_|contrast_|saturation_] functions f
random shuffle functions f
grayscale image gs mean gs_mean
functions f data_rng|image|gs|gs_mean|0 4
det_size width b1
det_size width c1
det_size width c2
det_size width b3
det_size width c3
(height|width) b1 r1
np sqrt b12-4|a1|c1 sq1 r1
np sqrt b22-4|a2|c2 sq2 r2
-2|min_overlap|(height|width) b3 r3
np sqrt b32-4|a3|c3 sq3 r3
gaussian2d (diameter|diameter) gaussian masked_gaussian
heatmap masked_heatmap out
cythonize extensions ext_modules
[numpy get_include] include_dirs
np zeros coords shape target_coords
range p
range i
transform_preds dets|(w|h) bbox
transform_preds dets|(w|h) pts
np int32 dtype
opt flip_idx self flip_idx
min masked_gaussian shape>0andmin masked_heatmap shape
model self model
np array opt mean|dtype self mean
np array opt std|dtype self std
opt num_classes self num_classes
opt test_scales self scales
opt self opt
image shape width
int height|scale new_height
int width|scale new_width
self opt input_h|self opt input_w inp_width
np array [new_width|2 |new_height|2 ]|dtype c
max height|width|1 0 s
int np ceil new_height|32|32 inp_height
int np ceil new_width|32|32 inp_width
np array [new_width||2|new_height||2]|dtype c
np array [inp_width|inp_height]|dtype s
get_affine_transform c|s|0|[inp_width|inp_height] trans_input
cv2 resize image|(new_width|new_height) resized_image
cv2 warpAffine inp_image
((inp_image|255 -self mean)|self std) astype(np float32) inp_image
inp_image transpose 2|0|1 reshape 1|3|inp_height|inp_width images
Tensor images images
self model images topk_inds
output_hm asnumpy astype np float32 output_hm
output_wh asnumpy astype np float32 output_wh
output_off asnumpy astype np float32 output_off
output_kps asnumpy astype np float32 output_kps
topk_inds asnumpy astype np long topk_inds
self centerface_decode output_hm|output_wh|output_kps|reg dets
dets reshape 1|-1|dets shape dets
multi_pose_post_process dets
dets copy
range 1|self num_classes j
np array dets[j]|dtype dets j
len self opt test_scales
results tolist results
isinstance image_or_path_or_tensor|np ndarray
image_or_path_or_tensor image
isinstance image_or_path_or_tensor|str
cv2 imread image_or_path_or_tensor image
image_or_path_or_tensor numpy image
image_or_path_or_tensor pre_processed_images
self scales scale
self pre_process image|scale|meta meta
pre_processed_images scale images
pre_processed_images scale meta
{k} meta
self process images dets
detections append dets
self merge_outputs detections results
wh shape width
kps shape||2 num_joints
heat scores
topk_inds inds
(topk_inds|width) astype(np int32) astype(np float32) ys_int
(topk_inds%width) astype(np int32) astype(np float32) xs_int
reg reshape batch|2|-1 reg
np zeros (batch|2|opt_k) reg_tmp
reg_tmp transpose 0|2|1 reg
xs_int reshape batch|opt_k|1|reg xs
ys_int reshape batch|opt_k|1|reg ys
xs_int reshape batch|opt_k|1|0 5 xs
ys_int reshape batch|opt_k|1|0 5 ys
wh reshape batch|2|-1 wh
np zeros (batch|2|opt_k) wh_tmp
wh_tmp transpose 0|2|1 wh
np exp wh|4  wh
scores reshape batch|opt_k|1 scores
np zeros (batch|opt_k|1) clses
np zeros (batch|opt_k|num_joints|2) kps
image shape width astype(np int32) astype(np float32) ys_int
max height|width|1 0 s num_classes j
max height|width|1 0 s astype(np int32) astype(np float32) ys_int
np array [inp_width|inp_height]|dtype s num_classes j
np array([inp_width|inp_height]|dtype s astype(np int32) astype(np float32) ys_int
cv2 warpAffine inp_image -self mean)|self std) astype(np float32) inp_image
cv2 warpAffine inp_image transpose 2|0|1 reshape 1|3|inp_height|inp_width images
((inp_image|255 -self mean)|self std) astype(np float32) inp_image -self mean)|self std) astype(np float32) inp_image
((inp_image|255 -self mean)|self std) astype(np float32) inp_image transpose 2|0|1 reshape 1|3|inp_height|inp_width images
self model images topk_inds asnumpy astype np long topk_inds
self model images topk_inds inds
self model images topk_inds astype(np int32) astype(np float32) ys_int
self centerface_decode output_hm|output_wh|output_kps|reg dets reshape 1|-1|dets shape dets
self centerface_decode output_hm|output_wh|output_kps|reg dets copy
multi_pose_post_process dets copy
isinstance image_or_path_or_tensor numpy image
isinstance image_or_path_or_tensor pre_processed_images
image_or_path_or_tensor pre_processed_images scale images
image_or_path_or_tensor pre_processed_images scale meta
wh shape width astype(np int32) astype(np float32) ys_int
heat scores reshape batch|opt_k|1 scores
topk_inds inds astype(np int32) astype(np float32) ys_int
(topk_inds|width) astype(np int32) astype(np float32) ys_int reshape batch|opt_k|1|reg ys
(topk_inds|width) astype(np int32) astype(np float32) ys_int reshape batch|opt_k|1|0 5 ys
(topk_inds%width) astype(np int32) astype(np float32) xs_int reshape batch|opt_k|1|reg xs
(topk_inds%width) astype(np int32) astype(np float32) xs_int reshape batch|opt_k|1|0 5 xs
np zeros (batch|2|opt_k) reg_tmp transpose 0|2|1 reg
np zeros (batch|2|opt_k) wh_tmp transpose 0|2|1 wh
Extension |include_dirs package
cythonize setup(ext_modules [package])
loadmat os path join gt_dir| gt_mat
loadmat os path join gt_dir| hard_mat
loadmat os path join gt_dir| medium_mat
loadmat os path join gt_dir| easy_mat
gt_mat facebox_list
gt_mat event_list
gt_mat file_list
hard_mat hard_gt_list
medium_mat medium_gt_list
easy_mat easy_gt_list
os path join cache_dir cache_file
os path exists cache_file
open cache_file f
pickle load f boxes
f close
open gt_path f
f readlines lines
lines line
line current_name
np array current_boxes astype boxes current_name
current_boxes append box
pickle dump boxes|f
open filepath|
lines rstrip img_file
img_file split
os listdir pred_dir events
dict boxes
events pbar
pbar event
os path join pred_dir|event event_dir
os listdir event_dir event_images
dict current_event
event_images imgtxt
read_pred_file os path join event_dir|imgtxt box
box current_event imgname rstrip
current_event boxes event
pred_norm items _|k
k items _|v
np min v min_v
np max v max_v
max max_v|max_score max_score
min min_v|min_score min_score
max_score-min_score diff
pred_eval copy pred_t
gt copy gt_t
np zeros pred_t shape pred_recall
np zeros gt_t shape recall_list
np ones pred_t shape proposal_list
bbox_overlaps pred_t|gt_t overlaps
range h
overlaps h gt_overlap
gt_overlap max|gt_overlap argmax max_idx
-1 recall_list max_idx
-1 proposal_list h
len r_keep_index pred_recall h
np zeros (thresh_num|2) astype pr_info
range t
np where pred_info r_index
np zeros (thresh_num|2) pr_curve_t
range i
np concatenate (|rec|) mrec
np concatenate (|prec|) mpre
range mpre size i
np where mrec i
np sum (mrec) ap
pred_evaluation print_pred
get_preds pred_evaluation pred_evaluation
norm_score pred_evaluation
get_gt_boxes gt_path easy_gt_list
len event_list event_num
[easy_gt_list|medium_gt_list|hard_gt_list] setting_gts
range setting_id
setting_gts setting_id gt_list
np zeros (thresh_num|2) astype pr_curve
range event_num pbar
pbar i
str event_list i event_name
file_list i img_list
pred_evaluation event_name pred_list
gt_list i sub_gt_list
facebox_list i gt_bbx_list
enumerate j|_
pred_list[str img_list j] pred_info
gt_bbx_list j gt_boxes
sub_gt_list j keep_index
len keep_index count_face
np zeros gt_boxes shape ignore
image_eval pred_info|gt_boxes|ignore|iou_thresh proposal_list
img_pr_info thresh_num|pred_info|proposal_list|pred_recall pr_curve
dataset_pr_info thresh_num|pr_curve|count_face pr_curve
pr_curve propose
pr_curve recall
voc_ap recall|propose ap
aps append ap
print  format aps
argparse ArgumentParser parser
parser parse_args args
args pred pred
os path isdir pred
evaluation pred|args gt
loadmat os path join gt_dir| gt_mat facebox_list
loadmat os path join gt_dir| gt_mat event_list
loadmat os path join gt_dir| gt_mat file_list
loadmat os path join gt_dir| hard_mat hard_gt_list
loadmat os path join gt_dir| medium_mat medium_gt_list
loadmat os path join gt_dir| easy_mat easy_gt_list
gt_mat facebox_list i gt_bbx_list
gt_mat file_list i img_list
hard_mat hard_gt_list setting_gts
medium_mat medium_gt_list setting_gts
easy_mat easy_gt_list setting_gts
open cache_file f close
open cache_file f readlines lines
open gt_path f readlines lines
f readlines lines line
f readlines lines rstrip img_file
lines line current_name
current_boxes append box current_event imgname rstrip
lines rstrip img_file split
os listdir pred_dir events pbar
events pbar event
events pbar i
os listdir event_dir event_images imgtxt
dict current_event boxes event
read_pred_file os path join event_dir|imgtxt box current_event imgname rstrip
pred_norm items k items _|v
bbox_overlaps pred_t|gt_t overlaps h gt_overlap
range h setting_gts
overlaps h gt_overlap max|gt_overlap argmax max_idx
-1 proposal_list h setting_gts
len r_keep_index pred_recall h setting_gts
range t setting_gts
get_preds pred_evaluation pred_evaluation event_name pred_list
norm_score pred_evaluation event_name pred_list
get_gt_boxes gt_path easy_gt_list setting_gts
[easy_gt_list|medium_gt_list|hard_gt_list] setting_gts setting_id gt_list
setting_gts setting_id gt_list i sub_gt_list
np zeros (thresh_num|2) astype pr_curve propose
np zeros (thresh_num|2) astype pr_curve recall
range event_num pbar i
gt_list i sub_gt_list j keep_index
facebox_list i gt_bbx_list j gt_boxes
img_pr_info thresh_num|pred_info|proposal_list|pred_recall pr_curve propose
img_pr_info thresh_num|pred_info|proposal_list|pred_recall pr_curve recall
dataset_pr_info thresh_num|pr_curve|count_face pr_curve propose
dataset_pr_info thresh_num|pr_curve|count_face pr_curve recall
argparse ArgumentParser parser parse_args args
parser parse_args args pred pred
anns ann
boxes append [ann]
np asarray boxes|dtype boxes
image shape _
(boxes|1) box_area
random randint 0|len(box_area)-1 rand_idx
box_area rand_idx rand_side
[16|24|32|40|48|56|64|72|80|88|96|128|256|512] anchors
inf_distance distance
enumerate i|anchor
abs anchor-rand_side
abs anchor-rand_side distance
i anchor_idx
random choice anchors target_anchor
float target_anchor|rand_side ratio
ratio|(2random uniform -1|1) ratio
int height|ratio|width|ratio
(max_size|max_size|(height|width))0 5 ratio
[cv2 INTER_LINEAR|cv2 INTER_CUBIC|cv2 INTER_AREA|cv2 INTER_NEAREST|cv2 INTER_LANCZOS4] interp_methods
random choice interp_methods interp_method
cv2 resize image|None|None|fx image
boxes tolist boxes
enumerate i|_
 boxes i]|boxes[i]|boxes[i]-boxes[i]|boxes[i]-boxes[i anns i
range j
np asarray boxes|dtype boxes box_area
np asarray boxes|dtype boxes tolist boxes
(boxes|1) box_area rand_idx rand_side
enumerate i anchor_idx
enumerate  boxes i]|boxes[i]|boxes[i]-boxes[i]|boxes[i]-boxes[i anns i
float target_anchor|rand_side ratio uniform -1|1) ratio
ratio|(2random uniform -1|1) ratio uniform -1|1) ratio
int  boxes i]|boxes[i]|boxes[i]-boxes[i]|boxes[i]-boxes[i anns i
enumerate  boxes i]|boxes[i]|boxes[i]-boxes[i]|boxes[i]-boxes[i anns i
int os getenv dev_id
argparse ArgumentParser parser
parser parse_known_args _
get_logger args outputs_dir|args rank args logger
args logger save_args args
range loop
CenterfaceMobilev2 network
default_recurisive_init network
loopargs device_num|args rank|1 ckpt_num
args ckpt_name ckpt_name
args test_model|ckpt_name test_model
args logger info  format test_model
os path isfile test_model
load_checkpoint test_model param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
CenterFaceWithNms network network
args logger info
network set_train False
ConfigCenterface config
time time start
sio loadmat args ground_truth_mat ground_truth_mat
ground_truth_mat event_list
ground_truth_mat file_list
args save_dir|str(ckpt_num) save_path
args save_dir save_path
CenterFaceDetector config|network detector
enumerate index|event
file_list index file_list_item
event im_dir
os path exists save_path|im_dir
os makedirs save_path|im_dir
enumerate num|file
file im_name
os path join args data_dir|zip_name img_path
detector run img_path dets
open save_path|im_dir| f
f write  format len dets
dets b
b|b|b|b|b s
f write  format x1|y1|(x2-x1|1)|(y2-y1|1)|s
f close
args logger info  format index|1|num|1
time time end
end start
os path isdir save_path
evaluation save_path|args ground_truth_path
argparse ArgumentParser parser parse_known_args _
CenterfaceMobilev2 network set_train False
default_recurisive_init network set_train False
load_checkpoint test_model param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
load_param_into_net network set_train False
CenterFaceWithNms network network set_train False
sio loadmat args ground_truth_mat ground_truth_mat event_list
sio loadmat args ground_truth_mat ground_truth_mat file_list
ground_truth_mat file_list index file_list_item
CenterFaceDetector config|network detector run img_path dets
enumerate event im_dir
enumerate file im_name
enumerate f write  format len dets
enumerate f write  format x1|y1|(x2-x1|1)|(y2-y1|1)|s
enumerate f close
detector run img_path dets b
open save_path|im_dir| f write  format len dets
open save_path|im_dir| f write  format x1|y1|(x2-x1|1)|(y2-y1|1)|s
open save_path|im_dir| f close
f write  format len dets b
dets b s
time time end start
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
ConfigCenterface config
CenterfaceMobilev2 net
load_checkpoint args ckpt_file param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net net|param_dict_new
CenterFaceWithNms net net
net set_train False
Tensor np zeros [args batch_size|3|config input_h|config input_w] input_data
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
CenterfaceMobilev2 net set_train False
load_checkpoint args ckpt_file param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
load_param_into_net net set_train False
CenterFaceWithNms net net set_train False
files  ckpt
int os getenv dev_id
argparse ArgumentParser parser
parser parse_known_args _
args max_epoch args t_max
list map int|args lr_epochs split args lr_epochs
[int args_ training_shape] training_shape
get_rank args rank
get_group_size args group_size
get_logger args outputs_dir|args rank args logger
args logger save_args args
Profiler output_path profiler
AverageMeter loss_meter
context reset_auto_parallel_context
ParallelMode DATA_PARALLEL parallel_mode
get_group_size degree
ParallelMode STAND_ALONE parallel_mode
CenterfaceMobilev2 network
default_recurisive_init network
load_backbone network|args pretrained_backbone|args network
args logger info  format args pretrained_backbone
args logger info
os path isfile args resume
load_checkpoint args resume param_dict
param_dict items key|values
key startswith
values param_dict_new key
load_param_into_net network|param_dict_new
args logger info  format args resume
CenterFaceWithLossCell network network
ConfigCenterface config
args data_dir config data_dir
args annot_path config annot_path
args img_dir config img_dir
args label_smooth config label_smooth
args label_smooth_factor config label_smooth_factor
[convert_training_shape args] config multi_scale
args resize_rate config resize_rate
args max_epoch max_epoch
args rank rank
args group_size group_size
args steps_per_epoch||args max_epoch args steps_per_epoch
args steps_per_epoch args ckpt_interval
lr_fun get_lr lr
args lr_gamma gamma
NotImplementedError args lr_scheduler
Tensor lr learning_rate
args weight_decay weight_decay
args momentum momentum
TrainingWrapper network|opt|sens network
network set_train
args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num
args outputs_dir directory
_InternalCallbackParam cb_params
network cb_params train_network
ckpt_max_num cb_params epoch_num
RunContext cb_params run_context
ckpt_cb begin run_context
time time t_end
enumerate i_all|batch_load
i_all%args steps_per_epoch i
i_all||args steps_per_epoch|1 epoch
batch_load landmarks
Tensor images images
Tensor hm hm
Tensor reg_mask reg_mask
Tensor ind ind
Tensor wh wh
Tensor wight_mask wight_mask
Tensor hm_offset hm_offset
Tensor hps_mask hps_mask
Tensor landmarks landmarks
network images|hm|reg_mask|ind|wh|wight_mask|hm_offset|hps_mask|landmarks scaling
np all overflow asnumpy overflow
loss asnumpy loss
loss_meter update loss
scaling asnumpy
epoch cb_params cur_epoch_num
i|1|(epoch-1)args steps_per_epoch cb_params cur_step_num
i|2|(epoch-1)args steps_per_epoch cb_params batch_num
ckpt_cb step_end run_context
time time-t_end time_used
args per_batch_sizeargs steps_per_epochargs group_size|time_used fps
 format epoch|loss_meter|fps|lr
loss_meter reset
profiler analyse
argparse ArgumentParser parser parse_known_args _
Profiler output_path profiler analyse
AverageMeter loss_meter update loss
AverageMeter loss_meter reset
CenterfaceMobilev2 network network
CenterfaceMobilev2 network set_train
CenterfaceMobilev2 network cb_params train_network
CenterfaceMobilev2 network images|hm|reg_mask|ind|wh|wight_mask|hm_offset|hps_mask|landmarks scaling
default_recurisive_init network network
default_recurisive_init network set_train
default_recurisive_init network cb_params train_network
default_recurisive_init network images|hm|reg_mask|ind|wh|wight_mask|hm_offset|hps_mask|landmarks scaling
load_backbone network|args pretrained_backbone|args network network
load_backbone network|args pretrained_backbone|args network set_train
load_backbone network|args pretrained_backbone|args network cb_params train_network
load_backbone network|args pretrained_backbone|args network images|hm|reg_mask|ind|wh|wight_mask|hm_offset|hps_mask|landmarks scaling
load_checkpoint args resume param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
param_dict items  format epoch|loss_meter|fps|lr
load_param_into_net network set_train
load_param_into_net network cb_params train_network
load_param_into_net network images|hm|reg_mask|ind|wh|wight_mask|hm_offset|hps_mask|landmarks scaling
load_param_into_net  format epoch|loss_meter|fps|lr
CenterFaceWithLossCell network network network
CenterFaceWithLossCell network network set_train
CenterFaceWithLossCell network network cb_params train_network
CenterFaceWithLossCell network network images|hm|reg_mask|ind|wh|wight_mask|hm_offset|hps_mask|landmarks scaling
TrainingWrapper network|opt|sens network network
TrainingWrapper network|opt|sens network set_train
TrainingWrapper network|opt|sens network cb_params train_network
TrainingWrapper network|opt|sens network images|hm|reg_mask|ind|wh|wight_mask|hm_offset|hps_mask|landmarks scaling
args max_epochargs steps_per_epoch||args ckpt_interval ckpt_max_num cb_params epoch_num
enumerate batch_load landmarks
enumerate  format epoch|loss_meter|fps|lr
i_all%args steps_per_epoch i steps_per_epoch cb_params cur_step_num
i_all%args steps_per_epoch i steps_per_epoch cb_params batch_num
i_all||args steps_per_epoch|1 epoch cb_params cur_epoch_num
network images|hm|reg_mask|ind|wh|wight_mask|hm_offset|hps_mask|landmarks scaling asnumpy
 format  format epoch|loss_meter|fps|lr
 format loss_meter reset
warmup_init_lr self warmup_init_lr
lr self base_lr
int warmup_epochs|steps_per_epoch self warmup_steps
super _LinearWarmUp|self __init__ warmup_init_lr
(float(self base_lr)-float(self warmup_init_lr))|float(self warmup_steps) lr_inc
float self warmup_init_lr|lr_inc|current_step lr
super _ConstWarmUp|self __init__ warmup_init_lr
steps_per_epoch self steps_per_epoch
int max_epoch|steps_per_epoch self total_steps
(1|steps_per_epoch|max_epoch) shape
scheduler get_lr lr
_LinearWarmUp lr|warmup_epochs|steps_per_epoch self warmup
super LambdaLR|self __init__ lr|max_epoch|steps_per_epoch
self warmup get_warmup_steps warmup_steps
range i
self warmup get_lr i|1 lr
i||self steps_per_epoch cur_ep
lr_each_step append lr
np array lr_each_step astype np float32
super MultiplicativeLR|self __init__ lr|max_epoch|steps_per_epoch
self base_lr current_lr
current_lr lr
epoch_size self epoch_size
gamma self gamma
super StepLR|self __init__ lr|max_epoch|steps_per_epoch
self base_lr|self gamma(cur_ep||self epoch_size) lr
end_lr self end_lr
power self power
max_epoch self max_epoch
lr self lr
super POLYLR|self __init__ lr|max_epoch|steps_per_epoch
self steps_per_epoch|self max_epoch total_steps
min i|total_steps step_
lr_each_step append (self lr-self end_lr)|((1 0-step_|total_steps)self power)|self end_lr
print lr_each_step
Counter milestones self milestones
super MultiStepLR|self __init__ lr|max_epoch|steps_per_epoch
current_lr|self gamma current_lr
super ExponentialLR|self __init__ lr|max_epoch|steps_per_epoch
left 1-\cos\left \frac{t_{max}}\pi\right\right
(2k|1)t_{max}  t_{cur}
t_max self t_max
eta_min self eta_min
super CosineAnnealingLR|self __init__ lr|max_epoch|steps_per_epoch
self eta_min|(self base_lr-self eta_min)| current_lr
max_lr self max_lr
float step_size_up step_size_up
step_size_up|step_size_down self total_size
step_size_up|self total_size self step_ratio
mode self mode
self _triangular_scale_fn self scale_fn
self _triangular2_scale_fn self scale_fn
self _exp_range_scale_fn self scale_fn
scale_fn self scale_fn
scale_mode self scale_mode
super CyclicLR|self __init__ lr|max_epoch|steps_per_epoch
math floor 1|i|self total_size cycle
x|self step_ratio scale_factor
(x-1)|(self step_ratio-1) scale_factor
(self max_lr-self base_lr)|scale_factor base_height
self base_lr|base_height|self scale_fn cycle lr
self base_lr|base_height|self scale_fn lr
self base_lr|base_height|self scale_fn i lr
t_{i} t_{cur}
ValueError  format t_0
isinstance t_mult|int
t_0 self t_0
t_0 self t_i
t_mult self t_mult
super CosineAnnealingWarmRestarts|self __init__ lr|max_epoch|steps_per_epoch
self t_cur-self t_i self t_cur
self t_i|self t_mult self t_i
self eta_min|(self base_lr-self eta_min)| lr
lr|div_factor max_lr
lr|final_div_factor min_lr
super OneCycleLR|self __init__ lr|max_epoch|steps_per_epoch
float pct_start|self total_steps-1 self step_size_up
float self total_steps-self step_size_up-1 self step_size_down
isinstance pct_start|float
ValueError  format pct_start
ValueError  format anneal_strategy
self _annealing_cos self anneal_func
self _annealing_linear self anneal_func
lr|div_factor self max_lr
lr|final_div_factor self min_lr
math cos math pi|pct|1 cos_out
self anneal_func self base_lr|self max_lr|i|self step_size_up lr
i-self step_size_up down_step_num
self anneal_func self max_lr|self min_lr|down_step_num|self step_size_down lr
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step lr
lr base_lr
int max_epoch|steps_per_epoch total_steps
int warmup_epochs|steps_per_epoch warmup_steps
lr_epochs milestones
milestones milestone
milestone|steps_per_epoch milestones_step
milestones_steps append milestones_step
base_lr lr
Counter milestones_steps milestones_steps_counter
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr
lr|gammamilestones_steps_counter[i] lr
lr_epochs append i
i||steps_per_epoch last_epoch
eta_min|(base_lr-eta_min)|(1 |math cos(math pi|last_epoch|t_max))|2 lr
int max_epoch|1|3 t_max_v2
lr last_lr
last_epoch last_epoch_v1
last_lr base_lr
last_epoch-last_epoch_v1 last_epoch
eta_min|(base_lr-eta_min)|(1 |math cos(math pi|last_epoch|t_max_v2))|2 lr
start_sample_epoch|step_sample|tobe_sampled_epoch end_sampled_epoch
max_epoch|tobe_sampled_epoch max_sampled_epoch
max_sampled_epoch t_max
int max_sampled_epoch|steps_per_epoch total_sampled_steps
range start_sample_epoch|end_sampled_epoch|step_sample
lr self base_lr lr
float self warmup_init_lr|lr_inc|current_step lr self lr
float self warmup_init_lr|lr_inc|current_step lr gamma current_lr
float self warmup_init_lr|lr_inc|current_step lr max_lr
float self warmup_init_lr|lr_inc|current_step lr min_lr
float self warmup_init_lr|lr_inc|current_step lr self max_lr
float self warmup_init_lr|lr_inc|current_step lr self min_lr
float self warmup_init_lr|lr_inc|current_step lr base_lr
float self warmup_init_lr|lr_inc|current_step lr lr
float self warmup_init_lr|lr_inc|current_step lr last_lr
scheduler get_lr lr self lr
scheduler get_lr lr gamma current_lr
scheduler get_lr lr max_lr
scheduler get_lr lr min_lr
scheduler get_lr lr self max_lr
scheduler get_lr lr self min_lr
scheduler get_lr lr base_lr
scheduler get_lr lr lr
scheduler get_lr lr last_lr
super LambdaLR|self __init__ max_epoch self max_epoch
super LambdaLR|self __init__ lr self lr
super LambdaLR|self __init__ lr base_lr
super LambdaLR|self __init__ lr last_lr
range i steps_per_epoch cur_ep
range i last_epoch
self warmup get_lr i|1 lr self lr
self warmup get_lr i|1 lr gamma current_lr
self warmup get_lr i|1 lr max_lr
self warmup get_lr i|1 lr min_lr
self warmup get_lr i|1 lr self max_lr
self warmup get_lr i|1 lr self min_lr
self warmup get_lr i|1 lr base_lr
self warmup get_lr i|1 lr lr
self warmup get_lr i|1 lr last_lr
lr_each_step append lr self lr
lr_each_step append lr gamma current_lr
lr_each_step append lr max_lr
lr_each_step append lr min_lr
lr_each_step append lr self max_lr
lr_each_step append lr self min_lr
lr_each_step append lr base_lr
lr_each_step append lr lr
lr_each_step append lr last_lr
super MultiplicativeLR|self __init__ max_epoch self max_epoch
super MultiplicativeLR|self __init__ lr self lr
super MultiplicativeLR|self __init__ lr base_lr
super MultiplicativeLR|self __init__ lr last_lr
self base_lr current_lr lr
self base_lr current_lr gamma current_lr
current_lr lr self lr
current_lr lr gamma current_lr
current_lr lr max_lr
current_lr lr min_lr
current_lr lr self max_lr
current_lr lr self min_lr
current_lr lr base_lr
current_lr lr lr
current_lr lr last_lr
super StepLR|self __init__ max_epoch self max_epoch
super StepLR|self __init__ lr self lr
super StepLR|self __init__ lr base_lr
super StepLR|self __init__ lr last_lr
self base_lr|self gamma(cur_ep||self epoch_size) lr self lr
self base_lr|self gamma(cur_ep||self epoch_size) lr gamma current_lr
self base_lr|self gamma(cur_ep||self epoch_size) lr max_lr
self base_lr|self gamma(cur_ep||self epoch_size) lr min_lr
self base_lr|self gamma(cur_ep||self epoch_size) lr self max_lr
self base_lr|self gamma(cur_ep||self epoch_size) lr self min_lr
self base_lr|self gamma(cur_ep||self epoch_size) lr base_lr
self base_lr|self gamma(cur_ep||self epoch_size) lr lr
self base_lr|self gamma(cur_ep||self epoch_size) lr last_lr
super POLYLR|self __init__ lr base_lr
super POLYLR|self __init__ lr last_lr
min i|total_steps step_ self total_size
min i|total_steps step_ end_sampled_epoch
Counter milestones self milestones milestone
super MultiStepLR|self __init__ lr base_lr
super MultiStepLR|self __init__ lr last_lr
current_lr|self gamma current_lr gamma current_lr
super ExponentialLR|self __init__ lr base_lr
super ExponentialLR|self __init__ lr last_lr
super CosineAnnealingLR|self __init__ lr base_lr
super CosineAnnealingLR|self __init__ lr last_lr
float step_size_up step_size_up self total_size
float step_size_up step_size_up total_size self step_ratio
self _triangular_scale_fn self scale_fn self scale_fn
self _triangular2_scale_fn self scale_fn self scale_fn
self _exp_range_scale_fn self scale_fn self scale_fn
super CyclicLR|self __init__ lr base_lr
super CyclicLR|self __init__ lr last_lr
self base_lr|base_height|self scale_fn cycle lr max_lr
self base_lr|base_height|self scale_fn cycle lr min_lr
self base_lr|base_height|self scale_fn cycle lr self max_lr
self base_lr|base_height|self scale_fn cycle lr self min_lr
self base_lr|base_height|self scale_fn cycle lr base_lr
self base_lr|base_height|self scale_fn cycle lr lr
self base_lr|base_height|self scale_fn cycle lr last_lr
self base_lr|base_height|self scale_fn lr max_lr
self base_lr|base_height|self scale_fn lr min_lr
self base_lr|base_height|self scale_fn lr self max_lr
self base_lr|base_height|self scale_fn lr self min_lr
self base_lr|base_height|self scale_fn lr base_lr
self base_lr|base_height|self scale_fn lr lr
self base_lr|base_height|self scale_fn lr last_lr
self base_lr|base_height|self scale_fn i lr max_lr
self base_lr|base_height|self scale_fn i lr min_lr
self base_lr|base_height|self scale_fn i lr self max_lr
self base_lr|base_height|self scale_fn i lr self min_lr
self base_lr|base_height|self scale_fn i lr base_lr
self base_lr|base_height|self scale_fn i lr lr
self base_lr|base_height|self scale_fn i lr last_lr
ValueError  format t_0 self t_0
ValueError  format t_0 self t_i
isinstance t_mult self t_mult
isinstance int max_epoch|steps_per_epoch total_steps
isinstance int warmup_epochs|steps_per_epoch warmup_steps
isinstance int max_epoch|1|3 t_max_v2
isinstance int max_sampled_epoch|steps_per_epoch total_sampled_steps
super CosineAnnealingWarmRestarts|self __init__ lr base_lr
super CosineAnnealingWarmRestarts|self __init__ lr last_lr
self eta_min|(self base_lr-self eta_min)| lr max_lr
self eta_min|(self base_lr-self eta_min)| lr min_lr
self eta_min|(self base_lr-self eta_min)| lr self max_lr
self eta_min|(self base_lr-self eta_min)| lr self min_lr
self eta_min|(self base_lr-self eta_min)| lr base_lr
self eta_min|(self base_lr-self eta_min)| lr lr
self eta_min|(self base_lr-self eta_min)| lr last_lr
super OneCycleLR|self __init__ lr base_lr
super OneCycleLR|self __init__ lr last_lr
isinstance float init_lr|lr_inc|current_step lr
self anneal_func self base_lr|self max_lr|i|self step_size_up lr base_lr
self anneal_func self base_lr|self max_lr|i|self step_size_up lr lr
self anneal_func self base_lr|self max_lr|i|self step_size_up lr last_lr
self anneal_func self max_lr|self min_lr|down_step_num|self step_size_down lr base_lr
self anneal_func self max_lr|self min_lr|down_step_num|self step_size_down lr lr
self anneal_func self max_lr|self min_lr|down_step_num|self step_size_down lr last_lr
float init_lr|lr_inc|current_step lr base_lr
float init_lr|lr_inc|current_step lr lr
float init_lr|lr_inc|current_step lr last_lr
lr base_lr lr
lr_epochs milestones milestone
milestones milestone milestones_step
base_lr lr lr
base_lr lr last_lr
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr lr
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr last_lr
lr|gammamilestones_steps_counter[i] lr lr
lr|gammamilestones_steps_counter[i] lr last_lr
lr_epochs append i last_epoch
i||steps_per_epoch last_epoch last_epoch_v1
eta_min|(base_lr-eta_min)|(1 |math cos(math pi|last_epoch|t_max))|2 lr last_lr
lr last_lr base_lr
max_epoch|tobe_sampled_epoch max_sampled_epoch t_max
parser parse_args args
torch load model_path|map_location state_dict_
state_dict_ k
k startswith
state_dict_ k state_dict k
os path isfile model_path
load_checkpoint model_path param_dict
param_dict items key|values
key startswith
values param_dict_new key
FileNotFoundError  format model_path
ckpt name
name pt_name
pt_name replace pt_name
name out pt_name
load_model pt state_dict_torch
load_model_ms ckpt state_dict_ms
name_map state_dict_ms name_relate
state_dict_torch key
state_dict_torch key parameter
parameter numpy parameter
parameter transpose 1|0|2|3 parameter
name_relate key param_dict
Tensor parameter param_dict
new_params_list append param_dict
save_checkpoint new_params_list|out_ckpt
pt_to_ckpt args pt_fn|args ckpt_fn|args out_ckpt_fn
torch load model_path|map_location state_dict_ k
torch load model_path|map_location state_dict_ k state_dict k
state_dict_ k startswith
load_checkpoint model_path param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
ckpt name pt_name
ckpt name out pt_name
name pt_name replace pt_name
load_model pt state_dict_torch key
load_model pt state_dict_torch key parameter
name_map state_dict_ms name_relate key param_dict
state_dict_torch key parameter numpy parameter
state_dict_torch key parameter transpose 1|0|2|3 parameter
 [0|1]|[3|4] flip_idx
[512|512] default_resolution
{} heads
[0 408|0 447|0 470] mean
[0 289|0 274|0 278] std
[0 999|] test_scales
C MultitypeFuncGraph _grad_scale
P Reciprocal reciprocal
_grad_scale register
reciprocal scale
super IDAUp|self __init__
out_dim self out_dim
 self up
 self conv
conv1x1 channel|out_dim
self up x0 x
self conv x1 y
x|y out
super MobileNetUp|self __init__
conv1x1 channels|out_dim
 self conv_last
conv3x3 out_dim|out_dim
IDAUp out_dim|channels self up1
IDAUp out_dim|channels self up2
IDAUp out_dim|channels self up3
self conv x4 x
self up1 x|x3 x
self up2 x|x2 x
self up3 x|x1 x
self conv_last x x
super Cast|self __init__
P Cast self cast
self cast x|ms float32
yolov3_darknet53 80|[1|3|416|416]
super CenterfaceMobilev2|self __init__
ConfigCenterface self config
mobilenet_v2 self base
self base feat_channel channels
MobileNetUp channels|out_dim self dla_up
self base x x4
self dla_up x1|x2|x3|x4 x
self hm_head x output_hm
self wh_head x output_wh
self off_head x output_off
self kps_head x output_kps
super CenterFaceLoss|self __init__
wh_weight self wh_weight
reg_offset self reg_offset
off_weight self off_weight
hm_weight self hm_weight
lm_weight self lm_weight
FocalLoss self cls_loss
SmoothL1LossNew self reg_loss
SmoothL1LossNewCMask self reg_loss_cmask
P Print self print
self cls_loss output_hm|hm hm_loss
self reg_loss output_wh|ind|wh|wight_mask wh_loss
self reg_loss output_off|ind|hm_offset|wight_mask off_loss
self reg_loss_cmask output_kps|hps_mask|ind|landmarks lm_loss
self hm_weight|hm_loss|self wh_weight|wh_loss| loss
F depend loss|F sqrt F cast wight_mask|mstype float32
F depend loss|F sqrt F cast reg_mask|mstype float32
super CenterFaceWithLossCell|self __init__
network self centerface_network
P ReduceSum self reduce_sum
self centerface_network x output_kps
network self network
self network set_grad
optimizer parameters self weights
optimizer self optimizer
sens self sens
context get_auto_parallel_context self parallel_mode
context get_auto_parallel_context mean
auto_parallel_context get_device_num_is_set
context get_auto_parallel_context degree
get_group_size degree
nn DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
C HyperMap self hyper_map
NPUAllocFloatStatus self alloc_status
NPUGetFloatStatus self get_status
NPUClearFloatStatus self clear_status
Tensor 1|mstype float32 self base
LessEqual self less_equal
P AllReduce self allreduce
self parallel_mode self is_distributed
self weights weights
self network x|hm|reg_mask|ind|wh|wight_mask|hm_offset|hps_mask|landmarks loss
self alloc_status init
self clear_status init
P Fill P DType loss sens
self grad_reducer grads grads
self get_status init
self reduce_sum init|(0|) flag_sum
self allreduce flag_sum flag_reduce
self less_equal self base|flag_reduce cond
self less_equal self base|flag_sum cond
(loss|cond|sens) ret
F depend ret|self optimizer grads
super CenterFaceWithNms|self __init__
P Reshape self reshape
self config test_batch_size self test_batch
self config K self k
self maxpool2d output_hm _
P Abs output_hm-output_hm_nms abs_error
P Abs output_hm abs_out
abs_error|(abs_out|1e-12) error
P Fill ms float32|P Shape error|1 0
output_hm|keep output_hm
self reshape output_hm|(self test_batch|-1) scores
self topk scores|self k topk_inds
C MultitypeFuncGraph _grad_scale register
P Reciprocal reciprocal scale
conv1x1  self conv_last
self up x0 x out
self conv x1 y out
x|y out self dla_up
x|y out error
conv1x1  self conv_last
self base feat_channel channels self dla_up
self hm_head x output_hm output_hm
self hm_weight|hm_loss|self wh_weight|wh_loss| loss ret
self network x|hm|reg_mask|ind|wh|wight_mask|hm_offset|hps_mask|landmarks loss ret
P Fill P DType loss sens ret
self less_equal self base|flag_reduce cond ret
self less_equal self base|flag_sum cond ret
self config K self k output_hm
P Abs output_hm-output_hm_nms abs_error error
P Abs output_hm abs_out error
abs_error|(abs_out|1e-12) error error
output_hm|keep output_hm output_hm
divisor min_value
max min_value|int(v|divisor|2)||divisor|divisor new_v
divisor new_v
super DepthWiseConv|self __init__
has_bias self has_bias
P BiasAdd self bias_add
[channel_multiplier|in_planes|kernel_size|kernel_size] weight_shape
[channel_multiplier|in_planes] bias_shape
Parameter initializer bias_shape self bias
self depthwise_conv x|self weight output
self bias_add output|self bias output
(kernel_size-1)||2 padding
super ConvBNReLU|self __init__
nn SequentialCell layers self features
in_planes self in_planes
P Print self print
self features x x
super InvertedResidual|self __init__
stride self stride
int round inp|expand_ratio hidden_dim
stride|groups stride
nn SequentialCell layers self conv
TensorAdd self add
P Cast self cast
x identity
self conv x x
self add identity|x
super MobileNetV2|self __init__
InvertedResidual block
[1|2|4|6] self feat_id
_make_divisible input_channel|width_mult|round_nearest input_channel
_make_divisible c|width_mult|round_nearest output_channel
range i
output_channel input_channel
nn SequentialCell features self need_fp1
self feat_channel append output_channel
nn SequentialCell features self need_fp2
nn SequentialCell features self need_fp3
nn SequentialCell features self need_fp4
self need_fp1 x x1
self need_fp2 x1 x2
self need_fp3 x2 x3
self need_fp4 x3 x4
MobileNetV2 kwargs
self features x x identity
stride|groups stride stride
_make_divisible c|width_mult|round_nearest output_channel input_channel
CenterfaceDataset config centerface_gen
columns output_columns
columns column_order
compose_map_func operations
de_dataset repeat max_epoch de_dataset
de_dataset get_dataset_size
arr reshape arr
num arr
isinstance num|np ndarray
math sqrt
isinstance param|boolandisinstance param|intorisinstance param|float
param negative_slope
ValueError  format param
math sqrt 2 0|(1|negative_slope2)
ValueError  format nonlinearity
mode lower mode
ValueError  format mode|valid_modes
_calculate_fan_in_and_fan_out array fan_out
mathcal{U}(-\text{bound}|\text{bound})
 text{bound}
np empty 3|5 w
_calculate_correct_fan arr|mode fan
calculate_gain nonlinearity|a gain
gain|math sqrt fan std
math sqrt|std bound
np random uniform -bound|bound|arr shape
mathcal{N}(0|\text{std}^2)
 text{std}
np random normal 0|std|arr shape
len arr shape dimensions
arr shape num_input_fmaps
arr shape num_output_fmaps
arr size receptive_field_size
num_input_fmaps|receptive_field_size fan_in
num_output_fmaps|receptive_field_size fan_out
mathcal{U}(-a|a)
 a
nn init calculate_gain gain
_calculate_fan_in_and_fan_out arr fan_out
gain|math sqrt(2 0|float(fan_in|fan_out)) std
math sqrt|std a
np random uniform -a|a|arr shape
super XavierUniform|self __init__
gain self gain
xavier_uniform_ arr|self gain tmp
assignment arr|tmp
super KaimingUniform|self __init__
a self a
mode self mode
nonlinearity self nonlinearity
kaiming_uniform_ arr|self a|self mode|self nonlinearity tmp
super KaimingNormal|self __init__
kaiming_normal_ arr|self a|self mode|self nonlinearity tmp
super RandomNormal|self __init__
std self std
self std std
np random normal 0|std|arr shape tmp
np random seed
custom_cell cells_and_names name|cell
isinstance cell|(nn Conv2d)
isinstance cell|nn Dense
isinstance cell|(nn BatchNorm2d|nn BatchNorm1d)
cell gamma set_data init initializer cell gamma data shape to_tensor
cell beta set_data init initializer cell beta data shape to_tensor
isinstance cell|nn Conv2dTranspose
num arr shape num_input_fmaps
num arr shape num_output_fmaps
num arr size receptive_field_size
isinstance param|boolandisinstance param|intorisinstance param negative_slope
isinstance param|boolandisinstance param|intorisinstance  text{bound}
isinstance param|boolandisinstance param|intorisinstance  text{std}
isinstance param|boolandisinstance param|intorisinstance  a
math sqrt 2  text{bound}
math sqrt 2  text{std}
math sqrt 2  a
ValueError  format nonlinearity self nonlinearity
ValueError  format  text{bound}
ValueError  format  text{std}
ValueError  format  a
ValueError  format mode self mode
calculate_gain nonlinearity|a gain sqrt fan std
calculate_gain nonlinearity|a gain sqrt(2 0|float(fan_in|fan_out)) std
calculate_gain nonlinearity|a gain self gain
gain|math sqrt fan std self std
arr shape num_input_fmaps fan_in
arr shape num_output_fmaps fan_out
arr size receptive_field_size fan_in
arr size receptive_field_size fan_out
 a self a
nn init calculate_gain gain sqrt(2 0|float(fan_in|fan_out)) std
nn init calculate_gain gain self gain
gain|math sqrt(2 0|float(fan_in|fan_out)) std self std
math sqrt|std a self a
custom_cell cells_and_names cell gamma set_data init initializer cell gamma data shape to_tensor
custom_cell cells_and_names cell beta set_data init initializer cell beta data shape to_tensor
load_checkpoint ckpt_path param_dict
name split names
len names
names||names tmp
tmp replace_name
name replace replace_name||str(replace_idx) name
net cells_and_names name|cell
name startswith centerface_backbone_prefix
name replace centerface_backbone_prefix|mobilev2_backbone_prefix name
isinstance cell|(nn Conv2d|nn Dense|DepthWiseConv)
replace_names name|replace_name|replace_idx replace_idx
cell weight set_data param_dict mobilev2_weight data
find_param append mobilev2_weight
not_found_param append mobilev2_weight
cell bias set_data param_dict mobilev2_bias data
find_param append mobilev2_bias
not_found_param append mobilev2_bias
isinstance cell|(nn BatchNorm2d|nn BatchNorm1d)
cell moving_mean set_data param_dict mobilev2_moving_mean data
find_param append mobilev2_moving_mean
not_found_param append mobilev2_moving_mean
cell moving_variance set_data param_dict mobilev2_moving_variance data
find_param append mobilev2_moving_variance
not_found_param append mobilev2_moving_variance
cell gamma set_data param_dict mobilev2_gamma data
find_param append mobilev2_gamma
not_found_param append mobilev2_gamma
cell beta set_data param_dict mobilev2_beta data
find_param append mobilev2_beta
not_found_param append mobilev2_beta
args logger info find_param
args logger info not_found_param
network trainable_params x
x name parameter_name
parameter_name endswith
no_decay_params append x
decay_params append x
dataset self dataset
rank self rank
group_size self group_size
len self dataset self dataset_length
int math ceil self dataset_length|1 0|self group_size self num_samples
self num_samples|self group_size self total_size
shuffle self shuffle
seed self seed
(self seed|1) self seed
np random seed self seed
np random permutation self dataset_length tolist indices
list range len self dataset classes indices
iter indices
name self name
fmt self fmt
self reset
tb_writer self tb_writer
val self val
val|n self sum
n self count
self sum|self count self avg
self tb_writer add_scalar self name|self val|self cur_step
fmtstr format self __dict__
super LOGGER|self __init__ logger_name
logging StreamHandler sys stdout console
console setLevel logging INFO
logging Formatter formatter
console setFormatter formatter
self addHandler console
os path exists log_dir
datetime now strftime| format rank log_name
os path join log_dir|log_name self log_fn
logging FileHandler self log_fn fh
fh setLevel logging INFO
fh setFormatter formatter
self addHandler fh
self isEnabledFor logging INFO
self _log logging INFO|msg|args|kwargs
self info
vars args args_dict
args_dict keys key
self info key
|line_width important_msg
|2 important_msg
self info important_msg|args|kwargs
LOGGER rank logger
logger setup_logging_file path|rank
name split names tmp
len names tmp
names||names tmp replace_name
net cells_and_names name startswith centerface_backbone_prefix
net cells_and_names name replace centerface_backbone_prefix|mobilev2_backbone_prefix name
net cells_and_names cell weight set_data param_dict mobilev2_weight data
net cells_and_names cell bias set_data param_dict mobilev2_bias data
net cells_and_names cell moving_mean set_data param_dict mobilev2_moving_mean data
net cells_and_names cell moving_variance set_data param_dict mobilev2_moving_variance data
net cells_and_names cell gamma set_data param_dict mobilev2_gamma data
net cells_and_names cell beta set_data param_dict mobilev2_beta data
net cells_and_names name self name
network trainable_params x name parameter_name
x name parameter_name endswith
logging StreamHandler sys stdout console setLevel logging INFO
logging StreamHandler sys stdout console setFormatter formatter
logging FileHandler self log_fn fh setLevel logging INFO
logging FileHandler self log_fn fh setFormatter formatter
vars args args_dict keys key
LOGGER rank logger setup_logging_file path|rank
super FocalLoss|self __init__
P Log self log
P Pow self pow
P ReduceSum self sum
P Print self print
P Shape gt
self log pred|self pow 1-pred|2|pos_inds pos_loss
self log 1-pred|self pow pred|2|neg_weights|neg_inds neg_loss
self sum pos_inds num_pos
P Select P Equal num_pos|0 0 num_pos
self sum pos_loss pos_loss
self sum neg_loss neg_loss
-(pos_loss|neg_loss)|num_pos loss
super SmoothL1LossNew|self __init__
P Transpose self transpose
nn SmoothL1Loss self smooth_l1_loss
P Shape self shape
P ExpandDims self expand_dims
P Cast self cast
self transpose output|(0|2|3|1) output
P Shape ind
self cast target|mstype float32 target
self cast output|mstype float32 output
self cast self sum mask| num
self expand_dims mask|-1 mask
output|mask output
target|mask target
self smooth_l1_loss output|target loss
loss|wight_mask loss
self sum loss loss
loss|(num|1e-4) loss
super SmoothL1LossNewCMask|self __init__
self sum cmask num
self cast ind|mstype float32 ind
self cast cmask|mstype float32 cmask
self expand_dims ind|-1 ind
output|ind output
target|ind target
self smooth_l1_loss output|cmask|target|cmask loss
self log pred|self pow 1-pred|2|pos_inds pos_loss loss
self log 1-pred|self pow pred|2|neg_weights|neg_inds neg_loss loss
self sum pos_inds num_pos loss
P Select P Equal num_pos|0 0 num_pos loss
self sum pos_loss pos_loss loss
self sum neg_loss neg_loss loss
-(pos_loss|neg_loss)|num_pos loss loss
-(pos_loss|neg_loss)|num_pos loss loss
-(pos_loss|neg_loss)|num_pos loss loss
self transpose output|(0|2|3|1) output output
self transpose output|(0|2|3|1) output output
P Shape ind output
P Shape ind target
self cast target|mstype float32 target target
self cast target|mstype float32 target target
self cast output|mstype float32 output output
self cast output|mstype float32 output output
self cast self sum mask| num loss
self expand_dims mask|-1 mask output
self expand_dims mask|-1 mask target
output|mask output output
output|mask output output
target|mask target target
target|mask target target
self smooth_l1_loss output|target loss loss
self smooth_l1_loss output|target loss loss
loss|wight_mask loss loss
loss|wight_mask loss loss
self sum loss loss loss
loss|(num|1e-4) loss loss
self cast ind|mstype float32 ind output
self cast ind|mstype float32 ind target
self expand_dims ind|-1 ind output
self expand_dims ind|-1 ind target
output|ind output output
target|ind target target
parser parse_args args
print  format model_path|checkpoint
checkpoint state_dict_
state_dict_ k
k startswith
state_dict_ k state_dict k
isinstance model|torch nn DataParallel
model module state_dict state_dict
model state_dict state_dict
optimizer state_dict data
torch save data|path
os path isfile model_path
load_checkpoint model_path param_dict
param_dict items key|values
key startswith
values param_dict_new key
FileNotFoundError  format model_path
ckpt name
name pt_name
pt_name replace pt_name
name out pt_name
load_model pt state_dict_torch
load_model_ms ckpt state_dict_ms
name_map state_dict_ms name_relate
state_dict_torch key
state_dict_torch key parameter
parameter numpy parameter
parameter transpose 1|0|2|3 parameter
name_relate key param_dict
Tensor parameter param_dict
new_params_list append param_dict
save_checkpoint new_params_list|out_path
name_relate key name
state_dict_ms name parameter
parameter asnumpy parameter
torch from_numpy parameter state_dict key
pt_to_ckpt args pt_fn|args ckpt_fn|args out_fn
ckpt_to_pt args pt_fn|args ckpt_fn|args out_fn
print  format checkpoint state_dict_
checkpoint state_dict_ k
checkpoint state_dict_ k state_dict k
state_dict_ k startswith
load_checkpoint model_path param_dict items key|values
param_dict items key startswith
param_dict items values param_dict_new key
ckpt name pt_name
ckpt name out pt_name
name pt_name replace pt_name
load_model pt state_dict_torch key
load_model pt state_dict_torch key parameter
load_model_ms ckpt state_dict_ms name parameter
name_map state_dict_ms name_relate key param_dict
name_map state_dict_ms name_relate key name
state_dict_torch key parameter numpy parameter
state_dict_torch key parameter transpose 1|0|2|3 parameter
state_dict_torch key parameter asnumpy parameter
state_dict_ms name parameter asnumpy parameter
kwargs get False infer_mode
infer_mode config INFERENCE
ETSNet config
NotImplementedError f
kwargs get False infer_mode config INFERENCE
parser parse_args args
self reset
val self val
val|n self sum
n self count
self sum|self count self avg
sorted points|key clockwise_points
os path isdir path
os makedirs path
os path join path| format(os path splitext img_name) filename
enumerate _|bbox
bbox reshape -1|2 bbox
np array list sort_to_clockwise bbox [3|0|1|2] bbox
lines append line
open filename|
lines line
f write line
os path isdir
os makedirs
test_dataset_creator ds
ETSNet config net
print args ckpt
load_checkpoint args ckpt param_dict
load_param_into_net net|param_dict
AverageMeter get_data_time
AverageMeter model_run_time
AverageMeter post_process_time
time time end_pts
iters data
data img_name
img astype np uint8 copy img
img_name decode img_name
time time get_data_pts
get_data_time update get_data_pts-end_pts
Tensor img_resized|mstype float32 img_tensor
net img_tensor kernels
np squeeze score asnumpy score
np squeeze kernels asnumpy kernels
time time model_run_pts
model_run_time update model_run_pts-get_data_pts
pse kernels|5 0 pred
max img shape|1 0|config INFER_LONG_SIZE scale
pred label
np max label|1 label_num
range i
cv2 minAreaRect points rect
cv2 boxPoints rect|scale bbox
bbox astype bbox
cv2 drawContours img|[bbox]|0|(0|255|0)|3
bboxes append bbox
time time post_process_pts
post_process_time update post_process_pts-model_run_pts
get_data_time reset
model_run_time reset
post_process_time reset
cv2 imwrite  format img_name|img copy
write_result_as_txt img_name|bboxes|
enumerate bbox reshape -1|2 bbox
enumerate bbox astype bbox
np array list sort_to_clockwise bbox [3|0|1|2] bbox astype bbox
ETSNet config net img_tensor kernels
load_param_into_net net img_tensor kernels
AverageMeter get_data_time update get_data_pts-end_pts
AverageMeter get_data_time reset
AverageMeter model_run_time update model_run_pts-get_data_pts
AverageMeter model_run_time reset
AverageMeter post_process_time update post_process_pts-model_run_pts
AverageMeter post_process_time reset
iters data img_name
data img_name decode img_name
pse kernels|5 0 pred label
cv2 boxPoints rect|scale bbox astype bbox
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
ETSNet config net
load_checkpoint args ckpt_file param_dict
load_param_into_net net|param_dict
Tensor np ones [args batch_size|3|config INFER_LONG_SIZE|config INFER_LONG_SIZE] input_arr
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
parser parse_args args
load_param_into_net net|param_dict
get_rank rank_id
train_dataset_creator rank_id|args device_num ds
ds get_dataset_size step_size
ETSNet config net
net set_train net
load_checkpoint args pre_trained param_dict
DiceLoss batch_size criterion
dynamic_lr config BASE_LR|config TRAIN_TOTAL_ITER|config WARMUP_STEP|config WARMUP_RATIO lrs
WithLossCell net|criterion net
TrainOneStepCell net|opt net
TimeMonitor data_size time_cb
Model net model
load_param_into_net net set_train net
train_dataset_creator rank_id|args device_num ds get_dataset_size step_size
ETSNet config net set_train net
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step learning_rate
float current_step-warmup_steps|float(decay_steps) base
(1|math cos(base|math pi))|2|base_lr learning_rate
range i
lr append linear_warmup_learning_rate i|warmup_steps|base_lr|base_lr|warmup_ratio
lr append a_cosine_learning_rate i|base_lr|warmup_steps|total_steps
lr append linear_warmup_learning_rate lr append linear_warmup_learning_rate i|warmup_steps|base_lr|base_lr|warmup_ratio
lr append linear_warmup_learning_rate lr append a_cosine_learning_rate i|base_lr|warmup_steps|total_steps
lr append a_cosine_learning_rate lr append a_cosine_learning_rate i|base_lr|warmup_steps|total_steps
 config
cv2 imread img_path img
cv2 cvtColor img|cv2 COLOR_BGR2RGB img
img shape w
f readlines lines
lines line
line replace line
line split gt
np asarray box|([w|1 0|h|1 0]|4) box
bboxes append box
tags append tag
np array bboxes
max h|w
np array [0 5|1 0|2 0|3 0] random_scale1
np random choice random_scale1 scale2
(min_size|10)|1 0|min(h|w) scale3
enumerate i|_
random random|2|max_angle-max_angle angle
imgs i img
img shape h
cv2 getRotationMatrix2D (h|2|w|2) rotation_matrix
cv2 warpAffine img|rotation_matrix|(h|w) img_rotation
img_rotation imgs i
imgs shape w
img_size tw
random random>3 0|8 0andnp max imgs
min br|h-th br
min br|w-tw br
random randint tl|br i
random randint tl|br j
random randint 0|h-th i
random randint 0|w-tw j
enumerate idx|_
long_size|1 0|max(h|w) scale_long
np sqrt np sum (a-b)2
range i
dist bbox peri
rate|rate rate
bboxes bbox
plg Polygon bbox area area
perimeter bbox peri
pyclipper PyclipperOffset pco
pco AddPath bbox|pyclipper JT_ROUND|pyclipper ET_CLOSEDPOLYGON
min (int)(area|(1-rate)|(peri|0 001)|0 5) offset
pco Execute -offset shrinked_bbox
shrinked_bboxes append bbox
np array shrinked_bbox shrinked_bbox
shrinked_bboxes append shrinked_bbox
np array shrinked_bboxes
config TRAIN_LONG_SIZE self img_size
config KERNEL_NUM self kernel_num
config TRAIN_MIN_SCALE self min_scale
os path join os path join os path dirname __file__ root_dir
root_dir ic15_train_data_dir
root_dir ic15_train_gt_dir
[ic15_train_data_dir] data_dirs
[ic15_train_gt_dir] gt_dirs
zip data_dir|gt_dir
os path splitext i lower
enumerate _|img_name
os path join data_dir|img_name img_path
os path join gt_dir|gt_name gt_path
img_paths append img_path
gt_paths append gt_path
self all_img_paths extend img_paths
self all_gt_paths extend gt_paths
self all_img_paths index img_path
self all_gt_paths index gt_path
get_img img_path img
get_bboxes img|gt_path tags
random_scale img|min_size img
img shape img_w
np zeros (img_h|img_w) gt_text
np ones (img_h|img_w) training_mask
np reshape bboxes|([img_w|img_h]|4) bboxes
cv2 drawContours gt_text|[bboxes[i]]|0|i|1|-1
cv2 drawContours training_mask|[bboxes[i]]|0|0|-1
np zeros img shape|dtype gt_kernel
shrink bboxes|rate kernel_bboxes
range j
cv2 drawContours gt_kernel|[kernel_bboxes[j]]|0|1|-1
gt_kernels append gt_kernel
[img|gt_text|training_mask] imgs
imgs extend gt_kernels
random_horizontal_flip imgs imgs
random_rotate imgs imgs
random_crop imgs|self img_size imgs
imgs|imgs|imgs|imgs gt_kernels
np array gt_kernels gt_kernels
Image fromarray img img
img convert img
py_transforms ToTensor img img
py_transforms Normalize mean img
gt_text astype np float32 gt_text
gt_kernels astype np float32 gt_kernels
training_mask astype np float32 training_mask
len self all_img_paths
config TEST_ROOT_DIR ic15_test_data_dir
config INFER_LONG_SIZE img_size
img_sizeif img_sizeisNoneorisinstance img_size|tupleelse(img_size|img_size) img_size
[ic15_test_data_dir] data_dirs
data_dirs data_dir
data_dir|img_name img_path
all_img_paths extend img_paths
len all_img_paths dataset_length
range index
all_img_paths index img_path
np array os path split img_path img_name
max img shape long_size
np zeros (long_size|long_size|3) img_resized
img img_resized
cv2 resize img_resized|dsize img_resized
Image fromarray img_resized img_resized
img_resized convert img_resized
py_transforms ToTensor img_resized img_resized
py_transforms Normalize mean img_resized
dataset self dataset
rank self rank
group_size self group_size
len self dataset self dataset_len
int math ceil self dataset_len|1 0|self group_size self num_samplers
self num_samplers|self group_size self total_size
shuffle self shuffle
seed self seed
(self seed|1) self seed
np random seed self seed
np random permutation self dataset_len tolist indices
list range len self dataset_len indices
iter indices
cv2 setNumThreads
TrainDataset dataset
DistributedSampler dataset|rank|group_size|shuffle sampler
ds repeat ds
ds batch config TRAIN_BATCH_SIZE|drop_remainder ds
de GeneratorDataset IC15_TEST_Generator ds
ds shuffle config TEST_BUFFER_SIZE ds
ds batch 1|drop_remainder ds
cv2 imread img_path img shape w
cv2 imread img_path img shape h
cv2 imread img_path img img
cv2 imread img_path img shape img_w
cv2 imread img_path img imgs
cv2 imread img_path img gt_kernels
cv2 imread img_path img convert img
cv2 imread img_path img img_path
cv2 imread img_path img img_resized
cv2 cvtColor img|cv2 COLOR_BGR2RGB img shape w
cv2 cvtColor img|cv2 COLOR_BGR2RGB img shape h
cv2 cvtColor img|cv2 COLOR_BGR2RGB img img
cv2 cvtColor img|cv2 COLOR_BGR2RGB img shape img_w
cv2 cvtColor img|cv2 COLOR_BGR2RGB img imgs
cv2 cvtColor img|cv2 COLOR_BGR2RGB img gt_kernels
cv2 cvtColor img|cv2 COLOR_BGR2RGB img convert img
cv2 cvtColor img|cv2 COLOR_BGR2RGB img img_path
cv2 cvtColor img|cv2 COLOR_BGR2RGB img img_resized
f readlines lines line
lines line replace line
lines line split gt
line split gt imgs
np array bboxes bbox
imgs i img shape h
imgs i img img
imgs i img shape img_w
imgs i img imgs
imgs i img gt_kernels
imgs i img convert img
imgs i img img_path
imgs i img img_resized
cv2 warpAffine img|rotation_matrix|(h|w) img_rotation imgs i
img_rotation imgs i gt_kernels
img_rotation imgs i img_path
random random>3 0|8 0andnp max imgs extend gt_kernels
random random>3 0|8 0andnp max imgs gt_kernels
random randint tl|br i gt_kernels
random randint tl|br i img_path
random randint 0|h-th i gt_kernels
random randint 0|h-th i img_path
range i gt_kernels
range i img_path
rate|rate rate rate
pyclipper PyclipperOffset pco AddPath bbox|pyclipper JT_ROUND|pyclipper ET_CLOSEDPOLYGON
pyclipper PyclipperOffset pco Execute -offset shrinked_bbox
os path join os path join os path dirname __file__ root_dir ic15_train_data_dir
os path join os path join os path dirname __file__ root_dir ic15_train_gt_dir
[ic15_train_data_dir] data_dirs data_dir
enumerate img shape img_w
enumerate img convert img
enumerate img img_resized
get_img img_path img img
get_img img_path img shape img_w
get_img img_path img imgs
get_img img_path img gt_kernels
get_img img_path img convert img
get_img img_path img img_path
get_img img_path img img_resized
random_scale img|min_size img img
random_scale img|min_size img shape img_w
random_scale img|min_size img imgs
random_scale img|min_size img gt_kernels
random_scale img|min_size img convert img
random_scale img|min_size img img_path
random_scale img|min_size img img_resized
np zeros (img_h|img_w) gt_text imgs
np zeros (img_h|img_w) gt_text astype np float32 gt_text
np ones (img_h|img_w) training_mask imgs
np ones (img_h|img_w) training_mask astype np float32 training_mask
cv2 drawContours gt_text astype np float32 gt_text
cv2 drawContours training_mask astype np float32 training_mask
[img|gt_text|training_mask] imgs extend gt_kernels
[img|gt_text|training_mask] imgs gt_kernels
imgs extend gt_kernels astype np float32 gt_kernels
random_horizontal_flip imgs imgs gt_kernels
random_rotate imgs imgs gt_kernels
random_crop imgs|self img_size imgs gt_kernels
imgs|imgs|imgs|imgs gt_kernels astype np float32 gt_kernels
np array gt_kernels gt_kernels astype np float32 gt_kernels
Image fromarray img img convert img
Image fromarray img img img_path
Image fromarray img img img_resized
py_transforms ToTensor img img img_path
py_transforms ToTensor img img img_resized
py_transforms Normalize mean img img_path
py_transforms Normalize mean img img_resized
len self all_img_paths extend img_paths
len self all_img_paths index img_path
[ic15_test_data_dir] data_dirs data_dir
data_dirs data_dir img_path
np zeros (long_size|long_size|3) img_resized convert img_resized
img img_resized convert img_resized
cv2 resize img_resized|dsize img_resized convert img_resized
Image fromarray img_resized img_resized convert img_resized
de GeneratorDataset IC15_TEST_Generator ds shuffle config TEST_BUFFER_SIZE ds
de GeneratorDataset IC15_TEST_Generator ds batch 1|drop_remainder ds
self reset
val self val
val|n self sum
n self count
self sum|self count self avg
super LossCallBack|self __init__
isinstance per_print_times|int
per_print_times self _per_print_times
AverageMeter self loss_avg
run_context original_args cb_params
cb_params net_outputs asnumpy loss
(cb_params cur_step_num-1)%cb_params batch_num|1 cur_step_in_epoch
cb_params cur_step_num cur_num
self loss_avg update loss
time strftime time localtime time time
print loss_log
open loss_file
loss_file write loss_log
loss_file write
loss_file close
backbone self _backbone
loss_fn self _loss_fn
self _backbone img model_predict
self _loss_fn model_predict|gt_text|gt_kernels|training_mask
network self network
ParameterTuple network trainable_params self weights
optimizer self optimizer
Tensor  np ones 1|dtype self sens
reduce_flag self reducer_flag
DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
self weights weights
self network img|gt_text|gt_kernels|training_mask loss
self grad self network|weights(img|gt_text|gt_kernels|training_mask|self sens) grads
self grad_reducer grads grads
F depend loss|self optimizer grads
isinstance per_print_times self _per_print_times
run_context original_args cb_params net_outputs asnumpy loss
run_context original_args cb_params cur_step_num cur_num
open loss_file write loss_log
open loss_file write
open loss_file close
super ETSNet|self __init__
config KERNEL_NUM self kernel_num
config INFERENCE self inference
config INFER_LONG_SIZE self long_size
config TRAIN_LONG_SIZE self long_size
_bn config NECK_OUT_CHANNEL self bn1
nn ReLU self relu1
Tensor 1 0|mstype float32 self one_float32
P Sigmoid self sigmoid
P Greater self greater
P LogicalAnd self logic_and
self feature_extractor x c5
self feature_fusion c2|c3|c4|c5 feature
self conv1 feature output
self relu1 self bn1 output output
self conv2 output output
self _upsample output output
output text
output kernels
self sigmoid text score
self conv1 feature output text
self conv1 feature output kernels
self relu1 self bn1 output output text
self relu1 self bn1 output output kernels
self conv2 output output text
self conv2 output output kernels
self _upsample output output text
self _upsample output output kernels
super FPN|self __init__
long_size self long_size
_bn out_channel self reduce_bn_c2
nn ReLU self reduce_relu_c2
_bn out_channel self reduce_bn_c3
nn ReLU self reduce_relu_c3
_bn out_channel self reduce_bn_c4
nn ReLU self reduce_relu_c4
_bn out_channel self reduce_bn_c5
nn ReLU self reduce_relu_c5
_bn out_channel self smooth_bn_p4
nn ReLU self smooth_relu_p4
_bn out_channel self smooth_bn_p3
nn ReLU self smooth_relu_p3
_bn out_channel self smooth_bn_p2
nn ReLU self smooth_relu_p2
self reduce_conv_c5 c5 p5
self reduce_relu_c5 self reduce_bn_c5 p5 p5
self reduce_conv_c4 c4 c4
self reduce_relu_c4 self reduce_bn_c4 c4 c4
self _upsample_p4 p5|c4 p4
self smooth_conv_p4 p4 p4
self smooth_relu_p4 self smooth_bn_p4 p4 p4
self reduce_conv_c3 c3 c3
self reduce_relu_c3 self reduce_bn_c3 c3 c3
self _upsample_p3 p4|c3 p3
self smooth_conv_p3 p3 p3
self smooth_relu_p3 self smooth_bn_p3 p3 p3
self reduce_conv_c2 c2 c2
self reduce_relu_c2 self reduce_bn_c2 c2 c2
self _upsample_p2 p3|c2 p2
self smooth_conv_p2 p2 p2
self smooth_relu_p2 self smooth_bn_p2 p2 p2
self _upsample_p2 p3 p3
self _upsample_p2 p4 p4
self _upsample_p2 p5 p5
self concat (p2|p3|p4|p5) out
super DiceLoss|self __init__
Tensor 0 5|mstype float32 self threshold0
Tensor 0 0|mstype float32 self zero_float32
int 640|640 self k
Tensor -1|mstype int32 self negative_one_int32
batch_size self batch_size
P Concat self concat
P LessEqual self less_equal
P Greater self greater
P ReduceSum self reduce_sum
P ReduceMean self reduce_mean
P ReduceMin self reduce_min
P Cast self cast
P Minimum self minimum
P ExpandDims self expand_dims
P Select self select
P Fill self fill
P Shape self shape
P Sigmoid self sigmoid
P Reshape self reshape
P Slice self slice
P LogicalAnd self logical_and
P LogicalOr self logical_or
P Equal self equal
P ZerosLike self zeros_like
P TensorAdd self add
P GatherV2 self gather
range i
self slice scores|(i|0|0) score
self reshape score|(640|640) score
self slice gt_texts|(i|0|0) gt_text
self reshape gt_text|(640|640) gt_text
self slice training_masks|(i|0|0) training_mask
self reshape training_mask|(640|640) training_mask
self ohem_single score|gt_text|training_mask selected_mask
selected_masks|(selected_mask|) selected_masks
self concat selected_masks selected_masks
self reduce_sum self cast pos_num|mstype float32 pos_num
self less_equal gt_text|self threshold0 neg_num
self reduce_sum self cast neg_num|mstype float32 neg_num
self minimum 3|pos_num|neg_num neg_num
self cast neg_num|mstype int32 neg_num
self add neg_num|self negative_one_int32 neg_num
self less_equal gt_text|self threshold0 neg_mask
self fill mstype float32|(640|640) ignore_score
self select neg_mask|score|ignore_score neg_score
self reshape neg_score|(640|640|) neg_score
self topk neg_score|self k _
self gather topk_values|neg_num|0 threshold
self logical_and selected_mask
self cast selected_mask|mstype float32 selected_mask
self expand_dims selected_mask|0 selected_mask
self sigmoid input_params input_sigmoid
self reshape input_sigmoid|(self batch_size|640|640) input_reshape
self reshape target|(self batch_size|640|640) target
self reshape mask|(self batch_size|640|640) mask
input_reshape|mask input_mask
target|mask target
self reduce_sum input_mask|target|1 a
self reduce_sum input_mask|input_mask|1|0 001 b
self reduce_sum target|target|1|0 001 c
(2|a)|(b|c) d
self reduce_mean d dice_loss
loss_list loss_kernel
loss_list i loss_kernel
loss_kernel|len(loss_list) loss_kernel
self slice model_predict|(0|0|0|0) texts
self reshape texts|(self batch_size|640|640) texts
self ohem_batch texts|gt_texts|training_masks selected_masks_text
self dice_loss texts|gt_texts|selected_masks_text loss_text
self slice model_predict|(0|i|0|0) kernel
self reshape kernel|(self batch_size|640|640) kernel
kernels append kernel
self sigmoid texts mask0
self cast selected_masks_kernels|mstype float32 selected_masks_kernels
self slice gt_kernels|(0|i|0|0) gt_kernel
self reshape gt_kernel|(self batch_size|640|640) gt_kernel
self dice_loss kernels i loss_kernel_i
loss_kernels append loss_kernel_i
self avg_losses loss_kernels loss_kernel
int 640|640 self k selected_masks
P Shape self shape input_mask
P Reshape self reshape input_mask
self ohem_single score|gt_text|training_mask selected_mask selected_masks
selected_masks|(selected_mask|) selected_masks selected_masks
self reshape input_sigmoid|(self batch_size|640|640) input_reshape input_mask
self reshape target|(self batch_size|640|640) target target
self reshape mask|(self batch_size|640|640) mask input_mask
self reshape mask|(self batch_size|640|640) mask target
target|mask target target
self reduce_sum input_mask|target|1 a d
self reduce_sum input_mask|input_mask|1|0 001 b d
self reduce_sum target|target|1|0 001 c d
loss_list loss_kernel loss_kernel
loss_list i loss_kernel loss_kernel
loss_kernel|len(loss_list) loss_kernel loss_kernel
os path dirname os path realpath __file__ BASE_DIR
TruncatedNormal init_value
kernel_size|stride kernel_size
kernel_size|stride kernel_size kernel_size
super ResidualBlock|self __init__
out_channels||self expansion out_chls
_bn out_chls|momentum self bn1
_bn out_chls|momentum self bn2
_bn out_channels|momentum self bn3
P ReLU self relu
(in_channels) self downsample
stride self stride
_bn out_channels|momentum self bn_down_sample
P TensorAdd self add
x identity
self conv1 x out
self bn1 out out
self relu out out
self conv2 out out
self bn2 out out
self conv3 out out
self bn3 out out
self conv_down_sample identity identity
self bn_down_sample identity identity
self add out|identity out
super ResNet|self __init__
_bn self bn1
P Pad ((0|0)) self pad
in_channels in_channel
out_channels out_channel
_make_layer BasicBlock|3|128|256|2
block in_channel|out_channel|stride resblk
layers append resblk
range _
nn SequentialCell layers
self conv1 x x
self bn1 x x
self relu x x
self pad x x
self maxpool x c1
self layer1 c1 c2
self layer2 c2 c3
self layer3 c3 c4
self layer4 c4 c5
out_channels||self expansion out_chls self bn1
out_channels||self expansion out_chls self bn2
self conv1 x out resblk
self bn1 out out resblk
self relu out out resblk
self conv2 out out resblk
self bn2 out out resblk
self conv3 out out resblk
self bn3 out out resblk
self add out|identity out resblk
in_channels in_channel resblk
out_channels out_channel resblk
Faster_Rcnn_Resnet50 config config
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
Faster_Rcnn_Resnet50 config net
load_checkpoint args ckpt_file param_dict
load_param_into_net net|param_dict
Tensor np zeros [config test_batch_size|3|config img_height|config img_width] img
Tensor np random uniform 0 0|1 0|size img_metas
Tensor np random uniform 0 0|1 0|size gt_bboxes
Tensor np random uniform 0 0|1 0|size gt_label
Tensor np random uniform 0 0|1 0|size gt_num
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
load_param_into_net net|param_dict
parser parse_args args_opt
args_opt rank_id rank
args_opt device_num device_num
config mindrecord_dir mindrecord_dir
os path join mindrecord_dir|prefix| mindrecord_file
os path isdir mindrecord_dir
os makedirs mindrecord_dir
os path isdir config coco_root
os path exists config coco_root
ValueError config coco_root
data_to_mindrecord_byte_image True|prefix
print  format mindrecord_dir
os path isdir config image_dirandos path exists config anno_path
os path exists config image_dir
ValueError config image_dir
os path exists(mindrecord_file|)
time sleep
float config loss_scale loss_scale
dataset get_dataset_size dataset_size
Faster_Rcnn_Resnet50 config net
net set_train net
args_opt pre_trained load_path
load_checkpoint load_path param_dict
list item
item startswith
param_dict pop item
LossNet loss
Tensor dynamic_lr config|rank_size lr
WithLossCell net|loss net_with_loss
TrainOneStepCell net_with_loss|net|opt|sens net
TimeMonitor data_size time_cb
LossCallBack rank_id loss_cb
[time_cb|loss_cb] cb
os path join config save_checkpoint_path save_checkpoint_path
[ckpoint_cb] cb
Model net model
cb callbacks
load_param_into_net net set_train net
load_param_into_net param_dict pop item
parser parse_args args_opt rank_id rank
parser parse_args args_opt device_num device_num
parser parse_args args_opt pre_trained load_path
args_opt rank_id rank lr
Faster_Rcnn_Resnet50 config net set_train net
Faster_Rcnn_Resnet50 config net net
load_checkpoint load_path param_dict pop item
list item startswith
LossNet loss net
LossNet loss cb
WithLossCell net|loss net_with_loss net
TrainOneStepCell net_with_loss|net|opt|sens net net
TimeMonitor data_size time_cb cb
LossCallBack rank_id loss_cb cb
[time_cb|loss_cb] cb cb
[time_cb|loss_cb] cb callbacks
[ckpoint_cb] cb callbacks
load_param_into_net net|param_dict
parser parse_args args_opt
Faster_Rcnn_Resnet50 config net
load_checkpoint ckpt_path param_dict
net set_train False
ds get_dataset_size total
COCO ann_file dataset_coco
print total
eval_iter|1 eval_iter
data img_data
data img_metas
data gt_bboxes
data gt_labels
data gt_num
time time start
net img_data|img_metas|gt_bboxes|gt_labels|gt_num output
time time end
print  format eval_iter|end-start
output all_bbox
output all_label
output all_mask
range j
np squeeze all_bbox asnumpy all_bbox_squee
np squeeze all_label asnumpy all_label_squee
np squeeze all_mask asnumpy all_mask_squee
all_bbox_squee all_bboxes_tmp_mask
all_label_squee all_mask_squee all_labels_tmp_mask
np argsort -all_bboxes_tmp_mask inds
all_bboxes_tmp_mask inds all_bboxes_tmp_mask
all_labels_tmp_mask inds all_labels_tmp_mask
bbox2result_1image all_bboxes_tmp_mask|all_labels_tmp_mask|config num_classes outputs_tmp
outputs append outputs_tmp
results2json dataset_coco|outputs result_files
config mindrecord_dir mindrecord_dir
os path join mindrecord_dir|prefix mindrecord_file
os path exists mindrecord_file
os path isdir mindrecord_dir
os makedirs mindrecord_dir
os path isdir config coco_root
print  format mindrecord_dir
os path isdir config IMAGE_DIRandos path exists config ANNO_PATH
FasterRcnn_eval mindrecord_file|args_opt checkpoint_path|args_opt ann_file
load_param_into_net net set_train False
load_param_into_net net img_data|img_metas|gt_bboxes|gt_labels|gt_num output
Faster_Rcnn_Resnet50 config net set_train False
Faster_Rcnn_Resnet50 config net img_data|img_metas|gt_bboxes|gt_labels|gt_num output
eval_iter|1 eval_iter eval_iter
net img_data|img_metas|gt_bboxes|gt_labels|gt_num output all_bbox
net img_data|img_metas|gt_bboxes|gt_labels|gt_num output all_label
net img_data|img_metas|gt_bboxes|gt_labels|gt_num output all_mask
np squeeze all_bbox asnumpy all_bbox_squee all_bboxes_tmp_mask
np squeeze all_label asnumpy all_label_squee all_mask_squee all_labels_tmp_mask
all_bbox_squee all_bboxes_tmp_mask inds all_bboxes_tmp_mask
all_label_squee all_mask_squee all_labels_tmp_mask inds all_labels_tmp_mask
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step learning_rate
float current_step-warmup_steps|float(decay_steps) base
(1|math cos(base|math pi))|2|base_lr learning_rate
config base_lr base_lr
(config base_step||rank_size)|rank_size base_step
int base_step|config total_epoch total_steps
int config warmup_step warmup_steps
range i
lr append linear_warmup_learning_rate i|warmup_steps|base_lr|base_lr|config warmup_ratio
lr append a_cosine_learning_rate i|base_lr|warmup_steps|total_steps
lr append a_cosine_learning_rate lr append a_cosine_learning_rate i|base_lr|warmup_steps|total_steps
 config
[(192|320)|(96|160)|(48|80)|(24|40)|(12|20)
np array _init_value
json load open result_files anns
mmcv is_str coco
COCO coco coco
isinstance coco|COCO
result_types res_type
result_files res_type result_file
result_file endswith
coco loadRes result_file coco_dets
coco getImgIds gt_img_ids
coco_dets getImgIds det_img_ids
COCOeval coco|coco_dets|iou_type cocoEval
list max_dets cocoEval params maxDets
dict res_dict
tgt_ids id_i
[id_i] cocoEval params imgIds
cocoEval evaluate
cocoEval accumulate
cocoEval summarize
res_dict update({coco imgs id_i stats})
tgt_ids cocoEval params imgIds
bbox tolist _bbox
list ndarray
[np zeros (0|5)] result
dataset getImgIds img_ids
dataset get_dataset_size|2 dataset_len
range idx
img_ids idx img_id
results idx bboxes
range i
dict data
img_id data
xyxy2xywh bboxes i data
float bboxes i data
json_results append data
dataset getCatIds cat_ids
len img_ids dataset_len
results idx result
enumerate label|result_label
result_label bboxes
cat_ids label data
dataset img_ids idx img_id
results idx seg
enumerate label|det_label
det_label bboxes
dataset cat_ids label data
bbox_json_results append data
seg label segms
seg label mask_score
float mask_score i data
segms i data
segm_json_results append data
dict result_files
isinstance results|list
det2json dataset|results json_results
mmcv dump json_results|result_files
isinstance results|tuple
segm2json dataset|results json_results
isinstance results|np ndarray
proposal2json dataset|results json_results
mmcv is_str coco loadRes result_file coco_dets
mmcv is_str coco getImgIds gt_img_ids
COCO coco coco loadRes result_file coco_dets
COCO coco coco getImgIds gt_img_ids
isinstance coco loadRes result_file coco_dets
isinstance coco getImgIds gt_img_ids
result_files res_type result_file endswith
coco loadRes result_file coco_dets getImgIds det_img_ids
COCOeval coco|coco_dets|iou_type cocoEval evaluate
COCOeval coco|coco_dets|iou_type cocoEval accumulate
COCOeval coco|coco_dets|iou_type cocoEval summarize
dict res_dict update({coco imgs id_i stats})
dataset getImgIds img_ids idx img_id
img_ids idx img_id data
dataset getCatIds cat_ids label data
enumerate result_label bboxes
results idx seg label segms
results idx seg label mask_score
enumerate det_label bboxes
seg label segms i data
bboxes1 ndarray:shape n|4
bboxes2 ndarray:shape k|4
ious ndarray:shape n|k
bboxes1 astype np float32 bboxes1
bboxes2 astype np float32 bboxes2
bboxes1 shape rows
bboxes2 shape cols
np zeros (rows|cols) ious
bboxes2|bboxes1 bboxes2
np zeros (cols|rows) ious
(bboxes1|1) area1
(bboxes2|1) area2
range i
np maximum bboxes1 x_start
np maximum bboxes1 y_start
np minimum bboxes1 x_end
np minimum bboxes1 y_end
np maximum x_end-x_start|1|0|np maximum overlap
area1 i union
overlap|union ious
ious T ious
(0 5|1 5) contrast_range
(0 5|1 5) saturation_range
brightness_delta self brightness_delta
contrast_range self contrast_upper
saturation_range self saturation_upper
hue_delta self hue_delta
img astype img
random randint
delta img
random randint mode
mmcv bgr2hsv img img
mmcv hsv2bgr img img
img    |random permutation img
mean self mean
ratio_range self max_ratio
img shape c
random uniform self min_ratio|self max_ratio ratio
int random uniform 0|w|ratio-w left
int random uniform 0|h|ratio-h top
img expand_img
expand_img img
np tile (left|top) boxes
scale_factor|scale_factor2 scale_factor
np append img_shape|scale_factor img_shape
np asarray img_shape|dtype img_shape
gt_bboxes|scale_factor gt_bboxes
img img_data
mmcv imresize h_scale
np array scale_factor
(config img_height|config img_width|1 0) img_shape
np append img_shape|(h_scale|w_scale) img_shape
mmcv impad img|(config img_height|config img_width) img_data
img_data astype np float32 img_data
mmcv imnormalize img|[123 675|116 28|103 53]|[58 395|57 12|57 375]|True img_data
mmcv imflip img_data img_data
gt_bboxes copy flipped
img_data shape _
img transpose 2|0|1 copy img_data
img_data astype np float16 img_data
img_shape astype np float16 img_shape
gt_bboxes astype np float16 gt_bboxes
gt_label astype np int32 gt_label
gt_num astype np bool gt_num
PhotoMetricDistortion random_photo
random_photo img|gt_bboxes|gt_label gt_label
Expand expand
expand img|gt_bboxes|gt_label gt_label
image_bgr|image_shape|gt_box_new|gt_label_new|gt_iscrowd_new_revert input_data
rescale_column |input_data input_data
resize_column_test |input_data input_data
imnormalize_column |input_data input_data
transpose_column |input_data output_data
image copy image_bgr
image_bgr shape image_shape
box gt_box
box gt_label
box gt_iscrowd
() gt_iscrowd_new_revert
_infer_data image_bgr|image_shape|gt_box_new|gt_label_new|gt_iscrowd_new_revert
(np random rand) flip
(np random rand) expand
expand_column |input_data input_data
resize_column |input_data input_data
flip_column |input_data input_data
_data_aug image|box|is_training
config coco_root coco_root
config val_data_type data_type
config train_data_type data_type
config coco_classes train_cls
enumerate i|cls
i train_cls_dict cls
os path join coco_root|config instance_set format data_type anno_json
COCO anno_json coco
coco loadCats coco getCatIds cat_ids
cat_ids cat
coco getImgIds image_ids
image_ids img_id
coco loadImgs img_id image_info
image_info file_name
coco loadAnns anno_ids anno
os path join coco_root|data_type|file_name image_path
anno label
label bbox
classs_dict label class_name
bbox|bbox|bbox x2
bbox|bbox|bbox y2
annos append
image_files append image_path
np array annos image_anno_dict image_path
np array [0|0|0|0|0|1] image_anno_dict image_path
annos_str anno_str
list map int|anno_str strip split anno
annos append anno
os path isdir image_dir
os path isfile anno_path
open anno_path|
f readlines lines
lines line
line decode strip line_str
str line_str split line_split
line_split file_name
os path join image_dir|file_name image_path
os path isfile image_path
anno_parser line_split image_anno_dict image_path
config mindrecord_dir mindrecord_dir
os path join mindrecord_dir|prefix mindrecord_path
FileWriter mindrecord_path|file_num writer
create_coco_label is_training image_anno_dict
filter_valid_data config IMAGE_DIR|config ANNO_PATH image_anno_dict
writer add_schema fasterrcnn_json|
image_files image_name
open image_name|
f read img
np array image_anno_dict[image_name]|dtype annos
{} row
writer write_raw_data [row]
writer commit
cv2 setNumThreads
de config set_prefetch_size
C Decode decode
ds map input_columns ds
compose_map_func operations
np zeros (rows|cols) ious T ious
bboxes2|bboxes1 bboxes2 bboxes2
bboxes2|bboxes1 bboxes2 area2
np zeros (cols|rows) ious T ious
(bboxes1|1) area1 i union
range i input_data
range i train_cls_dict cls
np maximum x_end-x_start|1|0|np maximum overlap ious
area1 i union ious
overlap|union ious T ious
(0 5|1 5) contrast_range self contrast_upper
(0 5|1 5) saturation_range self saturation_upper
delta img    |random permutation img
delta img shape c
delta img expand_img
delta img img_data
delta img transpose 2|0|1 copy img_data
mmcv bgr2hsv img img    |random permutation img
mmcv bgr2hsv img img shape c
mmcv bgr2hsv img img expand_img
mmcv bgr2hsv img img img_data
mmcv bgr2hsv img img transpose 2|0|1 copy img_data
mmcv hsv2bgr img img    |random permutation img
mmcv hsv2bgr img img shape c
mmcv hsv2bgr img img expand_img
mmcv hsv2bgr img img img_data
mmcv hsv2bgr img img transpose 2|0|1 copy img_data
img expand_img img
expand_img img img_data
expand_img img transpose 2|0|1 copy img_data
np tile (left|top) boxes gt_bboxes
scale_factor|scale_factor2 scale_factor scale_factor
scale_factor|scale_factor2 scale_factor gt_bboxes
np append img_shape|scale_factor img_shape astype np float16 img_shape
np asarray img_shape|dtype img_shape astype np float16 img_shape
gt_bboxes|scale_factor gt_bboxes gt_bboxes
gt_bboxes|scale_factor gt_bboxes copy flipped
gt_bboxes|scale_factor gt_bboxes astype np float16 gt_bboxes
img img_data astype np float32 img_data
img img_data shape _
img img_data astype np float16 img_data
(config img_height|config img_width|1 0) img_shape astype np float16 img_shape
np append img_shape|(h_scale|w_scale) img_shape astype np float16 img_shape
mmcv impad img|(config img_height|config img_width) img_data astype np float32 img_data
mmcv impad img|(config img_height|config img_width) img_data shape _
mmcv impad img|(config img_height|config img_width) img_data astype np float16 img_data
mmcv imnormalize img|[123 675|116 28|103 53]|[58 395|57 12|57 375]|True img_data shape _
mmcv imnormalize img|[123 675|116 28|103 53]|[58 395|57 12|57 375]|True img_data astype np float16 img_data
mmcv imflip img_data img_data shape _
mmcv imflip img_data img_data astype np float16 img_data
img transpose 2|0|1 copy img_data astype np float16 img_data
PhotoMetricDistortion random_photo img|gt_bboxes|gt_label gt_label
random_photo img|gt_bboxes|gt_label gt_label input_data
Expand expand img|gt_bboxes|gt_label gt_label
expand img|gt_bboxes|gt_label gt_label input_data
image copy image_bgr shape image_shape
_infer_data i train_cls_dict cls
_data_aug i train_cls_dict cls
enumerate i train_cls_dict cls
COCO anno_json coco loadCats coco getCatIds cat_ids
COCO anno_json coco getImgIds image_ids
COCO anno_json coco loadImgs img_id image_info
COCO anno_json coco loadAnns anno_ids anno
coco loadCats coco getCatIds cat_ids cat
coco getImgIds image_ids img_id
coco loadImgs img_id image_info file_name
coco loadAnns anno_ids anno label
anno label bbox
label bbox x2
label bbox y2
f readlines lines line
lines line decode strip line_str
str line_str split line_split file_name
FileWriter mindrecord_path|file_num writer add_schema fasterrcnn_json|
FileWriter mindrecord_path|file_num writer write_raw_data [row]
FileWriter mindrecord_path|file_num writer commit
super LossCallBack|self __init__
isinstance per_print_times|int
per_print_times self _per_print_times
rank_id self rank_id
time time time_stamp_first
run_context original_args cb_params
cb_params net_outputs asnumpy rpn_loss
cb_params net_outputs asnumpy rcnn_loss
cb_params net_outputs asnumpy rpn_cls_loss
cb_params net_outputs asnumpy rpn_reg_loss
cb_params net_outputs asnumpy rcnn_cls_loss
cb_params net_outputs asnumpy rcnn_reg_loss
float rpn_loss self rpn_loss_sum
float rcnn_loss self rcnn_loss_sum
float rpn_cls_loss self rpn_cls_loss_sum
float rpn_reg_loss self rpn_reg_loss_sum
float rcnn_cls_loss self rcnn_cls_loss_sum
float rcnn_reg_loss self rcnn_reg_loss_sum
(cb_params cur_step_num-1)%cb_params batch_num|1 cur_step_in_epoch
time time time_stamp_current
self rpn_loss_sum|self count rpn_loss
self rcnn_loss_sum|self count rcnn_loss
self rpn_cls_loss_sum|self count rpn_cls_loss
self rpn_reg_loss_sum|self count rpn_reg_loss
self rcnn_cls_loss_sum|self count rcnn_cls_loss
self rcnn_reg_loss_sum|self count rcnn_reg_loss
rpn_loss|rcnn_loss total_loss
open loss_file
loss_file write
loss_file close
backbone self _backbone
loss_fn self _loss_fn
self _backbone x|img_shape|gt_bboxe|gt_label|gt_num loss6
self _loss_fn loss1|loss2|loss3|loss4|loss5|loss6
network self network
self network set_grad
network_backbone self backbone
ParameterTuple network trainable_params self weights
optimizer self optimizer
Tensor (np ones (1|)|sens) astype(np float16) self sens
reduce_flag self reduce_flag
DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
self weights weights
self backbone x|img_shape|gt_bboxe|gt_label|gt_num loss6
self grad self network|weights(x|img_shape|gt_bboxe|gt_label|gt_num|self sens) grads
self grad_reducer grads grads
F depend loss1|self optimizer grads
isinstance per_print_times self _per_print_times
run_context original_args cb_params net_outputs asnumpy rpn_loss
run_context original_args cb_params net_outputs asnumpy rcnn_loss
run_context original_args cb_params net_outputs asnumpy rpn_cls_loss
run_context original_args cb_params net_outputs asnumpy rpn_reg_loss
run_context original_args cb_params net_outputs asnumpy rcnn_cls_loss
run_context original_args cb_params net_outputs asnumpy rcnn_reg_loss
cb_params net_outputs asnumpy rpn_loss total_loss
cb_params net_outputs asnumpy rcnn_loss total_loss
self rpn_loss_sum|self count rpn_loss total_loss
self rcnn_loss_sum|self count rcnn_loss total_loss
open loss_file write
open loss_file close
super DenseNoTranpose|self __init__
Parameter initializer weight_init|[input_channels|output_channels]|mstype float16 self weight
Parameter initializer [output_channels]|mstype float16 to_tensor self bias
P BiasAdd self bias_add
self bias_add self matmul x|self weight output
(0 |0 |0 |0 ) target_means
(0 1|0 1|0 2|0 2) target_stds
super Rcnn|self __init__
config cfg
Tensor np array cfg rcnn_loss_cls_weight astype np float16 self rcnn_loss_cls_weight
Tensor np array cfg rcnn_loss_reg_weight astype np float16 self rcnn_loss_reg_weight
cfg rcnn_fc_out_channels self rcnn_fc_out_channels
target_means self target_means
target_stds self target_stds
num_classes self num_classes
cfg rcnn_in_channels self in_channels
batch_size self train_batch_size
cfg test_batch_size self test_batch_size
(self rcnn_fc_out_channels|representation_size) shape_0
initializer shape weights_0
(self rcnn_fc_out_channels|self rcnn_fc_out_channels) shape_1
initializer shape weights_1
DenseNoTranpose representation_size|self rcnn_fc_out_channels|weights_0 self shared_fc_0
DenseNoTranpose self rcnn_fc_out_channels|self rcnn_fc_out_channels|weights_1 self shared_fc_1
DenseNoTranpose self rcnn_fc_out_channels|num_classes|cls_weight self cls_scores
DenseNoTranpose self rcnn_fc_out_channels|num_classes|4|reg_weight self reg_scores
P Flatten self flatten
P ReLU self relu
P LogicalAnd self logicaland
P SoftmaxCrossEntropyWithLogits self loss_cls
P Reshape self reshape
P OneHot self onehot
P Greater self greater
P Cast self cast
P ReduceSum self sum_loss
P Tile self tile
P ExpandDims self expandims
P GatherNd self gather
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
Tensor 1 0|mstype float16 self value
(cfg num_expected_pos_stage2|cfg num_expected_neg_stage2)|batch_size self num_bboxes
np ones (self num_bboxes|self num_classes) rmv_first
np zeros (self num_bboxes|) rmv_first
Tensor rmv_first astype np float16 self rmv_first_tensor
cfg rpn_max_num|cfg test_batch_size self num_bboxes_test
np arange self num_bboxes_test astype np int32 range_max
Tensor range_max self range_max
self flatten featuremap x
self relu self shared_fc_0 x x
self relu self shared_fc_1 x x
self cls_scores x x_cls
self reg_scores x x_reg
self cast self logicaland self greater labels|0 bbox_weights
self cast self onehot labels|self num_classes|self on_value|self off_value labels
self tile self expandims bbox_targets|1 bbox_targets
self loss x_cls|x_reg|bbox_targets|bbox_weights|labels|mask loss_print
(loss|loss_cls|loss_reg|loss_print) out
(x_cls|(x_cls|self value)) out
self loss_cls cls_score|labels _
self cast weights|mstype float16 weights
loss_cls|weights loss_cls
self sum_loss loss_cls|(0|)|self sum_loss weights|(0|) loss_cls
bbox_weights|self rmv_first_tensor bbox_weights
self reshape bbox_pred|(self num_bboxes|-1|4) pos_bbox_pred
self loss_bbox pos_bbox_pred|bbox_targets loss_reg
self sum_loss loss_reg|(2|) loss_reg
loss_reg|bbox_weights loss_reg
loss_reg|self sum_loss weights|(0|) loss_reg
self sum_loss loss_reg|(0|1) loss_reg
self rcnn_loss_cls_weight|loss_cls|self rcnn_loss_reg_weight|loss_reg loss
(loss_cls|loss_reg) loss_print
Parameter initializer weight_init|[input_channels|output_channels]|mstype float16 self weight loss_cls
(0 |0 |0 |0 ) target_means self target_means
(0 1|0 1|0 2|0 2) target_stds self target_stds
config cfg rcnn_fc_out_channels self rcnn_fc_out_channels
config cfg rcnn_in_channels self in_channels
config cfg test_batch_size self test_batch_size
config cfg rpn_max_num|cfg test_batch_size self num_bboxes_test
P SoftmaxCrossEntropyWithLogits self loss_cls out
P SoftmaxCrossEntropyWithLogits self loss_cls loss_cls
P SoftmaxCrossEntropyWithLogits self loss_cls loss_print
self cls_scores x x_cls value)) out
self cast self logicaland self greater labels|0 bbox_weights rmv_first_tensor bbox_weights
self cast self logicaland self greater labels|0 bbox_weights loss_reg
self loss x_cls|x_reg|bbox_targets|bbox_weights|labels|mask loss_print out
self cast weights|mstype float16 weights loss_cls
self cast weights|mstype float16 weights rmv_first_tensor bbox_weights
loss_cls|weights loss_cls loss_cls
loss_cls|weights loss_cls loss_print
self sum_loss loss_cls|(0|)|self sum_loss weights|(0|) loss_cls loss_print
bbox_weights|self rmv_first_tensor bbox_weights rmv_first_tensor bbox_weights
bbox_weights|self rmv_first_tensor bbox_weights loss_reg
self loss_bbox pos_bbox_pred|bbox_targets loss_reg loss_reg
self loss_bbox pos_bbox_pred|bbox_targets loss_reg sum_loss weights|(0|) loss_reg
self loss_bbox pos_bbox_pred|bbox_targets loss_reg loss_print
self sum_loss loss_reg|(2|) loss_reg loss_reg
self sum_loss loss_reg|(2|) loss_reg sum_loss weights|(0|) loss_reg
self sum_loss loss_reg|(2|) loss_reg loss_print
loss_reg|bbox_weights loss_reg loss_reg
loss_reg|bbox_weights loss_reg sum_loss weights|(0|) loss_reg
loss_reg|bbox_weights loss_reg loss_print
loss_reg|self sum_loss weights|(0|) loss_reg sum_loss weights|(0|) loss_reg
loss_reg|self sum_loss weights|(0|) loss_reg loss_print
self sum_loss loss_reg|(0|1) loss_reg loss_print
self rcnn_loss_cls_weight|loss_cls|self rcnn_loss_reg_weight|loss_reg loss loss_print
super RpnRegClsBlock|self __init__
nn ReLU self relu
self relu self rpn_conv x x
self rpn_cls x x1
self rpn_reg x x2
super RPN|self __init__
config cfg_rpn
cfg_rpn num_bboxes self num_bboxes
(0|) self slice_index
cfg_rpn feature_shapes shape
 self slice_index index self slice_index
(shape|shape|num_anchors|batch_size|) self feature_anchor_shape
num_anchors self num_anchors
batch_size self batch_size
cfg_rpn test_batch_size self test_batch_size
Tensor np ones (1|1) astype(np float16) self real_ratio
P Transpose self transpose
P Reshape self reshape
P Fill self fill
Tensor np ones (1|) astype(np float16) self placeh1
(0|2|3|1) self trans_shape
(-1|4) self reshape_shape_reg
(-1|) self reshape_shape_cls
Tensor np array cfg_rpn rpn_loss_reg_weight astype np float16 self rpn_loss_reg_weight
Tensor np array cfg_rpn rpn_loss_cls_weight astype np float16 self rpn_loss_cls_weight
Tensor np array cfg_rpn num_expected_neg|self batch_size astype(np float16) self num_expected_total
BboxAssignSample cfg_rpn|self batch_size|self num_bboxes|False self get_targets
P CheckValid self CheckValid
P ReduceSum self sum_loss
P SigmoidCrossEntropyWithLogits self loss_cls
P Squeeze self squeeze
P Cast self cast
P Tile self tile
P ZerosLike self zeros_like
Tensor np zeros (1|) astype(np float16) self loss
Tensor np zeros (1|) astype(np float16) self clsloss
Tensor np zeros (1|) astype(np float16) self regloss
(feat_channels|in_channels|3|3) shp_weight_conv
(feat_channels|) shp_bias_conv
initializer shape weight_conv
initializer 0|shape bias_conv
(num_anchors|cls_out_channels|feat_channels|1|1) shp_weight_cls
(num_anchors|cls_out_channels|) shp_bias_cls
initializer shape weight_cls
initializer 0|shape bias_cls
(num_anchors|4|feat_channels|1|1) shp_weight_reg
(num_anchors|4|) shp_bias_reg
initializer shape weight_reg
initializer 0|shape bias_reg
range i
rpn_layer rpn_conv weight rpn_layer i
rpn_layer rpn_cls weight rpn_layer i
rpn_layer rpn_reg weight rpn_layer i
rpn_layer rpn_conv bias rpn_layer i
rpn_layer rpn_cls bias rpn_layer i
rpn_layer rpn_reg bias rpn_layer i
self rpn_convs_list i inputs i x2
rpn_cls_score_total|(x1|) rpn_cls_score_total
rpn_bbox_pred_total|(x2|) rpn_bbox_pred_total
self transpose x1|self trans_shape x1
self reshape x1|self reshape_shape_cls x1
self transpose x2|self trans_shape x2
self reshape x2|self reshape_shape_reg x2
rpn_cls_score|(x1|) rpn_cls_score
rpn_bbox_pred|(x2|) rpn_bbox_pred
self loss loss
self clsloss clsloss
self regloss regloss
range j
multi_level_flags|(res|) multi_level_flags
anchor_list_tuple|(anchor_list[j]|) anchor_list_tuple
self concat multi_level_flags valid_flag_list
self concat anchor_list_tuple anchor_using_list
self squeeze gt_bboxes gt_bboxes_i
self squeeze gt_labels gt_labels_i
self squeeze gt_valids gt_valids_i
self cast bbox_weight|mstype float16 bbox_weight
self cast label|mstype float16 label
self cast label_weight|mstype float16 label_weight
self slice_index j begin
self slice_index end
(bbox_target|) bbox_targets
(bbox_weight|) bbox_weights
(label|) labels
(label_weight|) label_weights
(bbox_targets|) bbox_target_using
(bbox_weights|) bbox_weight_using
(labels|) label_using
(label_weights|) label_weight_using
self concat bbox_target_using bbox_target_with_batchsize
self concat bbox_weight_using bbox_weight_with_batchsize
self concat label_using label_with_batchsize
self concat label_weight_using label_weight_with_batchsize
F stop_gradient bbox_target_with_batchsize bbox_target_
F stop_gradient bbox_weight_with_batchsize bbox_weight_
F stop_gradient label_with_batchsize label_
F stop_gradient label_weight_with_batchsize label_weight_
rpn_cls_score i cls_score_i
rpn_bbox_pred i reg_score_i
self loss_cls cls_score_i|label_ loss_cls
loss_cls|label_weight_ loss_cls_item
self sum_loss loss_cls_item|(0|)|self num_expected_total loss_cls_item
self loss_bbox reg_score_i|bbox_target_ loss_reg
self tile self reshape bbox_weight_| self feature_anchor_shape i bbox_weight_
loss_reg|bbox_weight_ loss_reg
self sum_loss loss_reg|(1|) loss_reg_item
self sum_loss loss_reg_item|(0|)|self num_expected_total loss_reg_item
self rpn_loss_cls_weight|loss_cls_item|self rpn_loss_reg_weight|loss_reg_item loss_total
loss_total loss
(loss_total|loss_cls_item|loss_reg_item) loss_print
loss_cls_item clsloss
loss_reg_item regloss
(loss|rpn_cls_score_total|rpn_bbox_pred_total|clsloss|regloss|loss_print) output
(self placeh1|rpn_cls_score_total|rpn_bbox_pred_total|self placeh1|self placeh1|self placeh1) output
self rpn_cls x x1 rpn_cls_score_total
self rpn_cls x x1 rpn_cls_score
self rpn_reg x x2 rpn_bbox_pred_total
self rpn_reg x x2 rpn_bbox_pred
config cfg_rpn num_bboxes self num_bboxes
config cfg_rpn feature_shapes shape
config cfg_rpn test_batch_size self test_batch_size
cfg_rpn feature_shapes shape self feature_anchor_shape
cfg_rpn feature_shapes shape bias_conv
cfg_rpn feature_shapes shape bias_cls
cfg_rpn feature_shapes shape bias_reg
P SigmoidCrossEntropyWithLogits self loss_cls loss_cls_item
P SigmoidCrossEntropyWithLogits self loss_cls loss_print
Tensor np zeros (1|) astype(np float16) self loss loss_print
Tensor np zeros (1|) astype(np float16) self loss output
Tensor np zeros (1|) astype(np float16) self clsloss output
Tensor np zeros (1|) astype(np float16) self regloss output
self rpn_convs_list i inputs i x2 rpn_bbox_pred_total
self rpn_convs_list i inputs i x2 rpn_bbox_pred
rpn_cls_score_total|(x1|) rpn_cls_score_total rpn_cls_score_total
rpn_cls_score_total|(x1|) rpn_cls_score_total output
rpn_bbox_pred_total|(x2|) rpn_bbox_pred_total rpn_bbox_pred_total
rpn_bbox_pred_total|(x2|) rpn_bbox_pred_total output
self transpose x1|self trans_shape x1 rpn_cls_score
self reshape x1|self reshape_shape_cls x1 rpn_cls_score
self transpose x2|self trans_shape x2 rpn_bbox_pred
self reshape x2|self reshape_shape_reg x2 rpn_bbox_pred
rpn_cls_score|(x1|) rpn_cls_score rpn_cls_score
rpn_cls_score|(x1|) rpn_cls_score i cls_score_i
rpn_cls_score|(x1|) rpn_cls_score output
rpn_bbox_pred|(x2|) rpn_bbox_pred rpn_bbox_pred
rpn_bbox_pred|(x2|) rpn_bbox_pred i reg_score_i
rpn_bbox_pred|(x2|) rpn_bbox_pred output
self loss loss loss_print
self loss loss output
self clsloss clsloss output
self regloss regloss output
multi_level_flags|(res|) multi_level_flags multi_level_flags
anchor_list_tuple|(anchor_list[j]|) anchor_list_tuple anchor_list_tuple
self cast bbox_weight|mstype float16 bbox_weight bbox_weights
self cast bbox_weight|mstype float16 bbox_weight loss_reg
self cast label|mstype float16 label labels
self cast label|mstype float16 label loss_cls_item
self cast label_weight|mstype float16 label_weight label_weights
self cast label_weight|mstype float16 label_weight loss_cls_item
(bbox_target|) bbox_targets bbox_target_using
(bbox_weight|) bbox_weights bbox_weight_using
(label|) labels label_using
(label_weight|) label_weights label_weight_using
F stop_gradient bbox_weight_with_batchsize bbox_weight_ loss_reg
F stop_gradient label_with_batchsize label_ loss_cls_item
F stop_gradient label_weight_with_batchsize label_weight_ loss_cls_item
self loss_cls cls_score_i|label_ loss_cls loss_cls_item
self loss_cls cls_score_i|label_ loss_cls loss_print
loss_cls|label_weight_ loss_cls_item loss_print
loss_cls|label_weight_ loss_cls_item clsloss
self sum_loss loss_cls_item|(0|)|self num_expected_total loss_cls_item loss_print
self sum_loss loss_cls_item|(0|)|self num_expected_total loss_cls_item clsloss
self loss_bbox reg_score_i|bbox_target_ loss_reg loss_reg
self loss_bbox reg_score_i|bbox_target_ loss_reg loss_print
self tile self reshape bbox_weight_| self feature_anchor_shape i bbox_weight_ loss_reg
loss_reg|bbox_weight_ loss_reg loss_reg
loss_reg|bbox_weight_ loss_reg loss_print
self sum_loss loss_reg|(1|) loss_reg_item loss_print
self sum_loss loss_reg|(1|) loss_reg_item regloss
self sum_loss loss_reg_item|(0|)|self num_expected_total loss_reg_item loss_print
self sum_loss loss_reg_item|(0|)|self num_expected_total loss_reg_item regloss
self rpn_loss_cls_weight|loss_cls_item|self rpn_loss_reg_weight|loss_reg_item loss_total loss
self rpn_loss_cls_weight|loss_cls_item|self rpn_loss_reg_weight|loss_reg_item loss_total loss_print
loss_total loss loss_print
loss_total loss output
(loss_total|loss_cls_item|loss_reg_item) loss_print output
loss_cls_item clsloss output
loss_reg_item regloss output
super ROIAlign|self __init__
(out_size_h|out_size_w) self out_size
float spatial_scale self spatial_scale
int sample_num self sample_num
self align_op features|rois
self __class__ __name__ format_str
super SingleRoIExtractor|self __init__
config cfg
batch_size self train_batch_size
out_channels self out_channels
featmap_strides self featmap_strides
len self featmap_strides self num_levels
roi_layer self out_size
roi_layer self sample_num
self build_roi_layers self featmap_strides self roi_layers
L CellList self roi_layers self roi_layers
P Sqrt self sqrt
P Log self log
finest_scale self finest_scale_
C clip_by_value self clamp
P Cast self cast
P Equal self equal
P Select self select
training self training_local
self train_batch_size|self batch_size self batch_size
Tensor np array np ones (self batch_size|1) self ones
np array np ones (self batch_size|1) finest_scale
Tensor finest_scale self finest_scale
Tensor np array np ones (self batch_size|1) self epslion
Tensor np array np zeros (self batch_size|1) self zeros
Tensor np array np ones (self batch_size|1) self max_levels
Tensor np array np ones (self batch_size|1) self twos
len self featmap_strides
self log value|self log self twos
featmap_strides s
roi_layers append layer_cls
self sqrt rois|self ones| scale
self sqrt rois|self ones
self log2 scale|self finest_scale|self epslion target_lvls
P Floor target_lvls target_lvls
self cast target_lvls|mstype int32 target_lvls
self clamp target_lvls|self zeros|self max_levels target_lvls
(feat1|feat2|feat3|feat4) feats
self res_ res
self _c_map_roi_levels rois target_lvls
range i
self equal target_lvls|P ScalarToArray i mask
P Reshape mask|(-1|1|1|1) mask
self roi_layers i feats i roi_feats_t
self select mask|roi_feats_t|res res
(out_size_h|out_size_w) self out_size self out_size
self build_roi_layers self featmap_strides self roi_layers append layer_cls
L CellList self roi_layers self roi_layers append layer_cls
len self featmap_strides s
BboxAssignSampleForRcnn config|2|1024|True
super BboxAssignSampleForRcnn|self __init__
config cfg
batch_size self batch_size
cfg neg_iou_thr_stage2 self neg_iou_thr
cfg pos_iou_thr_stage2 self pos_iou_thr
cfg min_pos_iou_stage2 self min_pos_iou
cfg num_gts self num_gts
num_bboxes self num_bboxes
cfg num_expected_pos_stage2 self num_expected_pos
cfg num_expected_neg_stage2 self num_expected_neg
cfg num_expected_total_stage2 self num_expected_total
add_gt_as_proposals self add_gt_as_proposals
Tensor np arange 1|self num_gts|1 astype(np int32) self label_inds
P ReduceSum self sum_inds
P IOU self iou
P GreaterEqual self greaterequal
P Greater self greater
P Select self select
P GatherNd self gatherND
P Squeeze self squeeze
P Cast self cast
P LogicalAnd self logicaland
P Less self less
P RandomChoiceWithMask self num_expected_pos self random_choice_with_mask_pos
P RandomChoiceWithMask self num_expected_neg self random_choice_with_mask_neg
P Reshape self reshape
P Equal self equal
P BoundingBoxEncode means self bounding_box_encode
P LogicalNot self logicalnot
P Tile self tile
Tensor np array -1|np ones((self num_gts|4)) self check_gt_one
Tensor np array -2|np ones((self num_bboxes|4)) self check_anchor_two
Tensor np array -1|np ones num_bboxes self assigned_gt_inds
Tensor np array np zeros num_bboxes self assigned_gt_zeros
Tensor np array np ones num_bboxes self assigned_gt_ones
Tensor np array -1|np ones num_bboxes self assigned_gt_ignores
Tensor np array np ones self num_expected_pos self assigned_pos_ones
Tensor np array -1|np ones(self num_gts) self gt_ignores
Tensor np arange self num_expected_pos astype np float16 self range_pos_size
Tensor np array np ones self num_expected_neg-self num_expected_pos self check_neg_mask
Tensor np zeros (self num_expected_neg|4) self bboxs_neg_mask
Tensor np array np zeros self num_expected_neg self labels_neg_mask
(self num_expected_pos|1) self reshape_shape_pos
(self num_expected_neg|1) self reshape_shape_neg
Tensor 0 0|dtype self scalar_zero
Tensor self neg_iou_thr|dtype self scalar_neg_iou_thr
Tensor self pos_iou_thr|dtype self scalar_pos_iou_thr
Tensor self min_pos_iou|dtype self scalar_min_pos_iou
self iou bboxes|gt_bboxes_i overlaps
self max_gt overlaps max_overlaps_w_gt
self max_anchor overlaps max_overlaps_w_ac
self select neg_sample_iou_mask|self assigned_gt_zeros|self assigned_gt_inds assigned_gt_inds2
self greaterequal max_overlaps_w_gt|self scalar_pos_iou_thr pos_sample_iou_mask
range j
max_overlaps_w_ac max_overlaps_w_ac_j
overlaps overlaps_w_ac_j
self greaterequal max_overlaps_w_ac_j|self scalar_min_pos_iou temp1
self squeeze self equal overlaps_w_ac_j|max_overlaps_w_ac_j temp2
self logicaland temp1|temp2 pos_mask_j
self select pos_mask_j|(j|1)|self assigned_gt_ones|assigned_gt_inds3 assigned_gt_inds3
self select valid_mask|assigned_gt_inds3|self assigned_gt_ignores assigned_gt_inds5
self concat (gt_bboxes_i|bboxes) bboxes
self select gt_valids|self label_inds|self gt_ignores label_inds_valid
label_inds_valid|self add_gt_as_proposals_valid label_inds_valid
self concat (label_inds_valid|assigned_gt_inds5) assigned_gt_inds5
self random_choice_with_mask_pos self greater assigned_gt_inds5|0 valid_pos_index
self cast self greater assigned_gt_inds5|0 pos_check_valid
self sum_inds pos_check_valid|-1 pos_check_valid
self less self range_pos_size|pos_check_valid valid_pos_index
pos_index|self reshape(self cast(valid_pos_index|mstype int32)) pos_index
self sum_inds self cast self logicalnot valid_pos_index num_pos
self cast valid_pos_index|mstype int32 valid_pos_index
self reshape pos_index|self reshape_shape_pos pos_index
self reshape valid_pos_index|self reshape_shape_pos valid_pos_index
pos_index|valid_pos_index pos_index
self gatherND assigned_gt_inds5|pos_index-self assigned_pos_ones pos_assigned_gt_index
self reshape pos_assigned_gt_index|self reshape_shape_pos pos_assigned_gt_index
pos_assigned_gt_index|valid_pos_index pos_assigned_gt_index
self gatherND gt_labels_i|pos_assigned_gt_index pos_gt_labels
self random_choice_with_mask_neg self equal assigned_gt_inds5|0 valid_neg_index
self less self range_pos_size|num_pos unvalid_pos_index
self logicaland self concat (self check_neg_mask|unvalid_pos_index) valid_neg_index
self reshape neg_index|self reshape_shape_neg neg_index
self cast valid_neg_index|mstype int32 valid_neg_index
self reshape valid_neg_index|self reshape_shape_neg valid_neg_index
neg_index|valid_neg_index neg_index
self gatherND bboxes|pos_index pos_bboxes_
self gatherND bboxes|neg_index neg_bboxes_
self gatherND gt_bboxes_i|pos_assigned_gt_index pos_gt_bboxes_
self bounding_box_encode pos_bboxes_|pos_gt_bboxes_ pos_bbox_targets_
self concat (pos_bboxes_|neg_bboxes_) total_bboxes
self concat (pos_bbox_targets_|self bboxs_neg_mask) total_deltas
self concat (pos_gt_labels|self labels_neg_mask) total_labels
self concat (valid_pos_index|valid_neg_index) total_mask
BboxAssignSampleForRcnn config cfg
config cfg neg_iou_thr_stage2 self neg_iou_thr
config cfg pos_iou_thr_stage2 self pos_iou_thr
config cfg min_pos_iou_stage2 self min_pos_iou
config cfg num_gts self num_gts
config cfg num_expected_pos_stage2 self num_expected_pos
config cfg num_expected_neg_stage2 self num_expected_neg
config cfg num_expected_total_stage2 self num_expected_total
self iou bboxes|gt_bboxes_i overlaps overlaps_w_ac_j
self max_anchor overlaps max_overlaps_w_ac max_overlaps_w_ac_j
self select gt_valids|self label_inds|self gt_ignores label_inds_valid add_gt_as_proposals_valid label_inds_valid
label_inds_valid|self add_gt_as_proposals_valid label_inds_valid add_gt_as_proposals_valid label_inds_valid
self random_choice_with_mask_pos self greater assigned_gt_inds5|0 valid_pos_index pos_index
self random_choice_with_mask_pos self greater assigned_gt_inds5|0 valid_pos_index pos_assigned_gt_index
self less self range_pos_size|pos_check_valid valid_pos_index pos_index
self less self range_pos_size|pos_check_valid valid_pos_index pos_assigned_gt_index
pos_index|self reshape(self cast(valid_pos_index|mstype int32)) pos_index reshape(self cast(valid_pos_index|mstype int32)) pos_index
pos_index|self reshape(self cast(valid_pos_index|mstype int32)) pos_index pos_index
self cast valid_pos_index|mstype int32 valid_pos_index pos_index
self cast valid_pos_index|mstype int32 valid_pos_index pos_assigned_gt_index
self reshape pos_index|self reshape_shape_pos pos_index pos_index
self reshape valid_pos_index|self reshape_shape_pos valid_pos_index pos_index
self reshape valid_pos_index|self reshape_shape_pos valid_pos_index pos_assigned_gt_index
pos_index|valid_pos_index pos_index pos_index
self gatherND assigned_gt_inds5|pos_index-self assigned_pos_ones pos_assigned_gt_index pos_assigned_gt_index
self reshape pos_assigned_gt_index|self reshape_shape_pos pos_assigned_gt_index pos_assigned_gt_index
pos_assigned_gt_index|valid_pos_index pos_assigned_gt_index pos_assigned_gt_index
self random_choice_with_mask_neg self equal assigned_gt_inds5|0 valid_neg_index neg_index
self logicaland self concat (self check_neg_mask|unvalid_pos_index) valid_neg_index neg_index
self reshape neg_index|self reshape_shape_neg neg_index neg_index
self cast valid_neg_index|mstype int32 valid_neg_index neg_index
self reshape valid_neg_index|self reshape_shape_neg valid_neg_index neg_index
neg_index|valid_neg_index neg_index neg_index
resnet50 backbone
Faster_Rcnn_Resnet50 net
super Faster_Rcnn_Resnet50|self __init__
config batch_size self train_batch_size
config num_classes self num_classes
config anchor_scales self anchor_scales
config anchor_ratios self anchor_ratios
config anchor_strides self anchor_strides
tuple config rcnn_target_means self target_means
tuple config rcnn_target_stds self target_stds
list self anchor_base_sizes
self anchor_base_sizes anchor_base
len self anchor_ratios|len(self anchor_scales) self num_anchors
config feature_shapes featmap_sizes
self get_anchors featmap_sizes self anchor_list
Tensor np ones (self train_batch_size|config num_gts) astype(np uint8) self gt_labels_stage1
self proposal_generator set_train_local config|True
self proposal_generator_test set_train_local config|False
self roi_align set_train_local config|True
self roi_align_test set_train_local config|False
P Squeeze self squeeze
P Cast self cast
P Reshape self reshape
P Select self select
P Greater self greater
P Transpose self transpose
config test_batch_size self test_batch_size
P Tile self tile
P GatherNd self gather
config rpn_max_num self rpn_max_num
Tensor np zeros (self rpn_max_num|3) astype(np float16) self zeros_for_nms
np ones (self rpn_max_num|1) astype(np bool) self ones_mask
np zeros (self rpn_max_num|1) astype(np bool) self zeros_mask
Tensor np ones (self rpn_max_num|1) astype(np float16)|config test_score_thr self test_score_thresh
Tensor np ones (self rpn_max_num|1) astype(np float16)|0 self test_score_zeros
Tensor np ones (self rpn_max_num|4) astype(np float16)|-1 self test_box_zeros
Tensor np ones (self rpn_max_num|1) astype(np float16)|config test_iou_thr self test_iou_thr
config test_max_per_img self test_max_per_img
P NMSWithMask config test_iou_thr self nms_test
P LogicalAnd self logicand
P OnesLike self oneslike
self test_batch_size|self rpn_max_num self test_num_proposal
min self num_classes-2|55 self concat_start
(self num_classes-1) self concat_end
Tensor np concatenate roi_align_index self roi_align_index_tensor
Tensor np concatenate roi_align_index_test self roi_align_index_test_tensor
self backbone img_data x
self fpn_ncek x x
self proposal_generator cls_score|bbox_pred|self anchor_list proposal_mask
self proposal_generator_test cls_score|bbox_pred|self anchor_list proposal_mask
self cast gt_labels|mstype int32 gt_labels
self cast gt_valids|mstype int32 gt_valids
range i
self squeeze gt_bboxes gt_bboxes_i
self squeeze gt_labels gt_labels_i
self cast gt_labels_i|mstype uint8 gt_labels_i
self squeeze gt_valids gt_valids_i
self cast gt_valids_i|mstype bool_ gt_valids_i
(bboxes|) bboxes_tuple
(deltas|) deltas_tuple
(labels|) labels_tuple
(mask|) mask_tuple
self concat deltas_tuple bbox_targets
self concat labels_tuple rcnn_labels
F stop_gradient bbox_targets bbox_targets
F stop_gradient rcnn_labels rcnn_labels
self cast rcnn_labels|mstype int32 rcnn_labels
proposal_mask mask_tuple
proposal_mask bbox_targets
proposal_mask rcnn_labels
proposal p_i
(p_i|) bboxes_tuple
self concat bboxes_tuple bboxes_all
bboxes_tuple bboxes_all
self concat_1 (self roi_align_index_tensor|bboxes_all) rois
self concat_1 (self roi_align_index_test_tensor|bboxes_all) rois
self cast rois|mstype float32 rois
F stop_gradient rois rois
self cast x|mstype float32
self cast roi_feats|mstype float16 roi_feats
self concat mask_tuple rcnn_masks
F stop_gradient rcnn_masks rcnn_masks
self squeeze self cast rcnn_masks|mstype bool_ rcnn_mask_squeeze
(rpn_loss|rcnn_loss|rpn_cls_loss|rpn_reg_loss|rcnn_cls_loss|rcnn_reg_loss) output
self get_det_bboxes rcnn_cls_loss|rcnn_reg_loss|rcnn_masks|bboxes_all|img_metas output
self softmax cls_logits scores
i|4 k
self squeeze reg_logits reg_logits_i
self decode rois|reg_logits_i out_boxes_i
(out_boxes_i|) boxes_all
self split img_metas img_metas_all
self split scores scores_all
self split self cast mask_logits|mstype int32 mask_all
self split_shape self squeeze img_metas_all i scale
scale scale_h
scale scale_w
range j
self split boxes_all j boxes_tmp
boxes_tmp i out_boxes_h
boxes_tmp i out_boxes_w
(self select(self bbox_mask|out_boxes_w|out_boxes_h)) boxes_tuple
(boxes_tuple|) boxes_all_with_batchsize
self multiclass_nms boxes_all_with_batchsize|scores_all|mask_all output
boxes_all i bboxes
scores_all i scores
self cast mask_all i masks
range self num_classes j
j|1 k
scores _cls_scores
self squeeze bboxes k _bboxes
self reshape masks|(self rpn_max_num|1) _mask_o
self greater _cls_scores|self test_score_thresh cls_mask
self logicand _mask_o|cls_mask _mask
self cast self tile self cast _mask|mstype int32 _reg_mask
self select _reg_mask|_bboxes|self test_box_zeros _bboxes
self select _mask|_cls_scores|self test_score_zeros _cls_scores
self squeeze _cls_scores __cls_scores
self test_topk __cls_scores|self rpn_max_num topk_inds
self reshape topk_inds|(self rpn_max_num|1) topk_inds
self reshape scores_sorted|(self rpn_max_num|1) scores_sorted
self gather _bboxes|topk_inds _bboxes_sorted
self gather _mask|topk_inds _mask_sorted
self tile scores_sorted|(1|4) scores_sorted
self concat_1 (_bboxes_sorted|scores_sorted) cls_dets
P Slice cls_dets|(0|0) cls_dets
self nms_test cls_dets _mask_nms
self reshape _index|(self rpn_max_num|1) _index
self reshape _mask_nms|(self rpn_max_num|1) _mask_nms
self gather _mask_sorted|_index _mask_n
self logicand _mask_n|_mask_nms _mask_n
self oneslike _index|j cls_labels
(cls_dets|) res_boxes_tuple
(cls_labels|) res_labels_tuple
(_mask_n|) res_masks_tuple
self concat res_boxes_tuple res_boxes_start
self concat res_labels_tuple res_labels_start
self concat res_masks_tuple res_masks_start
self concat res_boxes_tuple res_boxes_end
self concat res_labels_tuple res_labels_end
self concat res_masks_tuple res_masks_end
self concat (res_boxes_start|res_boxes_end) res_boxes
self concat (res_labels_start|res_labels_end) res_labels
self concat (res_masks_start|res_masks_end) res_masks
(self num_classes-1)|self rpn_max_num reshape_size
self reshape res_boxes|(1|reshape_size|5) res_boxes
self reshape res_labels|(1|reshape_size|1) res_labels
self reshape res_masks|(1|reshape_size|1) res_masks
(res_boxes|) all_bboxes
(res_labels|) all_labels
(res_masks|) all_masks
self concat all_bboxes all_bboxes
self concat all_labels all_labels
self concat all_masks all_masks
len featmap_sizes num_levels
self anchor_generators i anchors
(Tensor(anchors astype(np float16))) multi_level_anchors
self proposal_generator set_train_local config test_batch_size self test_batch_size
self proposal_generator set_train_local config rpn_max_num self rpn_max_num
self proposal_generator set_train_local config test_max_per_img self test_max_per_img
self proposal_generator_test set_train_local config test_batch_size self test_batch_size
self proposal_generator_test set_train_local config rpn_max_num self rpn_max_num
self proposal_generator_test set_train_local config test_max_per_img self test_max_per_img
self proposal_generator_test set_train_local F stop_gradient bbox_targets bbox_targets
self proposal_generator_test set_train_local F stop_gradient rcnn_labels rcnn_labels
self proposal_generator_test set_train_local F stop_gradient rois rois
self proposal_generator_test set_train_local F stop_gradient rcnn_masks rcnn_masks
self roi_align set_train_local config test_batch_size self test_batch_size
self roi_align set_train_local config rpn_max_num self rpn_max_num
self roi_align set_train_local config test_max_per_img self test_max_per_img
self roi_align_test set_train_local config test_batch_size self test_batch_size
self roi_align_test set_train_local config rpn_max_num self rpn_max_num
self roi_align_test set_train_local config test_max_per_img self test_max_per_img
self roi_align_test set_train_local F stop_gradient bbox_targets bbox_targets
self roi_align_test set_train_local F stop_gradient rcnn_labels rcnn_labels
self roi_align_test set_train_local F stop_gradient rois rois
self roi_align_test set_train_local F stop_gradient rcnn_masks rcnn_masks
self proposal_generator cls_score|bbox_pred|self anchor_list proposal_mask mask_tuple
self proposal_generator cls_score|bbox_pred|self anchor_list proposal_mask bbox_targets
self proposal_generator cls_score|bbox_pred|self anchor_list proposal_mask rcnn_labels
self proposal_generator_test cls_score|bbox_pred|self anchor_list proposal_mask mask_tuple
self proposal_generator_test cls_score|bbox_pred|self anchor_list proposal_mask bbox_targets
self proposal_generator_test cls_score|bbox_pred|self anchor_list proposal_mask rcnn_labels
range i bboxes_tuple
range i k
range i boxes_all
(bboxes|) bboxes_tuple bboxes_all
proposal p_i bboxes_tuple
(p_i|) bboxes_tuple bboxes_all
self softmax cls_logits scores _cls_scores
self decode rois|reg_logits_i out_boxes_i boxes_all
(out_boxes_i|) boxes_all i bboxes
self split scores scores_all i scores
self split_shape self squeeze img_metas_all i scale scale_h
self split_shape self squeeze img_metas_all i scale scale_w
range j k
self split boxes_all j boxes_tmp i out_boxes_h
self split boxes_all j boxes_tmp i out_boxes_w
(self select(self bbox_mask|out_boxes_w|out_boxes_h)) boxes_tuple boxes_all_with_batchsize
scores_all i scores _cls_scores
self cast mask_all i masks all_masks
range self num_classes j k
self concat_1 (_bboxes_sorted|scores_sorted) cls_dets res_boxes_tuple
P Slice cls_dets|(0|0) cls_dets res_boxes_tuple
self gather _mask_sorted|_index _mask_n res_masks_tuple
self logicand _mask_n|_mask_nms _mask_n res_masks_tuple
self oneslike _index|j cls_labels res_labels_tuple
self concat (res_boxes_start|res_boxes_end) res_boxes all_bboxes
self concat (res_labels_start|res_labels_end) res_labels all_labels
self concat (res_masks_start|res_masks_end) res_masks all_masks
self reshape res_boxes|(1|reshape_size|5) res_boxes all_bboxes
self reshape res_labels|(1|reshape_size|1) res_labels all_labels
self reshape res_masks|(1|reshape_size|1) res_masks all_masks
tensor|(proposal|mask)
( 0| 0| 0| 0) target_means
(1 0|1 0|1 0|1 0) target_stds
super Proposal|self __init__
config cfg
batch_size self batch_size
num_classes self num_classes
target_means self target_means
target_stds self target_stds
use_sigmoid_cls self use_sigmoid_cls
num_classes-1 self cls_out_channels
P Sigmoid self activation
(-1|1) self reshape_shape
num_classes self cls_out_channels
(-1|2) self reshape_shape
cfg rpn_proposal_nms_pre self num_pre
cfg rpn_proposal_min_bbox_size self min_box_size
cfg rpn_proposal_nms_thr self nms_thr
cfg rpn_proposal_nms_post self nms_post
cfg rpn_proposal_nms_across_levels self nms_across_levels
cfg rpn_proposal_max_num self max_num
cfg fpn_num_outs self num_levels
P Squeeze self squeeze
P Reshape self reshape
P Cast self cast
cfg feature_shapes self feature_shapes
(1|2|0) self transpose_shape
self target_means| means
P NMSWithMask self nms_thr self nms
P Minimum self min
P GatherNd self gatherND
P Slice self slice
P Select self select
P Greater self greater
P Transpose self transpose
P Tile self tile
Tensor 10 0|mstype float16 self multi_10
training self training_local
cfg rpn_nms_pre self num_pre
cfg rpn_min_bbox_min_size self min_box_size
cfg rpn_nms_thr self nms_thr
cfg rpn_nms_post self nms_post
cfg rpn_nms_across_levels self nms_across_levels
cfg rpn_max_num self max_num
self feature_shapes shp
min self num_pre|(shp|shp|3) k_num
k_num total_max_topk_input
(k_num|) self topK_stage1
((k_num|1)) self topK_shape
(self max_num|1) self topK_shape_stage2
-65536 0 self min_float_num
Tensor self min_float_num|np ones(total_max_topk_input|np float16) self topK_mask
range img_id
range i
self squeeze rpn_cls_score_total rpn_cls_score_i
self squeeze rpn_bbox_pred_total rpn_bbox_pred_i
cls_score_list|(rpn_cls_score_i|) cls_score_list
bbox_pred_list|(rpn_bbox_pred_i|) bbox_pred_list
self get_bboxes_single cls_score_list|bbox_pred_list|anchor_list masks
(proposals|) proposals_tuple
(masks|) masks_tuple
range idx
self transpose cls_scores idx rpn_cls_score
self transpose bbox_preds idx rpn_bbox_pred
mlvl_anchors idx anchors
self reshape rpn_cls_score|self reshape_shape rpn_cls_score
self activation rpn_cls_score rpn_cls_score
self cast self squeeze rpn_cls_score rpn_cls_score_process
self cast self reshape rpn_bbox_pred|(-1|4) rpn_bbox_pred_process
self topKv2 rpn_cls_score_process|self topK_stage1 idx topk_inds
self reshape topk_inds|self topK_shape idx topk_inds
self gatherND rpn_bbox_pred_process|topk_inds bboxes_sorted
self cast self gatherND anchors|topk_inds anchors_sorted
self decode anchors_sorted|bboxes_sorted proposals_decode
self concat_axis1  proposals_decode|self reshape scores_sorted|self topK_shape idx proposals_decode
self nms proposals_decode mask_valid
mlvl_proposals|(proposals|) mlvl_proposals
mlvl_mask|(mask_valid|) mlvl_mask
self concat_axis0 mlvl_proposals proposals
self concat_axis0 mlvl_mask masks
self split proposals scores
self squeeze scores scores
self cast self topK_mask|mstype float16 topk_mask
self select masks|scores|topk_mask scores_using
self topKv2 scores_using|self max_num topk_inds
self reshape topk_inds|self topK_shape_stage2 topk_inds
self gatherND proposals|topk_inds proposals
self gatherND masks|topk_inds masks
( 0| 0| 0| 0) target_means self target_means
(1 0|1 0|1 0|1 0) target_stds self target_stds
config cfg rpn_proposal_nms_pre self num_pre
config cfg rpn_proposal_min_bbox_size self min_box_size
config cfg rpn_proposal_nms_thr self nms_thr
config cfg rpn_proposal_nms_post self nms_post
config cfg rpn_proposal_nms_across_levels self nms_across_levels
config cfg rpn_proposal_max_num self max_num
config cfg fpn_num_outs self num_levels
config cfg feature_shapes self feature_shapes
config cfg rpn_nms_pre self num_pre
config cfg rpn_min_bbox_min_size self min_box_size
config cfg rpn_nms_thr self nms_thr
config cfg rpn_nms_post self nms_post
config cfg rpn_nms_across_levels self nms_across_levels
config cfg rpn_max_num self max_num
P Minimum self min self num_pre|(shp|shp|3) k_num
min self num_pre|(shp|shp|3) k_num total_max_topk_input
min self num_pre|(shp|shp|3) k_num self topK_stage1
min self num_pre|(shp|shp|3) k_num self topK_shape
range i cls_score_list
range i bbox_pred_list
self squeeze rpn_cls_score_total rpn_cls_score_i cls_score_list
self squeeze rpn_bbox_pred_total rpn_bbox_pred_i bbox_pred_list
cls_score_list|(rpn_cls_score_i|) cls_score_list cls_score_list
bbox_pred_list|(rpn_bbox_pred_i|) bbox_pred_list bbox_pred_list
self get_bboxes_single cls_score_list|bbox_pred_list|anchor_list masks masks_tuple
self nms proposals_decode mask_valid mlvl_mask
mlvl_proposals|(proposals|) mlvl_proposals mlvl_proposals
mlvl_mask|(mask_valid|) mlvl_mask mlvl_mask
base_size self base_size
np array scales self scales
np array ratios self ratios
scale_major self scale_major
ctr self ctr
self gen_base_anchors self base_anchors
self base_size w
self base_size h
self ctr y_ctr
np sqrt self ratios h_ratios
(w|w_ratios) reshape ws
(h|h_ratios) reshape hs
(w|self scales) reshape ws
(h|self scales) reshape hs
np stack base_anchors
np repeat y|len(x) yy
self base_anchors base_anchors
featmap_size feat_w
np arange 0|feat_w|stride shift_x
np arange 0|feat_h|stride shift_y
self _meshgrid shift_x|shift_y shift_yy
np stack [shift_xx|shift_yy|shift_xx|shift_yy]|axis shifts
shifts astype base_anchors dtype shifts
base_anchors all_anchors
all_anchors reshape -1|4 all_anchors
self gen_base_anchors self base_anchors all_anchors
self base_size w reshape ws
self base_size w scales) reshape ws
self base_size h reshape hs
self base_size h scales) reshape hs
np sqrt self ratios h_ratios reshape hs
np stack base_anchors all_anchors
self base_anchors base_anchors all_anchors
np stack [shift_xx|shift_yy|shift_xx|shift_yy]|axis shifts astype base_anchors dtype shifts
base_anchors all_anchors reshape -1|4 all_anchors
Tensor np array np zeros shape astype np float32 astype np float16
(out_channels|in_channels|kernel_size|kernel_size) shape
initializer shape weights
(out_channels|) shape_bias
bias_init_zeros shape_bias biass
kernel_size|stride kernel_size
FeatPyramidNeck [100|200|300]|50|4 neck
neck input_data x
super FeatPyramidNeck|self __init__
num_outs self num_outs
in_channels self in_channels
len self in_channels self fpn_layer
len in_channels
enumerate _|channel
self lateral_convs_list_ append l_conv
self fpn_convs_ append fpn_conv
nn layer CellList self lateral_convs_list_ self lateral_convs_list
nn layer CellList self fpn_convs_ self fpn_convs_list
P ResizeNearestNeighbor (48|80) self interpolate1
P ResizeNearestNeighbor (96|160) self interpolate2
P ResizeNearestNeighbor (192|320) self interpolate3
range i
 self lateral_convs_list i inputs i x
(x|) y
y|(x|self interpolate1(y[self fpn_layer-4])) y
y|(x|self interpolate2(y[self fpn_layer-3])) y
y|(x|self interpolate3(y[self fpn_layer-2])) y
range self fpn_layer i
z|(y[i]|) z
outs| self fpn_convs_list i z i outs
range self num_outs i
outs|(self maxpool outs) outs
kernel_size|stride kernel_size kernel_size
FeatPyramidNeck [100|200|300]|50|4 neck input_data x
neck input_data x y
neck input_data x interpolate1(y[self fpn_layer-4])) y
neck input_data x interpolate2(y[self fpn_layer-3])) y
neck input_data x interpolate3(y[self fpn_layer-2])) y
 self lateral_convs_list i inputs i x y
(self lateral_convs_list i inputs i x interpolate1(y[self fpn_layer-4])) y
(self lateral_convs_list i inputs i x interpolate2(y[self fpn_layer-3])) y
(self lateral_convs_list i inputs i x interpolate3(y[self fpn_layer-2])) y
(x|) y interpolate1(y[self fpn_layer-4])) y
(x|) y interpolate2(y[self fpn_layer-3])) y
(x|) y interpolate3(y[self fpn_layer-2])) y
y|(x|self interpolate1(y[self fpn_layer-4])) y interpolate1(y[self fpn_layer-4])) y
y|(x|self interpolate1(y[self fpn_layer-4])) y interpolate2(y[self fpn_layer-3])) y
y|(x|self interpolate1(y[self fpn_layer-4])) y interpolate3(y[self fpn_layer-2])) y
y|(x|self interpolate2(y[self fpn_layer-3])) y interpolate2(y[self fpn_layer-3])) y
y|(x|self interpolate2(y[self fpn_layer-3])) y interpolate3(y[self fpn_layer-2])) y
y|(x|self interpolate3(y[self fpn_layer-2])) y interpolate3(y[self fpn_layer-2])) y
z|(y[i]|) z z
outs| self fpn_convs_list i z i outs fpn_convs_list i z i outs
outs|(self fpn_convs_list i z i outs maxpool outs) outs
outs|(self maxpool outs) outs maxpool outs) outs
BboxAssignSample config|2|1024|True
super BboxAssignSample|self __init__
config cfg
batch_size self batch_size
Tensor cfg neg_iou_thr|mstype float16 self neg_iou_thr
Tensor cfg pos_iou_thr|mstype float16 self pos_iou_thr
Tensor cfg min_pos_iou|mstype float16 self min_pos_iou
Tensor 0 0|mstype float16 self zero_thr
num_bboxes self num_bboxes
cfg num_gts self num_gts
cfg num_expected_pos self num_expected_pos
cfg num_expected_neg self num_expected_neg
add_gt_as_proposals self add_gt_as_proposals
Tensor np arange 1|self num_gts|1 self label_inds
P ReduceSum self sum_inds
P IOU self iou
P GreaterEqual self greaterequal
P Greater self greater
P Select self select
P GatherNd self gatherND
P Squeeze self squeeze
P Cast self cast
P LogicalAnd self logicaland
P Less self less
P RandomChoiceWithMask self num_expected_pos self random_choice_with_mask_pos
P RandomChoiceWithMask self num_expected_neg self random_choice_with_mask_neg
P Reshape self reshape
P Equal self equal
P BoundingBoxEncode means self bounding_box_encode
P ScatterNdUpdate self scatterNdUpdate
P ScatterNd self scatterNd
P LogicalNot self logicalnot
P Tile self tile
P ZerosLike self zeros_like
Tensor np array -1|np ones num_bboxes self assigned_gt_inds
Tensor np array np zeros num_bboxes self assigned_gt_zeros
Tensor np array np ones num_bboxes self assigned_gt_ones
Tensor np array -1|np ones num_bboxes self assigned_gt_ignores
Tensor np array np ones self num_expected_pos self assigned_pos_ones
Tensor np array np ones self num_expected_neg-self num_expected_pos self check_neg_mask
Tensor np arange self num_expected_pos astype np float16 self range_pos_size
Tensor np array -1|np ones((self num_gts|4)) self check_gt_one
Tensor np array -2|np ones((self num_bboxes|4)) self check_anchor_two
self iou bboxes|gt_bboxes_i overlaps
self max_gt overlaps max_overlaps_w_gt
self max_anchor overlaps max_overlaps_w_ac
self select neg_sample_iou_mask|self assigned_gt_zeros|self assigned_gt_inds assigned_gt_inds2
self greaterequal max_overlaps_w_gt|self pos_iou_thr pos_sample_iou_mask
assigned_gt_inds3 assigned_gt_inds4
range j
max_overlaps_w_ac max_overlaps_w_ac_j
self squeeze overlaps overlaps_w_gt_j
self select pos_mask_j|self assigned_gt_ones|j|assigned_gt_inds4 assigned_gt_inds4
self select valid_mask|assigned_gt_inds4|self assigned_gt_ignores assigned_gt_inds5
self random_choice_with_mask_pos self greater assigned_gt_inds5|0 valid_pos_index
self cast self greater assigned_gt_inds5|0 pos_check_valid
self sum_inds pos_check_valid|-1 pos_check_valid
self less self range_pos_size|pos_check_valid valid_pos_index
pos_index|self reshape(self cast(valid_pos_index|mstype int32)) pos_index
self gatherND assigned_gt_inds5|pos_index-self assigned_pos_ones pos_assigned_gt_index
pos_assigned_gt_index|self cast(valid_pos_index|mstype int32) pos_assigned_gt_index
self reshape pos_assigned_gt_index|(self num_expected_pos|1) pos_assigned_gt_index
self random_choice_with_mask_neg self equal assigned_gt_inds5|0 valid_neg_index
self cast self logicalnot valid_pos_index num_pos
self sum_inds num_pos|-1 num_pos
self less self range_pos_size|num_pos unvalid_pos_index
self logicaland self concat (self check_neg_mask|unvalid_pos_index) valid_neg_index
self gatherND bboxes|pos_index pos_bboxes_
self gatherND gt_bboxes_i|pos_assigned_gt_index pos_gt_bboxes_
self gatherND gt_labels_i|pos_assigned_gt_index pos_gt_labels
self bounding_box_encode pos_bboxes_|pos_gt_bboxes_ pos_bbox_targets_
self cast valid_pos_index|mstype int32 valid_pos_index
self cast valid_neg_index|mstype int32 valid_neg_index
self scatterNd pos_index|pos_bbox_targets_|(self num_bboxes|4) bbox_targets_total
self scatterNd pos_index|valid_pos_index|(self num_bboxes|) bbox_weights_total
self scatterNd pos_index|pos_gt_labels|(self num_bboxes|) labels_total
self concat (pos_index|neg_index) total_index
self concat (valid_pos_index|valid_neg_index) total_valid_index
self scatterNd total_index|total_valid_index|(self num_bboxes|) label_weights_total
self cast bbox_weights_total|mstype bool_
self cast label_weights_total|mstype bool_
BboxAssignSample config cfg
config cfg num_gts self num_gts
config cfg num_expected_pos self num_expected_pos
config cfg num_expected_neg self num_expected_neg
self max_anchor overlaps max_overlaps_w_ac max_overlaps_w_ac_j
pos_index|self reshape(self cast(valid_pos_index|mstype int32)) pos_index reshape(self cast(valid_pos_index|mstype int32)) pos_index
self gatherND assigned_gt_inds5|pos_index-self assigned_pos_ones pos_assigned_gt_index cast(valid_pos_index|mstype int32) pos_assigned_gt_index
pos_assigned_gt_index|self cast(valid_pos_index|mstype int32) pos_assigned_gt_index cast(valid_pos_index|mstype int32) pos_assigned_gt_index
Tensor np array np ones shape astype np float32|0 01 astype np float16
(out_channels|in_channels|kernel_size|kernel_size) shape
weight_init_ones shape weights
kernel_size|stride kernel_size
Tensor np array np ones out_chls astype np float16 gamma_init
Tensor np array np ones out_chls|0 astype(np float16) beta_init
Tensor np array np ones out_chls|0 astype(np float16) moving_mean_init
Tensor np array np ones out_chls astype np float16 moving_var_init
beta_init|moving_mean_init beta_init
super ResNetFea|self __init__
_BatchNorm2dInit 64|affine self bn1
P ReLU self relu
weights_update self weights_update
in_channels in_channel
out_channels out_channel
bn_training training
layers append resblk
range _
nn SequentialCell layers
self conv1 x x
self bn1 x x
self relu x x
self maxpool x c1
self layer1 c1 c2
c2 identity
F stop_gradient c2 identity
self layer2 identity c3
self layer3 c3 c4
self layer4 c4 c5
super ResidualBlockUsing|self __init__
weights_update self affine
out_channels||self expansion out_chls
_BatchNorm2dInit out_chls|momentum self bn1
_BatchNorm2dInit out_chls|momentum self bn2
_BatchNorm2dInit out_channels|momentum self bn3
self bn1 set_train self bn1
self bn2 set_train self bn2
self bn3 set_train self bn3
down_sample self downsample
self bn_down_sample set_train self bn_down_sample
P TensorAdd self add
x identity
self conv1 x out
self bn1 out out
self relu out out
self conv2 out out
self bn2 out out
self conv3 out out
self bn3 out out
self conv_down_sample identity identity
self bn_down_sample identity identity
self add out|identity out
kernel_size|stride kernel_size kernel_size
Tensor np array np ones out_chls|0 astype(np float16) beta_init beta_init
Tensor np array np ones out_chls|0 astype(np float16) moving_mean_init beta_init
beta_init|moving_mean_init beta_init beta_init
self conv1 x x identity
self bn1 x x identity
self relu x x identity
self layer1 c1 c2 identity
out_channels||self expansion out_chls self bn1
out_channels||self expansion out_chls self bn2
create_quant_config per_channel _quant_config
np random randn |shape astype(np float32)|factor init_value
Tensor init_value
(out_channel|in_channel|3|3) weight_shape
_weight_variable weight_shape weight
(out_channel|in_channel|1|1) weight_shape
(out_channel|in_channel|7|7) weight_shape
(out_channel|in_channel) weight_shape
super ConvBNReLU|self __init__
(kernel_size-1)||2 padding
[conv|nn ActQuant(nn ReLU)]if_fakeelse[conv|nn ReLU] layers
nn SequentialCell layers self features
self features x output
super ResidualBlock|self __init__
out_channel||self expansion channel
_quant_config quant_config
_fake fake
nn TensorAddQuant self add
P ReLU self relu
x identity
self conv1 x out
self conv2 out out
self conv3 out out
self down_sample_layer identity identity
self add out|identity out
self relu out out
super ResNet|self __init__
in_channels in_channel
out_channels out_channel
nn Flatten self flatten
_make_layer ResidualBlock|3|128|256|2
block in_channel|out_channel|stride resnet_block
layers append resnet_block
range _
nn SequentialCell layers
self conv1 x x
self maxpool x c1
self layer1 c1 c2
self layer2 c2 c3
self layer3 c3 c4
self layer4 c4 c5
self mean c5|(2|3) out
self flatten out out
self end_point out out
self output_fake out out
resnet50_quant net
resnet101 net
create_quant_config per_channel _quant_config quant_config
[conv|nn ActQuant(nn ReLU)]if_fakeelse[conv|nn ReLU] layers append resnet_block
out_channel||self expansion channel expansion channel
out_channel||self expansion channel resnet_block
self conv1 x out resnet_block
self conv2 out out resnet_block
self conv3 out out resnet_block
self add out|identity out resnet_block
self relu out out resnet_block
in_channels in_channel resnet_block
out_channels out_channel resnet_block
super ConvBNReLU|self __init__
(kernel_size-1)||2 padding
conv self features
self features x output
super ResidualBlock|self __init__
out_channel||self expansion channel
P TensorAdd self add
P ReLU self relu
x identity
self conv1 x out
self conv2 out out
self conv3 out out
self down_sample_layer identity identity
self add out|identity out
self relu out out
super ResNet|self __init__
in_channels in_channel
out_channels out_channel
nn Flatten self flatten
_make_layer ResidualBlock|3|128|256|2
block in_channel|out_channel|stride resnet_block
layers append resnet_block
range _
nn SequentialCell layers
self conv1 x x
self maxpool x c1
self layer1 c1 c2
self layer2 c2 c3
self layer3 c3 c4
self layer4 c4 c5
self mean c5|(2|3) out
self flatten out out
self end_point out out
resnet50_quant net
resnet101 net
out_channel||self expansion channel expansion channel
out_channel||self expansion channel resnet_block
self conv1 x out resnet_block
self conv2 out out resnet_block
self conv3 out out resnet_block
self add out|identity out resnet_block
self relu out out resnet_block
in_channels in_channel resnet_block
out_channels out_channel resnet_block
nn SequentialCell layers
parser parse_args args_opt
config_quant config
int os getenv device_id
int os getenv rank_id
int os getenv rank_size
rank_size run_distribute
print  format args_opt
print  format config
print  format rank_id|device_id|rank_size
config epoch_size epoch_size
ParallelMode DATA_PARALLEL parallel_mode
resnet50_quant class_num net
net set_train True
load_checkpoint args_opt pre_trained param_dict
load_nonquant_param_into_quant_net net|param_dict|
config epoch_size-config pretrained_epoch_size epoch_size
net cells_and_names _|cell
isinstance cell|nn Conv2d
isinstance cell|nn Dense
CrossEntropy smooth_factor loss
config batch_size batch_size
dataset get_dataset_size step_size
[True|False] per_channel
[True|False] symmetric
quantizer quantize net net
config lr_max lr_max
config warmup_epochs warmup_epochs
config epoch_size total_epochs
step_size steps_per_epoch
Tensor lr lr
Model net|loss_fn model
TimeMonitor data_size time_callback
LossMonitor loss_callback
[time_callback|loss_callback] callbacks
config save_checkpoint_path directory
[ckpt_callback] callbacks
config_quant config epoch_size epoch_size
config_quant config epoch_size-config pretrained_epoch_size epoch_size
config_quant config batch_size batch_size
config_quant config lr_max lr_max
config_quant config warmup_epochs warmup_epochs
config_quant config epoch_size total_epochs
config_quant config save_checkpoint_path directory
int os getenv rank_size run_distribute
print  format config epoch_size epoch_size
print  format config epoch_size-config pretrained_epoch_size epoch_size
print  format config batch_size batch_size
print  format config lr_max lr_max
print  format config warmup_epochs warmup_epochs
print  format config epoch_size total_epochs
print  format config save_checkpoint_path directory
resnet50_quant class_num net set_train True
resnet50_quant class_num net cells_and_names _|cell
resnet50_quant class_num net model
net set_train True per_channel
net set_train True symmetric
load_nonquant_param_into_quant_net net cells_and_names _|cell
CrossEntropy smooth_factor loss model
CrossEntropy smooth_factor loss callbacks
dataset get_dataset_size step_size steps_per_epoch
quantizer quantize net net model
TimeMonitor data_size time_callback callbacks
LossMonitor loss_callback callbacks
parser parse_args args_opt
config_quant config
int os getenv device_id
context set_context device_id device_id
resnet50_quant class_num network
[True|False] per_channel
quantizer quantize network network
config batch_size batch_size
dataset get_dataset_size step_size
load_checkpoint args_opt checkpoint_path param_dict
load_param_into_net network|param_dict not_load_param
isinstance cell|nn Dense
network set_train False
Model network|loss_fn model
model eval dataset res
config_quant config batch_size batch_size
resnet50_quant class_num network set_train False
resnet50_quant class_num network model
quantizer quantize network network set_train False
quantizer quantize network network model
Model network|loss_fn model eval dataset res
super CrossEntropy|self __init__
P OneHot self onehot
Tensor 1 0-smooth_factor|mstype float32 self on_value
Tensor 1 0|smooth_factor|(num_classes-1) self off_value
nn SoftmaxCrossEntropyWithLogits self ce
P ReduceMean False self mean
self onehot label|F shape logit one_hot_label
self ce logit|one_hot_label loss
self mean loss|0 loss
 config_quant
lr_init float
lr_max float
total_steps int
warmup_steps int
[0 3|total_steps|0 6|total_steps|0 8|total_steps] decay_epoch_index
range i
lr_init|(lr_max-lr_init)|i|warmup_steps lr
lr_max lr
lr_max|0 1 lr
lr_max|0 01 lr
lr_max|0 001 lr
lr_each_step append lr
lr_end float
(float(lr_max)-float(lr_init))|float(warmup_steps) inc_each_step
float lr_init|inc_each_step|float(i) lr
(1 0-(float(i)-float(warmup_steps))|(float(total_steps)-float(warmup_steps))) base
float lr_max|base|base lr
total_steps-warmup_steps decay_steps
(float(lr_max)-float(lr_init))|float(warmup_steps) lr_inc
float lr_init|lr_inc|(i|1) lr
(lr_max-lr_end)|cosine_decay|lr_end lr
lr_max-(lr_max-lr_end)|(i-warmup_steps)|(total_steps-warmup_steps) lr
warmup_epochs int
total_epochs int
steps_per_epoch int
lr_decay_mode string:learningratedecaymode|includingsteps|poly|cosineorliner default
steps_per_epoch|total_epochs total_steps
steps_per_epoch|warmup_epochs warmup_steps
_generate_steps_lr lr_init|lr_max|total_steps|warmup_steps lr_each_step
_generate_poly_lr lr_init|lr_end|lr_max|total_steps|warmup_steps lr_each_step
_generate_cosine_lr lr_init|lr_end|lr_max|total_steps|warmup_steps lr_each_step
_generate_liner_lr lr_init|lr_end|lr_max|total_steps|warmup_steps lr_each_step
np array lr_each_step astype np float32 lr_each_step
lr_init float inc_each_step
lr_init float lr_init|inc_each_step|float(i) lr
lr_init float lr_max|base|base lr
lr_init float lr_inc
lr_init float lr_init|lr_inc|(i|1) lr
lr_max float inc_each_step
lr_max float lr_init|inc_each_step|float(i) lr
lr_max float lr_max|base|base lr
lr_max float lr_inc
lr_max float lr_init|lr_inc|(i|1) lr
range i lr
lr_init|(lr_max-lr_init)|i|warmup_steps lr lr
lr_max lr lr
lr_max|0 1 lr lr
lr_max|0 01 lr lr
lr_max|0 001 lr lr
lr_each_step append lr lr
lr_end float inc_each_step
lr_end float lr_init|inc_each_step|float(i) lr
lr_end float lr_max|base|base lr
lr_end float lr_inc
lr_end float lr_init|lr_inc|(i|1) lr
float lr_init|inc_each_step|float(i) lr lr
float lr_max|base|base lr lr
float lr_init|lr_inc|(i|1) lr lr
(lr_max-lr_end)|cosine_decay|lr_end lr lr
config_quant config
dataset_path string
do_train bool
repeat_num int
batch_size int
target str
int os getenv device_num
int os getenv rank_id
get_rank rank_id
get_group_size device_num
partial de MindDataset|dataset_path|columns_list load_func
partial de ImageFolderDataset|dataset_path load_func
[0 485|255|0 456|255|0 406|255] mean
[0 229|255|0 224|255|0 225|255] std
(0 08|1 0) scale
mean mean|std std C Normalize
C HWC2CHW
C Decode
C Resize
C CenterCrop image_size
C2 TypeCast mstype int32 type_cast_op
ds repeat repeat_num ds
P Decode decode_op
P RandomResizedCrop image_size|scale resize_crop_op
P Resize resize_op
P CenterCrop image_size center_crop
P ToTensor to_tensor
P Normalize mean normalize_op
[decode_op|resize_crop_op|horizontal_flip_op|to_tensor|normalize_op] trans
[decode_op|resize_op|center_crop|to_tensor|normalize_op] trans
P2 Compose trans compose
repeat_num int os getenv device_num
repeat_num int os getenv rank_id
batch_size int os getenv device_num
batch_size int os getenv rank_id
[0 485|255|0 456|255|0 406|255] mean mean|std std C Normalize
P Decode decode_op trans
P Decode decode_op trans
P RandomResizedCrop image_size|scale resize_crop_op trans
P Resize resize_op trans
P CenterCrop image_size center_crop trans
P ToTensor to_tensor trans
P ToTensor to_tensor trans
P Normalize mean normalize_op trans
P Normalize mean normalize_op trans
target str
parser parse_known_args unknown
unknown args training_script_args
print __file__
parse_args args
print args
args visible_devices split visible_devices
os path isfile args training_script
print  format visible_devices
print  format args server_id
open readlines hccn_configs
hccn_configs hccn_item
hccn_item strip hccn_item
hccn_item startswith
hccn_item split device_ip
device_id split device_id
device_ip device_ips device_id
print  format device_id|device_ip
platform processor arch
{0x002}[arch] hccn_table
range instance_id
visible_devices instance_id device_id
device_ips device_id device_ip
str device_id usable_dev
str instance_id instance
args server_id instance
instance_list append instance
str args nproc_per_node
visible_devices instance_id eth_id
hccn_table append  format eth_id
str args nproc_per_node hccn_table
os getcwd table_path
os path exists table_path
os mkdir table_path
open table_fn|
sys stdout flush
os environ copy env
str args nproc_per_node env
os getcwd cur_path
range rank_id
os chdir cur_path
visible_devices rank_id device_id
os path join cur_path| format rank_id device_dir
str rank_id env
str device_id env
table_fn env
os path exists device_dir
shutil rmtree device_dir
os mkdir device_dir
os chdir device_dir
[sys executable|] cmd
cmd append args training_script
cmd extend args training_script_args
open log_file
subprocess Popen cmd|stdout process
processes append process
cmds append cmd
log_files append log_file
zip process|cmd|log_file
process wait
process returncode|cmd cmd subprocess CalledProcessError
log_file close
target str device_id usable_dev
target str instance_id instance
target str args nproc_per_node
target str args nproc_per_node hccn_table
target str args nproc_per_node env
target str rank_id env
target str device_id env
parser parse_known_args unknown args training_script_args
parse_args args visible_devices split visible_devices
parse_args args server_id instance
print args visible_devices split visible_devices
print args server_id instance
args visible_devices split visible_devices instance_id device_id
args visible_devices split visible_devices instance_id eth_id
args visible_devices split visible_devices rank_id device_id
print  format visible_devices instance_id device_id
print  format visible_devices instance_id eth_id
print  format visible_devices rank_id device_id
open readlines hccn_configs hccn_item
hccn_configs hccn_item strip hccn_item
hccn_configs hccn_item startswith
hccn_configs hccn_item split device_ip
hccn_item split device_ip device_ips device_id
{0x002}[arch] hccn_table append  format eth_id
open table_fn env
[sys executable|] cmd append args training_script
[sys executable|] cmd extend args training_script_args
open log_file close
subprocess Popen cmd|stdout process wait
subprocess Popen cmd|stdout process returncode|cmd cmd subprocess CalledProcessError
processes append process wait
processes append process returncode|cmd cmd subprocess CalledProcessError
log_files append log_file close
zip process wait
zip process returncode|cmd cmd subprocess CalledProcessError
zip log_file close
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
xception class_num net
load_checkpoint args ckpt_file param_dict
load_param_into_net net|param_dict
net set_train False
Tensor np zeros [config batch_size|3|args height|args width]|np float32 image
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
xception class_num net set_train False
load_param_into_net net set_train False
net set_train False
Tensor Monitor(lr_init |100) asnumpy
super Monitor|self __init__
lr_init self lr_init
len lr_init self lr_init_len
time time self epoch_time
run_context original_args cb_params
(time time-self epoch_time)|1000 epoch_mseconds
epoch_mseconds|cb_params batch_num per_step_mseconds
time time self step_time
(time time-self step_time)|1000 step_mseconds
cb_params net_outputs step_loss
isinstance step_loss| tuple|listandisinstance step_loss|Tensor
isinstance step_loss|Tensor
np mean step_loss asnumpy step_loss
self losses append step_loss
(cb_params cur_step_num-1)%cb_params batch_num cur_step_in_epoch
parser parse_args args_opt
os getenv isdigit
int context set_context(device_id os getenv)
get_rank rank
get_group_size group_size
ParallelMode DATA_PARALLEL parallel_mode
xception class_num net
net to_float mstype float16
CrossEntropySmooth smooth_factor loss
dataset get_dataset_size step_size
load_checkpoint args_opt resume ckpt
load_param_into_net net|ckpt
config lr_end lr_end
config lr_max lr_max
config warmup_epochs warmup_epochs
config epoch_size total_epochs
step_size steps_per_epoch
Momentum net trainable_params|lr|config momentum|config weight_decay|config loss_scale opt
[Monitor lr_init cb
os path join config save_checkpoint_path save_ckpt_path
ModelCheckpoint fdirectory ckpt_cb
[ckpt_cb] cb
run_context original_args cb_params batch_num per_step_mseconds
run_context original_args cb_params net_outputs step_loss
(time time-self epoch_time)|1000 epoch_mseconds batch_num per_step_mseconds
xception class_num net to_float mstype float16
dataset get_dataset_size step_size steps_per_epoch
load_param_into_net net|ckpt
parser parse_args args_opt
context set_context args_opt device_id device_id
dataset get_dataset_size step_size
xception class_num net
load_checkpoint args_opt checkpoint_path param_dict
load_param_into_net net|param_dict
net set_train False
CrossEntropySmooth smooth_factor loss
nn Top1CategoricalAccuracy
Model net|loss_fn model
load_param_into_net net set_train False
xception class_num net set_train False
xception class_num net model
load_param_into_net net set_train False
CrossEntropySmooth smooth_factor loss model
 config
lr_init float
lr_end float
lr_max float
warmup_epochs int
total_epochs int
steps_per_epoch int
lr_decay_mode string
steps_per_epoch|total_epochs total_steps
steps_per_epoch|warmup_epochs warmup_steps
[0 3|total_steps|0 6|total_steps|0 8|total_steps] decay_epoch_index
range i
lr_max lr
lr_max|0 1 lr
lr_max|0 01 lr
lr_max|0 001 lr
lr_each_step append lr
(float(lr_max)-float(lr_init))|float(warmup_steps) inc_each_step
float lr_init|inc_each_step|float(i) lr
(1 0-(float(i)-float(warmup_steps))|(float(total_steps)-float(warmup_steps))) base
float lr_max|base|base lr
total_steps-warmup_steps decay_steps
(float(lr_max)-float(lr_init))|float(warmup_steps) lr_inc
float lr_init|lr_inc|(i|1) lr
(total_steps-i)|decay_steps linear_decay
linear_decay|cosine_decay|0 00001 decayed
lr_max|decayed lr
lr_init|(lr_max-lr_init)|i|warmup_steps lr
lr_max-(lr_max-lr_end)|(i-warmup_steps)|(total_steps-warmup_steps) lr
np array lr_each_step astype np float32 lr_each_step
lr_init float inc_each_step
lr_init float lr_init|inc_each_step|float(i) lr
lr_init float lr_max|base|base lr
lr_init float lr_inc
lr_init float lr_init|lr_inc|(i|1) lr
lr_end float inc_each_step
lr_end float lr_init|inc_each_step|float(i) lr
lr_end float lr_max|base|base lr
lr_end float lr_inc
lr_end float lr_init|lr_inc|(i|1) lr
lr_max float inc_each_step
lr_max float lr_init|inc_each_step|float(i) lr
lr_max float lr_max|base|base lr
lr_max float lr_inc
lr_max float lr_init|lr_inc|(i|1) lr
steps_per_epoch|warmup_epochs warmup_steps lr
range i lr
total_steps-warmup_steps decay_steps linear_decay
(total_steps-i)|decay_steps linear_decay 00001 decayed
linear_decay|cosine_decay|0 00001 decayed lr
dataset_path string
do_train bool
batch_size int
C RandomCropDecodeResize
C Decode
C Resize
C CenterCrop
[127 5 mean|127 5|127 5]|[127 5 std|127 5|127 5] C Normalize
C HWC2CHW
C2 TypeCast mstype float32
C2 TypeCast mstype int32 type_cast_op
super CrossEntropySmooth|self __init__
P OneHot self onehot
sparse self sparse
Tensor 1 0-smooth_factor|mstype float32 self on_value
Tensor 1 0|smooth_factor|(num_classes-1) self off_value
nn SoftmaxCrossEntropyWithLogits reduction self ce
self onehot label|F shape logit label
self ce logit|label loss
super SeparableConv2d|self __init__
self conv1 x x
self pointwise x x
super Block|self __init__
nn ReLU self relu
in_filters filters
rep append nn ReLU
out_filters filters
range reps _
nn ReLU rep
nn SequentialCell |rep self rep
P TensorAdd self add
self rep inp x
self skip inp skip
self skipbn skip skip
inp skip
self add x|skip x
super Xception|self __init__
num_classes self num_classes
SeparableConv2d 1024|1536|3|1|1 self conv3
SeparableConv2d 1536|2048|3|1|1 self conv4
nn AvgPool2d self avg_pool
nn Dropout self dropout
nn Dense 2048|num_classes self fc
P Shape shape
P Reshape reshape
self bn1 x x
self relu x x
self conv2 x x
self bn2 x x
self block1 x x
self block2 x x
self block3 x x
self block4 x x
self block5 x x
self block6 x x
self block7 x x
self block8 x x
self block9 x x
self block10 x x
self block11 x x
self block12 x x
self conv3 x x
self bn3 x x
self conv4 x x
self bn4 x x
self avg_pool x x
self dropout x x
reshape x|(shape(x)) x
self fc x x
xception net
Xception class_num
P Reshape reshape x|(shape(x)) x
resnet50 args|kwargs
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
resnet class_num net
load_checkpoint args ckpt_file param_dict
list param_dict keys keys
keys key
param_dict pop key
load_param_into_net net|param_dict
np random uniform 0 0|1 0|size inputs
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
load_checkpoint args ckpt_file param_dict pop key
list param_dict keys keys key
parser parse_args args_opt
load_param_into_net net|param_dict
steps_per_epoch|total_epochs total_steps
range i
(i|1)|steps_per_epoch epoch
(1 0-float(epoch)|total_epochs)decay base
lr_init|base lr_local
lr_local|0 5 lr_local
lr_each_step append lr_local
global_step current_step
np array lr_each_step astype np float32 lr_each_step
lr_each_step learning_rate
range step
(step|1)|steps_per_epoch epoch
damping_init|(decay_rate(epoch|10)) damping_here
damping_each_step append damping_here
np array damping_each_step astype np float32 damping_each_step
damping_each_step damping_now
args_opt device_target target
config save_checkpoint_path ckpt_save_dir
int os getenv device_id
dataset get_dataset_size step_size
get_model_damping 0|config damping_init|config damping_decay|70|step_size damping
CrossEntropy smooth_factor loss
TimeMonitor data_size time_cb
LossMonitor loss_cb
[time_cb|loss_cb] cb
[ckpt_cb] cb
cb callbacks
parser parse_args args_opt device_target target
range i epoch
(i|1)|steps_per_epoch epoch damping_here
(1 0-float(epoch)|total_epochs)decay base lr_local
lr_init|base lr_local 5 lr_local
lr_local|0 5 lr_local 5 lr_local
np array lr_each_step astype np float32 lr_each_step learning_rate
range step epoch
(step|1)|steps_per_epoch epoch damping_here
np array damping_each_step astype np float32 damping_each_step damping_now
CrossEntropy smooth_factor loss cb
TimeMonitor data_size time_cb cb
LossMonitor loss_cb cb
[time_cb|loss_cb] cb cb
[time_cb|loss_cb] cb callbacks
[ckpt_cb] cb callbacks
parser parse_args args_opt
damping_each_step append damping_here
args_opt device_target target
int os getenv device_id
context set_context device_id device_id
resnet class_num net
load_checkpoint args_opt checkpoint_path param_dict
list param_dict keys keys
keys key
param_dict pop key
load_param_into_net net|param_dict
net set_train False
CrossEntropy smooth_factor loss
Model net|loss_fn model
model eval dataset res
parser parse_args args_opt device_target target
resnet class_num net set_train False
resnet class_num net model
load_checkpoint args_opt checkpoint_path param_dict pop key
list param_dict keys keys key
load_param_into_net net set_train False
CrossEntropy smooth_factor loss model
Model net|loss_fn model eval dataset res
super CrossEntropy|self __init__
P OneHot self onehot
Tensor 1 0-smooth_factor|mstype float32 self on_value
Tensor 1 0|smooth_factor|(num_classes-1) self off_value
nn SoftmaxCrossEntropyWithLogits self ce
P ReduceMean False self mean
self onehot label|F shape logit one_hot_label
self ce logit|one_hot_label loss
self mean loss|0 loss
 config
 config_gpu
types np_type
pytype_to_dtype np_type ms_type
ms_types append ms_type
_convert_type dataset output_types dataset_types
dataset output_shapes dataset_shapes
exec_dataset get_batch_size batch_size
exec_dataset input_indexs input_indexs
_get_types_and_shapes exec_dataset dataset_shapes
frequency self _frequency
self _build_train_network self _train_network
DatasetHelper dataset|dataset_sink_mode|sink_size|epoch_num|iter_first_order dataset_helper
connect_network_with_dataset network|dataset_helper network
network set_train is_train
phase network phase
network set_auto_parallel
epoch epoch_num
math ceil epoch|sink_size|train_dataset get_dataset_size epoch_num
self _frequency-1 iter_first_order
iter_second_order train_dataset __loop_size__
train_dataset dataset
train_network self _train_network
self _train_network cb_params train_network
RunContext cb_params run_context
list_callback begin run_context
range i
i|1 cb_params cur_epoch_num
list_callback epoch_begin run_context
dataset_helper inputs
_to_full_tensor inputs|self _device_number|self _global_rank inputs
list_callback step_begin run_context
self _train_network |inputs outputs
outputs cb_params net_outputs
list_callback step_end run_context
iter_first_order cb_params cur_step_num
list_callback epoch_end run_context
dataset_helper stop_send
list_callback end run_context
DatasetHelper dataset|dataset_sink_mode|sink_size|epoch_num|iter_first_order dataset_helper inputs
DatasetHelper dataset|dataset_sink_mode|sink_size|epoch_num|iter_first_order dataset_helper stop_send
connect_network_with_dataset network|dataset_helper network set_train is_train
connect_network_with_dataset network|dataset_helper network set_auto_parallel
self _frequency-1 iter_first_order cb_params cur_step_num
range i cb_params cur_epoch_num
self _train_network |inputs outputs cb_params net_outputs
C MultitypeFuncGraph _momentum_opt
P AddN op_add
C MultitypeFuncGraph apply_decay
apply_decay register
op_add (weight|weight_decay|gradient)
_momentum_opt register
F depend success|opt(weight|moment|learning_rate|gradient|momentum) success
super THOR_GPU|self __init__ learning_rate|params|weight_decay|loss_scale
Validator check_value_type momentum|[float]|self cls_name
isinstance momentum|float
ValueError  format momentum
Parameter Tensor momentum|mstype float32 self momentum
self parameters self params
Validator check_bool use_nesterov self use_nesterov
C HyperMap self hyper_map
P ApplyMomentum use_nesterov self opt
[x0 5forxinself feature_map] self feature_map_new
P Transpose self transpose
P Shape self shape
P Reshape self reshape
P MatMul self matmul
ParameterTuple matrix_A self matrix_A
ParameterTuple matrix_G self matrix_G
ParameterTuple A_inv_max self A_inv_max
ParameterTuple G_inv_max self G_inv_max
P Assign self assign
P Mul self mul
_get_gradients_mean mean
_get_device_num degree
len self feature_map parameter_length
DistributedGradReducerThor parameter_length|((parameter_length|)) self grad_reducer_thorA
DistributedGradReducerThor parameter_length|((parameter_length|)) self grad_reducer_thorG
weight_decay self weight_decay
self params params
self moments moments
self scale_grad gradients gradients
range i
gradients i|3 g
self matrix_A i matrix_A
self matrix_G i matrix_G
F depend matrix_A|g matrix_A
F depend matrix_G|g matrix_G
self mul matrix_A|self feature_map_new i matrix_A
self mul matrix_G|self feature_map_new i matrix_G
matrix_A_allreduce|(matrix_A|) matrix_A_allreduce
matrix_G_allreduce|(matrix_G|) matrix_G_allreduce
self grad_reducer_thorA matrix_A_allreduce matrix_A_allreduce
self grad_reducer_thorG matrix_G_allreduce matrix_G_allreduce
self shape g g_shape
self reshape g|(g_shape|-1) g
matrix_A_allreduce i matrix_A
matrix_G_allreduce i matrix_G
self update_gradient matrix_G|g|matrix_A g
self assign self matrix_A i fake_A
self assign self matrix_G i fake_G
F depend g|fake_A g
F depend g|fake_G g
new_grads|(g|) new_grads
self reshape g|g_shape g
new_grads|(g|gradients) new_grads
new_grads gradients
self get_lr lr
self hyper_map F partial _momentum_opt|self opt|self momentum|lr success
super THOR|self __init__ learning_rate|params|weight_decay|loss_scale
P ApplyMomentum self opt
P CusMatMulCubeFraczLeftCast self cube_matmul_left
P CusMatMulCubeDenseLeft self cube_matmul_left_fc
P CusMatMulCubeDenseRight self cube_matmul_right_fc
P CusMatMulCubeFraczRightMul self cube_matmul_right_mul
self weight_idx append i
self weight_idx append len self params
DistributedGradReducerThor parameter_length|((27|)) self grad_reducer_Amax
DistributedGradReducerThor parameter_length|((27|)) self grad_reducer_Gmax
DistributedGradReducerThor parameter_length|((27|)) self grad_reducer_A
DistributedGradReducerThor parameter_length|((27|)) self grad_reducer_G
self matrix_max_inv self matrix_max_inv
P Log self log
P Exp self exp
P Sqrt self sqrt
ParameterTuple self matrix_max_inv self matrix_max_inv
P Cast self cast
weight_decay|loss_scale self weight_decay
self A_inv_max i A_max
self G_inv_max i G_max
F depend A_max|g A_max
F depend G_max|g G_max
matrix_A_max_allreduce|(A_max|) matrix_A_max_allreduce
matrix_G_max_allreduce|(G_max|) matrix_G_max_allreduce
self grad_reducer_A matrix_A_allreduce matrix_A_allreduce
self grad_reducer_G matrix_G_allreduce matrix_G_allreduce
self grad_reducer_Amax matrix_A_max_allreduce matrix_A_max_allreduce
self grad_reducer_Gmax matrix_G_max_allreduce matrix_G_max_allreduce
matrix_A_allreduce i temp_a
matrix_G_allreduce i temp_g
self cast temp_a|mstype float32 temp_a
self cast temp_g|mstype float32 temp_g
self log matrix_A_max_allreduce i matrix_A_inv_max
self mul matrix_A_inv_max|-1 matrix_A_inv_max
self exp matrix_A_inv_max matrix_A_inv_max
self mul temp_a|matrix_A_inv_max temp_a
self log matrix_G_max_allreduce i matrix_G_inv_max
self mul matrix_G_inv_max|-1 matrix_G_inv_max
self exp matrix_G_inv_max matrix_G_inv_max
self mul temp_g|matrix_G_inv_max temp_g
self mul matrix_A_max_allreduce i]|matrix_G_max_allreduce[i temp_max
self mul temp_max|self feature_map i temp_max
self cast temp_a|mstype float16 temp_a
self cast temp_g|mstype float16 temp_g
self cube_matmul_left_fc temp_g|g g
self cube_matmul_right_fc g|temp_a|temp_max g
self cube_matmul_left temp_g|g g
self cube_matmul_right_mul g|temp_a|temp_max g
self assign self matrix_max_inv i fake_max
F depend g|fake_max g
self matrix_max_inv i matrix_max
F depend matrix_max|g matrix_max
self cube_matmul_left_fc matrix_G|g g
self cube_matmul_right_fc g|matrix_A|matrix_max g
self cube_matmul_left matrix_G|g g
self cube_matmul_right_mul g|matrix_A|matrix_max g
C MultitypeFuncGraph _momentum_opt register
P AddN op_add (weight|weight_decay|gradient)
C MultitypeFuncGraph apply_decay register
op_add weight_decay self weight_decay
super THOR_GPU|self __init__ weight_decay self weight_decay
super THOR_GPU|self __init__ weight_decay|loss_scale self weight_decay
ParameterTuple matrix_A self matrix_A matrix_A_allreduce
ParameterTuple matrix_G self matrix_G matrix_G_allreduce
self scale_grad gradients gradients i|3 g
self scale_grad gradients gradients new_grads
gradients i|3 g new_grads
gradients i|3 g new_grads
self matrix_A i matrix_A matrix_A_allreduce
self matrix_G i matrix_G matrix_G_allreduce
F depend matrix_A|g matrix_A matrix_A_allreduce
F depend matrix_G|g matrix_G matrix_G_allreduce
self mul matrix_A|self feature_map_new i matrix_A matrix_A_allreduce
self mul matrix_G|self feature_map_new i matrix_G matrix_G_allreduce
matrix_A_allreduce|(matrix_A|) matrix_A_allreduce matrix_A_allreduce
matrix_A_allreduce|(matrix_A|) matrix_A_allreduce i matrix_A
matrix_A_allreduce|(matrix_A|) matrix_A_allreduce i temp_a
matrix_G_allreduce|(matrix_G|) matrix_G_allreduce matrix_G_allreduce
matrix_G_allreduce|(matrix_G|) matrix_G_allreduce i matrix_G
matrix_G_allreduce|(matrix_G|) matrix_G_allreduce i temp_g
self grad_reducer_thorA matrix_A_allreduce matrix_A_allreduce i matrix_A
self grad_reducer_thorA matrix_A_allreduce matrix_A_allreduce i temp_a
self grad_reducer_thorG matrix_G_allreduce matrix_G_allreduce i matrix_G
self grad_reducer_thorG matrix_G_allreduce matrix_G_allreduce i temp_g
self reshape g|(g_shape|-1) g new_grads
self reshape g|(g_shape|-1) g new_grads
self update_gradient matrix_G|g|matrix_A g new_grads
self update_gradient matrix_G|g|matrix_A g new_grads
F depend g|fake_A g new_grads
F depend g|fake_A g new_grads
F depend g|fake_G g new_grads
F depend g|fake_G g new_grads
new_grads|(g|) new_grads new_grads
new_grads|(g|) new_grads new_grads
new_grads|(g|) new_grads gradients
self reshape g|g_shape g new_grads
new_grads|(g|gradients) new_grads new_grads
new_grads|(g|gradients) new_grads gradients
super THOR|self __init__ weight_decay|loss_scale self weight_decay
weight_decay|loss_scale self weight_decay self weight_decay
self A_inv_max i A_max matrix_A_max_allreduce
self G_inv_max i G_max matrix_G_max_allreduce
F depend A_max|g A_max matrix_A_max_allreduce
F depend G_max|g G_max matrix_G_max_allreduce
matrix_A_max_allreduce|(A_max|) matrix_A_max_allreduce matrix_A_max_allreduce
matrix_G_max_allreduce|(G_max|) matrix_G_max_allreduce matrix_G_max_allreduce
self grad_reducer_A matrix_A_allreduce matrix_A_allreduce i temp_a
self grad_reducer_G matrix_G_allreduce matrix_G_allreduce i temp_g
dataset_path string
do_train bool
repeat_num int
batch_size int
target str
_get_rank_info rank_id
get_rank rank_id
get_group_size device_num
[0 485|255|0 456|255|0 406|255] mean
[0 229|255|0 224|255|0 225|255] std
(0 08|1 0) scale
mean mean|std std C Normalize
C HWC2CHW
C Decode
C Resize
C CenterCrop image_size
C2 TypeCast mstype int32 type_cast_op
ds repeat repeat_num ds
int os environ get rank_size
get_group_size rank_size
repeat_num int os environ get rank_size
batch_size int os environ get rank_size
[0 485|255|0 456|255|0 406|255] mean mean|std std C Normalize
hasattr dataset|
dataset __transfer_dataset__ exec_dataset
exec_dataset send epoch_num
different loop
-1|sinkthecompletedatasetforeachepoch  sink_size
DatasetHelper dataset dataset_helper
dataset_helper inputs
network |inputs outputs
Validator check_bool dataset_sink_mode dataset_sink_mode
Validator check_is_int sink_size
ValueError  format sink_size
_DatasetIterMSLoopSink iterclass
iterclass dataset|sink_size|epoch_num|iter_first_order self iter
_DatasetIterMS iterclass
iterclass dataset|sink_size|epoch_num self iter
self iter __iter__
self iter types_shapes
self iter get_sink_size
self iter stop_send
dataset self dataset
sink_size self sink_size
dataset __loop_size__ self sink_size
_exec_datagraph dataset|self sink_size dataset __transfer_dataset__
_send_data dataset|epoch_num
_send_data_no_flag dataset|epoch_num
dataset __transfer_dataset__ stop_send self stop_send
_get_types_and_shapes dataset self dataset_shapes
self op
dataset __loop_size__ loop_size
math ceil dataset get_dataset_size|loop_size sink_count
hasattr self dataset|
self dataset __loop_size__ sink_size
self sink_size sink_size
self dataset get_dataset_size sink_size
super __init__ dataset|sink_size|epoch_num
dataset __loop_size__|iter_first_order loop_size
math ceil dataset get_dataset_size|loop_size|2 sink_count
sink_count self sink_count
os getenv ms_role
_get_device_num device_num
_to_full_shapes self dataset_shapes|device_num self dataset_shapes
op self op
sink_size self sink_count
dataset get_dataset_size self sink_count
dataset __transfer_dataset__ queue_name queue_name
GetNextSingleOp self dataset_types|self dataset_shapes|queue_name self op
hasattr dataset __transfer_dataset__ exec_dataset
hasattr dataset self dataset
hasattr dataset __loop_size__ self sink_size
hasattr dataset __transfer_dataset__ stop_send self stop_send
hasattr dataset __loop_size__ loop_size
hasattr dataset __loop_size__|iter_first_order loop_size
hasattr dataset get_dataset_size self sink_count
hasattr dataset __transfer_dataset__ queue_name queue_name
dataset __transfer_dataset__ exec_dataset send epoch_num
-1|sinkthecompletedatasetforeachepoch  sink_size self sink_size
-1|sinkthecompletedatasetforeachepoch  sink_size self sink_count
DatasetHelper dataset dataset_helper inputs
Validator check_is_int sink_size self sink_size
Validator check_is_int sink_size self sink_count
ValueError  format sink_size self sink_size
ValueError  format sink_size self sink_count
_DatasetIterMSLoopSink iterclass dataset|sink_size|epoch_num|iter_first_order self iter
_DatasetIterMSLoopSink iterclass dataset|sink_size|epoch_num self iter
_DatasetIterMS iterclass dataset|sink_size|epoch_num self iter
dataset __loop_size__ self sink_size self sink_count
_send_data dataset __transfer_dataset__ stop_send self stop_send
_send_data dataset __loop_size__ loop_size
_send_data dataset __loop_size__|iter_first_order loop_size
_send_data dataset get_dataset_size self sink_count
_send_data dataset __transfer_dataset__ queue_name queue_name
_send_data_no_flag dataset __transfer_dataset__ stop_send self stop_send
_send_data_no_flag dataset __loop_size__ loop_size
_send_data_no_flag dataset __loop_size__|iter_first_order loop_size
_send_data_no_flag dataset get_dataset_size self sink_count
_send_data_no_flag dataset __transfer_dataset__ queue_name queue_name
self op self op
math ceil dataset get_dataset_size|loop_size sink_count self sink_count
hasattr self dataset __loop_size__|iter_first_order loop_size
hasattr self dataset get_dataset_size self sink_count
hasattr self dataset __transfer_dataset__ queue_name queue_name
self dataset __loop_size__ sink_size self sink_count
self sink_size sink_size self sink_count
self dataset get_dataset_size sink_size self sink_count
super __init__ dataset __loop_size__|iter_first_order loop_size
super __init__ sink_size self sink_count
super __init__ dataset get_dataset_size self sink_count
super __init__ dataset __transfer_dataset__ queue_name queue_name
math ceil dataset get_dataset_size|loop_size|2 sink_count self sink_count
math sqrt res
isinstance param|boolandisinstance param|intorisinstance param|float
param negative_slope
ValueError  format param
math sqrt 2 0|(1|negative_slope2) res
ValueError  format nonlinearity
len tensor dimensions
tensor fan_in
tensor fan_out
tensor num_input_fmaps
tensor num_output_fmaps
tensor|tensor receptive_field_size
num_input_fmaps|receptive_field_size fan_in
num_output_fmaps|receptive_field_size fan_out
mode lower mode
ValueError  format mode|valid_modes
_calculate_fan_in_and_fan_out tensor fan_out
_calculate_correct_fan inputs_shape|mode fan
calculate_gain nonlinearity|a gain
gain|math sqrt fan std
inputs_shape) astype(np float32 size
math sqrt|std bound
np random randn |shape astype(np float32)|factor init_value
Tensor init_value
(out_channel|in_channel|3|3) weight_shape
(out_channel|in_channel|1|1) weight_shape
(out_channel|in_channel|7|7) weight_shape
(out_channel|in_channel) weight_shape
Tensor kaiming_uniform weight_shape|a weight
super ResidualBlock|self __init__
out_channel||self expansion channel
_bn channel self bn1
_bn channel self bn2
_bn_last out_channel self bn3
nn ReLU self relu
damping|loss_scale damping
P TensorAdd self add
x identity
self conv1 x out
self bn1 out out
self relu out out
self conv2 out out
self bn2 out out
self conv3 out out
self bn3 out out
self down_sample_layer identity identity
self add out|identity out
super ResNet|self __init__
_bn self bn1
P ReLU self relu
in_channels in_channel
out_channels out_channel
strides stride
strides|damping stride
include_top self include_top
nn Flatten self flatten
_make_layer ResidualBlock|3|128|256|2
layers append resnet_block
range _
nn SequentialCell layers
self conv1 x x
self bn1 x x
self relu x x
self maxpool x c1
self layer1 c1 c2
self layer2 c2 c3
self layer3 c3 c4
self layer4 c4 c5
self mean c5|(2|3) out
self flatten out out
self end_point out out
resnet50 net
isinstance param|boolandisinstance param|intorisinstance param negative_slope
tensor num_input_fmaps fan_in
tensor num_output_fmaps fan_out
tensor|tensor receptive_field_size fan_in
tensor|tensor receptive_field_size fan_out
calculate_gain nonlinearity|a gain sqrt fan std
(out_channel|in_channel|3|3) weight_shape weight
(out_channel|in_channel|1|1) weight_shape weight
(out_channel|in_channel|7|7) weight_shape weight
(out_channel|in_channel) weight_shape weight
out_channel||self expansion channel expansion channel
damping|loss_scale damping damping
damping|loss_scale damping stride
(matrix_dim|channel)|C0 matrix_dim
(int(matrix_dim||C0)) ll
split_dim split_dimA
split_dim split_dimG
matrix_A_dim||split_dim batch_w
matrix_A_dim split_dimA
matrix_A_dim||split_dim|1 batch_w
matrix_G_dim||split_dim batch_h
matrix_G_dim split_dimG
matrix_G_dim||split_dim|1 batch_h
(batch_h|batch_w|split_dimA|split_dimA) matrix_A_shape
(batch_h|split_dimG|split_dimG) matrix_G_shape
super _Conv|self __init__
in_channels self in_channels
out_channels self out_channels
kernel_size self kernel_size
stride self stride
pad_mode self pad_mode
padding self padding
dilation self dilation
group self group
data_format self data_format
has_bias self has_bias
 isinstance in_channels|intandin_channels>0
Parameter initializer self weight
Validator check_bool has_bias
Parameter initializer bias_init|[out_channels] self bias
logger warning
kernel_size|kernel_size self hw
twice kernel_size kernel_size
super Conv2d_Thor_GPU|self
self kernel_size kernel_size
self pad_mode pad_mode
self padding pad
self stride stride
self dilation dilation
self group group
self in_channels|self kernel_size|self kernel_size self matrix_A_dim
self out_channels self matrix_G_dim
caculate_matmul_shape self matrix_A_dim|self matrix_G_dim|split_dim matrix_G_shape
P BroadcastTo matrix_A_shape self broadcast_to
P Shape self shape
P Reshape self reshape
P Mul self mul
P InsertGradientOf self save_gradient self getG
Tensor 1|loss_scale|mstype float16 self loss_scale
Tensor batch_size|mstype float16 self batch_size
P Transpose self transpose
P Cast self cast
P GatherV2 self gather
Tensor frequency|mstype int32 self freq
P Sqrt self sqrt
Tensor np identity self matrix_A_dim self dampingA
Tensor np identity self matrix_G_dim self dampingG
P CholeskyTrsm split_dim self cholesky
dout out
self mul dout|self loss_scale dout
self mul dout|self batch_size dout
self reduce_mean dout|0 dout
self shape dout dout_shape
self reshape dout|(dout_shape|-1) dout
dout_shape normalizer
self cast dout|mstype float32 dout
self matmul dout|dout matrix_G
self mul matrix_G|1 0|normalizer matrix_G
self gather self damping|self cov_step|0 damping_step
self cast damping_step|mstype float32 damping_step
self cov_step|self freq self cov_step
self mul damping_step|1 0|normalizer damping
self sqrt damping damping
matrix_G|damping|self dampingG matrix_G
self cholesky matrix_G matrix_G
self vector_matmul matrix_G|matrix_G matrix_G
matrix_G self matrix_G_inv
self img2col x matrix_A
self shape matrix_A matrix_A_shape
self reduce_mean matrix_A|1 matrix_A
matrix_A_shape normalizer
self cast matrix_A|mstype float32 matrix_A
self matmul matrix_A|matrix_A matrix_A
self mul matrix_A|1 0|normalizer matrix_A
self gather self damping|self cov_step|self axis damping_step
matrix_A|damping|self dampingA matrix_A
self cholesky matrix_A matrix_A
self vector_matmul matrix_A|matrix_A matrix_A
self broadcast_to matrix_A matrix_A
matrix_A self matrix_A_inv
self conv2d x|self weight out
self getG out out
cell_attr_register  attrs
super Dense_Thor_GPU|self __init__
Validator check_positive_int in_channels self in_channels
Validator check_positive_int out_channels self out_channels
Validator check_bool has_bias self has_bias
isinstance weight_init|Tensor
Parameter initializer weight_init|[out_channels|in_channels] self weight
isinstance bias_init|Tensor
P BiasAdd self bias_add
get_activation activation self activation
caculate_matmul_shape self in_channels|self out_channels|split_dim matrix_G_shape
Tensor np identity in_channels self dampingA
Tensor np identity out_channels self dampingG
P TensorAdd self add
self cube_matmul dout|dout matrix_G
self sqrt damping_step damping
self cast x|mstype float32 inputs
self cube_matmul inputs|inputs inputs
self shape inputs inputs_shape
inputs_shape normalizer
self mul inputs|1 0|normalizer matrix_A
self matmul x|self weight output
self getG output output
self bias_add output|self bias output
self activation output
(1|kernel_size|kernel_size|1) ksizes
(1|stride|stride|1) strides
super Conv2d_Thor|self
batch_size self batch_size
P CusImg2Col ksizes self img2col
P CusMatrixCombine self matrix_combine
P CusCholeskyTrsm self cholesky
P CusTranspose02314 self transpose02314
Parameter self matrix_A_inv
Tensor np reshape np identity self matrix_A_device_dim astype np float16|self matrix_A_device_shape
Parameter self matrix_G_inv
Tensor np reshape np identity self matrix_G_device_dim astype np float16|self matrix_G_device_shape
Tensor self fake_G
Tensor damping self damping
P CusBatchMatMul self vector_matmul
self diag_block_dim-self matrix_A_dim%self diag_block_dim pad_dim
P Pad ((0|pad_dim)) self padA
P Pad ((0|0)) self device_shape_pad
P Slice self slice
self matrix_A_dim dampingA_dim
(self matrix_A_dim||self diag_block_dim|1)|self diag_block_dim dampingA_dim
self matrix_G_dim dampingG_dim
(self matrix_G_dim||self diag_block_dim|1)|self diag_block_dim dampingG_dim
Tensor np identity dampingA_dim self dampingA
Tensor np identity dampingG_dim self dampingG
P CusFusedAbsMax1 [self matrix_A_dim|self matrix_A_dim] self fused_abs_max1
P CusFusedAbsMax1 self fused_abs_max2
P Log self log
P Exp self exp
self mul dout|32 0 dout
self transpose02314 dout dout
self cast normalizer|mstype float32 normalizer
self mul damping_step|32 0|normalizer damping
self cast self dampingG|mstype float32 dampingG
matrix_G|damping|dampingG matrix_G
self cholesky matrix_G matrix_G_inv
self vector_matmul matrix_G_inv|matrix_G_inv matrix_G_inv
self fused_abs_max2 matrix_G_inv matrix_G_inv_max
self fused_abs_max2 matrix_G_inv_max matrix_G_inv_max
matrix_G_inv_max self G_inv_max
self matrix_combine matrix_G_inv matrix_G_inv
self reshape matrix_G_inv|self matrix_G_device_temp_shape matrix_G_inv
self transpose matrix_G_inv|(2|0|1|3) matrix_G_inv
self cast matrix_G_inv|mstype float16 matrix_G
self cube_matmul matrix_A|matrix_A matrix_A
self reshape matrix_A|(self hw|C0|self hw|C0) matrix_A
self slice matrix_A|(0|0|0|0) matrix_A
self reshape matrix_A|(self matrix_A_dim|self matrix_A_dim) matrix_A
self padA matrix_A matrix_A
self cast self dampingA|mstype float32 damping_A
matrix_A|damping|damping_A matrix_A
self cholesky matrix_A matrix_A_inv
self vector_matmul matrix_A_inv|matrix_A_inv matrix_A_inv
self fused_abs_max1 matrix_A_inv matrix_A_inv_max
self fused_abs_max2 matrix_A_inv_max matrix_A_inv_max
matrix_A_inv_max self A_inv_max
self matrix_combine matrix_A_inv matrix_A_inv
self cast matrix_A_inv|mstype float16 matrix_A_inv
self slice matrix_A_inv|(0|0) matrix_A_inv
self reshape matrix_A_inv|(self hw|self in_channels|self hw|self in_channels) matrix_A_inv
self device_shape_pad matrix_A_inv matrix_A_inv
self reshape matrix_A_inv|self matrix_A_device_temp_shape matrix_A_inv
self transpose matrix_A_inv|(2|0|1|3) matrix_A_inv
matrix_A_inv self matrix_A_inv
self fake_G self matrix_G_inv
super Dense_Thor|self __init__
Tensor np zeros [63|63|16|16] astype(np float16) self fake_G
P Pad ((0|23)) self pad
P Pad ((0|7)) self pad1
P AssignAdd self assignadd
P CusFusedAbsMax1 [1001|1001] self fused_abs_max1
Tensor np identity|mstype float32 self dampingA
Tensor np identity|mstype float32 self dampingG
self pad matrix_G matrix_G
self fused_abs_max1 matrix_G_inv matrix_G_inv_max
self slice matrix_G_inv|(0|0) matrix_G_inv
self pad1 matrix_G_inv matrix_G_inv
self shape matrix_G_inv matrix_G_inv_shape
self reshape matrix_G_inv|(matrix_G_inv_shape|16|16|matrix_G_inv_shape|16|16) matrix_G_inv
self cast matrix_G_inv|mstype float16 matrix_G_inv
matrix_G_inv self matrix_G_inv
self cube_matmul x|x inputs
self cast self dampingA|mstype float32 dampingA
matrix_A|damping|dampingA matrix_A
self fused_abs_max2 matrix_A_inv matrix_A_inv_max
self shape matrix_A_inv matrix_A_inv_shape
self reshape matrix_A_inv|(matrix_A_inv_shape|16|16|matrix_A_inv_shape|16|16) matrix_A_inv
(matrix_dim|channel)|C0 matrix_dim matrix_dim
(matrix_dim|channel)|C0 matrix_dim ll
split_dim split_dimA matrix_A_shape
split_dim split_dimG matrix_G_shape
matrix_A_dim||split_dim batch_w matrix_A_shape
matrix_A_dim split_dimA matrix_A_shape
matrix_A_dim||split_dim|1 batch_w matrix_A_shape
matrix_G_dim||split_dim batch_h matrix_A_shape
matrix_G_dim||split_dim batch_h matrix_G_shape
matrix_G_dim split_dimG matrix_G_shape
matrix_G_dim||split_dim|1 batch_h matrix_A_shape
matrix_G_dim||split_dim|1 batch_h matrix_G_shape
(batch_h|batch_w|split_dimA|split_dimA) matrix_A_shape normalizer
 isinstance  isinstance in_channels|intandin_channels>0
twice kernel_size kernel_size ksizes
super self kernel_size kernel_size
super self pad_mode pad_mode
super self padding pad
super self stride stride
super self dilation dilation
super self group group
super self in_channels|self kernel_size|self kernel_size self matrix_A_dim
super self out_channels self matrix_G_dim
super self mul dout|self loss_scale dout
super self mul dout|self batch_size dout
super self reduce_mean dout|0 dout
super self shape dout dout_shape
super self reshape dout|(dout_shape|-1) dout
super self cast dout|mstype float32 dout
super self matmul dout|dout matrix_G
super self mul matrix_G|1 0|normalizer matrix_G
super self gather self damping|self cov_step|0 damping_step
super self cast damping_step|mstype float32 damping_step
super self cov_step|self freq self cov_step
super self mul damping_step|1 0|normalizer damping
super self sqrt damping damping
super self cholesky matrix_G matrix_G
super self vector_matmul matrix_G|matrix_G matrix_G
super self img2col x matrix_A
super self shape matrix_A matrix_A_shape
super self reduce_mean matrix_A|1 matrix_A
super self cast matrix_A|mstype float32 matrix_A
super self matmul matrix_A|matrix_A matrix_A
super self mul matrix_A|1 0|normalizer matrix_A
super self gather self damping|self cov_step|self axis damping_step
super self cholesky matrix_A matrix_A
super self vector_matmul matrix_A|matrix_A matrix_A
super self broadcast_to matrix_A matrix_A
super self conv2d x|self weight out
super self getG out out
super self cube_matmul dout|dout matrix_G
super self sqrt damping_step damping
super self cast x|mstype float32 inputs
super self cube_matmul inputs|inputs inputs
super self shape inputs inputs_shape
super self mul inputs|1 0|normalizer matrix_A
super self matmul x|self weight output
super self getG output output
super self bias_add output|self bias output
super self activation output
super self diag_block_dim-self matrix_A_dim%self diag_block_dim pad_dim
super self matrix_A_dim dampingA_dim
super self matrix_G_dim dampingG_dim
super self mul dout|32 0 dout
super self transpose02314 dout dout
super self cast normalizer|mstype float32 normalizer
super self mul damping_step|32 0|normalizer damping
super self cast self dampingG|mstype float32 dampingG
super self cholesky matrix_G matrix_G_inv
super self vector_matmul matrix_G_inv|matrix_G_inv matrix_G_inv
super self fused_abs_max2 matrix_G_inv matrix_G_inv_max
super self fused_abs_max2 matrix_G_inv_max matrix_G_inv_max
super self matrix_combine matrix_G_inv matrix_G_inv
super self reshape matrix_G_inv|self matrix_G_device_temp_shape matrix_G_inv
super self transpose matrix_G_inv|(2|0|1|3) matrix_G_inv
super self cast matrix_G_inv|mstype float16 matrix_G
super self cube_matmul matrix_A|matrix_A matrix_A
super self reshape matrix_A|(self hw|C0|self hw|C0) matrix_A
super self slice matrix_A|(0|0|0|0) matrix_A
super self reshape matrix_A|(self matrix_A_dim|self matrix_A_dim) matrix_A
super self padA matrix_A matrix_A
super self cast self dampingA|mstype float32 damping_A
super self cholesky matrix_A matrix_A_inv
super self vector_matmul matrix_A_inv|matrix_A_inv matrix_A_inv
super self fused_abs_max1 matrix_A_inv matrix_A_inv_max
super self fused_abs_max2 matrix_A_inv_max matrix_A_inv_max
super self matrix_combine matrix_A_inv matrix_A_inv
super self cast matrix_A_inv|mstype float16 matrix_A_inv
super self slice matrix_A_inv|(0|0) matrix_A_inv
super self reshape matrix_A_inv|(self hw|self in_channels|self hw|self in_channels) matrix_A_inv
super self device_shape_pad matrix_A_inv matrix_A_inv
super self reshape matrix_A_inv|self matrix_A_device_temp_shape matrix_A_inv
super self transpose matrix_A_inv|(2|0|1|3) matrix_A_inv
super self fake_G self matrix_G_inv
super self pad matrix_G matrix_G
super self fused_abs_max1 matrix_G_inv matrix_G_inv_max
super self slice matrix_G_inv|(0|0) matrix_G_inv
super self pad1 matrix_G_inv matrix_G_inv
super self shape matrix_G_inv matrix_G_inv_shape
super self reshape matrix_G_inv|(matrix_G_inv_shape|16|16|matrix_G_inv_shape|16|16) matrix_G_inv
super self cast matrix_G_inv|mstype float16 matrix_G_inv
super self cube_matmul x|x inputs
super self cast self dampingA|mstype float32 dampingA
super self fused_abs_max2 matrix_A_inv matrix_A_inv_max
super self shape matrix_A_inv matrix_A_inv_shape
super self reshape matrix_A_inv|(matrix_A_inv_shape|16|16|matrix_A_inv_shape|16|16) matrix_A_inv
self kernel_size kernel_size ksizes
self stride stride strides
Tensor batch_size|mstype float16 self batch_size self batch_size
Tensor np identity self matrix_A_dim self dampingA matrix_A
Tensor np identity self matrix_G_dim self dampingG matrix_G
self shape dout dout_shape normalizer
self matmul dout|dout matrix_G dampingG matrix_G
self matmul dout|dout matrix_G self matrix_G_inv
self matmul dout|dout matrix_G matrix_G
self mul matrix_G|1 0|normalizer matrix_G dampingG matrix_G
self mul matrix_G|1 0|normalizer matrix_G self matrix_G_inv
self mul matrix_G|1 0|normalizer matrix_G matrix_G
self mul damping_step|1 0|normalizer damping dampingG matrix_G
self mul damping_step|1 0|normalizer damping dampingA matrix_A
self mul damping_step|1 0|normalizer damping matrix_G
self mul damping_step|1 0|normalizer damping matrix_A
self mul damping_step|1 0|normalizer damping matrix_A
self sqrt damping damping dampingG matrix_G
self sqrt damping damping dampingA matrix_A
self sqrt damping damping matrix_G
self sqrt damping damping matrix_A
self sqrt damping damping matrix_A
matrix_G|damping|self dampingG matrix_G dampingG matrix_G
matrix_G|damping|self dampingG matrix_G self matrix_G_inv
matrix_G|damping|self dampingG matrix_G matrix_G
self cholesky matrix_G matrix_G self matrix_G_inv
self cholesky matrix_G matrix_G matrix_G
self vector_matmul matrix_G|matrix_G matrix_G self matrix_G_inv
self vector_matmul matrix_G|matrix_G matrix_G matrix_G
matrix_G self matrix_G_inv self matrix_G_inv
self img2col x matrix_A dampingA matrix_A
self img2col x matrix_A self matrix_A_inv
self img2col x matrix_A matrix_A
self img2col x matrix_A matrix_A
self shape matrix_A matrix_A_shape normalizer
self reduce_mean matrix_A|1 matrix_A dampingA matrix_A
self reduce_mean matrix_A|1 matrix_A self matrix_A_inv
self reduce_mean matrix_A|1 matrix_A matrix_A
self reduce_mean matrix_A|1 matrix_A matrix_A
self cast matrix_A|mstype float32 matrix_A dampingA matrix_A
self cast matrix_A|mstype float32 matrix_A self matrix_A_inv
self cast matrix_A|mstype float32 matrix_A matrix_A
self cast matrix_A|mstype float32 matrix_A matrix_A
self matmul matrix_A|matrix_A matrix_A dampingA matrix_A
self matmul matrix_A|matrix_A matrix_A self matrix_A_inv
self matmul matrix_A|matrix_A matrix_A matrix_A
self matmul matrix_A|matrix_A matrix_A matrix_A
self mul matrix_A|1 0|normalizer matrix_A dampingA matrix_A
self mul matrix_A|1 0|normalizer matrix_A self matrix_A_inv
self mul matrix_A|1 0|normalizer matrix_A matrix_A
self mul matrix_A|1 0|normalizer matrix_A matrix_A
matrix_A|damping|self dampingA matrix_A dampingA matrix_A
matrix_A|damping|self dampingA matrix_A self matrix_A_inv
matrix_A|damping|self dampingA matrix_A matrix_A
matrix_A|damping|self dampingA matrix_A matrix_A
self cholesky matrix_A matrix_A self matrix_A_inv
self cholesky matrix_A matrix_A matrix_A
self cholesky matrix_A matrix_A matrix_A
self vector_matmul matrix_A|matrix_A matrix_A self matrix_A_inv
self vector_matmul matrix_A|matrix_A matrix_A matrix_A
self vector_matmul matrix_A|matrix_A matrix_A matrix_A
self broadcast_to matrix_A matrix_A self matrix_A_inv
self broadcast_to matrix_A matrix_A matrix_A
self broadcast_to matrix_A matrix_A matrix_A
matrix_A self matrix_A_inv self matrix_A_inv
isinstance Tensor np identity in_channels self dampingA
isinstance Tensor np identity out_channels self dampingG
isinstance Tensor np reshape np identity self matrix_A_device_dim astype np float16|self matrix_A_device_shape
isinstance Tensor np reshape np identity self matrix_G_device_dim astype np float16|self matrix_G_device_shape
isinstance Tensor self fake_G
isinstance Tensor damping self damping
isinstance Tensor np identity dampingA_dim self dampingA
isinstance Tensor np identity dampingG_dim self dampingG
isinstance Tensor np zeros [63|63|16|16] astype(np float16) self fake_G
isinstance Tensor np identity|mstype float32 self dampingA
isinstance Tensor np identity|mstype float32 self dampingG
isinstance Tensor np identity in_channels self dampingA
isinstance Tensor np identity out_channels self dampingG
isinstance Tensor np reshape np identity self matrix_A_device_dim astype np float16|self matrix_A_device_shape
isinstance Tensor np reshape np identity self matrix_G_device_dim astype np float16|self matrix_G_device_shape
isinstance Tensor self fake_G
isinstance Tensor damping self damping
isinstance Tensor np identity dampingA_dim self dampingA
isinstance Tensor np identity dampingG_dim self dampingG
isinstance Tensor np zeros [63|63|16|16] astype(np float16) self fake_G
isinstance Tensor np identity|mstype float32 self dampingA
isinstance Tensor np identity|mstype float32 self dampingG
Tensor np identity in_channels self dampingA matrix_A
Tensor np identity out_channels self dampingG matrix_G
self cube_matmul dout|dout matrix_G matrix_G
self sqrt damping_step damping matrix_G
self sqrt damping_step damping matrix_A
self sqrt damping_step damping matrix_A
self shape inputs inputs_shape normalizer
self mul inputs|1 0|normalizer matrix_A matrix_A
self mul inputs|1 0|normalizer matrix_A matrix_A
super self diag_block_dim-self matrix_A_dim%self diag_block_dim pad_dim
super self matrix_A_dim dampingA_dim
super self matrix_G_dim dampingG_dim
super self mul dout|32 0 dout
super self transpose02314 dout dout
super self cast normalizer|mstype float32 normalizer
super self mul damping_step|32 0|normalizer damping
super self cast self dampingG|mstype float32 dampingG
super self cholesky matrix_G matrix_G_inv
super self vector_matmul matrix_G_inv|matrix_G_inv matrix_G_inv
super self fused_abs_max2 matrix_G_inv matrix_G_inv_max
super self fused_abs_max2 matrix_G_inv_max matrix_G_inv_max
super self matrix_combine matrix_G_inv matrix_G_inv
super self reshape matrix_G_inv|self matrix_G_device_temp_shape matrix_G_inv
super self transpose matrix_G_inv|(2|0|1|3) matrix_G_inv
super self cast matrix_G_inv|mstype float16 matrix_G
super self cube_matmul matrix_A|matrix_A matrix_A
super self reshape matrix_A|(self hw|C0|self hw|C0) matrix_A
super self slice matrix_A|(0|0|0|0) matrix_A
super self reshape matrix_A|(self matrix_A_dim|self matrix_A_dim) matrix_A
super self padA matrix_A matrix_A
super self cast self dampingA|mstype float32 damping_A
super self cholesky matrix_A matrix_A_inv
super self vector_matmul matrix_A_inv|matrix_A_inv matrix_A_inv
super self fused_abs_max1 matrix_A_inv matrix_A_inv_max
super self fused_abs_max2 matrix_A_inv_max matrix_A_inv_max
super self matrix_combine matrix_A_inv matrix_A_inv
super self cast matrix_A_inv|mstype float16 matrix_A_inv
super self slice matrix_A_inv|(0|0) matrix_A_inv
super self reshape matrix_A_inv|(self hw|self in_channels|self hw|self in_channels) matrix_A_inv
super self device_shape_pad matrix_A_inv matrix_A_inv
super self reshape matrix_A_inv|self matrix_A_device_temp_shape matrix_A_inv
super self transpose matrix_A_inv|(2|0|1|3) matrix_A_inv
super self fake_G self matrix_G_inv
super self pad matrix_G matrix_G
super self fused_abs_max1 matrix_G_inv matrix_G_inv_max
super self slice matrix_G_inv|(0|0) matrix_G_inv
super self pad1 matrix_G_inv matrix_G_inv
super self shape matrix_G_inv matrix_G_inv_shape
super self reshape matrix_G_inv|(matrix_G_inv_shape|16|16|matrix_G_inv_shape|16|16) matrix_G_inv
super self cast matrix_G_inv|mstype float16 matrix_G_inv
super self cube_matmul x|x inputs
super self cast self dampingA|mstype float32 dampingA
super self fused_abs_max2 matrix_A_inv matrix_A_inv_max
super self shape matrix_A_inv matrix_A_inv_shape
super self reshape matrix_A_inv|(matrix_A_inv_shape|16|16|matrix_A_inv_shape|16|16) matrix_A_inv
Parameter self matrix_A_inv self matrix_A_inv
Parameter self matrix_G_inv self matrix_G_inv
Tensor damping self damping matrix_G
Tensor damping self damping matrix_A
Tensor damping self damping matrix_A
Tensor np identity dampingA_dim self dampingA matrix_A
Tensor np identity dampingG_dim self dampingG matrix_G
self mul damping_step|32 0|normalizer damping matrix_G
self mul damping_step|32 0|normalizer damping matrix_A
self mul damping_step|32 0|normalizer damping matrix_A
self cast self dampingG|mstype float32 dampingG matrix_G
matrix_G|damping|dampingG matrix_G matrix_G
self cholesky matrix_G matrix_G_inv self matrix_G_inv
self vector_matmul matrix_G_inv|matrix_G_inv matrix_G_inv self matrix_G_inv
self fused_abs_max2 matrix_G_inv matrix_G_inv_max self G_inv_max
self fused_abs_max2 matrix_G_inv_max matrix_G_inv_max self G_inv_max
self matrix_combine matrix_G_inv matrix_G_inv self matrix_G_inv
self reshape matrix_G_inv|self matrix_G_device_temp_shape matrix_G_inv self matrix_G_inv
self transpose matrix_G_inv|(2|0|1|3) matrix_G_inv self matrix_G_inv
self cube_matmul matrix_A|matrix_A matrix_A matrix_A
self cube_matmul matrix_A|matrix_A matrix_A matrix_A
self reshape matrix_A|(self hw|C0|self hw|C0) matrix_A matrix_A
self reshape matrix_A|(self hw|C0|self hw|C0) matrix_A matrix_A
self slice matrix_A|(0|0|0|0) matrix_A matrix_A
self slice matrix_A|(0|0|0|0) matrix_A matrix_A
self reshape matrix_A|(self matrix_A_dim|self matrix_A_dim) matrix_A matrix_A
self reshape matrix_A|(self matrix_A_dim|self matrix_A_dim) matrix_A matrix_A
self padA matrix_A matrix_A matrix_A
self padA matrix_A matrix_A matrix_A
self cast self dampingA|mstype float32 damping_A matrix_A
matrix_A|damping|damping_A matrix_A matrix_A
matrix_A|damping|damping_A matrix_A matrix_A
self cholesky matrix_A matrix_A_inv self matrix_A_inv
self vector_matmul matrix_A_inv|matrix_A_inv matrix_A_inv self matrix_A_inv
self fused_abs_max1 matrix_A_inv matrix_A_inv_max self A_inv_max
self fused_abs_max2 matrix_A_inv_max matrix_A_inv_max self A_inv_max
self matrix_combine matrix_A_inv matrix_A_inv self matrix_A_inv
self cast matrix_A_inv|mstype float16 matrix_A_inv self matrix_A_inv
self slice matrix_A_inv|(0|0) matrix_A_inv self matrix_A_inv
self reshape matrix_A_inv|(self hw|self in_channels|self hw|self in_channels) matrix_A_inv self matrix_A_inv
self device_shape_pad matrix_A_inv matrix_A_inv self matrix_A_inv
self reshape matrix_A_inv|self matrix_A_device_temp_shape matrix_A_inv self matrix_A_inv
self transpose matrix_A_inv|(2|0|1|3) matrix_A_inv self matrix_A_inv
self fake_G self matrix_G_inv self matrix_G_inv
Tensor np identity|mstype float32 self dampingA matrix_A
self slice matrix_G_inv|(0|0) matrix_G_inv self matrix_G_inv
self pad1 matrix_G_inv matrix_G_inv self matrix_G_inv
self reshape matrix_G_inv|(matrix_G_inv_shape|16|16|matrix_G_inv_shape|16|16) matrix_G_inv self matrix_G_inv
self cast matrix_G_inv|mstype float16 matrix_G_inv self matrix_G_inv
self cast self dampingA|mstype float32 dampingA matrix_A
matrix_A|damping|dampingA matrix_A matrix_A
C MultitypeFuncGraph reduce_opt
split_indices indices
split_indices fusion
range i
indices j temp
length temp
j|1 j
fusion|1 fusion
AllReduce GlobalComm WORLD_COMM_GROUP op
op add_prim_attr fusion
op_list|(op|) op_list
reduce_opt register
mul Primitive
F scalar_cast degree|F dtype parameters degree
allreduce parameters parameters
P Cast cast_op
mul parameters|cast_op F scalar_to_array 1 0|degree|F dtype parameters
C MultitypeFuncGraph _get_datatype
_get_datatype register
F dtype parameters
C MultitypeFuncGraph _cast_datatype
_cast_datatype register
F cast parameters|datatype
split_indices tuple
C HyperMap self hyper_map
P Mul self mul
get_group_size self degree
degree self degree
mean self mean
_init_allreduce_operators parameter_length|split_indices self op_list
self hyper_map F partial _get_datatype datatypes
self hyper_map F partial _cast_datatype|mstype float32 parameters
self hyper_map F partial reduce_opt|self mul|self degree new_parameters
self hyper_map F partial _cast_datatype new_parameters
C MultitypeFuncGraph reduce_opt register
split_indices indices j temp
split_indices fusion fusion
j|1 j j
fusion|1 fusion fusion
AllReduce GlobalComm WORLD_COMM_GROUP op add_prim_attr fusion
AllReduce GlobalComm WORLD_COMM_GROUP op op_list
op_list|(op|) op_list op_list
F scalar_cast degree|F dtype parameters degree self degree
C MultitypeFuncGraph _get_datatype register
C MultitypeFuncGraph _cast_datatype register
get_group_size self degree self degree
parser parse_args args_opt
context GRAPH_MODE mode|args_opt device_target device_target|args_opt device_id device_id context set_context
Config_CNNCTC cfg
cfg CKPT_PATH ckpt_path
args_opt ckpt_file ckpt_path
CNNCTC_Model cfg NUM_CLASS|cfg HIDDEN_SIZE|cfg FINAL_FEATURE_WIDTH net
cfg TEST_BATCH_SIZE bs
Tensor np zeros [bs|3|cfg IMG_H|cfg IMG_W] input_data
args_opt file_name|file_format file_name
parser parse_args args_opt ckpt_file ckpt_path
parser parse_args args_opt file_name|file_format file_name
Config_CNNCTC cfg CKPT_PATH ckpt_path
Config_CNNCTC cfg TEST_BATCH_SIZE bs
split_indices tuple
ST_MJ_Generator_batch_fixed_length_para st_dataset
ST_MJ_Generator_batch_fixed_length st_dataset
dataset_creator args_opt run_distribute ds
CNNCTC_Model config NUM_CLASS|config HIDDEN_SIZE|config FINAL_FEATURE_WIDTH net
net set_train True
load_checkpoint config CKPT_PATH param_dict
load_param_into_net net|param_dict
ctc_loss criterion
WithLossCell net|criterion net
mindspore train loss_scale_manager FixedLossScaleManager config LOSS_SCALE|False loss_scale_manager
LossCallBack callback
parser parse_args args_cfg
Config_CNNCTC cfg
args_cfg ckpt_path cfg CKPT_PATH
train args_cfg|cfg
CNNCTC_Model config NUM_CLASS|config HIDDEN_SIZE|config FINAL_FEATURE_WIDTH net set_train True
parser parse_args args_cfg ckpt_path cfg CKPT_PATH
GeneratorDataset IIIT_Generator_batch ds
test_dataset_creator ds
CNNCTC_Model config NUM_CLASS|config HIDDEN_SIZE|config FINAL_FEATURE_WIDTH net
config CKPT_PATH ckpt_path
load_checkpoint ckpt_path param_dict
load_param_into_net net|param_dict
print ckpt_path
CTCLabelConverter config CHARACTER converter
AverageMeter model_run_time
AverageMeter npu_to_cpu_time
AverageMeter postprocess_time
ds create_tuple_iterator data
data length
Tensor img|mstype float32 img_tensor
time time model_run_begin
net img_tensor model_predict
time time model_run_end
model_run_time update model_run_end-model_run_begin
time time npu_to_cpu_begin
np squeeze model_predict asnumpy model_predict
time time npu_to_cpu_end
npu_to_cpu_time update npu_to_cpu_end-npu_to_cpu_begin
time time postprocess_begin
np array [model_predict shape]|config TEST_BATCH_SIZE preds_size
np argmax model_predict|2 preds_index
np reshape preds_index preds_index
converter decode preds_index|preds_size preds_str
time time postprocess_end
postprocess_time update postprocess_end-postprocess_begin
converter reverse_encode text asnumpy|length asnumpy label_str
model_run_time reset
npu_to_cpu_time reset
postprocess_time reset
print model_run_time avg
print npu_to_cpu_time avg
print postprocess_time avg
print preds_str
print label_str
zip pred|label
print correct_count|count
parser parse_args args_opt
Config_CNNCTC cfg
args_opt ckpt_path cfg CKPT_PATH
test cfg
GeneratorDataset IIIT_Generator_batch ds create_tuple_iterator data
test_dataset_creator ds create_tuple_iterator data
CNNCTC_Model config NUM_CLASS|config HIDDEN_SIZE|config FINAL_FEATURE_WIDTH net img_tensor model_predict
load_param_into_net net img_tensor model_predict
CTCLabelConverter config CHARACTER converter decode preds_index|preds_size preds_str
CTCLabelConverter config CHARACTER converter reverse_encode text asnumpy|length asnumpy label_str
AverageMeter model_run_time update model_run_end-model_run_begin
AverageMeter model_run_time reset
AverageMeter npu_to_cpu_time update npu_to_cpu_end-npu_to_cpu_begin
AverageMeter npu_to_cpu_time reset
AverageMeter postprocess_time update postprocess_end-postprocess_begin
AverageMeter postprocess_time reset
ds create_tuple_iterator data length
parser parse_args args_opt ckpt_path cfg CKPT_PATH
super LossCallBack|self __init__
isinstance per_print_times|int
per_print_times self _per_print_times
AverageMeter self loss_avg
AverageMeter self timer
time time self start_time
run_context original_args cb_params
cb_params net_outputs asnumpy loss
(cb_params cur_step_num-1)%cb_params batch_num|1 cur_step_in_epoch
cb_params cur_step_num cur_num
self timer update time time-self start_time
self loss_avg update loss
open loss_file
loss_file write
loss_file close
isinstance per_print_times self _per_print_times
run_context original_args cb_params net_outputs asnumpy loss
run_context original_args cb_params cur_step_num cur_num
open loss_file write
open loss_file close
len CHARACTER|1 NUM_CLASS
int (26|1)||2 max_len
lmdb open env_save
lmdb_paths lmdb_path
int txn get  encode nSamples
tqdm index
txn get label_key decode label
len label
label lower char_item
txn get img_key imgbuf
label encode label_save
imgbuf image_save
txn_save put label_key_save|label_save
txn_save put image_key_save|image_save
cnt nSamples
txn_save put  encode|str nSamples encode
len label label_length
sorted_label_length l|num
l|num label_length_sum
num label_num
p append num
lengths append l
enumerate i|_
int label_length_sum|label_num|batch_size average_overall_length
np random choice items|batch_size-1|True|p ret
sum ret cur_sum
list ret ret
ret append fix_length-cur_sum
len result
get_combinations_of_fix_length average_overall_length|lengths|p|batch_size ret
result append ret
length_index_dict label_length append index
[index] length_index_dict label_length
range _
random choice combinations comb
comb l
ret append random choice length_index_dict l
open pkl_save_path|
pickle dump ret|f|-1
analyze_lmdb_label_length combination
txn get label_key decode label lower char_item
txn get label_key decode label encode label_save
len label lower char_item
len label encode label_save
txn get img_key imgbuf image_save
sorted_label_length l|num label_length_sum
sorted_label_length num label_num
np random choice items|batch_size-1|True|p ret append fix_length-cur_sum
np random choice items|batch_size-1|True|p ret append random choice length_index_dict l
list ret ret append fix_length-cur_sum
list ret ret append random choice length_index_dict l
len result append ret
get_combinations_of_fix_length average_overall_length|lengths|p|batch_size ret append random choice length_index_dict l
result append ret append random choice length_index_dict l
random choice combinations comb l
self reset
val self val
val|n self sum
n self count
self sum|self count self avg
list character dict_character
enumerate i|char
i self dict char
dict_character self character
len dict_character self dict
np array text|np array length
length l
text_index t
range i
char_list append self character[t[i]]
texts append text
l index
list character dict_character self character
enumerate i self dict char
np array text|np array length l
length l index
Config_CNNCTC config
max_size self max_size
PAD_type self PAD_type
np array img|dtype img
img transpose [2|0|1] img
img astype np float img
np true_divide img|255 img
np subtract img|0 5 img
np true_divide img|0 5 img
img shape w
np zeros shape Pad_img
img Pad_img
imgH self imgH
imgW self imgW
self imgW resized_max_w
NormalizePAD (input_channel|self imgH|resized_max_w) transform
images image
image size h
w|float(h) ratio
math ceil self imgH|ratio
self imgW resized_w
math ceil self imgH|ratio resized_w
image resize (resized_w|self imgH) resized_image
resized_images append transform resized_image
np concatenate [np expand_dims t|0fortinresized_images]|0 image_tensors
txn get label_key decode label
txn get img_key imgbuf
six BytesIO buf
buf write imgbuf
buf seek
Image open buf convert img
Image new (config IMG_W|config IMG_H) img
label lower label
AlignCollate self align_collector
CTCLabelConverter config CHARACTER self converter
print %(config TRAIN_DATASET_PATH)
ValueError config TRAIN_DATASET_PATH
open config TRAIN_DATASET_INDEX_PATH|
pickle load f self st_mj_filtered_index_list
len self st_mj_filtered_index_list||config TRAIN_BATCH_SIZE self dataset_size
config TRAIN_BATCH_SIZE self batch_size
range item i
self st_mj_filtered_index_list i index
get_img_from_lmdb self env|index label
img_ret append img
text_ret append label
self align_collector img_ret img_ret
self converter encode text_ret length
enumerate i|_
range j
label_indices append (i|j)
np array label_indices|np int64 label_indices
np array [config FINAL_FEATURE_WIDTH]|config TRAIN_BATCH_SIZE|dtype sequence_length
text_ret astype np int32 text_ret
get_rank self rank_id
get_group_size self rank_size
len self st_mj_filtered_index_list||config TRAIN_BATCH_SIZE||self rank_size self dataset_size
(item|self rank_size)|self rank_id rank_item
range rank_item i
int (26|1)||2 max_len
AlignCollate align_collector
CTCLabelConverter config CHARACTER converter
print %(config TEST_DATASET_PATH)
sys exit
int txn get  encode nSamples
range index
len label
label lower char_item
filtered_index_list append index
filtered_index_list index
get_img_from_lmdb env|index label
align_collector img_ret img_ret
converter encode text_ret length
np array |config TEST_BATCH_SIZE|dtype sequence_length
Config_CNNCTC config TRAIN_BATCH_SIZE self batch_size
np array img|dtype img transpose [2|0|1] img
np array img|dtype img astype np float img
np array img|dtype img shape w
np array img|dtype img Pad_img
np true_divide img|255 img shape w
np true_divide img|255 img Pad_img
np subtract img|0 5 img shape w
np subtract img|0 5 img Pad_img
np true_divide img|0 5 img shape w
np true_divide img|0 5 img Pad_img
img shape w ratio
images image size h
images image resize (resized_w|self imgH) resized_image
txn get label_key decode label lower label
txn get label_key decode label lower char_item
six BytesIO buf write imgbuf
six BytesIO buf seek
AlignCollate self align_collector img_ret img_ret
CTCLabelConverter config CHARACTER self converter encode text_ret length
get_img_from_lmdb self env|index label lower char_item
text_ret append label lower char_item
AlignCollate align_collector img_ret img_ret
CTCLabelConverter config CHARACTER converter encode text_ret length
len label lower char_item
super CNNCTC_Model|self __init__
num_class self num_class
hidden_size self hidden_size
final_feature_width self final_feature_width
ResNet_FeatureExtractor self FeatureExtraction
nn Dense self hidden_size|self num_class self Prediction
P Transpose self transpose
P Reshape self reshape
self FeatureExtraction x x
self transpose x|(0|3|1|2) x
self reshape x|(-1|self hidden_size) x
self Prediction x x
self reshape x|(-1|self final_feature_width|self num_class) x
backbone self _backbone
loss_fn self _loss_fn
self _backbone img model_predict
self _loss_fn model_predict|label_indices|text|sequence_length
super ctc_loss|self __init__
P ReduceMean self mean
self transpose inputs|(1|0|2) inputs
self loss inputs|labels_indices|labels_values|sequence_length _
self mean loss loss
super ResNet_FeatureExtractor|self __init__
ResNet 3|512|BasicBlock|[1|2|5|3] self ConvNet
self ConvNet featuremap
super ResNet|self __init__
[int output_channel|4] self output_channel_block
int output_channel|8 self inplanes
ms_fused_bn int output_channel|16 self bn0_1
ms_fused_bn self inplanes self bn0_2
P ReLU self relu
self _make_layer block|self output_channel_block|layers self layer1
ms_fused_bn self output_channel_block self bn1
self _make_layer block|self output_channel_block|layers self layer2
ms_fused_bn self output_channel_block self bn2
P Pad ((0|0)) self pad
self _make_layer block|self output_channel_block|layers self layer3
ms_fused_bn self output_channel_block self bn3
self _make_layer block|self output_channel_block|layers self layer4
ms_fused_bn self output_channel_block self bn4_1
ms_fused_bn self output_channel_block self bn4_2
nn SequentialCell downsample
layers append block self inplanes|planes|stride|downsample
planes|block expansion self inplanes
range _
layers append block self inplanes|planes
nn SequentialCell layers
self conv0_1 x x
self bn0_1 x x
self relu x x
self conv0_2 x x
self bn0_2 x x
self maxpool1 x x
self layer1 x x
self conv1 x x
self bn1 x x
self maxpool2 x x
self layer2 x x
self conv2 x x
self bn2 x x
self maxpool3 x x
self layer3 x x
self conv3 x x
self bn3 x x
self layer4 x x
self pad x x
self conv4_1 x x
self bn4_1 x x
self conv4_2 x x
self bn4_2 x x
super BasicBlock|self __init__
ms_fused_bn planes self bn1
ms_fused_bn planes self bn2
downsample self downsample
P TensorAdd self add
x residual
self conv1 x out
self bn1 out out
self relu out out
self conv2 out out
self bn2 out out
self downsample x residual
self add out|residual out
mstype float16 dtype
weight_variable (out_channels|in_channels|3|3) init_value
weight_variable (out_channels|in_channels|1|1) init_value
self FeatureExtraction x x residual
self transpose x|(0|3|1|2) x residual
self reshape x|(-1|self hidden_size) x residual
self Prediction x x residual
self reshape x|(-1|self final_feature_width|self num_class) x residual
nn SequentialCell downsample self downsample
layers append block self downsample self downsample
self conv0_1 x x residual
self bn0_1 x x residual
self relu x x residual
self conv0_2 x x residual
self bn0_2 x x residual
self maxpool1 x x residual
self layer1 x x residual
self conv1 x x residual
self bn1 x x residual
self maxpool2 x x residual
self layer2 x x residual
self conv2 x x residual
self bn2 x x residual
self maxpool3 x x residual
self layer3 x x residual
self conv3 x x residual
self bn3 x x residual
self layer4 x x residual
self pad x x residual
self conv4_1 x x residual
self bn4_1 x x residual
self conv4_2 x x residual
self bn4_2 x x residual
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
load_checkpoint args ckpt_file param_dict
load_param_into_net net|param_dict
Tensor np ones [args batch_size|3|cfg image_size|cfg image_size] input_arr
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
set_seed cfg random_seed
parser parse_args args_opt
os getenv isdigit
int context set_context(device_id os getenv)
get_rank cfg rank
get_group_size cfg group_size
ParallelMode DATA_PARALLEL parallel_mode
create_dataset args_opt dataset_path|cfg|True dataset
dataset get_dataset_size batches_per_epoch
NASNetAMobileWithLoss cfg net_with_loss
load_checkpoint args_opt resume ckpt
load_param_into_net net_with_loss|ckpt
cfg num_epoch_per_decay|total_epochs num_epoch_per_decay
os path basename args_opt resume name_dir
name_dir split ext
name split split_result
split_result split resume
int resume resume_epoch
int split_result step_num_in_epoch
Tensor lr|mstype float32 lr
net_with_loss trainable_params param
decayed_params append param
no_decayed_params append param
net_with_loss set_train
Model net_with_loss|optimizer model
LossMonitor per_print_times loss_cb
TimeMonitor data_size time_cb
[loss_cb|time_cb] callbacks
CheckpointConfig save_checkpoint_steps config_ck
os path join cfg ckpt_path save_ckpt_path
ModelCheckpoint prefix ckpoint_cb
callbacks append ckpoint_cb
create_dataset args_opt dataset_path|cfg|True dataset get_dataset_size batches_per_epoch
NASNetAMobileWithLoss cfg net_with_loss trainable_params param
NASNetAMobileWithLoss cfg net_with_loss set_train
NASNetAMobileWithLoss cfg net_with_loss model
load_param_into_net net_with_loss trainable_params param
load_param_into_net net_with_loss set_train
os path basename args_opt resume name_dir split ext
name split split_result split resume
LossMonitor per_print_times loss_cb callbacks
TimeMonitor data_size time_cb callbacks
[loss_cb|time_cb] callbacks append ckpoint_cb
parser parse_args args_opt
callbacks append ckpoint_cb
context GRAPH_MODE mode|args_opt platform device_target context set_context
load_checkpoint args_opt checkpoint ckpt
load_param_into_net net|ckpt
net set_train False
create_dataset args_opt dataset_path|cfg|False dataset
nn Top1CategoricalAccuracy
model eval dataset metrics
print metrics
load_param_into_net net set_train False
 nasnet_a_mobile_config_gpu
lr_init float
total_epochs int
steps_per_epoch int
is_stair bool
steps_per_epoch|total_epochs total_steps
steps_per_epoch|num_epoch_per_decay decay_steps
range i
i|decay_steps p
math floor p p
lr_each_step append lr_init|math pow lr_decay_rate|p
np array lr_each_step astype np float32 learning_rate
steps_per_epoch|num_epoch_per_decay decay_steps p
range i p
dataset_path string
config dict
do_train bool
repeat_num int
config rank rank
config group_size group_size
C RandomCropDecodeResize config image_size
C Decode
C Resize int config image_size|0 875
C CenterCrop config image_size
C Rescale 1 0|255 0|0 0
[0 5 mean|0 5|0 5]|[0 5 std|0 5|0 5] C Normalize
C HWC2CHW
C2 TypeCast mstype int32 type_cast_op
ds repeat repeat_num ds
super CrossEntropy_Val|self __init__
P OneHot self onehot
Tensor 1 0-smooth_factor|mstype float32 self on_value
Tensor 1 0|smooth_factor|(num_classes-1) self off_value
nn SoftmaxCrossEntropyWithLogits self ce
P ReduceMean False self mean
self onehot label|F shape logits one_hot_label
self ce logits|one_hot_label loss_logit
self mean loss_logit|0 loss_logit
C MultitypeFuncGraph clip_grad
clip_grad register
F dtype grad dt
nn ClipByNorm grad|F cast(F tuple_to_array (clip_value|)) new_grad
super CrossEntropy|self __init__
factor self factor
P OneHot self onehot
Tensor 1 0-smooth_factor|mstype float32 self on_value
Tensor 1 0|smooth_factor|(num_classes-1) self off_value
nn SoftmaxCrossEntropyWithLogits self ce
P ReduceMean False self mean
logits aux
self onehot label|F shape logit one_hot_label
self ce logit|one_hot_label loss_logit
self mean loss_logit|0 loss_logit
self onehot label|F shape aux one_hot_label_aux
self ce aux|one_hot_label_aux loss_aux
self mean loss_aux|0 loss_aux
super AuxLogits|self __init__
nn ReLU self relu
nn BatchNorm2d self bn
nn BatchNorm2d self bn_1
nn Flatten self flatten
nn Dense 6912|out_channels self fc
nn Dense 768|out_channels self fc
self relu x x
self pool x x
self conv x x
self bn x x
self conv_1 x x
self bn_1 x x
self flatten x x
self fc x x
super SeparableConv2d|self __init__
self depthwise_conv2d x x
self pointwise_conv2d x x
super BranchSeparables|self __init__
SeparableConv2d self separable_1
nn ReLU self relu1
SeparableConv2d self separable_2
self separable_1 x x
self bn_sep_1 x x
self relu1 x x
self separable_2 x x
self bn_sep_2 x x
super BranchSeparablesStem|self __init__
self padding x x
super CellStem0|self __init__
num_filters self num_filters
stem_filters self stem_filters
 self conv_1x1
nn ReLU
BranchSeparables self comb_iter_0_left
BranchSeparablesStem self comb_iter_0_right
BranchSeparablesStem self comb_iter_1_right
BranchSeparablesStem self comb_iter_2_right
BranchSeparables self comb_iter_4_left
self conv_1x1 x x1
self comb_iter_0_left x1 x_comb_iter_0_left
self comb_iter_0_right x x_comb_iter_0_right
x_comb_iter_0_left|x_comb_iter_0_right x_comb_iter_0
self comb_iter_1_left x1 x_comb_iter_1_left
self comb_iter_1_right x x_comb_iter_1_right
x_comb_iter_1_left|x_comb_iter_1_right x_comb_iter_1
self comb_iter_2_left x1 x_comb_iter_2_left
self comb_iter_2_right x x_comb_iter_2_right
x_comb_iter_2_left|x_comb_iter_2_right x_comb_iter_2
self comb_iter_3_right x_comb_iter_0 x_comb_iter_3_right
x_comb_iter_3_right|x_comb_iter_1 x_comb_iter_3
self comb_iter_4_left x_comb_iter_0 x_comb_iter_4_left
self comb_iter_4_right x1 x_comb_iter_4_right
x_comb_iter_4_left|x_comb_iter_4_right x_comb_iter_4
P Concat (x_comb_iter_1|x_comb_iter_2|x_comb_iter_3|x_comb_iter_4) x_out
super CellStem1|self __init__
 self path_1
nn CellList self path_2
BranchSeparables self comb_iter_0_right
BranchSeparables self comb_iter_1_right
BranchSeparables self comb_iter_2_right
P Shape self shape
self conv_1x1 x_stem_0 x_left
self relu x_conv0 x_relu
self path_1 x_relu x_path1
self path_2 x_relu x_path2
self path_2 x_path2 x_path2
self final_path_bn P Concat (x_path1|x_path2) x_right
self comb_iter_0_left x_left x_comb_iter_0_left
self comb_iter_0_right x_right x_comb_iter_0_right
self comb_iter_1_left x_left x_comb_iter_1_left
self comb_iter_1_right x_right x_comb_iter_1_right
self comb_iter_2_left x_left x_comb_iter_2_left
self comb_iter_2_right x_right x_comb_iter_2_right
self comb_iter_4_right x_left x_comb_iter_4_right
super FirstCell|self __init__
BranchSeparables self comb_iter_1_left
self relu x_prev x_relu
self final_path_bn P Concat (x_path1|x_path2) x_left
self conv_1x1 x x_right
self comb_iter_0_left x_right x_comb_iter_0_left
self comb_iter_0_right x_left x_comb_iter_0_right
self comb_iter_1_right x_left x_comb_iter_1_right
self comb_iter_2_left x_right x_comb_iter_2_left
x_comb_iter_2_left|x_left x_comb_iter_2
self comb_iter_3_left x_left x_comb_iter_3_left
self comb_iter_3_right x_left x_comb_iter_3_right
x_comb_iter_3_left|x_comb_iter_3_right x_comb_iter_3
self comb_iter_4_left x_right x_comb_iter_4_left
x_comb_iter_4_left|x_right x_comb_iter_4
P Concat (x_left|x_comb_iter_0|x_comb_iter_1|x_comb_iter_2|x_comb_iter_3|x_comb_iter_4) x_out
super NormalCell|self __init__
 self conv_prev_1x1
self conv_prev_1x1 x_prev x_left
super ReductionCell0|self __init__
BranchSeparablesReduction self comb_iter_0_left
BranchSeparablesReduction self comb_iter_0_right
BranchSeparablesReduction self comb_iter_1_right
BranchSeparablesReduction self comb_iter_2_right
BranchSeparablesReduction self comb_iter_4_left
self comb_iter_1_left x_right x_comb_iter_1_left
self comb_iter_2_right x_left x_comb_iter_2_right
self comb_iter_4_right x_right x_comb_iter_4_right
super ReductionCell1|self __init__
super NASNetAMobile|self __init__
is_training self is_training
penultimate_filters self penultimate_filters
filters_multiplier self filters_multiplier
self penultimate_filters||24 filters
 self conv0
CellStem0 self cell_stem_0
filters||(filters_multiplier2) num_filters
CellStem1 self cell_stem_1
filters||filters_multiplier num_filters
FirstCell self cell_0
filters in_channels_left
filters||2 out_channels_left
filters out_channels_right
NormalCell self cell_1
filters out_channels_left
NormalCell self cell_2
NormalCell self cell_3
ReductionCell0 self reduction_cell_0
FirstCell self cell_6
NormalCell self cell_7
NormalCell self cell_8
NormalCell self cell_9
ReductionCell1 self reduction_cell_1
FirstCell self cell_12
NormalCell self cell_13
NormalCell self cell_14
NormalCell self cell_15
P Reshape self reshape
self _initialize_weights
self init_parameters_data
self cells_and_names _|m
isinstance m|nn Conv2d
m kernel_size|m kernel_size|m out_channels n
isinstance m|nn BatchNorm2d
isinstance m|nn Dense
self conv0 x x_conv0
self cell_stem_0 x_conv0 x_stem_0
self cell_stem_1 x_conv0|x_stem_0 x_stem_1
self cell_0 x_stem_1|x_stem_0 x_cell_0
self cell_1 x_cell_0|x_stem_1 x_cell_1
self cell_2 x_cell_1|x_cell_0 x_cell_2
self cell_3 x_cell_2|x_cell_1 x_cell_3
self reduction_cell_0 x_cell_3|x_cell_2 x_reduction_cell_0
self cell_6 x_reduction_cell_0|x_cell_3 x_cell_6
self cell_7 x_cell_6|x_reduction_cell_0 x_cell_7
self cell_8 x_cell_7|x_cell_6 x_cell_8
self cell_9 x_cell_8|x_cell_7 x_cell_9
self aux_logits x_cell_9 aux_logits
self reduction_cell_1 x_cell_9|x_cell_8 x_reduction_cell_1
self cell_12 x_reduction_cell_1|x_cell_9 x_cell_12
self cell_13 x_cell_12|x_reduction_cell_1 x_cell_13
self cell_14 x_cell_13|x_cell_12 x_cell_14
self cell_15 x_cell_14|x_cell_13 x_cell_15
self relu x_cell_15 x_cell_15
self avg_pool x_cell_15 x_cell_15
self reshape x_cell_15|(self shape x_cell_15) x_cell_15
self dropout x_cell_15 x_cell_15
self classifier x_cell_15 logits
super NASNetAMobileWithLoss|self __init__
NASNetAMobile config num_classes|is_training self network
P Cast self cast
self network data prediction_scores
self loss prediction_scores|label total_loss
self cast total_loss|mstype float32
network self network
self network set_grad
optimizer parameters self weights
optimizer self optimizer
C HyperMap self hyper_map
sens self sens
_get_parallel_mode parallel_mode
_get_gradients_mean mean
_get_device_num degree
DistributedGradReducer optimizer parameters|mean|degree self grad_reducer
self weights weights
self network |inputs loss
P Fill P DType loss sens
self grad self network|weights(|inputs|sens) grads
self hyper_map F partial clip_grad|GRADIENT_CLIP_TYPE|GRADIENT_CLIP_VALUE grads
self grad_reducer grads grads
F depend loss|self optimizer grads
C MultitypeFuncGraph clip_grad register
self relu x x x_comb_iter_0
self relu x x x_comb_iter_1
self relu x x x_comb_iter_2
self relu x x x_comb_iter_3
self relu x x x_comb_iter_4
self relu x x x_comb_iter_2
self relu x x x_comb_iter_3
self relu x x x_comb_iter_4
self pool x x x_comb_iter_0
self pool x x x_comb_iter_1
self pool x x x_comb_iter_2
self pool x x x_comb_iter_3
self pool x x x_comb_iter_4
self pool x x x_comb_iter_2
self pool x x x_comb_iter_3
self pool x x x_comb_iter_4
self conv x x x_comb_iter_0
self conv x x x_comb_iter_1
self conv x x x_comb_iter_2
self conv x x x_comb_iter_3
self conv x x x_comb_iter_4
self conv x x x_comb_iter_2
self conv x x x_comb_iter_3
self conv x x x_comb_iter_4
self bn x x x_comb_iter_0
self bn x x x_comb_iter_1
self bn x x x_comb_iter_2
self bn x x x_comb_iter_3
self bn x x x_comb_iter_4
self bn x x x_comb_iter_2
self bn x x x_comb_iter_3
self bn x x x_comb_iter_4
self conv_1 x x x_comb_iter_0
self conv_1 x x x_comb_iter_1
self conv_1 x x x_comb_iter_2
self conv_1 x x x_comb_iter_3
self conv_1 x x x_comb_iter_4
self conv_1 x x x_comb_iter_2
self conv_1 x x x_comb_iter_3
self conv_1 x x x_comb_iter_4
self bn_1 x x x_comb_iter_0
self bn_1 x x x_comb_iter_1
self bn_1 x x x_comb_iter_2
self bn_1 x x x_comb_iter_3
self bn_1 x x x_comb_iter_4
self bn_1 x x x_comb_iter_2
self bn_1 x x x_comb_iter_3
self bn_1 x x x_comb_iter_4
self flatten x x x_comb_iter_0
self flatten x x x_comb_iter_1
self flatten x x x_comb_iter_2
self flatten x x x_comb_iter_3
self flatten x x x_comb_iter_4
self flatten x x x_comb_iter_2
self flatten x x x_comb_iter_3
self flatten x x x_comb_iter_4
self fc x x x_comb_iter_0
self fc x x x_comb_iter_1
self fc x x x_comb_iter_2
self fc x x x_comb_iter_3
self fc x x x_comb_iter_4
self fc x x x_comb_iter_2
self fc x x x_comb_iter_3
self fc x x x_comb_iter_4
self depthwise_conv2d x x x_comb_iter_0
self depthwise_conv2d x x x_comb_iter_1
self depthwise_conv2d x x x_comb_iter_2
self depthwise_conv2d x x x_comb_iter_3
self depthwise_conv2d x x x_comb_iter_4
self depthwise_conv2d x x x_comb_iter_2
self depthwise_conv2d x x x_comb_iter_3
self depthwise_conv2d x x x_comb_iter_4
self pointwise_conv2d x x x_comb_iter_0
self pointwise_conv2d x x x_comb_iter_1
self pointwise_conv2d x x x_comb_iter_2
self pointwise_conv2d x x x_comb_iter_3
self pointwise_conv2d x x x_comb_iter_4
self pointwise_conv2d x x x_comb_iter_2
self pointwise_conv2d x x x_comb_iter_3
self pointwise_conv2d x x x_comb_iter_4
self separable_1 x x x_comb_iter_0
self separable_1 x x x_comb_iter_1
self separable_1 x x x_comb_iter_2
self separable_1 x x x_comb_iter_3
self separable_1 x x x_comb_iter_4
self separable_1 x x x_comb_iter_2
self separable_1 x x x_comb_iter_3
self separable_1 x x x_comb_iter_4
self bn_sep_1 x x x_comb_iter_0
self bn_sep_1 x x x_comb_iter_1
self bn_sep_1 x x x_comb_iter_2
self bn_sep_1 x x x_comb_iter_3
self bn_sep_1 x x x_comb_iter_4
self bn_sep_1 x x x_comb_iter_2
self bn_sep_1 x x x_comb_iter_3
self bn_sep_1 x x x_comb_iter_4
self relu1 x x x_comb_iter_0
self relu1 x x x_comb_iter_1
self relu1 x x x_comb_iter_2
self relu1 x x x_comb_iter_3
self relu1 x x x_comb_iter_4
self relu1 x x x_comb_iter_2
self relu1 x x x_comb_iter_3
self relu1 x x x_comb_iter_4
self separable_2 x x x_comb_iter_0
self separable_2 x x x_comb_iter_1
self separable_2 x x x_comb_iter_2
self separable_2 x x x_comb_iter_3
self separable_2 x x x_comb_iter_4
self separable_2 x x x_comb_iter_2
self separable_2 x x x_comb_iter_3
self separable_2 x x x_comb_iter_4
self bn_sep_2 x x x_comb_iter_0
self bn_sep_2 x x x_comb_iter_1
self bn_sep_2 x x x_comb_iter_2
self bn_sep_2 x x x_comb_iter_3
self bn_sep_2 x x x_comb_iter_4
self bn_sep_2 x x x_comb_iter_2
self bn_sep_2 x x x_comb_iter_3
self bn_sep_2 x x x_comb_iter_4
self padding x x x_comb_iter_0
self padding x x x_comb_iter_1
self padding x x x_comb_iter_2
self padding x x x_comb_iter_3
self padding x x x_comb_iter_4
self padding x x x_comb_iter_2
self padding x x x_comb_iter_3
self padding x x x_comb_iter_4
BranchSeparables self comb_iter_0_left x_comb_iter_0
BranchSeparables self comb_iter_4_left x_comb_iter_4
BranchSeparables self comb_iter_4_left x_comb_iter_4
self comb_iter_0_left x1 x_comb_iter_0_left x_comb_iter_0
self comb_iter_0_right x x_comb_iter_0_right x_comb_iter_0
x_comb_iter_0_left|x_comb_iter_0_right x_comb_iter_0 x_comb_iter_0
self comb_iter_1_left x1 x_comb_iter_1_left x_comb_iter_1
self comb_iter_1_right x x_comb_iter_1_right x_comb_iter_1
x_comb_iter_1_left|x_comb_iter_1_right x_comb_iter_1 x_comb_iter_1
x_comb_iter_1_left|x_comb_iter_1_right x_comb_iter_1 x_comb_iter_3
self comb_iter_2_left x1 x_comb_iter_2_left x_comb_iter_2
self comb_iter_2_left x1 x_comb_iter_2_left x_comb_iter_2
self comb_iter_2_right x x_comb_iter_2_right x_comb_iter_2
x_comb_iter_2_left|x_comb_iter_2_right x_comb_iter_2 x_comb_iter_2
self comb_iter_3_right x_comb_iter_0 x_comb_iter_3_right x_comb_iter_3
self comb_iter_3_right x_comb_iter_0 x_comb_iter_3_right x_comb_iter_3
x_comb_iter_3_right|x_comb_iter_1 x_comb_iter_3 x_comb_iter_3
self comb_iter_4_left x_comb_iter_0 x_comb_iter_4_left x_comb_iter_4
self comb_iter_4_left x_comb_iter_0 x_comb_iter_4_left x_comb_iter_4
self comb_iter_4_right x1 x_comb_iter_4_right x_comb_iter_4
x_comb_iter_4_left|x_comb_iter_4_right x_comb_iter_4 x_comb_iter_4
self conv_1x1 x_stem_0 x_left x_comb_iter_2
self final_path_bn P Concat (x_path1|x_path2) x_right x_comb_iter_4
self comb_iter_2_left x_left x_comb_iter_2_left x_comb_iter_2
self final_path_bn P Concat (x_path1|x_path2) x_left x_comb_iter_2
self conv_1x1 x x_right x_comb_iter_4
self comb_iter_2_left x_right x_comb_iter_2_left x_comb_iter_2
self comb_iter_3_left x_left x_comb_iter_3_left x_comb_iter_3
self comb_iter_3_right x_left x_comb_iter_3_right x_comb_iter_3
x_comb_iter_3_left|x_comb_iter_3_right x_comb_iter_3 x_comb_iter_3
self comb_iter_4_left x_right x_comb_iter_4_left x_comb_iter_4
self penultimate_filters||24 filters num_filters
self penultimate_filters||24 filters num_filters
self penultimate_filters||24 filters in_channels_left
self penultimate_filters||24 filters out_channels_left
self penultimate_filters||24 filters out_channels_right
self penultimate_filters||24 filters out_channels_left
self cells_and_names m kernel_size|m kernel_size|m out_channels n
NASNetAMobile config num_classes|is_training self network self network
kwargs num_classes
net_factory nets_map num_classes|16|freeze_bn deeplab_v3_s16_network
net_factory nets_map num_classes|8|freeze_bn deeplab_v3_s8_network
NotImplementedError f
parser parse_args args
context GRAPH_MODE mode|args device_target device_target|args device_id device_id context set_context
net_factory nets_map args num_classes|16|True network
net_factory nets_map args num_classes|8|True network
load_checkpoint args ckpt_file param_dict
load_param_into_net network|param_dict
Tensor np ones [args batch_size|3|args input_size|args input_size] astype(np float32) input_data
args file_name|file_format file_name
parser parse_args args file_name|file_format file_name
load_param_into_net network|param_dict
super BuildTrainNetwork|self __init__
network self network
criterion self criterion
self network input_data output
self criterion output|label net_loss
argparse ArgumentParser parser
parser parse_known_args _
parse_args args
get_rank args rank
get_group_size args group_size
ParallelMode DATA_PARALLEL parallel_mode
args image_std image_std
args data_file data_file
args batch_size batch_size
args crop_size crop_size
args max_scale max_scale
args min_scale min_scale
args ignore_label ignore_label
args num_classes num_classes
args rank shard_id
net_factory nets_map args model args num_classes|16|args freeze_bn network
net_factory nets_map args model args num_classes|8|args freeze_bn network
NotImplementedError  format args model
loss SoftmaxCrossEntropyLoss args num_classes|args ignore_label loss_
BuildTrainNetwork network|loss_ train_net
load_checkpoint args ckpt_pre_trained param_dict
load_param_into_net train_net|param_dict
dataset get_dataset_size iters_per_epoch
iters_per_epochargs train_epochs total_train_steps
learning_rates cosine_lr args base_lr|total_train_steps|total_train_steps lr_iter
TimeMonitor data_size time_cb
LossMonitor loss_cb
[time_cb|loss_cb] cbs
ModelCheckpoint prefix ckpoint_cb
cbs append ckpoint_cb
cbs callbacks
load_param_into_net network self network
argparse ArgumentParser parser parse_known_args _
parse_args args image_std image_std
parse_args args data_file data_file
parse_args args batch_size batch_size
parse_args args crop_size crop_size
parse_args args max_scale max_scale
parse_args args min_scale min_scale
parse_args args ignore_label ignore_label
parse_args args num_classes num_classes
parse_args args rank shard_id
loss SoftmaxCrossEntropyLoss args num_classes|args ignore_label loss_ cbs
TimeMonitor data_size time_cb cbs
LossMonitor loss_cb cbs
[time_cb|loss_cb] cbs append ckpoint_cb
[time_cb|loss_cb] cbs callbacks
argparse ArgumentParser parser
parser parse_known_args _
n2) reshape(n|n minlength
img shape _
long_size new_h
int 1 0|long_size|w|h new_w
long_size new_w
int 1 0|long_size|h|w new_h
cv2 resize img|(new_w|new_h) imo
super BuildEvalNetwork|self __init__
network self network
self network input_data output
self softmax output output
resize_long img_|crop_size img_
img_ shape _
np array args image_mean image_mean
np array args image_std image_std
(img_-image_mean)|image_std img_
crop_size-img_ shape pad_h
crop_size-img_ shape pad_w
img_ transpose (2|0|1) img_
len img_lst batch_size
np zeros (args batch_size|3|crop_size|crop_size) batch_img
range l
img_lst l img_
pre_process args|img_|crop_size resize_w
img_ batch_img l
resize_hw append [resize_h|resize_w]
np ascontiguousarray batch_img batch_img
eval_net Tensor batch_img|mstype float32 net_out
net_out asnumpy net_out
eval_net Tensor batch_img|mstype float32 net_out_flip
net_out_flip asnumpy net_out
range bs
net_out transpose (1|2|0) probs_
img_lst bs] shape|img_lst[bs ori_w
cv2 resize probs_|(ori_w|ori_h) probs_
result_lst append probs_
eval_batch args|eval_net|img_lst|crop_size probs_lst
print sizes_
sizes_ crop_size_
eval_batch args|eval_net|img_lst|crop_size probs_lst_tmp
enumerate pl|_
probs_lst i
parse_args args
open args data_lst
f readlines img_lst
net_factory nets_map args model args num_classes|16|args freeze_bn network
net_factory nets_map args model args num_classes|8|args freeze_bn network
NotImplementedError  format args model
BuildEvalNetwork network eval_net
load_checkpoint args ckpt_path param_dict
load_param_into_net eval_net|param_dict
eval_net set_train False
np zeros (args num_classes|args num_classes) hist
enumerate i|line
line strip split msk_path
os path join args data_root|img_path img_path
os path join args data_root|msk_path msk_path
cv2 imread img_path img_
cv2 imread msk_path|cv2 IMREAD_GRAYSCALE msk_
batch_img_lst append img_
batch_msk_lst append msk_
range mi
cal_hist batch_msk_lst mi] flatten|batch_res[mi hist
print  format i|1
i image_num
print  format image_num|1
print hist
np diag hist|(hist sum|hist sum-np diag hist) iu
print iu
print np nanmean iu
argparse ArgumentParser parser parse_known_args _
resize_long img_|crop_size img_ shape _
resize_long img_|crop_size img_ transpose (2|0|1) img_
resize_long img_|crop_size img_ batch_img l
resize_long img_|crop_size img_ probs_lst
resize_long img_|crop_size img_ probs_lst_tmp
np array args image_std image_std img_
(img_-image_mean)|image_std img_ transpose (2|0|1) img_
(img_-image_mean)|image_std img_ batch_img l
(img_-image_mean)|image_std img_ probs_lst
(img_-image_mean)|image_std img_ probs_lst_tmp
img_lst l img_ batch_img l
img_lst l img_ probs_lst
img_lst l img_ probs_lst_tmp
eval_net Tensor batch_img|mstype float32 net_out asnumpy net_out
eval_net Tensor batch_img|mstype float32 net_out transpose (1|2|0) probs_
eval_net Tensor batch_img|mstype float32 net_out_flip asnumpy net_out
net_out_flip asnumpy net_out transpose (1|2|0) probs_
eval_batch args|eval_net|img_lst|crop_size probs_lst i
print sizes_ crop_size_
probs_lst i image_num
BuildEvalNetwork network eval_net set_train False
load_param_into_net eval_net set_train False
enumerate line strip split msk_path
enumerate i image_num
print  format i image_num
open readlines hccn_configs
hccn_configs hccn_item
hccn_item strip hccn_item
hccn_item startswith
hccn_item split device_ip
device_id split device_id
device_ip device_ips device_id
print  format device_id|device_ip
{la} hccn_table
range instance_id
{} instance
str instance_id device_id
device_ips device_id device_ip
str device_id usable_dev
str instance_id instance
server_id instance
instance_list append instance
hccn_table append  format instance_id
os path join os getcwd table_fn
print table_fn
open table_fn|
sys argv host_server_id
get_multicards_json host_server_id
open readlines hccn_configs hccn_item
hccn_configs hccn_item strip hccn_item
hccn_configs hccn_item startswith
hccn_configs hccn_item split device_ip
hccn_item split device_ip device_ips device_id
{la} hccn_table append  format instance_id
super SoftmaxCrossEntropyLoss|self __init__
P OneHot axis self one_hot
Tensor 1 0|mstype float32 self on_value
Tensor 0 0|mstype float32 self off_value
P Cast self cast
nn SoftmaxCrossEntropyWithLogits self ce
P NotEqual self not_equal
num_cls self num_cls
ignore_label self ignore_label
P Mul self mul
P ReduceSum False self sum
P RealDiv self div
P Transpose self transpose
P Reshape self reshape
self cast labels|mstype int32 labels_int
self reshape labels_int|(-1|) labels_int
self transpose logits|(0|2|3|1) logits_
self reshape logits_|(-1|self num_cls) logits_
self not_equal labels_int|self ignore_label weights
self cast weights|mstype float32 weights
self one_hot labels_int|self num_cls|self on_value|self off_value one_hot_labels
self ce logits_|one_hot_labels loss
self mul weights|loss loss
self div self sum loss loss
range i
min i|decay_steps step_
((1 0-step_|decay_steps)power)
i||decay_steps power_
float i|decay_steps power_
range i power_
super Resnet|self __init__
nn BatchNorm2d self inplanes|use_batch_statistics self bn1
nn ReLU self relu
self _make_layer block|64|block_num|use_batch_statistics self layer1
 downsample
conv1x1 self inplanes|planes|block expansion|stride
|blocks grids
planes|block expansion self inplanes
range i
nn SequentialCell layers
self conv1 x out
self bn1 out out
self relu out out
self maxpool out out
self layer1 out out
self layer2 out out
self layer3 out out
self layer4 out out
super Bottleneck|self __init__
conv1x1 inplanes|planes self conv1
nn BatchNorm2d planes|use_batch_statistics self bn1
conv3x3 planes|planes|stride|dilation|dilation self conv2
nn BatchNorm2d planes|use_batch_statistics self bn2
conv1x1 planes|planes|self expansion self conv3
nn BatchNorm2d planes|self expansion|use_batch_statistics self bn3
downsample self downsample
P TensorAdd self add
x identity
self conv2 out out
self bn2 out out
self conv3 out out
self bn3 out out
self downsample x identity
self add out|identity out
super ASPP|self __init__
phase self phase
ASPPConv in_channels|out_channels|atrous_rates|use_batch_statistics self aspp1
ASPPConv in_channels|out_channels|atrous_rates|use_batch_statistics self aspp2
ASPPConv in_channels|out_channels|atrous_rates|use_batch_statistics self aspp3
ASPPConv in_channels|out_channels|atrous_rates|use_batch_statistics self aspp4
ASPPPooling in_channels|out_channels|use_batch_statistics self aspp_pooling
nn BatchNorm2d out_channels|use_batch_statistics self bn1
nn Dropout self drop
self aspp1 x x1
self aspp2 x x2
self aspp3 x x3
self aspp4 x x4
self aspp_pooling x x5
self concat (x1|x2) x
self concat (x|x3) x
self concat (x|x4) x
self concat (x|x5) x
self conv1 x x
self bn1 x x
self relu x x
self drop x x
self conv2 x x
super ASPPPooling|self __init__
 self conv
nn ReLU
P Shape self shape
self shape x size
nn AvgPool2d size x out
self conv out out
P ResizeNearestNeighbor (size|size) out
super ASPPConv|self __init__
nn BatchNorm2d out_channels|use_batch_statistics bn
nn ReLU relu
nn SequentialCell [conv|bn|relu] self aspp_conv
self aspp_conv x out
super DeepLabV3|self __init__
self resnet x out
self aspp out out
P ResizeBilinear (size|size) out
 downsample self downsample
conv1x1 self inplanes|planes|block  self conv
self conv1 x out self aspp1
self conv1 x out self aspp2
self conv1 x out self aspp3
self conv1 x out self aspp4
self conv1 x out self aspp_pooling
self bn1 out out self aspp1
self bn1 out out self aspp2
self bn1 out out self aspp3
self bn1 out out self aspp4
self bn1 out out self aspp_pooling
self relu out out self aspp1
self relu out out self aspp2
self relu out out self aspp3
self relu out out self aspp4
self relu out out self aspp_pooling
self maxpool out out self aspp1
self maxpool out out self aspp2
self maxpool out out self aspp3
self maxpool out out self aspp4
self maxpool out out self aspp_pooling
self layer1 out out self aspp1
self layer1 out out self aspp2
self layer1 out out self aspp3
self layer1 out out self aspp4
self layer1 out out self aspp_pooling
self layer2 out out self aspp1
self layer2 out out self aspp2
self layer2 out out self aspp3
self layer2 out out self aspp4
self layer2 out out self aspp_pooling
self layer3 out out self aspp1
self layer3 out out self aspp2
self layer3 out out self aspp3
self layer3 out out self aspp4
self layer3 out out self aspp_pooling
self layer4 out out self aspp1
self layer4 out out self aspp2
self layer4 out out self aspp3
self layer4 out out self aspp4
self layer4 out out self aspp_pooling
self conv2 out out self aspp1
self conv2 out out self aspp2
self conv2 out out self aspp3
self conv2 out out self aspp4
self conv2 out out self aspp_pooling
self bn2 out out self aspp1
self bn2 out out self aspp2
self bn2 out out self aspp3
self bn2 out out self aspp4
self bn2 out out self aspp_pooling
self conv3 out out self aspp1
self conv3 out out self aspp2
self conv3 out out self aspp3
self conv3 out out self aspp4
self conv3 out out self aspp_pooling
self bn3 out out self aspp1
self bn3 out out self aspp2
self bn3 out out self aspp3
self bn3 out out self aspp4
self bn3 out out self aspp_pooling
self add out|identity out self aspp1
self add out|identity out self aspp2
self add out|identity out self aspp3
self add out|identity out self aspp4
self add out|identity out self aspp_pooling
cv2 setNumThreads
data_file self data_file
batch_size self batch_size
crop_size self crop_size
np array image_mean|dtype self image_mean
np array image_std|dtype self image_std
max_scale self max_scale
min_scale self min_scale
ignore_label self ignore_label
num_classes self num_classes
num_readers self num_readers
num_parallel_calls self num_parallel_calls
shard_id self shard_id
shard_num self shard_num
cv2 imdecode np frombuffer image|dtype image_out
cv2 imdecode np frombuffer label|dtype label_out
np random uniform self min_scale|self max_scale sc
int sc|image_out shape new_w
cv2 resize image_out|(new_w|new_h) image_out
cv2 resize label_out|(new_w|new_h) label_out
(image_out-self image_mean)|self image_std image_out
max new_h|self crop_size w_
h_-new_h|w_-new_w pad_w
cv2 copyMakeBorder label_out|0|pad_h|0|pad_w|cv2 BORDER_CONSTANT|value label_out
np random randint 0|h_-self crop_size|1 offset_h
np random randint 0|w_-self crop_size|1 offset_w
np random uniform 0 0|1 0
image_out transpose (2|0|1) image_out
image_out copy image_out
label_out copy label_out
self preprocess_ transforms_list
data_set shuffle buffer_size data_set
data_set repeat repeat data_set
cv2 imdecode(np frombuffer(image|dtype image_out transpose (2|0|1) image_out
cv2 imdecode np frombuffer image|dtype image_out copy image_out
cv2 imdecode np frombuffer label|dtype label_out copy label_out
cv2 resize image_out|(new_w|new_h) image_out transpose (2|0|1) image_out
cv2 resize image_out|(new_w|new_h) image_out copy image_out
cv2 resize label_out|(new_w|new_h) label_out copy label_out
(image_out-self image_mean)|self image_std image_out transpose (2|0|1) image_out
(image_out-self image_mean)|self image_std image_out copy image_out
max new_h|self crop_size w_ pad_w
cv2 copyMakeBorder label_out|0|pad_h|0|pad_w|cv2 BORDER_CONSTANT|value label_out copy label_out
argparse ArgumentParser parser
parser parse_known_args _
parse_args args
open args data_lst
f readlines lines
np random shuffle lines
os path exists dst_dir
os makedirs dst_dir
print len lines
FileWriter file_name writer
writer add_schema seg_schema|
lines l
l strip split label_path
{} sample_
open os path join args data_root|img_path|
f read sample_
open os path join args data_root|label_path|
datas append sample_
writer write_raw_data datas
print cnt
writer commit
argparse ArgumentParser parser parse_known_args _
f readlines lines l
np random shuffle lines l
print len lines l
FileWriter file_name writer add_schema seg_schema|
FileWriter file_name writer write_raw_data datas
FileWriter file_name writer commit
lines l strip split label_path
AlexNet args|kwargs
alexnet args|kwargs
NotImplementedError f
parser parse_args args_opt
context GRAPH_MODE mode|args_opt device_target device_target|args_opt device_id device_id context set_context
alexnet_cifar10_cfg cfg
alexnet_imagenet_cfg cfg
NotImplementedError f
AlexNet num_classes net
load_checkpoint args_opt ckpt_file param_dict
load_param_into_net net|param_dict
Tensor np zeros [args_opt batch_size|3|cfg image_height|cfg image_width] input_arr
args_opt file_name|file_format file_name
parser parse_args args_opt file_name|file_format file_name
files  ckpt
de config set_seed
parser parse_args args
int os environ get device_num
alexnet_cifar10_cfg cfg
cfg learning_rate|device_num cfg learning_rate
cfg epoch_size|2 cfg epoch_size
alexnet_imagenet_cfg cfg
args device_target device_target
context GRAPH_MODE mode|args device_target device_target context set_context
context set_context args device_id device_id
context reset_auto_parallel_context
create_dataset_cifar10 args data_path|cfg batch_size|target ds_train
create_dataset_imagenet args data_path|cfg batch_size ds_train
Tensor get_lr_cifar10 0|cfg learning_rate|cfg epoch_size|step_per_epoch lr
nn Momentum network trainable_params|lr|cfg momentum opt
{} metrics
Tensor get_lr_imagenet cfg learning_rate|cfg epoch_size|step_per_epoch lr
lr learning_rate
cfg momentum momentum
cfg weight_decay weight_decay
Model network|loss_fn model
os path join args ckpt_path||str(get_rank) ckpt_save_dir
args ckpt_path ckpt_save_dir
TimeMonitor data_size time_cb
parser parse_args args device_target device_target
parser parse_args args ckpt_path ckpt_save_dir
alexnet_cifar10_cfg cfg learning_rate|device_num cfg learning_rate
alexnet_cifar10_cfg cfg epoch_size|2 cfg epoch_size
alexnet_cifar10_cfg cfg momentum momentum
alexnet_cifar10_cfg cfg weight_decay weight_decay
alexnet_imagenet_cfg cfg momentum momentum
alexnet_imagenet_cfg cfg weight_decay weight_decay
Tensor get_lr_cifar10 0|cfg learning_rate|cfg epoch_size|step_per_epoch lr learning_rate
Tensor get_lr_imagenet cfg learning_rate|cfg epoch_size|step_per_epoch lr learning_rate
parser parse_args args
context GRAPH_MODE mode|args device_target device_target context set_context
alexnet_cifar10_cfg cfg
nn Momentum network trainable_params|cfg learning_rate|cfg momentum opt
load_checkpoint args ckpt_path param_dict
print  format args ckpt_path
load_param_into_net network|param_dict
network set_train False
Model network|loss|opt|metrics model
alexnet_imagenet_cfg cfg
Model network|loss_fn model
model eval ds_eval|dataset_sink_mode result
print  format result
nn Momentum network trainable_params|cfg learning_rate|cfg momentum opt model
load_param_into_net network set_train False
Model network|loss|opt|metrics model eval ds_eval|dataset_sink_mode result
Model network|loss_fn model eval ds_eval|dataset_sink_mode result
network trainable_params x
x name parameter_name
parameter_name endswith
no_decay_params append x
decay_params append x
network trainable_params x name parameter_name
x name parameter_name endswith
 alexnet_cifar10_cfg
 alexnet_imagenet_cfg
current_step int
lr_max float
total_epochs int
steps_per_epoch int
steps_per_epoch|total_epochs total_steps
[0 8|total_steps] decay_epoch_index
range i
lr_max lr
lr_max|0 1 lr
lr_each_step append lr
np array lr_each_step astype np float32 lr_each_step
lr_each_step learning_rate
warmup_cosine_annealing_lr lr|epoch_size|steps_per_epoch lr
(float(base_lr)-float(init_lr))|float(warmup_steps) lr_inc
float init_lr|lr_inc|current_step lr
lr base_lr
int max_epoch|steps_per_epoch total_steps
int warmup_epochs|steps_per_epoch warmup_steps
i||steps_per_epoch last_epoch
linear_warmup_lr i|1|warmup_steps|base_lr|warmup_init_lr lr
eta_min|(base_lr-eta_min)|(1 |math cos(math pi|last_epoch|T_max))|2 lr
np array lr_each_step astype np float32
current_step int max_epoch|steps_per_epoch total_steps
current_step int warmup_epochs|steps_per_epoch warmup_steps
lr_max float lr_inc
lr_max float init_lr|lr_inc|current_step lr
total_epochs int max_epoch|steps_per_epoch total_steps
total_epochs int warmup_epochs|steps_per_epoch warmup_steps
steps_per_epoch int max_epoch|steps_per_epoch total_steps
steps_per_epoch int warmup_epochs|steps_per_epoch warmup_steps
range i last_epoch
lr_max lr base_lr
lr_max|0 1 lr base_lr
lr_each_step append lr base_lr
np array lr_each_step astype np float32 lr_each_step learning_rate
warmup_cosine_annealing_lr lr|epoch_size|steps_per_epoch lr base_lr
float init_lr|lr_inc|current_step lr base_lr
_get_rank_info rank_id
ds Cifar10Dataset data_path cifar_ds
alexnet_cifar10_cfg cfg
CV Resize (cfg image_height|cfg image_width) resize_op
CV Rescale rescale|shift rescale_op
CV Normalize (0 4914|0 4822|0 4465) normalize_op
CV RandomCrop [32|32]|[4|4|4|4] random_crop_op
CV RandomHorizontalFlip random_horizontal_op
CV HWC2CHW channel_swap_op
C TypeCast mstype int32 typecast_op
cifar_ds shuffle buffer_size cifar_ds
cifar_ds repeat repeat_size cifar_ds
dataset_path string
do_train bool
repeat_num int
batch_size int
target str
alexnet_imagenet_cfg cfg
int 64|device_num num_parallel_workers
shuffle|sampler shuffle
cfg image_height image_size
[0 485|255|0 456|255|0 406|255] mean
[0 229|255|0 224|255|0 225|255] std
(0 08|1 0) scale
mean mean|std std CV Normalize
CV HWC2CHW
CV Decode
CV Resize (256|256)
CV CenterCrop image_size
[C TypeCast mstype int32] transform_label
int 16|device_num num_parallel_workers2
data_set repeat repeat_num data_set
int os environ get rank_size
get_group_size rank_size
get_rank rank_id
ds Cifar10Dataset data_path cifar_ds shuffle buffer_size cifar_ds
ds Cifar10Dataset data_path cifar_ds repeat repeat_size cifar_ds
alexnet_cifar10_cfg cfg image_height image_size
repeat_num int 64|device_num num_parallel_workers
repeat_num int 16|device_num num_parallel_workers2
repeat_num int os environ get rank_size
batch_size int 64|device_num num_parallel_workers
batch_size int 16|device_num num_parallel_workers2
batch_size int os environ get rank_size
alexnet_imagenet_cfg cfg image_height image_size
shuffle|sampler shuffle shuffle
[0 485|255|0 456|255|0 406|255] mean mean|std std CV Normalize
super AlexNet|self __init__
P ReLU self relu
include_top self include_top
nn Flatten self flatten
fc_with_initialize 6|6|256|4096 self fc1
fc_with_initialize 4096|4096 self fc2
fc_with_initialize 4096|num_classes self fc3
nn Dropout dropout_ratio self dropout
self conv1 x x
self relu x x
self max_pool2d x x
self conv2 x x
self conv3 x x
self conv4 x x
self conv5 x x
self flatten x x
self fc1 x x
self dropout x x
self fc2 x x
self fc3 x x
